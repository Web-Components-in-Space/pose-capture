const t="videoend",e="videopause",n="videoplay",r="videoloop",s="videosourcechanged",o="videotimeupdate",i="videometadata",a="startposetracking",u="endrecording",c="ready";class l extends Event{constructor(t,e,n){super(l.Type,n),this.action=t,this.state=this.toMinimalState(e)}toMinimalState(t){return{currentTime:t.currentTime,duration:t.duration,isLooping:t.isLooping,isPlaying:t.isPlaying,isRecording:t.isRecording,isAudioRecording:t.isAudioRecording,recordingDuration:t.recordingDuration,playbackRate:t.playbackRate,canRecord:t.canRecord}}}l.Type="playcontrolsevent",l.TOGGLE_PLAYBACK="onTogglePlayback",l.PLAYBACK_TIME_UPDATE="onPlaybackTimeUpdate",l.PLAYBACK_RATE_UPDATE="onPlaybackRateUpdate",l.TIMELINE_SCRUB="onTimelineScrub",l.TOGGLE_RECORD_POSE="onRecordPose",l.TOGGLE_RECORD_POSE_AND_AUDIO="onRecordPoseAndAudio",l.STEP_FORWARD="onStepForward",l.STEP_BACKWARD="onStepBackward",l.LOOP="onLoopChange";class f extends HTMLElement{constructor(){super(),this._playbackRate=this.hasAttribute("playbackrate")?Number(this.getAttribute("playbackrate")):1,this._isLooping=this.hasAttribute("islooping"),this._src=this.hasAttribute("src")?this.getAttribute("src"):void 0,this._isPlaying=!1,this._isRecording=!1,this._isAudioRecording=!1,this._currentTime=0,this._duration=0,this._recordingDuration=-1,this.visibleMediaRect={x:0,y:0,width:0,height:0},this.addEventListener(l.Type,this.handleControlsEvent)}connectedCallback(){this.dispatchEvent(new Event(c,{composed:!0,bubbles:!0}))}get canRecord(){return!1}get playbackRate(){return this._playbackRate}set playbackRate(t){t&&this.setAttribute("playbackrate",String(t)),this.changePlaybackRate(t)}get isLooping(){return this._isLooping}set isLooping(t){t?this.setAttribute("islooping",""):this.removeAttribute("islooping")}get src(){return this._src}set src(t){void 0===t?this.removeAttribute("src"):this.setAttribute("src",t)}get isPlaying(){return this._isPlaying}get isRecording(){return this._isRecording}get isAudioRecording(){return this._isAudioRecording}get currentTime(){return this._currentTime}set currentTime(t){this.seekTo(t)}get duration(){return this._duration}get recordingDuration(){return this._recordingDuration}get width(){return this.getBoundingClientRect().width}get height(){return this.getBoundingClientRect().height}get aspectRatio(){return this.visibleMediaRect.width/this.visibleMediaRect.height}get videoBounds(){return{x:this.visibleMediaRect.x,y:this.visibleMediaRect.y,width:this.visibleMediaRect.width,height:this.visibleMediaRect.height}}get naturalSize(){return{width:this.visibleMediaRect.width,height:this.visibleMediaRect.height}}pause(){}play(){}togglePlayback(){}step(t){}seekTo(t){}changePlaybackRate(t){}updateControls(){var t;const e=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector("slot");e&&e.assignedElements().forEach((t=>{const e=t;e&&(e.isLooping=this.isLooping,e.isPlaying=this.isPlaying,e.currentTime=this.currentTime,e.duration=this.duration,e.recordingDuration=this.recordingDuration,e.isRecording=this.isRecording,e.isAudioRecording=this.isAudioRecording,e.playbackRate=this.playbackRate,e.canRecord=this.canRecord)}))}handleControlsEvent(t){switch(t.action){case l.TOGGLE_PLAYBACK:this.isPlaying?this.pause():this.play(),this.updateControls();break;case l.LOOP:this.isLooping=!t.state.isLooping,this.updateControls();break;case l.STEP_FORWARD:this.pause(),this.step(1);break;case l.STEP_BACKWARD:this.pause(),this.step(-1);break;case l.TIMELINE_SCRUB:this.currentTime=t.state.currentTime;break;case l.PLAYBACK_RATE_UPDATE:this.playbackRate=t.state.playbackRate}}static formatTime(t){if(t){const e=Math.floor(t/1e3),n=Math.floor(e/60);return`${2===n.toString().length?n.toString():"0"+n.toString()}:${2===(e%60).toString().length?(e%60).toString():"0"+(e%60).toString()}`}return"00:00"}}class h extends f{constructor(){var t;super(),this.isComponentMounted=!1,this._useCamera=this.hasAttribute("usecamera"),this.attachShadow({mode:"open"}),this.shadowRoot&&(this.shadowRoot.innerHTML="\n            <style>\n                :host {\n                    display: inline-block;\n                    overflow: hidden;\n                    position: relative;\n                    background-color: black;\n                }\n                \n                :host(.connected) {\n                    display: inline-block;\n                }\n                \n                video, ::slotted(*) {\n                    position: absolute;\n                }\n                    \n                ::slotted(*) {\n                    width: 100%;\n                }\n            </style>\n            <video playsinline></video>\n            <slot></slot>"),this.videoEl=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector("video"),this._isLooping&&(this.videoEl.loop=!0),this._isPlaying=!1,this.videoEl.onloadedmetadata=()=>this.onMetadata(),this.videoEl.onloadeddata=()=>{(this.hasAttribute("autoplay")||this.hasAttribute("usecamera"))&&(this.hasAttribute("mute")&&(this.videoEl.muted=!0),this.play())},this.videoEl.onpause=()=>{this._isPlaying=!1,this.updateControls(),clearInterval(this.timer),this.dispatchEvent(new Event(e,{bubbles:!0,composed:!0}))},this.videoEl.onended=()=>this.onEnded(),this.videoEl.onplaying=()=>{this._isPlaying?this.dispatchEvent(new Event(r,{bubbles:!0,composed:!0})):(this._isPlaying=!0,this.videoEl.playbackRate=this._playbackRate,clearInterval(this.timer),this.timer=window.setInterval((()=>{this.onTimerUpdate()}),100),this.dispatchEvent(new Event(n,{bubbles:!0,composed:!0}))),this.updateControls()}}static get observedAttributes(){return["usecamera","src","islooping","playbackrate"]}get videoElement(){return this.videoEl}get canRecord(){return!0}get useCamera(){return this._useCamera}set useCamera(t){t?this.setAttribute("usecamera",""):this.removeAttribute("usecamera")}onTimerUpdate(){this._currentTime=1e3*this.videoEl.currentTime,this.updateControls(),this.dispatchEvent(new Event(o,{bubbles:!0,composed:!0}))}pause(){this.videoEl.pause()}play(){this.videoEl.play()}togglePlayback(){this.isPlaying?this.pause():this.play(),this.updateControls()}step(t){this.pause(),this.videoEl.currentTime+=.04166*t}seekTo(t){this.videoEl.currentTime=t/1e3}changePlaybackRate(t){this.videoEl.playbackRate=t}get naturalSize(){return{width:this.videoEl.videoWidth,height:this.videoEl.videoHeight}}get aspectRatio(){return this.naturalSize.width/this.naturalSize.height}onEnded(){clearInterval(this.timer),this.dispatchEvent(new Event(t,{bubbles:!0,composed:!0}))}onMetadata(){this.resize(),this.dispatchEvent(new Event(i,{bubbles:!0,composed:!0})),this._duration=1e3*this.videoEl.duration,this.updateControls()}connectedCallback(){super.connectedCallback(),this.classList.toggle("connected",!0),this.isComponentMounted=!0,setTimeout((()=>this.loadCurrentSource()),1e3)}async loadCurrentSource(){let t=!1;this.hasAttribute("src")&&(this.videoEl.srcObject=null,this.videoEl.src=this.getAttribute("src")||"",this.stream&&(this.stream.getTracks()[0].stop(),this.stream=void 0),t=!0),this.hasAttribute("usecamera")?(this.stream=await navigator.mediaDevices.getUserMedia({audio:!0,video:{width:this.width,height:this.height}}),this.videoEl.srcObject=this.stream,this.videoEl.muted=!0,t=!0):!this.hasAttribute("usecamera")&&this.videoEl.srcObject&&(this.videoEl.srcObject=null,this.stream&&(this.stream.getTracks()[0].stop(),this.stream=void 0),t=!0),t&&this.dispatchEvent(new Event(s,{bubbles:!0,composed:!0}))}async attributeChangedCallback(t,e,n){switch(t){case"src":this._src=n,n!==e&&this.isComponentMounted&&this.loadCurrentSource();break;case"usecamera":this._useCamera=this.hasAttribute("usecamera"),this.isComponentMounted&&this.loadCurrentSource();break;case"islooping":this._isLooping=this.hasAttribute("islooping"),this.videoEl.loop=this._isLooping;break;case"playbackrate":this._playbackRate=Number(this.getAttribute("playbackRate")),this.videoEl.playbackRate=this.playbackRate}}resize(){const t=this.getBoundingClientRect();if(0===t.width||0===t.height)return;let e=t.width,n=t.height;const r=t.width/t.height;let s,o;r<this.aspectRatio?(n=t.width/this.aspectRatio,o=t.height/2-n/2,s=0):r>this.aspectRatio?(e=t.height*this.aspectRatio,s=t.width/2-e/2,o=0):(o=0,s=0),this.visibleMediaRect.x=s,this.visibleMediaRect.y=o,this.visibleMediaRect.width=e,this.visibleMediaRect.height=n,this.videoEl.setAttribute("width",String(e)),this.videoEl.setAttribute("height",String(n)),this.videoEl.style.left=`${s}px`,this.videoEl.style.top=`${o}px`}disconnectedCallback(){if(clearInterval(this.timer),this.isComponentMounted=!1,this.stream){this.stream.getTracks().forEach((t=>{t.stop()}))}}}customElements.define("video-element",h);class p extends Event{constructor(t,e,n){super(p.EventName,n),this.poseType=t,this.keyframes=e}getPartLocation(t,e=0){if(this.keyframes.length>e){const n=this.keyframes[e].points.filter((e=>t===e.name));if(n.length>0)return n[0]}}}p.EventName="poseKeyframe";class d extends h{constructor(){super(),this._keyframes=[],this._minConfidence=Number(this.getAttribute("minconfidence")),this.hasStarted=!1,this.forceOneTimePoseProcess=!1,this.addEventListener(l.Type,this.handleControlsEvent)}get poseType(){return"posebase"}get parts(){return[]}static get observedAttributes(){return[...h.observedAttributes,"minconfidence"]}get keyframes(){return this._keyframes.slice()}set minConfidence(t){this.setAttribute("minconfidence",String(t))}get minConfidence(){return this._minConfidence}get recording(){return{keyframes:this.keyframes,audio:this.audioData,duration:this.recordingDuration}}step(t){super.step(t),this.forceOneTimePoseProcess=!0}onPoseFrame(t){var e;this.hasStarted||(this.hasStarted=!0,this.dispatchEvent(new Event(a,{bubbles:!0,composed:!0})));const n=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector("slot");if(n&&n.assignedElements().forEach((e=>{if(e.draw){e.draw(t,this.videoBounds)}})),t.length>0){const e=new p(this.poseType,t,{bubbles:!0,composed:!0});this.dispatchEvent(e)}this.isRecording&&this._keyframes.push(...t)}onTimerUpdate(){this.isRecording&&this.recordingStartTime&&(this._recordingDuration=Date.now()-this.recordingStartTime),super.onTimerUpdate()}startRecording(t=!1){if(!this.isRecording&&(this.isPlaying||this.play(),this._isRecording=!0,this._isAudioRecording=t,this.recordingStartTime=Date.now(),this._keyframes=[],this.recordedAudio=void 0,this.audioData=void 0,this.updateControls(),t)){const t=this.videoEl.captureStream();if(t.getAudioTracks().length>0){const e=new MediaStream;e.addTrack(t.getAudioTracks()[0]);const n=[];this.audioRecorder=new MediaRecorder(e),this.audioRecorder.ondataavailable=t=>{n.push(t.data)},this.audioRecorder.onstop=()=>{this.recordedAudio=new Blob(n);const t=new FileReader;t.readAsDataURL(this.recordedAudio),new Promise((()=>{t.onloadend=()=>{this.audioData=t.result.replace("application/octet-stream","audio/webm"),this.dispatchEvent(new Event(u,{bubbles:!0,composed:!0}))}}))},this.audioRecorder.start(1e3)}}}stopRecording(){this._isRecording=!1,this._isAudioRecording=!1,this.recordingStartTime&&(this._recordingDuration=Date.now()-this.recordingStartTime),this.updateControls(),this.audioRecorder?(this.audioRecorder.stop(),this.audioRecorder=void 0):this.dispatchEvent(new Event(u,{bubbles:!0,composed:!0}))}onEnded(){super.onEnded(),this.stopRecording()}handleControlsEvent(t){switch(super.handleControlsEvent(t),t.action){case l.TOGGLE_RECORD_POSE:this._isRecording?this.stopRecording():this.startRecording(!1);break;case l.TOGGLE_RECORD_POSE_AND_AUDIO:this._isRecording?this.stopRecording():this.startRecording(!0)}}async attributeChangedCallback(t,e,n){if(await super.attributeChangedCallback(t,e,n),"minconfidence"===t)this._minConfidence=Number(this.getAttribute("minconfidence"))}}function m(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(n){if("default"!==n&&!(n in t)){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}))})),Object.freeze(t)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */customElements.define("videopose-element",d);class y{refCount(t){return g("refCount")}incRef(t){return g("incRef")}timerAvailable(){return!0}time(t){return g("time")}read(t){return g("read")}readSync(t){return g("readSync")}readToGPU(t,e){return g("readToGPU")}numDataIds(){return g("numDataIds")}disposeData(t,e){return g("disposeData")}write(t,e,n){return g("write")}move(t,e,n,r,s){return g("move")}memory(){return g("memory")}floatPrecision(){return g("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return g("dispose")}}function g(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,v(t,e,n)}function w(t,e,n){return Math.max(t,Math.min(e,n))}function v(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function x(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function N(t,e,n=""){x(_(t,e),(()=>n+` Shapes ${t} and ${e} must match`))}function $(t){x(null!=t,(()=>"The input to the tensor constructor must be a non-null value."))}function E(t,e=[],n=!1){if(null==e&&(e=[]),Array.isArray(t)||D(t)&&!n)for(let r=0;r<t.length;++r)E(t[r],e,n);else e.push(t);return e}function S(t){if(0===t.length)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function _(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function T(t){return t%1==0}function k(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function A(t,e){const n=e.length;return t=null==t?e.map(((t,e)=>e)):[].concat(t),x(t.every((t=>t>=-n&&t<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`)),x(t.every((t=>T(t))),(()=>`All values in axis param must be integers but got axis ${t}`)),t.map((t=>t<0?n+t:t))}function C(t,e){const n=[],r=[],s=null!=e&&Array.isArray(e)&&0===e.length,o=null==e||s?null:A(e,t).sort();let i=0;for(let e=0;e<t.length;++e){if(null!=o){if(o[i]===e&&1!==t[e])throw new Error(`Can't squeeze axis ${e} since its dim '${t[e]}' is not 1`);(null==o[i]||o[i]>e)&&1===t[e]&&(n.push(t[e]),r.push(e)),o[i]<=e&&i++}1!==t[e]&&(n.push(t[e]),r.push(e))}return{newShape:n,keptDims:r}}function O(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error(`Unknown data type ${t}`);n=new Uint8Array(e)}return n}function I(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error(`Unknown data type ${t}`);n=new Array(e)}return n}function M(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function R(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function D(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function F(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error(`Unknown dtype ${t}`)}function L(t){if(null==t)return 0;let e=0;return t.forEach((t=>e+=t.length)),e}function P(t){return"string"==typeof t||t instanceof String}function B(t){return"boolean"==typeof t}function V(t){return"number"==typeof t}function z(t){return Array.isArray(t)?z(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":V(t)?"float32":P(t)?"string":B(t)?"bool":"float32"}function W(t){return!!(t&&t.constructor&&t.call&&t.apply)}function U(t,e){for(let n=e;n<t;++n)if(t%n==0)return n;return t}function j(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function G(t,e,n,r=!1){const s=new Array;if(1===e.length){const o=e[0]*(r?2:1);for(let e=0;e<o;e++)s[e]=n[t+e]}else{const o=e[0],i=e.slice(1),a=i.reduce(((t,e)=>t*e))*(r?2:1);for(let e=0;e<o;e++)s[e]=G(t+e*a,i,n,r)}return s}function q(t,e,n=!1){if(0===t.length)return e[0];const r=t.reduce(((t,e)=>t*e))*(n?2:1);if(0===r)return[];if(r!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return G(0,t,e,n)}function H(t,e){const n=K(t,e);for(let t=0;t<n.length;t++)n[t]=1;return n}function K(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function X(t){t.forEach((e=>{x(Number.isInteger(e)&&e>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`))}))}function J(t){return t&&t.then&&"function"==typeof t.then}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Y{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Z,this.populateURLFlags()}setPlatform(t,e){null!=this.platform&&(Q().getBool("IS_TEST")||Q().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=e}registerFlag(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){const e=this.urlFlags[t];Q().getBool("IS_TEST")||Q().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${e}.`),this.set(t,e)}}async getAsync(t){return t in this.flags||(this.flags[t]=await this.evaluateFlag(t)),this.flags[t]}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(J(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(null==this.flagRegistry[t])throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(null==this.flagRegistry[t])throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const t=this.getQueryParams(this.global.location.search);if("tfjsflags"in t){t.tfjsflags.split(",").forEach((t=>{const[e,n]=t.split(":");this.urlFlags[e]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}(e,n)}))}}}function Z(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((t,...n)=>(function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")))),e}function Q(){return tt}let tt=null;var et="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function nt(){throw new Error("setTimeout has not been defined")}function rt(){throw new Error("clearTimeout has not been defined")}var st=nt,ot=rt;function it(t){if(st===setTimeout)return setTimeout(t,0);if((st===nt||!st)&&setTimeout)return st=setTimeout,setTimeout(t,0);try{return st(t,0)}catch(e){try{return st.call(null,t,0)}catch(e){return st.call(this,t,0)}}}"function"==typeof et.setTimeout&&(st=setTimeout),"function"==typeof et.clearTimeout&&(ot=clearTimeout);var at,ut=[],ct=!1,lt=-1;function ft(){ct&&at&&(ct=!1,at.length?ut=at.concat(ut):lt=-1,ut.length&&ht())}function ht(){if(!ct){var t=it(ft);ct=!0;for(var e=ut.length;e;){for(at=ut,ut=[];++lt<e;)at&&at[lt].run();lt=-1,e=ut.length}at=null,ct=!1,function(t){if(ot===clearTimeout)return clearTimeout(t);if((ot===rt||!ot)&&clearTimeout)return ot=clearTimeout,clearTimeout(t);try{ot(t)}catch(e){try{return ot.call(null,t)}catch(e){return ot.call(this,t)}}}(t)}}function pt(t,e){this.fun=t,this.array=e}pt.prototype.run=function(){this.fun.apply(null,this.array)};function dt(){}var mt=dt,yt=dt,gt=dt,bt=dt,wt=dt,vt=dt,xt=dt;var Nt=et.performance||{},$t=Nt.now||Nt.mozNow||Nt.msNow||Nt.oNow||Nt.webkitNow||function(){return(new Date).getTime()};var Et=new Date;var St={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];ut.push(new pt(t,e)),1!==ut.length||ct||it(ht)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:mt,addListener:yt,once:gt,off:bt,removeListener:wt,removeAllListeners:vt,emit:xt,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*$t.call(Nt),n=Math.floor(e),r=Math.floor(e%1*1e9);return t&&(n-=t[0],(r-=t[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-Et)/1e3}},_t=St;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
let Tt;function kt(){if(null==Tt){let t;if("undefined"!=typeof window)t=window;else if(void 0!==et)t=et;else if(void 0!==_t)t=_t;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}Tt=t}return Tt}function At(t,e){const n=function(){const t=kt();return null==t._tfGlobals&&(t._tfGlobals=new Map),t._tfGlobals}();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ct(...t){Q().getBool("IS_TEST")||Q().getBool("PROD")||console.warn(...t)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Ot=At("kernelRegistry",(()=>new Map)),It=At("gradRegistry",(()=>new Map));function Mt(t,e){const n=Lt(t,e);return Ot.get(n)}function Rt(t){return It.get(t)}function Dt(t){const e=Ot.entries(),n=[];for(;;){const{done:r,value:s}=e.next();if(r)break;const[o,i]=s,[a]=o.split("_");a===t&&n.push(i)}return n}function Ft(t){const{kernelName:e,backendName:n}=t,r=Lt(e,n);Ot.has(r)&&Ct(`The kernel '${e}' for backend '${n}' is already registered`),Ot.set(r,t)}function Lt(t,e){return`${e}_${t}`}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var Pt=Vt,Bt=null;try{Bt=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(Yot){}function Vt(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function zt(t){return!0===(t&&t._)}Vt.prototype._,Object.defineProperty(Vt.prototype,"_",{value:!0}),Vt.isLong=zt;var Wt={},Ut={};function jt(t,e){var n,r,s;return e?(s=0<=(t>>>=0)&&t<256)&&(r=Ut[t])?r:(n=qt(t,(0|t)<0?-1:0,!0),s&&(Ut[t]=n),n):(s=-128<=(t|=0)&&t<128)&&(r=Wt[t])?r:(n=qt(t,t<0?-1:0,!1),s&&(Wt[t]=n),n)}function Gt(t,e){if(isNaN(t))return e?ee:te;if(e){if(t<0)return ee;if(t>=Yt)return ie}else{if(t<=-Zt)return ae;if(t+1>=Zt)return oe}return t<0?Gt(-t,e).neg():qt(t%Jt|0,t/Jt|0,e)}function qt(t,e,n){return new Vt(t,e,n)}Vt.fromInt=jt,Vt.fromNumber=Gt,Vt.fromBits=qt;var Ht=Math.pow;function Kt(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return te;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return Kt(t.substring(1),e,n).neg();for(var s=Gt(Ht(n,8)),o=te,i=0;i<t.length;i+=8){var a=Math.min(8,t.length-i),u=parseInt(t.substring(i,i+a),n);if(a<8){var c=Gt(Ht(n,a));o=o.mul(c).add(Gt(u))}else o=(o=o.mul(s)).add(Gt(u))}return o.unsigned=e,o}function Xt(t,e){return"number"==typeof t?Gt(t,e):"string"==typeof t?Kt(t,e):qt(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}Vt.fromString=Kt,Vt.fromValue=Xt;var Jt=4294967296,Yt=Jt*Jt,Zt=Yt/2,Qt=jt(1<<24),te=jt(0);Vt.ZERO=te;var ee=jt(0,!0);Vt.UZERO=ee;var ne=jt(1);Vt.ONE=ne;var re=jt(1,!0);Vt.UONE=re;var se=jt(-1);Vt.NEG_ONE=se;var oe=qt(-1,2147483647,!1);Vt.MAX_VALUE=oe;var ie=qt(-1,-1,!0);Vt.MAX_UNSIGNED_VALUE=ie;var ae=qt(0,-2147483648,!1);Vt.MIN_VALUE=ae;var ue=Vt.prototype;ue.toInt=function(){return this.unsigned?this.low>>>0:this.low},ue.toNumber=function(){return this.unsigned?(this.high>>>0)*Jt+(this.low>>>0):this.high*Jt+(this.low>>>0)},ue.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(ae)){var e=Gt(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var s=Gt(Ht(t,6),this.unsigned),o=this,i="";;){var a=o.div(s),u=(o.sub(a.mul(s)).toInt()>>>0).toString(t);if((o=a).isZero())return u+i;for(;u.length<6;)u="0"+u;i=""+u+i}},ue.getHighBits=function(){return this.high},ue.getHighBitsUnsigned=function(){return this.high>>>0},ue.getLowBits=function(){return this.low},ue.getLowBitsUnsigned=function(){return this.low>>>0},ue.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ae)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},ue.isZero=function(){return 0===this.high&&0===this.low},ue.eqz=ue.isZero,ue.isNegative=function(){return!this.unsigned&&this.high<0},ue.isPositive=function(){return this.unsigned||this.high>=0},ue.isOdd=function(){return 1==(1&this.low)},ue.isEven=function(){return 0==(1&this.low)},ue.equals=function(t){return zt(t)||(t=Xt(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},ue.eq=ue.equals,ue.notEquals=function(t){return!this.eq(t)},ue.neq=ue.notEquals,ue.ne=ue.notEquals,ue.lessThan=function(t){return this.comp(t)<0},ue.lt=ue.lessThan,ue.lessThanOrEqual=function(t){return this.comp(t)<=0},ue.lte=ue.lessThanOrEqual,ue.le=ue.lessThanOrEqual,ue.greaterThan=function(t){return this.comp(t)>0},ue.gt=ue.greaterThan,ue.greaterThanOrEqual=function(t){return this.comp(t)>=0},ue.gte=ue.greaterThanOrEqual,ue.ge=ue.greaterThanOrEqual,ue.compare=function(t){if(zt(t)||(t=Xt(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},ue.comp=ue.compare,ue.negate=function(){return!this.unsigned&&this.eq(ae)?ae:this.not().add(ne)},ue.neg=ue.negate,ue.add=function(t){zt(t)||(t=Xt(t));var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,o=t.high>>>16,i=65535&t.high,a=t.low>>>16,u=0,c=0,l=0,f=0;return l+=(f+=s+(65535&t.low))>>>16,c+=(l+=r+a)>>>16,u+=(c+=n+i)>>>16,u+=e+o,qt((l&=65535)<<16|(f&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},ue.subtract=function(t){return zt(t)||(t=Xt(t)),this.add(t.neg())},ue.sub=ue.subtract,ue.multiply=function(t){if(this.isZero())return te;if(zt(t)||(t=Xt(t)),Bt)return qt(Bt.mul(this.low,this.high,t.low,t.high),Bt.get_high(),this.unsigned);if(t.isZero())return te;if(this.eq(ae))return t.isOdd()?ae:te;if(t.eq(ae))return this.isOdd()?ae:te;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(Qt)&&t.lt(Qt))return Gt(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,o=t.high>>>16,i=65535&t.high,a=t.low>>>16,u=65535&t.low,c=0,l=0,f=0,h=0;return f+=(h+=s*u)>>>16,l+=(f+=r*u)>>>16,f&=65535,l+=(f+=s*a)>>>16,c+=(l+=n*u)>>>16,l&=65535,c+=(l+=r*a)>>>16,l&=65535,c+=(l+=s*i)>>>16,c+=e*u+n*a+r*i+s*o,qt((f&=65535)<<16|(h&=65535),(c&=65535)<<16|(l&=65535),this.unsigned)},ue.mul=ue.multiply,ue.divide=function(t){if(zt(t)||(t=Xt(t)),t.isZero())throw Error("division by zero");var e,n,r;if(Bt)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?qt((this.unsigned?Bt.div_u:Bt.div_s)(this.low,this.high,t.low,t.high),Bt.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?ee:te;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return ee;if(t.gt(this.shru(1)))return re;r=ee}else{if(this.eq(ae))return t.eq(ne)||t.eq(se)?ae:t.eq(ae)?ne:(e=this.shr(1).div(t).shl(1)).eq(te)?t.isNegative()?ne:se:(n=this.sub(t.mul(e)),r=e.add(n.div(t)));if(t.eq(ae))return this.unsigned?ee:te;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=te}for(n=this;n.gte(t);){e=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(e)/Math.LN2),o=s<=48?1:Ht(2,s-48),i=Gt(e),a=i.mul(t);a.isNegative()||a.gt(n);)a=(i=Gt(e-=o,this.unsigned)).mul(t);i.isZero()&&(i=ne),r=r.add(i),n=n.sub(a)}return r},ue.div=ue.divide,ue.modulo=function(t){return zt(t)||(t=Xt(t)),Bt?qt((this.unsigned?Bt.rem_u:Bt.rem_s)(this.low,this.high,t.low,t.high),Bt.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},ue.mod=ue.modulo,ue.rem=ue.modulo,ue.not=function(){return qt(~this.low,~this.high,this.unsigned)},ue.and=function(t){return zt(t)||(t=Xt(t)),qt(this.low&t.low,this.high&t.high,this.unsigned)},ue.or=function(t){return zt(t)||(t=Xt(t)),qt(this.low|t.low,this.high|t.high,this.unsigned)},ue.xor=function(t){return zt(t)||(t=Xt(t)),qt(this.low^t.low,this.high^t.high,this.unsigned)},ue.shiftLeft=function(t){return zt(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?qt(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):qt(0,this.low<<t-32,this.unsigned)},ue.shl=ue.shiftLeft,ue.shiftRight=function(t){return zt(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?qt(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):qt(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},ue.shr=ue.shiftRight,ue.shiftRightUnsigned=function(t){if(zt(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?qt(this.low>>>t|e<<32-t,e>>>t,this.unsigned):qt(32===t?e:e>>>t-32,0,this.unsigned)},ue.shru=ue.shiftRightUnsigned,ue.shr_u=ue.shiftRightUnsigned,ue.toSigned=function(){return this.unsigned?qt(this.low,this.high,!1):this},ue.toUnsigned=function(){return this.unsigned?this:qt(this.low,this.high,!0)},ue.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},ue.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},ue.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},Vt.fromBytes=function(t,e,n){return n?Vt.fromBytesLE(t,e):Vt.fromBytesBE(t,e)},Vt.fromBytesLE=function(t,e){return new Vt(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},Vt.fromBytesBE=function(t,e){return new Vt(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const ce=Pt||m({__proto__:null,default:Pt},[Pt]);function le(t){return ce.fromString(t,!0,16)}const fe=le("c3a5c85c97cb3127"),he=le("b492b66fbe98f273"),pe=le("9ae16a3b2f90404f");function de(t){return t.xor(t.shru(47))}function me(t,e,n){const r=t.slice(e,e+n);return ce.fromBytes(Array.from(r),!0,!0)}function ye(t,e){return me(t,e,8)}function ge(t,e){return me(t,e,4)}function be(t,e){return 0===e?t:t.shru(e).or(t.shl(64-e))}function we(t,e,n=le("9ddfea08eb382d69")){let r=t.xor(e).mul(n);r=r.xor(r.shru(47));let s=e.xor(r).mul(n);return s=s.xor(s.shru(47)),s=s.mul(n),s}function ve(t,e,n,r){return function(t,e,n,r,s,o){s=s.add(t),o=be(o.add(s).add(r),21);const i=s;return s=(s=s.add(e)).add(n),o=o.add(be(s,44)),[s.add(r),o.add(i)]}(ye(t,e),ye(t,e+8),ye(t,e+16),ye(t,e+24),n,r)}function xe(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=E(t)),Q().getBool("DEBUG")&&M(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){const e=new Uint8Array(t.length);for(let n=0;n<e.length;++n)0!==Math.round(t[n])&&(e[n]=1);return e}throw new Error(`Unknown data type ${e}`)}function Ne(){return Q().platform.now()}function $e(t,e="utf-8"){return e=e||"utf-8",Q().platform.encode(t,e)}function Ee(t,e="utf-8"){return e=e||"utf-8",Q().platform.decode(t,e)}var Se=Object.freeze({__proto__:null,createScalarValue:
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){return"string"===e?$e(t):xe([t],e)},toTypedArray:xe,now:Ne,fetch:function(t,e){return Q().platform.fetch(t,e)},encodeString:$e,decodeString:Ee,shuffle:b,shuffleCombo:function(t,e){if(t.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${e.length}`);let n=t.length,r=0;for(;n>0;)r=Math.random()*n|0,n--,v(t,n,r),v(e,n,r)},clamp:w,nearestLargerEven:function(t){return t%2==0?t:t+1},swap:v,sum:function(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e},randUniform:function(t,e){const n=Math.random();return e*n+(1-n)*t},distSquared:function(t,e){let n=0;for(let r=0;r<t.length;r++){const s=Number(t[r])-Number(e[r]);n+=s*s}return n},assert:x,assertShapesMatch:N,assertNonNull:$,flatten:E,sizeFromShape:S,isScalarShape:function(t){return 0===t.length},arraysEqual:_,isInt:T,tanh:function(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{const e=Math.exp(2*t);return(e-1)/(e+1)}},sizeToSquarishShape:function(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]},createShuffledIndices:function(t){const e=new Uint32Array(t);for(let n=0;n<t;++n)e[n]=n;return b(e),e},rightPad:k,repeatedTry:function(t,e=(t=>0),n){return new Promise(((r,s)=>{let o=0;const i=()=>{if(t())return void r();o++;const a=e(o);null!=n&&o>=n?s():setTimeout(i,a)};i()}))},inferFromImplicitShape:function(t,e){let n=1,r=-1;for(let e=0;e<t.length;++e)if(t[e]>=0)n*=t[e];else if(-1===t[e]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${e}`);r=e}else if(t[e]<0)throw Error(`Shapes can not be < 0. Found ${t[e]} at dim ${e}`);if(-1===r){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(0===n)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const s=t.slice();return s[r]=e/n,s},parseAxisParam:A,squeezeShape:C,getTypedArrayFromDType:O,getArrayFromDType:I,checkConversionForErrors:M,isValidDtype:R,hasEncodingLoss:function(t,e){return"complex64"!==e&&(("float32"!==e||"complex64"===t)&&(("int32"!==e||"float32"===t||"complex64"===t)&&("bool"!==e||"bool"!==t)))},isTypedArray:D,bytesPerElement:F,bytesFromStringArray:L,isString:P,isBoolean:B,isNumber:V,inferDtype:z,isFunction:W,nearestDivisor:U,computeStrides:j,toNestedArray:q,makeOnesTypedArray:H,makeZerosTypedArray:K,makeZerosNestedTypedArray:function(t,e){const n=t.reduce(((t,e)=>t*e),1);if(null==e||"float32"===e)return q(t,new Float32Array(n));if("int32"===e)return q(t,new Int32Array(n));if("bool"===e)return q(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)},assertNonNegativeIntegerDimensions:X,locToIndex:function(t,e,n){if(0===e)return 0;if(1===e)return t[0];let r=t[t.length-1];for(let e=0;e<t.length-1;++e)r+=n[e]*t[e];return r},indexToLoc:function(t,e,n){if(0===e)return[];if(1===e)return[t];const r=new Array(e);for(let e=0;e<r.length-1;++e)r[e]=Math.floor(t/n[e]),t-=r[e]*n[e];return r[r.length-1]=t,r},isPromise:J,hexToLong:le,fingerPrint64:function(t,e=t.length){const n=ce.fromNumber(81,!0);if(e<=32)return e<=16?function(t,e=t.length){if(e>=8){const n=pe.add(2*e),r=ye(t,0).add(pe),s=ye(t,e-8);return we(be(s,37).mul(n).add(r),be(r,25).add(s).mul(n),n)}if(e>=4){const n=pe.add(2*e);return we(ge(t,0).shl(3).add(e),ge(t,e-4),n)}if(e>0){const n=t[0]+(t[e>>1]<<8),r=e+(t[e-1]<<2);return de(pe.mul(n).xor(fe.mul(r))).mul(pe)}return pe}(t,e):function(t,e=t.length){const n=pe.add(2*e),r=ye(t,0).mul(he),s=ye(t,8),o=ye(t,e-8).mul(n),i=ye(t,e-16).mul(pe);return we(be(r.add(s),43).add(be(o,30)).add(i),r.add(be(s.add(pe),18)).add(o),n)}(t,e);if(e<=64)return function(t,e=t.length){const n=pe.add(2*e),r=ye(t,0).mul(pe),s=ye(t,8),o=ye(t,e-8).mul(n),i=ye(t,e-16).mul(pe),a=be(r.add(s),43).add(be(o,30)).add(i),u=we(a,r.add(be(s.add(pe),18)).add(o),n),c=ye(t,16).mul(n),l=ye(t,24),f=a.add(ye(t,e-32)).mul(n),h=u.add(ye(t,e-24)).mul(n);return we(be(c.add(l),43).add(be(f,30)).add(h),c.add(be(l.add(r),18)).add(f),n)}(t,e);let r=n,s=n.mul(he).add(113),o=de(s.mul(pe).add(113)).mul(pe),i=[ce.UZERO,ce.UZERO],a=[ce.UZERO,ce.UZERO];r=r.mul(pe).add(ye(t,0));let u=0;const c=64*(e-1>>6),l=c+(e-1&63)-63;do{r=be(r.add(s).add(i[0]).add(ye(t,u+8)),37).mul(he),s=be(s.add(i[1]).add(ye(t,u+48)),42).mul(he),r=r.xor(a[1]),s=s.add(i[0]).add(ye(t,u+40)),o=be(o.add(a[0]),33).mul(he),i=ve(t,u,i[1].mul(he),r.add(a[0])),a=ve(t,u+32,o.add(a[1]),s.add(ye(t,u+16))),[o,r]=[r,o],u+=64}while(u!==c);const f=he.add(o.and(255).shl(1));return u=l,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),r=be(r.add(s).add(i[0]).add(ye(t,u+8)),37).mul(f),s=be(s.add(i[1]).add(ye(t,u+48)),42).mul(f),r=r.xor(a[1].mul(9)),s=s.add(i[0].mul(9).add(ye(t,u+40))),o=be(o.add(a[0]),33).mul(f),i=ve(t,u,i[1].mul(f),r.add(a[0])),a=ve(t,u+32,o.add(a[1]),s.add(ye(t,u+16))),[o,r]=[r,o],we(we(i[0],a[0],f).add(de(s).mul(fe)).add(o),we(i[1],a[1],f).add(r),f)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _e{constructor(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new ke)}profileKernel(t,e,n){let r;const s=()=>{r=n()};let o;const i=Ne();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(s);else{s();for(const t of r)t.dataSync();o=Promise.resolve({kernelMs:Ne()-i})}if(Q().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let e=0;e<r.length;e++){const n=r[e];n.data().then((e=>{Te(e,n.dtype,t)}))}return{kernelName:t,outputs:r,inputs:e,timeMs:o.then((t=>t.kernelMs)),extraInfo:o.then((t=>null!=t.getExtraProfileInfo?t.getExtraProfileInfo():""))}}logKernelProfile(t){const{kernelName:e,outputs:n,timeMs:r,inputs:s,extraInfo:o}=t;n.forEach((t=>{Promise.all([t.data(),r,o]).then((n=>{this.logger.logKernelProfile(e,t,n[0],n[1],s,n[2])}))}))}}function Te(t,e,n){if("float32"!==e)return!1;for(let e=0;e<t.length;e++){const r=t[e];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class ke{logKernelProfile(t,e,n,r,s,o){const i="number"==typeof r?k(`${r}ms`,9):r.error,a=k(t,25),u=e.rank,c=e.size,l=k(e.shape.toString(),14);let f="";for(const t in s){const n=s[t];if(null!=n){const r=n.shape||e.shape,s=r.length;f+=`${t}: ${s}D ${s>0?r:""} `}}console.log(`%c${a}\t%c${i}\t%c${u}D ${l}\t%c${c}\t%c${f}\t%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ae(t,e,n,r){const s=j(e),o=function(t,e,n,r){const s=S(e),o=r[r.length-1],i=new Array(o).fill(0),a=e.length,u="complex64"===n?Me(t):t;if(a>1)for(let t=0;t<s/o;t++){const e=t*o;for(let t=0;t<o;t++)i[t]=Math.max(i[t],Ce(u[e+t],0,n).length)}return i}(t,e,n,s),i=e.length,a=Ie(t,e,n,s,o),u=["Tensor"];return r&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${i}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(a.map((t=>"    "+t)).join("\n")),u.join("\n")}function Ce(t,e,n){let r;return r=Array.isArray(t)?`${parseFloat(t[0].toFixed(7))} + ${parseFloat(t[1].toFixed(7))}j`:P(t)?`'${t}'`:"bool"===n?Oe(t):parseFloat(t.toFixed(7)).toString(),k(r,e)}function Oe(t){return 0===t?"false":"true"}function Ie(t,e,n,r,s,o=!0){const i="complex64"===n?2:1,a=e[0],u=e.length;if(0===u){if("complex64"===n){return[Ce(Me(t)[0],0,n)]}return"bool"===n?[Oe(t[0])]:[t[0].toString()]}if(1===u){if(a>20){const e=3*i;let r=Array.from(t.slice(0,e)),o=Array.from(t.slice((a-3)*i,a*i));return"complex64"===n&&(r=Me(r),o=Me(o)),["["+r.map(((t,e)=>Ce(t,s[e],n))).join(", ")+", ..., "+o.map(((t,e)=>Ce(t,s[a-3+e],n))).join(", ")+"]"]}return["["+("complex64"===n?Me(t):Array.from(t)).map(((t,e)=>Ce(t,s[e],n))).join(", ")+"]"]}const c=e.slice(1),l=r.slice(1),f=r[0]*i,h=[];if(a>20){for(let e=0;e<3;e++){const r=e*f,o=r+f;h.push(...Ie(t.slice(r,o),c,n,l,s,!1))}h.push("...");for(let e=a-3;e<a;e++){const r=e*f,o=r+f;h.push(...Ie(t.slice(r,o),c,n,l,s,e===a-1))}}else for(let e=0;e<a;e++){const r=e*f,o=r+f;h.push(...Ie(t.slice(r,o),c,n,l,s,e===a-1))}const p=2===u?",":"";h[0]="["+h[0]+p;for(let t=1;t<h.length-1;t++)h[t]=" "+h[t]+p;let d=",\n";for(let t=2;t<u;t++)d+="\n";return h[h.length-1]=" "+h[h.length-1]+"]"+(o?"":d),h}function Me(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Re{constructor(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=S(t),null!=n){const t=n.length;x(t===this.size,(()=>`Length of values '${t}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||I(e,this.size),this.strides=j(t)}set(t,...e){0===e.length&&(e=[0]),x(e.length===this.rank,(()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`));const n=this.locToIndex(e);this.values[n]=t}get(...t){0===t.length&&(t=[0]);let e=0;for(const n of t){if(n<0||n>=this.shape[e]){const e=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(e)}e++}let n=t[t.length-1];for(let e=0;e<t.length-1;++e)n+=this.strides[e]*t[e];return this.values[n]}locToIndex(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];let e=t[t.length-1];for(let n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e}indexToLoc(t){if(0===this.rank)return[];if(1===this.rank)return[t];const e=new Array(this.shape.length);for(let n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return De().makeTensor(this.values,this.shape,this.dtype)}}let De=null,Fe=null;class Le{constructor(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=S(t),this.strides=j(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return Fe.buffer(this.shape,this.dtype,t)}bufferSync(){return Fe.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return q(this.shape,t,"complex64"===this.dtype)}arraySync(){return q(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const t=De().read(this.dataId);if("string"===this.dtype){const e=await t;try{return e.map((t=>Ee(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),De().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=De().readSync(this.dataId);if("string"===this.dtype)try{return t.map((t=>Ee(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await De().read(this.dataId);return"string"===this.dtype?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(De().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return Fe.print(this,t)}clone(){return this.throwIfDisposed(),Fe.clone(this)}toString(t=!1){return Ae(this.dataSync(),this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),Fe.cast(this,t)}variable(t=!0,e,n){return this.throwIfDisposed(),De().makeVariable(this,t,e,n)}}Object.defineProperty(Le,Symbol.hasInstance,{value:t=>!!t&&null!=t.data&&null!=t.dataSync&&null!=t.throwIfDisposed}),At("Tensor",(()=>Le));class Pe extends Le{constructor(t,e,n,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=e,this.name=n}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!_(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);De().disposeTensor(this),this.dataId=t.dataId,De().incRef(this,null)}dispose(){De().disposeVariable(this),this.isDisposedInternal=!0}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var Be,Ve,ze,We,Ue;Object.defineProperty(Pe,Symbol.hasInstance,{value:t=>t instanceof Le&&null!=t.assign&&t.assign instanceof Function}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(Be||(Be={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(Ve||(Ve={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(ze||(ze={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(We||(We={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(Ue||(Ue={}));const je={float32:We,int32:Ve,bool:ze,complex64:Ue};function Ge(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return je[t][e]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function qe(t,e){if(t.dtype===e.dtype)return[t,e];const n=Ge(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function He(t,e){x(t.dtype===e.dtype,(()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`))}function Ke(t){const e=[];return Xe(t,e,new Set),e}function Xe(t,e,n){if(null==t)return;if(t instanceof Le)return void e.push(t);if(r=t,!Array.isArray(r)&&"object"!=typeof r)return;var r;const s=t;for(const t in s){const r=s[t];n.has(r)||(n.add(r),Xe(r,e,n))}}var Je=Object.freeze({__proto__:null,makeTypesMatch:qe,assertTypesMatch:He,isTensorInList:function(t,e){return e.some((e=>e.id===t.id))},getTensorsInContainer:Ke});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ye(t){return null!=t.kernelName}class Ze{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((t=>t.name))))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class Qe{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Ze}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;{const{asyncInit:e}=this.initializeBackend(t);if(e)return null}}return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,n=1){return t in this.registryFactory?(Ct(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:n},!0)}async setBackend(t){if(null==this.registryFactory[t])throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,null==this.registry[t]){this.backendInstance=null;const{success:e,asyncInit:n}=this.initializeBackend(t);if(!(n?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new _e(this.backendInstance),!0}setupRegisteredKernels(){Dt(this.backendName).forEach((t=>{null!=t.setupFunc&&t.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(t){Dt(t).forEach((e=>{null!=e.disposeFunc&&e.disposeFunc(this.registry[t])}))}initializeBackend(t){const e=this.registryFactory[t];if(null==e)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const n=e.factory();if(!n||n instanceof y||"function"!=typeof n.then)return this.registry[t]=n,{success:!0,asyncInit:!1};{const e=++this.pendingBackendInitId,r=n.then((n=>!(e<this.pendingBackendInitId)&&(this.registry[t]=n,this.pendingBackendInit=null,!0))).catch((n=>(e<this.pendingBackendInitId||(this.pendingBackendInit=null,Ct(`Initialization of backend ${t} failed`),Ct(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(e){return Ct(`Initialization of backend ${t} failed`),Ct(e.stack||e.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority))}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e],{success:r,asyncInit:s}=this.initializeBackend(n);if(s||r)return{name:n,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const n=this.state.tensorInfo.get(e),r=n.backend,s=this.readSync(e),o=r.refCount(e);r.disposeData(e,!0),n.backend=t,t.move(e,s,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let n,r=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=e(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(t,e,n){t();try{const t=n();return e(),t}catch(t){throw e(),t}}nextTensorId(){return Qe.nextTensorId++}nextVariableId(){return Qe.nextVariableId++}clone(t){const e=en.runKernel("Identity",{x:t}),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(t=>({x:()=>{const e={x:t},n={dtype:"float32"};return en.runKernel("Cast",e,n)}})),[],{}),e}runKernel(t,e,n){null==this.backendName&&this.backend;if(!(null!=Mt(t,this.backendName)))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,n){const r=this.backend.numDataIds();let s=0;n.forEach((t=>{s+="complex64"===t.dtype?3:1}));const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=r-e-s-o;if(i>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${i} data ids) after running '${t}'`)}runKernelFunc(t){let e,n=[];const r=this.isTapeOn(),s=this.state.numBytes,o=this.state.numTensors;let i,a;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const u=Ye(t)?t.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(Ye(t)){const{kernelName:e,inputs:s,attrs:o}=t;null==this.backendName&&this.backend;const u=Mt(e,this.backendName);x(null!=u,(()=>`Cannot find registered kernel '${e}' for backend '${this.backendName}'`)),i=()=>{const t=this.backend.numDataIds();a=u.kernelFunc({inputs:s,attrs:o,backend:this.backend});const i=Array.isArray(a)?a:[a];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(e,t,i);const c=i.map((t=>null!=t.rank?t:this.makeTensorFromTensorInfo(t)));if(r){const t=this.getTensorsForGradient(e,s,c);n=this.saveTensorsForBackwardMode(t)}return c}}else{const{forwardFunc:e}=t,s=t=>{r&&(n=t.map((t=>this.keep(this.clone(t)))))};i=()=>{const t=this.backend.numDataIds();a=this.tidy((()=>e(this.backend,s)));const n=Array.isArray(a)?a:[a];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,t,n),n}}const{inputs:c,attrs:l}=t,f=Ye(t)?null:t.backwardsFunc;let h;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(h=this.profiler.profileKernel(u,c,(()=>i())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(h),e=h.outputs):e=i()})),r&&this.addTapeNode(u,c,e,f,n,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map((t=>null!=c[t]?c[t].shape:null)),outputShapes:e.map((t=>t.shape)),kernelTimeMs:h.timeMs,extraInfo:h.extraInfo}),Array.isArray(a)?e:e[0]}saveTensorsForBackwardMode(t){const e=t.map((t=>this.keep(this.clone(t))));return e}getTensorsForGradient(t,e,n){const r=Rt(t);if(null!=r){const t=r.inputsToSave||[],s=r.outputsToSave||[];let o;r.saveAllInputs?(x(Array.isArray(e),(()=>"saveAllInputs is true, expected inputs to be an array.")),o=Object.keys(e).map((t=>e[t]))):o=t.map((t=>e[t]));const i=n.filter(((t,e)=>s[e]));return o.concat(i)}return[]}makeTensor(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let s=t;"string"===n&&P(t[0])&&(s=t.map((t=>$e(t))));const o=r.write(s,e,n),i=new Le(e,n,o,this.nextTensorId());if(this.trackTensor(i,r),"string"===n){const t=this.state.tensorInfo.get(o),e=L(s);this.state.numBytes+=e-t.bytes,t.bytes=e}return i}makeTensorFromDataId(t,e,n,r){const s={dataId:t,shape:e,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(s,r)}makeTensorFromTensorInfo(t,e){const{dataId:n,shape:r,dtype:s}=t,o=new Le(r,s,n,this.nextTensorId());return this.trackTensor(o,e),o}makeVariable(t,e=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.cast(r));const s=new Pe(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[s.name])throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(t,e){this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*F(t.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n})),t instanceof Pe||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,"string"===t.dtype&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),"complex64"!==t.dtype&&"string"!==t.dtype){const e=t.size*F(t.dtype);this.state.numBytes-=e}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((t=>t.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const t of this.state.activeProfile.kernels)t.kernelTimeMs=await t.kernelTimeMs,t.extraInfo=await t.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(t,e,n,r,s,o){const i={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:s},a=Rt(t);null!=a&&(r=a.gradFunc),null!=r&&(i.gradient=t=>(t=t.map(((t,e)=>{if(null==t){const t=n[e],r=K(t.size,t.dtype);return this.makeTensor(r,t.shape,t.dtype)}return t})),r(t.length>1?t:t[0],s,o))),this.state.activeTape.push(i)}keep(t){return t.kept=!0,t}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=Ke(t),n=new Set(e.map((t=>t.id)));for(let t=0;t<this.state.activeScope.track.length;t++){const e=this.state.activeScope.track[t];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach((t=>{t.kept||t.scopeId!==r.id||this.track(t)}))}gradients(t,e,n,r=!1){if(x(e.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const s=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",t)));x(s instanceof Le,(()=>"The result y returned by f() must be a tensor."));const o=function(t,e,n){const r={},s={};for(let t=0;t<e.length;t++)r[e[t].id]=!0;for(let n=0;n<t.length;n++){const o=t[n],i=o.inputs;for(const t in i){const n=i[t];let a=!1;for(let t=0;t<e.length;t++)if(r[n.id]){o.outputs.forEach((t=>r[t.id]=!0)),a=!0,s[o.id]=!0;break}if(a)break}}const o={};o[n.id]=!0;const i={};for(let e=t.length-1;e>=0;e--){const n=t[e],r=n.inputs;for(let t=0;t<n.outputs.length;t++)if(o[n.outputs[t].id]){for(const t in r)o[r[t].id]=!0,i[n.id]=!0;break}}const a=[];for(let e=0;e<t.length;e++){const n=t[e];if(s[n.id]&&i[n.id]){const t={};for(const e in n.inputs){const s=n.inputs[e];r[s.id]&&(t[e]=s)}const e=Object.assign({},n);e.inputs=t,e.outputs=n.outputs,a.push(e)}}return a}(this.state.activeTape,e,s);if(!r&&0===o.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const t={};t[s.id]=null==n?function(t){const e=H(S(t),"float32");return en.makeTensor(e,t,"float32")}(s.shape):n,function(t,e,n,r){for(let s=e.length-1;s>=0;s--){const o=e[s],i=[];if(o.outputs.forEach((e=>{const n=t[e.id];null!=n?i.push(n):i.push(null)})),null==o.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const e in o.inputs){if(!(e in a))throw new Error(`Cannot backprop through input ${e}. Available gradients found: ${Object.keys(a)}.`);const s=n((()=>a[e]()));if("float32"!==s.dtype)throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${e} must have 'float32' dtype, but has '${s.dtype}'`);const i=o.inputs[e];if(!_(s.shape,i.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${e}' has shape '${s.shape}', which does not match the shape of the input '${i.shape}'`);if(null==t[i.id])t[i.id]=s;else{const e=t[i.id];t[i.id]=r(e,s),e.dispose()}}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,o,(t=>this.tidy(t)),nn);const r=e.map((e=>t[e.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((t=>{for(const e of t.saved)e.dispose()})),this.state.activeTape=null),{value:s,grads:r}}))}customGrad(t){return x(W(t),(()=>"The f passed in customGrad(f) must be a function.")),(...e)=>{let n;x(e.every((t=>t instanceof Le)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};e.forEach(((t,e)=>{r[e]=t}));return this.runKernelFunc({forwardFunc:(r,s)=>(n=t(...e,s),x(n.value instanceof Le,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),x(W(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(t,r)=>{const s=n.gradFunc(t,r),o=Array.isArray(s)?s:[s];x(o.length===e.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),x(o.every((t=>t instanceof Le)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const i={};return o.forEach(((t,e)=>{i[e]=()=>t})),i},inputs:r})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)}async time(t){const e=Ne(),n=await this.backend.time(t);return n.wallMs=Ne()-e,n}track(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Ze;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function tn(){const t=kt();if(null==t._tfengine){const e=new Y(t);t._tfengine=new Qe(e)}var e;return e=t._tfengine.ENV,tt=e,De=()=>t._tfengine,t._tfengine}Qe.nextTensorId=0,Qe.nextVariableId=0;const en=tn();function nn(t,e){const n={a:t,b:e};return en.runKernel("Add",n)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let rn;function sn(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var on=Object.freeze({__proto__:null,mockIsMobile:function(t){rn=t},isMobile:function(t){if(void 0!==rn)return rn;if(t||"undefined"!=typeof navigator&&null!=navigator){if(t||(t=navigator),"ReactNative"===t.product)return!0;const e=t.userAgent||t.vendor||("undefined"!=typeof window?window.opera:"");if(!e){const e=t;return e.userAgentData&&e.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1},isBrowser:sn});const an=Q();an.registerFlag("DEBUG",(()=>!1),(t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),an.registerFlag("IS_BROWSER",(()=>sn())),an.registerFlag("IS_NODE",(()=>void 0!==_t&&void 0!==_t.versions&&void 0!==_t.versions.node)),an.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),an.registerFlag("PROD",(()=>!1)),an.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>an.getBool("DEBUG"))),an.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),an.registerFlag("IS_TEST",(()=>!1)),an.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>!0)),an.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),an.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));var un=[],cn=[],ln="undefined"!=typeof Uint8Array?Uint8Array:Array,fn=!1;function hn(){fn=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,n=t.length;e<n;++e)un[e]=t[e],cn[t.charCodeAt(e)]=e;cn["-".charCodeAt(0)]=62,cn["_".charCodeAt(0)]=63}function pn(t,e,n){for(var r,s,o=[],i=e;i<n;i+=3)r=(t[i]<<16)+(t[i+1]<<8)+t[i+2],o.push(un[(s=r)>>18&63]+un[s>>12&63]+un[s>>6&63]+un[63&s]);return o.join("")}function dn(t){var e;fn||hn();for(var n=t.length,r=n%3,s="",o=[],i=16383,a=0,u=n-r;a<u;a+=i)o.push(pn(t,a,a+i>u?u:a+i));return 1===r?(e=t[n-1],s+=un[e>>2],s+=un[e<<4&63],s+="=="):2===r&&(e=(t[n-2]<<8)+t[n-1],s+=un[e>>10],s+=un[e>>4&63],s+=un[e<<2&63],s+="="),o.push(s),o.join("")}function mn(t,e,n,r,s){var o,i,a=8*s-r-1,u=(1<<a)-1,c=u>>1,l=-7,f=n?s-1:0,h=n?-1:1,p=t[e+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+t[e+f],f+=h,l-=8);for(i=o&(1<<-l)-1,o>>=-l,l+=r;l>0;i=256*i+t[e+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return i?NaN:1/0*(p?-1:1);i+=Math.pow(2,r),o-=c}return(p?-1:1)*i*Math.pow(2,o-r)}function yn(t,e,n,r,s,o){var i,a,u,c=8*o-s-1,l=(1<<c)-1,f=l>>1,h=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,i=l):(i=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-i))<1&&(i--,u*=2),(e+=i+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(i++,u/=2),i+f>=l?(a=0,i=l):i+f>=1?(a=(e*u-1)*Math.pow(2,s),i+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,s),i=0));s>=8;t[n+p]=255&a,p+=d,a/=256,s-=8);for(i=i<<s|a,c+=s;c>0;t[n+p]=255&i,p+=d,i/=256,c-=8);t[n+p-d]|=128*m}var gn={}.toString,bn=Array.isArray||function(t){return"[object Array]"==gn.call(t)};function wn(){return xn.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function vn(t,e){if(wn()<e)throw new RangeError("Invalid typed array length");return xn.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=xn.prototype:(null===t&&(t=new xn(e)),t.length=e),t}function xn(t,e,n){if(!(xn.TYPED_ARRAY_SUPPORT||this instanceof xn))return new xn(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return En(this,t)}return Nn(this,t,e,n)}function Nn(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);xn.TYPED_ARRAY_SUPPORT?(t=e).__proto__=xn.prototype:t=Sn(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!xn.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|kn(e,n),s=(t=vn(t,r)).write(e,n);s!==r&&(t=t.slice(0,s));return t}(t,e,n):function(t,e){if(Tn(e)){var n=0|_n(e.length);return 0===(t=vn(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?vn(t,0):Sn(t,e);if("Buffer"===e.type&&bn(e.data))return Sn(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function $n(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function En(t,e){if($n(e),t=vn(t,e<0?0:0|_n(e)),!xn.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function Sn(t,e){var n=e.length<0?0:0|_n(e.length);t=vn(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function _n(t){if(t>=wn())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+wn().toString(16)+" bytes");return 0|t}function Tn(t){return!(null==t||!t._isBuffer)}function kn(t,e){if(Tn(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return tr(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return er(t).length;default:if(r)return tr(t).length;e=(""+e).toLowerCase(),r=!0}}function An(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return Un(this,e,n);case"utf8":case"utf-8":return Vn(this,e,n);case"ascii":return zn(this,e,n);case"latin1":case"binary":return Wn(this,e,n);case"base64":return Bn(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return jn(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function Cn(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function On(t,e,n,r,s){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=s?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(s)return-1;n=t.length-1}else if(n<0){if(!s)return-1;n=0}if("string"==typeof e&&(e=xn.from(e,r)),Tn(e))return 0===e.length?-1:In(t,e,n,r,s);if("number"==typeof e)return e&=255,xn.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):In(t,[e],n,r,s);throw new TypeError("val must be string, number or Buffer")}function In(t,e,n,r,s){var o,i=1,a=t.length,u=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;i=2,a/=2,u/=2,n/=2}function c(t,e){return 1===i?t[e]:t.readUInt16BE(e*i)}if(s){var l=-1;for(o=n;o<a;o++)if(c(t,o)===c(e,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*i}else-1!==l&&(o-=o-l),l=-1}else for(n+u>a&&(n=a-u),o=n;o>=0;o--){for(var f=!0,h=0;h<u;h++)if(c(t,o+h)!==c(e,h)){f=!1;break}if(f)return o}return-1}function Mn(t,e,n,r){n=Number(n)||0;var s=t.length-n;r?(r=Number(r))>s&&(r=s):r=s;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var i=0;i<r;++i){var a=parseInt(e.substr(2*i,2),16);if(isNaN(a))return i;t[n+i]=a}return i}function Rn(t,e,n,r){return nr(tr(e,t.length-n),t,n,r)}function Dn(t,e,n,r){return nr(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function Fn(t,e,n,r){return Dn(t,e,n,r)}function Ln(t,e,n,r){return nr(er(e),t,n,r)}function Pn(t,e,n,r){return nr(function(t,e){for(var n,r,s,o=[],i=0;i<t.length&&!((e-=2)<0);++i)r=(n=t.charCodeAt(i))>>8,s=n%256,o.push(s),o.push(r);return o}(e,t.length-n),t,n,r)}function Bn(t,e,n){return 0===e&&n===t.length?dn(t):dn(t.slice(e,n))}function Vn(t,e,n){n=Math.min(t.length,n);for(var r=[],s=e;s<n;){var o,i,a,u,c=t[s],l=null,f=c>239?4:c>223?3:c>191?2:1;if(s+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=t[s+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=t[s+1],i=t[s+2],128==(192&o)&&128==(192&i)&&(u=(15&c)<<12|(63&o)<<6|63&i)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=t[s+1],i=t[s+2],a=t[s+3],128==(192&o)&&128==(192&i)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&i)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),s+=f}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=4096));return n}(r)}xn.TYPED_ARRAY_SUPPORT=void 0===et.TYPED_ARRAY_SUPPORT||et.TYPED_ARRAY_SUPPORT,wn(),xn.poolSize=8192,xn._augment=function(t){return t.__proto__=xn.prototype,t},xn.from=function(t,e,n){return Nn(null,t,e,n)},xn.TYPED_ARRAY_SUPPORT&&(xn.prototype.__proto__=Uint8Array.prototype,xn.__proto__=Uint8Array),xn.alloc=function(t,e,n){return function(t,e,n,r){return $n(e),e<=0?vn(t,e):void 0!==n?"string"==typeof r?vn(t,e).fill(n,r):vn(t,e).fill(n):vn(t,e)}(null,t,e,n)},xn.allocUnsafe=function(t){return En(null,t)},xn.allocUnsafeSlow=function(t){return En(null,t)},xn.isBuffer=function(t){return null!=t&&(!!t._isBuffer||rr(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&rr(t.slice(0,0))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t))},xn.compare=function(t,e){if(!Tn(t)||!Tn(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,s=0,o=Math.min(n,r);s<o;++s)if(t[s]!==e[s]){n=t[s],r=e[s];break}return n<r?-1:r<n?1:0},xn.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},xn.concat=function(t,e){if(!bn(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return xn.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=xn.allocUnsafe(e),s=0;for(n=0;n<t.length;++n){var o=t[n];if(!Tn(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,s),s+=o.length}return r},xn.byteLength=kn,xn.prototype._isBuffer=!0,xn.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)Cn(this,e,e+1);return this},xn.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)Cn(this,e,e+3),Cn(this,e+1,e+2);return this},xn.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)Cn(this,e,e+7),Cn(this,e+1,e+6),Cn(this,e+2,e+5),Cn(this,e+3,e+4);return this},xn.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?Vn(this,0,t):An.apply(this,arguments)},xn.prototype.equals=function(t){if(!Tn(t))throw new TypeError("Argument must be a Buffer");return this===t||0===xn.compare(this,t)},xn.prototype.inspect=function(){var t="";return this.length>0&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(t+=" ... ")),"<Buffer "+t+">"},xn.prototype.compare=function(t,e,n,r,s){if(!Tn(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===s&&(s=this.length),e<0||n>t.length||r<0||s>this.length)throw new RangeError("out of range index");if(r>=s&&e>=n)return 0;if(r>=s)return-1;if(e>=n)return 1;if(this===t)return 0;for(var o=(s>>>=0)-(r>>>=0),i=(n>>>=0)-(e>>>=0),a=Math.min(o,i),u=this.slice(r,s),c=t.slice(e,n),l=0;l<a;++l)if(u[l]!==c[l]){o=u[l],i=c[l];break}return o<i?-1:i<o?1:0},xn.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},xn.prototype.indexOf=function(t,e,n){return On(this,t,e,n,!0)},xn.prototype.lastIndexOf=function(t,e,n){return On(this,t,e,n,!1)},xn.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var s=this.length-e;if((void 0===n||n>s)&&(n=s),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return Mn(this,t,e,n);case"utf8":case"utf-8":return Rn(this,t,e,n);case"ascii":return Dn(this,t,e,n);case"latin1":case"binary":return Fn(this,t,e,n);case"base64":return Ln(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Pn(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},xn.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function zn(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(127&t[s]);return r}function Wn(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(t[s]);return r}function Un(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var s="",o=e;o<n;++o)s+=Qn(t[o]);return s}function jn(t,e,n){for(var r=t.slice(e,n),s="",o=0;o<r.length;o+=2)s+=String.fromCharCode(r[o]+256*r[o+1]);return s}function Gn(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function qn(t,e,n,r,s,o){if(!Tn(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function Hn(t,e,n,r){e<0&&(e=65535+e+1);for(var s=0,o=Math.min(t.length-n,2);s<o;++s)t[n+s]=(e&255<<8*(r?s:1-s))>>>8*(r?s:1-s)}function Kn(t,e,n,r){e<0&&(e=4294967295+e+1);for(var s=0,o=Math.min(t.length-n,4);s<o;++s)t[n+s]=e>>>8*(r?s:3-s)&255}function Xn(t,e,n,r,s,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function Jn(t,e,n,r,s){return s||Xn(t,0,n,4),yn(t,e,n,r,23,4),n+4}function Yn(t,e,n,r,s){return s||Xn(t,0,n,8),yn(t,e,n,r,52,8),n+8}xn.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),xn.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=xn.prototype;else{var s=e-t;n=new xn(s,void 0);for(var o=0;o<s;++o)n[o]=this[o+t]}return n},xn.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||Gn(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r},xn.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||Gn(t,e,this.length);for(var r=this[t+--e],s=1;e>0&&(s*=256);)r+=this[t+--e]*s;return r},xn.prototype.readUInt8=function(t,e){return e||Gn(t,1,this.length),this[t]},xn.prototype.readUInt16LE=function(t,e){return e||Gn(t,2,this.length),this[t]|this[t+1]<<8},xn.prototype.readUInt16BE=function(t,e){return e||Gn(t,2,this.length),this[t]<<8|this[t+1]},xn.prototype.readUInt32LE=function(t,e){return e||Gn(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},xn.prototype.readUInt32BE=function(t,e){return e||Gn(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},xn.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||Gn(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r>=(s*=128)&&(r-=Math.pow(2,8*e)),r},xn.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||Gn(t,e,this.length);for(var r=e,s=1,o=this[t+--r];r>0&&(s*=256);)o+=this[t+--r]*s;return o>=(s*=128)&&(o-=Math.pow(2,8*e)),o},xn.prototype.readInt8=function(t,e){return e||Gn(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},xn.prototype.readInt16LE=function(t,e){e||Gn(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},xn.prototype.readInt16BE=function(t,e){e||Gn(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},xn.prototype.readInt32LE=function(t,e){return e||Gn(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},xn.prototype.readInt32BE=function(t,e){return e||Gn(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},xn.prototype.readFloatLE=function(t,e){return e||Gn(t,4,this.length),mn(this,t,!0,23,4)},xn.prototype.readFloatBE=function(t,e){return e||Gn(t,4,this.length),mn(this,t,!1,23,4)},xn.prototype.readDoubleLE=function(t,e){return e||Gn(t,8,this.length),mn(this,t,!0,52,8)},xn.prototype.readDoubleBE=function(t,e){return e||Gn(t,8,this.length),mn(this,t,!1,52,8)},xn.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||qn(this,t,e,n,Math.pow(2,8*n)-1,0);var s=1,o=0;for(this[e]=255&t;++o<n&&(s*=256);)this[e+o]=t/s&255;return e+n},xn.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||qn(this,t,e,n,Math.pow(2,8*n)-1,0);var s=n-1,o=1;for(this[e+s]=255&t;--s>=0&&(o*=256);)this[e+s]=t/o&255;return e+n},xn.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||qn(this,t,e,1,255,0),xn.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},xn.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||qn(this,t,e,2,65535,0),xn.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):Hn(this,t,e,!0),e+2},xn.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||qn(this,t,e,2,65535,0),xn.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):Hn(this,t,e,!1),e+2},xn.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||qn(this,t,e,4,4294967295,0),xn.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):Kn(this,t,e,!0),e+4},xn.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||qn(this,t,e,4,4294967295,0),xn.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Kn(this,t,e,!1),e+4},xn.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);qn(this,t,e,n,s-1,-s)}var o=0,i=1,a=0;for(this[e]=255&t;++o<n&&(i*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},xn.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);qn(this,t,e,n,s-1,-s)}var o=n-1,i=1,a=0;for(this[e+o]=255&t;--o>=0&&(i*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},xn.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||qn(this,t,e,1,127,-128),xn.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},xn.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||qn(this,t,e,2,32767,-32768),xn.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):Hn(this,t,e,!0),e+2},xn.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||qn(this,t,e,2,32767,-32768),xn.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):Hn(this,t,e,!1),e+2},xn.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||qn(this,t,e,4,2147483647,-2147483648),xn.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):Kn(this,t,e,!0),e+4},xn.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||qn(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),xn.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Kn(this,t,e,!1),e+4},xn.prototype.writeFloatLE=function(t,e,n){return Jn(this,t,e,!0,n)},xn.prototype.writeFloatBE=function(t,e,n){return Jn(this,t,e,!1,n)},xn.prototype.writeDoubleLE=function(t,e,n){return Yn(this,t,e,!0,n)},xn.prototype.writeDoubleBE=function(t,e,n){return Yn(this,t,e,!1,n)},xn.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var s,o=r-n;if(this===t&&n<e&&e<r)for(s=o-1;s>=0;--s)t[s+e]=this[s+n];else if(o<1e3||!xn.TYPED_ARRAY_SUPPORT)for(s=0;s<o;++s)t[s+e]=this[s+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},xn.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var s=t.charCodeAt(0);s<256&&(t=s)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!xn.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var i=Tn(t)?t:tr(new xn(t,r).toString()),a=i.length;for(o=0;o<n-e;++o)this[o+e]=i[o%a]}return this};var Zn=/[^+\/0-9A-Za-z-_]/g;function Qn(t){return t<16?"0"+t.toString(16):t.toString(16)}function tr(t,e){var n;e=e||1/0;for(var r=t.length,s=null,o=[],i=0;i<r;++i){if((n=t.charCodeAt(i))>55295&&n<57344){if(!s){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(i+1===r){(e-=3)>-1&&o.push(239,191,189);continue}s=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),s=n;continue}n=65536+(s-55296<<10|n-56320)}else s&&(e-=3)>-1&&o.push(239,191,189);if(s=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function er(t){return function(t){var e,n,r,s,o,i;fn||hn();var a=t.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===t[a-2]?2:"="===t[a-1]?1:0,i=new ln(3*a/4-o),r=o>0?a-4:a;var u=0;for(e=0,n=0;e<r;e+=4,n+=3)s=cn[t.charCodeAt(e)]<<18|cn[t.charCodeAt(e+1)]<<12|cn[t.charCodeAt(e+2)]<<6|cn[t.charCodeAt(e+3)],i[u++]=s>>16&255,i[u++]=s>>8&255,i[u++]=255&s;return 2===o?(s=cn[t.charCodeAt(e)]<<2|cn[t.charCodeAt(e+1)]>>4,i[u++]=255&s):1===o&&(s=cn[t.charCodeAt(e)]<<10|cn[t.charCodeAt(e+1)]<<4|cn[t.charCodeAt(e+2)]>>2,i[u++]=s>>8&255,i[u++]=255&s),i}(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(Zn,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function nr(t,e,n,r){for(var s=0;s<r&&!(s+n>=e.length||s>=t.length);++s)e[s+n]=t[s];return s}function rr(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function sr(t,e){let n=t;if(D(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||D(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&Q().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&or(t,r,[]),r}function or(t,e,n){if(n=n||[],!Array.isArray(t)&&!D(t))return void x(0===e.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`));x(e.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`)),x(t.length===e[0],(()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`));const r=e.slice(1);for(let e=0;e<t.length;++e)or(t[e],r,n.concat(e))}function ir(t,e,n,r){if("string_or_numeric"!==t){if(null==t)throw new Error("Expected dtype cannot be null.");if("numeric"!==t&&t!==e||"numeric"===t&&"string"===e)throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}}function ar(t,e,n,r="numeric"){if(t instanceof Le)return ir(r,t.dtype,e,n),t;let s=z(t);if("string"!==s&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),ir(r,s,e,n),null==t||!D(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){const r=null==t?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const o=sr(t,s);D(t)||Array.isArray(t)||(t=[t]);const i="string"!==s?xe(t,s):E(t,[],!0);return en.makeTensor(i,o,s)}function ur(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map(((t,s)=>ar(t,`${e}[${s}]`,n,r)))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cr(t){const e=Object.keys(t);if(1!==e.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const s=(...t)=>{en.startScope(n);try{const e=r(...t);return J(e)&&console.error("Cannot return a Promise inside of tidy."),en.endScope(e),e}catch(t){throw en.endScope(null),t}};return Object.defineProperty(s,"name",{value:n,configurable:!0}),s}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lr=cr({complex_:function(t,e){const n=ar(t,"real","complex"),r=ar(e,"imag","complex");N(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const s={real:n,imag:r};return en.runKernel("Complex",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fr(t,e,n,r){if(null==r&&(r=z(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!D(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){X(e);const t=S(e),r=S(n);x(t===r,(()=>`Based on the provided shape, [${e}], the tensor should have ${t} values but has ${r}`));for(let t=0;t<n.length;++t){const r=n[t],s=t!==n.length-1||r!==S(e.slice(t));x(n[t]===e[t]||!s,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `))}}return D(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?xe(t,r):E(t,[],!0),en.makeTensor(t,e,r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hr(t,e,n){return fr(t,e,sr(t,n),n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pr={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};function dr(t,e){const n={};let r,s=0;for(const o of e){const e=o.name,i=o.dtype,a=o.shape,u=S(a);let c;if("quantization"in o){const n=o.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error(`Weight ${o.name} with quantization ${n.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==n.dtype)throw new Error(`Weight ${o.name} has unknown quantization dtype ${n.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==i)throw new Error(`Weight ${o.name} is quantized with ${n.dtype} which only supports weights of type float32 not ${i}.`)}const a=pr[n.dtype],l=t.slice(s,s+u*a),f="uint8"===n.dtype?new Uint8Array(l):new Uint16Array(l);if("float32"===i)if("uint8"===n.dtype||"uint16"===n.dtype){c=new Float32Array(f.length);for(let t=0;t<f.length;t++){const e=f[t];c[t]=e*n.scale+n.min}}else{if("float16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type float32.`);void 0===r&&(r=$r()),c=r(f)}else{if("int32"!==i)throw new Error(`Unsupported dtype in weight '${e}': ${i}`);if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type int32.`);c=new Int32Array(f.length);for(let t=0;t<f.length;t++){const e=f[t];c[t]=Math.round(e*n.scale+n.min)}}s+=u*a}else if("string"===i){const e=S(o.shape);c=[];for(let n=0;n<e;n++){const e=new Uint32Array(t.slice(s,s+4))[0];s+=4;const n=new Uint8Array(t.slice(s,s+e));c.push(n),s+=e}}else{const r=pr[i],o=t.slice(s,s+u*r);if("float32"===i)c=new Float32Array(o);else if("int32"===i)c=new Int32Array(o);else if("bool"===i)c=new Uint8Array(o);else{if("complex64"!==i)throw new Error(`Unsupported dtype in weight '${e}': ${i}`);{c=new Float32Array(o);const t=new Float32Array(c.length/2),r=new Float32Array(c.length/2);for(let e=0;e<t.length;e++)t[e]=c[2*e],r[e]=c[2*e+1];const s=hr(t,a,"float32"),i=hr(r,a,"float32");n[e]=lr(s,i),s.dispose(),i.dispose()}}s+=u*r}"complex64"!==i&&(n[e]=hr(c,a,i))}return n}function mr(t){if(null===t)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach((t=>{if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${t.constructor.name}`)}));const r=new Uint8Array(e);let s=0;return n.forEach((t=>{r.set(new Uint8Array(t.buffer),s),s+=t.byteLength})),r.buffer}const yr="undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa;function gr(t){return yr?xn.byteLength(t):new Blob([t]).size}function br(t){if(1===t.length)return t[0];let e=0;t.forEach((t=>{e+=t.byteLength}));const n=new Uint8Array(e);let r=0;return t.forEach((t=>{n.set(new Uint8Array(t),r),r+=t.byteLength})),n.buffer}function wr(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);const e=t.split("/");return e[e.length-1]}function vr(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),n}async function xr(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),null!=t.weightsManifest){const[r,s]=await e(t.weightsManifest);n.weightSpecs=r,n.weightData=s}return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),n}function Nr(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:gr(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:gr(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}function $r(){const t=function(){const t=t=>{let e=t<<13,n=0;for(;0==(8388608&e);)n-=8388608,e<<=1;return e&=-8388609,n+=947912704,e|n},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}(),e=function(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}(),n=function(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}();return r=>{const s=new ArrayBuffer(4*r.length),o=new Uint32Array(s);for(let s=0;s<r.length;s++){const i=r[s],a=t[n[i>>10]+(1023&i)]+e[i>>10];o[s]=a}return new Float32Array(s)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Er{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==Er.instance&&(Er.instance=new Er),Er.instance}static registerSaveRouter(t){Er.getInstance().saveRouters.push(t)}static registerLoadRouter(t){Er.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return Er.getHandlers(t,"save")}static getLoadHandlers(t,e){return Er.getHandlers(t,"load",e)}static getHandlers(t,e,n){const r=[];return("load"===e?Er.getInstance().loadRouters:Er.getInstance().saveRouters).forEach((e=>{const s=e(t,n);null!==s&&r.push(s)})),r}}const Sr=t=>Er.getSaveHandlers(t),_r=(t,e)=>Er.getLoadHandlers(t,e)
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */;function Tr(){if(!Q().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t="undefined"==typeof window?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function kr(t){const e=t.result;e.createObjectStore("models_store",{keyPath:"modelPath"}),e.createObjectStore("model_info_store",{keyPath:"modelPath"})}class Ar{constructor(t){if(this.indexedDB=Tr(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise(((t,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>kr(r),r.onsuccess=()=>{const s=r.result;if(null==e){const e=s.transaction("models_store","readonly"),r=e.objectStore("models_store").get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return s.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));t(r.result.modelArtifacts)},r.onerror=t=>(s.close(),n(r.error)),e.oncomplete=()=>s.close()}else{const r=Nr(e),o=s.transaction("model_info_store","readwrite");let i=o.objectStore("model_info_store");const a=i.put({modelPath:this.modelPath,modelArtifactsInfo:r});let u;a.onsuccess=()=>{u=s.transaction("models_store","readwrite");const a=u.objectStore("models_store").put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:r});a.onsuccess=()=>t({modelArtifactsInfo:r}),a.onerror=t=>{i=o.objectStore("model_info_store");const e=i.delete(this.modelPath);e.onsuccess=()=>(s.close(),n(a.error)),e.onerror=t=>(s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}}},r.onerror=t=>n(r.error)}))}}Ar.URL_SCHEME="indexeddb://";const Cr=t=>{return Q().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Ar.URL_SCHEME)?(e=t.slice(Ar.URL_SCHEME.length),new Ar(e)):null;var e};Er.registerSaveRouter(Cr),Er.registerLoadRouter(Cr);class Or{constructor(){this.indexedDB=Tr()}async listModels(){return new Promise(((t,e)=>{const n=this.indexedDB.open("tensorflowjs",1);n.onupgradeneeded=()=>kr(n),n.onsuccess=()=>{const r=n.result,s=r.transaction("model_info_store","readonly"),o=s.objectStore("model_info_store").getAll();o.onsuccess=()=>{const e={};for(const t of o.result)e[t.modelPath]=t.modelArtifactsInfo;t(e)},o.onerror=t=>(r.close(),e(o.error)),s.oncomplete=()=>r.close()},n.onerror=t=>e(n.error)}))}async removeModel(t){var e;return t=(e=t).startsWith(Ar.URL_SCHEME)?e.slice(Ar.URL_SCHEME.length):e,new Promise(((e,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>kr(r),r.onsuccess=()=>{const s=r.result,o=s.transaction("model_info_store","readwrite"),i=o.objectStore("model_info_store"),a=i.get(t);let u;a.onsuccess=()=>{if(null==a.result)return s.close(),n(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const r=i.delete(t),o=()=>{u=s.transaction("models_store","readwrite");const r=u.objectStore("models_store").delete(t);r.onsuccess=()=>e(a.result.modelArtifactsInfo),r.onerror=t=>n(a.error)};r.onsuccess=o,r.onerror=t=>(o(),s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}},r.onerror=t=>n(r.error)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ir="tensorflowjs_models",Mr="info",Rr="model_topology",Dr="weight_specs",Fr="weight_data",Lr="model_metadata";function Pr(t){return{info:[Ir,t,Mr].join("/"),topology:[Ir,t,Rr].join("/"),weightSpecs:[Ir,t,Dr].join("/"),weightData:[Ir,t,Fr].join("/"),modelMetadata:[Ir,t,Lr].join("/")}}function Br(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function Vr(t){const e=t.split("/");if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join("/")}class zr{constructor(t){if(!Q().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Pr(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=Nr(t);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(yr)return xn.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let t=0,r=e.length;t<r;t++)n+=String.fromCharCode(e[t]);return btoa(n)}(t.weightData));const s={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:r}}catch(t){throw Br(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(null==t)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=r;const s=this.LS.getItem(this.keys.modelMetadata);if(null!=s){const t=JSON.parse(s);e.format=t.format,e.generatedBy=t.generatedBy,e.convertedBy=t.convertedBy,null!=t.signature&&(e.signature=t.signature),null!=t.userDefinedMetadata&&(e.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(e.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(e.trainingConfig=t.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(null==o)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=function(t){if(yr){const e=xn.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;++t)n.set([e.charCodeAt(t)],t);return n.buffer}(o),e}}zr.URL_SCHEME="localstorage://";const Wr=t=>{return Q().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(zr.URL_SCHEME)?(e=t.slice(zr.URL_SCHEME.length),new zr(e)):null;var e};Er.registerSaveRouter(Wr),Er.registerLoadRouter(Wr);class Ur{constructor(){x(Q().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),x("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const t={},e=Ir+"/",n="/"+Mr;for(let r=0;r<this.LS.length;++r){const s=this.LS.key(r);if(s.startsWith(e)&&s.endsWith(n)){t[Vr(s)]=JSON.parse(this.LS.getItem(s))}}return t}async removeModel(t){var e;const n=Pr(t=(e=t).startsWith(zr.URL_SCHEME)?e.slice(zr.URL_SCHEME.length):e);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(n.info));return Br(n),r}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jr{constructor(){this.managers={}}static getInstance(){return null==jr.instance&&(jr.instance=new jr),jr.instance}static registerManager(t,e){x(null!=t,(()=>"scheme must not be undefined or null.")),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),x(t.length>0,(()=>"scheme must not be an empty string."));const n=jr.getInstance();x(null==n.managers[t],(()=>`A model store manager is already registered for scheme '${t}'.`)),n.managers[t]=e}static getManager(t){const e=this.getInstance().managers[t];if(null==e)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}}function Gr(t){if(-1===t.indexOf("://"))throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${jr.getSchemes().join(",")}`);return{scheme:t.split("://")[0],path:t.split("://")[1]}}async function qr(t,e,n=!1){x(t!==e,(()=>`Old path and new path are the same: '${t}'`));const r=Er.getLoadHandlers(t);x(r.length>0,(()=>`Copying failed because no load handler is found for source URL ${t}.`)),x(r.length<2,(()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${t}.`));const s=r[0],o=Er.getSaveHandlers(e);x(o.length>0,(()=>`Copying failed because no save handler is found for destination URL ${e}.`)),x(o.length<2,(()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${e}.`));const i=o[0],a=Gr(t).scheme,u=Gr(t).path,c=a===Gr(t).scheme,l=await s.load();n&&c&&await jr.getManager(a).removeModel(u);const f=await i.save(l);return n&&!c&&await jr.getManager(a).removeModel(u),f.modelArtifactsInfo}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Hr{fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}}if(Q().get("IS_BROWSER")){Q().setPlatform("browser",new Hr);try{jr.registerManager(zr.URL_SCHEME,new Ur)}catch(t){}try{jr.registerManager(Ar.URL_SCHEME,new Or)}catch(t){}}const Kr=()=>require("node-fetch");let Xr;class Jr{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return null!=Q().global.fetch?Q().global.fetch(t,e):(null==Xr&&(Xr=Kr()),Xr(t,e))}now(){const t=_t.hrtime();return 1e3*t[0]+t[1]/1e6}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)}}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Yr(t,e="float32",n){return e=e||"float32",X(t),new Re(t,e,n)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Q().get("IS_NODE")&&!Q().get("IS_BROWSER")&&Q().setPlatform("node",new Jr);const Zr=cr({cast_:function(t,e){const n=ar(t,"x","cast");if(!R(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},s={dtype:e};return en.runKernel("Cast",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qr=cr({clone_:function(t){const e={x:ar(t,"x","clone","string_or_numeric")};return en.runKernel("Identity",e)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ts(t,e=!1){console.log(t.toString(e))}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */tn();Fe={buffer:Yr,cast:Zr,clone:Qr,print:ts};function es(t){return new Promise((t=>setTimeout(t))).then(t)}class ns{constructor(t){if(!Q().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(ns.URL_SCHEME)&&(t=t.slice(ns.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}async save(t){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n=vr(t,[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]),r=window.URL.createObjectURL(new Blob([JSON.stringify(n)],{type:"application/json"})),s=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(s.download=this.modelJsonFileName,s.href=r,await es((()=>s.dispatchEvent(new MouseEvent("click")))),null!=t.weightData){const t=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;t.download=this.weightDataFileName,t.href=e,await es((()=>t.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:Nr(t)}}}}ns.URL_SCHEME="downloads://";class rs{constructor(t){if(null==t||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.jsonFile=t[0],this.weightsFiles=t.slice(1)}async load(){return new Promise(((t,e)=>{const n=new FileReader;n.onload=n=>{const r=JSON.parse(n.target.result),s=r.modelTopology;if(null==s)return void e(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));if(null==r.weightsManifest)return void e(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));if(0===this.weightsFiles.length)return void t({modelTopology:s});const o=xr(r,(t=>this.loadWeights(t)));t(o)},n.onerror=t=>e(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),n.readAsText(this.jsonFile)}))}loadWeights(t){const e=[],n=[];for(const r of t)e.push(...r.weights),n.push(...r.paths);const r=this.checkManifestAndWeightFiles(t),s=n.map((t=>this.loadWeightsFile(t,r[t])));return Promise.all(s).then((t=>[e,br(t)]))}loadWeightsFile(t,e){return new Promise(((n,r)=>{const s=new FileReader;s.onload=t=>{const e=t.target.result;n(e)},s.onerror=e=>r(`Failed to weights data from file of path '${t}'.`),s.readAsArrayBuffer(e)}))}checkManifestAndWeightFiles(t){const e=[],n=this.weightsFiles.map((t=>wr(t.name))),r={};for(const s of t)s.paths.forEach((t=>{const s=wr(t);if(-1!==e.indexOf(s))throw new Error(`Duplicate file basename found in weights manifest: '${s}'`);if(e.push(s),-1===n.indexOf(s))throw new Error(`Weight file with basename '${s}' is not provided.`);r[t]=this.weightsFiles[n.indexOf(s)]}));if(e.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${e.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ss(t,e,n,r){!function(t){x(null!=t&&Array.isArray(t)&&t.length>0,(()=>"promises must be a none empty array"))}(t),function(t,e){x(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${t}`)),x(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${e}`)),x(e>=t,(()=>`startFraction must be no more than endFraction, but got startFraction ${t} and endFraction ${e}`))}(n=null==n?0:n,r=null==r?1:r);let s=0;return Promise.all(t.map((o=>(o.then((o=>{const i=n+ ++s/t.length*(r-n);return e(i),o})),o))))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function os(t,e){null==e&&(e={});const n=null==e.fetchFunc?Q().platform.fetch:e.fetchFunc,r=t.map((t=>n(t,e.requestInit,{isBinary:!0}))),s=(null==e.onProgress?await Promise.all(r):await ss(r,e.onProgress,0,.5)).map((t=>t.arrayBuffer()));return null==e.onProgress?await Promise.all(s):await ss(s,e.onProgress,.5,1)}function is(t){return async(e,n="",r)=>{const s=e.map((()=>!1)),o={},i=null!=r?r.map((()=>!1)):[],a=[];if(e.forEach(((t,e)=>{let n=0;t.weights.forEach((t=>{const u="quantization"in t?t.quantization.dtype:t.dtype,c=pr[u]*S(t.shape),l=()=>{s[e]=!0,null==o[e]&&(o[e]=[]),o[e].push({manifestEntry:t,groupOffset:n,sizeBytes:c})};null!=r?r.forEach(((e,n)=>{e===t.name&&(l(),i[n]=!0)})):l(),a.push(t.name),n+=c}))})),!i.every((t=>t))){const t=r.filter(((t,e)=>!i[e]));throw new Error(`Could not find weights in manifest with names: ${t.join(", ")}. \nManifest JSON has weights with names: ${a.join(", ")}.`)}const u=s.reduce(((t,e,n)=>(e&&t.push(n),t)),[]),c=[];u.forEach((t=>{e[t].paths.forEach((t=>{const e=n+(n.endsWith("/")?"":"/")+t;c.push(e)}))}));const l=await t(c),f={};let h=0;return u.forEach((t=>{const n=e[t].paths.length;let r=0;for(let t=0;t<n;t++)r+=l[h+t].byteLength;const s=new ArrayBuffer(r),i=new Uint8Array(s);let a=0;for(let t=0;t<n;t++){const e=new Uint8Array(l[h+t]);i.set(e,a),a+=e.byteLength}o[t].forEach((t=>{const e=dr(s.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(const t in e)f[t]=e[t]})),h+=n})),f}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Er.registerSaveRouter((t=>Q().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(ns.URL_SCHEME)?function(t="model"){return new ns(t)}(t.slice(ns.URL_SCHEME.length)):null));class as{constructor(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,this.weightUrlConverter=e.weightUrlConverter,null!=e.fetchFunc?(x("function"==typeof e.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=e.fetchFunc):this.fetch=Q().platform.fetch,x(null!=t&&t.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(t)&&x(2===t.length,(()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`)),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData;const n=vr(t,[{paths:["./model.weights.bin"],weights:t.weightSpecs}]);e.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin");const r=await this.fetch(this.path,e);if(r.ok)return{modelArtifactsInfo:Nr(t),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let e;try{e=await t.json()}catch(t){let e=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=e.modelTopology,r=e.weightsManifest;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return xr(e,(t=>this.loadWeights(t)))}async loadWeights(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),r=t.substring(0,e),s=n>e?t.substring(n):"";return[r+"/",s]}(e),s=this.weightPathPrefix||n,o=[];for(const e of t)o.push(...e.weights);const i=[],a=[];for(const e of t)for(const t of e.paths)null!=this.weightUrlConverter?a.push(this.weightUrlConverter(t)):i.push(s+t+r);this.weightUrlConverter&&i.push(...await Promise.all(a));return[o,br(await os(i,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress}))]}}function us(t){return null!=t.match(as.URL_SCHEME_REGEX)}as.URL_SCHEME_REGEX=/^https?:\/\//;const cs=(t,e)=>{if("undefined"==typeof fetch&&(null==e||null==e.fetchFunc))return null;{let n=!0;if(n=Array.isArray(t)?t.every((t=>us(t))):us(t),n)return ls(t,e)}return null};function ls(t,e){return new as(t,e)}function fs(t,e){return ls(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Er.registerSaveRouter(cs),Er.registerLoadRouter(cs);class hs{constructor(t){this.modelArtifacts=t}load(){return this.modelArtifacts}}class ps{constructor(t){this.saveHandler=t}save(t){return this.saveHandler(t)}}class ds{constructor(t){t.load&&(this.load=()=>Promise.resolve(t.load())),t.save&&(this.save=e=>Promise.resolve(t.save(e)))}}function ms(t,e,n,r){if(1===arguments.length){return null!=t.modelTopology||null!=t.weightSpecs?new hs(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new hs({modelTopology:t}))}return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new hs({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r})}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var ys=Object.freeze({__proto__:null,browserFiles:function(t){return new rs(t)},browserHTTPRequest:fs,concatenateArrayBuffers:br,decodeWeights:dr,encodeWeights:async function(t,e){const n=[],r=[],s=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);for(let o=0;o<s.length;++o){const i=s[o],a=Array.isArray(t)?t[o].tensor:t[i];if("float32"!==a.dtype&&"int32"!==a.dtype&&"bool"!==a.dtype&&"string"!==a.dtype&&"complex64"!==a.dtype)throw new Error(`Unsupported dtype in weight '${i}': ${a.dtype}`);const u={name:i,shape:a.shape,dtype:a.dtype};if("string"===a.dtype){const t=new Promise((async t=>{const e=await a.bytes(),n=e.reduce(((t,e)=>t+e.length),0)+4*e.length,r=new Uint8Array(n);let s=0;for(let t=0;t<e.length;t++){const n=e[t],o=new Uint8Array(new Uint32Array([n.length]).buffer);r.set(o,s),s+=4,r.set(n,s),s+=n.length}t(r)}));r.push(t)}else r.push(a.data());null!=e&&(u.group=e),n.push(u)}return{data:mr(await Promise.all(r)),specs:n}},fromMemory:function(t,e,n,r){const s=arguments;return new ds(ms(...s))},fromMemorySync:ms,getLoadHandlers:_r,getModelArtifactsForJSON:xr,getModelArtifactsInfoForJSON:Nr,getSaveHandlers:Sr,http:ls,isHTTPScheme:us,loadWeights:async function(t,e="",n,r){return is((t=>os(t,{requestInit:r})))(t,e,n)},registerLoadRouter:t=>Er.registerLoadRouter(t),registerSaveRouter:t=>Er.registerSaveRouter(t),weightsLoaderFactory:is,withSaveHandler:function(t){return new ps(t)},withSaveHandlerSync:function(t){return new ps(t)},copyModel:async function(t,e){return qr(t,e,!1)},listModels:async function(){const t=jr.getSchemes(),e={};for(const n of t){const t=await jr.getManager(n).listModels();for(const r in t){e[n+"://"+r]=t[r]}}return e},moveModel:async function(t,e){return qr(t,e,!0)},removeModel:async function(t){const e=Gr(t);return jr.getManager(e.scheme).removeModel(e.path)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gs=cr({matMul_:function(t,e,n=!1,r=!1){let s=ar(t,"a","matMul"),o=ar(e,"b","matMul");[s,o]=qe(s,o);const i={a:s,b:o},a={transposeA:n,transposeB:r};return en.runKernel("BatchMatMul",i,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bs=cr({oneHot_:function(t,e,n=1,r=0){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const s={indices:ar(t,"indices","oneHot","int32")},o={depth:e,onValue:n,offValue:r};return en.runKernel("OneHot",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ws(){return en}function vs(t,e){return en.tidy(t,e)}function xs(t){Ke(t).forEach((t=>t.dispose()))}function Ns(t){return en.keep(t)}function $s(){return en.backendName}function Es(){return en.backend}const Ss=cr({imag_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={input:ar(t,"input","imag")};return en.runKernel("Imag",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _s=cr({neg_:function(t){const e={x:ar(t,"x","neg")};return en.runKernel("Neg",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ts=cr({real_:function(t){const e={input:ar(t,"input","real")};return en.runKernel("Real",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ks=cr({transpose_:function(t,e,n){const r=ar(t,"x","transpose");if(null==e&&(e=r.shape.map(((t,e)=>e)).reverse()),x(r.rank===e.length,(()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`)),e.forEach((t=>{x(t>=0&&t<r.rank,(()=>"All entries in 'perm' must be between 0 and "+(r.rank-1)+` but got ${e}`))})),r.rank<=1)return r.clone();const s={x:r},o={perm:e};return"complex64"===r.dtype?vs((()=>{let t=Ts(r),e=Ss(r);return t=en.runKernel("Transpose",{x:t},o),e=en.runKernel("Transpose",{x:e},o),n&&(e=_s(e)),lr(t,e)})):en.runKernel("Transpose",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const As=cr({confusionMatrix_:function(t,e,n){const r=ar(t,"labels","confusionMatrix"),s=ar(e,"predictions","confusionMatrix");x(null==n||n>0&&Number.isInteger(n),(()=>`If provided, numClasses must be a positive integer, but got ${n}`)),x(1===r.rank,(()=>`Expected the rank of labels to be 1, but got ${r.rank}`)),x(1===s.rank,(()=>`Expected the rank of predictions to be 1, but got ${s.rank}`)),x(r.shape[0]===s.shape[0],(()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${s.shape[0]}. Labels and predictions should have the same number of elements.`)),x(n>0&&Number.isInteger(n),(()=>`numClasses is required to be a positive integer, but got ${n}`));const o=bs(Zr(r,"int32"),n),i=bs(Zr(s,"int32"),n),a=ks(o),u=gs(a,i);return Zr(u,"int32")}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Cs=Object.freeze({__proto__:null,confusionMatrix:As});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Os(t,e){const n=t.length,r=[];for(let s=0;s<n;s++){const o=n-1-s,i=t[o]||1;(e[e.length-1-s]||1)>1&&1===i&&r.unshift(o)}return r}function Is(t,e){const n=[];for(let r=0;r<e.length;r++){const s=t[t.length-r-1],o=e.length-r-1,i=e[o];(null==s||1===s&&i>1)&&n.unshift(o)}return n}function Ms(t,e){const n=[],r=Math.max(t.length,e.length);for(let s=0;s<r;s++){let r=t[t.length-s-1];null==r&&(r=1);let o=e[e.length-s-1];if(null==o&&(o=1),1===r)n.unshift(o);else if(1===o)n.unshift(r);else{if(r!==o){throw Error(`Operands could not be broadcast together with shapes ${t} and ${e}.`)}n.unshift(r)}}return n}var Rs=Object.freeze({__proto__:null,getBroadcastDims:Os,getReductionAxes:Is,assertAndGetBroadcastShape:Ms});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ds(t,e,n){if($(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");const r=sr(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return fr(t,e,r,n)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Fs;function Ls(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,s=!1,o=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)s=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)o=!0;else if(null!=t.getContext)i=!0;else{if(!("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);a=!0}if(s){const e=2;if(s&&t.readyState<e)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=Mt("FromPixels",en.backendName)){const n={pixels:t},r={numChannels:e};return en.runKernel("FromPixels",n,r)}const[u,c]=s?[t.videoWidth,t.videoHeight]:[t.width,t.height];let l,f;if(i)l=t.getContext("2d").getImageData(0,0,u,c).data;else if(r||n)l=t.data;else if(o||s||a){if(null==Fs)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");Fs=new OffscreenCanvas(1,1).getContext("2d")}else Fs=document.createElement("canvas").getContext("2d");Fs.canvas.width=u,Fs.canvas.height=c,Fs.drawImage(t,0,0,u,c),l=Fs.getImageData(0,0,u,c).data}if(4===e)f=new Int32Array(l);else{const t=u*c;f=new Int32Array(t*e);for(let n=0;n<t;n++)for(let t=0;t<e;++t)f[n*e+t]=l[4*n+t]}return Ds(f,[c,u,e],"int32")}function Ps(t){return"undefined"!=typeof window&&"undefined"!=typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(t instanceof ImageBitmap)&&function(t){return null!=t&&0!==t.width&&0!==t.height}(t)&&!function(t){return null!=t&&t.data instanceof Uint8Array}(t)}const Bs=cr({fromPixels_:Ls});var Vs=Object.freeze({__proto__:null,fromPixelsAsync:async function(t,e=3){let n=null;if(Q().getBool("WRAP_TO_IMAGEBITMAP")&&Ps(t)){let e;try{e=await createImageBitmap(t,{premultiplyAlpha:"none"})}catch(t){e=null}n=null!=e&&e.width===t.width&&e.height===t.height?e:t}else n=t;return Ls(n,e)},toPixels:async function(t,e){let n=ar(t,"img","toPixels");if(!(t instanceof Le)){const t=n;n=Zr(t,"int32"),t.dispose()}if(2!==n.rank&&3!==n.rank)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const[r,s]=n.shape.slice(0,2),o=2===n.rank?1:n.shape[2];if(o>4||2===o)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${o}`);if("float32"!==n.dtype&&"int32"!==n.dtype)throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`);const i=await n.data(),a="float32"===n.dtype?255:1,u=new Uint8ClampedArray(s*r*4);for(let t=0;t<r*s;++t){const e=[0,0,0,255];for(let r=0;r<o;r++){const s=i[t*o+r];if("float32"===n.dtype){if(s<0||s>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${s}.`)}else if("int32"===n.dtype&&(s<0||s>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${s}.`);1===o?(e[0]=s*a,e[1]=s*a,e[2]=s*a):e[r]=s*a}const r=4*t;u[r+0]=Math.round(e[0]),u[r+1]=Math.round(e[1]),u[r+2]=Math.round(e[2]),u[r+3]=Math.round(e[3])}if(null!=e){e.width=s,e.height=r;const t=e.getContext("2d"),n=new ImageData(u,s,r);t.putImageData(n,0,0)}return n!==t&&n.dispose(),u},fromPixels:Bs});function zs(t,e){const n=t.shape.length,r=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==e.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${n}`);if(0===S(t.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const s=e.shape,o=s[s.length-1];let i=1;for(let t=0;t<s.length-1;++t)i*=s[t];const a=t.shape,u=s.slice();u.pop();let c=1;for(let t=o;t<n;++t)c*=a[t],u.push(a[t]);const l=[...j(t.shape).map((t=>t/c)),1].slice(0,o);return[u,i,c,l]}var Ws=Object.freeze({__proto__:null,prepareAndValidate:zs});function Us(t,e,n){const r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${s}.`;if(n.rank<s)throw new Error(o+` update.rank < ${s}. `);if(t.length<r+(n.rank-s))throw new Error(o+` Output shape length < ${r+(n.rank-s)}`);if(n.rank!==s+t.length-r)throw new Error(o+" update.rank != "+(s+t.length-r));for(let t=0;t<s;++t)if(n.shape[t]!==e.shape[t])throw new Error(o+` updates.shape[${t}] (${n.shape[t]}) != indices.shape[${t}] (${e.shape[t]}).`);for(let e=0;e<n.rank-s;++e)if(n.shape[e+s]!==t[e+r])throw new Error(o+` updates.shape[${e+s}] (${n.shape[e+s]}) != shape[${e+s}] (${t[e+s]})`)}function js(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if("int32"!==e.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===e.size)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(0===t.size)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}Us(n,e,t)}function Gs(t,e,n){const r=e.shape.length,s=r>1?e.shape[r-1]:1,o=n.length;let i=1;for(let t=s;t<o;++t)i*=n[t];const a=s<1?1:s;return{sliceRank:s,numUpdates:S(e.shape)/a,sliceSize:i,strides:[...j(n.slice(0,s)),1],outputSize:S(n)}}var qs=Object.freeze({__proto__:null,validateUpdateShape:Us,validateInput:js,calculateShapes:Gs});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hs(t,e,n,r){const s=[...t];for(let t=s.length;t<r.length;t++)s.push(1);for(let t=0;t<n;t++)0===t?s[e]=1:(s.splice(e,0,1),s.pop());return s}function Ks(t,e,n){return n<=t?n:n-(e-1)}function Xs(t,e){const n=[];for(let r=0;r<t;r++)n.push(e+r);return n}function Js(t,e,n,r,s){const o=[...s],i=Xs(n,e);for(let s=0;s<o.length;s++)if(i.indexOf(s)>-1)o[s]=0;else{const i=Ks(e,n,s);let a=r[i];t&1<<i&&(a=0),o[s]=a}return o}function Ys(t,e,n,r,s){const o=[...s],i=Xs(n,e);for(let s=0;s<o.length;s++)if(i.indexOf(s)>-1)o[s]=Number.MAX_SAFE_INTEGER;else{const i=Ks(e,n,s);let a=r[i];t&1<<i&&(a=Number.MAX_SAFE_INTEGER),o[s]=a}for(let t=0;t<o.length;t++){const e=s[t];o[t]<0&&(o[t]+=e),o[t]=w(0,o[t],s[t])}return o}function Zs(t,e,n){let r=t[e];return(n&1<<e||null==r)&&(r=1),r}function Qs(t,e,n,r,s,o){let i=e[s];const a=n[s]||1;(t&1<<s||o&1<<s||null==i)&&(i=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const u=r[s];return i<0&&(i+=u),i=w(0,i,u-1),i}function to(t,e,n,r,s,o){let i=e[s];const a=n[s]||1;(t&1<<s||o&1<<s||null==i)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const u=r[s];return i<0&&(i+=u),i=a>0?w(0,i,u):w(-1,i,u-1),i}function eo(t,e,n,r,s,o){if(s[e])return n>0?o[e]:o[e+1&1];{const e=t<0?r+t:t;return e<o[0]?o[0]:e>o[1]?o[1]:e}}var no=Object.freeze({__proto__:null,assertParamsValid:function(t,e,n){const r=t.shape.length;x(r===e.length,(()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`)),x(r===n.length,(()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`));for(let s=0;s<r;++s)x(e[s]+n[s]<=t.shape[s],(()=>`Error in slice${r}D: begin[${s}] + size[${s}] (${e[s]+n[s]}) would overflow input.shape[${s}] (${t.shape[s]})`))},maskToAxes:function(t){const e=[];let n=0;for(;t>0;)1&t&&e.push(n),t/=2,n++;return e},computeOutShape:function(t,e,n){const r=[];for(let s=0;s<t.length;s++)r[s]=Math.ceil((e[s]-t[s])/n[s]);return r},stridesWithElidedDims:Hs,getNormalizedAxes:function(t,e,n,r,s,o,i,a,u){const c=t.length;let l=new Array(c),f=new Array(c),h=new Array(c);if(e.length&&n>0){const u=e[0],c=n+1;l=Js(i,u,c,r,t),f=Ys(a,u,c,s,t),h=Hs(o,u,c,t)}else for(let e=0;e<c;e++)l[e]=Qs(i,r,o,t,e,u),f[e]=to(a,s,o,t,e,u),h[e]=Zs(o,e,u);return{begin:l,end:f,strides:h}},startIndicesWithElidedDims:Js,stopIndicesWithElidedDims:Ys,stridesForAxis:Zs,startForAxis:Qs,stopForAxis:to,isSliceContinous:function(t,e,n){let r=n.length;for(let t=0;t<n.length;t++)if(n[t]>1){r=t;break}for(let s=r+1;s<n.length;s++)if(e[s]>0||n[s]!==t[s])return!1;return!0},computeFlatOffset:function(t,e){let n=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)n+=t[r]*e[r];return n},parseSliceParams:function(t,e,n){let r;const s=t.shape.length;let o;return r="number"==typeof e?[e,...new Array(s-1).fill(0)]:e.length<s?e.concat(new Array(s-e.length).fill(0)):e.slice(),r.forEach((t=>{x(-1!==t,(()=>"slice() does not support negative begin indexing."))})),o=null==n?new Array(s).fill(-1):"number"==typeof n?[n,...new Array(s-1).fill(-1)]:n.length<s?n.concat(new Array(s-n.length).fill(-1)):n,o=o.map(((e,n)=>e>=0?e:(x(-1===e,(()=>`Negative size values should be exactly -1 but got ${e} for the slice() size at index ${n}.`)),t.shape[n]-r[n]))),[r,o]},sliceInfo:function(t,e,n,r,s,o,i,a,u){let c;if(null==r?(c=new Array(e.length),c.fill(1)):c=r,null!=i&&0!=(i&i-1))throw new Error("Multiple ellipses in slice is not allowed.");let l=!1;const f={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};for(let t=0;t<f.dims;t++)l&&0!=(1<<t&a)&&f.numAddAxisAfterEllipsis++,1<<t&i&&(l=!0);l||(f.ellipsisMask|=1<<f.dims,f.dims++);const h={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=null!=t.begin,e.endValid=null!=t.end,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<t.dims;r++)if(1<<r&t.ellipsisMask){const s=Math.min(e.dims-(t.dims-r)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<s;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&t.newAxisMask)e.finalShapeGatherIndices.push(-2),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);null!=t.begin&&(e.begin[n]=t.begin[r]),null!=t.end&&(e.end[n]=t.end[r]),e.strides[n]=t.strides[r],t.beginMask&1<<r&&(e.beginMask|=1<<n),t.endMask&1<<r&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(-1),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[n]=r,n++}}(f,h);let p=!0,d=!0,m=!0;const y=[],g=[];for(let e=0;e<t.length;++e){if(0===h.strides[e])throw Error(`strides[${e}] must be non-zero`);const n=!!(h.shrinkAxisMask&1<<e),r=t[e];if(-1===r){y.push(n?1:-1);continue}const s=[h.beginMask&1<<e,h.endMask&1<<e],o=[h.strides[e]>0?0:-1,h.strides[e]>0?r:r-1];if(n&&h.strides[e]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===h.strides[e];const i=!!(h.beginMask&1<<e&&h.endMask&1<<e);if(h.beginValid&&h.endValid){if(n){const t=h.begin[e]<0?r+h.begin[e]:h.begin[e];if(h.begin[e]=t,h.end[e]=h.begin[e]+1,t<0||t>=r)throw Error(`slice index ${h.begin[e]} of dimension ${e} out of bounds.`)}else h.begin[e]=eo(h.begin[e],0,h.strides[e],r,s,o),h.end[e]=eo(h.end[e],1,h.strides[e],r,s,o);const t=1===h.strides[e]&&0===h.begin[e]&&h.end[e]===r;p=p&&t,d=d&&(0===e&&1===h.strides[e]||t)}else p=p&&1===h.strides[e]&&i,d=d&&(0===e&&1===h.strides[e]||i);let a,u=!1;if(h.beginValid&&h.endValid?(a=h.end[e]-h.begin[e],u=!0):n?(a=1,u=!0):i&&r>=0&&(a=h.strides[e]<0?-r:r,u=!0),u){let t;t=0===a||a<0!=h.strides[e]<0?0:Math.trunc(a/h.strides[e])+(a%h.strides[e]!=0?1:0),y.push(t)}else y.push(-1)}for(let t=0;t<h.finalShapeGatherIndices.length;++t){const e=h.finalShapeGatherIndices[t];e>=0?g.push(y[e]):-2===e&&g.push(1)}const b=g.filter(((t,e)=>-2!==h.finalShapeGatherIndices[e]));return{finalShapeSparse:b,finalShape:g,isIdentity:p,sliceDim0:d,isSimpleSlice:m,begin:h.begin,end:h.end,strides:h.strides}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ro{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}class so{constructor(){this.classNameMap={}}static getMap(){return null==so.instance&&(so.instance=new so),so.instance}static register(t){so.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function oo(t){x(null!=t.className,(()=>"Class being registered does not have the static className property defined.")),x("string"==typeof t.className,(()=>"className is required to be a string, but got type "+typeof t.className)),x(t.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),so.register(t)}var io=Object.freeze({__proto__:null,Serializable:ro,SerializationMap:so,registerClass:oo});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ao(){return 32===en.backend.floatPrecision()?.001:.1}function uo(t,e,n){let r=!0;if((D(t)||D(e))&&(r=!1),D(t)&&D(e)&&(r=!0),r){const n=t.constructor.name,r=e.constructor.name;if(n!==r)throw new Error(`Arrays are of different type. Actual: ${n}. Expected: ${r}`)}if(Array.isArray(t)&&Array.isArray(e)){const n=sr(t),r=sr(e);if(!_(n,r))throw new Error(`Arrays have different shapes. Actual: [${n}]. Expected: [${r}]`)}const s=D(t)?t:E(t),o=D(e)?e:E(e);if(s.length!==o.length)throw new Error(`Arrays have different lengths actual: ${s.length} vs expected: ${o.length}.\nActual:   ${s}.\nExpected: ${o}.`);for(let t=0;t<o.length;++t){const e=s[t],r=o[t];if(!n(e,r))throw new Error(`Arrays differ: actual[${t}] = ${e}, expected[${t}] = ${r}.\nActual:   ${s}.\nExpected: ${o}.`)}}function co(t,e,n){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}var lo=Object.freeze({__proto__:null,TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(t,e,n){return null==n&&(n=ao()),uo(t,e,((t,e)=>co(t,e,n)))},testEpsilon:ao,expectPromiseToFail:function(t,e){t().then((()=>e.fail()),(()=>e()))},expectArraysEqual:function(t,e){const n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return P(t)||P(t[0])||P(e)||P(e[0])?uo(t,n,((t,e)=>t==e)):uo(t,e,((t,e)=>co(t,e,0)))},expectNumbersClose:function(t,e,n){if(null==n&&(n=ao()),!co(t,e,n))throw new Error(`Numbers differ: actual === ${t}, expected === ${e}`)},expectValuesInRange:function(t,e,n){for(let r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error(`Value out of range:${t[r]} low: ${e}, high: ${n}`)},expectArrayBuffersEqual:function(t,e){const n=new Float32Array(t),r=new Float32Array(e);if(n.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${n.length}`);for(let t=0;t<r.length;t++)if(n[t]!==r[t])throw new Error(`Expected ArrayBuffer value at ${t} to be ${r[t]} but got ${n[t]} instead`)},encodeStrings:function t(e){for(let n=0;n<e.length;n++){const r=e[n];Array.isArray(r)?t(r):e[n]=$e(r)}return e}});
/** @license See the LICENSE file. */const fo=cr({add_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=ar(t,"a","add"),r=ar(e,"b","add");[n,r]=qe(n,r);const s={a:n,b:r};return en.runKernel("Add",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ho=cr({floorDiv_:function(t,e){let n=ar(t,"a","floorDiv"),r=ar(e,"b","floorDiv");[n,r]=qe(n,r);const s={a:n,b:r};return en.runKernel("FloorDiv",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const po=cr({div_:function(t,e){let n=ar(t,"a","div"),r=ar(e,"b","div");if([n,r]=qe(n,r),"int32"===n.dtype&&"int32"===r.dtype)return ho(n,r);const s={a:n,b:r};return en.runKernel("RealDiv",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mo=cr({mul_:function(t,e){let n=ar(t,"a","mul"),r=ar(e,"b","mul");[n,r]=qe(n,r);const s={a:n,b:r};return en.runKernel("Multiply",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yo=cr({abs_:function(t){const e=ar(t,"x","abs");if("complex64"===e.dtype){const t={x:e};return en.runKernel("ComplexAbs",t)}{const t={x:e};return en.runKernel("Abs",t)}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const go=cr({acos_:function(t){const e={x:ar(t,"x","acos")};return en.runKernel("Acos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bo=cr({acosh_:function(t){const e={x:ar(t,"x","acosh")};return en.runKernel("Acosh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wo=cr({addN_:function(t){x(Array.isArray(t),(()=>"The argument passed to tf.addN() must be a list of tensors")),x(t.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`));const e=t.map(((t,e)=>ar(t,`tensors${e}`,"addN"))),n=e[0];e.forEach((t=>{if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((t=>{if(!_(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const r=e;return en.runKernel("AddN",r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vo=cr({all_:function(t,e=null,n=!1){const r={x:ar(t,"x","all","bool")},s={axis:e,keepDims:n};return en.runKernel("All",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xo=cr({any_:function(t,e=null,n=!1){const r={x:ar(t,"x","any","bool")},s={axis:e,keepDims:n};return en.runKernel("Any",r,s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const No=cr({argMax_:function(t,e=0){const n={x:ar(t,"x","argMax")},r={axis:e};return en.runKernel("ArgMax",n,r)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $o=cr({argMin_:function(t,e=0){const n={x:ar(t,"x","argMin")},r={axis:e};return en.runKernel("ArgMin",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eo=cr({asin_:function(t){const e={x:ar(t,"x","asin")};return en.runKernel("Asin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const So=cr({asinh_:function(t){const e={x:ar(t,"x","asinh")};return en.runKernel("Asinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _o=cr({atan_:function(t){const e={x:ar(t,"x","atan")};return en.runKernel("Atan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const To=cr({atan2_:function(t,e){let n=ar(t,"a","atan2"),r=ar(e,"b","atan2");[n,r]=qe(n,r);const s={a:n,b:r};return en.runKernel("Atan2",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ko=cr({atanh_:function(t){const e={x:ar(t,"x","atanh")};return en.runKernel("Atanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ao(t,e,n,r,s,o,i="channelsLast"){const[a,u]=Mo(e);let c;if("channelsLast"===i)c=[a,u,t[3],t[3]];else{if("channelsFirst"!==i)throw new Error(`Unknown dataFormat ${i}`);c=[a,u,t[1],t[1]]}return Co(t,c,n,r,s,o,!1,i)}function Co(t,e,n,r,s,o,i=!1,a="channelsLast"){let[u,c,l,f]=[-1,-1,-1,-1];if("channelsLast"===a)[u,c,l,f]=t;else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);[u,f,c,l]=t}const[h,p,,d]=e,[m,y]=Mo(n),[g,b]=Mo(r),w=Do(h,g),v=Do(p,b),{padInfo:x,outHeight:N,outWidth:$}=function(t,e,n,r,s,o,i,a,u){let c,l,f;if("number"==typeof t){c={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};const s=function(t,e,n,r,s){null==r&&(r=Io(t,e,n));const o=t[0],i=t[1],a=Fo((o-e+2*r)/n+1,s),u=Fo((i-e+2*r)/n+1,s);return[a,u]}([e,n],o,r,t,a);l=s[0],f=s[1]}else if("same"===t){l=Math.ceil(e/r),f=Math.ceil(n/s);const t=Math.max(0,(l-1)*r+o-e),a=Math.max(0,(f-1)*s+i-n),u=Math.floor(t/2),h=t-u,p=Math.floor(a/2);c={top:u,bottom:h,left:p,right:a-p,type:"SAME"}}else if("valid"===t)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-o+1)/r),f=Math.ceil((n-i+1)/s);else{if("object"!=typeof t)throw Error(`Unknown padding parameter: ${t}`);{const h="channelsLast"===u?t[1][0]:t[2][0],p="channelsLast"===u?t[1][1]:t[2][1],d="channelsLast"===u?t[2][0]:t[3][0],m="channelsLast"===u?t[2][1]:t[3][1];c={top:h,bottom:p,left:d,right:m,type:0===h&&0===p&&0===d&&0===m?"VALID":"EXPLICIT"},l=Fo((e-o+h+p)/r+1,a),f=Fo((n-i+d+m)/s+1,a)}}return{padInfo:c,outHeight:l,outWidth:f}}(s,c,l,m,y,w,v,o,a),E=i?d*f:d;let S;return"channelsFirst"===a?S=[u,E,N,$]:"channelsLast"===a&&(S=[u,N,$,E]),{batchSize:u,dataFormat:a,inHeight:c,inWidth:l,inChannels:f,outHeight:N,outWidth:$,outChannels:E,padInfo:x,strideHeight:m,strideWidth:y,filterHeight:h,filterWidth:p,effectiveFilterHeight:w,effectiveFilterWidth:v,dilationHeight:g,dilationWidth:b,inShape:t,outShape:S,filterShape:e}}function Oo(t,e,n,r,s,o=!1,i="channelsLast",a){let[u,c,l,f,h]=[-1,-1,-1,-1,-1];if("channelsLast"===i)[u,c,l,f,h]=t;else{if("channelsFirst"!==i)throw new Error(`Unknown dataFormat ${i}`);[u,h,c,l,f]=t}const[p,d,m,,y]=e,[g,b,w]=Ro(n),[v,x,N]=Ro(r),$=Do(p,v),E=Do(d,x),S=Do(m,N),{padInfo:_,outDepth:T,outHeight:k,outWidth:A}=function(t,e,n,r,s,o,i,a,u,c,l){let f,h,p,d;if("number"==typeof t){f={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};const o=function(t,e,n,r,s,o){null==s&&(s=Io(t,e,r));const i=t[0],a=t[1],u=t[2],c=Fo((i-e+2*s)/r+1,o),l=Fo((a-e+2*s)/r+1,o),f=Fo((u-e+2*s)/r+1,o);return[c,l,f,n]}([e,n,r,1],a,1,s,t,l);h=o[0],p=o[1],d=o[2]}else if("same"===t){h=Math.ceil(e/s),p=Math.ceil(n/o),d=Math.ceil(r/i);const t=(h-1)*s+a-e,l=(p-1)*o+u-n,m=(d-1)*i+c-r,y=Math.floor(t/2),g=t-y,b=Math.floor(l/2),w=l-b,v=Math.floor(m/2);f={top:b,bottom:w,left:v,right:m-v,front:y,back:g,type:"SAME"}}else{if("valid"!==t)throw Error(`Unknown padding parameter: ${t}`);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((e-a+1)/s),p=Math.ceil((n-u+1)/o),d=Math.ceil((r-c+1)/i)}return{padInfo:f,outDepth:h,outHeight:p,outWidth:d}}(s,c,l,f,g,b,w,$,E,S,a),C=o?y*h:y;let O;return"channelsFirst"===i?O=[u,C,T,k,A]:"channelsLast"===i&&(O=[u,T,k,A,C]),{batchSize:u,dataFormat:i,inDepth:c,inHeight:l,inWidth:f,inChannels:h,outDepth:T,outHeight:k,outWidth:A,outChannels:C,padInfo:_,strideDepth:g,strideHeight:b,strideWidth:w,filterDepth:p,filterHeight:d,filterWidth:m,effectiveFilterDepth:$,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationDepth:v,dilationHeight:x,dilationWidth:N,inShape:t,outShape:O,filterShape:e}}function Io(t,e,n,r=1){const s=Do(e,r);return Math.floor((t[0]*(n-1)-n+s)/2)}function Mo(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function Ro(t){return"number"==typeof t?[t,t,t]:t}function Do(t,e){return e<=1?t:t+(t-1)*(e-1)}function Fo(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function Lo(t){const[e,n,r]=Mo(t);return 1===e&&1===n&&1===r}function Po(t,e){return Lo(t)||Lo(e)}function Bo(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function Vo(t,e,n){if(null!=n){if("string"==typeof e)throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if("number"==typeof e)x(T(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`));else{if("object"!=typeof e)throw Error(`Error in ${t}: Unknown padding parameter: ${e}`);e.forEach((e=>{e.forEach((e=>{x(T(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`))}))}))}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zo=cr({reshape_:function(t,e){const n={x:ar(t,"x","reshape","string_or_numeric")},r={shape:e};return en.runKernel("Reshape",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wo=cr({avgPool_:function(t,e,n,r,s){const o=ar(t,"x","avgPool","float32");x(Po(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let i=o,a=!1;3===o.rank&&(a=!0,i=zo(o,[1,o.shape[0],o.shape[1],o.shape[2]])),x(4===i.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${i.rank}.`)),Vo("avgPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s};let l=en.runKernel("AvgPool",u,c);return l=Zr(l,o.dtype),a?zo(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uo=cr({avgPool3d_:function(t,e,n,r,s,o="NDHWC"){const i=ar(t,"x","avgPool3d","float32");let a=i,u=!1;4===i.rank&&(u=!0,a=zo(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),x(5===a.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`)),x("NDHWC"===o,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),Vo("avgPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o};let f=en.runKernel("AvgPool3D",c,l);return f=Zr(f,a.dtype),u?zo(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jo=cr({concat_:function(t,e=0){x(t.length>=1,(()=>"Pass at least one tensor to concat"));const n=ur(t,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((t=>{if("complex64"!==t.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${t.dtype}. `)})),1===n.length)return Qr(n[0]);const r=n,s={axis:e};return en.runKernel("Concat",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Go=cr({sigmoid_:function(t){const e={x:ar(t,"x","sigmoid","float32")};return en.runKernel("Sigmoid",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qo=cr({slice_:function(t,e,n){const r=ar(t,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const s={x:r},o={begin:e,size:n};return en.runKernel("Slice",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ho=cr({tanh_:function(t){const e={x:ar(t,"x","tanh","float32")};return en.runKernel("Tanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ko=cr({basicLSTMCell_:function(t,e,n,r,s,o){const i=ar(t,"forgetBias","basicLSTMCell"),a=ar(e,"lstmKernel","basicLSTMCell"),u=ar(n,"lstmBias","basicLSTMCell"),c=ar(r,"data","basicLSTMCell"),l=ar(s,"c","basicLSTMCell"),f=ar(o,"h","basicLSTMCell"),h=jo([c,f],1),p=gs(h,a),d=fo(p,u),m=d.shape[0],y=d.shape[1]/4,g=[m,y],b=qo(d,[0,0],g),w=qo(d,[0,y],g),v=qo(d,[0,2*y],g),x=qo(d,[0,3*y],g),N=fo(mo(Go(b),Ho(w)),mo(l,Go(fo(i,v))));return[N,mo(Ho(N),Go(x))]}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xo=cr({batchToSpaceND_:function(t,e,n){const r=ar(t,"x","batchToSpaceND"),s=e.reduce(((t,e)=>t*e));x(r.rank>=1+e.length,(()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`)),x(n.length===e.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`)),x(r.shape[0]%s==0,(()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${s}`));const o={x:r},i={blockShape:e,crops:n};return en.runKernel("BatchToSpaceND",o,i)}});const Jo=cr({batchNorm_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s,o){null==o&&(o=.001);const i=ar(t,"x","batchNorm"),a=ar(e,"mean","batchNorm"),u=ar(n,"variance","batchNorm");let c,l;null!=s&&(c=ar(s,"scale","batchNorm")),null!=r&&(l=ar(r,"offset","batchNorm")),x(a.rank===u.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),x(null==l||a.rank===l.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),x(null==c||a.rank===c.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const f=function(t){let e;return e=0===t.rank||1===t.rank?zo(t,[1,1,1,t.size]):2===t.rank?zo(t,[1,1,t.shape[0],t.shape[1]]):3===t.rank?zo(t,[1,t.shape[0],t.shape[1],t.shape[2]]):t,e}(i),h={x:f,scale:c,offset:l,mean:a,variance:u},p={varianceEpsilon:o},d=en.runKernel("FusedBatchNorm",h,p);return zo(d,i.shape)}});const Yo=cr({batchNorm2d_:function(t,e,n,r,s,o){const i=ar(t,"x","batchNorm"),a=ar(e,"mean","batchNorm"),u=ar(n,"variance","batchNorm");let c,l;return null!=s&&(c=ar(s,"scale","batchNorm")),null!=r&&(l=ar(r,"offset","batchNorm")),x(2===i.rank,(()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`)),x(2===a.rank||1===a.rank,(()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`)),x(2===u.rank||1===u.rank,(()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`)),null!=c&&x(2===c.rank||1===c.rank,(()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`)),null!=l&&x(2===l.rank||1===l.rank,(()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${l.rank}.`)),Jo(i,a,u,l,c,o)}});const Zo=cr({batchNorm3d_:function(t,e,n,r,s,o){const i=ar(t,"x","batchNorm"),a=ar(e,"mean","batchNorm"),u=ar(n,"variance","batchNorm");let c,l;return null!=s&&(c=ar(s,"scale","batchNorm")),null!=r&&(l=ar(r,"offset","batchNorm")),x(3===i.rank,(()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`)),x(3===a.rank||1===a.rank,(()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`)),x(3===u.rank||1===u.rank,(()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`)),null!=c&&x(3===c.rank||1===c.rank,(()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`)),null!=l&&x(3===l.rank||1===l.rank,(()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${l.rank}.`)),Jo(i,a,u,l,c,o)}});const Qo=cr({batchNorm4d_:function(t,e,n,r,s,o){const i=ar(t,"x","batchNorm"),a=ar(e,"mean","batchNorm"),u=ar(n,"variance","batchNorm");let c,l;return null!=s&&(c=ar(s,"scale","batchNorm")),null!=r&&(l=ar(r,"offset","batchNorm")),x(4===i.rank,(()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`)),x(4===a.rank||1===a.rank,(()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`)),x(4===u.rank||1===u.rank,(()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`)),null!=c&&x(4===c.rank||1===c.rank,(()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`)),null!=l&&x(4===l.rank||1===l.rank,(()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${l.rank}.`)),Jo(i,a,u,l,c,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ti=cr({bincount_:function(t,e,n){const r=ar(t,"x","bincount"),s=ar(e,"weights","bincount");x("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),x(n>=0,(()=>`size must be non-negative, but got ${n}.`)),x(s.size===r.size||0===s.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${s.shape}.`));const o={x:r,weights:s},i={size:n};return en.runKernel("Bincount",o,i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ei=cr({broadcastArgs_:function(t,e){const n=ar(t,"s0","broadcastArgs","int32"),r=ar(e,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(1!==r.rank)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const s={s0:n,s1:r};return en.runKernel("BroadcastArgs",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ni=cr({broadcastTo_:function(t,e){let n=ar(t,"broadcastTo","x");const r=n.shape;if(e.some((t=>!(t>0)||t%1!=0)))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const t=n.shape.slice();for(;t.length<e.length;)t.unshift(1);n=zo(n,t)}const s=n.shape,o=Array.from(e);for(let t=e.length-1;t>=0;t--)if(s[t]===e[t])o[t]=1;else if(1!==n.shape[t])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);const i=o.map(((t,e)=>t>1?e:-1)).filter((t=>t>=0));if(0===i.length)return Qr(n);const a={x:n},u={reps:o};return en.runKernel("Tile",a,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ri=cr({ceil_:function(t){const e={x:ar(t,"x","ceil","float32")};return en.runKernel("Ceil",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const si=cr({clipByValue_:function(t,e,n){const r=ar(t,"x","clipByValue");x(e<=n,(()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`));const s={x:r},o={clipValueMin:e,clipValueMax:n};return en.runKernel("ClipByValue",s,o)}});const oi=cr({concat1d_:function(t){return jo(t,0)}});const ii=cr({concat2d_:function(t,e){return jo(t,e)}});const ai=cr({concat3d_:function(t,e){return jo(t,e)}});const ui=cr({concat4d_:function(t,e){return jo(t,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ci=cr({conv2d_:function(t,e,n,r,s="NHWC",o=[1,1],i){const a=ar(t,"x","conv2d","float32"),u=ar(e,"filter","conv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=zo(a,[1,a.shape[0],a.shape[1],a.shape[2]])),x(4===c.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`)),x(4===u.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`)),Vo("conv2d",r,i);const f="NHWC"===s?c.shape[3]:c.shape[1];x(f===u.shape[2],(()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`)),x(Po(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const h={x:c,filter:u},p={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},d=en.runKernel("Conv2D",h,p);return l?zo(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});const li=cr({conv1d_:function(t,e,n,r,s="NWC",o=1,i){const a=ar(t,"x","conv1d"),u=ar(e,"filter","conv1d");let c=a,l=!1;2===a.rank&&(l=!0,c=zo(a,[1,a.shape[0],a.shape[1]])),x(3===c.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`)),x(3===u.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`)),Vo("conv1d",r,i),x(c.shape[2]===u.shape[1],(()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`)),x(Po(n,o),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${o}'`)),x("NWC"===s,(()=>`Error in conv1d: got dataFormat of ${s} but only NWC is currently supported.`));const f=zo(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=zo(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=ci(h,f,[1,n],r,"NHWC",[1,o],i);return zo(p,l?[p.shape[2],p.shape[3]]:[p.shape[0],p.shape[2],p.shape[3]])}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fi=cr({conv2DBackpropInput_:function(t,e,n,r,s,o="NHWC",i){x(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let a=t,u=e,c=!1;3===e.rank&&(c=!0,u=zo(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),x(4===a.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`)),x(4===u.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`)),x(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const l="NHWC"===o?a[3]:a[1],f="NHWC"===o?u.shape[3]:u.shape[1];x(l===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[2]}.`)),x(f===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${n.shape[3]}.`)),Vo("conv2dDerInput",s,i);const h={dy:u,filter:n},p={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,inputShape:a},d=en.runKernel("Conv2DBackpropInput",h,p);return c?zo(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});const hi=cr({conv2dTranspose_:function(t,e,n,r,s,o){const i=ar(t,"x","conv2dTranspose"),a=ar(e,"filter","conv2dTranspose");return fi(n,i,a,r,s,"NHWC",o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pi=cr({conv3d_:function(t,e,n,r,s="NDHWC",o=[1,1,1]){const i=ar(t,"x","conv3d"),a=ar(e,"filter","conv3d");let u=i,c=!1;4===i.rank&&(c=!0,u=zo(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),x(5===u.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`)),x(5===a.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`)),x(u.shape[4]===a.shape[3],(()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${a.shape[3]}.`)),x(Po(n,o),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),x("NDHWC"===s,(()=>`Error in conv3d: got dataFormat of ${s} but only NDHWC is currently supported.`));const l={x:u,filter:a},f={strides:n,pad:r,dataFormat:s,dilations:o},h=en.runKernel("Conv3D",l,f);return c?zo(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const di=cr({conv3DBackpropInput_:function(t,e,n,r,s){x(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let o=t,i=e,a=!1;4===e.rank&&(a=!0,i=zo(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,t[0],t[1],t[2],t[3]]);const u=o[4],c=i.shape[4];x(5===o.length,(()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`)),x(5===i.rank,(()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`)),x(5===n.rank,(()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`)),x(u===n.shape[3],(()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[3]}.`)),x(c===n.shape[4],(()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`));const l={dy:i,filter:n},f={pad:s,strides:r,inputShape:o},h=en.runKernel("Conv3DBackpropInputV2",l,f);return a?zo(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});const mi=cr({conv3dTranspose_:function(t,e,n,r,s){const o=ar(t,"x","conv3dTranspose"),i=ar(e,"filter","conv3dTranspose");return di(n,o,i,r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yi=cr({cos_:function(t){const e={x:ar(t,"x","cos","float32")};return en.runKernel("Cos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gi=cr({cosh_:function(t){const e={x:ar(t,"x","cosh","float32")};return en.runKernel("Cosh",e)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bi=cr({cumprod_:function(t,e=0,n=!1,r=!1){const s={x:ar(t,"x","cumprod")},o={axis:e,exclusive:n,reverse:r};return en.runKernel("Cumprod",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wi=cr({cumsum_:function(t,e=0,n=!1,r=!1){const s={x:ar(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:r};return en.runKernel("Cumsum",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vi=cr({denseBincount_:function(t,e,n,r=!1){const s=ar(t,"x","denseBincount"),o=ar(e,"weights","denseBincount");x("int32"===s.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${s.dtype}`)),x(s.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${s.rank}.`)),x(n>=0,(()=>`size must be non-negative, but got ${n}.`)),x(o.size===s.size||0===o.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${s.shape}, weights shape: ${o.shape}.`));const i={x:s,weights:o},a={size:n,binaryOutput:r};return en.runKernel("DenseBincount",i,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xi=cr({depthToSpace_:function(t,e,n="NHWC"){const r=ar(t,"x","depthToSpace","float32"),s="NHWC"===n?r.shape[1]:r.shape[2],o="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];x(e>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`)),x(s*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${s} and ${e}  for depthToSpace with input shape\n    ${r.shape}`)),x(o*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${o} and ${e} for depthToSpace with input shape\n        ${r.shape}`)),x(i%(e*e)==0,(()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${r.shape}`));const a={x:r},u={blockSize:e,dataFormat:n};return en.runKernel("DepthToSpace",a,u)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ni=cr({depthwiseConv2d_:function(t,e,n,r,s="NHWC",o=[1,1],i){const a=ar(t,"x","depthwiseConv2d","float32"),u=ar(e,"filter","depthwiseConv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=zo(a,[1,a.shape[0],a.shape[1],a.shape[2]])),x(4===c.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`)),x(4===u.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`)),x(c.shape[3]===u.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`)),Vo("depthwiseConv2d",r,i);const f={x:c,filter:u},h={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},p=en.runKernel("DepthwiseConv2dNative",f,h);return l?zo(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $i=cr({diag_:function(t){const e={x:ar(t,"x","diag")};return en.runKernel("Diag",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ei=cr({dilation2d_:function(t,e,n,r,s=[1,1],o="NHWC"){const i=ar(t,"x","dilation2d"),a=ar(e,"filter","dilation2d");x(3===i.rank||4===i.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`)),x(3===a.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`)),x("NHWC"===o,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`));let u=i,c=!1;3===i.rank&&(u=zo(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=!0);const l={x:u,filter:a},f={strides:n,pad:r,dilations:s},h=en.runKernel("Dilation2D",l,f);return c?zo(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Si=cr({equal_:function(t,e){let n=ar(t,"a","equal","string_or_numeric"),r=ar(e,"b","equal","string_or_numeric");[n,r]=qe(n,r),Ms(n.shape,r.shape);const s={a:n,b:r};return en.runKernel("Equal",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _i=cr({where_:function(t,e,n){const r=ar(e,"a","where"),s=ar(n,"b","where"),o=ar(t,"condition","where","bool"),i=Ms(Ms(o.shape,r.shape),s.shape),a={condition:ni(o,i),t:ni(r,i),e:ni(s,i)};return en.runKernel("Select",a)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ti=cr({zerosLike_:function(t){const e={x:ar(t,"x","zerosLike")};return en.runKernel("ZerosLike",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ki=cr({divNoNan_:function(t,e){let n=ar(t,"a","div"),r=ar(e,"b","div");[n,r]=qe(n,r);const s=po(n,r),o=Ti(s),i=Si(r,o);return _i(i,o,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ai=cr({dot_:function(t,e){const n=ar(t,"t1","dot"),r=ar(e,"t2","dot");x(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`));const s=1===n.rank?n.size:n.shape[1],o=1===r.rank?r.size:r.shape[0];if(x(s===o,(()=>`Error in dot: inner dimensions of inputs must match, but got ${s} and ${o}.`)),1===n.rank&&1===r.rank){const t=zo(n,[1,-1]),e=zo(r,[-1,1]),s=gs(t,e);return zo(s,[])}if(1===n.rank&&2===r.rank){const t=zo(n,[1,-1]),e=zo(r,[r.shape[0],r.shape[1]]),s=gs(t,e);return zo(s,[s.size])}if(2===n.rank&&1===r.rank){const t=zo(r,[-1,1]),e=gs(n,t);return zo(e,[e.size])}{const t=zo(r,[r.shape[0],r.shape[1]]);return gs(n,t)}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ci=cr({einsum_:function(t,...e){const n=e.map(((t,e)=>ar(t,`tensors${e}`,"einsum"))),r={equation:t};return en.runKernel("Einsum",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oi=cr({elu_:function(t){const e={x:ar(t,"x","elu","float32")};return en.runKernel("Elu",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ii=cr({erf_:function(t){let e=ar(t,"x","erf");x("int32"===e.dtype||"float32"===e.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===e.dtype&&(e=Zr(e,"float32"));const n={x:e};return en.runKernel("Erf",n)}});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mi(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function Ri(t,e,n){const r=t.length+e.length,s=[];let o=0,i=0;for(let a=0;a<r;a++)-1===n.indexOf(a)?s.push(t[o++]):s.push(e[i++]);return s}function Di(t,e){return Ri(t,e.map((t=>1)),e)}const Fi=cr({max_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=null,n=!1){const r={x:ar(t,"x","max")},s={reductionIndices:e,keepDims:n};return en.runKernel("Max",r,s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Li=cr({min_:function(t,e=null,n=!1){const r={x:ar(t,"x","min")},s={axis:e,keepDims:n};return en.runKernel("Min",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pi=cr({pow_:function(t,e){let n=ar(t,"base","pow"),r=ar(e,"exp","pow");[n,r]=qe(n,r);const s={a:n,b:r};return en.runKernel("Pow",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bi(t,e){if((D(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&D(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return fr(t,[],[],e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vi=cr({sqrt_:function(t){const e={x:ar(t,"x","sqrt","float32")};return en.runKernel("Sqrt",e)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zi=cr({square_:function(t){const e=ar(t,"x","square");return en.runKernel("Square",{x:e},{})}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wi=cr({sum_:function(t,e=null,n=!1){let r=ar(t,"x","sum");"bool"===r.dtype&&(r=Zr(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return en.runKernel("Sum",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ui(t,e,n=null){if(0===t.rank)return yo(t);if(1!==t.rank&&null===n)return Ui(zo(t,[-1]),e,n);if(1===t.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===e)return Wi(yo(t),n);if(e===1/0)return Fi(yo(t),n);if(e===-1/0)return Li(yo(t),n);if("euclidean"===e||2===e)return Vi(Wi(Pi(yo(t),Bi(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&2===n.length){if(1===e)return Fi(Wi(yo(t),n[0]),n[1]-1);if(e===1/0)return Fi(Wi(yo(t),n[1]),n[0]);if(e===-1/0)return Li(Wi(yo(t),n[1]),n[0]);if("fro"===e||"euclidean"===e)return Vi(Wi(zi(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const ji=cr({norm_:function(t,e="euclidean",n=null,r=!1){const s=Ui(t=ar(t,"x","norm"),e,n);let o=s.shape;if(r){const e=A(n,t.shape);o=Di(s.shape,e)}return zo(s,o)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gi=cr({euclideanNorm_:function(t,e=null,n=!1){return ji(t,"euclidean",e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qi=cr({exp_:function(t){const e={x:ar(t,"x","exp")};return en.runKernel("Exp",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hi=cr({expandDims_:function(t,e=0){const n=ar(t,"x","expandDims","string_or_numeric");x(e<=n.rank,(()=>"Axis must be <= rank of the tensor"));const r={input:n},s={dim:e};return en.runKernel("ExpandDims",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ki=cr({expm1_:function(t){const e={x:ar(t,"x","expm1")};return en.runKernel("Expm1",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xi=cr({tile_:function(t,e){const n=ar(t,"x","tile","string_or_numeric");x(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`));const r={x:n},s={reps:e};return en.runKernel("Tile",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ji=cr({eye_:function(t,e,n,r="float32"){null==e&&(e=t);const s=Yr([t,e],r),o=t<=e?t:e;for(let t=0;t<o;++t)s.set(1,t,t);const i=zo(s.toTensor(),[t,e]);if(null==n)return i;if(1===n.length)return Xi(Hi(i,0),[n[0],1,1]);if(2===n.length)return Xi(Hi(Hi(i,0),0),[n[0],n[1],1,1]);if(3===n.length)return Xi(Hi(Hi(Hi(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yi(t,e,n){const r={shape:t,value:e,dtype:n};return en.runKernel("Fill",{},r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zi=cr({floor_:function(t){const e={x:ar(t,"x","floor","float32")};return en.runKernel("Floor",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qi=cr({gather_:function(t,e,n=0,r=0){const s={x:ar(t,"x","gather"),indices:ar(e,"indices","gather","int32")},o={axis:n,batchDims:r};return en.runKernel("GatherV2",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ta=cr({greater_:function(t,e){let n=ar(t,"a","greater","string_or_numeric"),r=ar(e,"b","greater","string_or_numeric");[n,r]=qe(n,r),Ms(n.shape,r.shape);const s={a:n,b:r};return en.runKernel("Greater",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ea=cr({greaterEqual_:function(t,e){let n=ar(t,"a","greaterEqual","string_or_numeric"),r=ar(e,"b","greaterEqual","string_or_numeric");[n,r]=qe(n,r),Ms(n.shape,r.shape);const s={a:n,b:r};return en.runKernel("GreaterEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const na=cr({isFinite_:function(t){const e={x:ar(t,"x","isFinite")};return en.runKernel("IsFinite",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ra=cr({isInf_:function(t){const e={x:ar(t,"x","isInf")};return en.runKernel("IsInf",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sa=cr({isNaN_:function(t){const e={x:ar(t,"x","isNaN")};return en.runKernel("IsNan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oa=cr({leakyRelu_:function(t,e=.2){const n={x:ar(t,"x","leakyRelu")},r={alpha:e};return en.runKernel("LeakyRelu",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ia=cr({less_:function(t,e){let n=ar(t,"a","less","string_or_numeric"),r=ar(e,"b","less","string_or_numeric");[n,r]=qe(n,r),Ms(n.shape,r.shape);const s={a:n,b:r};return en.runKernel("Less",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aa=cr({lessEqual_:function(t,e){let n=ar(t,"a","lessEqual","string_or_numeric"),r=ar(e,"b","lessEqual","string_or_numeric");[n,r]=qe(n,r),Ms(n.shape,r.shape);const s={a:n,b:r};return en.runKernel("LessEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ua(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:t,stop:e,num:n};return en.runKernel("LinSpace",{},r)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ca=cr({localResponseNormalization_:function(t,e=5,n=1,r=1,s=.5){const o=ar(t,"x","localResponseNormalization");x(4===o.rank||3===o.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${o.rank}.`)),x(T(e),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`));let i=o,a=!1;3===o.rank&&(a=!0,i=zo(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const u={x:i},c={depthRadius:e,bias:n,alpha:r,beta:s},l=en.runKernel("LRN",u,c);return a?zo(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const la=cr({log_:function(t){const e={x:ar(t,"x","log","float32")};return en.runKernel("Log",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fa=cr({log1p_:function(t){const e={x:ar(t,"x","log1p")};return en.runKernel("Log1p",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ha(t,e){x(W(t),(()=>"The f passed in variableGrads(f) must be a function")),x(null==e||Array.isArray(e)&&e.every((t=>t instanceof Pe)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=e;if(!n){e=[];for(const t in en.registeredVariables)e.push(en.registeredVariables[t])}const r=n?e.filter((t=>!t.trainable)):null,s=e.length;e=e.filter((t=>t.trainable)),x(e.length>0,(()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${s} variables is trainable.`));const{value:o,grads:i}=en.gradients(t,e,null,!0);x(i.some((t=>null!=t)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),x(0===o.rank,(()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`));const a={};return e.forEach(((t,e)=>{null!=i[e]&&(a[t.name]=i[e])})),null!=r&&r.forEach((t=>a[t.name]=null)),{value:o,grads:a}}function pa(t){return en.customGrad(t)}function da(t){const e=t.filter((t=>null==t)).length;if(e>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ma=cr({softplus_:function(t){const e={x:ar(t,"x","softplus")};return en.runKernel("Softplus",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ya=cr({logSigmoid_:function(t){const e=ar(t,"x","logSigmoid"),n=pa((t=>({value:_s(ma(_s(t))),gradFunc:e=>mo(e,Go(_s(t)))})));return n(e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ga=cr({sub_:function(t,e){let n=ar(t,"a","sub"),r=ar(e,"b","sub");[n,r]=qe(n,r);const s={a:n,b:r};return en.runKernel("Sub",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ba=cr({logSoftmax_:function(t,e=-1){const n=ar(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);const r=pa(((t,n)=>{const r=Fi(t,e,!0),s=ga(t,r),o=ga(Zr(s,"float32"),la(Wi(qi(s),e,!0)));n([o]);return{value:o,gradFunc:(t,n)=>{const[r]=n,s=qi(r);return ga(t,mo(Wi(t,e,!0),s))}}}));return r(n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wa=cr({logSumExp_:function(t,e=null,n=!1){const r=ar(t,"x","logSumExp"),s=A(e,r.shape),o=Fi(r,s,!0),i=ga(r,o),a=qi(i),u=Wi(a,s),c=la(u),l=fo(zo(o,c.shape),c);if(n){const t=Di(l.shape,s);return zo(l,t)}return l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const va=cr({logicalAnd_:function(t,e){const n=ar(t,"a","logicalAnd","bool"),r=ar(e,"b","logicalAnd","bool");Ms(n.shape,r.shape);const s={a:n,b:r};return en.runKernel("LogicalAnd",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xa=cr({logicalNot_:function(t){const e={x:ar(t,"x","logicalNot","bool")};return en.runKernel("LogicalNot",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Na=cr({logicalOr_:function(t,e){const n=ar(t,"a","logicalOr","bool"),r=ar(e,"b","logicalOr","bool");Ms(n.shape,r.shape);const s={a:n,b:r};return en.runKernel("LogicalOr",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $a=cr({logicalXor_:function(t,e){const n=ar(t,"a","logicalXor","bool"),r=ar(e,"b","logicalXor","bool");return Ms(n.shape,r.shape),va(Na(t,e),xa(va(t,e)))}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ea=cr({searchSorted_:function(t,e,n="left"){const r=ar(t,"sortedSequence","searchSorted"),s=ar(e,"values","searchSorted"),o=r.shape[r.shape.length-1],i=s.shape[s.shape.length-1],a=zo(r,[-1,o]),u=zo(s,[-1,i]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(S(u.shape)>=2147483648)throw new Error("values tensor size must less than 2147483648");if(a.shape[1]>=2147483648)throw new Error(`trailing dim_size must less than 2147483648 for int32 output type, was ${a.shape[1]}`);const c={sortedSequence:a,values:u},l={side:n};return en.runKernel("SearchSorted",c,l)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sa(t,e){return Ea(t,e,"left")}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _a=cr({maxPool_:function(t,e,n,r,s){const o=ar(t,"x","maxPool");let i=o,a=!1;3===o.rank&&(a=!0,i=zo(o,[1,o.shape[0],o.shape[1],o.shape[2]])),x(4===i.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${i.rank}.`)),x(Po(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),Vo("maxPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s},l=en.runKernel("MaxPool",u,c);return a?zo(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ta=cr({maxPool3d_:function(t,e=[1,1,1],n,r,s,o="NDHWC"){const i=ar(t,"x","maxPool3d");let a=i,u=!1;4===i.rank&&(u=!0,a=zo(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),x(5===a.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`)),x("NDHWC"===o,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),Vo("maxPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o},f=en.runKernel("MaxPool3D",c,l);return u?zo(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ka=cr({maxPoolWithArgmax_:function(t,e,n,r,s=!1){const o={x:ar(t,"x","maxPoolWithArgmax")},i={filterSize:e,strides:n,pad:r,includeBatchInIndex:s},a=en.runKernel("MaxPoolWithArgmax",o,i);return{result:a[0],indexes:a[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aa=cr({maximum_:function(t,e){let n=ar(t,"a","maximum"),r=ar(e,"b","maximum");[n,r]=qe(n,r),"bool"===n.dtype&&(n=Zr(n,"int32"),r=Zr(r,"int32")),Ms(n.shape,r.shape);const s={a:n,b:r};return en.runKernel("Maximum",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ca=cr({mean_:function(t,e=null,n=!1){const r={x:ar(t,"x","mean")},s={axis:e,keepDims:n};return en.runKernel("Mean",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oa(t,e="float32"){if("complex64"===e){const e=Oa(t,"float32"),n=Oa(t,"float32");return lr(e,n)}const n=K(S(t),e);return en.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ia(t,e="float32"){if("complex64"===e){const e=Ia(t,"float32"),n=Oa(t,"float32");return lr(e,n)}const n=H(S(t),e);return en.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ma=cr({minimum_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=ar(t,"a","minimum"),r=ar(e,"b","minimum");[n,r]=qe(n,r),"bool"===n.dtype&&(n=Zr(n,"int32"),r=Zr(r,"int32")),Ms(n.shape,r.shape);const s={a:n,b:r};return en.runKernel("Minimum",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ra=cr({mirrorPad_:function(t,e,n){x("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const r=ar(t,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");x(e.length===r.rank,(()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`));const s="reflect"===n?1:0;for(let t=0;t<r.rank;t++)x(2===e[t].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),x(e[t][0]>=0&&e[t][0]<=r.shape[t]-s&&e[t][1]>=0&&e[t][1]<=r.shape[t]-s,(()=>`Padding in dimension ${t} cannot be greater than or equal to ${r.shape[t]-s} or less than 0 for input of shape ${r.shape}`));const o={paddings:e,mode:n},i={x:r};return en.runKernel("MirrorPad",i,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Da=cr({mod_:function(t,e){let n=ar(t,"a","mod"),r=ar(e,"b","mod");[n,r]=qe(n,r);const s={a:n,b:r};return en.runKernel("Mod",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fa=cr({moments_:function(t,e=null,n=!1){const r=A(e,(t=ar(t,"x","moments")).shape),s=Ca(t,r,n);let o=s.shape;n||(o=Di(s.shape,r));const i=zi(ga(Zr(t,"float32"),zo(s,o)));return{mean:s,variance:Ca(i,r,n)}}});const La=cr({multiRNNCell_:function(t,e,n,r){const s=ar(e,"data","multiRNNCell"),o=ur(n,"c","multiRNNCell"),i=ur(r,"h","multiRNNCell");let a=s;const u=[];for(let e=0;e<t.length;e++){const n=t[e](a,o[e],i[e]);u.push(n[0]),u.push(n[1]),a=n[1]}const c=[],l=[];for(let t=0;t<u.length;t+=2)c.push(u[t]),l.push(u[t+1]);return[c,l]}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pa=cr({multinomial_:function(t,e,n,r=!1){const s=ar(t,"logits","multinomial"),o=s.size,i=s.rank;if(o<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${o}.`);if(i>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${i}`);n=n||Math.random();const a={logits:1===i?zo(s,[1,-1]):s},u={numSamples:e,seed:n,normalized:r},c=en.runKernel("Multinomial",a,u);return 1===i?zo(c,[c.size]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ba=cr({notEqual_:function(t,e){let n=ar(t,"a","notEqual","string_or_numeric"),r=ar(e,"b","notEqual","string_or_numeric");[n,r]=qe(n,r),Ms(n.shape,r.shape);const s={a:n,b:r};return en.runKernel("NotEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Va=cr({onesLike_:function(t){const e={x:ar(t,"x","onesLike")};return en.runKernel("OnesLike",e)}});const za=cr({outerProduct_:function(t,e){const n=ar(t,"v1","outerProduct"),r=ar(e,"v2","outerProduct");x(1===n.rank&&1===r.rank,(()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`));const s=zo(n,[-1,1]),o=zo(r,[1,-1]);return gs(s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wa=cr({pad_:function(t,e,n=0){const r=ar(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:n},o={x:r};return en.runKernel("PadV2",o,s)}});const Ua=cr({pad1d_:function(t,e,n=0){return x(2===e.length,(()=>"Invalid number of paddings. Must be length of 2.")),Wa(t,[e],n)}});const ja=cr({pad2d_:function(t,e,n=0){return x(2===e.length&&2===e[0].length&&2===e[1].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),Wa(t,e,n)}});const Ga=cr({pad3d_:function(t,e,n=0){return x(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),Wa(t,e,n)}});const qa=cr({pad4d_:function(t,e,n=0){return x(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),Wa(t,e,n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ha=cr({spaceToBatchND_:function(t,e,n){const r=ar(t,"x","spaceToBatchND");x(r.rank>=1+e.length,(()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`)),x(n.length===e.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`)),x(r.shape.reduce(((t,r,s)=>s>0&&s<=e.length?t&&(r+n[s-1][0]+n[s-1][1])%e[s-1]==0:t),!0),(()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`));const s={x:r},o={blockShape:e,paddings:n};return en.runKernel("SpaceToBatchND",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ka=cr({pool_:function(t,e,n,r,s,o,i){null==s&&(s=[1,1]),null==o&&(o=1),0===r&&(r="valid");const a=ar(t,"x","maxPool");let u=a,c=!1;3===a.rank&&(c=!0,u=zo(a,[1,a.shape[0],a.shape[1],a.shape[2]])),x(Po(o,s),(()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${s}'`));const l=Ao(u.shape,e,o,s,r),f=[l.dilationHeight,l.dilationWidth];let h;h="same"===r?function(t,e){const n=t.map(((t,n)=>t+(t-1)*(e[n]-1))),r=n.map((t=>t-1)),s=r.map((t=>Math.floor(t/2))),o=r.map(((t,e)=>t-s[e]));return r.map(((t,e)=>[s[e],o[e]]))}([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];const p=1===f[0]&&1===f[1],[d,m]=function(t,e,n){const r=n.map((t=>t[0])),s=n.map((t=>t[1])),o=t.concat(r,s),i=e.map(((t,e)=>(t-o[e]%t)%t)),a=s.map(((t,e)=>t+i[e])),u=e.map(((t,e)=>[r[e],a[e]])),c=e.map(((t,e)=>[0,i[e]]));return[u,c]}([l.inHeight,l.inWidth],f,h),y=p?r:"valid",g=p?u:Ha(u,f,d),b=("avg"===n?()=>Wo(g,e,o,y,i):()=>_a(g,e,o,y,i))(),w=p?b:Xo(b,f,m);return c?zo(w,[w.shape[1],w.shape[2],w.shape[3]]):w}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xa=cr({prelu_:function(t,e){const n={x:ar(t,"x","prelu"),alpha:ar(e,"alpha","prelu")};return en.runKernel("Prelu",n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ja=cr({prod_:function(t,e=null,n=!1){let r=ar(t,"x","prod");"bool"===r.dtype&&(r=Zr(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return en.runKernel("Prod",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ya=cr({rand_:function(t,e,n){const r=S(t);let s=null;if(null==n||"float32"===n)s=new Float32Array(r);else if("int32"===n)s=new Int32Array(r);else{if("bool"!==n)throw new Error(`Unknown data type ${n}`);s=new Uint8Array(r)}for(let t=0;t<r;t++)s[t]=e();return en.makeTensor(s,t,n)}});var Za={exports:{}};!function(t,e,n){function r(t){var e=this,n=function(){var t=4022871197,e=function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)};return e}();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}function s(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var n=new r(t),o=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.alea=o}(0,Za,!1);var Qa={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor128=o}(0,Qa,!1);var tu={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorwow=o}(0,tu,!1);var eu={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,s=e.i;return t=r[s],n=(t^=t>>>7)^t<<24,n^=(t=r[s+1&7])^t>>>10,n^=(t=r[s+3&7])^t>>>3,n^=(t=r[s+4&7])^t<<7,t=r[s+7&7],n^=(t^=t<<13)^t<<9,r[s]=n,e.i=s+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function s(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.x&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorshift7=o}(0,eu,!1);var nu={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,s=e.X,o=e.i;return e.w=r=r+1640531527|0,n=s[o+34&127],t=s[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=s[o]=n^t,e.i=o,n+(r^r>>>16)|0},function(t,e){var n,r,s,o,i,a=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),s=0,o=-32;o<u;++o)e&&(r^=e.charCodeAt((o+32)%e.length)),0===o&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(i=i+1640531527|0,s=0==(n=a[127&o]^=r+i)?s+1:0);for(s>=128&&(a[127&(e&&e.length||0)]=-1),s=127,o=512;o>0;--o)r=a[s+34&127],n=a[s=s+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,a[s]=r^n;t.w=i,t.X=a,t.i=s}(e,t)}function s(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.X&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor4096=o}(0,nu,!1);var ru={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,s=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^s,s=s-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^s,e.a=s-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.tychei=o}(0,ru,!1);var su,ou={exports:{}};su=ou,function(t,e){var n,r=this,s=256,o=e.pow(s,6),i=e.pow(2,52),a=2*i,u=255;function c(u,c,m){var y=[],g=p(h((c=1==c?{entropy:!0}:c||{}).entropy?[u,d(t)]:null==u?function(){try{var e;return n&&(e=n.randomBytes)?e=e(s):(e=new Uint8Array(s),(r.crypto||r.msCrypto).getRandomValues(e)),d(e)}catch(e){var o=r.navigator,i=o&&o.plugins;return[+new Date,r,i,r.screen,d(t)]}}():u,3),y),b=new l(y),w=function(){for(var t=b.g(6),e=o,n=0;t<i;)t=(t+n)*s,e*=s,n=b.g(1);for(;t>=a;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,p(d(b.S),t),(c.pass||m||function(t,n,r,s){return s&&(s.S&&f(s,b),t.state=function(){return f(b,{})}),r?(e.random=t,n):t})(w,g,"global"in c?c.global:this==e,c.state)}function l(t){var e,n=t.length,r=this,o=0,i=r.i=r.j=0,a=r.S=[];for(n||(t=[n++]);o<s;)a[o]=o++;for(o=0;o<s;o++)a[o]=a[i=u&i+t[o%n]+(e=a[o])],a[i]=e;(r.g=function(t){for(var e,n=0,o=r.i,i=r.j,a=r.S;t--;)e=a[o=u&o+1],n=n*s+a[u&(a[o]=a[i=u&i+e])+(a[i]=e)];return r.i=o,r.j=i,n})(s)}function f(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function h(t,e){var n,r=[],s=typeof t;if(e&&"object"==s)for(n in t)try{r.push(h(t[n],e-1))}catch(t){}return r.length?r:"string"==s?t:t+"\0"}function p(t,e){for(var n,r=t+"",s=0;s<r.length;)e[u&s]=u&(n^=19*e[u&s])+r.charCodeAt(s++);return d(e)}function d(t){return String.fromCharCode.apply(0,t)}if(e.seedrandom=c,p(e.random(),t),su.exports){su.exports=c;try{n=require("crypto")}catch(t){}}}([],Math);var iu=Za.exports,au=Qa.exports,uu=tu.exports,cu=eu.exports,lu=nu.exports,fu=ru.exports,hu=ou.exports;hu.alea=iu,hu.xor128=au,hu.xorwow=uu,hu.xorshift7=cu,hu.xor4096=lu,hu.tychei=fu;var pu=hu;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class du{constructor(t,e,n,r,s){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const o=s||Math.random();this.random=pu.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const t=this.nextVal;return this.nextVal=NaN,t}let t,e,n=!1;for(;!n;){let r,s,o;do{r=2*this.random()-1,s=2*this.random()-1,o=r*r+s*s}while(o>=1||0===o);const i=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*r*i,e=this.mean+this.stdDev*s*i,this.truncated&&!this.isValidTruncated(t)||(n=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class mu{constructor(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;const s=r||Math.random();this.randu=pu.alea(s.toString()),this.randn=new du(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,e,n,r,s,o;for(;;){do{r=this.randn.nextValue(),o=1+this.c*r}while(o<=0);if(o*=o*o,t=r*r,e=1-.331*t*t,n=.5*t+this.d*(1-o+Math.log(o)),s=this.randu(),s<e||Math.log(s)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(t){return"float32"===this.dtype?t:Math.round(t)}}class yu{constructor(t=0,e=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=pu.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gu=cr({randomGamma_:function(t,e,n=1,r="float32",s){if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error(`Unsupported data type ${r}`);const o=new mu(e,n,r,s),i=Yr(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bu=cr({randomNormal_:function(t,e=0,n=1,r,s){if(null!=r&&"bool"===r)throw new Error(`Unsupported data type ${r}`);const o=new du(e,n,r,!1,s),i=Yr(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wu=cr({randomUniform_:function(t,e=0,n=1,r="float32",s){const o=Yr(t,r),i=new yu(e,n,null,s);for(let t=0;t<o.values.length;t++)o.values[t]=i.nextValue();return o.toTensor()}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vu(t,e,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");const s={start:t,stop:e,step:n,dtype:r};return en.runKernel("Range",{},s)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xu=cr({reciprocal_:function(t){const e={x:ar(t,"x","reciprocal")};return en.runKernel("Reciprocal",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nu=cr({relu_:function(t){const e={x:ar(t,"x","relu")};return en.runKernel("Relu",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $u=cr({relu6_:function(t){const e={x:ar(t,"x","relu6")};return en.runKernel("Relu6",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eu=cr({reverse_:function(t,e){const n={x:ar(t,"x","reverse")},r={dims:e};return en.runKernel("Reverse",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Su=cr({reverse1d_:function(t){const e=ar(t,"x","reverse");return x(1===e.rank,(()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`)),Eu(e,0)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _u=cr({reverse2d_:function(t,e){const n=ar(t,"x","reverse");return x(2===n.rank,(()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`)),Eu(n,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tu=cr({reverse3d_:function(t,e){const n=ar(t,"x","reverse");return x(3===n.rank,(()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`)),Eu(n,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ku=cr({reverse4d_:function(t,e){const n=ar(t,"x","reverse");return x(4===n.rank,(()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`)),Eu(n,e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Au=cr({round_:function(t){const e={x:ar(t,"x","round")};return en.runKernel("Round",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cu=cr({rsqrt_:function(t){const e={x:ar(t,"x","rsqrt","float32")};return en.runKernel("Rsqrt",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ou=cr({selu_:function(t){const e={x:ar(t,"x","selu")};return en.runKernel("Selu",e)}});const Iu=cr({separableConv2d_:function(t,e,n,r,s,o=[1,1],i="NHWC"){const a=ar(t,"x","separableConv2d"),u=ar(e,"depthwiseFilter","separableConv2d"),c=ar(n,"pointwiseFilter","separableConv2d");let l=a,f=!1;if(3===a.rank&&(f=!0,l=zo(a,[1,a.shape[0],a.shape[1],a.shape[2]])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");x(4===l.rank,(()=>`Error in separableConv2d: input must be rank 4, but got rank ${l.rank}.`)),x(4===u.rank,(()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`)),x(4===c.rank,(()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`)),x(1===c.shape[0],(()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`)),x(1===c.shape[1],(()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`));const h=u.shape[2],p=u.shape[3];x(c.shape[2]===h*p,(()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*p}, but got ${c.shape[2]}.`));const d=Ni(l,u,r,s,i,o),m=ci(d,c,1,"valid",i);return f?zo(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mu=async function(t,e){const n=ar(t,"x","setdiff1d"),r=ar(e,"y","setdiff1d");x(n.dtype===r.dtype,(()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`)),x(1===n.rank,(()=>`x should be 1D tensor, but got x (${n.shape}).`)),x(1===r.rank,(()=>`y should be 1D tensor, but got y (${r.shape}).`));const s=await n.data(),o=await r.data(),i=new Set(o);let a=0;for(let t=0;t<s.length;t++)i.has(s[t])||a++;const u=new Re([a],n.dtype),c=new Re([a],"int32");for(let t=0,e=0;t<s.length;t++)i.has(s[t])||(u.values[e]=s[t],c.values[e]=t,e++);return[u.toTensor(),c.toTensor()]};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ru=cr({sign_:function(t){const e={x:ar(t,"x","sign")};return en.runKernel("Sign",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Du=cr({sin_:function(t){const e={x:ar(t,"x","sin","float32")};return en.runKernel("Sin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fu=cr({sinh_:function(t){const e={x:ar(t,"x","sinh")};return en.runKernel("Sinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lu=cr({slice1d_:function(t,e,n){const r=ar(t,"x","slice1d");return x(1===r.rank,(()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`)),qo(r,[e],[n])}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pu=cr({slice2d_:function(t,e,n){const r=ar(t,"x","slice2d");return x(2===r.rank,(()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`)),qo(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bu=cr({slice3d_:function(t,e,n){const r=ar(t,"x","slice3d");return x(3===r.rank,(()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`)),qo(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vu=cr({slice4d_:function(t,e,n){const r=ar(t,"x","slice4d");return x(4===r.rank,(()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`)),qo(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zu=cr({softmax_:function(t,e=-1){const n=ar(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const r={logits:n},s={dim:e};return en.runKernel("Softmax",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wu=cr({fft_:function(t){x("complex64"===t.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`));const e={input:t};return en.runKernel("FFT",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uu=cr({ifft_:function(t){x("complex64"===t.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`));const e={input:t};return en.runKernel("IFFT",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ju=cr({irfft_:function(t){const e=t.shape[t.shape.length-1],n=t.size/e;let r;if(e<=2){const s=zo(t,[n,e]);r=Uu(s)}else{const s=[n,2*(e-1)],o=zo(Ts(t),[n,e]),i=zo(Ss(t),[n,e]),a=Eu(qo(o,[0,1],[n,e-2]),1),u=mo(Eu(qo(i,[0,1],[n,e-2]),1),Bi(-1)),c=jo([o,a],1),l=jo([i,u],1),f=zo(lr(c,l),[s[0],s[1]]);r=Uu(f)}if(r=Ts(r),3===t.rank&&0!==t.shape[0]){const e=r,n=t.shape[0];r=zo(r,[n,r.shape[0]/n,r.shape[1]]),e.dispose()}return r}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gu=cr({split_:function(t,e,n=0){const r={x:ar(t,"x","split")},s={numOrSizeSplits:e,axis:n};return en.runKernel("SplitV",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qu=cr({rfft_:function(t,e){x("float32"===t.dtype,(()=>`The dtype for rfft() must be real value but got ${t.dtype}`));let n=t.shape[t.shape.length-1];const r=t.size/n;let s;if(null!=e&&e<n){const r=t.shape.map((t=>0)),o=t.shape.map((t=>t));o[t.shape.length-1]=e,s=qo(t,r,o),n=e}else if(null!=e&&e>n){const r=t.shape.map((t=>t));r[t.shape.length-1]=e-n,s=jo([t,Oa(r)],t.shape.length-1),n=e}else s=t;const o=Ti(s),i=zo(lr(s,o),[r,n]),a=Wu(i),u=Math.floor(n/2)+1,c=Ts(a),l=Ss(a),f=Gu(c,[u,n-u],c.shape.length-1),h=Gu(l,[u,n-u],l.shape.length-1),p=s.shape.slice();return p[s.shape.length-1]=u,zo(lr(f[0],h[0]),p)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hu=cr({squaredDifference_:function(t,e){let n=ar(t,"a","squaredDifference"),r=ar(e,"b","squaredDifference");[n,r]=qe(n,r),Ms(n.shape,r.shape);const s={a:n,b:r};return en.runKernel("SquaredDifference",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ku=cr({squeeze_:function(t,e){const n=ar(t,"x","squeeze");return zo(n,C(n.shape,e).newShape)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xu=cr({stack_:function(t,e=0){const n=ur(t,"tensors","stack","string_or_numeric");x(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&x(e<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const r=n,s={axis:e};return en.runKernel("Pack",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ju=cr({step_:function(t,e=0){const n={x:ar(t,"x","step")},r={alpha:e};return en.runKernel("Step",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yu=cr({stridedSlice_:function(t,e,n,r,s=0,o=0,i=0,a=0,u=0){const c={x:ar(t,"x","stridedSlice","string_or_numeric")},l={begin:e,end:n,strides:r,beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};return en.runKernel("StridedSlice",c,l)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zu=cr({tan_:function(t){const e={x:ar(t,"x","tan","float32")};return en.runKernel("Tan",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qu(t,e){$(t);const n=sr(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return fr(t,null,n,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tc(t,e,n){if($(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");const r=sr(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return fr(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ec=cr({topk_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=1,n=!0){const r=ar(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const s=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const o={x:r},i={k:e,sorted:n},[a,u]=en.runKernel("TopK",o,i);return{values:a,indices:u}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nc=cr({truncatedNormal_:function(t,e=0,n=1,r,s){if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const o=new du(e,n,r,!0,s),i=Yr(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rc=cr({unique_:function(t,e=0){const n=ar(t,"x","unique","string_or_numeric");x(n.rank>0,(()=>"The input tensor must be at least 1D"));const r={x:n},s={axis:e},[o,i]=en.runKernel("Unique",r,s);return{values:o,indices:i}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sc=cr({unsortedSegmentSum_:function(t,e,n){const r=ar(t,"x","unsortedSegmentSum"),s=ar(e,"segmentIds","unsortedSegmentSum","int32");x(T(n),(()=>"numSegments must be of dtype int"));const o={x:r,segmentIds:s},i={numSegments:n};return en.runKernel("UnsortedSegmentSum",o,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oc=cr({unstack_:function(t,e=0){const n=ar(t,"x","unstack","string_or_numeric");x(e>=-n.shape.length&&e<n.shape.length,(()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`));const r={value:n},s={axis:e};return en.runKernel("Unpack",r,s)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ic(t,e){return Ea(t,e,"right")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ac(t,e){const n=[];for(let t=0;t<e.length;t++)e[t]&&n.push(t);const r=Yr(t,"int32"),s=Yr([n.length,t.length],"int32");for(let e=0;e<n.length;e++){const o=r.indexToLoc(n[e]),i=e*t.length;s.values.set(o,i)}return s.toTensor()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uc=async function(t){const e=ar(t,"condition","whereAsync","bool"),n=await e.data(),r=ac(e.shape,n);return t!==e&&e.dispose(),r};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cc=async function(t,e,n){const r=ar(t,"tensor","boolMask"),s=ar(e,"mask","boolMask","bool"),o=null==n?0:n,i=s.rank,a=r.shape;x(i>0,(()=>"mask cannot be scalar")),N(a.slice(o,o+i),s.shape,"mask's shape must match the first K dimensions of tensor's shape,");let u=1;for(let t=o;t<o+i;t++)u*=a[t];const c=a.slice(0,o).concat([u],a.slice(o+i)),l=zo(r,c),f=zo(s,[-1]),h=await uc(f),p=Ku(h,[1]),d=Qi(l,p,o);return t!==r&&r.dispose(),e!==s&&s.dispose(),p.dispose(),l.dispose(),f.dispose(),h.dispose(),d};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lc=cr({movingAverage_:function(t,e,n,r,s=!0){const o=ar(t,"v","movingAverage"),i=ar(e,"x","movingAverage"),a=ar(n,"decay","movingAverage");He(o,i),x(_(o.shape,i.shape),(()=>"Shape mismatch in v and x"));const u=Bi(1),c=ga(u,a);let l=mo(ga(i,o),c);if(s){x(null!=r,(()=>"When using zeroDebias: true, step is required."));const t=ar(r,"step","movingAverage");l=po(l,ga(u,Pi(a,t)))}return fo(o,l)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fc=cr({scatterND_:function(t,e,n){const r=ar(t,"indices","scatterND","int32"),s=ar(e,"updates","scatterND");js(s,r,n);const o={indices:r,updates:s},i={shape:n};return en.runKernel("ScatterNd",o,i)}});const hc=cr({sparseToDense_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=0){const s=ar(t,"sparseIndices","sparseToDense","int32"),o=ar(e,"sparseValues","sparseToDense","string_or_numeric"),i=ar(r,"defaultValue","sparseToDense",o.dtype);!function(t,e,n,r){if("int32"!==t.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const s=t.rank>0?t.shape[0]:1,o=t.rank>1?t.shape[1]:1;if(n.length!==o)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${o}.`);const i=e.size;if(0!==e.rank&&(1!==e.rank||i!==s))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${s}]`);if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(s,o,n,i);const a={sparseIndices:s,sparseValues:o,defaultValue:i},u={outputShape:n};return en.runKernel("SparseToDense",a,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pc=cr({gatherND_:function(t,e){const n=ar(e,"indices","gatherND","int32"),r={params:ar(t,"x","gatherND","string_or_numeric"),indices:n};return en.runKernel("GatherNd",r)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dc=cr({dropout_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const s=ar(t,"x","dropout");if(x("float32"===s.dtype,(()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${s.dtype} tensor instead.`)),x(e>=0&&e<1,(()=>`rate must be a float in the range [0, 1), but got ${e}.`)),0===e)return t instanceof Le?s.clone():s;const o=function(t,e){if(null==e)return t.shape.slice();if(_(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let r=0;r<t.shape.length;r++)null==e[r]&&null!=t.shape[r]?n.push(t.shape[r]):n.push(e[r]);return n}return e}(s,n),i=1-e,a=po(Zi(fo(wu(o,0,1,"float32",r),i)),i);return mo(s,a)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mc(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function yc(t,e,n){const r=1-t%2,s=new Float32Array(t);for(let o=0;o<t;++o){const i=2*Math.PI*o/(t+r-1);s[o]=e-n*Math.cos(i)}return Qu(s,"float32")}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gc=async function(t,e,n=1){const r=ar(t,"predictions","inTopK"),s=ar(e,"targets","inTopK");x(r.rank>1,(()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`)),x(r.rank-1===s.rank,(()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${s.rank}`)),N(r.shape.slice(0,r.shape.length-1),s.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const o=r.shape[r.shape.length-1];x(n>0&&n<=o,(()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${o}), but got ${n}`));const i=await r.data(),a=await s.data(),[u,c]=[i.length/o,o],l=O("bool",u);for(let t=0;t<u;t++){const e=t*c,r=i.subarray(e,e+c),s=[];for(let t=0;t<r.length;t++)s.push({value:r[t],index:t});s.sort(((t,e)=>e.value-t.value)),l[t]=0;for(let e=0;e<n;e++)if(s[e].index===a[t]){l[t]=1;break}}return t!==r&&r.dispose(),e!==s&&s.dispose(),hr(l,s.shape,"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bc=cr({conv2DBackpropFilter_:function(t,e,n,r,s,o="NHWC",i){let a=t;3===t.rank&&(a=zo(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=zo(e,[1,e.shape[0],e.shape[1],e.shape[2]])),x(4===a.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`)),x(4===u.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`)),x(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const c="NHWC"===o?a.shape[3]:a.shape[1],l="NHWC"===o?u.shape[3]:u.shape[1];x(c===n[2],(()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`)),x(l===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${l}) must match output depth for filter (${n[3]}).`)),Vo("conv2dDerFilter",s,i);const f={x:a,dy:u},h={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,filterShape:n};return en.runKernel("Conv2DBackpropFilter",f,h)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wc(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return mo(t,Ju(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function vc(t,e){let n=e;const r=Is(t.shape,e.shape);return r.length>0&&(n=Wi(n,r)),zo(n,t.shape)}function xc(t,e,n,r){if("linear"===e)return t;if("relu"===e)return Nu(t);if("elu"===e)return Oi(t);if("relu6"===e)return $u(t);if("prelu"===e)return Xa(t,n);if("leakyrelu"===e)return oa(t,r);if("sigmoid"===e)return Go(t);throw new Error(`Unknown fused activation ${e}.`)}const Nc=(t,e)=>!(t>0)||"linear"===e;
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $c=cr({fusedConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(u=u||"linear",!1===Nc(en.state.gradientDepth,u)){x("NHWC"===s,(()=>`Error in fused conv2d: got dataFormat of ${s} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`));let f=ci(t,e,n,r,s,o,i);return null!=a&&(f=fo(f,a)),xc(f,u,c,l)}const f=ar(t,"x","conv2d","float32"),h=ar(e,"filter","conv2d","float32");let p=f,d=!1;3===f.rank&&(d=!0,p=zo(f,[1,f.shape[0],f.shape[1],f.shape[2]])),x(4===p.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`)),x(4===h.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`)),Vo("fused conv2d",r,i);const m="NHWC"===s?p.shape[3]:p.shape[1];x(h.shape[2]===m,(()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${h.shape[2]}.`)),x(Po(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const y=Co(p.shape,h.shape,n,o,r,i);let g,b;if(null!=a&&(g=ar(a,"bias","fused conv2d"),[g]=qe(g,f),"NHWC"===s?Ms(y.outShape,g.shape):(x(g.shape.length<=1,(()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${g.shape.length}.`)),x(0===g.shape.length||g.shape[0]===y.outChannels||1===g.shape[0],(()=>`Error in fused conv2d: bias shape (${g.shape}) is not compatible with the number of output channels (${y.outChannels})`)))),null!=c){const t=c.shape;if(x(t.length<=1||3===t.length,(()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${t.length}.`)),1===t.length)x(1===t[0]||t[0]===y.outChannels,(()=>`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the number of output channels (${y.outChannels}).`));else if(3===t.length)try{Ms(t,y.outShape)}catch(e){const n=`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the output shape of the conv2d (${y.outShape}).`;throw Error(n)}b=ar(c,"prelu weights","fused conv2d")}const w=(t,e)=>{x("NHWC"===s,(()=>`Error in gradient of fused conv2D: got dataFormat of ${s} but only NHWC is currently supported.`));const[i,a,c,l]=e,f=wc(t,c,u);x(Lo(o),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`));const h=[fi(a.shape,f,i,n,r),bc(a,f,i.shape,n,r)];if(null!=l){const t=vc(l,f);h.push(t)}return h},v={x:p,filter:h,bias:g,preluActivationWeights:b},N={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=pa(((t,e,n)=>{let r=en.runKernel("FusedConv2D",v,N);return n([e,t,r]),d&&(r=zo(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:w}}));return t(p,h)}{const t=pa(((t,e,n,r)=>{let s=en.runKernel("FusedConv2D",v,N);return r([e,t,s,n]),d&&(s=zo(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:w}}));return t(p,h,g)}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ec=cr({depthwiseConv2dNativeBackpropFilter_:function(t,e,n,r,s,o=[1,1],i){let a=t;3===t.rank&&(a=zo(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=zo(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:u},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,filterShape:n};return en.runKernel("DepthwiseConv2dNativeBackpropFilter",c,l)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sc=cr({depthwiseConv2dNativeBackpropInput_:function(t,e,n,r,s,o=[1,1],i){let a=e,u=!1;3===e.rank&&(u=!0,a=zo(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,inputShape:t},f=en.runKernel("DepthwiseConv2dNativeBackpropInput",c,l);return u?zo(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _c=cr({fusedDepthwiseConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(!1===Nc(en.state.gradientDepth,u)){let f=Ni(t,e,n,r,s,o,i);return null!=a&&(f=fo(f,a)),xc(f,u,c,l)}const f=ar(t,"x","depthwiseConv2d","float32"),h=ar(e,"filter","depthwiseConv2d","float32");let p=f,d=!1;3===f.rank&&(d=!0,p=zo(f,[1,f.shape[0],f.shape[1],f.shape[2]])),x(4===p.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`)),x(4===h.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`)),x(p.shape[3]===h.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${p.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`)),null==o&&(o=[1,1]),x(Po(n,o),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),Vo("fused depthwiseConv2d",r,i);const m=Co(p.shape,h.shape,n,o,r,i,!0);let y,g;null!=a&&(y=ar(a,"bias","fused conv2d"),[y]=qe(y,f),Ms(m.outShape,y.shape)),null!=c&&(g=ar(c,"prelu weights","fused depthwiseConv2d"));const b=(t,e)=>{x(Lo(o),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`));const[s,a,c,l]=e,f=wc(t,c,u),h=Sc(a.shape,f,s,n,r,o,i),p=Ec(a,f,s.shape,n,r,o,i);if(null!=l){return[h,p,vc(y,f)]}return[h,p]},w={x:p,filter:h,bias:y,preluActivationWeights:g},v={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=pa(((t,e,n)=>{let r=en.runKernel("FusedDepthwiseConv2D",w,v);return n([e,t,r]),d&&(r=zo(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}}));return t(p,h)}{const t=pa(((t,e,n,r)=>{let s=en.runKernel("FusedDepthwiseConv2D",w,v);return r([e,t,s,n]),d&&(s=zo(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:b}}));return t(p,h,y)}}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tc=cr({fusedMatMul_:function({a:t,b:e,transposeA:n=!1,transposeB:r=!1,bias:s,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a}){if(!1===Nc(en.state.gradientDepth,o)){let u=gs(t,e,n,r);return null!=s&&(u=fo(u,s)),xc(u,o,i,a)}let u=ar(t,"a","fused matMul"),c=ar(e,"b","fused matMul");[u,c]=qe(u,c);const l=n?u.shape[u.rank-2]:u.shape[u.rank-1],f=r?c.shape[c.rank-1]:c.shape[c.rank-2],h=n?u.shape[u.rank-1]:u.shape[u.rank-2],p=r?c.shape[c.rank-2]:c.shape[c.rank-1],d=u.shape.slice(0,-2),m=c.shape.slice(0,-2),y=S(d),g=S(m);x(l===f,(()=>`Error in fused matMul: inner shapes (${l}) and (${f}) of Tensors with shapes ${u.shape} and ${c.shape} and transposeA=${n} and transposeB=${r} must match.`));const b=Ms(u.shape.slice(0,-2),c.shape.slice(0,-2)).concat([h,p]),w=zo(u,n?[y,l,h]:[y,h,l]),v=zo(c,r?[g,p,f]:[g,f,p]);let N,$;null!=s&&(N=ar(s,"bias","fused matMul"),[N]=qe(N,u),Ms(b,N.shape)),null!=i&&($=ar(i,"prelu weights","fused matMul"));const E=(t,e)=>{const[i,a,u,c]=e,l=wc(zo(t,u.shape),u,o);let f,h;if(n||r?!n&&r?(f=gs(l,a,!1,!1),h=gs(l,i,!0,!1)):n&&!r?(f=gs(a,l,!1,!0),h=gs(i,l,!1,!1)):(f=gs(a,l,!0,!0),h=gs(l,i,!0,!0)):(f=gs(l,a,!1,!0),h=gs(i,l,!0,!1)),null!=s){return[f,h,vc(c,l)]}return[f,h]},_={a:w,b:v,bias:N,preluActivationWeights:$},T={transposeA:n,transposeB:r,activation:o,leakyreluAlpha:a};if(null==s){const t=pa(((t,e,n)=>{const r=en.runKernel("_FusedMatMul",_,T);return n([t,e,r]),{value:zo(r,b),gradFunc:E}}));return t(w,v)}{const t=pa(((t,e,n,r)=>{const s=en.runKernel("_FusedMatMul",_,T);return r([t,e,s,n]),{value:zo(s,b),gradFunc:E}}));return t(w,v,N)}}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var kc=Object.freeze({__proto__:null,conv2d:$c,depthwiseConv2d:_c,matMul:Tc});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ac=cr({hammingWindow_:function(t){return yc(t,.54,.46)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cc=cr({hannWindow_:function(t){return yc(t,.5,.5)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oc=cr({frame_:function(t,e,n,r=!1,s=0){let o=0;const i=[];for(;o+e<=t.size;)i.push(qo(t,o,e)),o+=n;if(r)for(;o<t.size;){const r=o+e-t.size,a=jo([qo(t,o,e-r),Yi([r],s)]);i.push(a),o+=n}return 0===i.length?tc([],[0,e]):zo(jo(i),[i.length,e])}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ic=cr({stft_:function(t,e,n,r,s=Cc){null==r&&(r=mc(e));const o=Oc(t,e,n),i=mo(o,s(e));return qu(i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mc=cr({cropAndResize_:function(t,e,n,r,s="bilinear",o=0){const i=ar(t,"image","cropAndResize"),a=ar(e,"boxes","cropAndResize","float32"),u=ar(n,"boxInd","cropAndResize","int32"),c=a.shape[0];x(4===i.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`)),x(2===a.rank&&4===a.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`)),x(1===u.rank&&u.shape[0]===c,(()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`)),x(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),x(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),x("bilinear"===s||"nearest"===s,(()=>`method must be bilinear or nearest, but was ${s}`));const l={image:i,boxes:a,boxInd:u},f={method:s,extrapolationValue:o,cropSize:r};return en.runKernel("CropAndResize",l,f)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rc=cr({flipLeftRight_:function(t){const e=ar(t,"image","flipLeftRight","float32");x(4===e.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`));const n={image:e};return en.runKernel("FlipLeftRight",n,{})}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dc=cr({grayscaleToRGB_:function(t){const e=ar(t,"image","grayscaleToRGB"),n=e.rank-1,r=e.shape[n];x(e.rank>=2,(()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`)),x(1===r,(()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`));const s=new Array(e.rank);return s.fill(1,0,n),s[n]=3,Xi(e,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fc=cr({rotateWithOffset_:function(t,e,n=0,r=.5){const s=ar(t,"image","rotateWithOffset","float32");x(4===s.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${s.rank}.`));const o={image:s},i={radians:e,fillValue:n,center:r};return en.runKernel("RotateWithOffset",o,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lc(t,e,n,r,s,o){null==r&&(r=.5),null==s&&(s=Number.NEGATIVE_INFINITY),null==o&&(o=0);const i=t.shape[0];return n=Math.min(n,i),x(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),x(2===t.rank,(()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`)),x(4===t.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`)),x(1===e.rank,(()=>"scores must be a 1D tensor")),x(e.shape[0]===i,(()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`)),x(0<=o&&o<=1,(()=>`softNmsSigma must be in [0, 1], but was '${o}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:s,softNmsSigma:o}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pc=cr({nonMaxSuppression_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const o=ar(t,"boxes","nonMaxSuppression","float32"),i=ar(e,"scores","nonMaxSuppression","float32"),a=Lc(o,i,n,r,s),u={maxOutputSize:n=a.maxOutputSize,iouThreshold:r=a.iouThreshold,scoreThreshold:s=a.scoreThreshold};return en.runKernel("NonMaxSuppressionV3",{boxes:o,scores:i},u)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bc(t,e,n){const r=function(t,e,n){return function(t,e,n){let r=0,s=t.length,o=0,i=!1;for(;r<s;){o=r+(s-r>>>1);const a=n(e,t[o]);a>0?r=o+1:(s=o,i=!a)}return i?r:-r-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e,n||Vc)}(t,e,n),s=r<0?-(r+1):r;t.splice(s,0,e)}function Vc(t,e){return t>e?1:t<e?-1:0}function zc(t,e,n,r,s){return jc(t,e,n,r,s,0)}function Wc(t,e,n,r,s,o){return jc(t,e,n,r,s,0,!1,o,!0)}function Uc(t,e,n,r,s,o){return jc(t,e,n,r,s,o,!0)}function jc(t,e,n,r,s,o,i=!1,a=!1,u=!1){const c=[];for(let t=0;t<e.length;t++)e[t]>s&&c.push({score:e[t],boxIndex:t,suppressBeginIndex:0});c.sort(Hc);const l=o>0?-.5/o:0,f=[],h=[];for(;f.length<n&&c.length>0;){const e=c.pop(),{score:n,boxIndex:o,suppressBeginIndex:i}=e;if(n<s)break;let a=!1;for(let n=f.length-1;n>=i;--n){const i=Gc(t,o,f[n]);if(i>=r){a=!0;break}if(e.score=e.score*qc(r,l,i),e.score<=s)break}e.suppressBeginIndex=f.length,a||(e.score===n?(f.push(o),h.push(e.score)):e.score>s&&Bc(c,e,Hc))}const p=f.length,d=n-p;a&&d>0&&(f.push(...new Array(d).fill(0)),h.push(...new Array(d).fill(0)));const m={selectedIndices:f};return i&&(m.selectedScores=h),u&&(m.validOutputs=p),m}function Gc(t,e,n){const r=t.subarray(4*e,4*e+4),s=t.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(s[0],s[2]),l=Math.min(s[1],s[3]),f=Math.max(s[0],s[2]),h=Math.max(s[1],s[3]),p=(a-o)*(u-i),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;const m=Math.max(o,c),y=Math.max(i,l),g=Math.min(a,f),b=Math.min(u,h),w=Math.max(g-m,0)*Math.max(b-y,0);return w/(p+d-w)}function qc(t,e,n){const r=Math.exp(e*n*n);return n<=t?r:0}function Hc(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kc=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const o=ar(t,"boxes","nonMaxSuppressionAsync"),i=ar(e,"scores","nonMaxSuppressionAsync"),a=Lc(o,i,n,r,s);n=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;const u=await Promise.all([o.data(),i.data()]),c=u[0],l=u[1],{selectedIndices:f}=zc(c,l,n,r,s);return o!==t&&o.dispose(),i!==e&&i.dispose(),Qu(f,"int32")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xc=cr({nonMaxSuppressionWithScore_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=ar(t,"boxes","nonMaxSuppression"),a=ar(e,"scores","nonMaxSuppression"),u=Lc(i,a,n,r,s,o),c={boxes:i,scores:a},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:s=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},f=en.runKernel("NonMaxSuppressionV5",c,l);return{selectedIndices:f[0],selectedScores:f[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jc=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=ar(t,"boxes","nonMaxSuppressionAsync"),a=ar(e,"scores","nonMaxSuppressionAsync"),u=Lc(i,a,n,r,s,o);n=u.maxOutputSize,r=u.iouThreshold,s=u.scoreThreshold,o=u.softNmsSigma;const c=await Promise.all([i.data(),a.data()]),l=c[0],f=c[1],{selectedIndices:h,selectedScores:p}=Uc(l,f,n,r,s,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:Qu(h,"int32"),selectedScores:Qu(p)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yc=cr({nonMaxSuppressionPadded_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=ar(t,"boxes","nonMaxSuppression"),a=ar(e,"scores","nonMaxSuppression"),u=Lc(i,a,n,r,s,null),c={boxes:i,scores:a},l={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:o},f=en.runKernel("NonMaxSuppressionV4",c,l);return{selectedIndices:f[0],validOutputs:f[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zc=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=ar(t,"boxes","nonMaxSuppressionAsync"),a=ar(e,"scores","nonMaxSuppressionAsync"),u=Lc(i,a,n,r,s,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[h,p]=await Promise.all([i.data(),a.data()]),{selectedIndices:d,validOutputs:m}=Wc(h,p,c,l,f,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:Qu(d,"int32"),validOutputs:Bi(m,"int32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qc=cr({resizeBilinear_:function(t,e,n=!1,r=!1){const s=ar(t,"images","resizeBilinear");x(3===s.rank||4===s.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${s.rank}.`)),x(2===e.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`)),x(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=zo(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=en.runKernel("ResizeBilinear",a,u);return i?zo(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tl=cr({resizeNearestNeighbor_:function(t,e,n=!1,r=!1){const s=ar(t,"images","resizeNearestNeighbor");x(3===s.rank||4===s.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${s.rank}.`)),x(2===e.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`)),x("float32"===s.dtype||"int32"===s.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),x(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=zo(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=en.runKernel("ResizeNearestNeighbor",a,u);return i?zo(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const el=cr({threshold_:function(t,e="binary",n=!1,r=.5){const s=ar(t,"image","threshold"),o=s.shape[0]*s.shape[1];let i,a,u,c,l=mo(Qu([r]),255);if(x(3===s.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${s.rank}.`)),x(3===s.shape[2]||1===s.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${s.shape[2]}.`)),x("int32"===s.dtype||"float32"===s.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${s.dtype}.`)),x("otsu"===e||"binary"===e,(()=>`Method must be binary or otsu, but was ${e}`)),3===s.shape[2]){[i,a,u]=Gu(s,[1,1,1],-1);const t=mo(i,.2989),e=mo(a,.587),n=mo(u,.114);c=fo(fo(t,e),n)}else c=t;if("otsu"===e){l=function(t,e){let n,r,s,o,i,a,u=Qu([-1]),c=Qu([0]),l=Qu([0]);for(let f=0;f<t.size-1;f++){n=qo(t,0,f+1),r=qo(t,f+1),i=po(Wi(n),e),a=po(Wi(r),e);const h=Wi(mo(n,vu(0,n.size)));s=po(h,Wi(n));const p=Yi(r.shape,n.size),d=fo(vu(0,r.size),p),m=mo(r,d);o=po(Wi(m),Wi(r));const y=ga(s,o),g=ga(s,o),b=mo(i,a);l=mo(mo(b,y),g);const w=ta(l,c);c=_i(w,l,c),u=_i(w,Qu([f]),u)}return u}(ti(Zr(Au(c),"int32"),hr([]),256),o)}const f=n?aa(c,l):ta(c,l);return Zr(mo(f,255),"int32")}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nl=cr({transform_:function(t,e,n="nearest",r="constant",s=0,o){const i=ar(t,"image","transform","float32"),a=ar(e,"transforms","transform","float32");x(4===i.rank,(()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`)),x(2===a.rank&&(a.shape[0]===i.shape[0]||1===a.shape[0])&&8===a.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),x(null==o||2===o.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`));const u={image:i,transforms:a},c={interpolation:n,fillMode:r,fillValue:s,outputShape:o};return en.runKernel("Transform",u,c)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rl=cr({bandPart_:function(t,e,n){x(e%1==0,(()=>`bandPart(): numLower must be an integer, got ${e}.`)),x(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`));const r=ar(t,"a","bandPart");x(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));const s=r.shape,[o,i]=r.shape.slice(-2);if(!(e<=o))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`);if(!(n<=i))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${i}).`);e<0&&(e=o),n<0&&(n=i);const a=zo(vu(0,o,1,"int32"),[-1,1]),u=vu(0,i,1,"int32"),c=ga(a,u),l=va(aa(c,Bi(+e,"int32")),ea(c,Bi(-n,"int32"))),f=Oa([o,i],r.dtype);return zo(Xu(oc(zo(r,[-1,o,i])).map((t=>_i(l,t,f)))),s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sl=cr({gramSchmidt_:function(t){let e;if(Array.isArray(t)){e=!1,x(null!=t&&t.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=t[0].shape[0];for(let e=1;e<t.length;++e)x(t[e].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[e].shape[0]} vs. ${n})`))}else e=!0,t=Gu(t,t.shape[0],0).map((t=>Ku(t,[0])));x(t.length<=t[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`));const n=[],r=t;for(let e=0;e<t.length;++e)n.push(en.tidy((()=>{let t=r[e];if(e>0)for(let r=0;r<e;++r){const e=mo(Wi(mo(n[r],t)),n[r]);t=ga(t,e)}return po(t,ji(t,"euclidean"))})));return e?Xu(n,0):n}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ol(t,e=!1){return en.tidy((()=>{x(2===t.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`));const n=t.shape[0],r=t.shape[1];let s=Ji(n),o=Qr(t);const i=tc([[1]],[1,1]);let a=Qr(i);const u=n>=r?r:n;for(let t=0;t<u;++t){const e=o,u=a,c=s;[a,o,s]=en.tidy((()=>{const e=qo(o,[t,t],[n-t,1]),u=ji(e),c=qo(o,[t,t],[1,1]),l=_i(ta(c,0),tc([[-1]]),tc([[1]])),f=ga(c,mo(l,u)),h=po(e,f);a=1===h.shape[0]?Qr(i):jo([i,qo(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);const p=_s(po(gs(l,f),u)),d=qo(o,[t,0],[n-t,r]),m=mo(p,a),y=ks(a);if(0===t)o=ga(d,gs(m,gs(y,d)));else{const e=ga(d,gs(m,gs(y,d)));o=jo([qo(o,[0,0],[t,r]),e],0)}const g=ks(m),b=qo(s,[0,t],[n,s.shape[1]-t]);if(0===t)s=ga(b,gs(gs(b,a),g));else{const e=ga(b,gs(gs(b,a),g));s=jo([qo(s,[0,0],[n,t]),e],1)}return[a,o,s]})),xs([e,u,c])}return!e&&n>r&&(s=qo(s,[0,0],[n,r]),o=qo(o,[0,0],[r,r])),[s,o]}))}const il=cr({qr_:function(t,e=!1){if(x(t.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`)),2===t.rank)return ol(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce(((t,e)=>t*e)),r=oc(zo(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),s=[],o=[];r.forEach((t=>{const[n,r]=ol(t,e);s.push(n),o.push(r)}));return[zo(Xu(s,0),t.shape),zo(Xu(o,0),t.shape)]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var al;!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(al||(al={}));const ul=cr({computeWeightedLoss_:function(t,e,n=al.SUM_BY_NONZERO_WEIGHTS){const r=ar(t,"losses","computeWeightedLoss");let s=null;null!=e&&(s=ar(e,"weights","computeWeightedLoss"));const o=null==s?r:mo(r,s);if(n===al.NONE)return o;if(n===al.SUM)return Wi(o);if(n===al.MEAN){if(null==s)return Ca(o);{const t=r.size/s.size,e=po(Wi(o),Wi(s));return t>1?po(e,Bi(t)):e}}if(n===al.SUM_BY_NONZERO_WEIGHTS){if(null==s)return po(Wi(o),Bi(r.size));{const t=mo(s,Ia(r.shape)),e=Zr(Wi(Ba(t,Bi(0))),"float32");return po(Wi(o),e)}}throw Error(`Unknown reduction: ${n}`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cl=cr({absoluteDifference_:function(t,e,n,r=al.SUM_BY_NONZERO_WEIGHTS){const s=ar(t,"labels","absoluteDifference"),o=ar(e,"predictions","absoluteDifference");let i=null;null!=n&&(i=ar(n,"weights","absoluteDifference")),N(s.shape,o.shape,"Error in absoluteDifference: ");const a=yo(ga(s,o));return ul(a,i,r)}});const ll=cr({cosineDistance_:function(t,e,n,r,s=al.SUM_BY_NONZERO_WEIGHTS){const o=ar(t,"labels","cosineDistance"),i=ar(e,"predictions","cosineDistance");let a=null;null!=r&&(a=ar(r,"weights","cosineDistance")),N(o.shape,i.shape,"Error in cosineDistance: ");const u=Bi(1),c=ga(u,Wi(mo(o,i),n,!0));return ul(c,a,s)}});const fl=cr({hingeLoss_:function(t,e,n,r=al.SUM_BY_NONZERO_WEIGHTS){let s=ar(t,"labels","hingeLoss");const o=ar(e,"predictions","hingeLoss");let i=null;null!=n&&(i=ar(n,"weights","hingeLoss")),N(s.shape,o.shape,"Error in hingeLoss: ");const a=Bi(1);s=ga(mo(Bi(2),s),a);const u=Nu(ga(a,mo(s,o)));return ul(u,i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hl=cr({huberLoss_:function(t,e,n,r=1,s=al.SUM_BY_NONZERO_WEIGHTS){const o=ar(t,"labels","huberLoss"),i=ar(e,"predictions","huberLoss");let a=null;null!=n&&(a=ar(n,"weights","huberLoss")),N(o.shape,i.shape,"Error in huberLoss: ");const u=Bi(r),c=yo(ga(i,o)),l=Ma(c,u),f=ga(c,l),h=fo(mo(Bi(.5),zi(l)),mo(u,f));return ul(h,a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pl=cr({logLoss_:function(t,e,n,r=1e-7,s=al.SUM_BY_NONZERO_WEIGHTS){const o=ar(t,"labels","logLoss"),i=ar(e,"predictions","logLoss");let a=null;null!=n&&(a=ar(n,"weights","logLoss")),N(o.shape,i.shape,"Error in logLoss: ");const u=Bi(1),c=Bi(r),l=_s(mo(o,la(fo(i,c)))),f=mo(ga(u,o),la(fo(ga(u,i),c))),h=ga(l,f);return ul(h,a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dl=cr({meanSquaredError_:function(t,e,n,r=al.SUM_BY_NONZERO_WEIGHTS){const s=ar(t,"labels","meanSquaredError"),o=ar(e,"predictions","meanSquaredError");let i=null;null!=n&&(i=ar(n,"weights","meanSquaredError")),N(s.shape,o.shape,"Error in meanSquaredError: ");const a=Hu(s,o);return ul(a,i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ml=cr({sigmoidCrossEntropy_:function(t,e,n,r=0,s=al.SUM_BY_NONZERO_WEIGHTS){let o=ar(t,"multiClassLabels","sigmoidCrossEntropy");const i=ar(e,"logits","sigmoidCrossEntropy");let a=null;if(null!=n&&(a=ar(n,"weights","sigmoidCrossEntropy")),N(o.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){const t=Bi(r),e=Bi(1),n=Bi(.5);o=fo(mo(o,ga(e,t)),mo(n,t))}const u=function(t,e){const n=ar(t,"labels","sigmoidCrossEntropyWithLogits"),r=ar(e,"logits","sigmoidCrossEntropyWithLogits");N(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const s=Nu(r),o=mo(r,n),i=fa(qi(_s(yo(r))));return fo(ga(s,o),i)}(o,i);return ul(u,a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yl=cr({softmaxCrossEntropy_:function(t,e,n,r=0,s=al.SUM_BY_NONZERO_WEIGHTS){let o=ar(t,"onehotLabels","softmaxCrossEntropy");const i=ar(e,"logits","softmaxCrossEntropy");let a=null;if(null!=n&&(a=ar(n,"weights","softmaxCrossEntropy")),N(o.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){const t=Bi(r),e=Bi(1),n=Bi(o.shape[1]);o=fo(mo(o,ga(e,t)),po(t,n))}const u=function(t,e,n=-1){if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);const r=pa(((t,e,r)=>{const s=wa(e,[n],!0),o=ga(Zr(e,"float32"),s);r([t,o]);const i=_s(mo(o,t));return{value:Wi(i,[n]),gradFunc:(t,e)=>{const[r,s]=e,o=Di(t.shape,[n]);return[mo(zo(t,o),ga(Zr(r,"float32"),qi(s))),mo(zo(t,o),ga(qi(s),Zr(r,"float32")))]}}}));return r(t,e)}(o,i);return ul(u,a,s)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gl=cr({sparseFillEmptyRows_:function(t,e,n,r){const s=ar(t,"indices","sparseFillEmptyRows","int32"),o=ar(e,"values","sparseFillEmptyRows"),i=ar(n,"denseShape","sparseFillEmptyRows","int32"),a=ar(r,"defaultValue","sparseFillEmptyRows",o.dtype);if(2!==s.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${s.shape}`);if(1!==o.rank)throw new Error(`Values should be Tensor1D but received shape ${o.shape}`);if(1!==i.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${i.shape}`);if(0!==a.rank)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const u={indices:s,values:o,denseShape:i,defaultValue:a},c=en.runKernel("SparseFillEmptyRows",u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bl=cr({sparseReshape_:function(t,e,n){const r=ar(t,"inputIndices","sparseReshape","int32"),s=ar(e,"inputShape","sparseReshape","int32"),o=ar(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==s.rank)throw new Error(`Input shape should be Tensor1D but received shape ${s.shape}`);if(1!==o.rank)throw new Error(`New shape should be Tensor1D but received shape ${o.shape}`);const i={inputIndices:r,inputShape:s,newShape:o},a=en.runKernel("SparseReshape",i);return{outputIndices:a[0],outputShape:a[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wl=cr({sparseSegmentMean_:function(t,e,n){const r=ar(t,"data","sparseSegmentMean"),s=ar(e,"indices","sparseSegmentMean","int32"),o=ar(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return en.runKernel("SparseSegmentMean",i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vl=cr({sparseSegmentSum_:function(t,e,n){const r=ar(t,"data","sparseSegmentSum"),s=ar(e,"indices","sparseSegmentSum","int32"),o=ar(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return en.runKernel("SparseSegmentSum",i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xl=cr({stringNGrams_:function(t,e,n,r,s,o,i,a){const u=ar(t,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error(`Data must be a vector, saw: ${u.shape}`);const c=ar(e,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");const l={separator:n,nGramWidths:r,leftPad:s,rightPad:o,padWidth:i,preserveShortSequences:a},f={data:u,dataSplits:c},h=en.runKernel("StringNGrams",f,l);return{nGrams:h[0],nGramsSplits:h[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nl=cr({stringSplit_:function(t,e,n=!0){const r=ar(t,"input","stringSplit","string"),s=ar(e,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(0!==s.rank)throw new Error(`Delimiter should be a scalar but received shape ${s.shape}`);const o={skipEmpty:n},i={input:r,delimiter:s},a=en.runKernel("StringSplit",i,o);return{indices:a[0],values:a[1],shape:a[2]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $l=cr({stringToHashBucketFast_:function(t,e){const n=ar(t,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const s={input:n};return en.runKernel("StringToHashBucketFast",s,r)}}),El={fft:Wu,ifft:Uu,rfft:qu,irfft:ju},Sl={hammingWindow:Ac,hannWindow:Cc,frame:Oc,stft:Ic},_l={flipLeftRight:Rc,grayscaleToRGB:Dc,resizeNearestNeighbor:tl,resizeBilinear:Qc,rotateWithOffset:Fc,cropAndResize:Mc,nonMaxSuppression:Pc,nonMaxSuppressionAsync:Kc,nonMaxSuppressionWithScore:Xc,nonMaxSuppressionWithScoreAsync:Jc,nonMaxSuppressionPadded:Yc,nonMaxSuppressionPaddedAsync:Zc,threshold:el,transform:nl},Tl={bandPart:rl,gramSchmidt:sl,qr:il},kl={absoluteDifference:cl,computeWeightedLoss:ul,cosineDistance:ll,hingeLoss:fl,huberLoss:hl,logLoss:pl,meanSquaredError:dl,sigmoidCrossEntropy:ml,softmaxCrossEntropy:yl},Al={sparseFillEmptyRows:gl,sparseReshape:bl,sparseSegmentMean:wl,sparseSegmentSum:vl},Cl={stringNGrams:xl,stringSplit:Nl,stringToHashBucketFast:$l};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Ol extends ro{minimize(t,e=!1,n){const{value:r,grads:s}=this.computeGradients(t,n);if(null!=n){const t=n.map((t=>({name:t.name,tensor:s[t.name]})));this.applyGradients(t)}else this.applyGradients(s);return xs(s),e?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return ha(t,e)}dispose(){null!=this.iterations_&&xs(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:Bi(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(Ol,Symbol.hasInstance,{value:t=>null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Il extends Ol{constructor(t,e,n=null){super(),this.learningRate=t,this.rho=e,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=en.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=en.registeredVariables[e];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${e}/accum_grad`,variable:vs((()=>Ti(r).variable(false)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${e}/accum_var`,variable:vs((()=>Ti(r).variable(false)))});const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const o=this.accumulatedGrads[n].variable,i=this.accumulatedUpdates[n].variable;vs((()=>{const t=fo(mo(o,this.rho),mo(zi(s),1-this.rho)),e=mo(po(Vi(fo(i,this.epsilon)),Vi(fo(o,this.epsilon))),s),n=fo(mo(i,this.rho),mo(zi(e),1-this.rho));o.assign(t),i.assign(n);const a=fo(mo(e,-this.learningRate),r);r.assign(a)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(xs(this.accumulatedGrads.map((t=>t.variable))),xs(this.accumulatedUpdates.map((t=>t.variable))))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){const e=(t=await this.extractIterations(t)).length/2;this.accumulatedGrads=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedUpdates=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}Il.className="Adadelta",oo(Il);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Ml extends Ol{constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=en.registeredVariables[e];if(null==this.accumulatedGrads[n]){const t=!1;this.accumulatedGrads[n]={originalName:`${e}/accumulator`,variable:vs((()=>Yi(r.shape,this.initialAccumulatorValue).variable(t)))}}const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const o=this.accumulatedGrads[n].variable;vs((()=>{const t=fo(o,zi(s));o.assign(t);const e=fo(mo(po(s,Vi(fo(t,en.backend.epsilon()))),-this.learningRate),r);r.assign(e)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&xs(this.accumulatedGrads.map((t=>t.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulatedGrads=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}Ml.className="Adagrad",oo(Ml);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Rl extends Ol{constructor(t,e,n,r=null){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],vs((()=>{this.accBeta1=Bi(e).variable(),this.accBeta2=Bi(n).variable()})),null==r&&(this.epsilon=en.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);vs((()=>{const n=ga(1,this.accBeta1),r=ga(1,this.accBeta2);e.forEach(((e,s)=>{const o=en.registeredVariables[e];null==this.accumulatedFirstMoment[s]&&(this.accumulatedFirstMoment[s]={originalName:`${e}/m`,variable:vs((()=>Ti(o).variable(false)))}),null==this.accumulatedSecondMoment[s]&&(this.accumulatedSecondMoment[s]={originalName:`${e}/v`,variable:vs((()=>Ti(o).variable(false)))});const i=Array.isArray(t)?t[s].tensor:t[e];if(null==i)return;const a=this.accumulatedFirstMoment[s].variable,u=this.accumulatedSecondMoment[s].variable,c=fo(mo(a,this.beta1),mo(i,1-this.beta1)),l=fo(mo(u,this.beta2),mo(zi(i),1-this.beta2)),f=po(c,n),h=po(l,r);a.assign(c),u.assign(l);const p=fo(mo(po(f,fo(Vi(h),this.epsilon)),-this.learningRate),o);o.assign(p)})),this.accBeta1.assign(mo(this.accBeta1,this.beta1)),this.accBeta2.assign(mo(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&xs(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedSecondMoment&&xs(this.accumulatedSecondMoment.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t),vs((()=>{this.accBeta1.assign(Pi(this.beta1,this.iterations_+1)),this.accBeta2.assign(Pi(this.beta2,this.iterations_+1))}));const e=t.length/2;this.accumulatedFirstMoment=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedSecondMoment=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}Rl.className="Adam",oo(Rl);
/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/
class Dl extends Ol{constructor(t,e,n,r=null,s=0){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],vs((()=>{this.iteration=Bi(0).variable(),this.accBeta1=Bi(e).variable()})),null==r&&(this.epsilon=en.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);vs((()=>{const n=ga(1,this.accBeta1),r=po(-this.learningRate,fo(mo(this.iteration,this.decay),1));e.forEach(((e,s)=>{const o=en.registeredVariables[e];null==this.accumulatedFirstMoment[s]&&(this.accumulatedFirstMoment[s]={originalName:`${e}/m`,variable:Ti(o).variable(false)}),null==this.accumulatedWeightedInfNorm[s]&&(this.accumulatedWeightedInfNorm[s]={originalName:`${e}/v`,variable:Ti(o).variable(false)});const i=Array.isArray(t)?t[s].tensor:t[e];if(null==i)return;const a=this.accumulatedFirstMoment[s].variable,u=this.accumulatedWeightedInfNorm[s].variable,c=fo(mo(a,this.beta1),mo(i,1-this.beta1)),l=mo(u,this.beta2),f=yo(i),h=Aa(l,f);a.assign(c),u.assign(h);const p=fo(mo(po(r,n),po(c,fo(h,this.epsilon))),o);o.assign(p)})),this.iteration.assign(fo(this.iteration,1)),this.accBeta1.assign(mo(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&xs(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedWeightedInfNorm&&xs(this.accumulatedWeightedInfNorm.map((t=>t.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}Dl.className="Adamax",oo(Dl);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Fl extends Ol{constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);e.forEach(((e,n)=>{const r=Array.isArray(t)?t[n].tensor:t[e];if(null==r)return;const s=en.registeredVariables[e];vs((()=>{const t=fo(mo(this.c,r),s);s.assign(t)}))})),this.incrementIterations()}setLearningRate(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=Ns(Bi(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(0!==(t=await this.extractIterations(t)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}Fl.className="SGD",oo(Fl);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Ll extends Fl{constructor(t,e,n=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=n,this.accumulations=[],this.m=Bi(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=en.registeredVariables[e];if(null==this.accumulations[n]){const t=!1;this.accumulations[n]={originalName:`${e}/momentum`,variable:vs((()=>Ti(r).variable(t)))}}const s=this.accumulations[n].variable,o=Array.isArray(t)?t[n].tensor:t[e];null!=o&&vs((()=>{let t;const e=fo(mo(this.m,s),o);t=this.useNesterov?fo(mo(this.c,fo(o,mo(e,this.m))),r):fo(mo(this.c,e),r),s.assign(e),r.assign(t)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&xs(this.accumulations.map((t=>t.variable)))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulations=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}Ll.className="Momentum",oo(Ll);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Pl extends Ol{constructor(t,e=.9,n=0,r=null,s=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,null==r&&(this.epsilon=en.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=en.registeredVariables[e],s=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${e}/rms`,variable:vs((()=>Ti(r).variable(s)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${e}/momentum`,variable:vs((()=>Ti(r).variable(s)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${e}/mg`,variable:vs((()=>Ti(r).variable(s)))});const o=Array.isArray(t)?t[n].tensor:t[e];if(null==o)return;const i=this.accumulatedMeanSquares[n].variable,a=this.accumulatedMoments[n].variable;vs((()=>{const t=fo(mo(i,this.decay),mo(zi(o),1-this.decay));if(this.centered){const e=this.accumulatedMeanGrads[n].variable,s=fo(mo(e,this.decay),mo(o,1-this.decay)),u=po(mo(o,this.learningRate),Vi(ga(t,fo(zi(s),this.epsilon)))),c=fo(mo(a,this.momentum),u);i.assign(t),e.assign(s),a.assign(c);const l=ga(r,c);r.assign(l)}else{const t=fo(mo(i,this.decay),mo(zi(o),1-this.decay)),e=fo(mo(a,this.momentum),po(mo(o,this.learningRate),Vi(fo(t,this.epsilon))));i.assign(t),a.assign(e);const n=ga(r,e);r.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&xs(this.accumulatedMeanSquares.map((t=>t.variable))),null!=this.accumulatedMeanGrads&&this.centered&&xs(this.accumulatedMeanGrads.map((t=>t.variable))),null!=this.accumulatedMoments&&xs(this.accumulatedMoments.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,n=!1;this.accumulatedMeanSquares=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.accumulatedMoments=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}Pl.className="RMSProp",oo(Pl);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Bl{static sgd(t){return new Fl(t)}static momentum(t,e,n=!1){return new Ll(t,e,n)}static rmsprop(t,e=.9,n=0,r=null,s=!1){return new Pl(t,e,n,r,s)}static adam(t=.001,e=.9,n=.999,r=null){return new Rl(t,e,n,r)}static adadelta(t=.001,e=.95,n=null){return new Il(t,e,n)}static adamax(t=.002,e=.9,n=.999,r=null,s=0){return new Dl(t,e,n,r,s)}static adagrad(t,e=.1){return new Ml(t,e)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vl={sgd:Bl.sgd,momentum:Bl.momentum,adadelta:Bl.adadelta,adagrad:Bl.adagrad,rmsprop:Bl.rmsprop,adamax:Bl.adamax,adam:Bl.adam},zl="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:t=>t();
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Wl=/->/g;function Ul(t,e){const n=[];for(let r=0;r<t.length;++r)0!==t[r].length&&-1===t[r].indexOf(e)&&-1!==e||n.push(r);return n}var jl=Object.freeze({__proto__:null,segOpComputeOptimalWindowSize:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n,r=!1;for(t<=30?(n=t,r=!0):n=U(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=U(t,n+1);return n},computeOutShape:function(t,e,n){const r=[],s=t.length;for(let o=0;o<s;o++)o!==e?r.push(t[o]):r.push(n);return r},collectGatherOpShapeInfo:function(t,e,n,r){const s=e.shape.length,o=t.shape.length;if(0!==r&&(r<-s||r>s))throw new Error(`Expect batchDims in the range of [-${s}, ${s}], but got ${r}`);if(r<0&&(r+=s),r>o)throw new Error(`batchDims (${r}) must be less than rank(x) (\n    ${o}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let n=0;n<r;++n)if(t.shape[n]!==e.shape[n])throw new Error(`x.shape[${n}]: ${t.shape[n]} should be equal to indices.shape[${n}]: ${e.shape[n]}.`);const i=t.shape[n],a=[];let u=1,c=1,l=1;for(let e=0;e<r;++e)a.push(t.shape[e]),u*=t.shape[e];for(let e=r;e<n;e++)a.push(t.shape[e]),c*=t.shape[e];for(let t=r;t<s;t++)a.push(e.shape[t]);for(let e=n+1;e<o;e++)a.push(t.shape[e]),l*=t.shape[e];return{batchSize:u,sliceSize:l,outerSize:c,dimSize:i,outputShape:a}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Gl=Object.freeze({__proto__:null,slice_util:no,segment_util:jl,fromUint8ToStringArray:function(t){try{return t.map((t=>Ee(t)))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}},fromStringArrayToUint8:function(t){return t.map((t=>$e(t)))},upcastType:Ge,axesAreInnerMostDims:Mi,combineLocations:Ri,computeOutAndReduceShapes:function(t,e){const n=[],r=t.length;for(let s=0;s<r;s++)-1===e.indexOf(s)&&n.push(t[s]);return[n,e.map((e=>t[e]))]},expandShapeToKeepDim:Di,assertAxesAreInnerMostDims:function(t,e,n){x(Mi(e,n),(()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`))},getAxesPermutation:function(t,e){if(Mi(t,e))return null;const n=[];for(let r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach((t=>n.push(t))),n},getUndoAxesPermutation:function(t){return t.map(((t,e)=>[e,t])).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]))},getInnerMostAxes:function(t,e){const n=[];for(let r=e-t;r<e;++r)n.push(r);return n},getBroadcastDims:Os,getReductionAxes:Is,assertAndGetBroadcastShape:Ms,assertParamsConsistent:
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=t[0].length;t.forEach(((t,e)=>{x(t.length===n,(()=>`Error in concat${n}D: rank of tensors[${e}] must be the same as the rank of the rest (${n})`))})),x(e>=0&&e<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));const r=t[0];t.forEach(((t,s)=>{for(let o=0;o<n;o++)x(o===e||t[o]===r[o],(()=>`Error in concat${n}D: Shape of tensors[${s}] (${t}) does not match the shape of the rest (${r}) along the non-concatenated axis ${s}.`))}))},computeOutShape:function(t,e){const n=t[0].slice();for(let r=1;r<t.length;r++)n[e]+=t[r][e];return n}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,computeDilation2DInfo:function(t,e,n,r,s="NHWC",o){return Co(t,[...e,t[3]],n,o,r,null,null,Bo(s))},computePool2DInfo:Ao,computePool3DInfo:function(t,e,n,r,s,o,i="NDHWC"){const[a,u,c]=Ro(e);let l,f;if("NDHWC"===i)f="channelsLast",l=[a,u,c,t[4],t[4]];else{if("NCDHW"!==i)throw new Error(`Unknown dataFormat ${i}`);f="channelsFirst",l=[a,u,c,t[1],t[1]]}return Oo(t,l,n,r,s,!1,f,o)},computeConv2DInfo:Co,computeConv3DInfo:Oo,computeDefaultPad:Io,tupleValuesAreOne:Lo,eitherStridesOrDilationsAreOne:Po,convertConv2DDataFormat:Bo,checkPadOnDimRoundingMode:Vo,getFusedDyActivation:wc,getFusedBiasGradient:vc,applyActivation:xc,shouldFuse:Nc,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:function(t){return t<=30?t:U(t,Math.floor(Math.sqrt(t)))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getImageCenter:function(t,e,n){return[n*("number"==typeof t?t:t[0]),e*("number"==typeof t?t:t[1])]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getReshaped:function(t,e,n,r=!0){let s=[];if(r)s=s.concat(e.slice(0)),s.push(t[0]/n),s=s.concat(t.slice(1));else{s=s.concat(t[0]);const n=e.length;for(let r=0;r<n;++r)s=s.concat([t[r+1]/e[r],e[r]]);s=s.concat(t.slice(n+1))}return s},getPermuted:function(t,e,n=!0){const r=[];if(n){r.push(e);for(let n=e+1;n<t;++n)n<=2*e?(r.push(n),r.push(n-(e+1))):r.push(n)}else{const n=[],s=[];for(let r=1;r<t;++r)r>=2*e+1||r%2==1?s.push(r):n.push(r);r.push(...n),r.push(0),r.push(...s)}return r},getReshapedPermuted:function(t,e,n,r=!0){const s=[];r?s.push(t[0]/n):s.push(t[0]*n);for(let n=1;n<t.length;++n)n<=e.length?r?s.push(e[n-1]*t[n]):s.push(t[n]/e[n-1]):s.push(t[n]);return s},getSliceBeginCoords:function(t,e){const n=[0];for(let r=0;r<e;++r)n.push(t[r][0]);return n},getSliceSize:function(t,e,n){const r=t.slice(0,1);for(let s=0;s<n;++s)r.push(t[s+1]-e[s][0]-e[s][1]);return r}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,prepareAndValidate:zs,validateUpdateShape:Us,validateInput:js,calculateShapes:Gs,SELU_SCALEALPHA:1.7580993408473768,SELU_SCALE:1.0507009873554805,ERF_P:.3275911,ERF_A1:.254829592,ERF_A2:-.284496736,ERF_A3:1.421413741,ERF_A4:-1.453152027,ERF_A5:1.061405429,warn:Ct,log:function(...t){Q().getBool("IS_TEST")||Q().getBool("PROD")||console.log(...t)},mergeRealAndImagArrays:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(2*t.length);for(let r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n},splitRealAndImagArrays:function(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}},complexWithEvenIndex:function(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=0;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}},complexWithOddIndex:function(t){const e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=2;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}},getComplexWithIndex:function(t,e){return{real:t[2*e],imag:t[2*e+1]}},assignToTypedArray:function(t,e,n,r){t[2*r]=e,t[2*r+1]=n},exponents:function(t,e){const n=new Float32Array(t/2),r=new Float32Array(t/2);for(let s=0;s<Math.ceil(t/2);s++){const o=(e?2:-2)*Math.PI*(s/t);n[s]=Math.cos(o),r[s]=Math.sin(o)}return{real:n,imag:r}},exponent:function(t,e,n){const r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}},decodeEinsumEquation:function(t,e){const n=((t=t.replace(/\s/g,"")).length-t.replace(Wl,"").length)/"->".length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("->").');const[r,s]=t.split("->");x(-1===r.indexOf("..."),(()=>'The ellipsis notation ("...") is not supported yet.'));const o=r.split(","),i=o.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let t=0;t<s.length;++t){const e=s[t];if(!o.some((t=>-1!==t.indexOf(e))))throw new Error(`Output subscripts contain the label ${e} not present in the input subscripts.`);-1===a.indexOf(e)&&a.push(e)}for(let t=0;t<r.length;++t){const e=r[t];-1===a.indexOf(e)&&","!==e&&a.push(e)}const u=new Array(o.length);for(let t=0;t<i;++t){if(new Set(o[t].split("")).size!==o[t].length)throw new Error(`Found duplicate axes in input component ${o[t]}. Support for duplicate axes in input is not implemented yet.`);u[t]=[];for(let e=0;e<o[t].length;++e)u[t].push(a.indexOf(o[t][e]))}const c=a.length,l=[];for(let t=s.length;t<c;++t)l.push(t);return{allDims:a,summedDims:l,idDims:u}},getEinsumPermutation:function(t,e){let n=new Array(t);n.fill(-1);for(let t=0;t<e.length;++t)n[e[t]]=t;const r=[];for(let e=0;e<t;++e)-1===n[e]&&r.push(e);return n=n.filter((t=>-1!==t)),{permutationIndices:n,expandDims:r}},checkEinsumDimSizes:function(t,e,n){const r=new Array(t);for(let t=0;t<n.length;++t){const s=n[t].shape;for(let n=0;n<e[t].length;++n)void 0===r[e[t][n]]?r[e[t][n]]=s[n]:x(r[e[t][n]]===s[n],(()=>`Expected dimension ${r[e[t][n]]} at axis ${n} of input shaped ${JSON.stringify(s)}, but got dimension ${s[n]}`))}},getEinsumComputePath:function(t,e){const n=t,r=[];let s=0;0===t.length&&n.push(-1),s=t.length+1;for(let t=0;t<s;++t)r.push([]);const o=[];for(let t=0;t<n.length;++t){const s=Ul(e,n[t]);for(const e of s)-1===o.indexOf(e)&&(r[t].push(e),o.push(e))}return{path:n,steps:r}},isIdentityPermutation:function(t){return t.every(((t,e)=>t===e))},prepareSplitSize:function(t,e,n=0){let r=[];if("number"==typeof e)x(t.shape[n]%e==0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(e).fill(t.shape[n]/e);else{x(e.reduce(((t,e)=>(-1===e&&(t+=1),t)),0)<=1,(()=>"There should be only one negative value in split array."));const s=e.indexOf(-1);if(-1!==s){const r=e.reduce(((t,e)=>e>0?t+e:t));e[s]=t.shape[n]-r}x(t.shape[n]===e.reduce(((t,e)=>t+e)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=e}return r}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getSparseFillEmptyRowsIndicesDenseShapeMismatch:function(t){return`Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ${t}`},getSparseFillEmptyRowsNegativeIndexErrorMessage:function(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`},getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:function(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:function(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`},getSparseReshapeNegativeOutputDimErrorMessage:function(t,e){return`size ${t} must be non-negative, not ${e}`},getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:function(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"},getSparseReshapeInputOutputMultipleErrorMessage:function(t,e){return`Input to reshape is a SparseTensor with ${S(t)}\n  dense values, but the requested shape requires a multiple of ${S(e)}. inputShape=${t} outputShape= ${e}`},getSparseReshapeInputOutputMismatchErrorMessage:function(t,e){return`Input to reshape is a tensor with ${S(t)} dense values, but the requested shape has ${S(e)}. inputShape=${t} outputShape=${e}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:function(){return"segment ids must be >= 0"},getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:function(){return"segment ids are not increasing"},getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:function(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`},getSparseSegmentReductionIndicesOutOfRangeErrorMessage:function(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}}),ql=Object.freeze({__proto__:null,nonMaxSuppressionV3Impl:zc,nonMaxSuppressionV4Impl:Wc,nonMaxSuppressionV5Impl:Uc,whereImpl:ac}),Hl=Object.freeze({__proto__:null,AdadeltaOptimizer:Il,AdagradOptimizer:Ml,AdamOptimizer:Rl,AdamaxOptimizer:Dl,MomentumOptimizer:Ll,Optimizer:Ol,OptimizerConstructors:Bl,RMSPropOptimizer:Pl,SGDOptimizer:Fl,Tensor:Le,TensorBuffer:Re,Variable:Pe,get Rank(){return Be},sumOutType:function(t){return Ge(t,"int32")},upcastType:Ge,get Reduction(){return al},customGrad:pa,grad:function(t){return x(W(t),(()=>"The f passed in grad(f) must be a function")),(e,n)=>{const r=ar(e,"x","tf.grad","string_or_numeric"),s=null!=n?ar(n,"dy","tf.grad"):null;return en.tidy((()=>{const{value:e,grads:n}=en.gradients((()=>t(r)),[r],s);return null!=s&&N(e.shape,s.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),da(n),n[0]}))}},grads:function(t){return x(W(t),(()=>"The f passed in grads(f) must be a function")),(e,n)=>{x(Array.isArray(e),(()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"));const r=ur(e,"args","tf.grads","string_or_numeric"),s=null!=n?ar(n,"dy","tf.grads"):null;return en.tidy((()=>{const{value:e,grads:n}=en.gradients((()=>t(...r)),r,s);return null!=s&&N(e.shape,s.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),da(n),n}))}},valueAndGrad:function(t){return x(W(t),(()=>"The f passed in valueAndGrad(f) must be a function")),(e,n)=>{x(e instanceof Le,(()=>"The x passed in valueAndGrad(f)(x) must be a tensor")),x(null==n||n instanceof Le,(()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"));const{grads:r,value:s}=en.gradients((()=>t(e)),[e],n);return da(r),{grad:r[0],value:s}}},valueAndGrads:function(t){return x(W(t),(()=>"The f passed in valueAndGrads(f) must be a function")),(e,n)=>{x(Array.isArray(e)&&e.every((t=>t instanceof Le)),(()=>"The args passed in valueAndGrads(f)(args) must be array of tensors")),x(null==n||n instanceof Le,(()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"));const r=en.gradients((()=>t(...e)),e,n);return null!=n&&N(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),da(r.grads),r}},variableGrads:ha,Environment:Y,env:Q,get ENV(){return tt},nextFrame:function(){return new Promise((t=>zl((()=>t()))))},KernelBackend:y,DataStorage:class{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}},abs:yo,acos:go,acosh:bo,add:fo,addN:wo,all:vo,any:xo,argMax:No,argMin:$o,asin:Eo,asinh:So,atan:_o,atan2:To,atanh:ko,avgPool:Wo,avgPool3d:Uo,basicLSTMCell:Ko,batchToSpaceND:Xo,batchNorm:Jo,batchNorm2d:Yo,batchNorm3d:Zo,batchNorm4d:Qo,bincount:ti,broadcastArgs:ei,broadcastTo:ni,buffer:Yr,cast:Zr,ceil:ri,clipByValue:si,clone:Qr,complex:lr,concat:jo,concat1d:oi,concat2d:ii,concat3d:ai,concat4d:ui,conv1d:li,conv2d:ci,conv2dTranspose:hi,conv3d:pi,conv3dTranspose:mi,cos:yi,cosh:gi,cumprod:bi,cumsum:wi,denseBincount:vi,depthToSpace:xi,depthwiseConv2d:Ni,diag:$i,dilation2d:Ei,div:po,divNoNan:ki,dot:Ai,einsum:Ci,elu:Oi,equal:Si,erf:Ii,euclideanNorm:Gi,exp:qi,expandDims:Hi,expm1:Ki,eye:Ji,fill:Yi,floor:Zi,floorDiv:ho,gather:Qi,greater:ta,greaterEqual:ea,imag:Ss,isFinite:na,isInf:ra,isNaN:sa,leakyRelu:oa,less:ia,lessEqual:aa,linspace:ua,localResponseNormalization:ca,log:la,log1p:fa,logSigmoid:ya,logSoftmax:ba,logSumExp:wa,logicalAnd:va,logicalNot:xa,logicalOr:Na,logicalXor:$a,lowerBound:Sa,matMul:gs,max:Fi,maxPool:_a,maxPool3d:Ta,maxPoolWithArgmax:ka,maximum:Aa,mean:Ca,meshgrid:function(t,e,{indexing:n="xy"}={}){if("xy"!==n&&"ij"!==n)throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(void 0===t)return[];let r=ar(t,"x","meshgrid",t instanceof Le?t.dtype:"float32");if(void 0===e)return[r];let s=ar(e,"y","meshgrid",e instanceof Le?e.dtype:"float32");const o=S(r.shape),i=S(s.shape);return"xy"===n?(r=zo(r,[1,-1]),s=zo(s,[-1,1]),[gs(Ia([i,1],r.dtype),r),gs(s,Ia([1,o],s.dtype))]):(r=zo(r,[-1,1]),s=zo(s,[1,-1]),[gs(r,Ia([1,i],r.dtype)),gs(Ia([o,1],s.dtype),s)])},min:Li,minimum:Ma,mirrorPad:Ra,mod:Da,moments:Fa,mul:mo,multiRNNCell:La,multinomial:Pa,neg:_s,notEqual:Ba,oneHot:bs,ones:Ia,onesLike:Va,outerProduct:za,pad:Wa,pad1d:Ua,pad2d:ja,pad3d:Ga,pad4d:qa,pool:Ka,pow:Pi,prelu:Xa,print:ts,prod:Ja,rand:Ya,randomGamma:gu,randomNormal:bu,randomUniform:wu,range:vu,real:Ts,reciprocal:xu,relu:Nu,relu6:$u,reshape:zo,reverse:Eu,reverse1d:Su,reverse2d:_u,reverse3d:Tu,reverse4d:ku,round:Au,rsqrt:Cu,scalar:Bi,selu:Ou,separableConv2d:Iu,setdiff1dAsync:Mu,sigmoid:Go,sign:Ru,sin:Du,sinh:Fu,slice:qo,slice1d:Lu,slice2d:Pu,slice3d:Bu,slice4d:Vu,softmax:zu,softplus:ma,spaceToBatchND:Ha,fft:Wu,ifft:Uu,irfft:ju,rfft:qu,split:Gu,sqrt:Vi,square:zi,squaredDifference:Hu,squeeze:Ku,stack:Xu,step:Ju,stridedSlice:Yu,sub:ga,sum:Wi,tan:Zu,tanh:Ho,tensor:hr,tensor1d:Qu,tensor2d:tc,tensor3d:Ds,tensor4d:function(t,e,n){if($(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");const r=sr(t,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return fr(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,tensor5d:function(t,e,n){if($(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");const r=sr(t,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return fr(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,tensor6d:function(t,e,n){if($(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");const r=sr(t,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return fr(t,e=e||r,r,n)},tile:Xi,topk:ec,truncatedNormal:nc,unique:rc,unsortedSegmentSum:sc,unstack:oc,upperBound:ic,variable:function(t,e=!0,n,r){return en.makeVariable(t,e,n,r)},where:_i,whereAsync:uc,zeros:Oa,zerosLike:Ti,op:cr,OP_SCOPE_SUFFIX:"__op",booleanMaskAsync:cc,transpose:ks,norm:ji,movingAverage:lc,scatterND:fc,searchSorted:Ea,sparseToDense:hc,gatherND:pc,dropout:dc,enclosingPowerOfTwo:mc,cosineWindow:yc,inTopKAsync:gc,image:_l,linalg:Tl,losses:kl,spectral:El,fused:kc,signal:Sl,sparse:Al,string:Cl,train:Vl,enableProdMode:function(){Q().set("PROD",!0)},enableDebugMode:function(){Q().set("DEBUG",!0)},disableDeprecationWarnings:function(){Q().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},deprecationWarn:function(t){Q().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")},disposeVariables:function(){en.disposeVariables()},engine:ws,memory:function(){return en.memory()},profile:function(t){return en.profile(t)},tidy:vs,dispose:xs,keep:Ns,time:function(t){return en.time(t)},setBackend:function(t){return en.setBackend(t)},ready:function(){return en.ready()},getBackend:$s,removeBackend:function(t){en.removeBackend(t)},findBackend:function(t){return en.findBackend(t)},findBackendFactory:function(t){return en.findBackendFactory(t)},registerBackend:function(t,e,n=1){return en.registerBackend(t,e,n)},backend:Es,setPlatform:function(t,e){Q().setPlatform(t,e)},getKernel:Mt,getGradient:Rt,getKernelsForBackend:Dt,registerKernel:Ft,registerGradient:function(t){const{kernelName:e}=t;It.has(e)&&Q().getBool("DEBUG")&&Ct(`Overriding the gradient for '${e}'`),It.set(e,t)},unregisterKernel:function(t,e){const n=Lt(t,e);if(!Ot.has(n))throw new Error(`The kernel '${t}' for backend '${e}' is not registered`);Ot.delete(n)},unregisterGradient:function(t){if(!It.has(t))throw new Error(`The gradient '${t}' for backend is not registered`);It.delete(t)},copyRegisteredKernels:function(t,e){Dt(t).forEach((t=>{Ft(Object.assign({},t,{backendName:e}))}))},Abs:"Abs",Acos:"Acos",Acosh:"Acosh",Add:"Add",AddN:"AddN",All:"All",Any:"Any",ArgMax:"ArgMax",ArgMin:"ArgMin",Asin:"Asin",Asinh:"Asinh",Atan:"Atan",Atanh:"Atanh",Atan2:"Atan2",AvgPool:"AvgPool",AvgPoolGrad:"AvgPoolGrad",AvgPool3D:"AvgPool3D",AvgPool3DGrad:"AvgPool3DGrad",BatchMatMul:"BatchMatMul",BatchToSpaceND:"BatchToSpaceND",Bincount:"Bincount",BroadcastTo:"BroadcastTo",BroadcastArgs:"BroadcastArgs",Cast:"Cast",Ceil:"Ceil",ClipByValue:"ClipByValue",Complex:"Complex",ComplexAbs:"ComplexAbs",Concat:"Concat",Conv2D:"Conv2D",Conv2DBackpropFilter:"Conv2DBackpropFilter",Conv2DBackpropInput:"Conv2DBackpropInput",Conv3D:"Conv3D",Conv3DBackpropFilterV2:"Conv3DBackpropFilterV2",Conv3DBackpropInputV2:"Conv3DBackpropInputV2",Cos:"Cos",Cosh:"Cosh",Cumprod:"Cumprod",Cumsum:"Cumsum",CropAndResize:"CropAndResize",DenseBincount:"DenseBincount",DepthToSpace:"DepthToSpace",DepthwiseConv2dNative:"DepthwiseConv2dNative",DepthwiseConv2dNativeBackpropFilter:"DepthwiseConv2dNativeBackpropFilter",DepthwiseConv2dNativeBackpropInput:"DepthwiseConv2dNativeBackpropInput",Diag:"Diag",Dilation2D:"Dilation2D",Dilation2DBackpropInput:"Dilation2DBackpropInput",Dilation2DBackpropFilter:"Dilation2DBackpropFilter",RealDiv:"RealDiv",Einsum:"Einsum",Elu:"Elu",EluGrad:"EluGrad",Erf:"Erf",Equal:"Equal",Exp:"Exp",ExpandDims:"ExpandDims",Expm1:"Expm1",FFT:"FFT",Fill:"Fill",FlipLeftRight:"FlipLeftRight",Floor:"Floor",FloorDiv:"FloorDiv",FusedBatchNorm:"FusedBatchNorm",GatherV2:"GatherV2",GatherNd:"GatherNd",Greater:"Greater",GreaterEqual:"GreaterEqual",Identity:"Identity",IFFT:"IFFT",Imag:"Imag",IsFinite:"IsFinite",IsInf:"IsInf",IsNan:"IsNan",LeakyRelu:"LeakyRelu",Less:"Less",LessEqual:"LessEqual",LinSpace:"LinSpace",Log:"Log",Log1p:"Log1p",LogicalAnd:"LogicalAnd",LogicalNot:"LogicalNot",LogicalOr:"LogicalOr",LogSoftmax:"LogSoftmax",LowerBound:"LowerBound",LRN:"LRN",LRNGrad:"LRNGrad",Max:"Max",Maximum:"Maximum",MaxPool:"MaxPool",MaxPoolGrad:"MaxPoolGrad",MaxPool3D:"MaxPool3D",MaxPool3DGrad:"MaxPool3DGrad",MaxPoolWithArgmax:"MaxPoolWithArgmax",Mean:"Mean",Min:"Min",Minimum:"Minimum",MirrorPad:"MirrorPad",Mod:"Mod",Multinomial:"Multinomial",Multiply:"Multiply",Neg:"Neg",NotEqual:"NotEqual",NonMaxSuppressionV3:"NonMaxSuppressionV3",NonMaxSuppressionV4:"NonMaxSuppressionV4",NonMaxSuppressionV5:"NonMaxSuppressionV5",OnesLike:"OnesLike",OneHot:"OneHot",Pack:"Pack",PadV2:"PadV2",Pool:"Pool",Pow:"Pow",Prelu:"Prelu",Prod:"Prod",Range:"Range",Real:"Real",Reciprocal:"Reciprocal",Relu:"Relu",Reshape:"Reshape",ResizeNearestNeighbor:"ResizeNearestNeighbor",ResizeNearestNeighborGrad:"ResizeNearestNeighborGrad",ResizeBilinear:"ResizeBilinear",ResizeBilinearGrad:"ResizeBilinearGrad",Relu6:"Relu6",Reverse:"Reverse",Round:"Round",Rsqrt:"Rsqrt",ScatterNd:"ScatterNd",SearchSorted:"SearchSorted",Select:"Select",Selu:"Selu",Slice:"Slice",Sin:"Sin",Sinh:"Sinh",Sign:"Sign",Sigmoid:"Sigmoid",Softplus:"Softplus",Sqrt:"Sqrt",Sum:"Sum",SpaceToBatchND:"SpaceToBatchND",SplitV:"SplitV",Softmax:"Softmax",SparseFillEmptyRows:"SparseFillEmptyRows",SparseReshape:"SparseReshape",SparseSegmentMean:"SparseSegmentMean",SparseSegmentSum:"SparseSegmentSum",SparseToDense:"SparseToDense",SquaredDifference:"SquaredDifference",Square:"Square",StridedSlice:"StridedSlice",StringNGrams:"StringNGrams",StringSplit:"StringSplit",StringToHashBucketFast:"StringToHashBucketFast",Sub:"Sub",Tan:"Tan",Tanh:"Tanh",Tile:"Tile",TopK:"TopK",Transform:"Transform",Transpose:"Transpose",Unique:"Unique",Unpack:"Unpack",UnsortedSegmentSum:"UnsortedSegmentSum",UpperBound:"UpperBound",ZerosLike:"ZerosLike",Step:"Step",FromPixels:"FromPixels",RotateWithOffset:"RotateWithOffset",_FusedMatMul:"_FusedMatMul",FusedConv2D:"FusedConv2D",FusedDepthwiseConv2D:"FusedDepthwiseConv2D",version_core:"3.18.0",browser:Vs,io:ys,math:Cs,serialization:io,test_util:lo,util:Se,backend_util:Gl,broadcast_util:Rs,tensor_util:Je,slice_util:no,gather_util:Ws,scatter_util:qs,device_util:on,kernel_impls:ql});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
var Kl,Xl;Q().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"}(Kl||(Kl={})),function(t){var e;(e=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(Xl||(Xl={}));
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Jl={};function Yl(t){return Jl[t]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zl(t,e,n,r,s){const o=e.inputParams[t];if(o&&void 0!==o.inputIndexStart){const t=o.inputIndexStart,i=0===o.inputIndexEnd?void 0:void 0===o.inputIndexEnd?t+1:o.inputIndexEnd;if("tensor"===o.type)return Ql(e.inputNames[o.inputIndexStart],n,r,s);if("tensors"===o.type){return e.inputNames.slice(t,i).map((t=>Ql(t,n,r,s)))}const a=Ql(e.inputNames.slice(t)[0],n,r,s),u=a.dataSync();return"number"===o.type?u[0]:q(a.shape,u)}const i=e.attrParams[t];return i&&i.value}function Ql(t,e,n,r){const[s,o]=nf(t);if(null!=r){const t=r.getHashTableHandleByName(s);if(null!=t)return t}const i=n.currentContextIds.find((t=>!!e[ef(s,t)]));return void 0!==i?e[ef(s,i)][o]:void 0}function tf(t,e){const[n,r,s]=nf(t);return[ef(n,e&&e.currentContextId),r,s]}function ef(t,e){return e?`${t}-${e}`:t}function nf(t){const e=t.split(":");if(1===e.length)return[t,0,void 0];const n=e[0],r=3===e.length?e[1]:void 0;return[n,Number(e[e.length-1]),r]}function rf(t,e,n){let r=Zl("pad",t,e,n);if("explicit"===r){r=Zl("explicitPaddings",t,e,n);const s=[[0,0],[0,0],[0,0],[0,0]];for(let t=0;t<4;t++)s[t][0]=r[2*t],s[t][1]=r[2*t+1];return s}return r}function sf(t){return t.kept?t:Qr(t)}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var of=Object.freeze({__proto__:null,json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var af=Object.freeze({__proto__:null,json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var uf=Object.freeze({__proto__:null,json:[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var cf=Object.freeze({__proto__:null,json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var lf=Object.freeze({__proto__:null,json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ff=Object.freeze({__proto__:null,json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var hf=Object.freeze({__proto__:null,json:[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var pf=Object.freeze({__proto__:null,json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var df=Object.freeze({__proto__:null,json:[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var mf=Object.freeze({__proto__:null,json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var yf=Object.freeze({__proto__:null,json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var gf=Object.freeze({__proto__:null,json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var bf=Object.freeze({__proto__:null,json:[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var wf=Object.freeze({__proto__:null,json:[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var vf=Object.freeze({__proto__:null,json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var xf=Object.freeze({__proto__:null,json:[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Nf=Object.freeze({__proto__:null,json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var $f=Object.freeze({__proto__:null,json:[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Ef=Object.freeze({__proto__:null,json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}]});class Sf{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const t=[].concat(...[of,af,uf,cf,lf,ff,hf,pf,df,mf,yf,gf,bf,wf,vf,xf,Nf,$f,Ef].map((t=>t.json)));this.opMappers=t.reduce(((t,e)=>(t[e.tfOpName]=e,t)),{})}transformGraph(t,e={}){const n=t.node,r=[],s=[],o=[],i=n.reduce(((t,e)=>(t[e.name]=this.mapNode(e),e.op.startsWith("Placeholder")?r.push(t[e.name]):"Const"===e.op?s.push(t[e.name]):null!=e.input&&0!==e.input.length||o.push(t[e.name]),t)),{});let a=[];const u=[];let c={},l={};null!=e&&(c=this.mapSignatureEntries(e.inputs),l=this.mapSignatureEntries(e.outputs));const f=Object.keys(i);f.forEach((t=>{const e=i[t];e.inputNames.forEach(((t,n)=>{const[r,,s]=tf(t),o=i[r];if(null!=o.outputs){const t=o.outputs.indexOf(s);if(-1!==t){const s=`${r}:${t}`;e.inputNames[n]=s}}e.inputs.push(o),o.children.push(e)}))})),0===Object.keys(l).length?f.forEach((t=>{const e=i[t];0===e.children.length&&u.push(e)})):Object.keys(l).forEach((t=>{const[e]=tf(t),n=i[e];null!=n&&(n.signatureKey=l[t],u.push(n))})),Object.keys(c).length>0?Object.keys(c).forEach((t=>{const[e]=tf(t),n=i[e];n&&(n.signatureKey=c[t],a.push(n))})):a=r;let h={};null!=t.library&&null!=t.library.function&&(h=t.library.function.reduce(((t,e)=>(t[e.signature.name]=this.mapFunction(e),t)),{}));const p={nodes:i,inputs:a,outputs:u,weights:s,placeholders:r,signature:e,functions:h};return o.length>0&&(p.initNodes=o),p}mapSignatureEntries(t){return Object.keys(t||{}).reduce(((e,n)=>(e[t[n].name]=n,e)),{})}mapNode(t){const e=Yl(t.op)||this.opMappers[t.op]||{};null==t.attr&&(t.attr={});const n={name:t.name,op:t.op,category:e.category,inputNames:(t.input||[]).map((t=>t.startsWith("^")?t.slice(1):t)),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr,outputs:e.outputs};return null!=e.inputs&&(n.inputParams=e.inputs.reduce(((t,e)=>(t[e.name]={type:e.type,inputIndexStart:e.start,inputIndexEnd:e.end},t)),{})),null!=e.attrs&&(n.attrParams=e.attrs.reduce(((e,n)=>{const r=n.type;let s;switch(n.type){case"string":s=Tf(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Tf(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":s=Lf(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Lf(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":s=Af(t.attr,n.tfName,n.defaultValue||0),void 0===s&&n.tfDeprecatedName&&(s=Af(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":s=Ff(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Ff(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":s=kf(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=kf(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":s=Bf(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Bf(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":s=Df(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Df(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":s=Pf(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Pf(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":s=If(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=If(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":s=Mf(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Mf(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":s=Of(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Of(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${n.type} for op: ${t.op}`)}return e[n.name]={value:s,type:r},e}),{})),n}mapFunction(t){const e=t.nodeDef,n=[];let r={};null!=e&&(r=e.reduce(((t,e)=>(t[e.name]=this.mapNode(e),"Const"===e.op&&n.push(t[e.name]),t)),{}));const s=[],o=[];t.signature.inputArg.forEach((t=>{const[e]=tf(t.name),n={name:e,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:Cf(t.type),type:"dtype"}},children:[]};n.signatureKey=t.name,s.push(n),r[e]=n}));Object.keys(r).forEach((t=>{const e=r[t];e.inputNames.forEach(((t,n)=>{const[s,,o]=tf(t),i=r[s];if(null!=i.outputs){const t=i.outputs.indexOf(o);if(-1!==t){const r=`${s}:${t}`;e.inputNames[n]=r}}e.inputs.push(i),i.children.push(e)}))}));const i=t.ret;t.signature.outputArg.forEach((t=>{const[e,n]=tf(i[t.name]),s=r[e];null!=s&&(s.defaultOutput=n,o.push(s))}));const a=this.mapArgsToSignature(t);return{nodes:r,inputs:s,outputs:o,weights:n,placeholders:[],signature:a}}mapArgsToSignature(t){return{methodName:t.signature.name,inputs:t.signature.inputArg.reduce(((t,e)=>(t[e.name]=this.mapArgToTensorInfo(e),t)),{}),outputs:t.signature.outputArg.reduce(((e,n)=>(e[n.name]=this.mapArgToTensorInfo(n,t.ret),e)),{})}}mapArgToTensorInfo(t,e){let n=t.name;return null!=e&&(n=e[n]),{name:n,dtype:t.type}}}function _f(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):function(t){const e=Q().global;return void 0!==e.atob?e.atob(t):new xn(t,"base64").toString()}(t);return e?n:n.toLowerCase()}function Tf(t,e,n,r=!1){const s=t[e];return null!=s?_f(s.s,r):n}function kf(t,e,n){const r=t[e];return r?r.b:n}function Af(t,e,n){const r=t[e]||{},s=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof s?s:parseInt(s,10)}function Cf(t){switch("string"==typeof t&&(t=Kl[t]),t){case Kl.DT_FLOAT:case Kl.DT_HALF:return"float32";case Kl.DT_INT32:case Kl.DT_INT64:case Kl.DT_INT8:case Kl.DT_UINT8:return"int32";case Kl.DT_BOOL:return"bool";case Kl.DT_DOUBLE:return"float32";case Kl.DT_STRING:return"string";default:return null}}function Of(t,e,n){const r=t[e];return r&&r.func?r.func.name:n}function If(t,e,n){const r=t[e];return r&&r.type?Cf(r.type):n}function Mf(t,e,n){const r=t[e];return r&&r.list&&r.list.type?r.list.type.map((t=>Cf(t))):n}function Rf(t){if(!t.unknownRank)return null!=t.dim?t.dim.map((t=>"number"==typeof t.size?t.size:parseInt(t.size,10))):[]}function Df(t,e,n){const r=t[e];return r&&r.shape?Rf(r.shape):n}function Ff(t,e,n){const r=t[e];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((t=>"number"==typeof t?t:parseInt(t,10))):n}function Lf(t,e,n,r=!1){const s=t[e];return s&&s.list&&s.list.s?s.list.s.map((t=>_f(t,r))):n}function Pf(t,e,n){const r=t[e];return r&&r.list&&r.list.shape?r.list.shape.map((t=>Rf(t))):n}function Bf(t,e,n){const r=t[e];return r&&r.list&&r.list.b?r.list.b:n}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vf{constructor(t,e,n){this.node=t,this.tensorMap=e,this.context=n,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((t=>this.getInput(t))),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce(((t,e)=>(t[e]=this.getAttr(e),t)),{}))}getInput(t){return Ql(t,this.tensorMap,this.context)}getAttr(t,e){const n=this.node.rawAttrs[t];if(null!=n.tensor)return Ql(t,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return Af(this.node.rawAttrs,t,e);if(null!=n.s)return Tf(this.node.rawAttrs,t,e);if(null!=n.b)return kf(this.node.rawAttrs,t,e);if(null!=n.shape)return Df(this.node.rawAttrs,t,e);if(null!=n.type)return If(this.node.rawAttrs,t,e);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return Ff(this.node.rawAttrs,t,e);if(null!=n.list.s)return Lf(this.node.rawAttrs,t,e);if(null!=n.list.shape)return Pf(this.node.rawAttrs,t,e);if(null!=n.list.b)return Bf(this.node.rawAttrs,t,e);if(null!=n.list.type)return Mf(this.node.rawAttrs,t,e)}return e}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function zf(t,e,n=""){if("number"!=typeof t&&"number"!=typeof e){x(t.length===e.length,(()=>n+` Shapes ${t} and ${e} must match`));for(let r=0;r<t.length;r++){const s=t[r],o=e[r];x(s<0||o<0||s===o,(()=>n+` Shapes ${t} and ${e} must match`))}}}function Wf(t){return"number"!=typeof t&&!t.some((t=>t<0))}function Uf(t,e,n){let r=jf(t,n);const s=!Wf(r);if(s&&0===e.length)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(s&&e.forEach((t=>{r=jf(t.shape,r)})),!Wf(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function jf(t,e){if("number"==typeof t)return e;if("number"==typeof e)return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let r=0;r<t.length;++r){const s=t[r],o=e[r];if(s>=0&&o>=0&&s!==o)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[r]=s>=0?s:o}return n}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gf{constructor(t,e,n,r,s,o,i){this.name=t,this.dtype=e,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=s,this.dynamicSize=o,this.clearAfterRead=i,this.tensors=[],this.closed_=!1,this.idTensor=Bi(0),Ns(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.tensor.id)||e.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||t>=this.size())throw new Error(`Tried to read from index ${t}, but array size is: ${this.size()}`);const e=this.tensors[t];if(e.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${t} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor}readMany(t){return t.map((t=>this.read(t)))}write(t,e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error(`Tried to write to index ${t}, but array is not resizeable and size is: ${this.maxSize}`);const n=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t},\n          because the value dtype is ${e.dtype}, but TensorArray dtype is ${this.dtype}.`);if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=e.shape),zf(this.elementShape,e.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${t}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been written.`);n.tensor=e,Ns(e),n.written=!0,this.tensors[t]=n}writeMany(t,e){if(t.length!==e.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${t.length} is not the same as tensors size: ${e.length}.`);t.forEach(((t,n)=>this.write(t,e[n])))}gather(t,e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${e}`);if(t)t=t.slice(0,this.size());else{t=[];for(let e=0;e<this.size();e++)t.push(e)}if(0===t.length)return hr([],[0].concat(this.elementShape));const n=this.readMany(t);return zf(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),Xu(n,0)}concat(t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${t}`);if(0===this.size())return hr([],[0].concat(this.elementShape));const e=[];for(let t=0;t<this.size();t++)e.push(t);const n=this.readMany(e);return zf(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),jo(n,0)}scatter(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);const n=Math.max(...t);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(t,oc(e,0))}split(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);let n=0;const r=t.map((t=>(n+=t,n)));if(n!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${n}, and tensor's shape is: ${e.shape}`);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${t.length}), and the TensorArray is not marked as dynamically resizeable`);const s=0===n?0:e.size/n,o=[];vs((()=>{e=zo(e,[1,n,s]);for(let n=0;n<t.length;++n){const i=[0,0===n?0:r[n-1],0],a=[1,t[n],s];o[n]=zo(qo(e,i,a),this.elementShape)}return o}));const i=[];for(let e=0;e<t.length;e++)i[e]=e;this.writeMany(i,o)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qf{constructor(t,e,n,r=-1){this.tensors=t,this.elementShape=e,this.elementDtype=n,null!=t&&t.forEach((t=>{if(n!==t.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${t.dtype}`);zf(e,t.shape,"TensorList shape mismatch: "),Ns(t)})),this.idTensor=Bi(0),this.maxNumElements=r,Ns(this.idTensor)}get id(){return this.idTensor.id}copy(){return new qf([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.id)||e.dispose()})),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,e,n=-1){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(-1!==n&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);zf(t,this.elementShape,"TensorList shape mismatch: ");const r=Uf(this.elementShape,this.tensors,t);return vs((()=>{const t=this.tensors.map((t=>zo(t,r)));return Xu(t,0)}))}popBack(t,e){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=Uf(this.elementShape,this.tensors,t),r=this.tensors.pop();return zf(r.shape,t,"TensorList shape mismatch: "),zo(r,n)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(zf(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Ns(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);const e=new qf([],this.elementShape,this.elementDtype,this.maxNumElements);e.tensors.length=t;for(let n=0;n<Math.min(this.tensors.length,t);++n)e.tensors[n]=this.tensors[n];return e}getItem(t,e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(null==this.tensors[t])throw new Error(`element at index ${t} is null.`);zf(this.tensors[t].shape,e,"TensorList shape mismatch: ");const r=Uf(this.elementShape,this.tensors,e);return zo(this.tensors[t],r)}setItem(t,e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(t<0||-1!==this.maxNumElements&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);zf(this.elementShape,e.shape,"TensorList shape mismatch: "),Ns(e),this.tensors[t]=e}gather(t,e,n){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);zf(this.elementShape,n,"TensorList shape mismatch: "),t=t.slice(0,this.size());const r=Uf(this.elementShape,this.tensors,n);return 0===t.length?hr([],[0].concat(r)):vs((()=>{const e=t.map((t=>zo(this.tensors[t],r)));return Xu(e,0)}))}concat(t,e){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);zf(this.elementShape,e,"TensorList shape mismatch: ");const n=Uf(this.elementShape,this.tensors,e);return 0===this.size()?hr([],[0].concat(n)):vs((()=>{const t=this.tensors.map((t=>zo(t,n)));return jo(t,0)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Hf=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const r=Zl("thenBranch",t,e,n),s=Zl("elseBranch",t,e,n),o=Zl("cond",t,e,n),i=Zl("args",t,e,n);return(await o.data())[0]?n.functionMap[r].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap):n.functionMap[s].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=Zl("body",t,e,n),s=Zl("cond",t,e,n),o=Zl("args",t,e,n),i=await n.functionMap[s].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap),a=o.map((t=>t.id));let u=await i[0].data();i.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||t.dispose()}));let c=o;for(;u[0];){const t=c;c=await n.functionMap[r].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);const e=c.map((t=>t.id));t.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}));const o=await n.functionMap[s].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);u=await o[0].data(),o.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}))}return c}case"LoopCond":return[sf(Zl("pred",t,e,n))];case"Switch":{const r=Zl("pred",t,e,n);let s=Zl("data",t,e,n);return s.kept||(s=sf(s)),(await r.data())[0]?[void 0,s]:[s,void 0]}case"Merge":{const r=t.inputNames.find((t=>void 0!==Ql(t,e,n)));if(r){return[sf(Ql(r,e,n))]}return}case"Enter":{const r=Zl("frameName",t,e,n),s=Zl("tensor",t,e,n);return n.enterFrame(r),[sf(s)]}case"Exit":{const r=Zl("tensor",t,e,n);return n.exitFrame(),[sf(r)]}case"NextIteration":{const r=Zl("tensor",t,e,n);return n.nextIteration(),[sf(r)]}case"TensorArrayV3":{const r=Zl("size",t,e,n),s=Zl("dtype",t,e,n),o=Zl("elementShape",t,e,n),i=Zl("dynamicSize",t,e,n),a=Zl("clearAfterRead",t,e,n),u=Zl("identicalElementShapes",t,e,n),c=Zl("name",t,e,n),l=new Gf(c,s,r,o,u,i,a);return n.addTensorArray(l),[l.idTensor,Bi(1)]}case"TensorArrayWriteV3":{const r=Zl("tensorArrayId",t,e,n),s=Zl("index",t,e,n),o=Zl("tensor",t,e,n),i=n.getTensorArray(r.id);return i.write(s,o),[i.idTensor]}case"TensorArrayReadV3":{const r=Zl("tensorArrayId",t,e,n),s=Zl("index",t,e,n);return[n.getTensorArray(r.id).read(s)]}case"TensorArrayGatherV3":{const r=Zl("tensorArrayId",t,e,n),s=Zl("indices",t,e,n),o=Zl("dtype",t,e,n);return[n.getTensorArray(r.id).gather(s,o)]}case"TensorArrayScatterV3":{const r=Zl("tensorArrayId",t,e,n),s=Zl("indices",t,e,n),o=Zl("tensor",t,e,n),i=n.getTensorArray(r.id);return i.scatter(s,o),[i.idTensor]}case"TensorArrayConcatV3":{const r=Zl("tensorArrayId",t,e,n),s=n.getTensorArray(r.id),o=Zl("dtype",t,e,n);return[s.concat(o)]}case"TensorArraySplitV3":{const r=Zl("tensorArrayId",t,e,n),s=Zl("tensor",t,e,n),o=Zl("lengths",t,e,n),i=n.getTensorArray(r.id);return i.split(o,s),[i.idTensor]}case"TensorArraySizeV3":{const r=Zl("tensorArrayId",t,e,n);return[Bi(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{const r=Zl("tensorArrayId",t,e,n),s=n.getTensorArray(r.id);return s.clearAndClose(),[s.idTensor]}case"TensorListSetItem":{const r=Zl("tensorListId",t,e,n),s=Zl("index",t,e,n),o=Zl("tensor",t,e,n),i=n.getTensorList(r.id);return i.setItem(s,o),[i.idTensor]}case"TensorListGetItem":{const r=Zl("tensorListId",t,e,n),s=Zl("index",t,e,n),o=Zl("elementShape",t,e,n),i=Zl("elementDType",t,e,n);return[n.getTensorList(r.id).getItem(s,o,i)]}case"TensorListScatterV2":case"TensorListScatter":{const r=Zl("indices",t,e,n),s=function(t,e,n,r){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const s=Math.max(...e);if(null!=r&&-1!==r&&s>=r)throw new Error(`Max index must be < array size (${s}  vs. ${r})`);const o=new qf([],n,t.dtype,r),i=oc(t,0);return e.forEach(((t,e)=>{o.setItem(t,i[e])})),o}(Zl("tensor",t,e,n),r,Zl("elementShape",t,e,n),Zl("numElements",t,e,n));return n.addTensorList(s),[s.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=Zl("elementShape",t,e,n),s=Zl("elementDType",t,e,n);let o;o="TensorListReserve"===t.op?"numElements":"maxNumElements";const i=function(t,e,n){return new qf([],t,e,n)}(r,s,Zl(o,t,e,n));return n.addTensorList(i),[i.idTensor]}case"TensorListGather":{const r=Zl("tensorListId",t,e,n),s=Zl("indices",t,e,n),o=Zl("elementShape",t,e,n),i=Zl("elementDType",t,e,n);return[n.getTensorList(r.id).gather(s,i,o)]}case"TensorListStack":{const r=Zl("tensorListId",t,e,n),s=Zl("elementShape",t,e,n),o=Zl("elementDType",t,e,n),i=Zl("numElements",t,e,n);return[n.getTensorList(r.id).stack(s,o,i)]}case"TensorListFromTensor":{const r=function(t,e,n){const r=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);zf(t.shape.slice(1),e,"TensorList shape mismatch: ");const s=oc(t);return new qf(s,e,r)}(Zl("tensor",t,e,n),Zl("elementShape",t,e,n),Zl("elementDType",t,e,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const r=Zl("tensorListId",t,e,n),s=n.getTensorList(r.id),o=Zl("dtype",t,e,n),i=Zl("elementShape",t,e,n);return[s.concat(o,i)]}case"TensorListPushBack":{const r=Zl("tensorListId",t,e,n),s=Zl("tensor",t,e,n),o=n.getTensorList(r.id);return o.pushBack(s),[o.idTensor]}case"TensorListPopBack":{const r=Zl("tensorListId",t,e,n),s=Zl("elementShape",t,e,n),o=Zl("elementDType",t,e,n);return[n.getTensorList(r.id).popBack(s,o)]}case"TensorListSplit":{const r=Zl("tensor",t,e,n),s=Zl("elementShape",t,e,n),o=function(t,e,n){let r=0;const s=e.map((t=>(r+=t,r)));if(r!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${r}, and tensor's shape is: ${t.shape}`);const o=jf(t.shape.slice(1),n),i=0===r?0:t.size/r,a=vs((()=>{const n=[];t=zo(t,[1,r,i]);for(let r=0;r<e.length;++r){const a=[0,0===r?0:s[r-1],0],u=[1,e[r],i];n[r]=zo(qo(t,a,u),o)}return t.dispose(),n})),u=new qf([],n,t.dtype,e.length);for(let t=0;t<a.length;t++)u.setItem(t,a[t]);return u}(r,Zl("lengths",t,e,n),s);return n.addTensorList(o),[o.idTensor]}case"TensorListLength":{const r=Zl("tensorListId",t,e,n);return[Bi(n.getTensorList(r.id).size(),"int32")]}case"TensorListResize":{const r=Zl("tensorListId",t,e,n),s=Zl("size",t,e,n),o=n.getTensorList(r.id).resize(s);return n.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kf(t,e,n){const[r,s]=Zl("fusedOps",t,e,n),o="biasadd"===r,i=!o,a="prelu"===s,u="fusedbatchnorm"===r,c=Zl("numArgs",t,e,n);if(o){if(a&&2!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&o&&1!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(u)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const l=Zl("strides",t,e,n),f=rf(t,e,n),h=Zl("dataFormat",t,e,n).toUpperCase(),p=Zl("dilations",t,e,n);let[d,m]=Zl("args",t,e,n);i&&(m=d,d=void 0);return{stride:l,pad:f,dataFormat:h,dilations:p,biasArg:d,preluArg:m,activationFunc:s,leakyreluAlpha:Zl("leakyreluAlpha",t,e,n)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Xf(t,e,n){return{boxes:Zl("boxes",t,e,n),scores:Zl("scores",t,e,n),maxOutputSize:Zl("maxOutputSize",t,e,n),iouThreshold:Zl("iouThreshold",t,e,n),scoreThreshold:Zl("scoreThreshold",t,e,n),softNmsSigma:Zl("softNmsSigma",t,e,n)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Jf{constructor(t,e){this.keyDType=t,this.valueDType=e,this.handle=Bi(0),this.tensorMap=new Map,Ns(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Bi(this.size(),"int32")}async import(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),vs((()=>{const t=oc(e),r=n.length,s=t.length;x(r===s,(()=>`The number of elements doesn't match, keys has ${r} elements, the values has ${s} elements.`));for(let e=0;e<r;e++){const r=n[e],s=t[e];Ns(s),this.tensorMap.set(r,s)}return this.handle}))}async find(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return vs((()=>{const t=[];for(let r=0;r<n.length;r++){const s=n[r],o=this.findWithDefault(s,e);t.push(o)}return Xu(t)}))}findWithDefault(t,e){const n=this.tensorMap.get(t);return null!=n?n:e}checkKeyAndValueTensor(t,e){if(t.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${t.dtype}`);if(e.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${e.dtype}`)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Yf(t,e,n,r){const s=((t,e,n)=>{switch(t.category){case"arithmetic":return vs((()=>((t,e,n)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[fo(Zl("a",t,e,n),Zl("b",t,e,n))];case"AddN":return[wo(Zl("tensors",t,e,n))];case"FloorMod":case"Mod":return[Da(Zl("a",t,e,n),Zl("b",t,e,n))];case"Mul":return[mo(Zl("a",t,e,n),Zl("b",t,e,n))];case"RealDiv":case"Div":return[po(Zl("a",t,e,n),Zl("b",t,e,n))];case"DivNoNan":return[ki(Zl("a",t,e,n),Zl("b",t,e,n))];case"FloorDiv":return[ho(Zl("a",t,e,n),Zl("b",t,e,n))];case"Sub":return[ga(Zl("a",t,e,n),Zl("b",t,e,n))];case"Minimum":return[Ma(Zl("a",t,e,n),Zl("b",t,e,n))];case"Maximum":return[Aa(Zl("a",t,e,n),Zl("b",t,e,n))];case"Pow":return[Pi(Zl("a",t,e,n),Zl("b",t,e,n))];case"SquaredDifference":return[Hu(Zl("a",t,e,n),Zl("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"basic_math":return vs((()=>((t,e,n)=>{switch(t.op){case"Abs":case"ComplexAbs":return[yo(Zl("x",t,e,n))];case"Acos":return[go(Zl("x",t,e,n))];case"Acosh":return[bo(Zl("x",t,e,n))];case"Asin":return[Eo(Zl("x",t,e,n))];case"Asinh":return[So(Zl("x",t,e,n))];case"Atan":return[_o(Zl("x",t,e,n))];case"Atan2":return[To(Zl("x",t,e,n),Zl("y",t,e,n))];case"Atanh":return[ko(Zl("x",t,e,n))];case"Ceil":return[ri(Zl("x",t,e,n))];case"Complex":return[lr(Zl("real",t,e,n),Zl("imag",t,e,n))];case"Cos":return[yi(Zl("x",t,e,n))];case"Cosh":return[gi(Zl("x",t,e,n))];case"Elu":return[Oi(Zl("x",t,e,n))];case"Erf":return[Ii(Zl("x",t,e,n))];case"Exp":return[qi(Zl("x",t,e,n))];case"Expm1":return[Ki(Zl("x",t,e,n))];case"Floor":return[Zi(Zl("x",t,e,n))];case"Log":return[la(Zl("x",t,e,n))];case"Log1p":return[fa(Zl("x",t,e,n))];case"Imag":return[Ss(Zl("x",t,e,n))];case"Neg":return[_s(Zl("x",t,e,n))];case"Reciprocal":return[xu(Zl("x",t,e,n))];case"Real":return[Ts(Zl("x",t,e,n))];case"Relu":return[Nu(Zl("x",t,e,n))];case"Round":return[Au(Zl("x",t,e,n))];case"Selu":return[Ou(Zl("x",t,e,n))];case"Sigmoid":return[Go(Zl("x",t,e,n))];case"Sin":return[Du(Zl("x",t,e,n))];case"Sign":return[Ru(Zl("x",t,e,n))];case"Sinh":return[Fu(Zl("x",t,e,n))];case"Softplus":return[ma(Zl("x",t,e,n))];case"Sqrt":return[Vi(Zl("x",t,e,n))];case"Square":return[zi(Zl("x",t,e,n))];case"Tanh":return[Ho(Zl("x",t,e,n))];case"Tan":return[Zu(Zl("x",t,e,n))];case"ClipByValue":return[si(Zl("x",t,e,n),Zl("clipValueMin",t,e,n),Zl("clipValueMax",t,e,n))];case"Relu6":return[$u(Zl("x",t,e,n))];case"Rsqrt":return[Cu(Ql(t.inputNames[0],e,n))];case"Prod":return[Ja(Zl("x",t,e,n),Zl("axes",t,e,n))];case"LeakyRelu":return[oa(Zl("x",t,e,n),Zl("alpha",t,e,n))];case"Prelu":return[Xa(Zl("x",t,e,n),Zl("alpha",t,e,n))];case"IsNan":return[sa(Ql(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"control":return Hf(t,e,n);case"convolution":return vs((()=>((t,e,n)=>{switch(t.op){case"Conv1D":{const r=Zl("stride",t,e,n),s=Zl("pad",t,e,n),o=Zl("dataFormat",t,e,n).toUpperCase(),i=Zl("dilation",t,e,n);return[li(Zl("x",t,e,n),Zl("filter",t,e,n),r,s,o,i)]}case"Conv2D":{const r=Zl("strides",t,e,n),s=rf(t,e,n),o=Zl("dataFormat",t,e,n).toUpperCase(),i=Zl("dilations",t,e,n);return[ci(Zl("x",t,e,n),Zl("filter",t,e,n),[r[1],r[2]],s,o,[i[1],i[2]])]}case"_FusedConv2D":{const{stride:r,pad:s,dataFormat:o,dilations:i,biasArg:a,preluArg:u,activationFunc:c,leakyreluAlpha:l}=Kf(t,e,n);return[$c({x:Zl("x",t,e,n),filter:Zl("filter",t,e,n),strides:[r[1],r[2]],pad:s,dataFormat:o,dilations:[i[1],i[2]],bias:a,activation:c,preluActivationWeights:u,leakyreluAlpha:l})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:s,dataFormat:o,dilations:i,biasArg:a,preluArg:u,activationFunc:c,leakyreluAlpha:l}=Kf(t,e,n);return[_c({x:Zl("x",t,e,n),filter:Zl("filter",t,e,n),strides:[r[1],r[2]],pad:s,dataFormat:o,dilations:[i[1],i[2]],bias:a,activation:c,preluActivationWeights:u,leakyreluAlpha:l})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=Zl("outputShape",t,e,n),s=Zl("strides",t,e,n),o=rf(t,e,n);return[hi(Zl("x",t,e,n),Zl("filter",t,e,n),r,[s[1],s[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=Zl("strides",t,e,n),s=rf(t,e,n),o=Zl("dilations",t,e,n),i=Zl("dataFormat",t,e,n).toUpperCase();return[Ni(Zl("input",t,e,n),Zl("filter",t,e,n),[r[1],r[2]],s,i,[o[1],o[2]])]}case"Conv3D":{const r=Zl("strides",t,e,n),s=Zl("pad",t,e,n),o=Zl("dataFormat",t,e,n).toUpperCase(),i=Zl("dilations",t,e,n);return[pi(Zl("x",t,e,n),Zl("filter",t,e,n),[r[1],r[2],r[3]],s,o,[i[1],i[2],i[3]])]}case"AvgPool":{const r=Zl("strides",t,e,n),s=Zl("pad",t,e,n),o=Zl("kernelSize",t,e,n);return[Wo(Zl("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s)]}case"MaxPool":{const r=Zl("strides",t,e,n),s=Zl("pad",t,e,n),o=Zl("kernelSize",t,e,n);return[_a(Zl("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s)]}case"MaxPoolWithArgmax":{const r=Zl("strides",t,e,n),s=Zl("pad",t,e,n),o=Zl("kernelSize",t,e,n),i=Zl("includeBatchInIndex",t,e,n),{result:a,indexes:u}=ka(Zl("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s,i);return[a,u]}case"AvgPool3D":{const r=Zl("strides",t,e,n),s=Zl("pad",t,e,n),o=Zl("kernelSize",t,e,n);return[Uo(Zl("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],s)]}case"MaxPool3D":{const r=Zl("strides",t,e,n),s=Zl("pad",t,e,n),o=Zl("kernelSize",t,e,n);return[Ta(Zl("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],s)]}case"Dilation2D":{const r=Zl("strides",t,e,n),s=Zl("pad",t,e,n),o=Zl("dilations",t,e,n),i=r[1],a=r[2],u=o[1],c=o[2];return[Ei(Zl("x",t,e,n),Zl("filter",t,e,n),[i,a],s,[u,c],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"creation":return vs((()=>((t,e,n)=>{switch(t.op){case"Fill":{const r=Zl("shape",t,e,n),s=Zl("dtype",t,e,n);return[Yi(r,Zl("value",t,e,n),s)]}case"LinSpace":return[ua(Zl("start",t,e,n),Zl("stop",t,e,n),Zl("num",t,e,n))];case"Multinomial":{const r=Zl("logits",t,e,n),s=Zl("numSamples",t,e,n),o=Zl("seed",t,e,n);return[Pa(r,s,o)]}case"OneHot":{const r=Zl("indices",t,e,n),s=Zl("depth",t,e,n),o=Zl("onValue",t,e,n),i=Zl("offValue",t,e,n);return[bs(r,s,o,i)]}case"Ones":return[Ia(Zl("shape",t,e,n),Zl("dtype",t,e,n))];case"OnesLike":return[Va(Zl("x",t,e,n))];case"RandomUniform":return[wu(Zl("shape",t,e,n),Zl("minval",t,e,n),Zl("maxval",t,e,n),Zl("dtype",t,e,n))];case"Range":return[vu(Zl("start",t,e,n),Zl("stop",t,e,n),Zl("step",t,e,n),Zl("dtype",t,e,n))];case"TruncatedNormal":{const r=Zl("shape",t,e,n),s=Zl("mean",t,e,n),o=Zl("stdDev",t,e,n),i=Zl("seed",t,e,n);return[nc(r,s,o,Zl("dtype",t,e,n),i)]}case"Zeros":return[Oa(Zl("shape",t,e,n),Zl("dtype",t,e,n))];case"ZerosLike":return[Ti(Zl("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"dynamic":return(async(t,e,n)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a,softNmsSigma:u}=Xf(t,e,n),c=await _l.nonMaxSuppressionWithScoreAsync(r,s,o,i,a,u);return[c.selectedIndices,c.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a}=Xf(t,e,n),u=Zl("padToMaxOutputSize",t,e,n),c=await _l.nonMaxSuppressionPaddedAsync(r,s,o,i,a,u);return[c.selectedIndices,c.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a}=Xf(t,e,n);return[await _l.nonMaxSuppressionAsync(r,s,o,i,a)]}case"Where":{const r=Zr(Zl("condition",t,e,n),"bool"),s=[await uc(r)];return r.dispose(),s}case"ListDiff":return Mu(Zl("x",t,e,n),Zl("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n);case"evaluation":return vs((()=>((t,e,n)=>{switch(t.op){case"LowerBound":return[Sa(Zl("sortedSequence",t,e,n),Zl("values",t,e,n))];case"TopKV2":{const r=Zl("x",t,e,n),s=Zl("k",t,e,n),o=Zl("sorted",t,e,n),i=ec(r,s,o);return[i.values,i.indices]}case"UpperBound":return[ic(Zl("sortedSequence",t,e,n),Zl("values",t,e,n))];case"Unique":{const r=Zl("x",t,e,n),s=rc(r);return[s.values,s.indices]}case"UniqueV2":{const r=Zl("x",t,e,n),s=Zl("axis",t,e,n),o=rc(r,s);return[o.values,o.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"image":return vs((()=>((t,e,n)=>{switch(t.op){case"ResizeBilinear":{const r=Zl("images",t,e,n),s=Zl("size",t,e,n),o=Zl("alignCorners",t,e,n),i=Zl("halfPixelCenters",t,e,n);return[_l.resizeBilinear(r,[s[0],s[1]],o,i)]}case"ResizeNearestNeighbor":{const r=Zl("images",t,e,n),s=Zl("size",t,e,n),o=Zl("alignCorners",t,e,n),i=Zl("halfPixelCenters",t,e,n);return[_l.resizeNearestNeighbor(r,[s[0],s[1]],o,i)]}case"CropAndResize":{const r=Zl("image",t,e,n),s=Zl("boxes",t,e,n),o=Zl("boxInd",t,e,n),i=Zl("cropSize",t,e,n),a=Zl("method",t,e,n),u=Zl("extrapolationValue",t,e,n);return[_l.cropAndResize(r,s,o,i,a,u)]}case"ImageProjectiveTransformV3":{const r=Zl("images",t,e,n),s=Zl("transforms",t,e,n),o=Zl("outputShape",t,e,n),i=Zl("fillValue",t,e,n),a=Zl("interpolation",t,e,n),u=Zl("fillMode",t,e,n);return[_l.transform(r,s,a.toLowerCase(),u.toLowerCase(),i,o)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"graph":return vs((()=>((t,e,n)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const r=Zl("default",t,e,n);return[Ql(t.name,e,n)||r];case"Placeholder":return[Ql(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[sf(Zl("x",t,e,n))];case"IdentityN":return Zl("x",t,e,n).map((t=>sf(t)));case"Shape":return[Qu(Zl("x",t,e,n).shape,"int32")];case"ShapeN":return Zl("x",t,e,n).map((t=>Qu(t.shape)));case"Size":return[Bi(Zl("x",t,e,n).size,"int32")];case"Rank":return[Bi(Zl("x",t,e,n).rank,"int32")];case"NoOp":return[Bi(1)];case"Print":const s=Zl("x",t,e,n),o=Zl("data",t,e,n),i=Zl("message",t,e,n),a=Zl("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(i);for(let t=0;t<o.length;t++)console.log(Array.prototype.slice.call(o[t].dataSync()).slice(0,a));return[s];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"logical":return vs((()=>((t,e,n)=>{switch(t.op){case"Equal":return[Si(Zl("a",t,e,n),Zl("b",t,e,n))];case"NotEqual":return[Ba(Zl("a",t,e,n),Zl("b",t,e,n))];case"Greater":return[ta(Zl("a",t,e,n),Zl("b",t,e,n))];case"GreaterEqual":return[ea(Zl("a",t,e,n),Zl("b",t,e,n))];case"Less":return[ia(Zl("a",t,e,n),Zl("b",t,e,n))];case"LessEqual":return[aa(Zl("a",t,e,n),Zl("b",t,e,n))];case"LogicalAnd":return[va(Zl("a",t,e,n),Zl("b",t,e,n))];case"LogicalNot":return[xa(Zl("a",t,e,n))];case"LogicalOr":return[Na(Zl("a",t,e,n),Zl("b",t,e,n))];case"Select":case"SelectV2":return[_i(Zl("condition",t,e,n),Zl("a",t,e,n),Zl("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"matrices":return vs((()=>((t,e,n)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[gs(Zl("a",t,e,n),Zl("b",t,e,n),Zl("transposeA",t,e,n),Zl("transposeB",t,e,n))];case"Einsum":return[Ci(Zl("equation",t,e,n),...Zl("tensors",t,e,n))];case"Transpose":return[ks(Zl("x",t,e,n),Zl("perm",t,e,n))];case"_FusedMatMul":const[r,s]=Zl("fusedOps",t,e,n),o="biasadd"===r,i="prelu"===s,a=Zl("numArgs",t,e,n),u=Zl("leakyreluAlpha",t,e,n);if(o){if(i&&2!==a)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!i&&1!==a)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[c,l]=Zl("args",t,e,n);return[Tc({a:Zl("a",t,e,n),b:Zl("b",t,e,n),transposeA:Zl("transposeA",t,e,n),transposeB:Zl("transposeB",t,e,n),bias:c,activation:s,preluActivationWeights:l,leakyreluAlpha:u})];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"normalization":return vs((()=>((t,e,n)=>{switch(t.op){case"EuclideanNorm":return[Gi(Zl("x",t,e,n),Zl("axis",t,e,n),Zl("keepDims",t,e,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[Jo(Zl("x",t,e,n),Zl("mean",t,e,n),Zl("variance",t,e,n),Zl("offset",t,e,n),Zl("scale",t,e,n),Zl("epsilon",t,e,n))];case"LRN":return[ca(Zl("x",t,e,n),Zl("radius",t,e,n),Zl("bias",t,e,n),Zl("alpha",t,e,n),Zl("beta",t,e,n))];case"Softmax":return[zu(Zl("x",t,e,n))];case"LogSoftmax":return[ba(Zl("x",t,e,n))];case"SparseToDense":return[hc(Zl("sparseIndices",t,e,n),Zl("outputShape",t,e,n),Zl("sparseValues",t,e,n),Zl("defaultValue",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"reduction":return vs((()=>((t,e,n)=>{switch(t.op){case"Max":{const r=Zl("axis",t,e,n),s=Zl("keepDims",t,e,n);return[Fi(Zl("x",t,e,n),r,s)]}case"Mean":{const r=Zl("axis",t,e,n),s=Zl("keepDims",t,e,n);return[Ca(Zl("x",t,e,n),r,s)]}case"Min":{const r=Zl("axis",t,e,n),s=Zl("keepDims",t,e,n);return[Li(Zl("x",t,e,n),r,s)]}case"Sum":{const r=Zl("axis",t,e,n),s=Zl("keepDims",t,e,n);return[Wi(Zl("x",t,e,n),r,s)]}case"All":{const r=Zl("axis",t,e,n),s=Zl("keepDims",t,e,n);return[vo(Zl("x",t,e,n),r,s)]}case"Any":{const r=Zl("axis",t,e,n),s=Zl("keepDims",t,e,n);return[xo(Zl("x",t,e,n),r,s)]}case"ArgMax":{const r=Zl("axis",t,e,n);return[No(Zl("x",t,e,n),r)]}case"ArgMin":{const r=Zl("axis",t,e,n);return[$o(Zl("x",t,e,n),r)]}case"Prod":{const r=Zl("axis",t,e,n),s=Zl("keepDims",t,e,n);return[Ja(Zl("x",t,e,n),r,s)]}case"Cumprod":{const r=Zl("axis",t,e,n),s=Zl("exclusive",t,e,n),o=Zl("reverse",t,e,n);return[bi(Zl("x",t,e,n),r,s,o)]}case"Cumsum":{const r=Zl("axis",t,e,n),s=Zl("exclusive",t,e,n),o=Zl("reverse",t,e,n);return[wi(Zl("x",t,e,n),r,s,o)]}case"Bincount":const r=Zl("x",t,e,n),s=Zl("weights",t,e,n),o=Zl("size",t,e,n);return[ti(r,s,o)];case"DenseBincount":{const r=Zl("x",t,e,n),s=Zl("weights",t,e,n),o=Zl("size",t,e,n),i=Zl("binaryOutput",t,e,n);return[vi(r,s,o,i)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"slice_join":return vs((()=>((t,e,n)=>{switch(t.op){case"ConcatV2":case"Concat":{const r=Zl("n",t,e,n),s=Zl("axis",t,e,n);let o=Zl("tensors",t,e,n);return o=o.slice(0,r),[jo(o,s)]}case"Gather":{const r=Zl("x",t,e,n),s=Zl("indices",t,e,n);return[Qi(r,Zr(s,"int32"),0)]}case"GatherV2":{const r=Zl("axis",t,e,n),s=Zl("batchDims",t,e,n),o=Zl("x",t,e,n),i=Zl("indices",t,e,n);return[Qi(o,Zr(i,"int32"),r,s)]}case"Reverse":{const r=Zl("dims",t,e,n),s=[];for(let t=0;t<r.length;t++)r[t]&&s.push(t);const o=Zl("x",t,e,n);return[Eu(o,s)]}case"ReverseV2":{const r=Zl("axis",t,e,n),s=Zl("x",t,e,n);return[Eu(s,r)]}case"Slice":{const r=Zl("begin",t,e,n),s=Zl("size",t,e,n);return[qo(Zl("x",t,e,n),r,s)]}case"StridedSlice":{const r=Zl("begin",t,e,n),s=Zl("end",t,e,n),o=Zl("strides",t,e,n),i=Zl("beginMask",t,e,n),a=Zl("endMask",t,e,n),u=Zl("ellipsisMask",t,e,n),c=Zl("newAxisMask",t,e,n),l=Zl("shrinkAxisMask",t,e,n),f=Zl("x",t,e,n);return[Yu(f,r,s,o,i,a,u,c,l)]}case"Pack":return vs((()=>{const r=Zl("axis",t,e,n),s=Zl("tensors",t,e,n),o=s[0].shape,i=Ku(s[0]).shape,a=s.map((t=>{const e=_(t.shape,o);if(!e&&!_(Ku(t).shape,i))throw new Error("the input tensors shape does not match");return e?t:zo(t,o)}));return[Xu(a,r)]}));case"Unpack":{const r=Zl("axis",t,e,n),s=Zl("tensor",t,e,n);return oc(s,r)}case"Tile":{const r=Zl("reps",t,e,n);return[Xi(Zl("x",t,e,n),r)]}case"Split":case"SplitV":{const r=Zl("axis",t,e,n),s=Zl("numOrSizeSplits",t,e,n),o=Zl("x",t,e,n);return Gu(o,s,r)}case"ScatterNd":{const r=Zl("indices",t,e,n),s=Zl("values",t,e,n),o=Zl("shape",t,e,n);return[fc(r,s,o)]}case"GatherNd":{const r=Zl("x",t,e,n),s=Zl("indices",t,e,n);return[pc(r,s)]}case"SparseToDense":{const r=Zl("sparseIndices",t,e,n),s=Zl("outputShape",t,e,n),o=Zl("sparseValues",t,e,n),i=Zl("defaultValue",t,e,n);return[hc(r,o,s,o.dtype===i.dtype?i:Zr(i,o.dtype))]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"sparse":return vs((()=>((t,e,n)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:s,emptyRowIndicator:o,reverseIndexMap:i}=Al.sparseFillEmptyRows(Zl("indices",t,e,n),Zl("values",t,e,n),Zl("denseShape",t,e,n),Zl("defaultValue",t,e,n));return[r,s,o,i]}case"SparseReshape":{const{outputIndices:r,outputShape:s}=Al.sparseReshape(Zl("inputIndices",t,e,n),Zl("inputShape",t,e,n),Zl("newShape",t,e,n));return[r,s]}case"SparseSegmentMean":return[Al.sparseSegmentMean(Zl("data",t,e,n),Zl("indices",t,e,n),Zl("segmentIds",t,e,n))];case"SparseSegmentSum":return[Al.sparseSegmentSum(Zl("data",t,e,n),Zl("indices",t,e,n),Zl("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"spectral":return vs((()=>((t,e,n)=>{switch(t.op){case"FFT":return[Wu(Zl("x",t,e,n))];case"IFFT":return[Uu(Zl("x",t,e,n))];case"RFFT":return[qu(Zl("x",t,e,n))];case"IRFFT":return[ju(Zl("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"string":return vs((()=>((t,e,n)=>{switch(t.op){case"StringNGrams":{const{nGrams:r,nGramsSplits:s}=Cl.stringNGrams(Zl("data",t,e,n),Zl("dataSplits",t,e,n),Zl("separator",t,e,n),Zl("nGramWidths",t,e,n),Zl("leftPad",t,e,n),Zl("rightPad",t,e,n),Zl("padWidth",t,e,n),Zl("preserveShortSequences",t,e,n));return[r,s]}case"StringSplit":{const{indices:r,values:s,shape:o}=Cl.stringSplit(Zl("input",t,e,n),Zl("delimiter",t,e,n),Zl("skipEmpty",t,e,n));return[r,s,o]}case"StringToHashBucketFast":return[Cl.stringToHashBucketFast(Zl("input",t,e,n),Zl("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"transformation":return vs((()=>((t,e,n)=>{switch(t.op){case"Cast":return[Zr(Zl("x",t,e,n),Zl("dtype",t,e,n))];case"ExpandDims":{const r=Zl("axis",t,e,n);return[Hi(Zl("x",t,e,n),r)]}case"Squeeze":{const r=Zl("axis",t,e,n);return[Ku(Zl("x",t,e,n),r)]}case"Reshape":return[zo(Zl("x",t,e,n),Zl("shape",t,e,n))];case"MirrorPad":return[Ra(Zl("x",t,e,n),Zl("padding",t,e,n),Zl("mode",t,e,n))];case"PadV2":case"Pad":return[Wa(Zl("x",t,e,n),Zl("padding",t,e,n),Zl("constantValue",t,e,n))];case"SpaceToBatchND":{const r=Zl("blockShape",t,e,n),s=Zl("paddings",t,e,n);return[Ha(Zl("x",t,e,n),r,s)]}case"BatchToSpaceND":{const r=Zl("blockShape",t,e,n),s=Zl("crops",t,e,n);return[Xo(Zl("x",t,e,n),r,s)]}case"DepthToSpace":{const r=Zl("blockSize",t,e,n),s=Zl("dataFormat",t,e,n).toUpperCase();return[xi(Zl("x",t,e,n),r,s)]}case"BroadcastTo":return[ni(Zl("x",t,e,n),Zl("shape",t,e,n))];case"BroadcastArgs":return[ei(Zl("s0",t,e,n),Zl("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"hash_table":return(async(t,e,n,r)=>{switch(t.op){case"HashTable":case"HashTableV2":{const s=Zl("keyDType",t,e,n),o=Zl("valueDType",t,e,n),i=new Jf(s,o);return r.addHashTable(t.name,i),[i.handle]}case"LookupTableImport":case"LookupTableImportV2":{const s=Zl("tableHandle",t,e,n,r),o=Zl("keys",t,e,n),i=Zl("values",t,e,n),a=r.getHashTableById(s.id);return[await a.import(o,i)]}case"LookupTableFind":case"LookupTableFindV2":{const s=Zl("tableHandle",t,e,n,r),o=Zl("keys",t,e,n),i=Zl("defaultValue",t,e,n),a=r.getHashTableById(s.id);return[await a.find(o,i)]}case"LookupTableSize":case"LookupTableSizeV2":{const s=Zl("tableHandle",t,e,n,r);return[r.getHashTableById(s.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n,r);case"custom":const s=Yl(t.op);if(s&&s.customExecutor)return s.customExecutor(new Vf(t,e,n));throw TypeError(`Custom op ${t.op} is not registered.`);default:throw TypeError(`Unknown op '${t.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return J(s)?s.then((t=>[].concat(t))):[].concat(s)}class Zf{constructor(t={},e={},n={},r={}){this.weightMap=t,this.tensorArrayMap=e,this.tensorListMap=n,this.functionMap=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(t,e){return{id:t,frameName:e,iterationId:0}}set currentContext(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const t=[];for(let e=0;e<this.contexts.length-1;e++){const n=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(n))}t.push(""),this._currentContextIds=t}contextIdforContexts(t){return t?t.map((t=>0===t.id&&0===t.iterationId?"":`${t.frameName}-${t.iterationId}`)).join("/"):""}enterFrame(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(t){return this.weightMap[t]}addTensorArray(t){this.tensorArrayMap[t.id]=t}getTensorArray(t){return this.tensorArrayMap[t]}addTensorList(t){this.tensorListMap[t.id]=t}getTensorList(t){return this.tensorListMap[t]}dispose(t){for(const e in this.tensorArrayMap)this.tensorArrayMap[e].clearAndClose(t);for(const e in this.tensorListMap)this.tensorListMap[e].clearAndClose(t)}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qf(t,e,n,r){const s=new Set,o=[];let i=null,a=null;const u=new Set,c=Object.keys(t).map((t=>nf(t)[0]));let l=[];null!=r&&(l=r.map((t=>nf(t.name)[0])));const f=[...e];for(;f.length>0;){const t=f.pop();(rh(t)||sh(t)||oh(t))&&null==i&&(i=t,a=i.children.map((t=>t.name)).filter((t=>s.has(t)))),s.add(t.name),null==n[t.name]&&(-1===c.indexOf(t.name)&&-1===l.indexOf(t.name)&&(0!==t.inputs.length?t.inputs.forEach((t=>{u.has(t.name)||(u.add(t.name),f.push(t))})):o.push(t.name)))}return{inputs:t,outputs:e,usedNodes:s,missingInputs:o,dynamicNode:i,syncInputs:a}}const th=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],eh=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],nh=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function rh(t){return th.indexOf(t.op)>=0}function sh(t){return eh.indexOf(t.op)>=0}function oh(t){return nh.indexOf(t.op)>=0}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ih{constructor(t,e){this.graph=t,this.parent=e,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((e=>{this._functionExecutorMap[e]=new ih(t.functions[e],this)}))}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){const e=Object.keys(t).map((e=>t[e].map((t=>t.id))));this._weightIds=[].concat(...e),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get outputs(){return this._outputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get inputNodes(){return this._inputs.map((t=>t.signatureKey||t.name))}get outputNodes(){return this._outputs.map((t=>{const e=t.signatureKey||t.name;return t.defaultOutput?`${e}:${t.defaultOutput}`:e}))}get functions(){return Object.keys(this._functions).reduce(((t,e)=>(t[e]=this._functions[e].signature,t)),{})}getCompilationKey(t,e){const n=t.map((t=>t.name)).sort(),r=e.map((t=>t.name)).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}compile(t,e){const n=Qf(t,e,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:s,syncInputs:o}=n;if(null!=s)throw new Error(`This execution contains the node '${s.name}', which has the dynamic op '${s.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(r.length>0){const n=e.map((t=>t.name)),s=Object.keys(t);throw new Error(`Cannot compute the outputs [${n}] from the provided inputs [${s}]. Missing the following inputs: [${r}]`)}return function(t,e,n){const{usedNodes:r,inputs:s}=n,o=[],i=Object.keys(s).map((t=>nf(t)[0])).map((e=>t.nodes[e])),a=t.initNodes;i.forEach((t=>{r.has(t.name)&&o.push(t)})),t.weights.forEach((t=>{r.has(t.name)&&o.push(t)})),null!=a&&a.forEach((t=>{r.has(t.name)&&o.push(t)}));const u=new Set,c=[];for(;o.length>0;){const t=o.pop();u.add(t.name),e[t.name]||c.push(t),t.children.forEach((t=>{!u.has(t.name)&&r.has(t.name)&&t.inputs.every((t=>u.has(t.name)))&&o.push(t)}))}return c}(this.graph,this.weightMap,n)}execute(t,e){t=this.mapInputs(t);const n=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e);const r=n.map((t=>this.graph.nodes[nf(t)[0]])),s=e.map((t=>nf(t)[0]));let o=s.map((t=>this.graph.nodes[t]));this.resetIntermediateTensors(),0===o.length&&(o=this._outputs);const i=this.getCompilationKey(r,o);let a=this.compiledMap.get(i);null==a&&(a=this.compile(t,o),this.compiledMap.set(i,a));const u={},c={};return vs((()=>{const n=new Zf(this.weightMap,u,c,this.functionExecutorMap),r=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,s]=nf(e),o=[];o[s]=t[e],r[n]=o}));const o=this.getFrozenTensorIds(r),i={};for(let t=0;t<a.length;t++){const e=a[t];if(!r[e.name]){const t=Yf(e,r,n,this._resourceManager);if(J(t))throw new Error(`The execution of the op '${e.op}' returned a promise. Please use model.executeAsync() instead.`);r[e.name]=t,this.checkTensorForDisposal(e.name,e,r,n,o,s,i)}}return null==this.parent&&n.dispose(o),e.map((t=>Ql(t,r,n)))}))}getFrozenTensorIds(t){const e=[].concat.apply([],Object.keys(t).map((e=>t[e])).map((t=>t.map((t=>t.id)))));return new Set(e)}checkTensorForDisposal(t,e,n,r,s,o,i){"control"!==e.category&&-1===o.indexOf(t)&&(n[t].forEach((t=>{null!=t&&(i[t.id]=(i[t.id]||0)+e.children.length)})),e.inputs.forEach((t=>{if("control"!==t.category){const o=function(t,e,n){return e[ef(t,n.currentContextId)]}(t.name,n,r);null!=o&&o.forEach((t=>{if(t&&!t.kept&&!s.has(t.id)){const n=i[t.id];if(1===n){if(this.keepTensorForDebug){const[n,s]=tf(e.name,r);this.intermediateTensors[n]||(this.intermediateTensors[n]=[]),this.intermediateTensors[n][s]=t}else t.dispose();delete i[t.id]}else null!=n&&i[t.id]--}}))}})))}async executeAsync(t,e){return this._executeAsync(t,e)}disposeIntermediateTensors(){this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach((t=>this.intermediateTensors[t].forEach((t=>t.dispose())))),this.disposeTensorsMap())}disposeTensorsMap(){this.tensorsMap&&Object.keys(this.tensorsMap).forEach((t=>{this.tensorsMap[t].forEach((t=>{!t||t.kept||t.isDisposed||this.keepIds.has(t.id)||t.dispose()}))}))}getIntermediateTensors(){return this.tensorsMap}resetIntermediateTensors(){for(const t in this.intermediateTensors)this.intermediateTensors[t].forEach((t=>t.dispose())),delete this.intermediateTensors[t]}async _executeAsync(t,e,n=!1,r={},s={}){n||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e));try{this.keepTensorForDebug=Q().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(t){console.warn(t.message)}this.resetIntermediateTensors();const o=new Zf(this.weightMap,r,s,this.functionExecutorMap);this.tensorsMap=await this.executeWithControlFlow(t,o,e,n);const i=e.map((t=>Ql(t,this.tensorsMap,o))),a=i.map((t=>t.id)),u=Object.keys(t).map((e=>t[e].id));return this.keepIds=new Set([...a,...u,...this.weightIds]),this.keepTensorForDebug||this.disposeTensorsMap(),null==this.parent&&o.dispose(this.keepIds),i}async executeFunctionAsync(t,e,n){const r=t.reduce(((t,e,n)=>(t[this.inputs[n].name]=e,t)),{});return this._executeAsync(r,this.outputNodes,!0,e,n)}async executeWithControlFlow(t,e,n,r){const s=Object.keys(t),o=s.map((t=>this.graph.nodes[nf(t)[0]])),i=n.map((t=>nf(t)[0]));let a=i.map((t=>this.graph.nodes[t]));0===a.length&&(a=this._outputs);const{usedNodes:u,missingInputs:c,dynamicNode:l,syncInputs:f}=Qf(t,a,this.weightMap,this._initNodes),h=[...o,...this.graph.weights,...this._initNodes||[]].map((t=>({node:t,contexts:e.currentContext}))),p=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,r]=nf(e),s=[];s[r]=t[e],p[n]=s}));const d={},m=this.getFrozenTensorIds(p),y={};for(;h.length>0;){const t=this.processStack(o,h,e,p,y,m,i,d,u);await Promise.all(t)}null!=l||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const g=a.filter((t=>!rh(t)&&!Ql(t.name,p,e))).map((t=>t.name));if(g.length>0){let t="";throw null!=l&&(t=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${f}]`),new Error(`Cannot compute the outputs [${g}] from the provided inputs [${s}]. Consider providing the following inputs: [${c}]. ${t}`)}return p}processStack(t,e,n,r,s,o,i,a,u){const c=[];for(;e.length>0;){const t=e.pop();n.currentContext=t.contexts;let l="";if("Enter"===t.node.op&&Zl("isConstant",t.node,r,n)&&([l]=tf(t.node.name,n)),null==r[t.node.name]){const f=Yf(t.node,r,n,this._resourceManager);l||([l]=tf(t.node.name,n));const h=n.currentContext;J(f)?c.push(f.then((c=>(r[l]=c,n.currentContext=h,this.checkTensorForDisposal(l,t.node,r,n,o,i,a),this.processChildNodes(t.node,e,n,r,s,u),c)))):(r[l]=f,this.checkTensorForDisposal(l,t.node,r,n,o,i,a),this.processChildNodes(t.node,e,n,r,s,u))}else this.processChildNodes(t.node,e,n,r,s,u)}return c}processChildNodes(t,e,n,r,s,o){t.children.forEach((t=>{const[i]=tf(t.name,n);!s[i]&&o.has(t.name)&&("Merge"===t.op?t.inputNames.some((t=>!!Ql(t,r,n)))&&(s[i]=!0,e.push({contexts:n.currentContext,node:t})):t.inputNames.every((t=>!!Ql(t,r,n)))&&(s[i]=!0,e.push({contexts:n.currentContext,node:t})))}))}dispose(){Object.keys(this.weightMap).forEach((t=>this.weightMap[t].forEach((t=>t.dispose()))))}checkInputShapeAndType(t){Object.keys(t).forEach((e=>{const n=t[e],[r]=nf(e),s=this.graph.nodes[r];if(s.attrParams.shape&&s.attrParams.shape.value){const t=s.attrParams.shape.value,e=t.length===n.shape.length&&n.shape.every(((e,n)=>-1===t[n]||t[n]===e));x(e,(()=>`The shape of dict['${s.name}'] provided in model.execute(dict) must be [${t}], but was [${n.shape}]`))}s.attrParams.dtype&&s.attrParams.dtype.value&&x(n.dtype===s.attrParams.dtype.value,(()=>`The dtype of dict['${s.name}'] provided in model.execute(dict) must be ${s.attrParams.dtype.value}, but was ${n.dtype}`))}))}mapInputs(t){const e={};for(const n in t)if(null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]){e[this._signature.inputs[n].name]=t[n]}else e[n]=t[n];return e}checkInputs(t){const e=Object.keys(t).filter((t=>{const[e]=nf(t);return null==this.graph.nodes[e]}));if(e.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${e}] that are not part of graph`)}mapOutputs(t){return t.map((t=>{if(null!=this._signature&&null!=this._signature.outputs&&null!=this._signature.outputs[t]){return this._signature.outputs[t].name}return t}),{})}checkOutputs(t){t.forEach((t=>{const[e]=nf(t);if(!this.graph.nodes[e])throw new Error(`The output '${t}' is not found in the graph`)}))}}class ah{constructor(t={},e={}){this.hashTableNameToHandle=t,this.hashTableMap=e}addHashTable(t,e){this.hashTableNameToHandle[t]=e.handle,this.hashTableMap[e.id]=e}getHashTableHandleByName(t){return this.hashTableNameToHandle[t]}getHashTableById(t){return this.hashTableMap[t]}dispose(){for(const t in this.hashTableMap)this.hashTableMap[t].clearAndClose(),delete this.hashTableMap[t];for(const t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uh{constructor(t,e={}){this.modelUrl=t,this.loadOptions=e,this.version="n/a",null==e&&(this.loadOptions={}),this.resourceManager=new ah}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}findIOHandler(){const t=this.modelUrl;if(null!=t.load)this.handler=t;else if(null!=this.loadOptions.requestInit)this.handler=fs(t,this.loadOptions);else{const e=_r(t,this.loadOptions);if(0===e.length)e.push(fs(t,this.loadOptions));else if(e.length>1)throw new Error(`Found more than one (${e.length}) load handlers for URL '${[t]}'`);this.handler=e[0]}}load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const t=this.handler.load();return J(t)?t.then((t=>this.loadSync(t))):this.loadSync(t)}loadSync(t){this.artifacts=t;const e=this.artifacts.modelTopology;let n;n=null!=this.artifacts.userDefinedMetadata&&null!=this.artifacts.userDefinedMetadata.signature?this.artifacts.userDefinedMetadata.signature:this.artifacts.signature,this.signature=n,this.version=`${e.versions.producer}.${e.versions.minConsumer}`;const r=dr(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new ih(Sf.Instance.transformGraph(e,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=t.modelInitializer&&null!=t.modelInitializer.node){const e=Sf.Instance.transformGraph(t.modelInitializer);this.initializer=new ih(e),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(t,e){if("string"==typeof t){const e=Sr(t);if(0===e.length)throw new Error(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new Error(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}if(null==t.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return t.save(this.artifacts)}predict(t,e){return this.execute(t,this.outputNodes)}normalizeInputs(t){if(!(t instanceof Le||Array.isArray(t)))return t;if((t=Array.isArray(t)?t:[t]).length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${t.length} input tensors.`);return this.inputNodes.reduce(((e,n,r)=>(e[n]=t[r],e)),{})}normalizeOutputs(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]}execute(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=this.executor.execute(t,e);return n.length>1?n:n[0]}async executeAsync(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=await this.executor.executeAsync(t,e);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(t){return Object.keys(t).reduce(((e,n)=>(e[n]=[t[n]],e)),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}async function ch(t,e={}){if(null==t)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==e&&(e={}),e.fromTFHub&&"string"==typeof t&&(t=function(t){t.endsWith("/")||(t+="/");return`${t}model.json?tfjs-format=file`}
/**
    * @license
    * Copyright 2021 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */(t));const n=new uh(t,e);return await n.load(),n}var lh=function(t,e){return(lh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function fh(t,e){function n(){this.constructor=t}lh(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var hh=function(){return(hh=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)};function ph(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}u((r=r.apply(t,e||[])).next())}))}function dh(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=(s=i.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function mh(t){var e=t.shape[2],n=No(t,2),r=zo(n,[-1]);return bs(r,e)}function yh(t,e){return vs((function(){return Zr(ta(t,Bi(e)),"int32")}))}function gh(t,e){var n=e.shape,r=n[0],s=n[1],o=n[2];return vs((function(){var n=mh(e),i=Hi(vu(0,o,1,"int32"),1),a=Zr(gs(n,i),"int32"),u=zo(a,[r,s]),c=fo(u,Bi(1,"int32"));return ga(function(t,e){return mo(t,e)}(c,t),Bi(1,"int32"))}))}function bh(t){var e=t.shape,n=e[0],r=e[1],s=e[2];return vs((function(){var e=mh(t),o=Hi(vu(0,s,1,"int32"),1),i=Zr(gs(e,o),"int32");return zo(i,[n,r])}))}var wh=function(){function t(t,e){this.model=t,this.outputStride=e;var n=this.model.inputs[0].shape;x(-1===n[1]&&-1===n[2],(function(){return"Input shape ["+n[1]+", "+n[2]+"] must both be equal to or -1"}))}return t.prototype.predict=function(t){var e=this;return vs((function(){var n=e.preprocessInput(Zr(t,"float32")),r=Hi(n,0),s=e.model.predict(r).map((function(t){return Ku(t,[0])})),o=e.nameOutputResults(s);return{heatmapScores:Go(o.heatmap),offsets:o.offsets,displacementFwd:o.displacementFwd,displacementBwd:o.displacementBwd,segmentation:o.segmentation,partHeatmaps:o.partHeatmaps,longOffsets:o.longOffsets,partOffsets:o.partOffsets}}))},t.prototype.dispose=function(){this.model.dispose()},t}(),vh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return fh(e,t),e.prototype.preprocessInput=function(t){return vs((function(){return ga(po(t,127.5),1)}))},e.prototype.nameOutputResults=function(t){return{offsets:t[0],segmentation:t[1],partHeatmaps:t[2],longOffsets:t[3],heatmap:t[4],displacementFwd:t[5],displacementBwd:t[6],partOffsets:t[7]}},e}(wh),xh=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],Nh=xh.length,$h=xh.reduce((function(t,e,n){return t[e]=n,t}),{});function Eh(t,e,n){var r=t[0],s=t[1],o=e[0],i=e[1],a=n.top,u=n.bottom;return[i/(n.left+n.right+s),o/(a+u+r)]}function Sh(t,e,n,r){return{y:r.get(t,e,n),x:r.get(t,e,n+Nh)}}function _h(t,e,n){var r=Sh(t.heatmapY,t.heatmapX,t.id,n),s=r.y,o=r.x;return{x:t.heatmapX*e+o,y:t.heatmapY*e+s}}function Th(t,e,n){return t<e?e:t>n?n:t}function kh(t,e){return{x:t.x+e.x,y:t.y+e.y}}function Ah(t,e,n){void 0===n&&(n=.3);for(var r=0,s=0,o=0;o<t.length;o++)e.keypoints[o].score>n&&(s+=1,r+=Math.pow(t[o].x-e.keypoints[o].position.x,2)+Math.pow(t[o].y-e.keypoints[o].position.y,2));return 0===s?r=1/0:r/=s,r}function Ch(t,e,n,r,s,o,i){for(var a=i[0],u=i[1],c=n(t),l=c.y*r+c.x,f=s[Nh*(2*l)+e],h=s[Nh*(2*l+1)+e],p=t.y+f,d=t.x+h,m=0;m<o;m++){p=Math.min(p,a-1);var y=n({x:d=Math.min(d,u-1),y:p}),g=y.y*r+y.x;p+=f=s[Nh*(2*g)+e],d+=h=s[Nh*(2*g+1)+e]}return{x:d,y:p}}function Oh(t,e,n,r,s,o,i,a,u,c){for(var l=s[0],f=s[1],h=o[0],p=o[1],d=a[0],m=a[1],y=[],g=function(t){return function(t,e,n,r){var s=e[0],o=e[1],i=n[0],a=n[1],u=Math.round(((s+t.y+1)*a-1)/r);return{x:Math.round(((o+t.x+1)*i-1)/r),y:u}}(t,[l,f],[h,p],u)},b=0;b<r;b++){var w=Ch(t,b,g,i,e,c,[d,m]);y.push(w)}for(var v=-1,x=1/0,N=0;N<n.length;N++){var $=Ah(y,n[N]);$<x&&(v=N,x=$)}return v}function Ih(t,e){var n=t[0],r=t[1];return[Math.round((r-1)/e+1),Math.round((n-1)/e+1)]}function Mh(t,e,n,r,s,o,i,a,u,c,l){for(var f=i[0],h=i[1],p=t.shape,d=p[0],m=p[1],y=e.shape.slice(0,2),g=y[0],b=y[1],w=zo(e,[g,b,2,Nh]),v=new Float32Array(l*Nh*3).fill(0),x=0;x<n.length;x++)for(var N=x*Nh*3,$=n[x],E=0;E<Nh;E++){var S=$.keypoints[E],_=N+3*E;v[_]=S.score,v[_+1]=S.position.y,v[_+2]=S.position.x}var T=Eh([r,s],[f,h],a),k=T[0],A=T[1],C=hr(v,[l,Nh,3]),O=a.top,I=a.left,M={variableNames:["segmentation","longOffsets","poses"],outputShape:[d,m],userCode:"\n    int convertToPositionInOutput(int pos, int pad, float scale, int stride) {\n      return round(((float(pos + pad) + 1.0) * scale - 1.0) / float(stride));\n    }\n\n    float convertToPositionInOutputFloat(\n        int pos, int pad, float scale, int stride) {\n      return ((float(pos + pad) + 1.0) * scale - 1.0) / float(stride);\n    }\n\n    float dist(float x1, float y1, float x2, float y2) {\n      return pow(x1 - x2, 2.0) + pow(y1 - y2, 2.0);\n    }\n\n    float sampleLongOffsets(float h, float w, int d, int k) {\n      float fh = fract(h);\n      float fw = fract(w);\n      int clH = int(ceil(h));\n      int clW = int(ceil(w));\n      int flH = int(floor(h));\n      int flW = int(floor(w));\n      float o11 = getLongOffsets(flH, flW, d, k);\n      float o12 = getLongOffsets(flH, clW, d, k);\n      float o21 = getLongOffsets(clH, flW, d, k);\n      float o22 = getLongOffsets(clH, clW, d, k);\n      float o1 = mix(o11, o12, fw);\n      float o2 = mix(o21, o22, fw);\n      return mix(o1, o2, fh);\n    }\n\n    int findNearestPose(int h, int w) {\n      float prob = getSegmentation(h, w);\n      if (prob < 1.0) {\n        return -1;\n      }\n\n      // Done(Tyler): convert from output space h/w to strided space.\n      float stridedH = convertToPositionInOutputFloat(\n        h, "+O+", "+A+", "+o+");\n      float stridedW = convertToPositionInOutputFloat(\n        w, "+I+", "+k+", "+o+");\n\n      float minDist = 1000000.0;\n      int iMin = -1;\n      for (int i = 0; i < "+l+"; i++) {\n        float curDistSum = 0.0;\n        int numKpt = 0;\n        for (int k = 0; k < "+Nh+"; k++) {\n          float dy = sampleLongOffsets(stridedH, stridedW, 0, k);\n          float dx = sampleLongOffsets(stridedH, stridedW, 1, k);\n\n          float y = float(h) + dy;\n          float x = float(w) + dx;\n\n          for (int s = 0; s < "+u+"; s++) {\n            int yRounded = round(min(y, float("+(r-1)+")));\n            int xRounded = round(min(x, float("+(s-1)+")));\n\n            float yStrided = convertToPositionInOutputFloat(\n              yRounded, "+O+", "+A+", "+o+");\n            float xStrided = convertToPositionInOutputFloat(\n              xRounded, "+I+", "+k+", "+o+");\n\n            float dy = sampleLongOffsets(yStrided, xStrided, 0, k);\n            float dx = sampleLongOffsets(yStrided, xStrided, 1, k);\n\n            y = y + dy;\n            x = x + dx;\n          }\n\n          float poseScore = getPoses(i, k, 0);\n          float poseY = getPoses(i, k, 1);\n          float poseX = getPoses(i, k, 2);\n          if (poseScore > "+c+") {\n            numKpt = numKpt + 1;\n            curDistSum = curDistSum + dist(x, y, poseX, poseY);\n          }\n        }\n        if (numKpt > 0 && curDistSum / float(numKpt) < minDist) {\n          minDist = curDistSum / float(numKpt);\n          iMin = i;\n        }\n      }\n      return iMin;\n    }\n\n    void main() {\n        ivec2 coords = getOutputCoords();\n        int nearestPose = findNearestPose(coords[0], coords[1]);\n        setOutput(float(nearestPose));\n      }\n  "};return Es().compileAndRun(M,[t,w,C])}function Rh(){return"webgl"===$s()}function Dh(t,e,n,r,s,o,i,a,u,c,l,f){var h=i[0],p=i[1];return void 0===u&&(u=.2),void 0===c&&(c=8),void 0===l&&(l=.3),void 0===f&&(f=10),ph(this,void 0,void 0,(function(){var i,d,m,y,g;return dh(this,(function(b){switch(b.label){case 0:return i=n.filter((function(t){return t.score>=u})),Rh()?(m=vs((function(){var n=Mh(t,e,i,r,s,o,[h,p],a,c,l,f),u=ws().makeTensorFromDataId(n.dataId,n.shape,n.dtype);return i.map((function(t,e){return function(t,e){return vs((function(){return Zr(Si(t,Bi(e)),"int32")}))}(u,e)}))})),[4,Promise.all(m.map((function(t){return t.data()})))]):[3,2];case 1:return d=b.sent(),m.forEach((function(t){return t.dispose()})),[3,5];case 2:return[4,t.data()];case 3:return y=b.sent(),[4,e.data()];case 4:g=b.sent(),d=function(t,e,n,r,s,o,i,a,u,c){var l=i[0],f=i[1];void 0===c&&(c=5);for(var h=n.map((function(t){return new Uint8Array(r*s).fill(0)})),p=a.top,d=a.left,m=Eh([r,s],[l,f],a),y=m[0],g=m[1],b=Ih([l,f],o)[0],w=0;w<r;w+=1)for(var v=0;v<s;v+=1){var x=w*s+v;if(1===t[x]){var N=Oh({x:v,y:w},e,n,c,[p,d],[y,g],b,[r,s],o,u);N>=0&&(h[N][x]=1)}}return h}(y,g,i,r,s,o,[h,p],a,c),b.label=5;case 5:return[2,d.map((function(t,e){return{data:t,pose:i[e],width:s,height:r}}))]}}))}))}function Fh(t,e,n,r,s,o,i,a,u,c,l,f,h){var p=a[0],d=a[1];return void 0===c&&(c=.2),void 0===l&&(l=8),void 0===f&&(f=.3),void 0===h&&(h=10),ph(this,void 0,void 0,(function(){var a,m,y,g,b,w;return dh(this,(function(v){switch(v.label){case 0:return a=r.filter((function(t){return t.score>=c})),Rh()?(y=vs((function(){var r=Mh(t,e,a,s,o,i,[p,d],u,l,f,h),c=ws().makeTensorFromDataId(r.dataId,r.shape,r.dtype);return a.map((function(t,e){return function(t,e,n){return vs((function(){return ga(mo(Zr(Si(t,Bi(n)),"int32"),fo(e,1)),1)}))}(c,n,e)}))})),[4,Promise.all(y.map((function(t){return t.data()})))]):[3,2];case 1:return m=v.sent(),y.forEach((function(t){return t.dispose()})),[3,6];case 2:return[4,t.data()];case 3:return g=v.sent(),[4,e.data()];case 4:return b=v.sent(),[4,n.data()];case 5:w=v.sent(),m=function(t,e,n,r,s,o,i,a,u,c,l){var f=a[0],h=a[1];void 0===l&&(l=5);for(var p=r.map((function(t){return new Int32Array(s*o).fill(-1)})),d=u.top,m=u.left,y=Eh([s,o],[f,h],u),g=y[0],b=y[1],w=Ih([f,h],i)[0],v=0;v<s;v+=1)for(var x=0;x<o;x+=1){var N=v*o+x;if(1===t[N]){var $=Oh({x,y:v},e,r,l,[d,m],[g,b],w,[s,o],i,c);$>=0&&(p[$][N]=n[N])}}return p}(g,b,w,a,s,o,i,[p,d],u,l),v.label=6;case 6:return[2,m.map((function(t,e){return{pose:a[e],data:t,height:s,width:o}}))]}}))}))}function Lh(t){return Math.floor(t/2)}[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map((function(t){var e=t[0],n=t[1];return[$h[e],$h[n]]}));var Ph=function(){function t(t,e){this.priorityQueue=new Array(t),this.numberOfElements=-1,this.getElementValue=e}return t.prototype.enqueue=function(t){this.priorityQueue[++this.numberOfElements]=t,this.swim(this.numberOfElements)},t.prototype.dequeue=function(){var t=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,t},t.prototype.empty=function(){return-1===this.numberOfElements},t.prototype.size=function(){return this.numberOfElements+1},t.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},t.prototype.max=function(){return this.priorityQueue[0]},t.prototype.swim=function(t){for(;t>0&&this.less(Lh(t),t);)this.exchange(t,Lh(t)),t=Lh(t)},t.prototype.sink=function(t){for(;2*t<=this.numberOfElements;){var e=2*t;if(e<this.numberOfElements&&this.less(e,e+1)&&e++,!this.less(t,e))break;this.exchange(t,e),t=e}},t.prototype.getValueAt=function(t){return this.getElementValue(this.priorityQueue[t])},t.prototype.less=function(t,e){return this.getValueAt(t)<this.getValueAt(e)},t.prototype.exchange=function(t,e){var n=this.priorityQueue[t];this.priorityQueue[t]=this.priorityQueue[e],this.priorityQueue[e]=n},t}();function Bh(t,e,n,r,s,o){for(var i=o.shape,a=i[0],u=i[1],c=!0,l=Math.max(n-s,0),f=Math.min(n+s+1,a),h=l;h<f;++h){for(var p=Math.max(r-s,0),d=Math.min(r+s+1,u),m=p;m<d;++m)if(o.get(h,m,t)>e){c=!1;break}if(!c)break}return c}var Vh=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]].map((function(t){var e=t[0],n=t[1];return[$h[e],$h[n]]})),zh=Vh.map((function(t){return t[1]})),Wh=Vh.map((function(t){return t[0]}));function Uh(t,e,n,r){return{y:Th(Math.round(t.y/e),0,n-1),x:Th(Math.round(t.x/e),0,r-1)}}function jh(t,e,n,r,s,o,i,a){void 0===a&&(a=2);for(var u=r.shape,c=u[0],l=u[1],f=function(t,e,n){var r=n.shape[2]/2;return{y:n.get(e.y,e.x,t),x:n.get(e.y,e.x,r+t)}}(t,Uh(e.position,o,c,l),i),h=kh(e.position,f),p=0;p<a;p++){var d=Uh(h,o,c,l),m=Sh(d.y,d.x,n,s);h=kh({x:d.x*o,y:d.y*o},{x:m.x,y:m.y})}var y=Uh(h,o,c,l),g=r.get(y.y,y.x,n);return{position:h,part:xh[n],score:g}}function Gh(t,e,n,r,s,o){var i=e.shape[2],a=zh.length,u=new Array(i),c=t.part,l=t.score,f=_h(c,r,n);u[c.id]={score:l,part:xh[c.id],position:f};for(var h=a-1;h>=0;--h){var p=zh[h],d=Wh[h];u[p]&&!u[d]&&(u[d]=jh(h,u[p],d,e,n,r,o))}for(h=0;h<a;++h)p=Wh[h],d=zh[h],u[p]&&!u[d]&&(u[d]=jh(h,u[p],d,e,n,r,s));return u}function qh(t,e,n,r){var s=n.x,o=n.y;return t.some((function(t){var n=t.keypoints[r].position;return function(t,e,n,r){var s=n-t,o=r-e;return s*s+o*o}(o,s,n.y,n.x)<=e}))}function Hh(t,e,n){return n.reduce((function(n,r,s){var o=r.position,i=r.score;return qh(t,e,o,s)||(n+=i),n}),0)/n.length}function Kh(t,e,n,r,s,o,i,a){void 0===i&&(i=.5),void 0===a&&(a=20);for(var u=[],c=function(t,e,n){for(var r=n.shape,s=r[0],o=r[1],i=r[2],a=new Ph(s*o*i,(function(t){return t.score})),u=0;u<s;++u)for(var c=0;c<o;++c)for(var l=0;l<i;++l){var f=n.get(u,c,l);f<t||Bh(l,f,u,c,e,n)&&a.enqueue({score:f,part:{heatmapY:u,heatmapX:c,id:l}})}return a}(i,1,t),l=a*a;u.length<o&&!c.empty();){var f=c.dequeue();if(!qh(u,l,_h(f.part,s,e),f.part.id)){var h=Gh(f,t,e,s,n,r),p=Hh(u,l,h);u.push({keypoints:h,score:p})}}return u}var Xh,Jh=[-123.15,-115.9,-103.06],Yh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return fh(e,t),e.prototype.preprocessInput=function(t){return fo(t,Jh)},e.prototype.nameOutputResults=function(t){var e=t[0],n=t[1],r=t[2],s=t[3],o=t[4],i=t[5];return{offsets:o,segmentation:t[6],partHeatmaps:i,longOffsets:s,heatmap:r,displacementFwd:n,displacementBwd:e,partOffsets:t[7]}},e}(wh),Zh="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/resnet50/",Qh="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/mobilenet/";function tp(t){if("undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas||"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)return function(t){if("offsetHeight"in t&&0!==t.offsetHeight&&"offsetWidth"in t&&0!==t.offsetWidth)return[t.offsetHeight,t.offsetWidth];if(null!=t.height&&null!=t.width)return[t.height,t.width];throw new Error("HTMLImageElement must have height and width attributes set.")}(t);if("undefined"!=typeof ImageData&&t instanceof ImageData)return[t.height,t.width];if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)return function(t){return t.hasAttribute("height")&&t.hasAttribute("width")?[t.height,t.width]:[t.videoHeight,t.videoWidth]}(t);if(t instanceof Le)return[t.shape[0],t.shape[1]];throw new Error("error: Unknown input type: "+t+".")}function ep(t,e){return function(t,e){return(t-1)%e==0}(t,e)?t:Math.floor(t/e)*e+1}var np={low:"low",medium:"medium",high:"high",full:"full"},rp=((Xh={})[np.low]=.25,Xh[np.medium]=.5,Xh[np.high]=.75,Xh[np.full]=1,Xh);function sp(t,e,n){var r=n[0],s=n[1],o=function(t){if("string"==typeof t){var e=rp[t];return x("number"==typeof e,(function(){return"string value of inputResolution must be one of "+Object.values(np).join(",")+" but was "+t+"."})),e}return x("number"==typeof t&&t<=2&&t>=.1,(function(){return"inputResolution must be a string or number between 0.1 and 2, but was "+t})),t}(t);return[ep(r*o,e),ep(s*o,e)]}function op(t,e,n,r,s){var o=e[0],i=e[1],a=n[0],u=n[1],c=r[0],l=c[0],f=c[1],h=r[1],p=h[0],d=h[1];return void 0===s&&(s=!1),vs((function(){var e=_l.resizeBilinear(t,[a,u],!0);return s&&(e=Go(e)),function(t,e,n){var r=e[0],s=e[1],o=n[0],i=o[0],a=o[1],u=n[1],c=u[0],l=u[1];return vs((function(){var e=Hi(t);return Ku(_l.cropAndResize(e,[[i/(r+i+a-1),c/(s+c+l-1),(i+r-1)/(r+i+a-1),(c+s-1)/(s+c+l-1)]],[0],[r,s]),[0])}))}(e,[o,i],[[l,f],[p,d]])}))}function ip(t,e){var n=e[0],r=e[1],s=tp(t),o=s[0],i=s[1],a=r/n,u=[0,0,0,0],c=u[0],l=u[1],f=u[2],h=u[3];return i/o<a?(c=0,l=0,f=Math.round(.5*(a*o-i)),h=Math.round(.5*(a*o-i))):(c=Math.round(.5*(1/a*i-o)),l=Math.round(.5*(1/a*i-o)),f=0,h=0),{resized:vs((function(){var e=function(t){return t instanceof Le?t:Bs(t)}(t);return e=Ga(e,[[c,l],[f,h],[0,0]]),_l.resizeBilinear(e,[n,r])})),padding:{top:c,left:f,right:h,bottom:l}}}function ap(t){return ph(this,void 0,void 0,(function(){return dh(this,(function(e){return[2,Promise.all(t.map((function(t){return t.buffer()})))]}))}))}function up(t,e){return{score:t.score,keypoints:t.keypoints.map((function(t){var n=t.score,r=t.part,s=t.position;return{score:n,part:r,position:{x:e-1-s.x,y:s.y}}}))}}function cp(t,e,n,r,s){var o=e[0],i=e[1],a=n[0],u=n[1],c=function(t,e,n,r,s){return void 0===r&&(r=0),void 0===s&&(s=0),1===n&&1===e&&0===r&&0===s?t:t.map((function(t){return function(t,e,n,r,s){return void 0===r&&(r=0),void 0===s&&(s=0),{score:t.score,keypoints:t.keypoints.map((function(t){var o=t.score,i=t.part,a=t.position;return{score:o,part:i,position:{x:a.x*n+s,y:a.y*e+r}}}))}}(t,e,n,r,s)}))}(t,(o+r.top+r.bottom)/a,(i+r.left+r.right)/u,-r.top,-r.left);return s?function(t,e){return e<=0?t:t.map((function(t){return up(t,e)}))}(c,i):c}var lp={architecture:"MobileNetV1",outputStride:16,quantBytes:4,multiplier:.75},fp=["MobileNetV1","ResNet50"],hp={MobileNetV1:[8,16,32],ResNet50:[32,16]},pp={MobileNetV1:[.5,.75,1],ResNet50:[1]},dp=[1,2,4];var mp={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20},yp={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20,minKeypointScore:.3,refineSteps:10};function gp(t){var e=t.segmentationThreshold,n=t.maxDetections,r=t.scoreThreshold,s=t.nmsRadius;if(e<0||e>1)throw new Error("segmentationThreshold "+e+". Should be in range [0.0, 1.0]");if(n<=0)throw new Error("Invalid maxDetections "+n+". Should be > 0");if(r<0||r>1)throw new Error("Invalid scoreThreshold "+r+". Should be in range [0.0, 1.0]");if(s<=0)throw new Error("Invalid nmsRadius "+s+".")}function bp(t){var e=t.segmentationThreshold,n=t.maxDetections,r=t.scoreThreshold,s=t.nmsRadius,o=t.minKeypointScore,i=t.refineSteps;if(e<0||e>1)throw new Error("segmentationThreshold "+e+". Should be in range [0.0, 1.0]");if(n<=0)throw new Error("Invalid maxDetections "+n+". Should be > 0");if(r<0||r>1)throw new Error("Invalid scoreThreshold "+r+". Should be in range [0.0, 1.0]");if(s<=0)throw new Error("Invalid nmsRadius "+s+".");if(o<0||o>1)throw new Error("Invalid minKeypointScore "+o+".Should be in range [0.0, 1.0]");if(i<=0||i>20)throw new Error("Invalid refineSteps "+i+".Should be in range [1, 20]")}var wp=function(){function t(t){this.baseModel=t}return t.prototype.predictForPersonSegmentation=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd}},t.prototype.predictForPersonSegmentationAndPart=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,partHeatmapLogits:e.partHeatmaps,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd}},t.prototype.predictForMultiPersonInstanceSegmentationAndPart=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,longOffsets:e.longOffsets,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd,partHeatmaps:e.partHeatmaps}},t.prototype.segmentPersonActivation=function(t,e,n){var r=this;void 0===n&&(n=.5);var s=tp(t),o=s[0],i=s[1],a=sp(e,this.baseModel.outputStride,[o,i]),u=ip(t,a),c=u.resized,l=u.padding,f=vs((function(){var t=r.predictForPersonSegmentation(c),e=t.segmentLogits,s=t.heatmapScores,a=t.offsets,u=t.displacementFwd,f=t.displacementBwd,h=c.shape,p=h[0],d=h[1],m=op(e,[o,i],[p,d],[[l.top,l.bottom],[l.left,l.right]],true);return{segmentation:yh(Ku(m),n),heatmapScores:s,offsets:a,displacementFwd:u,displacementBwd:f}})),h=f.segmentation,p=f.heatmapScores,d=f.offsets,m=f.displacementFwd,y=f.displacementBwd;return c.dispose(),{segmentation:h,heatmapScores:p,offsets:d,displacementFwd:m,displacementBwd:y,padding:l,internalResolutionHeightAndWidth:a}},t.prototype.segmentPerson=function(t,e){return void 0===e&&(e=mp),ph(this,void 0,void 0,(function(){var n,r,s,o,i,a,u,c,l,f,h,p,d,m,y,g,b,w;return dh(this,(function(v){switch(v.label){case 0:return gp(e=hh(hh({},mp),e)),n=this.segmentPersonActivation(t,e.internalResolution,e.segmentationThreshold),r=n.segmentation,s=n.heatmapScores,o=n.offsets,i=n.displacementFwd,a=n.displacementBwd,u=n.padding,c=n.internalResolutionHeightAndWidth,l=r.shape,f=l[0],h=l[1],[4,r.data()];case 1:return p=v.sent(),r.dispose(),[4,ap([s,o,i,a])];case 2:return d=v.sent(),m=d[0],y=d[1],g=d[2],b=d[3],w=cp(w=Kh(m,y,g,b,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[f,h],c,u,false),s.dispose(),o.dispose(),i.dispose(),a.dispose(),[2,{height:f,width:h,data:p,allPoses:w}]}}))}))},t.prototype.segmentMultiPerson=function(t,e){return void 0===e&&(e=yp),ph(this,void 0,void 0,(function(){var n,r,s,o,i,a,u,c,l,f,h,p,d,m,y,g,b,w,v,x,N,$=this;return dh(this,(function(E){switch(E.label){case 0:return bp(e=hh(hh({},yp),e)),n=tp(t),r=n[0],s=n[1],o=sp(e.internalResolution,this.baseModel.outputStride,[r,s]),i=ip(t,o),a=i.resized,u=i.padding,c=vs((function(){var t,n=$.predictForMultiPersonInstanceSegmentationAndPart(a),i=n.segmentLogits,c=n.longOffsets,l=n.heatmapScores,f=n.offsets,h=n.displacementFwd,p=n.displacementBwd,d=op(i,[r,s],o,[[u.top,u.bottom],[u.left,u.right]],true);return t=c,{segmentation:yh(Ku(d),e.segmentationThreshold),longOffsets:t,heatmapScoresRaw:l,offsetsRaw:f,displacementFwdRaw:h,displacementBwdRaw:p}})),l=c.segmentation,f=c.longOffsets,h=c.heatmapScoresRaw,p=c.offsetsRaw,d=c.displacementFwdRaw,m=c.displacementBwdRaw,[4,ap([h,p,d,m])];case 1:return y=E.sent(),g=y[0],b=y[1],w=y[2],v=y[3],x=cp(x=Kh(g,b,w,v,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[r,s],o,u,false),[4,Dh(l,f,x,r,s,this.baseModel.outputStride,o,u,e.scoreThreshold,e.refineSteps,e.minKeypointScore,e.maxDetections)];case 2:return N=E.sent(),a.dispose(),l.dispose(),f.dispose(),h.dispose(),p.dispose(),d.dispose(),m.dispose(),[2,N]}}))}))},t.prototype.segmentPersonPartsActivation=function(t,e,n){var r=this;void 0===n&&(n=.5);var s=tp(t),o=s[0],i=s[1],a=sp(e,this.baseModel.outputStride,[o,i]),u=ip(t,a),c=u.resized,l=u.padding,f=vs((function(){var t=r.predictForPersonSegmentationAndPart(c),e=t.segmentLogits,s=t.partHeatmapLogits,a=t.heatmapScores,u=t.offsets,f=t.displacementFwd,h=t.displacementBwd,p=c.shape,d=p[0],m=p[1],y=op(e,[o,i],[d,m],[[l.top,l.bottom],[l.left,l.right]],true),g=op(s,[o,i],[d,m],[[l.top,l.bottom],[l.left,l.right]],true);return{partSegmentation:gh(yh(Ku(y),n),g),heatmapScores:a,offsets:u,displacementFwd:f,displacementBwd:h}})),h=f.partSegmentation,p=f.heatmapScores,d=f.offsets,m=f.displacementFwd,y=f.displacementBwd;return c.dispose(),{partSegmentation:h,heatmapScores:p,offsets:d,displacementFwd:m,displacementBwd:y,padding:l,internalResolutionHeightAndWidth:a}},t.prototype.segmentPersonParts=function(t,e){return void 0===e&&(e=mp),ph(this,void 0,void 0,(function(){var n,r,s,o,i,a,u,c,l,f,h,p,d,m,y,g,b,w;return dh(this,(function(v){switch(v.label){case 0:return gp(e=hh(hh({},mp),e)),n=this.segmentPersonPartsActivation(t,e.internalResolution,e.segmentationThreshold),r=n.partSegmentation,s=n.heatmapScores,o=n.offsets,i=n.displacementFwd,a=n.displacementBwd,u=n.padding,c=n.internalResolutionHeightAndWidth,l=r.shape,f=l[0],h=l[1],[4,r.data()];case 1:return p=v.sent(),r.dispose(),[4,ap([s,o,i,a])];case 2:return d=v.sent(),m=d[0],y=d[1],g=d[2],b=d[3],w=cp(w=Kh(m,y,g,b,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[f,h],c,u,false),s.dispose(),o.dispose(),i.dispose(),a.dispose(),[2,{height:f,width:h,data:p,allPoses:w}]}}))}))},t.prototype.segmentMultiPersonParts=function(t,e){return void 0===e&&(e=yp),ph(this,void 0,void 0,(function(){var n,r,s,o,i,a,u,c,l,f,h,p,d,m,y,g,b,w,v,x,N,$,E=this;return dh(this,(function(S){switch(S.label){case 0:return bp(e=hh(hh({},yp),e)),n=tp(t),r=n[0],s=n[1],o=sp(e.internalResolution,this.baseModel.outputStride,[r,s]),i=ip(t,o),a=i.resized,u=i.padding,c=vs((function(){var t=E.predictForMultiPersonInstanceSegmentationAndPart(a),n=t.segmentLogits,i=t.longOffsets,c=t.heatmapScores,l=t.offsets,f=t.displacementFwd,h=t.displacementBwd,p=t.partHeatmaps,d=op(n,[r,s],o,[[u.top,u.bottom],[u.left,u.right]],true),m=op(p,[r,s],o,[[u.top,u.bottom],[u.left,u.right]],true),y=i;return{segmentation:yh(Ku(d),e.segmentationThreshold),longOffsets:y,heatmapScoresRaw:c,offsetsRaw:l,displacementFwdRaw:f,displacementBwdRaw:h,partSegmentation:bh(m)}})),l=c.segmentation,f=c.longOffsets,h=c.heatmapScoresRaw,p=c.offsetsRaw,d=c.displacementFwdRaw,m=c.displacementBwdRaw,y=c.partSegmentation,[4,ap([h,p,d,m])];case 1:return g=S.sent(),b=g[0],w=g[1],v=g[2],x=g[3],N=cp(N=Kh(b,w,v,x,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[r,s],o,u,false),[4,Fh(l,f,y,N,r,s,this.baseModel.outputStride,o,u,e.scoreThreshold,e.refineSteps,e.minKeypointScore,e.maxDetections)];case 2:return $=S.sent(),a.dispose(),l.dispose(),f.dispose(),h.dispose(),p.dispose(),d.dispose(),m.dispose(),y.dispose(),[2,$]}}))}))},t.prototype.dispose=function(){this.baseModel.dispose()},t}();function vp(t){return ph(this,void 0,void 0,(function(){var e,n,r,s,o,i;return dh(this,(function(a){switch(a.label){case 0:if(e=t.outputStride,n=t.quantBytes,r=t.multiplier,null==Hl)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this\n        model.");return s=function(t,e,n){var r={1:"100",.75:"075",.5:"050"},s="model-stride"+t+".json";return 4===n?Qh+"float/"+r[e]+"/"+s:Qh+"quant"+n+"/"+r[e]+"/"+s}(e,r,n),[4,ch(t.modelUrl||s)];case 1:return o=a.sent(),i=new vh(o,e),[2,new wp(i)]}}))}))}function xp(t){return ph(this,void 0,void 0,(function(){var e,n,r,s,o;return dh(this,(function(i){switch(i.label){case 0:if(e=t.outputStride,n=t.quantBytes,null==Hl)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this\n        model.");return r=function(t,e){var n="model-stride"+t+".json";return 4===e?Zh+"float/"+n:Zh+"quant"+e+"/"+n}(e,n),[4,ch(t.modelUrl||r)];case 1:return s=i.sent(),o=new Yh(s,e),[2,new wp(o)]}}))}))}var Np={};function $p(t,e,n,r){var s=t.width,o=t.height,i=e.width,a=e.height;if(s!==i||o!==a)throw new Error("error: dimensions must match. "+n+" has dimensions "+s+"x"+o+", "+r+" has dimensions "+i+"x"+a)}function Ep(t){var e=t.getContext("2d");e.scale(-1,1),e.translate(-t.width,0)}function Sp(t,e,n){t.globalCompositeOperation=n,t.drawImage(e,0,0)}function _p(t){return Np[t]||(Np[t]=function(){if("undefined"!=typeof document)return document.createElement("canvas");if("undefined"!=typeof OffscreenCanvas)return new OffscreenCanvas(0,0);throw new Error("Cannot create a canvas in this context")}()),Np[t]}function Tp(t,e,n){var r=t.height,s=t.width,o=n.getContext("2d");n.width=s,n.height=r,o.clearRect(0,0,s,r),o.save(),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?function(t,e,n){for(var r=t.getContext("2d"),s=0,o=1/(2*Math.PI*5*5),i=n<3?1:2,a=-n;a<=n;a+=i)for(var u=-n;u<=n;u+=i)s+=o*Math.exp(-(u*u+a*a)/50);for(a=-n;a<=n;a+=i)for(u=-n;u<=n;u+=i)r.globalAlpha=o*Math.exp(-(u*u+a*a)/50)/s*n,r.drawImage(e,u,a);r.globalAlpha=1}(n,t,e):(o.filter="blur("+e+"px)",o.drawImage(t,0,0,s,r)),o.restore()}function kp(t,e,n){var r=_p(n);return 0===e?function(t,e){var n=t.width,r=t.height;e.width=n,e.height=r,e.getContext("2d").drawImage(t,0,0,n,r)}(t,r):Tp(t,e,r),r}function Ap(t,e){var n=_p(e);return function(t,e){e.width=t.width,e.height=t.height,e.getContext("2d").putImageData(t,0,0)}(t,n),n}function Cp(t,e,n,r,s){if(void 0===e&&(e={r:0,g:0,b:0,a:0}),void 0===n&&(n={r:0,g:0,b:0,a:255}),void 0===r&&(r=!1),void 0===s&&(s=[1]),Array.isArray(t)&&0===t.length)return null;var o,i=(o=Array.isArray(t)?t:[t])[0],a=i.width,u=i.height,c=new Uint8ClampedArray(a*u*4);function l(t,e,n,r,s,o){void 0===o&&(o={r:0,g:255,b:255,a:255});for(var i=-s;i<=s;i++)for(var a=-s;a<=s;a++)if(0!==i&&0!==a){var u=(e+i)*r+(n+a);t[4*u+0]=o.r,t[4*u+1]=o.g,t[4*u+2]=o.b,t[4*u+3]=o.a}}function f(t,e,n,r,s,o){void 0===s&&(s=[1]),void 0===o&&(o=1);for(var i=0,a=-o;a<=o;a++)for(var u=function(o){if(0!==a&&0!==o){var u=(e+a)*r+(n+o);s.some((function(e){return e===t[u]}))||(i+=1)}},c=-o;c<=o;c++)u(c);return i>0}for(var h=0;h<u;h+=1)for(var p=function(t){var i=h*a+t;c[4*i+0]=n.r,c[4*i+1]=n.g,c[4*i+2]=n.b,c[4*i+3]=n.a;for(var p=function(n){if(s.some((function(t){return t===o[n].data[i]}))){c[4*i]=e.r,c[4*i+1]=e.g,c[4*i+2]=e.b,c[4*i+3]=e.a;var p=f(o[n].data,h,t,a,s);r&&h-1>=0&&h+1<u&&t-1>=0&&t+1<a&&p&&l(c,h,t,a,1)}},d=0;d<o.length;d++)p(d)},d=0;d<a;d+=1)p(d);return new ImageData(c,a,u)}var Op=[[110,64,170],[143,61,178],[178,60,178],[210,62,167],[238,67,149],[255,78,125],[255,94,99],[255,115,75],[255,140,56],[239,167,47],[217,194,49],[194,219,64],[175,240,91],[135,245,87],[96,247,96],[64,243,115],[40,234,141],[28,219,169],[26,199,194],[33,176,213],[47,150,224],[65,125,224],[84,101,214],[99,81,195]];var Ip="blurred",Mp="blurred-mask",Rp="mask",Dp="lowres-part-mask";var Fp=Object.freeze({__proto__:null,BodyPix:wp,load:function(t){return void 0===t&&(t=lp),ph(this,void 0,void 0,(function(){return dh(this,(function(e){return"ResNet50"===(t=function(t){if(null==(t=t||lp).architecture&&(t.architecture="MobileNetV1"),fp.indexOf(t.architecture)<0)throw new Error("Invalid architecture "+t.architecture+". Should be one of "+fp);if(null==t.outputStride&&(t.outputStride=16),hp[t.architecture].indexOf(t.outputStride)<0)throw new Error("Invalid outputStride "+t.outputStride+". Should be one of "+hp[t.architecture]+" for architecture "+t.architecture+".");if(null==t.multiplier&&(t.multiplier=1),pp[t.architecture].indexOf(t.multiplier)<0)throw new Error("Invalid multiplier "+t.multiplier+". Should be one of "+pp[t.architecture]+" for architecture "+t.architecture+".");if(null==t.quantBytes&&(t.quantBytes=4),dp.indexOf(t.quantBytes)<0)throw new Error("Invalid quantBytes "+t.quantBytes+". Should be one of "+dp+" for architecture "+t.architecture+".");return t}(t)).architecture?[2,xp(t)]:"MobileNetV1"===t.architecture?[2,vp(t)]:[2,null]}))}))},blurBodyPart:function(t,e,n,r,s,o,i){void 0===r&&(r=[0,1]),void 0===s&&(s=3),void 0===o&&(o=3),void 0===i&&(i=!1);var a=kp(e,s,Ip);t.width=a.width,t.height=a.height;var u=t.getContext("2d");if(Array.isArray(n)&&0===n.length)u.drawImage(a,0,0);else{var c=function(t,e,n){var r=Ap(Cp(t,{r:0,g:0,b:0,a:0},{r:0,g:0,b:0,a:255},!0,e),Rp);return 0===n?r:kp(r,n,Mp)}(n,r,o);u.save(),i&&Ep(t);var l=tp(e),f=l[0],h=l[1];u.drawImage(e,0,0,h,f),Sp(u,c,"destination-in"),Sp(u,a,"destination-over"),u.restore()}},drawBokehEffect:function(t,e,n,r,s,o){void 0===r&&(r=3),void 0===s&&(s=3),void 0===o&&(o=!1);var i=kp(e,r,Ip);t.width=i.width,t.height=i.height;var a=t.getContext("2d");if(Array.isArray(n)&&0===n.length)a.drawImage(i,0,0);else{var u=function(t,e){var n=Ap(Cp(t,{r:0,g:0,b:0,a:255},{r:0,g:0,b:0,a:0}),Rp);return 0===e?n:kp(n,e,Mp)}(n,s);a.save(),o&&Ep(t);var c=tp(e),l=c[0],f=c[1];a.drawImage(e,0,0,f,l),Sp(a,u,"destination-in"),Sp(a,i,"destination-over"),a.restore()}},drawMask:function(t,e,n,r,s,o){void 0===r&&(r=.7),void 0===s&&(s=0),void 0===o&&(o=!1);var i=tp(e),a=i[0],u=i[1];t.width=u,t.height=a;var c=t.getContext("2d");if(c.save(),o&&Ep(t),c.drawImage(e,0,0),c.globalAlpha=r,n){$p({width:u,height:a},n,"image","mask");var l=kp(Ap(n,Rp),s,Mp);c.drawImage(l,0,0,u,a)}c.restore()},drawPixelatedMask:function(t,e,n,r,s,o,i){void 0===r&&(r=.7),void 0===s&&(s=0),void 0===o&&(o=!1),void 0===i&&(i=10);var a=tp(e),u=a[0];$p({width:a[1],height:u},n,"image","mask");var c=kp(Ap(n,Rp),s,Mp);t.width=c.width,t.height=c.height;var l=t.getContext("2d");l.save(),o&&Ep(t);var f=_p(Dp),h=f.getContext("2d");f.width=c.width*(1/i),f.height=c.height*(1/i),h.drawImage(c,0,0,c.width,c.height,0,0,f.width,f.height),l.imageSmoothingEnabled=!1,l.drawImage(f,0,0,f.width,f.height,0,0,t.width,t.height);for(var p=0;p<f.width;p++)l.beginPath(),l.strokeStyle="#ffffff",l.moveTo(i*p,0),l.lineTo(i*p,t.height),l.stroke();for(p=0;p<f.height;p++)l.beginPath(),l.strokeStyle="#ffffff",l.moveTo(0,i*p),l.lineTo(t.width,i*p),l.stroke();l.globalAlpha=1-r,l.drawImage(e,0,0,c.width,c.height),l.restore()},toColoredPartMask:function(t,e){if(void 0===e&&(e=Op),Array.isArray(t)&&0===t.length)return null;for(var n,r=(n=Array.isArray(t)?t:[t])[0],s=r.width,o=r.height,i=new Uint8ClampedArray(s*o*4),a=0;a<o*s;++a){var u=4*a;i[u+0]=255,i[u+1]=255,i[u+2]=255,i[u+3]=255;for(var c=0;c<n.length;c++){var l=n[c].data[a];if(-1!==l){var f=e[l];if(!f)throw new Error("No color could be found for part id "+l);i[u+0]=f[0],i[u+1]=f[1],i[u+2]=f[2],i[u+3]=255}}}return new ImageData(i,s,o)},toMask:Cp,PART_CHANNELS:["left_face","right_face","left_upper_arm_front","left_upper_arm_back","right_upper_arm_front","right_upper_arm_back","left_lower_arm_front","left_lower_arm_back","right_lower_arm_front","right_lower_arm_back","left_hand","right_hand","torso_front","torso_back","left_upper_leg_front","left_upper_leg_back","right_upper_leg_front","right_upper_leg_back","left_lower_leg_front","left_lower_leg_back","right_lower_leg_front","right_lower_leg_back","left_feet","right_feet"],flipPoseHorizontal:up,resizeAndPadTo:function(t,e,n){var r=e[0],s=e[1];void 0===n&&(n=!1);var o,i,a,u,c,l,f=t.shape,h=f[0],p=f[1]/h;if(p>s/r){o=s;var d=r-(i=Math.ceil(o/p));a=0,u=0,c=Math.floor(d/2),l=r-(i+c)}else{i=r;var m=s-(o=Math.ceil(r*p));a=Math.floor(m/2),u=s-(o+a),c=0,l=0}return{resizedAndPadded:vs((function(){var e;return e=n?_l.resizeBilinear(Eu(t,1),[i,o]):_l.resizeBilinear(t,[i,o]),Ga(e,[[c,l],[a,u],[0,0]])})),paddedBy:[[c,l],[a,u]]}},scaleAndCropToInputTensorShape:op,version:"2.2.0"});function Lp(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(n){if("default"!==n&&!(n in t)){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}))})),Object.freeze(t)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pp{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class Bp{refCount(t){return Vp("refCount")}incRef(t){return Vp("incRef")}timerAvailable(){return!0}time(t){return Vp("time")}read(t){return Vp("read")}readSync(t){return Vp("readSync")}readToGPU(t,e){return Vp("readToGPU")}numDataIds(){return Vp("numDataIds")}disposeData(t,e){return Vp("disposeData")}write(t,e,n){return Vp("write")}move(t,e,n,r,s){return Vp("move")}memory(){return Vp("memory")}floatPrecision(){return Vp("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return Vp("dispose")}}function Vp(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function zp(t,e,n){return Math.max(t,Math.min(e,n))}function Wp(t){return t%2==0?t:t+1}function Up(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function jp(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function Gp(t,e,n=""){jp(Xp(t,e),(()=>n+` Shapes ${t} and ${e} must match`))}function qp(t){jp(null!=t,(()=>"The input to the tensor constructor must be a non-null value."))}function Hp(t,e=[],n=!1){if(null==e&&(e=[]),Array.isArray(t)||sd(t)&&!n)for(let r=0;r<t.length;++r)Hp(t[r],e,n);else e.push(t);return e}function Kp(t){if(0===t.length)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function Xp(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Jp(t){return t%1==0}function Yp(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function Zp(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function Qp(t,e=(t=>0),n){return new Promise(((r,s)=>{let o=0;const i=()=>{if(t())return void r();o++;const a=e(o);null!=n&&o>=n?s():setTimeout(i,a)};i()}))}function td(t,e){const n=e.length;return t=null==t?e.map(((t,e)=>e)):[].concat(t),jp(t.every((t=>t>=-n&&t<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`)),jp(t.every((t=>Jp(t))),(()=>`All values in axis param must be integers but got axis ${t}`)),t.map((t=>t<0?n+t:t))}function ed(t,e){const n=[],r=[],s=null!=e&&Array.isArray(e)&&0===e.length,o=null==e||s?null:td(e,t).sort();let i=0;for(let e=0;e<t.length;++e){if(null!=o){if(o[i]===e&&1!==t[e])throw new Error(`Can't squeeze axis ${e} since its dim '${t[e]}' is not 1`);(null==o[i]||o[i]>e)&&1===t[e]&&(n.push(t[e]),r.push(e)),o[i]<=e&&i++}1!==t[e]&&(n.push(t[e]),r.push(e))}return{newShape:n,keptDims:r}}function nd(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error(`Unknown data type ${t}`);n=new Uint8Array(e)}return n}function rd(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error(`Unknown data type ${t}`);n=new Array(e)}return n}function sd(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function od(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error(`Unknown dtype ${t}`)}function id(t){return"string"==typeof t||t instanceof String}function ad(t){return Array.isArray(t)?ad(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":"number"==typeof t?"float32":id(t)?"string":function(t){return"boolean"==typeof t}(t)?"bool":"float32"}function ud(t){return!!(t&&t.constructor&&t.call&&t.apply)}function cd(t,e){for(let n=e;n<t;++n)if(t%n==0)return n;return t}function ld(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function fd(t,e,n,r=!1){const s=new Array;if(1===e.length){const o=e[0]*(r?2:1);for(let e=0;e<o;e++)s[e]=n[t+e]}else{const o=e[0],i=e.slice(1),a=i.reduce(((t,e)=>t*e))*(r?2:1);for(let e=0;e<o;e++)s[e]=fd(t+e*a,i,n,r)}return s}function hd(t,e,n=!1){if(0===t.length)return e[0];const r=t.reduce(((t,e)=>t*e))*(n?2:1);if(0===r)return[];if(r!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return fd(0,t,e,n)}function pd(t,e){const n=dd(t,e);for(let t=0;t<n.length;t++)n[t]=1;return n}function dd(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function md(t){t.forEach((e=>{jp(Number.isInteger(e)&&e>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`))}))}function yd(t,e,n){if(0===e)return 0;if(1===e)return t[0];let r=t[t.length-1];for(let e=0;e<t.length-1;++e)r+=n[e]*t[e];return r}function gd(t,e,n){if(0===e)return[];if(1===e)return[t];const r=new Array(e);for(let e=0;e<r.length-1;++e)r[e]=Math.floor(t/n[e]),t-=r[e]*n[e];return r[r.length-1]=t,r}function bd(t){return t&&t.then&&"function"==typeof t.then}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wd{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=vd,this.populateURLFlags()}setPlatform(t,e){null!=this.platform&&(xd().getBool("IS_TEST")||xd().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=e}registerFlag(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){const e=this.urlFlags[t];xd().getBool("IS_TEST")||xd().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${e}.`),this.set(t,e)}}async getAsync(t){return t in this.flags||(this.flags[t]=await this.evaluateFlag(t)),this.flags[t]}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(bd(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(null==this.flagRegistry[t])throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(null==this.flagRegistry[t])throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const t=this.getQueryParams(this.global.location.search);if("tfjsflags"in t){t.tfjsflags.split(",").forEach((t=>{const[e,n]=t.split(":");this.urlFlags[e]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}(e,n)}))}}}function vd(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((t,...n)=>(function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")))),e}function xd(){return Nd}let Nd=null;var $d="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function Ed(){throw new Error("setTimeout has not been defined")}function Sd(){throw new Error("clearTimeout has not been defined")}var _d=Ed,Td=Sd;function kd(t){if(_d===setTimeout)return setTimeout(t,0);if((_d===Ed||!_d)&&setTimeout)return _d=setTimeout,setTimeout(t,0);try{return _d(t,0)}catch(e){try{return _d.call(null,t,0)}catch(e){return _d.call(this,t,0)}}}"function"==typeof $d.setTimeout&&(_d=setTimeout),"function"==typeof $d.clearTimeout&&(Td=clearTimeout);var Ad,Cd=[],Od=!1,Id=-1;function Md(){Od&&Ad&&(Od=!1,Ad.length?Cd=Ad.concat(Cd):Id=-1,Cd.length&&Rd())}function Rd(){if(!Od){var t=kd(Md);Od=!0;for(var e=Cd.length;e;){for(Ad=Cd,Cd=[];++Id<e;)Ad&&Ad[Id].run();Id=-1,e=Cd.length}Ad=null,Od=!1,function(t){if(Td===clearTimeout)return clearTimeout(t);if((Td===Sd||!Td)&&clearTimeout)return Td=clearTimeout,clearTimeout(t);try{Td(t)}catch(e){try{return Td.call(null,t)}catch(e){return Td.call(this,t)}}}(t)}}function Dd(t,e){this.fun=t,this.array=e}Dd.prototype.run=function(){this.fun.apply(null,this.array)};function Fd(){}var Ld=Fd,Pd=Fd,Bd=Fd,Vd=Fd,zd=Fd,Wd=Fd,Ud=Fd;var jd=$d.performance||{},Gd=jd.now||jd.mozNow||jd.msNow||jd.oNow||jd.webkitNow||function(){return(new Date).getTime()};var qd=new Date;var Hd={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];Cd.push(new Dd(t,e)),1!==Cd.length||Od||kd(Rd)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:Ld,addListener:Pd,once:Bd,off:Vd,removeListener:zd,removeAllListeners:Wd,emit:Ud,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*Gd.call(jd),n=Math.floor(e),r=Math.floor(e%1*1e9);return t&&(n-=t[0],(r-=t[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-qd)/1e3}},Kd=Hd;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
let Xd;function Jd(){if(null==Xd){let t;if("undefined"!=typeof window)t=window;else if(void 0!==$d)t=$d;else if(void 0!==Kd)t=Kd;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}Xd=t}return Xd}function Yd(t,e){const n=function(){const t=Jd();return null==t._tfGlobals&&(t._tfGlobals=new Map),t._tfGlobals}();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Zd(...t){xd().getBool("IS_TEST")||xd().getBool("PROD")||console.warn(...t)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Qd=Yd("kernelRegistry",(()=>new Map)),tm=Yd("gradRegistry",(()=>new Map));function em(t,e){const n=om(t,e);return Qd.get(n)}function nm(t){return tm.get(t)}function rm(t){const e=Qd.entries(),n=[];for(;;){const{done:r,value:s}=e.next();if(r)break;const[o,i]=s,[a]=o.split("_");a===t&&n.push(i)}return n}function sm(t){const{kernelName:e,backendName:n}=t,r=om(e,n);Qd.has(r)&&Zd(`The kernel '${e}' for backend '${n}' is already registered`),Qd.set(r,t)}function om(t,e){return`${e}_${t}`}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function im(t){if(t.q)return t;var e=Object.defineProperty({},"q",{value:!0});return Object.keys(t).forEach((function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})})),e}var am=cm,um=null;try{um=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(Yot){}function cm(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function lm(t){return!0===(t&&t._)}cm.prototype._,Object.defineProperty(cm.prototype,"_",{value:!0}),cm.isLong=lm;var fm={},hm={};function pm(t,e){var n,r,s;return e?(s=0<=(t>>>=0)&&t<256)&&(r=hm[t])?r:(n=mm(t,(0|t)<0?-1:0,!0),s&&(hm[t]=n),n):(s=-128<=(t|=0)&&t<128)&&(r=fm[t])?r:(n=mm(t,t<0?-1:0,!1),s&&(fm[t]=n),n)}function dm(t,e){if(isNaN(t))return e?Em:$m;if(e){if(t<0)return Em;if(t>=vm)return Am}else{if(t<=-xm)return Cm;if(t+1>=xm)return km}return t<0?dm(-t,e).neg():mm(t%wm|0,t/wm|0,e)}function mm(t,e,n){return new cm(t,e,n)}cm.fromInt=pm,cm.fromNumber=dm,cm.fromBits=mm;var ym=Math.pow;function gm(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return $m;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return gm(t.substring(1),e,n).neg();for(var s=dm(ym(n,8)),o=$m,i=0;i<t.length;i+=8){var a=Math.min(8,t.length-i),u=parseInt(t.substring(i,i+a),n);if(a<8){var c=dm(ym(n,a));o=o.mul(c).add(dm(u))}else o=(o=o.mul(s)).add(dm(u))}return o.unsigned=e,o}function bm(t,e){return"number"==typeof t?dm(t,e):"string"==typeof t?gm(t,e):mm(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}cm.fromString=gm,cm.fromValue=bm;var wm=4294967296,vm=wm*wm,xm=vm/2,Nm=pm(1<<24),$m=pm(0);cm.ZERO=$m;var Em=pm(0,!0);cm.UZERO=Em;var Sm=pm(1);cm.ONE=Sm;var _m=pm(1,!0);cm.UONE=_m;var Tm=pm(-1);cm.NEG_ONE=Tm;var km=mm(-1,2147483647,!1);cm.MAX_VALUE=km;var Am=mm(-1,-1,!0);cm.MAX_UNSIGNED_VALUE=Am;var Cm=mm(0,-2147483648,!1);cm.MIN_VALUE=Cm;var Om=cm.prototype;Om.toInt=function(){return this.unsigned?this.low>>>0:this.low},Om.toNumber=function(){return this.unsigned?(this.high>>>0)*wm+(this.low>>>0):this.high*wm+(this.low>>>0)},Om.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Cm)){var e=dm(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var s=dm(ym(t,6),this.unsigned),o=this,i="";;){var a=o.div(s),u=(o.sub(a.mul(s)).toInt()>>>0).toString(t);if((o=a).isZero())return u+i;for(;u.length<6;)u="0"+u;i=""+u+i}},Om.getHighBits=function(){return this.high},Om.getHighBitsUnsigned=function(){return this.high>>>0},Om.getLowBits=function(){return this.low},Om.getLowBitsUnsigned=function(){return this.low>>>0},Om.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Cm)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},Om.isZero=function(){return 0===this.high&&0===this.low},Om.eqz=Om.isZero,Om.isNegative=function(){return!this.unsigned&&this.high<0},Om.isPositive=function(){return this.unsigned||this.high>=0},Om.isOdd=function(){return 1==(1&this.low)},Om.isEven=function(){return 0==(1&this.low)},Om.equals=function(t){return lm(t)||(t=bm(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},Om.eq=Om.equals,Om.notEquals=function(t){return!this.eq(t)},Om.neq=Om.notEquals,Om.ne=Om.notEquals,Om.lessThan=function(t){return this.comp(t)<0},Om.lt=Om.lessThan,Om.lessThanOrEqual=function(t){return this.comp(t)<=0},Om.lte=Om.lessThanOrEqual,Om.le=Om.lessThanOrEqual,Om.greaterThan=function(t){return this.comp(t)>0},Om.gt=Om.greaterThan,Om.greaterThanOrEqual=function(t){return this.comp(t)>=0},Om.gte=Om.greaterThanOrEqual,Om.ge=Om.greaterThanOrEqual,Om.compare=function(t){if(lm(t)||(t=bm(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},Om.comp=Om.compare,Om.negate=function(){return!this.unsigned&&this.eq(Cm)?Cm:this.not().add(Sm)},Om.neg=Om.negate,Om.add=function(t){lm(t)||(t=bm(t));var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,o=t.high>>>16,i=65535&t.high,a=t.low>>>16,u=0,c=0,l=0,f=0;return l+=(f+=s+(65535&t.low))>>>16,c+=(l+=r+a)>>>16,u+=(c+=n+i)>>>16,u+=e+o,mm((l&=65535)<<16|(f&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},Om.subtract=function(t){return lm(t)||(t=bm(t)),this.add(t.neg())},Om.sub=Om.subtract,Om.multiply=function(t){if(this.isZero())return $m;if(lm(t)||(t=bm(t)),um)return mm(um.mul(this.low,this.high,t.low,t.high),um.get_high(),this.unsigned);if(t.isZero())return $m;if(this.eq(Cm))return t.isOdd()?Cm:$m;if(t.eq(Cm))return this.isOdd()?Cm:$m;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(Nm)&&t.lt(Nm))return dm(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,o=t.high>>>16,i=65535&t.high,a=t.low>>>16,u=65535&t.low,c=0,l=0,f=0,h=0;return f+=(h+=s*u)>>>16,l+=(f+=r*u)>>>16,f&=65535,l+=(f+=s*a)>>>16,c+=(l+=n*u)>>>16,l&=65535,c+=(l+=r*a)>>>16,l&=65535,c+=(l+=s*i)>>>16,c+=e*u+n*a+r*i+s*o,mm((f&=65535)<<16|(h&=65535),(c&=65535)<<16|(l&=65535),this.unsigned)},Om.mul=Om.multiply,Om.divide=function(t){if(lm(t)||(t=bm(t)),t.isZero())throw Error("division by zero");var e,n,r;if(um)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?mm((this.unsigned?um.div_u:um.div_s)(this.low,this.high,t.low,t.high),um.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Em:$m;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Em;if(t.gt(this.shru(1)))return _m;r=Em}else{if(this.eq(Cm))return t.eq(Sm)||t.eq(Tm)?Cm:t.eq(Cm)?Sm:(e=this.shr(1).div(t).shl(1)).eq($m)?t.isNegative()?Sm:Tm:(n=this.sub(t.mul(e)),r=e.add(n.div(t)));if(t.eq(Cm))return this.unsigned?Em:$m;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=$m}for(n=this;n.gte(t);){e=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(e)/Math.LN2),o=s<=48?1:ym(2,s-48),i=dm(e),a=i.mul(t);a.isNegative()||a.gt(n);)a=(i=dm(e-=o,this.unsigned)).mul(t);i.isZero()&&(i=Sm),r=r.add(i),n=n.sub(a)}return r},Om.div=Om.divide,Om.modulo=function(t){return lm(t)||(t=bm(t)),um?mm((this.unsigned?um.rem_u:um.rem_s)(this.low,this.high,t.low,t.high),um.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},Om.mod=Om.modulo,Om.rem=Om.modulo,Om.not=function(){return mm(~this.low,~this.high,this.unsigned)},Om.and=function(t){return lm(t)||(t=bm(t)),mm(this.low&t.low,this.high&t.high,this.unsigned)},Om.or=function(t){return lm(t)||(t=bm(t)),mm(this.low|t.low,this.high|t.high,this.unsigned)},Om.xor=function(t){return lm(t)||(t=bm(t)),mm(this.low^t.low,this.high^t.high,this.unsigned)},Om.shiftLeft=function(t){return lm(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?mm(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):mm(0,this.low<<t-32,this.unsigned)},Om.shl=Om.shiftLeft,Om.shiftRight=function(t){return lm(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?mm(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):mm(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},Om.shr=Om.shiftRight,Om.shiftRightUnsigned=function(t){if(lm(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?mm(this.low>>>t|e<<32-t,e>>>t,this.unsigned):mm(32===t?e:e>>>t-32,0,this.unsigned)},Om.shru=Om.shiftRightUnsigned,Om.shr_u=Om.shiftRightUnsigned,Om.toSigned=function(){return this.unsigned?mm(this.low,this.high,!1):this},Om.toUnsigned=function(){return this.unsigned?this:mm(this.low,this.high,!0)},Om.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},Om.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},Om.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},cm.fromBytes=function(t,e,n){return n?cm.fromBytesLE(t,e):cm.fromBytesBE(t,e)},cm.fromBytesLE=function(t,e){return new cm(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},cm.fromBytesBE=function(t,e){return new cm(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Im=am||Lp({__proto__:null,default:am},[am]);function Mm(t){return Im.fromString(t,!0,16)}const Rm=Mm("c3a5c85c97cb3127"),Dm=Mm("b492b66fbe98f273"),Fm=Mm("9ae16a3b2f90404f");function Lm(t){return t.xor(t.shru(47))}function Pm(t,e,n){const r=t.slice(e,e+n);return Im.fromBytes(Array.from(r),!0,!0)}function Bm(t,e){return Pm(t,e,8)}function Vm(t,e){return Pm(t,e,4)}function zm(t,e){return 0===e?t:t.shru(e).or(t.shl(64-e))}function Wm(t,e,n=Mm("9ddfea08eb382d69")){let r=t.xor(e).mul(n);r=r.xor(r.shru(47));let s=e.xor(r).mul(n);return s=s.xor(s.shru(47)),s=s.mul(n),s}function Um(t,e,n,r){return function(t,e,n,r,s,o){s=s.add(t),o=zm(o.add(s).add(r),21);const i=s;return s=(s=s.add(e)).add(n),o=o.add(zm(s,44)),[s.add(r),o.add(i)]}(Bm(t,e),Bm(t,e+8),Bm(t,e+16),Bm(t,e+24),n,r)}function jm(t,e=t.length){const n=Im.fromNumber(81,!0);if(e<=32)return e<=16?function(t,e=t.length){if(e>=8){const n=Fm.add(2*e),r=Bm(t,0).add(Fm),s=Bm(t,e-8);return Wm(zm(s,37).mul(n).add(r),zm(r,25).add(s).mul(n),n)}if(e>=4){const n=Fm.add(2*e);return Wm(Vm(t,0).shl(3).add(e),Vm(t,e-4),n)}if(e>0){const n=t[0]+(t[e>>1]<<8),r=e+(t[e-1]<<2);return Lm(Fm.mul(n).xor(Rm.mul(r))).mul(Fm)}return Fm}(t,e):function(t,e=t.length){const n=Fm.add(2*e),r=Bm(t,0).mul(Dm),s=Bm(t,8),o=Bm(t,e-8).mul(n),i=Bm(t,e-16).mul(Fm);return Wm(zm(r.add(s),43).add(zm(o,30)).add(i),r.add(zm(s.add(Fm),18)).add(o),n)}(t,e);if(e<=64)return function(t,e=t.length){const n=Fm.add(2*e),r=Bm(t,0).mul(Fm),s=Bm(t,8),o=Bm(t,e-8).mul(n),i=Bm(t,e-16).mul(Fm),a=zm(r.add(s),43).add(zm(o,30)).add(i),u=Wm(a,r.add(zm(s.add(Fm),18)).add(o),n),c=Bm(t,16).mul(n),l=Bm(t,24),f=a.add(Bm(t,e-32)).mul(n),h=u.add(Bm(t,e-24)).mul(n);return Wm(zm(c.add(l),43).add(zm(f,30)).add(h),c.add(zm(l.add(r),18)).add(f),n)}(t,e);let r=n,s=n.mul(Dm).add(113),o=Lm(s.mul(Fm).add(113)).mul(Fm),i=[Im.UZERO,Im.UZERO],a=[Im.UZERO,Im.UZERO];r=r.mul(Fm).add(Bm(t,0));let u=0;const c=64*(e-1>>6),l=c+(e-1&63)-63;do{r=zm(r.add(s).add(i[0]).add(Bm(t,u+8)),37).mul(Dm),s=zm(s.add(i[1]).add(Bm(t,u+48)),42).mul(Dm),r=r.xor(a[1]),s=s.add(i[0]).add(Bm(t,u+40)),o=zm(o.add(a[0]),33).mul(Dm),i=Um(t,u,i[1].mul(Dm),r.add(a[0])),a=Um(t,u+32,o.add(a[1]),s.add(Bm(t,u+16))),[o,r]=[r,o],u+=64}while(u!==c);const f=Dm.add(o.and(255).shl(1));return u=l,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),r=zm(r.add(s).add(i[0]).add(Bm(t,u+8)),37).mul(f),s=zm(s.add(i[1]).add(Bm(t,u+48)),42).mul(f),r=r.xor(a[1].mul(9)),s=s.add(i[0].mul(9).add(Bm(t,u+40))),o=zm(o.add(a[0]),33).mul(f),i=Um(t,u,i[1].mul(f),r.add(a[0])),a=Um(t,u+32,o.add(a[1]),s.add(Bm(t,u+16))),[o,r]=[r,o],Wm(Wm(i[0],a[0],f).add(Lm(s).mul(Rm)).add(o),Wm(i[1],a[1],f).add(r),f)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gm(t,e){return"string"===e?Km(t):qm([t],e)}function qm(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Hp(t)),xd().getBool("DEBUG")&&function(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){const e=new Uint8Array(t.length);for(let n=0;n<e.length;++n)0!==Math.round(t[n])&&(e[n]=1);return e}throw new Error(`Unknown data type ${e}`)}function Hm(){return xd().platform.now()}function Km(t,e="utf-8"){return e=e||"utf-8",xd().platform.encode(t,e)}function Xm(t,e="utf-8"){return e=e||"utf-8",xd().platform.decode(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jm{constructor(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new Zm)}profileKernel(t,e,n){let r;const s=()=>{r=n()};let o;const i=Hm();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(s);else{s();for(const t of r)t.dataSync();o=Promise.resolve({kernelMs:Hm()-i})}if(xd().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let e=0;e<r.length;e++){const n=r[e];n.data().then((e=>{Ym(e,n.dtype,t)}))}return{kernelName:t,outputs:r,inputs:e,timeMs:o.then((t=>t.kernelMs)),extraInfo:o.then((t=>null!=t.getExtraProfileInfo?t.getExtraProfileInfo():""))}}logKernelProfile(t){const{kernelName:e,outputs:n,timeMs:r,inputs:s,extraInfo:o}=t;n.forEach((t=>{Promise.all([t.data(),r,o]).then((n=>{this.logger.logKernelProfile(e,t,n[0],n[1],s,n[2])}))}))}}function Ym(t,e,n){if("float32"!==e)return!1;for(let e=0;e<t.length;e++){const r=t[e];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class Zm{logKernelProfile(t,e,n,r,s,o){const i="number"==typeof r?Zp(`${r}ms`,9):r.error,a=Zp(t,25),u=e.rank,c=e.size,l=Zp(e.shape.toString(),14);let f="";for(const t in s){const n=s[t];if(null!=n){const r=n.shape||e.shape,s=r.length;f+=`${t}: ${s}D ${s>0?r:""} `}}console.log(`%c${a}\t%c${i}\t%c${u}D ${l}\t%c${c}\t%c${f}\t%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qm(t,e,n,r){const s=ld(e),o=function(t,e,n,r){const s=Kp(e),o=r[r.length-1],i=new Array(o).fill(0),a=e.length,u="complex64"===n?ry(t):t;if(a>1)for(let t=0;t<s/o;t++){const e=t*o;for(let t=0;t<o;t++)i[t]=Math.max(i[t],ty(u[e+t],0,n).length)}return i}(t,e,n,s),i=e.length,a=ny(t,e,n,s,o),u=["Tensor"];return r&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${i}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(a.map((t=>"    "+t)).join("\n")),u.join("\n")}function ty(t,e,n){let r;return r=Array.isArray(t)?`${parseFloat(t[0].toFixed(7))} + ${parseFloat(t[1].toFixed(7))}j`:id(t)?`'${t}'`:"bool"===n?ey(t):parseFloat(t.toFixed(7)).toString(),Zp(r,e)}function ey(t){return 0===t?"false":"true"}function ny(t,e,n,r,s,o=!0){const i="complex64"===n?2:1,a=e[0],u=e.length;if(0===u){if("complex64"===n){return[ty(ry(t)[0],0,n)]}return"bool"===n?[ey(t[0])]:[t[0].toString()]}if(1===u){if(a>20){const e=3*i;let r=Array.from(t.slice(0,e)),o=Array.from(t.slice((a-3)*i,a*i));return"complex64"===n&&(r=ry(r),o=ry(o)),["["+r.map(((t,e)=>ty(t,s[e],n))).join(", ")+", ..., "+o.map(((t,e)=>ty(t,s[a-3+e],n))).join(", ")+"]"]}return["["+("complex64"===n?ry(t):Array.from(t)).map(((t,e)=>ty(t,s[e],n))).join(", ")+"]"]}const c=e.slice(1),l=r.slice(1),f=r[0]*i,h=[];if(a>20){for(let e=0;e<3;e++){const r=e*f,o=r+f;h.push(...ny(t.slice(r,o),c,n,l,s,!1))}h.push("...");for(let e=a-3;e<a;e++){const r=e*f,o=r+f;h.push(...ny(t.slice(r,o),c,n,l,s,e===a-1))}}else for(let e=0;e<a;e++){const r=e*f,o=r+f;h.push(...ny(t.slice(r,o),c,n,l,s,e===a-1))}const p=2===u?",":"";h[0]="["+h[0]+p;for(let t=1;t<h.length-1;t++)h[t]=" "+h[t]+p;let d=",\n";for(let t=2;t<u;t++)d+="\n";return h[h.length-1]=" "+h[h.length-1]+"]"+(o?"":d),h}function ry(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sy{constructor(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=Kp(t),null!=n){const t=n.length;jp(t===this.size,(()=>`Length of values '${t}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||rd(e,this.size),this.strides=ld(t)}set(t,...e){0===e.length&&(e=[0]),jp(e.length===this.rank,(()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`));const n=this.locToIndex(e);this.values[n]=t}get(...t){0===t.length&&(t=[0]);let e=0;for(const n of t){if(n<0||n>=this.shape[e]){const e=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(e)}e++}let n=t[t.length-1];for(let e=0;e<t.length-1;++e)n+=this.strides[e]*t[e];return this.values[n]}locToIndex(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];let e=t[t.length-1];for(let n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e}indexToLoc(t){if(0===this.rank)return[];if(1===this.rank)return[t];const e=new Array(this.shape.length);for(let n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return oy().makeTensor(this.values,this.shape,this.dtype)}}let oy=null,iy=null;class ay{constructor(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=Kp(t),this.strides=ld(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return iy.buffer(this.shape,this.dtype,t)}bufferSync(){return iy.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return hd(this.shape,t,"complex64"===this.dtype)}arraySync(){return hd(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const t=oy().read(this.dataId);if("string"===this.dtype){const e=await t;try{return e.map((t=>Xm(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),oy().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=oy().readSync(this.dataId);if("string"===this.dtype)try{return t.map((t=>Xm(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await oy().read(this.dataId);return"string"===this.dtype?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(oy().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return iy.print(this,t)}clone(){return this.throwIfDisposed(),iy.clone(this)}toString(t=!1){return Qm(this.dataSync(),this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),iy.cast(this,t)}variable(t=!0,e,n){return this.throwIfDisposed(),oy().makeVariable(this,t,e,n)}}Object.defineProperty(ay,Symbol.hasInstance,{value:t=>!!t&&null!=t.data&&null!=t.dataSync&&null!=t.throwIfDisposed}),Yd("Tensor",(()=>ay));class uy extends ay{constructor(t,e,n,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=e,this.name=n}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!Xp(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);oy().disposeTensor(this),this.dataId=t.dataId,oy().incRef(this,null)}dispose(){oy().disposeVariable(this),this.isDisposedInternal=!0}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var cy,ly,fy,hy,py;Object.defineProperty(uy,Symbol.hasInstance,{value:t=>t instanceof ay&&null!=t.assign&&t.assign instanceof Function}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(cy||(cy={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(ly||(ly={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(fy||(fy={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(hy||(hy={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(py||(py={}));const dy={float32:hy,int32:ly,bool:fy,complex64:py};function my(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return dy[t][e]}function yy(t){return my(t,"int32")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gy(t,e){if(t.dtype===e.dtype)return[t,e];const n=my(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function by(t){const e=[];return wy(t,e,new Set),e}function wy(t,e,n){if(null==t)return;if(t instanceof ay)return void e.push(t);if(r=t,!Array.isArray(r)&&"object"!=typeof r)return;var r;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s=t;for(const t in s){const r=s[t];n.has(r)||(n.add(r),wy(r,e,n))}}function vy(t){return null!=t.kernelName}class xy{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((t=>t.name))))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class Ny{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new xy}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;{const{asyncInit:e}=this.initializeBackend(t);if(e)return null}}return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,n=1){return t in this.registryFactory?(Zd(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:n},!0)}async setBackend(t){if(null==this.registryFactory[t])throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,null==this.registry[t]){this.backendInstance=null;const{success:e,asyncInit:n}=this.initializeBackend(t);if(!(n?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new Jm(this.backendInstance),!0}setupRegisteredKernels(){rm(this.backendName).forEach((t=>{null!=t.setupFunc&&t.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(t){rm(t).forEach((e=>{null!=e.disposeFunc&&e.disposeFunc(this.registry[t])}))}initializeBackend(t){const e=this.registryFactory[t];if(null==e)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const n=e.factory();if(!n||n instanceof Bp||"function"!=typeof n.then)return this.registry[t]=n,{success:!0,asyncInit:!1};{const e=++this.pendingBackendInitId,r=n.then((n=>!(e<this.pendingBackendInitId)&&(this.registry[t]=n,this.pendingBackendInit=null,!0))).catch((n=>(e<this.pendingBackendInitId||(this.pendingBackendInit=null,Zd(`Initialization of backend ${t} failed`),Zd(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(e){return Zd(`Initialization of backend ${t} failed`),Zd(e.stack||e.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority))}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e],{success:r,asyncInit:s}=this.initializeBackend(n);if(s||r)return{name:n,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const n=this.state.tensorInfo.get(e),r=n.backend,s=this.readSync(e),o=r.refCount(e);r.disposeData(e,!0),n.backend=t,t.move(e,s,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let n,r=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=e(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(t,e,n){t();try{const t=n();return e(),t}catch(t){throw e(),t}}nextTensorId(){return Ny.nextTensorId++}nextVariableId(){return Ny.nextVariableId++}clone(t){const e=Ey.runKernel("Identity",{x:t}),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(t=>({x:()=>{const e={x:t},n={dtype:"float32"};return Ey.runKernel("Cast",e,n)}})),[],{}),e}runKernel(t,e,n){null==this.backendName&&this.backend;if(!(null!=em(t,this.backendName)))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,n){const r=this.backend.numDataIds();let s=0;n.forEach((t=>{s+="complex64"===t.dtype?3:1}));const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=r-e-s-o;if(i>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${i} data ids) after running '${t}'`)}runKernelFunc(t){let e,n=[];const r=this.isTapeOn(),s=this.state.numBytes,o=this.state.numTensors;let i,a;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const u=vy(t)?t.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(vy(t)){const{kernelName:e,inputs:s,attrs:o}=t;null==this.backendName&&this.backend;const u=em(e,this.backendName);jp(null!=u,(()=>`Cannot find registered kernel '${e}' for backend '${this.backendName}'`)),i=()=>{const t=this.backend.numDataIds();a=u.kernelFunc({inputs:s,attrs:o,backend:this.backend});const i=Array.isArray(a)?a:[a];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(e,t,i);const c=i.map((t=>null!=t.rank?t:this.makeTensorFromTensorInfo(t)));if(r){const t=this.getTensorsForGradient(e,s,c);n=this.saveTensorsForBackwardMode(t)}return c}}else{const{forwardFunc:e}=t,s=t=>{r&&(n=t.map((t=>this.keep(this.clone(t)))))};i=()=>{const t=this.backend.numDataIds();a=this.tidy((()=>e(this.backend,s)));const n=Array.isArray(a)?a:[a];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,t,n),n}}const{inputs:c,attrs:l}=t,f=vy(t)?null:t.backwardsFunc;let h;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(h=this.profiler.profileKernel(u,c,(()=>i())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(h),e=h.outputs):e=i()})),r&&this.addTapeNode(u,c,e,f,n,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map((t=>null!=c[t]?c[t].shape:null)),outputShapes:e.map((t=>t.shape)),kernelTimeMs:h.timeMs,extraInfo:h.extraInfo}),Array.isArray(a)?e:e[0]}saveTensorsForBackwardMode(t){const e=t.map((t=>this.keep(this.clone(t))));return e}getTensorsForGradient(t,e,n){const r=nm(t);if(null!=r){const t=r.inputsToSave||[],s=r.outputsToSave||[];let o;r.saveAllInputs?(jp(Array.isArray(e),(()=>"saveAllInputs is true, expected inputs to be an array.")),o=Object.keys(e).map((t=>e[t]))):o=t.map((t=>e[t]));const i=n.filter(((t,e)=>s[e]));return o.concat(i)}return[]}makeTensor(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let s=t;"string"===n&&id(t[0])&&(s=t.map((t=>Km(t))));const o=r.write(s,e,n),i=new ay(e,n,o,this.nextTensorId());if(this.trackTensor(i,r),"string"===n){const t=this.state.tensorInfo.get(o),e=function(t){if(null==t)return 0;let e=0;return t.forEach((t=>e+=t.length)),e}(s);this.state.numBytes+=e-t.bytes,t.bytes=e}return i}makeTensorFromDataId(t,e,n,r){const s={dataId:t,shape:e,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(s,r)}makeTensorFromTensorInfo(t,e){const{dataId:n,shape:r,dtype:s}=t,o=new ay(r,s,n,this.nextTensorId());return this.trackTensor(o,e),o}makeVariable(t,e=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.cast(r));const s=new uy(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[s.name])throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(t,e){this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*od(t.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n})),t instanceof uy||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,"string"===t.dtype&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),"complex64"!==t.dtype&&"string"!==t.dtype){const e=t.size*od(t.dtype);this.state.numBytes-=e}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((t=>t.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const t of this.state.activeProfile.kernels)t.kernelTimeMs=await t.kernelTimeMs,t.extraInfo=await t.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(t,e,n,r,s,o){const i={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:s},a=nm(t);null!=a&&(r=a.gradFunc),null!=r&&(i.gradient=t=>(t=t.map(((t,e)=>{if(null==t){const t=n[e],r=dd(t.size,t.dtype);return this.makeTensor(r,t.shape,t.dtype)}return t})),r(t.length>1?t:t[0],s,o))),this.state.activeTape.push(i)}keep(t){return t.kept=!0,t}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=by(t),n=new Set(e.map((t=>t.id)));for(let t=0;t<this.state.activeScope.track.length;t++){const e=this.state.activeScope.track[t];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach((t=>{t.kept||t.scopeId!==r.id||this.track(t)}))}gradients(t,e,n,r=!1){if(jp(e.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const s=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",t)));jp(s instanceof ay,(()=>"The result y returned by f() must be a tensor."));const o=function(t,e,n){const r={},s={};for(let t=0;t<e.length;t++)r[e[t].id]=!0;for(let n=0;n<t.length;n++){const o=t[n],i=o.inputs;for(const t in i){const n=i[t];let a=!1;for(let t=0;t<e.length;t++)if(r[n.id]){o.outputs.forEach((t=>r[t.id]=!0)),a=!0,s[o.id]=!0;break}if(a)break}}const o={};o[n.id]=!0;const i={};for(let e=t.length-1;e>=0;e--){const n=t[e],r=n.inputs;for(let t=0;t<n.outputs.length;t++)if(o[n.outputs[t].id]){for(const t in r)o[r[t].id]=!0,i[n.id]=!0;break}}const a=[];for(let e=0;e<t.length;e++){const n=t[e];if(s[n.id]&&i[n.id]){const t={};for(const e in n.inputs){const s=n.inputs[e];r[s.id]&&(t[e]=s)}const e=Object.assign({},n);e.inputs=t,e.outputs=n.outputs,a.push(e)}}return a}(this.state.activeTape,e,s);if(!r&&0===o.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const t={};t[s.id]=null==n?function(t){const e=pd(Kp(t),"float32");return Ey.makeTensor(e,t,"float32")}(s.shape):n,function(t,e,n,r){for(let s=e.length-1;s>=0;s--){const o=e[s],i=[];if(o.outputs.forEach((e=>{const n=t[e.id];null!=n?i.push(n):i.push(null)})),null==o.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const e in o.inputs){if(!(e in a))throw new Error(`Cannot backprop through input ${e}. Available gradients found: ${Object.keys(a)}.`);const s=n((()=>a[e]()));if("float32"!==s.dtype)throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${e} must have 'float32' dtype, but has '${s.dtype}'`);const i=o.inputs[e];if(!Xp(s.shape,i.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${e}' has shape '${s.shape}', which does not match the shape of the input '${i.shape}'`);if(null==t[i.id])t[i.id]=s;else{const e=t[i.id];t[i.id]=r(e,s),e.dispose()}}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,o,(t=>this.tidy(t)),Sy);const r=e.map((e=>t[e.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((t=>{for(const e of t.saved)e.dispose()})),this.state.activeTape=null),{value:s,grads:r}}))}customGrad(t){return jp(ud(t),(()=>"The f passed in customGrad(f) must be a function.")),(...e)=>{let n;jp(e.every((t=>t instanceof ay)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};e.forEach(((t,e)=>{r[e]=t}));return this.runKernelFunc({forwardFunc:(r,s)=>(n=t(...e,s),jp(n.value instanceof ay,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),jp(ud(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(t,r)=>{const s=n.gradFunc(t,r),o=Array.isArray(s)?s:[s];jp(o.length===e.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),jp(o.every((t=>t instanceof ay)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const i={};return o.forEach(((t,e)=>{i[e]=()=>t})),i},inputs:r})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)}async time(t){const e=Hm(),n=await this.backend.time(t);return n.wallMs=Hm()-e,n}track(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new xy;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function $y(){const t=Jd();if(null==t._tfengine){const e=new wd(t);t._tfengine=new Ny(e)}var e;return e=t._tfengine.ENV,Nd=e,oy=()=>t._tfengine,t._tfengine}Ny.nextTensorId=0,Ny.nextVariableId=0;const Ey=$y();function Sy(t,e){const n={a:t,b:e};return Ey.runKernel("Add",n)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _y(t){if(t||"undefined"!=typeof navigator&&null!=navigator){if(t||(t=navigator),"ReactNative"===t.product)return!0;const e=t.userAgent||t.vendor||("undefined"!=typeof window?window.opera:"");if(!e){const e=t;return e.userAgentData&&e.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function Ty(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}const ky=xd();ky.registerFlag("DEBUG",(()=>!1),(t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),ky.registerFlag("IS_BROWSER",(()=>Ty())),ky.registerFlag("IS_NODE",(()=>void 0!==Kd&&void 0!==Kd.versions&&void 0!==Kd.versions.node)),ky.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),ky.registerFlag("PROD",(()=>!1)),ky.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>ky.getBool("DEBUG"))),ky.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),ky.registerFlag("IS_TEST",(()=>!1)),ky.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>!0)),ky.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),ky.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));var Ay=[],Cy=[],Oy="undefined"!=typeof Uint8Array?Uint8Array:Array,Iy=!1;function My(){Iy=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,n=t.length;e<n;++e)Ay[e]=t[e],Cy[t.charCodeAt(e)]=e;Cy["-".charCodeAt(0)]=62,Cy["_".charCodeAt(0)]=63}function Ry(t,e,n){for(var r,s,o=[],i=e;i<n;i+=3)r=(t[i]<<16)+(t[i+1]<<8)+t[i+2],o.push(Ay[(s=r)>>18&63]+Ay[s>>12&63]+Ay[s>>6&63]+Ay[63&s]);return o.join("")}function Dy(t){var e;Iy||My();for(var n=t.length,r=n%3,s="",o=[],i=16383,a=0,u=n-r;a<u;a+=i)o.push(Ry(t,a,a+i>u?u:a+i));return 1===r?(e=t[n-1],s+=Ay[e>>2],s+=Ay[e<<4&63],s+="=="):2===r&&(e=(t[n-2]<<8)+t[n-1],s+=Ay[e>>10],s+=Ay[e>>4&63],s+=Ay[e<<2&63],s+="="),o.push(s),o.join("")}function Fy(t,e,n,r,s){var o,i,a=8*s-r-1,u=(1<<a)-1,c=u>>1,l=-7,f=n?s-1:0,h=n?-1:1,p=t[e+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+t[e+f],f+=h,l-=8);for(i=o&(1<<-l)-1,o>>=-l,l+=r;l>0;i=256*i+t[e+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return i?NaN:1/0*(p?-1:1);i+=Math.pow(2,r),o-=c}return(p?-1:1)*i*Math.pow(2,o-r)}function Ly(t,e,n,r,s,o){var i,a,u,c=8*o-s-1,l=(1<<c)-1,f=l>>1,h=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,i=l):(i=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-i))<1&&(i--,u*=2),(e+=i+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(i++,u/=2),i+f>=l?(a=0,i=l):i+f>=1?(a=(e*u-1)*Math.pow(2,s),i+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,s),i=0));s>=8;t[n+p]=255&a,p+=d,a/=256,s-=8);for(i=i<<s|a,c+=s;c>0;t[n+p]=255&i,p+=d,i/=256,c-=8);t[n+p-d]|=128*m}var Py={}.toString,By=Array.isArray||function(t){return"[object Array]"==Py.call(t)};function Vy(){return Wy.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function zy(t,e){if(Vy()<e)throw new RangeError("Invalid typed array length");return Wy.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=Wy.prototype:(null===t&&(t=new Wy(e)),t.length=e),t}function Wy(t,e,n){if(!(Wy.TYPED_ARRAY_SUPPORT||this instanceof Wy))return new Wy(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return Gy(this,t)}return Uy(this,t,e,n)}function Uy(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);Wy.TYPED_ARRAY_SUPPORT?(t=e).__proto__=Wy.prototype:t=qy(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!Wy.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|Xy(e,n),s=(t=zy(t,r)).write(e,n);s!==r&&(t=t.slice(0,s));return t}(t,e,n):function(t,e){if(Ky(e)){var n=0|Hy(e.length);return 0===(t=zy(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?zy(t,0):qy(t,e);if("Buffer"===e.type&&By(e.data))return qy(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function jy(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function Gy(t,e){if(jy(e),t=zy(t,e<0?0:0|Hy(e)),!Wy.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function qy(t,e){var n=e.length<0?0:0|Hy(e.length);t=zy(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function Hy(t){if(t>=Vy())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Vy().toString(16)+" bytes");return 0|t}function Ky(t){return!(null==t||!t._isBuffer)}function Xy(t,e){if(Ky(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return xg(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Ng(t).length;default:if(r)return xg(t).length;e=(""+e).toLowerCase(),r=!0}}function Jy(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return lg(this,e,n);case"utf8":case"utf-8":return ag(this,e,n);case"ascii":return ug(this,e,n);case"latin1":case"binary":return cg(this,e,n);case"base64":return ig(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return fg(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function Yy(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function Zy(t,e,n,r,s){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=s?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(s)return-1;n=t.length-1}else if(n<0){if(!s)return-1;n=0}if("string"==typeof e&&(e=Wy.from(e,r)),Ky(e))return 0===e.length?-1:Qy(t,e,n,r,s);if("number"==typeof e)return e&=255,Wy.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):Qy(t,[e],n,r,s);throw new TypeError("val must be string, number or Buffer")}function Qy(t,e,n,r,s){var o,i=1,a=t.length,u=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;i=2,a/=2,u/=2,n/=2}function c(t,e){return 1===i?t[e]:t.readUInt16BE(e*i)}if(s){var l=-1;for(o=n;o<a;o++)if(c(t,o)===c(e,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*i}else-1!==l&&(o-=o-l),l=-1}else for(n+u>a&&(n=a-u),o=n;o>=0;o--){for(var f=!0,h=0;h<u;h++)if(c(t,o+h)!==c(e,h)){f=!1;break}if(f)return o}return-1}function tg(t,e,n,r){n=Number(n)||0;var s=t.length-n;r?(r=Number(r))>s&&(r=s):r=s;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var i=0;i<r;++i){var a=parseInt(e.substr(2*i,2),16);if(isNaN(a))return i;t[n+i]=a}return i}function eg(t,e,n,r){return $g(xg(e,t.length-n),t,n,r)}function ng(t,e,n,r){return $g(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function rg(t,e,n,r){return ng(t,e,n,r)}function sg(t,e,n,r){return $g(Ng(e),t,n,r)}function og(t,e,n,r){return $g(function(t,e){for(var n,r,s,o=[],i=0;i<t.length&&!((e-=2)<0);++i)r=(n=t.charCodeAt(i))>>8,s=n%256,o.push(s),o.push(r);return o}(e,t.length-n),t,n,r)}function ig(t,e,n){return 0===e&&n===t.length?Dy(t):Dy(t.slice(e,n))}function ag(t,e,n){n=Math.min(t.length,n);for(var r=[],s=e;s<n;){var o,i,a,u,c=t[s],l=null,f=c>239?4:c>223?3:c>191?2:1;if(s+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=t[s+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=t[s+1],i=t[s+2],128==(192&o)&&128==(192&i)&&(u=(15&c)<<12|(63&o)<<6|63&i)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=t[s+1],i=t[s+2],a=t[s+3],128==(192&o)&&128==(192&i)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&i)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),s+=f}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=4096));return n}(r)}Wy.TYPED_ARRAY_SUPPORT=void 0===$d.TYPED_ARRAY_SUPPORT||$d.TYPED_ARRAY_SUPPORT,Vy(),Wy.poolSize=8192,Wy._augment=function(t){return t.__proto__=Wy.prototype,t},Wy.from=function(t,e,n){return Uy(null,t,e,n)},Wy.TYPED_ARRAY_SUPPORT&&(Wy.prototype.__proto__=Uint8Array.prototype,Wy.__proto__=Uint8Array),Wy.alloc=function(t,e,n){return function(t,e,n,r){return jy(e),e<=0?zy(t,e):void 0!==n?"string"==typeof r?zy(t,e).fill(n,r):zy(t,e).fill(n):zy(t,e)}(null,t,e,n)},Wy.allocUnsafe=function(t){return Gy(null,t)},Wy.allocUnsafeSlow=function(t){return Gy(null,t)},Wy.isBuffer=function(t){return null!=t&&(!!t._isBuffer||Eg(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&Eg(t.slice(0,0))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t))},Wy.compare=function(t,e){if(!Ky(t)||!Ky(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,s=0,o=Math.min(n,r);s<o;++s)if(t[s]!==e[s]){n=t[s],r=e[s];break}return n<r?-1:r<n?1:0},Wy.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Wy.concat=function(t,e){if(!By(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Wy.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=Wy.allocUnsafe(e),s=0;for(n=0;n<t.length;++n){var o=t[n];if(!Ky(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,s),s+=o.length}return r},Wy.byteLength=Xy,Wy.prototype._isBuffer=!0,Wy.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)Yy(this,e,e+1);return this},Wy.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)Yy(this,e,e+3),Yy(this,e+1,e+2);return this},Wy.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)Yy(this,e,e+7),Yy(this,e+1,e+6),Yy(this,e+2,e+5),Yy(this,e+3,e+4);return this},Wy.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?ag(this,0,t):Jy.apply(this,arguments)},Wy.prototype.equals=function(t){if(!Ky(t))throw new TypeError("Argument must be a Buffer");return this===t||0===Wy.compare(this,t)},Wy.prototype.inspect=function(){var t="";return this.length>0&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(t+=" ... ")),"<Buffer "+t+">"},Wy.prototype.compare=function(t,e,n,r,s){if(!Ky(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===s&&(s=this.length),e<0||n>t.length||r<0||s>this.length)throw new RangeError("out of range index");if(r>=s&&e>=n)return 0;if(r>=s)return-1;if(e>=n)return 1;if(this===t)return 0;for(var o=(s>>>=0)-(r>>>=0),i=(n>>>=0)-(e>>>=0),a=Math.min(o,i),u=this.slice(r,s),c=t.slice(e,n),l=0;l<a;++l)if(u[l]!==c[l]){o=u[l],i=c[l];break}return o<i?-1:i<o?1:0},Wy.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},Wy.prototype.indexOf=function(t,e,n){return Zy(this,t,e,n,!0)},Wy.prototype.lastIndexOf=function(t,e,n){return Zy(this,t,e,n,!1)},Wy.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var s=this.length-e;if((void 0===n||n>s)&&(n=s),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return tg(this,t,e,n);case"utf8":case"utf-8":return eg(this,t,e,n);case"ascii":return ng(this,t,e,n);case"latin1":case"binary":return rg(this,t,e,n);case"base64":return sg(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return og(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},Wy.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ug(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(127&t[s]);return r}function cg(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(t[s]);return r}function lg(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var s="",o=e;o<n;++o)s+=vg(t[o]);return s}function fg(t,e,n){for(var r=t.slice(e,n),s="",o=0;o<r.length;o+=2)s+=String.fromCharCode(r[o]+256*r[o+1]);return s}function hg(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function pg(t,e,n,r,s,o){if(!Ky(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function dg(t,e,n,r){e<0&&(e=65535+e+1);for(var s=0,o=Math.min(t.length-n,2);s<o;++s)t[n+s]=(e&255<<8*(r?s:1-s))>>>8*(r?s:1-s)}function mg(t,e,n,r){e<0&&(e=4294967295+e+1);for(var s=0,o=Math.min(t.length-n,4);s<o;++s)t[n+s]=e>>>8*(r?s:3-s)&255}function yg(t,e,n,r,s,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function gg(t,e,n,r,s){return s||yg(t,0,n,4),Ly(t,e,n,r,23,4),n+4}function bg(t,e,n,r,s){return s||yg(t,0,n,8),Ly(t,e,n,r,52,8),n+8}Wy.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),Wy.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=Wy.prototype;else{var s=e-t;n=new Wy(s,void 0);for(var o=0;o<s;++o)n[o]=this[o+t]}return n},Wy.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||hg(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r},Wy.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||hg(t,e,this.length);for(var r=this[t+--e],s=1;e>0&&(s*=256);)r+=this[t+--e]*s;return r},Wy.prototype.readUInt8=function(t,e){return e||hg(t,1,this.length),this[t]},Wy.prototype.readUInt16LE=function(t,e){return e||hg(t,2,this.length),this[t]|this[t+1]<<8},Wy.prototype.readUInt16BE=function(t,e){return e||hg(t,2,this.length),this[t]<<8|this[t+1]},Wy.prototype.readUInt32LE=function(t,e){return e||hg(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Wy.prototype.readUInt32BE=function(t,e){return e||hg(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Wy.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||hg(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r>=(s*=128)&&(r-=Math.pow(2,8*e)),r},Wy.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||hg(t,e,this.length);for(var r=e,s=1,o=this[t+--r];r>0&&(s*=256);)o+=this[t+--r]*s;return o>=(s*=128)&&(o-=Math.pow(2,8*e)),o},Wy.prototype.readInt8=function(t,e){return e||hg(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Wy.prototype.readInt16LE=function(t,e){e||hg(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},Wy.prototype.readInt16BE=function(t,e){e||hg(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},Wy.prototype.readInt32LE=function(t,e){return e||hg(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Wy.prototype.readInt32BE=function(t,e){return e||hg(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Wy.prototype.readFloatLE=function(t,e){return e||hg(t,4,this.length),Fy(this,t,!0,23,4)},Wy.prototype.readFloatBE=function(t,e){return e||hg(t,4,this.length),Fy(this,t,!1,23,4)},Wy.prototype.readDoubleLE=function(t,e){return e||hg(t,8,this.length),Fy(this,t,!0,52,8)},Wy.prototype.readDoubleBE=function(t,e){return e||hg(t,8,this.length),Fy(this,t,!1,52,8)},Wy.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||pg(this,t,e,n,Math.pow(2,8*n)-1,0);var s=1,o=0;for(this[e]=255&t;++o<n&&(s*=256);)this[e+o]=t/s&255;return e+n},Wy.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||pg(this,t,e,n,Math.pow(2,8*n)-1,0);var s=n-1,o=1;for(this[e+s]=255&t;--s>=0&&(o*=256);)this[e+s]=t/o&255;return e+n},Wy.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||pg(this,t,e,1,255,0),Wy.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},Wy.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||pg(this,t,e,2,65535,0),Wy.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):dg(this,t,e,!0),e+2},Wy.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||pg(this,t,e,2,65535,0),Wy.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):dg(this,t,e,!1),e+2},Wy.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||pg(this,t,e,4,4294967295,0),Wy.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):mg(this,t,e,!0),e+4},Wy.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||pg(this,t,e,4,4294967295,0),Wy.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):mg(this,t,e,!1),e+4},Wy.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);pg(this,t,e,n,s-1,-s)}var o=0,i=1,a=0;for(this[e]=255&t;++o<n&&(i*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},Wy.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);pg(this,t,e,n,s-1,-s)}var o=n-1,i=1,a=0;for(this[e+o]=255&t;--o>=0&&(i*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},Wy.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||pg(this,t,e,1,127,-128),Wy.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},Wy.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||pg(this,t,e,2,32767,-32768),Wy.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):dg(this,t,e,!0),e+2},Wy.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||pg(this,t,e,2,32767,-32768),Wy.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):dg(this,t,e,!1),e+2},Wy.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||pg(this,t,e,4,2147483647,-2147483648),Wy.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):mg(this,t,e,!0),e+4},Wy.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||pg(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),Wy.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):mg(this,t,e,!1),e+4},Wy.prototype.writeFloatLE=function(t,e,n){return gg(this,t,e,!0,n)},Wy.prototype.writeFloatBE=function(t,e,n){return gg(this,t,e,!1,n)},Wy.prototype.writeDoubleLE=function(t,e,n){return bg(this,t,e,!0,n)},Wy.prototype.writeDoubleBE=function(t,e,n){return bg(this,t,e,!1,n)},Wy.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var s,o=r-n;if(this===t&&n<e&&e<r)for(s=o-1;s>=0;--s)t[s+e]=this[s+n];else if(o<1e3||!Wy.TYPED_ARRAY_SUPPORT)for(s=0;s<o;++s)t[s+e]=this[s+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},Wy.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var s=t.charCodeAt(0);s<256&&(t=s)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!Wy.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var i=Ky(t)?t:xg(new Wy(t,r).toString()),a=i.length;for(o=0;o<n-e;++o)this[o+e]=i[o%a]}return this};var wg=/[^+\/0-9A-Za-z-_]/g;function vg(t){return t<16?"0"+t.toString(16):t.toString(16)}function xg(t,e){var n;e=e||1/0;for(var r=t.length,s=null,o=[],i=0;i<r;++i){if((n=t.charCodeAt(i))>55295&&n<57344){if(!s){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(i+1===r){(e-=3)>-1&&o.push(239,191,189);continue}s=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),s=n;continue}n=65536+(s-55296<<10|n-56320)}else s&&(e-=3)>-1&&o.push(239,191,189);if(s=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function Ng(t){return function(t){var e,n,r,s,o,i;Iy||My();var a=t.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===t[a-2]?2:"="===t[a-1]?1:0,i=new Oy(3*a/4-o),r=o>0?a-4:a;var u=0;for(e=0,n=0;e<r;e+=4,n+=3)s=Cy[t.charCodeAt(e)]<<18|Cy[t.charCodeAt(e+1)]<<12|Cy[t.charCodeAt(e+2)]<<6|Cy[t.charCodeAt(e+3)],i[u++]=s>>16&255,i[u++]=s>>8&255,i[u++]=255&s;return 2===o?(s=Cy[t.charCodeAt(e)]<<2|Cy[t.charCodeAt(e+1)]>>4,i[u++]=255&s):1===o&&(s=Cy[t.charCodeAt(e)]<<10|Cy[t.charCodeAt(e+1)]<<4|Cy[t.charCodeAt(e+2)]>>2,i[u++]=s>>8&255,i[u++]=255&s),i}(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(wg,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function $g(t,e,n,r){for(var s=0;s<r&&!(s+n>=e.length||s>=t.length);++s)e[s+n]=t[s];return s}function Eg(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function Sg(t,e){let n=t;if(sd(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||sd(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&xd().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&_g(t,r,[]),r}function _g(t,e,n){if(n=n||[],!Array.isArray(t)&&!sd(t))return void jp(0===e.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`));jp(e.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`)),jp(t.length===e[0],(()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`));const r=e.slice(1);for(let e=0;e<t.length;++e)_g(t[e],r,n.concat(e))}function Tg(t,e,n,r){if("string_or_numeric"!==t){if(null==t)throw new Error("Expected dtype cannot be null.");if("numeric"!==t&&t!==e||"numeric"===t&&"string"===e)throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}}function kg(t,e,n,r="numeric"){if(t instanceof ay)return Tg(r,t.dtype,e,n),t;let s=ad(t);if("string"!==s&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),Tg(r,s,e,n),null==t||!sd(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){const r=null==t?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const o=Sg(t,s);sd(t)||Array.isArray(t)||(t=[t]);const i="string"!==s?qm(t,s):Hp(t,[],!0);return Ey.makeTensor(i,o,s)}function Ag(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map(((t,s)=>kg(t,`${e}[${s}]`,n,r)))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cg(t){const e=Object.keys(t);if(1!==e.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const s=(...t)=>{Ey.startScope(n);try{const e=r(...t);return bd(e)&&console.error("Cannot return a Promise inside of tidy."),Ey.endScope(e),e}catch(t){throw Ey.endScope(null),t}};return Object.defineProperty(s,"name",{value:n,configurable:!0}),s}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Og=Cg({complex_:function(t,e){const n=kg(t,"real","complex"),r=kg(e,"imag","complex");Gp(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const s={real:n,imag:r};return Ey.runKernel("Complex",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ig(t,e,n,r){if(null==r&&(r=ad(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!sd(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){md(e);const t=Kp(e),r=Kp(n);jp(t===r,(()=>`Based on the provided shape, [${e}], the tensor should have ${t} values but has ${r}`));for(let t=0;t<n.length;++t){const r=n[t],s=t!==n.length-1||r!==Kp(e.slice(t));jp(n[t]===e[t]||!s,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `))}}return sd(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?qm(t,r):Hp(t,[],!0),Ey.makeTensor(t,e,r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mg="undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa;function Rg(t){return Mg?Wy.byteLength(t):new Blob([t]).size}function Dg(t){if(1===t.length)return t[0];let e=0;t.forEach((t=>{e+=t.byteLength}));const n=new Uint8Array(e);let r=0;return t.forEach((t=>{n.set(new Uint8Array(t),r),r+=t.byteLength})),n.buffer}function Fg(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),n}function Lg(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:Rg(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:Rg(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pg{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==Pg.instance&&(Pg.instance=new Pg),Pg.instance}static registerSaveRouter(t){Pg.getInstance().saveRouters.push(t)}static registerLoadRouter(t){Pg.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return Pg.getHandlers(t,"save")}static getLoadHandlers(t,e){return Pg.getHandlers(t,"load",e)}static getHandlers(t,e,n){const r=[];return("load"===e?Pg.getInstance().loadRouters:Pg.getInstance().saveRouters).forEach((e=>{const s=e(t,n);null!==s&&r.push(s)})),r}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bg(){if(!xd().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t="undefined"==typeof window?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Vg(t){const e=t.result;e.createObjectStore("models_store",{keyPath:"modelPath"}),e.createObjectStore("model_info_store",{keyPath:"modelPath"})}class zg{constructor(t){if(this.indexedDB=Bg(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise(((t,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>Vg(r),r.onsuccess=()=>{const s=r.result;if(null==e){const e=s.transaction("models_store","readonly"),r=e.objectStore("models_store").get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return s.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));t(r.result.modelArtifacts)},r.onerror=t=>(s.close(),n(r.error)),e.oncomplete=()=>s.close()}else{const r=Lg(e),o=s.transaction("model_info_store","readwrite");let i=o.objectStore("model_info_store");const a=i.put({modelPath:this.modelPath,modelArtifactsInfo:r});let u;a.onsuccess=()=>{u=s.transaction("models_store","readwrite");const a=u.objectStore("models_store").put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:r});a.onsuccess=()=>t({modelArtifactsInfo:r}),a.onerror=t=>{i=o.objectStore("model_info_store");const e=i.delete(this.modelPath);e.onsuccess=()=>(s.close(),n(a.error)),e.onerror=t=>(s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}}},r.onerror=t=>n(r.error)}))}}zg.URL_SCHEME="indexeddb://";const Wg=t=>{return xd().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(zg.URL_SCHEME)?(e=t.slice(zg.URL_SCHEME.length),new zg(e)):null;var e};Pg.registerSaveRouter(Wg),Pg.registerLoadRouter(Wg);class Ug{constructor(){this.indexedDB=Bg()}async listModels(){return new Promise(((t,e)=>{const n=this.indexedDB.open("tensorflowjs",1);n.onupgradeneeded=()=>Vg(n),n.onsuccess=()=>{const r=n.result,s=r.transaction("model_info_store","readonly"),o=s.objectStore("model_info_store").getAll();o.onsuccess=()=>{const e={};for(const t of o.result)e[t.modelPath]=t.modelArtifactsInfo;t(e)},o.onerror=t=>(r.close(),e(o.error)),s.oncomplete=()=>r.close()},n.onerror=t=>e(n.error)}))}async removeModel(t){var e;return t=(e=t).startsWith(zg.URL_SCHEME)?e.slice(zg.URL_SCHEME.length):e,new Promise(((e,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>Vg(r),r.onsuccess=()=>{const s=r.result,o=s.transaction("model_info_store","readwrite"),i=o.objectStore("model_info_store"),a=i.get(t);let u;a.onsuccess=()=>{if(null==a.result)return s.close(),n(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const r=i.delete(t),o=()=>{u=s.transaction("models_store","readwrite");const r=u.objectStore("models_store").delete(t);r.onsuccess=()=>e(a.result.modelArtifactsInfo),r.onerror=t=>n(a.error)};r.onsuccess=o,r.onerror=t=>(o(),s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}},r.onerror=t=>n(r.error)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jg="tensorflowjs_models",Gg="info",qg="model_topology",Hg="weight_specs",Kg="weight_data",Xg="model_metadata";function Jg(t){return{info:[jg,t,Gg].join("/"),topology:[jg,t,qg].join("/"),weightSpecs:[jg,t,Hg].join("/"),weightData:[jg,t,Kg].join("/"),modelMetadata:[jg,t,Xg].join("/")}}function Yg(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function Zg(t){const e=t.split("/");if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join("/")}class Qg{constructor(t){if(!xd().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Jg(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=Lg(t);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(Mg)return Wy.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let t=0,r=e.length;t<r;t++)n+=String.fromCharCode(e[t]);return btoa(n)}(t.weightData));const s={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:r}}catch(t){throw Yg(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(null==t)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=r;const s=this.LS.getItem(this.keys.modelMetadata);if(null!=s){const t=JSON.parse(s);e.format=t.format,e.generatedBy=t.generatedBy,e.convertedBy=t.convertedBy,null!=t.signature&&(e.signature=t.signature),null!=t.userDefinedMetadata&&(e.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(e.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(e.trainingConfig=t.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(null==o)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=function(t){if(Mg){const e=Wy.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;++t)n.set([e.charCodeAt(t)],t);return n.buffer}(o),e}}Qg.URL_SCHEME="localstorage://";const tb=t=>{return xd().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Qg.URL_SCHEME)?(e=t.slice(Qg.URL_SCHEME.length),new Qg(e)):null;var e};Pg.registerSaveRouter(tb),Pg.registerLoadRouter(tb);class eb{constructor(){jp(xd().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),jp("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const t={},e=jg+"/",n="/"+Gg;for(let r=0;r<this.LS.length;++r){const s=this.LS.key(r);if(s.startsWith(e)&&s.endsWith(n)){t[Zg(s)]=JSON.parse(this.LS.getItem(s))}}return t}async removeModel(t){var e;const n=Jg(t=(e=t).startsWith(Qg.URL_SCHEME)?e.slice(Qg.URL_SCHEME.length):e);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(n.info));return Yg(n),r}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nb{constructor(){this.managers={}}static getInstance(){return null==nb.instance&&(nb.instance=new nb),nb.instance}static registerManager(t,e){jp(null!=t,(()=>"scheme must not be undefined or null.")),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),jp(t.length>0,(()=>"scheme must not be an empty string."));const n=nb.getInstance();jp(null==n.managers[t],(()=>`A model store manager is already registered for scheme '${t}'.`)),n.managers[t]=e}static getManager(t){const e=this.getInstance().managers[t];if(null==e)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rb{fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}}if(xd().get("IS_BROWSER")){xd().setPlatform("browser",new rb);try{nb.registerManager(Qg.URL_SCHEME,new eb)}catch(t){}try{nb.registerManager(zg.URL_SCHEME,new Ug)}catch(t){}}const sb=()=>require("node-fetch");let ob;class ib{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return null!=xd().global.fetch?xd().global.fetch(t,e):(null==ob&&(ob=sb()),ob(t,e))}now(){const t=Kd.hrtime();return 1e3*t[0]+t[1]/1e6}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)}}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ab(t,e="float32",n){return e=e||"float32",md(t),new sy(t,e,n)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xd().get("IS_NODE")&&!xd().get("IS_BROWSER")&&xd().setPlatform("node",new ib);const ub=Cg({cast_:function(t,e){const n=kg(t,"x","cast");if(!function(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},s={dtype:e};return Ey.runKernel("Cast",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cb=Cg({clone_:function(t){const e={x:kg(t,"x","clone","string_or_numeric")};return Ey.runKernel("Identity",e)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
$y();const lb={buffer:ab,cast:ub,clone:cb,print:function(t,e=!1){console.log(t.toString(e))}};!function(t){iy=t}(lb);function fb(t){return new Promise((t=>setTimeout(t))).then(t)}class hb{constructor(t){if(!xd().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(hb.URL_SCHEME)&&(t=t.slice(hb.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}async save(t){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n=Fg(t,[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]),r=window.URL.createObjectURL(new Blob([JSON.stringify(n)],{type:"application/json"})),s=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(s.download=this.modelJsonFileName,s.href=r,await fb((()=>s.dispatchEvent(new MouseEvent("click")))),null!=t.weightData){const t=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;t.download=this.weightDataFileName,t.href=e,await fb((()=>t.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:Lg(t)}}}}hb.URL_SCHEME="downloads://";
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function pb(t,e,n,r){!function(t){jp(null!=t&&Array.isArray(t)&&t.length>0,(()=>"promises must be a none empty array"))}(t),function(t,e){jp(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${t}`)),jp(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${e}`)),jp(e>=t,(()=>`startFraction must be no more than endFraction, but got startFraction ${t} and endFraction ${e}`))}(n=null==n?0:n,r=null==r?1:r);let s=0;return Promise.all(t.map((o=>(o.then((o=>{const i=n+ ++s/t.length*(r-n);return e(i),o})),o))))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pg.registerSaveRouter((t=>xd().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(hb.URL_SCHEME)?function(t="model"){return new hb(t)}(t.slice(hb.URL_SCHEME.length)):null));class db{constructor(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,this.weightUrlConverter=e.weightUrlConverter,null!=e.fetchFunc?(jp("function"==typeof e.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=e.fetchFunc):this.fetch=xd().platform.fetch,jp(null!=t&&t.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(t)&&jp(2===t.length,(()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`)),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData;const n=Fg(t,[{paths:["./model.weights.bin"],weights:t.weightSpecs}]);e.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin");const r=await this.fetch(this.path,e);if(r.ok)return{modelArtifactsInfo:Lg(t),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let e;try{e=await t.json()}catch(t){let e=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=e.modelTopology,r=e.weightsManifest;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return async function(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),null!=t.weightsManifest){const[r,s]=await e(t.weightsManifest);n.weightSpecs=r,n.weightData=s}return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),n}(e,(t=>this.loadWeights(t)))}async loadWeights(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),r=t.substring(0,e),s=n>e?t.substring(n):"";return[r+"/",s]}(e),s=this.weightPathPrefix||n,o=[];for(const e of t)o.push(...e.weights);const i=[],a=[];for(const e of t)for(const t of e.paths)null!=this.weightUrlConverter?a.push(this.weightUrlConverter(t)):i.push(s+t+r);this.weightUrlConverter&&i.push(...await Promise.all(a));const u=await async function(t,e){null==e&&(e={});const n=null==e.fetchFunc?xd().platform.fetch:e.fetchFunc,r=t.map((t=>n(t,e.requestInit,{isBinary:!0}))),s=(null==e.onProgress?await Promise.all(r):await pb(r,e.onProgress,0,.5)).map((t=>t.arrayBuffer()));return null==e.onProgress?await Promise.all(s):await pb(s,e.onProgress,.5,1)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(i,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[o,Dg(u)]}}function mb(t){return null!=t.match(db.URL_SCHEME_REGEX)}db.URL_SCHEME_REGEX=/^https?:\/\//;const yb=(t,e)=>{if("undefined"==typeof fetch&&(null==e||null==e.fetchFunc))return null;{let n=!0;if(n=Array.isArray(t)?t.every((t=>mb(t))):mb(t),n)return function(t,e){return new db(t,e)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e)}return null};Pg.registerSaveRouter(yb),Pg.registerLoadRouter(yb);const gb=Cg({matMul_:function(t,e,n=!1,r=!1){let s=kg(t,"a","matMul"),o=kg(e,"b","matMul");[s,o]=gy(s,o);const i={a:s,b:o},a={transposeA:n,transposeB:r};return Ey.runKernel("BatchMatMul",i,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bb=Cg({oneHot_:function(t,e,n=1,r=0){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const s={indices:kg(t,"indices","oneHot","int32")},o={depth:e,onValue:n,offValue:r};return Ey.runKernel("OneHot",s,o)}});function wb(){return Ey}function vb(t,e){return Ey.tidy(t,e)}function xb(t){by(t).forEach((t=>t.dispose()))}const Nb=Cg({imag_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={input:kg(t,"input","imag")};return Ey.runKernel("Imag",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $b=Cg({neg_:function(t){const e={x:kg(t,"x","neg")};return Ey.runKernel("Neg",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eb=Cg({real_:function(t){const e={input:kg(t,"input","real")};return Ey.runKernel("Real",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sb=Cg({transpose_:function(t,e,n){const r=kg(t,"x","transpose");if(null==e&&(e=r.shape.map(((t,e)=>e)).reverse()),jp(r.rank===e.length,(()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`)),e.forEach((t=>{jp(t>=0&&t<r.rank,(()=>"All entries in 'perm' must be between 0 and "+(r.rank-1)+` but got ${e}`))})),r.rank<=1)return r.clone();const s={x:r},o={perm:e};return"complex64"===r.dtype?vb((()=>{let t=Eb(r),e=Nb(r);return t=Ey.runKernel("Transpose",{x:t},o),e=Ey.runKernel("Transpose",{x:e},o),n&&(e=$b(e)),Og(t,e)})):Ey.runKernel("Transpose",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function _b(t,e){const n=t.length,r=[];for(let s=0;s<n;s++){const o=n-1-s,i=t[o]||1;(e[e.length-1-s]||1)>1&&1===i&&r.unshift(o)}return r}function Tb(t,e){const n=[];for(let r=0;r<e.length;r++){const s=t[t.length-r-1],o=e.length-r-1,i=e[o];(null==s||1===s&&i>1)&&n.unshift(o)}return n}function kb(t,e){const n=[],r=Math.max(t.length,e.length);for(let s=0;s<r;s++){let r=t[t.length-s-1];null==r&&(r=1);let o=e[e.length-s-1];if(null==o&&(o=1),1===r)n.unshift(o);else if(1===o)n.unshift(r);else{if(r!==o){throw Error(`Operands could not be broadcast together with shapes ${t} and ${e}.`)}n.unshift(r)}}return n}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
let Ab;function Cb(t,e){const n=t.shape.length,r=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==e.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${n}`);if(0===Kp(t.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const s=e.shape,o=s[s.length-1];let i=1;for(let t=0;t<s.length-1;++t)i*=s[t];const a=t.shape,u=s.slice();u.pop();let c=1;for(let t=o;t<n;++t)c*=a[t],u.push(a[t]);const l=[...ld(t.shape).map((t=>t/c)),1].slice(0,o);return[u,i,c,l]}function Ob(t,e,n){const r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${s}.`;if(n.rank<s)throw new Error(o+` update.rank < ${s}. `);if(t.length<r+(n.rank-s))throw new Error(o+` Output shape length < ${r+(n.rank-s)}`);if(n.rank!==s+t.length-r)throw new Error(o+" update.rank != "+(s+t.length-r));for(let t=0;t<s;++t)if(n.shape[t]!==e.shape[t])throw new Error(o+` updates.shape[${t}] (${n.shape[t]}) != indices.shape[${t}] (${e.shape[t]}).`);for(let e=0;e<n.rank-s;++e)if(n.shape[e+s]!==t[e+r])throw new Error(o+` updates.shape[${e+s}] (${n.shape[e+s]}) != shape[${e+s}] (${t[e+s]})`)}function Ib(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if("int32"!==e.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===e.size)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(0===t.size)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}Ob(n,e,t)}function Mb(t,e,n){const r=e.shape.length,s=r>1?e.shape[r-1]:1,o=n.length;let i=1;for(let t=s;t<o;++t)i*=n[t];const a=s<1?1:s;return{sliceRank:s,numUpdates:Kp(e.shape)/a,sliceSize:i,strides:[...ld(n.slice(0,s)),1],outputSize:Kp(n)}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({confusionMatrix_:function(t,e,n){const r=kg(t,"labels","confusionMatrix"),s=kg(e,"predictions","confusionMatrix");jp(null==n||n>0&&Number.isInteger(n),(()=>`If provided, numClasses must be a positive integer, but got ${n}`)),jp(1===r.rank,(()=>`Expected the rank of labels to be 1, but got ${r.rank}`)),jp(1===s.rank,(()=>`Expected the rank of predictions to be 1, but got ${s.rank}`)),jp(r.shape[0]===s.shape[0],(()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${s.shape[0]}. Labels and predictions should have the same number of elements.`)),jp(n>0&&Number.isInteger(n),(()=>`numClasses is required to be a positive integer, but got ${n}`));const o=bb(ub(r,"int32"),n),i=bb(ub(s,"int32"),n),a=Sb(o),u=gb(a,i);return ub(u,"int32")}}),Cg({fromPixels_:function(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,s=!1,o=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)s=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)o=!0;else if(null!=t.getContext)i=!0;else{if(!("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);a=!0}if(s){const e=2;if(s&&t.readyState<e)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=em("FromPixels",Ey.backendName)){const n={pixels:t},r={numChannels:e};return Ey.runKernel("FromPixels",n,r)}const[u,c]=s?[t.videoWidth,t.videoHeight]:[t.width,t.height];let l,f;if(i)l=t.getContext("2d").getImageData(0,0,u,c).data;else if(r||n)l=t.data;else if(o||s||a){if(null==Ab)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");Ab=new OffscreenCanvas(1,1).getContext("2d")}else Ab=document.createElement("canvas").getContext("2d");Ab.canvas.width=u,Ab.canvas.height=c,Ab.drawImage(t,0,0,u,c),l=Ab.getImageData(0,0,u,c).data}if(4===e)f=new Int32Array(l);else{const t=u*c;f=new Int32Array(t*e);for(let n=0;n<t;n++)for(let t=0;t<e;++t)f[n*e+t]=l[4*n+t]}return function(t,e,n){if(qp(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");const r=Sg(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Ig(t,e,r,n)}(f,[c,u,e],"int32")}});function Rb(t,e,n){const r=t.shape.length;jp(r===e.length,(()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`)),jp(r===n.length,(()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`));for(let s=0;s<r;++s)jp(e[s]+n[s]<=t.shape[s],(()=>`Error in slice${r}D: begin[${s}] + size[${s}] (${e[s]+n[s]}) would overflow input.shape[${s}] (${t.shape[s]})`))}function Db(t,e,n){const r=[];for(let s=0;s<t.length;s++)r[s]=Math.ceil((e[s]-t[s])/n[s]);return r}function Fb(t,e,n,r){const s=[...t];for(let t=s.length;t<r.length;t++)s.push(1);for(let t=0;t<n;t++)0===t?s[e]=1:(s.splice(e,0,1),s.pop());return s}function Lb(t,e,n){return n<=t?n:n-(e-1)}function Pb(t,e){const n=[];for(let r=0;r<t;r++)n.push(e+r);return n}function Bb(t,e,n,r,s){const o=[...s],i=Pb(n,e);for(let s=0;s<o.length;s++)if(i.indexOf(s)>-1)o[s]=0;else{const i=Lb(e,n,s);let a=r[i];t&1<<i&&(a=0),o[s]=a}return o}function Vb(t,e,n,r,s){const o=[...s],i=Pb(n,e);for(let s=0;s<o.length;s++)if(i.indexOf(s)>-1)o[s]=Number.MAX_SAFE_INTEGER;else{const i=Lb(e,n,s);let a=r[i];t&1<<i&&(a=Number.MAX_SAFE_INTEGER),o[s]=a}for(let t=0;t<o.length;t++){const e=s[t];o[t]<0&&(o[t]+=e),o[t]=zp(0,o[t],s[t])}return o}function zb(t,e,n){let r=t[e];return(n&1<<e||null==r)&&(r=1),r}function Wb(t,e,n,r,s,o){let i=e[s];const a=n[s]||1;(t&1<<s||o&1<<s||null==i)&&(i=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const u=r[s];return i<0&&(i+=u),i=zp(0,i,u-1),i}function Ub(t,e,n,r,s,o){let i=e[s];const a=n[s]||1;(t&1<<s||o&1<<s||null==i)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const u=r[s];return i<0&&(i+=u),i=a>0?zp(0,i,u):zp(-1,i,u-1),i}function jb(t,e,n){let r=n.length;for(let t=0;t<n.length;t++)if(n[t]>1){r=t;break}for(let s=r+1;s<n.length;s++)if(e[s]>0||n[s]!==t[s])return!1;return!0}function Gb(t,e){let n=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}function qb(t,e,n){let r;const s=t.shape.length;let o;return r="number"==typeof e?[e,...new Array(s-1).fill(0)]:e.length<s?e.concat(new Array(s-e.length).fill(0)):e.slice(),r.forEach((t=>{jp(-1!==t,(()=>"slice() does not support negative begin indexing."))})),o=null==n?new Array(s).fill(-1):"number"==typeof n?[n,...new Array(s-1).fill(-1)]:n.length<s?n.concat(new Array(s-n.length).fill(-1)):n,o=o.map(((e,n)=>e>=0?e:(jp(-1===e,(()=>`Negative size values should be exactly -1 but got ${e} for the slice() size at index ${n}.`)),t.shape[n]-r[n]))),[r,o]}function Hb(t,e,n,r,s,o,i,a,u){let c;if(null==r?(c=new Array(e.length),c.fill(1)):c=r,null!=i&&0!=(i&i-1))throw new Error("Multiple ellipses in slice is not allowed.");let l=!1;const f={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};for(let t=0;t<f.dims;t++)l&&0!=(1<<t&a)&&f.numAddAxisAfterEllipsis++,1<<t&i&&(l=!0);l||(f.ellipsisMask|=1<<f.dims,f.dims++);const h={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=null!=t.begin,e.endValid=null!=t.end,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<t.dims;r++)if(1<<r&t.ellipsisMask){const s=Math.min(e.dims-(t.dims-r)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<s;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&t.newAxisMask)e.finalShapeGatherIndices.push(-2),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);null!=t.begin&&(e.begin[n]=t.begin[r]),null!=t.end&&(e.end[n]=t.end[r]),e.strides[n]=t.strides[r],t.beginMask&1<<r&&(e.beginMask|=1<<n),t.endMask&1<<r&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(-1),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[n]=r,n++}}(f,h);let p=!0,d=!0,m=!0;const y=[],g=[];for(let e=0;e<t.length;++e){if(0===h.strides[e])throw Error(`strides[${e}] must be non-zero`);const n=!!(h.shrinkAxisMask&1<<e),r=t[e];if(-1===r){y.push(n?1:-1);continue}const s=[h.beginMask&1<<e,h.endMask&1<<e],o=[h.strides[e]>0?0:-1,h.strides[e]>0?r:r-1];if(n&&h.strides[e]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===h.strides[e];const i=!!(h.beginMask&1<<e&&h.endMask&1<<e);if(h.beginValid&&h.endValid){if(n){const t=h.begin[e]<0?r+h.begin[e]:h.begin[e];if(h.begin[e]=t,h.end[e]=h.begin[e]+1,t<0||t>=r)throw Error(`slice index ${h.begin[e]} of dimension ${e} out of bounds.`)}else h.begin[e]=Kb(h.begin[e],0,h.strides[e],r,s,o),h.end[e]=Kb(h.end[e],1,h.strides[e],r,s,o);const t=1===h.strides[e]&&0===h.begin[e]&&h.end[e]===r;p=p&&t,d=d&&(0===e&&1===h.strides[e]||t)}else p=p&&1===h.strides[e]&&i,d=d&&(0===e&&1===h.strides[e]||i);let a,u=!1;if(h.beginValid&&h.endValid?(a=h.end[e]-h.begin[e],u=!0):n?(a=1,u=!0):i&&r>=0&&(a=h.strides[e]<0?-r:r,u=!0),u){let t;t=0===a||a<0!=h.strides[e]<0?0:Math.trunc(a/h.strides[e])+(a%h.strides[e]!=0?1:0),y.push(t)}else y.push(-1)}for(let t=0;t<h.finalShapeGatherIndices.length;++t){const e=h.finalShapeGatherIndices[t];e>=0?g.push(y[e]):-2===e&&g.push(1)}const b=g.filter(((t,e)=>-2!==h.finalShapeGatherIndices[e]));return{finalShapeSparse:b,finalShape:g,isIdentity:p,sliceDim0:d,isSimpleSlice:m,begin:h.begin,end:h.end,strides:h.strides}}function Kb(t,e,n,r,s,o){if(s[e])return n>0?o[e]:o[e+1&1];{const e=t<0?r+t:t;return e<o[0]?o[0]:e>o[1]?o[1]:e}}var Xb=Object.freeze({__proto__:null,assertParamsValid:Rb,maskToAxes:function(t){const e=[];let n=0;for(;t>0;)1&t&&e.push(n),t/=2,n++;return e},computeOutShape:Db,stridesWithElidedDims:Fb,getNormalizedAxes:function(t,e,n,r,s,o,i,a,u){const c=t.length;let l=new Array(c),f=new Array(c),h=new Array(c);if(e.length&&n>0){const u=e[0],c=n+1;l=Bb(i,u,c,r,t),f=Vb(a,u,c,s,t),h=Fb(o,u,c,t)}else for(let e=0;e<c;e++)l[e]=Wb(i,r,o,t,e,u),f[e]=Ub(a,s,o,t,e,u),h[e]=zb(o,e,u);return{begin:l,end:f,strides:h}},startIndicesWithElidedDims:Bb,stopIndicesWithElidedDims:Vb,stridesForAxis:zb,startForAxis:Wb,stopForAxis:Ub,isSliceContinous:jb,computeFlatOffset:Gb,parseSliceParams:qb,sliceInfo:Hb});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jb{constructor(){this.classNameMap={}}static getMap(){return null==Jb.instance&&(Jb.instance=new Jb),Jb.instance}static register(t){Jb.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function Yb(t){jp(null!=t.className,(()=>"Class being registered does not have the static className property defined.")),jp("string"==typeof t.className,(()=>"className is required to be a string, but got type "+typeof t.className)),jp(t.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),Jb.register(t)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zb=Cg({add_:function(t,e){let n=kg(t,"a","add"),r=kg(e,"b","add");[n,r]=gy(n,r);const s={a:n,b:r};return Ey.runKernel("Add",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qb=Cg({floorDiv_:function(t,e){let n=kg(t,"a","floorDiv"),r=kg(e,"b","floorDiv");[n,r]=gy(n,r);const s={a:n,b:r};return Ey.runKernel("FloorDiv",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tw=Cg({div_:function(t,e){let n=kg(t,"a","div"),r=kg(e,"b","div");if([n,r]=gy(n,r),"int32"===n.dtype&&"int32"===r.dtype)return Qb(n,r);const s={a:n,b:r};return Ey.runKernel("RealDiv",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ew=Cg({mul_:function(t,e){let n=kg(t,"a","mul"),r=kg(e,"b","mul");[n,r]=gy(n,r);const s={a:n,b:r};return Ey.runKernel("Multiply",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nw=Cg({abs_:function(t){const e=kg(t,"x","abs");if("complex64"===e.dtype){const t={x:e};return Ey.runKernel("ComplexAbs",t)}{const t={x:e};return Ey.runKernel("Abs",t)}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function rw(t,e,n,r,s="NHWC",o){return iw(t,[...e,t[3]],n,o,r,null,null,mw(s))}function sw(t,e,n,r,s,o,i="channelsLast"){const[a,u]=cw(e);let c;if("channelsLast"===i)c=[a,u,t[3],t[3]];else{if("channelsFirst"!==i)throw new Error(`Unknown dataFormat ${i}`);c=[a,u,t[1],t[1]]}return iw(t,c,n,r,s,o,!1,i)}function ow(t,e,n,r,s,o,i="NDHWC"){const[a,u,c]=lw(e);let l,f;if("NDHWC"===i)f="channelsLast",l=[a,u,c,t[4],t[4]];else{if("NCDHW"!==i)throw new Error(`Unknown dataFormat ${i}`);f="channelsFirst",l=[a,u,c,t[1],t[1]]}return aw(t,l,n,r,s,!1,f,o)}function iw(t,e,n,r,s,o,i=!1,a="channelsLast"){let[u,c,l,f]=[-1,-1,-1,-1];if("channelsLast"===a)[u,c,l,f]=t;else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);[u,f,c,l]=t}const[h,p,,d]=e,[m,y]=cw(n),[g,b]=cw(r),w=fw(h,g),v=fw(p,b),{padInfo:x,outHeight:N,outWidth:$}=function(t,e,n,r,s,o,i,a,u){let c,l,f;if("number"==typeof t){c={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};const s=function(t,e,n,r,s){null==r&&(r=uw(t,e,n));const o=t[0],i=t[1],a=hw((o-e+2*r)/n+1,s),u=hw((i-e+2*r)/n+1,s);return[a,u]}([e,n],o,r,t,a);l=s[0],f=s[1]}else if("same"===t){l=Math.ceil(e/r),f=Math.ceil(n/s);const t=Math.max(0,(l-1)*r+o-e),a=Math.max(0,(f-1)*s+i-n),u=Math.floor(t/2),h=t-u,p=Math.floor(a/2);c={top:u,bottom:h,left:p,right:a-p,type:"SAME"}}else if("valid"===t)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-o+1)/r),f=Math.ceil((n-i+1)/s);else{if("object"!=typeof t)throw Error(`Unknown padding parameter: ${t}`);{const h="channelsLast"===u?t[1][0]:t[2][0],p="channelsLast"===u?t[1][1]:t[2][1],d="channelsLast"===u?t[2][0]:t[3][0],m="channelsLast"===u?t[2][1]:t[3][1];c={top:h,bottom:p,left:d,right:m,type:0===h&&0===p&&0===d&&0===m?"VALID":"EXPLICIT"},l=hw((e-o+h+p)/r+1,a),f=hw((n-i+d+m)/s+1,a)}}return{padInfo:c,outHeight:l,outWidth:f}}(s,c,l,m,y,w,v,o,a),E=i?d*f:d;let S;return"channelsFirst"===a?S=[u,E,N,$]:"channelsLast"===a&&(S=[u,N,$,E]),{batchSize:u,dataFormat:a,inHeight:c,inWidth:l,inChannels:f,outHeight:N,outWidth:$,outChannels:E,padInfo:x,strideHeight:m,strideWidth:y,filterHeight:h,filterWidth:p,effectiveFilterHeight:w,effectiveFilterWidth:v,dilationHeight:g,dilationWidth:b,inShape:t,outShape:S,filterShape:e}}function aw(t,e,n,r,s,o=!1,i="channelsLast",a){let[u,c,l,f,h]=[-1,-1,-1,-1,-1];if("channelsLast"===i)[u,c,l,f,h]=t;else{if("channelsFirst"!==i)throw new Error(`Unknown dataFormat ${i}`);[u,h,c,l,f]=t}const[p,d,m,,y]=e,[g,b,w]=lw(n),[v,x,N]=lw(r),$=fw(p,v),E=fw(d,x),S=fw(m,N),{padInfo:_,outDepth:T,outHeight:k,outWidth:A}=function(t,e,n,r,s,o,i,a,u,c,l){let f,h,p,d;if("number"==typeof t){f={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};const o=function(t,e,n,r,s,o){null==s&&(s=uw(t,e,r));const i=t[0],a=t[1],u=t[2],c=hw((i-e+2*s)/r+1,o),l=hw((a-e+2*s)/r+1,o),f=hw((u-e+2*s)/r+1,o);return[c,l,f,n]}([e,n,r,1],a,1,s,t,l);h=o[0],p=o[1],d=o[2]}else if("same"===t){h=Math.ceil(e/s),p=Math.ceil(n/o),d=Math.ceil(r/i);const t=(h-1)*s+a-e,l=(p-1)*o+u-n,m=(d-1)*i+c-r,y=Math.floor(t/2),g=t-y,b=Math.floor(l/2),w=l-b,v=Math.floor(m/2);f={top:b,bottom:w,left:v,right:m-v,front:y,back:g,type:"SAME"}}else{if("valid"!==t)throw Error(`Unknown padding parameter: ${t}`);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((e-a+1)/s),p=Math.ceil((n-u+1)/o),d=Math.ceil((r-c+1)/i)}return{padInfo:f,outDepth:h,outHeight:p,outWidth:d}}(s,c,l,f,g,b,w,$,E,S,a),C=o?y*h:y;let O;return"channelsFirst"===i?O=[u,C,T,k,A]:"channelsLast"===i&&(O=[u,T,k,A,C]),{batchSize:u,dataFormat:i,inDepth:c,inHeight:l,inWidth:f,inChannels:h,outDepth:T,outHeight:k,outWidth:A,outChannels:C,padInfo:_,strideDepth:g,strideHeight:b,strideWidth:w,filterDepth:p,filterHeight:d,filterWidth:m,effectiveFilterDepth:$,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationDepth:v,dilationHeight:x,dilationWidth:N,inShape:t,outShape:O,filterShape:e}}function uw(t,e,n,r=1){const s=fw(e,r);return Math.floor((t[0]*(n-1)-n+s)/2)}function cw(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function lw(t){return"number"==typeof t?[t,t,t]:t}function fw(t,e){return e<=1?t:t+(t-1)*(e-1)}function hw(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function pw(t){const[e,n,r]=cw(t);return 1===e&&1===n&&1===r}function dw(t,e){return pw(t)||pw(e)}function mw(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function yw(t,e,n){if(null!=n){if("string"==typeof e)throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if("number"==typeof e)jp(Jp(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`));else{if("object"!=typeof e)throw Error(`Error in ${t}: Unknown padding parameter: ${e}`);e.forEach((e=>{e.forEach((e=>{jp(Jp(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`))}))}))}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({acos_:function(t){const e={x:kg(t,"x","acos")};return Ey.runKernel("Acos",e)}}),Cg({acosh_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:kg(t,"x","acosh")};return Ey.runKernel("Acosh",e)}}),Cg({addN_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){jp(Array.isArray(t),(()=>"The argument passed to tf.addN() must be a list of tensors")),jp(t.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`));const e=t.map(((t,e)=>kg(t,`tensors${e}`,"addN"))),n=e[0];e.forEach((t=>{if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((t=>{if(!Xp(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const r=e;return Ey.runKernel("AddN",r)}}),Cg({all_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=null,n=!1){const r={x:kg(t,"x","all","bool")},s={axis:e,keepDims:n};return Ey.runKernel("All",r,s)}}),Cg({any_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=null,n=!1){const r={x:kg(t,"x","any","bool")},s={axis:e,keepDims:n};return Ey.runKernel("Any",r,s)}}),Cg({argMax_:
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0){const n={x:kg(t,"x","argMax")},r={axis:e};return Ey.runKernel("ArgMax",n,r)}}),Cg({argMin_:
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0){const n={x:kg(t,"x","argMin")},r={axis:e};return Ey.runKernel("ArgMin",n,r)}}),Cg({asin_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:kg(t,"x","asin")};return Ey.runKernel("Asin",e)}}),Cg({asinh_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:kg(t,"x","asinh")};return Ey.runKernel("Asinh",e)}}),Cg({atan_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:kg(t,"x","atan")};return Ey.runKernel("Atan",e)}}),Cg({atan2_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=kg(t,"a","atan2"),r=kg(e,"b","atan2");[n,r]=gy(n,r);const s={a:n,b:r};return Ey.runKernel("Atan2",s)}}),Cg({atanh_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:kg(t,"x","atanh")};return Ey.runKernel("Atanh",e)}});const gw=Cg({reshape_:function(t,e){const n={x:kg(t,"x","reshape","string_or_numeric")},r={shape:e};return Ey.runKernel("Reshape",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bw=Cg({avgPool_:function(t,e,n,r,s){const o=kg(t,"x","avgPool","float32");jp(dw(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let i=o,a=!1;3===o.rank&&(a=!0,i=gw(o,[1,o.shape[0],o.shape[1],o.shape[2]])),jp(4===i.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${i.rank}.`)),yw("avgPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s};let l=Ey.runKernel("AvgPool",u,c);return l=ub(l,o.dtype),a?gw(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({avgPool3d_:function(t,e,n,r,s,o="NDHWC"){const i=kg(t,"x","avgPool3d","float32");let a=i,u=!1;4===i.rank&&(u=!0,a=gw(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),jp(5===a.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`)),jp("NDHWC"===o,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),yw("avgPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o};let f=Ey.runKernel("AvgPool3D",c,l);return f=ub(f,a.dtype),u?gw(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});const ww=Cg({concat_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0){jp(t.length>=1,(()=>"Pass at least one tensor to concat"));const n=Ag(t,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((t=>{if("complex64"!==t.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${t.dtype}. `)})),1===n.length)return cb(n[0]);const r=n,s={axis:e};return Ey.runKernel("Concat",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vw=Cg({sigmoid_:function(t){const e={x:kg(t,"x","sigmoid","float32")};return Ey.runKernel("Sigmoid",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xw=Cg({slice_:function(t,e,n){const r=kg(t,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const s={x:r},o={begin:e,size:n};return Ey.runKernel("Slice",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nw=Cg({tanh_:function(t){const e={x:kg(t,"x","tanh","float32")};return Ey.runKernel("Tanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({basicLSTMCell_:function(t,e,n,r,s,o){const i=kg(t,"forgetBias","basicLSTMCell"),a=kg(e,"lstmKernel","basicLSTMCell"),u=kg(n,"lstmBias","basicLSTMCell"),c=kg(r,"data","basicLSTMCell"),l=kg(s,"c","basicLSTMCell"),f=kg(o,"h","basicLSTMCell"),h=ww([c,f],1),p=gb(h,a),d=Zb(p,u),m=d.shape[0],y=d.shape[1]/4,g=[m,y],b=xw(d,[0,0],g),w=xw(d,[0,y],g),v=xw(d,[0,2*y],g),x=xw(d,[0,3*y],g),N=Zb(ew(vw(b),Nw(w)),ew(l,vw(Zb(i,v))));return[N,ew(Nw(N),vw(x))]}});const $w=Cg({batchToSpaceND_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=kg(t,"x","batchToSpaceND"),s=e.reduce(((t,e)=>t*e));jp(r.rank>=1+e.length,(()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`)),jp(n.length===e.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`)),jp(r.shape[0]%s==0,(()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${s}`));const o={x:r},i={blockShape:e,crops:n};return Ey.runKernel("BatchToSpaceND",o,i)}});const Ew=Cg({batchNorm_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s,o){null==o&&(o=.001);const i=kg(t,"x","batchNorm"),a=kg(e,"mean","batchNorm"),u=kg(n,"variance","batchNorm");let c,l;null!=s&&(c=kg(s,"scale","batchNorm")),null!=r&&(l=kg(r,"offset","batchNorm")),jp(a.rank===u.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),jp(null==l||a.rank===l.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),jp(null==c||a.rank===c.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const f=function(t){let e;return e=0===t.rank||1===t.rank?gw(t,[1,1,1,t.size]):2===t.rank?gw(t,[1,1,t.shape[0],t.shape[1]]):3===t.rank?gw(t,[1,t.shape[0],t.shape[1],t.shape[2]]):t,e}(i),h={x:f,scale:c,offset:l,mean:a,variance:u},p={varianceEpsilon:o},d=Ey.runKernel("FusedBatchNorm",h,p);return gw(d,i.shape)}});Cg({batchNorm2d_:function(t,e,n,r,s,o){const i=kg(t,"x","batchNorm"),a=kg(e,"mean","batchNorm"),u=kg(n,"variance","batchNorm");let c,l;return null!=s&&(c=kg(s,"scale","batchNorm")),null!=r&&(l=kg(r,"offset","batchNorm")),jp(2===i.rank,(()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`)),jp(2===a.rank||1===a.rank,(()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`)),jp(2===u.rank||1===u.rank,(()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`)),null!=c&&jp(2===c.rank||1===c.rank,(()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`)),null!=l&&jp(2===l.rank||1===l.rank,(()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${l.rank}.`)),Ew(i,a,u,l,c,o)}}),Cg({batchNorm3d_:function(t,e,n,r,s,o){const i=kg(t,"x","batchNorm"),a=kg(e,"mean","batchNorm"),u=kg(n,"variance","batchNorm");let c,l;return null!=s&&(c=kg(s,"scale","batchNorm")),null!=r&&(l=kg(r,"offset","batchNorm")),jp(3===i.rank,(()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`)),jp(3===a.rank||1===a.rank,(()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`)),jp(3===u.rank||1===u.rank,(()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`)),null!=c&&jp(3===c.rank||1===c.rank,(()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`)),null!=l&&jp(3===l.rank||1===l.rank,(()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${l.rank}.`)),Ew(i,a,u,l,c,o)}}),Cg({batchNorm4d_:function(t,e,n,r,s,o){const i=kg(t,"x","batchNorm"),a=kg(e,"mean","batchNorm"),u=kg(n,"variance","batchNorm");let c,l;return null!=s&&(c=kg(s,"scale","batchNorm")),null!=r&&(l=kg(r,"offset","batchNorm")),jp(4===i.rank,(()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`)),jp(4===a.rank||1===a.rank,(()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`)),jp(4===u.rank||1===u.rank,(()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`)),null!=c&&jp(4===c.rank||1===c.rank,(()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`)),null!=l&&jp(4===l.rank||1===l.rank,(()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${l.rank}.`)),Ew(i,a,u,l,c,o)}});const Sw=Cg({bincount_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=kg(t,"x","bincount"),s=kg(e,"weights","bincount");jp("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),jp(n>=0,(()=>`size must be non-negative, but got ${n}.`)),jp(s.size===r.size||0===s.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${s.shape}.`));const o={x:r,weights:s},i={size:n};return Ey.runKernel("Bincount",o,i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({broadcastArgs_:function(t,e){const n=kg(t,"s0","broadcastArgs","int32"),r=kg(e,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(1!==r.rank)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const s={s0:n,s1:r};return Ey.runKernel("BroadcastArgs",s)}});const _w=Cg({broadcastTo_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=kg(t,"broadcastTo","x");const r=n.shape;if(e.some((t=>!(t>0)||t%1!=0)))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const t=n.shape.slice();for(;t.length<e.length;)t.unshift(1);n=gw(n,t)}const s=n.shape,o=Array.from(e);for(let t=e.length-1;t>=0;t--)if(s[t]===e[t])o[t]=1;else if(1!==n.shape[t])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);const i=o.map(((t,e)=>t>1?e:-1)).filter((t=>t>=0));if(0===i.length)return cb(n);const a={x:n},u={reps:o};return Ey.runKernel("Tile",a,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({ceil_:function(t){const e={x:kg(t,"x","ceil","float32")};return Ey.runKernel("Ceil",e)}}),Cg({clipByValue_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=kg(t,"x","clipByValue");jp(e<=n,(()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`));const s={x:r},o={clipValueMin:e,clipValueMax:n};return Ey.runKernel("ClipByValue",s,o)}}),Cg({concat1d_:function(t){return ww(t,0)}}),Cg({concat2d_:function(t,e){return ww(t,e)}}),Cg({concat3d_:function(t,e){return ww(t,e)}}),Cg({concat4d_:function(t,e){return ww(t,e)}});const Tw=Cg({conv2d_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s="NHWC",o=[1,1],i){const a=kg(t,"x","conv2d","float32"),u=kg(e,"filter","conv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=gw(a,[1,a.shape[0],a.shape[1],a.shape[2]])),jp(4===c.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`)),jp(4===u.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`)),yw("conv2d",r,i);const f="NHWC"===s?c.shape[3]:c.shape[1];jp(f===u.shape[2],(()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`)),jp(dw(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const h={x:c,filter:u},p={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},d=Ey.runKernel("Conv2D",h,p);return l?gw(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});Cg({conv1d_:function(t,e,n,r,s="NWC",o=1,i){const a=kg(t,"x","conv1d"),u=kg(e,"filter","conv1d");let c=a,l=!1;2===a.rank&&(l=!0,c=gw(a,[1,a.shape[0],a.shape[1]])),jp(3===c.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`)),jp(3===u.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`)),yw("conv1d",r,i),jp(c.shape[2]===u.shape[1],(()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`)),jp(dw(n,o),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${o}'`)),jp("NWC"===s,(()=>`Error in conv1d: got dataFormat of ${s} but only NWC is currently supported.`));const f=gw(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=gw(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=Tw(h,f,[1,n],r,"NHWC",[1,o],i);return gw(p,l?[p.shape[2],p.shape[3]]:[p.shape[0],p.shape[2],p.shape[3]])}});const kw=Cg({conv2DBackpropInput_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s,o="NHWC",i){jp(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let a=t,u=e,c=!1;3===e.rank&&(c=!0,u=gw(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),jp(4===a.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`)),jp(4===u.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`)),jp(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const l="NHWC"===o?a[3]:a[1],f="NHWC"===o?u.shape[3]:u.shape[1];jp(l===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[2]}.`)),jp(f===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${n.shape[3]}.`)),yw("conv2dDerInput",s,i);const h={dy:u,filter:n},p={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,inputShape:a},d=Ey.runKernel("Conv2DBackpropInput",h,p);return c?gw(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});Cg({conv2dTranspose_:function(t,e,n,r,s,o){const i=kg(t,"x","conv2dTranspose"),a=kg(e,"filter","conv2dTranspose");return kw(n,i,a,r,s,"NHWC",o)}}),Cg({conv3d_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s="NDHWC",o=[1,1,1]){const i=kg(t,"x","conv3d"),a=kg(e,"filter","conv3d");let u=i,c=!1;4===i.rank&&(c=!0,u=gw(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),jp(5===u.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`)),jp(5===a.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`)),jp(u.shape[4]===a.shape[3],(()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${a.shape[3]}.`)),jp(dw(n,o),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),jp("NDHWC"===s,(()=>`Error in conv3d: got dataFormat of ${s} but only NDHWC is currently supported.`));const l={x:u,filter:a},f={strides:n,pad:r,dataFormat:s,dilations:o},h=Ey.runKernel("Conv3D",l,f);return c?gw(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});const Aw=Cg({conv3DBackpropInput_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s){jp(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let o=t,i=e,a=!1;4===e.rank&&(a=!0,i=gw(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,t[0],t[1],t[2],t[3]]);const u=o[4],c=i.shape[4];jp(5===o.length,(()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`)),jp(5===i.rank,(()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`)),jp(5===n.rank,(()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`)),jp(u===n.shape[3],(()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[3]}.`)),jp(c===n.shape[4],(()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`));const l={dy:i,filter:n},f={pad:s,strides:r,inputShape:o},h=Ey.runKernel("Conv3DBackpropInputV2",l,f);return a?gw(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});Cg({conv3dTranspose_:function(t,e,n,r,s){const o=kg(t,"x","conv3dTranspose"),i=kg(e,"filter","conv3dTranspose");return Aw(n,o,i,r,s)}}),Cg({cos_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:kg(t,"x","cos","float32")};return Ey.runKernel("Cos",e)}}),Cg({cosh_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:kg(t,"x","cosh","float32")};return Ey.runKernel("Cosh",e)}}),Cg({cumprod_:
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0,n=!1,r=!1){const s={x:kg(t,"x","cumprod")},o={axis:e,exclusive:n,reverse:r};return Ey.runKernel("Cumprod",s,o)}}),Cg({cumsum_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0,n=!1,r=!1){const s={x:kg(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:r};return Ey.runKernel("Cumsum",s,o)}}),Cg({denseBincount_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=!1){const s=kg(t,"x","denseBincount"),o=kg(e,"weights","denseBincount");jp("int32"===s.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${s.dtype}`)),jp(s.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${s.rank}.`)),jp(n>=0,(()=>`size must be non-negative, but got ${n}.`)),jp(o.size===s.size||0===o.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${s.shape}, weights shape: ${o.shape}.`));const i={x:s,weights:o},a={size:n,binaryOutput:r};return Ey.runKernel("DenseBincount",i,a)}}),Cg({depthToSpace_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n="NHWC"){const r=kg(t,"x","depthToSpace","float32"),s="NHWC"===n?r.shape[1]:r.shape[2],o="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];jp(e>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`)),jp(s*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${s} and ${e}  for depthToSpace with input shape\n    ${r.shape}`)),jp(o*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${o} and ${e} for depthToSpace with input shape\n        ${r.shape}`)),jp(i%(e*e)==0,(()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${r.shape}`));const a={x:r},u={blockSize:e,dataFormat:n};return Ey.runKernel("DepthToSpace",a,u)}});const Cw=Cg({depthwiseConv2d_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s="NHWC",o=[1,1],i){const a=kg(t,"x","depthwiseConv2d","float32"),u=kg(e,"filter","depthwiseConv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=gw(a,[1,a.shape[0],a.shape[1],a.shape[2]])),jp(4===c.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`)),jp(4===u.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`)),jp(c.shape[3]===u.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`)),yw("depthwiseConv2d",r,i);const f={x:c,filter:u},h={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},p=Ey.runKernel("DepthwiseConv2dNative",f,h);return l?gw(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({diag_:function(t){const e={x:kg(t,"x","diag")};return Ey.runKernel("Diag",e)}}),Cg({dilation2d_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s=[1,1],o="NHWC"){const i=kg(t,"x","dilation2d"),a=kg(e,"filter","dilation2d");jp(3===i.rank||4===i.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`)),jp(3===a.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`)),jp("NHWC"===o,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`));let u=i,c=!1;3===i.rank&&(u=gw(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=!0);const l={x:u,filter:a},f={strides:n,pad:r,dilations:s},h=Ey.runKernel("Dilation2D",l,f);return c?gw(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});const Ow=Cg({equal_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=kg(t,"a","equal","string_or_numeric"),r=kg(e,"b","equal","string_or_numeric");[n,r]=gy(n,r),kb(n.shape,r.shape);const s={a:n,b:r};return Ey.runKernel("Equal",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iw=Cg({where_:function(t,e,n){const r=kg(e,"a","where"),s=kg(n,"b","where"),o=kg(t,"condition","where","bool"),i=kb(kb(o.shape,r.shape),s.shape),a={condition:_w(o,i),t:_w(r,i),e:_w(s,i)};return Ey.runKernel("Select",a)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mw=Cg({zerosLike_:function(t){const e={x:kg(t,"x","zerosLike")};return Ey.runKernel("ZerosLike",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({divNoNan_:function(t,e){let n=kg(t,"a","div"),r=kg(e,"b","div");[n,r]=gy(n,r);const s=tw(n,r),o=Mw(s),i=Ow(r,o);return Iw(i,o,s)}}),Cg({dot_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=kg(t,"t1","dot"),r=kg(e,"t2","dot");jp(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`));const s=1===n.rank?n.size:n.shape[1],o=1===r.rank?r.size:r.shape[0];if(jp(s===o,(()=>`Error in dot: inner dimensions of inputs must match, but got ${s} and ${o}.`)),1===n.rank&&1===r.rank){const t=gw(n,[1,-1]),e=gw(r,[-1,1]),s=gb(t,e);return gw(s,[])}if(1===n.rank&&2===r.rank){const t=gw(n,[1,-1]),e=gw(r,[r.shape[0],r.shape[1]]),s=gb(t,e);return gw(s,[s.size])}if(2===n.rank&&1===r.rank){const t=gw(r,[-1,1]),e=gb(n,t);return gw(e,[e.size])}{const t=gw(r,[r.shape[0],r.shape[1]]);return gb(n,t)}}}),Cg({einsum_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,...e){const n=e.map(((t,e)=>kg(t,`tensors${e}`,"einsum"))),r={equation:t};return Ey.runKernel("Einsum",n,r)}});const Rw=Cg({elu_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:kg(t,"x","elu","float32")};return Ey.runKernel("Elu",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Dw(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function Fw(t,e,n){const r=t.length+e.length,s=[];let o=0,i=0;for(let a=0;a<r;a++)-1===n.indexOf(a)?s.push(t[o++]):s.push(e[i++]);return s}function Lw(t,e){const n=[],r=t.length;for(let s=0;s<r;s++)-1===e.indexOf(s)&&n.push(t[s]);return[n,e.map((e=>t[e]))]}function Pw(t,e){return Fw(t,e.map((t=>1)),e)}function Bw(t,e,n){jp(Dw(e,n),(()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`))}function Vw(t,e){if(Dw(t,e))return null;const n=[];for(let r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach((t=>n.push(t))),n}function zw(t){return t.map(((t,e)=>[e,t])).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]))}function Ww(t,e){const n=[];for(let r=e-t;r<e;++r)n.push(r);return n}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({erf_:function(t){let e=kg(t,"x","erf");jp("int32"===e.dtype||"float32"===e.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===e.dtype&&(e=ub(e,"float32"));const n={x:e};return Ey.runKernel("Erf",n)}});const Uw=Cg({max_:function(t,e=null,n=!1){const r={x:kg(t,"x","max")},s={reductionIndices:e,keepDims:n};return Ey.runKernel("Max",r,s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jw=Cg({min_:function(t,e=null,n=!1){const r={x:kg(t,"x","min")},s={axis:e,keepDims:n};return Ey.runKernel("Min",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gw=Cg({pow_:function(t,e){let n=kg(t,"base","pow"),r=kg(e,"exp","pow");[n,r]=gy(n,r);const s={a:n,b:r};return Ey.runKernel("Pow",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qw(t,e){if((sd(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&sd(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Ig(t,[],[],e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hw=Cg({sqrt_:function(t){const e={x:kg(t,"x","sqrt","float32")};return Ey.runKernel("Sqrt",e)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kw=Cg({square_:function(t){const e=kg(t,"x","square");return Ey.runKernel("Square",{x:e},{})}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xw=Cg({sum_:function(t,e=null,n=!1){let r=kg(t,"x","sum");"bool"===r.dtype&&(r=ub(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return Ey.runKernel("Sum",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jw(t,e,n=null){if(0===t.rank)return nw(t);if(1!==t.rank&&null===n)return Jw(gw(t,[-1]),e,n);if(1===t.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===e)return Xw(nw(t),n);if(e===1/0)return Uw(nw(t),n);if(e===-1/0)return jw(nw(t),n);if("euclidean"===e||2===e)return Hw(Xw(Gw(nw(t),qw(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&2===n.length){if(1===e)return Uw(Xw(nw(t),n[0]),n[1]-1);if(e===1/0)return Uw(Xw(nw(t),n[1]),n[0]);if(e===-1/0)return jw(Xw(nw(t),n[1]),n[0]);if("fro"===e||"euclidean"===e)return Hw(Xw(Kw(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const Yw=Cg({norm_:function(t,e="euclidean",n=null,r=!1){const s=Jw(t=kg(t,"x","norm"),e,n);let o=s.shape;if(r){const e=td(n,t.shape);o=Pw(s.shape,e)}return gw(s,o)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({euclideanNorm_:function(t,e=null,n=!1){return Yw(t,"euclidean",e,n)}});const Zw=Cg({exp_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:kg(t,"x","exp")};return Ey.runKernel("Exp",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qw=Cg({expandDims_:function(t,e=0){const n=kg(t,"x","expandDims","string_or_numeric");jp(e<=n.rank,(()=>"Axis must be <= rank of the tensor"));const r={input:n},s={dim:e};return Ey.runKernel("ExpandDims",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({expm1_:function(t){const e={x:kg(t,"x","expm1")};return Ey.runKernel("Expm1",e)}});const tv=Cg({tile_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=kg(t,"x","tile","string_or_numeric");jp(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`));const r={x:n},s={reps:e};return Ey.runKernel("Tile",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ev=Cg({eye_:function(t,e,n,r="float32"){null==e&&(e=t);const s=ab([t,e],r),o=t<=e?t:e;for(let t=0;t<o;++t)s.set(1,t,t);const i=gw(s.toTensor(),[t,e]);if(null==n)return i;if(1===n.length)return tv(Qw(i,0),[n[0],1,1]);if(2===n.length)return tv(Qw(Qw(i,0),0),[n[0],n[1],1,1]);if(3===n.length)return tv(Qw(Qw(Qw(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nv(t,e,n){const r={shape:t,value:e,dtype:n};return Ey.runKernel("Fill",{},r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rv=Cg({floor_:function(t){const e={x:kg(t,"x","floor","float32")};return Ey.runKernel("Floor",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({gather_:function(t,e,n=0,r=0){const s={x:kg(t,"x","gather"),indices:kg(e,"indices","gather","int32")},o={axis:n,batchDims:r};return Ey.runKernel("GatherV2",s,o)}});const sv=Cg({greater_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=kg(t,"a","greater","string_or_numeric"),r=kg(e,"b","greater","string_or_numeric");[n,r]=gy(n,r),kb(n.shape,r.shape);const s={a:n,b:r};return Ey.runKernel("Greater",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ov=Cg({greaterEqual_:function(t,e){let n=kg(t,"a","greaterEqual","string_or_numeric"),r=kg(e,"b","greaterEqual","string_or_numeric");[n,r]=gy(n,r),kb(n.shape,r.shape);const s={a:n,b:r};return Ey.runKernel("GreaterEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({isFinite_:function(t){const e={x:kg(t,"x","isFinite")};return Ey.runKernel("IsFinite",e)}}),Cg({isInf_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:kg(t,"x","isInf")};return Ey.runKernel("IsInf",e)}}),Cg({isNaN_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:kg(t,"x","isNaN")};return Ey.runKernel("IsNan",e)}});const iv=Cg({leakyRelu_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=.2){const n={x:kg(t,"x","leakyRelu")},r={alpha:e};return Ey.runKernel("LeakyRelu",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({less_:function(t,e){let n=kg(t,"a","less","string_or_numeric"),r=kg(e,"b","less","string_or_numeric");[n,r]=gy(n,r),kb(n.shape,r.shape);const s={a:n,b:r};return Ey.runKernel("Less",s)}});const av=Cg({lessEqual_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=kg(t,"a","lessEqual","string_or_numeric"),r=kg(e,"b","lessEqual","string_or_numeric");[n,r]=gy(n,r),kb(n.shape,r.shape);const s={a:n,b:r};return Ey.runKernel("LessEqual",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({localResponseNormalization_:function(t,e=5,n=1,r=1,s=.5){const o=kg(t,"x","localResponseNormalization");jp(4===o.rank||3===o.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${o.rank}.`)),jp(Jp(e),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`));let i=o,a=!1;3===o.rank&&(a=!0,i=gw(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const u={x:i},c={depthRadius:e,bias:n,alpha:r,beta:s},l=Ey.runKernel("LRN",u,c);return a?gw(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});const uv=Cg({log_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:kg(t,"x","log","float32")};return Ey.runKernel("Log",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cv=Cg({log1p_:function(t){const e={x:kg(t,"x","log1p")};return Ey.runKernel("Log1p",e)}});function lv(t){return Ey.customGrad(t)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fv=Cg({softplus_:function(t){const e={x:kg(t,"x","softplus")};return Ey.runKernel("Softplus",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({logSigmoid_:function(t){const e=kg(t,"x","logSigmoid"),n=lv((t=>({value:$b(fv($b(t))),gradFunc:e=>ew(e,vw($b(t)))})));return n(e)}});const hv=Cg({sub_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=kg(t,"a","sub"),r=kg(e,"b","sub");[n,r]=gy(n,r);const s={a:n,b:r};return Ey.runKernel("Sub",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({logSoftmax_:function(t,e=-1){const n=kg(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);const r=lv(((t,n)=>{const r=Uw(t,e,!0),s=hv(t,r),o=hv(ub(s,"float32"),uv(Xw(Zw(s),e,!0)));n([o]);return{value:o,gradFunc:(t,n)=>{const[r]=n,s=Zw(r);return hv(t,ew(Xw(t,e,!0),s))}}}));return r(n)}});const pv=Cg({logSumExp_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=null,n=!1){const r=kg(t,"x","logSumExp"),s=td(e,r.shape),o=Uw(r,s,!0),i=hv(r,o),a=Zw(i),u=Xw(a,s),c=uv(u),l=Zb(gw(o,c.shape),c);if(n){const t=Pw(l.shape,s);return gw(l,t)}return l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dv=Cg({logicalAnd_:function(t,e){const n=kg(t,"a","logicalAnd","bool"),r=kg(e,"b","logicalAnd","bool");kb(n.shape,r.shape);const s={a:n,b:r};return Ey.runKernel("LogicalAnd",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mv=Cg({logicalNot_:function(t){const e={x:kg(t,"x","logicalNot","bool")};return Ey.runKernel("LogicalNot",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yv=Cg({logicalOr_:function(t,e){const n=kg(t,"a","logicalOr","bool"),r=kg(e,"b","logicalOr","bool");kb(n.shape,r.shape);const s={a:n,b:r};return Ey.runKernel("LogicalOr",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({logicalXor_:function(t,e){const n=kg(t,"a","logicalXor","bool"),r=kg(e,"b","logicalXor","bool");return kb(n.shape,r.shape),dv(yv(t,e),mv(dv(t,e)))}});Cg({searchSorted_:function(t,e,n="left"){const r=kg(t,"sortedSequence","searchSorted"),s=kg(e,"values","searchSorted"),o=r.shape[r.shape.length-1],i=s.shape[s.shape.length-1],a=gw(r,[-1,o]),u=gw(s,[-1,i]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Kp(u.shape)>=2147483648)throw new Error("values tensor size must less than 2147483648");if(a.shape[1]>=2147483648)throw new Error(`trailing dim_size must less than 2147483648 for int32 output type, was ${a.shape[1]}`);const c={sortedSequence:a,values:u},l={side:n};return Ey.runKernel("SearchSorted",c,l)}});const gv=Cg({maxPool_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s){const o=kg(t,"x","maxPool");let i=o,a=!1;3===o.rank&&(a=!0,i=gw(o,[1,o.shape[0],o.shape[1],o.shape[2]])),jp(4===i.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${i.rank}.`)),jp(dw(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),yw("maxPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s},l=Ey.runKernel("MaxPool",u,c);return a?gw(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({maxPool3d_:function(t,e=[1,1,1],n,r,s,o="NDHWC"){const i=kg(t,"x","maxPool3d");let a=i,u=!1;4===i.rank&&(u=!0,a=gw(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),jp(5===a.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`)),jp("NDHWC"===o,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),yw("maxPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o},f=Ey.runKernel("MaxPool3D",c,l);return u?gw(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}}),Cg({maxPoolWithArgmax_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s=!1){const o={x:kg(t,"x","maxPoolWithArgmax")},i={filterSize:e,strides:n,pad:r,includeBatchInIndex:s},a=Ey.runKernel("MaxPoolWithArgmax",o,i);return{result:a[0],indexes:a[1]}}});const bv=Cg({maximum_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=kg(t,"a","maximum"),r=kg(e,"b","maximum");[n,r]=gy(n,r),"bool"===n.dtype&&(n=ub(n,"int32"),r=ub(r,"int32")),kb(n.shape,r.shape);const s={a:n,b:r};return Ey.runKernel("Maximum",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wv=Cg({mean_:function(t,e=null,n=!1){const r={x:kg(t,"x","mean")},s={axis:e,keepDims:n};return Ey.runKernel("Mean",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vv(t,e="float32"){if("complex64"===e){const e=vv(t,"float32"),n=vv(t,"float32");return Og(e,n)}const n=dd(Kp(t),e);return Ey.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xv(t,e="float32"){if("complex64"===e){const e=xv(t,"float32"),n=vv(t,"float32");return Og(e,n)}const n=pd(Kp(t),e);return Ey.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nv=Cg({minimum_:function(t,e){let n=kg(t,"a","minimum"),r=kg(e,"b","minimum");[n,r]=gy(n,r),"bool"===n.dtype&&(n=ub(n,"int32"),r=ub(r,"int32")),kb(n.shape,r.shape);const s={a:n,b:r};return Ey.runKernel("Minimum",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({mirrorPad_:function(t,e,n){jp("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const r=kg(t,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");jp(e.length===r.rank,(()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`));const s="reflect"===n?1:0;for(let t=0;t<r.rank;t++)jp(2===e[t].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),jp(e[t][0]>=0&&e[t][0]<=r.shape[t]-s&&e[t][1]>=0&&e[t][1]<=r.shape[t]-s,(()=>`Padding in dimension ${t} cannot be greater than or equal to ${r.shape[t]-s} or less than 0 for input of shape ${r.shape}`));const o={paddings:e,mode:n},i={x:r};return Ey.runKernel("MirrorPad",i,o)}}),Cg({mod_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=kg(t,"a","mod"),r=kg(e,"b","mod");[n,r]=gy(n,r);const s={a:n,b:r};return Ey.runKernel("Mod",s)}}),Cg({moments_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=null,n=!1){const r=td(e,(t=kg(t,"x","moments")).shape),s=wv(t,r,n);let o=s.shape;n||(o=Pw(s.shape,r));const i=Kw(hv(ub(t,"float32"),gw(s,o)));return{mean:s,variance:wv(i,r,n)}}}),Cg({multiRNNCell_:function(t,e,n,r){const s=kg(e,"data","multiRNNCell"),o=Ag(n,"c","multiRNNCell"),i=Ag(r,"h","multiRNNCell");let a=s;const u=[];for(let e=0;e<t.length;e++){const n=t[e](a,o[e],i[e]);u.push(n[0]),u.push(n[1]),a=n[1]}const c=[],l=[];for(let t=0;t<u.length;t+=2)c.push(u[t]),l.push(u[t+1]);return[c,l]}}),Cg({multinomial_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=!1){const s=kg(t,"logits","multinomial"),o=s.size,i=s.rank;if(o<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${o}.`);if(i>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${i}`);n=n||Math.random();const a={logits:1===i?gw(s,[1,-1]):s},u={numSamples:e,seed:n,normalized:r},c=Ey.runKernel("Multinomial",a,u);return 1===i?gw(c,[c.size]):c}});const $v=Cg({notEqual_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=kg(t,"a","notEqual","string_or_numeric"),r=kg(e,"b","notEqual","string_or_numeric");[n,r]=gy(n,r),kb(n.shape,r.shape);const s={a:n,b:r};return Ey.runKernel("NotEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({onesLike_:function(t){const e={x:kg(t,"x","onesLike")};return Ey.runKernel("OnesLike",e)}}),Cg({outerProduct_:function(t,e){const n=kg(t,"v1","outerProduct"),r=kg(e,"v2","outerProduct");jp(1===n.rank&&1===r.rank,(()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`));const s=gw(n,[-1,1]),o=gw(r,[1,-1]);return gb(s,o)}});const Ev=Cg({pad_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n=0){const r=kg(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:n},o={x:r};return Ey.runKernel("PadV2",o,s)}});Cg({pad1d_:function(t,e,n=0){return jp(2===e.length,(()=>"Invalid number of paddings. Must be length of 2.")),Ev(t,[e],n)}}),Cg({pad2d_:function(t,e,n=0){return jp(2===e.length&&2===e[0].length&&2===e[1].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),Ev(t,e,n)}}),Cg({pad3d_:function(t,e,n=0){return jp(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),Ev(t,e,n)}}),Cg({pad4d_:function(t,e,n=0){return jp(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),Ev(t,e,n)}});const Sv=Cg({spaceToBatchND_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=kg(t,"x","spaceToBatchND");jp(r.rank>=1+e.length,(()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`)),jp(n.length===e.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`)),jp(r.shape.reduce(((t,r,s)=>s>0&&s<=e.length?t&&(r+n[s-1][0]+n[s-1][1])%e[s-1]==0:t),!0),(()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`));const s={x:r},o={blockShape:e,paddings:n};return Ey.runKernel("SpaceToBatchND",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({pool_:function(t,e,n,r,s,o,i){null==s&&(s=[1,1]),null==o&&(o=1),0===r&&(r="valid");const a=kg(t,"x","maxPool");let u=a,c=!1;3===a.rank&&(c=!0,u=gw(a,[1,a.shape[0],a.shape[1],a.shape[2]])),jp(dw(o,s),(()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${s}'`));const l=sw(u.shape,e,o,s,r),f=[l.dilationHeight,l.dilationWidth];let h;h="same"===r?function(t,e){const n=t.map(((t,n)=>t+(t-1)*(e[n]-1))),r=n.map((t=>t-1)),s=r.map((t=>Math.floor(t/2))),o=r.map(((t,e)=>t-s[e]));return r.map(((t,e)=>[s[e],o[e]]))}([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];const p=1===f[0]&&1===f[1],[d,m]=function(t,e,n){const r=n.map((t=>t[0])),s=n.map((t=>t[1])),o=t.concat(r,s),i=e.map(((t,e)=>(t-o[e]%t)%t)),a=s.map(((t,e)=>t+i[e])),u=e.map(((t,e)=>[r[e],a[e]])),c=e.map(((t,e)=>[0,i[e]]));return[u,c]}([l.inHeight,l.inWidth],f,h),y=p?r:"valid",g=p?u:Sv(u,f,d),b=("avg"===n?()=>bw(g,e,o,y,i):()=>gv(g,e,o,y,i))(),w=p?b:$w(b,f,m);return c?gw(w,[w.shape[1],w.shape[2],w.shape[3]]):w}});const _v=Cg({prelu_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n={x:kg(t,"x","prelu"),alpha:kg(e,"alpha","prelu")};return Ey.runKernel("Prelu",n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({prod_:function(t,e=null,n=!1){let r=kg(t,"x","prod");"bool"===r.dtype&&(r=ub(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return Ey.runKernel("Prod",s,o)}}),Cg({rand_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=Kp(t);let s=null;if(null==n||"float32"===n)s=new Float32Array(r);else if("int32"===n)s=new Int32Array(r);else{if("bool"!==n)throw new Error(`Unknown data type ${n}`);s=new Uint8Array(r)}for(let t=0;t<r;t++)s[t]=e();return Ey.makeTensor(s,t,n)}});var Tv={exports:{}};!function(t,e,n){function r(t){var e=this,n=function(){var t=4022871197,e=function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)};return e}();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}function s(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var n=new r(t),o=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.alea=o}(0,Tv,!1);var kv=im(Lp({__proto__:null,default:Tv.exports},[Tv.exports])),Av={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor128=o}(0,Av,!1);var Cv=im(Lp({__proto__:null,default:Av.exports},[Av.exports])),Ov={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorwow=o}(0,Ov,!1);var Iv=im(Lp({__proto__:null,default:Ov.exports},[Ov.exports])),Mv={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,s=e.i;return t=r[s],n=(t^=t>>>7)^t<<24,n^=(t=r[s+1&7])^t>>>10,n^=(t=r[s+3&7])^t>>>3,n^=(t=r[s+4&7])^t<<7,t=r[s+7&7],n^=(t^=t<<13)^t<<9,r[s]=n,e.i=s+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function s(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.x&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorshift7=o}(0,Mv,!1);var Rv=im(Lp({__proto__:null,default:Mv.exports},[Mv.exports])),Dv={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,s=e.X,o=e.i;return e.w=r=r+1640531527|0,n=s[o+34&127],t=s[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=s[o]=n^t,e.i=o,n+(r^r>>>16)|0},function(t,e){var n,r,s,o,i,a=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),s=0,o=-32;o<u;++o)e&&(r^=e.charCodeAt((o+32)%e.length)),0===o&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(i=i+1640531527|0,s=0==(n=a[127&o]^=r+i)?s+1:0);for(s>=128&&(a[127&(e&&e.length||0)]=-1),s=127,o=512;o>0;--o)r=a[s+34&127],n=a[s=s+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,a[s]=r^n;t.w=i,t.X=a,t.i=s}(e,t)}function s(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.X&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor4096=o}(0,Dv,!1);var Fv=im(Lp({__proto__:null,default:Dv.exports},[Dv.exports])),Lv={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,s=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^s,s=s-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^s,e.a=s-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.tychei=o}(0,Lv,!1);var Pv=im(Lp({__proto__:null,default:Lv.exports},[Lv.exports])),Bv={exports:{}};!function(t){!function(e,n){var r,s=this,o=256,i=n.pow(o,6),a=n.pow(2,52),u=2*a,c=255;function l(t,c,l){var y=[],g=d(p((c=1==c?{entropy:!0}:c||{}).entropy?[t,m(e)]:null==t?function(){try{var t;return r&&(t=r.randomBytes)?t=t(o):(t=new Uint8Array(o),(s.crypto||s.msCrypto).getRandomValues(t)),m(t)}catch(t){var n=s.navigator,i=n&&n.plugins;return[+new Date,s,i,s.screen,m(e)]}}():t,3),y),b=new f(y),w=function(){for(var t=b.g(6),e=i,n=0;t<a;)t=(t+n)*o,e*=o,n=b.g(1);for(;t>=u;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,d(m(b.S),e),(c.pass||l||function(t,e,r,s){return s&&(s.S&&h(s,b),t.state=function(){return h(b,{})}),r?(n.random=t,e):t})(w,g,"global"in c?c.global:this==n,c.state)}function f(t){var e,n=t.length,r=this,s=0,i=r.i=r.j=0,a=r.S=[];for(n||(t=[n++]);s<o;)a[s]=s++;for(s=0;s<o;s++)a[s]=a[i=c&i+t[s%n]+(e=a[s])],a[i]=e;(r.g=function(t){for(var e,n=0,s=r.i,i=r.j,a=r.S;t--;)e=a[s=c&s+1],n=n*o+a[c&(a[s]=a[i=c&i+e])+(a[i]=e)];return r.i=s,r.j=i,n})(o)}function h(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function p(t,e){var n,r=[],s=typeof t;if(e&&"object"==s)for(n in t)try{r.push(p(t[n],e-1))}catch(t){}return r.length?r:"string"==s?t:t+"\0"}function d(t,e){for(var n,r=t+"",s=0;s<r.length;)e[c&s]=c&(n^=19*e[c&s])+r.charCodeAt(s++);return m(e)}function m(t){return String.fromCharCode.apply(0,t)}if(n.seedrandom=l,d(n.random(),e),t.exports){t.exports=l;try{r=require("crypto")}catch(t){}}}([],Math)}(Bv);var Vv=kv,zv=Cv,Wv=Iv,Uv=Rv,jv=Fv,Gv=Pv,qv=im(Lp({__proto__:null,default:Bv.exports},[Bv.exports]));qv.alea=Vv,qv.xor128=zv,qv.xorwow=Wv,qv.xorshift7=Uv,qv.xor4096=jv,qv.tychei=Gv;var Hv=qv;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kv{constructor(t,e,n,r,s){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const o=s||Math.random();this.random=Hv.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const t=this.nextVal;return this.nextVal=NaN,t}let t,e,n=!1;for(;!n;){let r,s,o;do{r=2*this.random()-1,s=2*this.random()-1,o=r*r+s*s}while(o>=1||0===o);const i=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*r*i,e=this.mean+this.stdDev*s*i,this.truncated&&!this.isValidTruncated(t)||(n=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class Xv{constructor(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;const s=r||Math.random();this.randu=Hv.alea(s.toString()),this.randn=new Kv(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,e,n,r,s,o;for(;;){do{r=this.randn.nextValue(),o=1+this.c*r}while(o<=0);if(o*=o*o,t=r*r,e=1-.331*t*t,n=.5*t+this.d*(1-o+Math.log(o)),s=this.randu(),s<e||Math.log(s)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(t){return"float32"===this.dtype?t:Math.round(t)}}class Jv{constructor(t=0,e=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=Hv.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({randomGamma_:function(t,e,n=1,r="float32",s){if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error(`Unsupported data type ${r}`);const o=new Xv(e,n,r,s),i=ab(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}}),Cg({randomNormal_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0,n=1,r,s){if(null!=r&&"bool"===r)throw new Error(`Unsupported data type ${r}`);const o=new Kv(e,n,r,!1,s),i=ab(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});const Yv=Cg({randomUniform_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0,n=1,r="float32",s){const o=ab(t,r),i=new Jv(e,n,null,s);for(let t=0;t<o.values.length;t++)o.values[t]=i.nextValue();return o.toTensor()}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zv(t,e,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");const s={start:t,stop:e,step:n,dtype:r};return Ey.runKernel("Range",{},s)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({reciprocal_:function(t){const e={x:kg(t,"x","reciprocal")};return Ey.runKernel("Reciprocal",e)}});const Qv=Cg({relu_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:kg(t,"x","relu")};return Ey.runKernel("Relu",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tx=Cg({relu6_:function(t){const e={x:kg(t,"x","relu6")};return Ey.runKernel("Relu6",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ex=Cg({reverse_:function(t,e){const n={x:kg(t,"x","reverse")},r={dims:e};return Ey.runKernel("Reverse",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({reverse1d_:function(t){const e=kg(t,"x","reverse");return jp(1===e.rank,(()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`)),ex(e,0)}}),Cg({reverse2d_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=kg(t,"x","reverse");return jp(2===n.rank,(()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`)),ex(n,e)}}),Cg({reverse3d_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=kg(t,"x","reverse");return jp(3===n.rank,(()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`)),ex(n,e)}}),Cg({reverse4d_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=kg(t,"x","reverse");return jp(4===n.rank,(()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`)),ex(n,e)}});const nx=Cg({round_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:kg(t,"x","round")};return Ey.runKernel("Round",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({rsqrt_:function(t){const e={x:kg(t,"x","rsqrt","float32")};return Ey.runKernel("Rsqrt",e)}}),Cg({selu_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:kg(t,"x","selu")};return Ey.runKernel("Selu",e)}}),Cg({separableConv2d_:function(t,e,n,r,s,o=[1,1],i="NHWC"){const a=kg(t,"x","separableConv2d"),u=kg(e,"depthwiseFilter","separableConv2d"),c=kg(n,"pointwiseFilter","separableConv2d");let l=a,f=!1;if(3===a.rank&&(f=!0,l=gw(a,[1,a.shape[0],a.shape[1],a.shape[2]])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");jp(4===l.rank,(()=>`Error in separableConv2d: input must be rank 4, but got rank ${l.rank}.`)),jp(4===u.rank,(()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`)),jp(4===c.rank,(()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`)),jp(1===c.shape[0],(()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`)),jp(1===c.shape[1],(()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`));const h=u.shape[2],p=u.shape[3];jp(c.shape[2]===h*p,(()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*p}, but got ${c.shape[2]}.`));const d=Cw(l,u,r,s,i,o),m=Tw(d,c,1,"valid",i);return f?gw(m,[m.shape[1],m.shape[2],m.shape[3]]):m}}),Cg({sign_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:kg(t,"x","sign")};return Ey.runKernel("Sign",e)}}),Cg({sin_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:kg(t,"x","sin","float32")};return Ey.runKernel("Sin",e)}}),Cg({sinh_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:kg(t,"x","sinh")};return Ey.runKernel("Sinh",e)}}),Cg({slice1d_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=kg(t,"x","slice1d");return jp(1===r.rank,(()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`)),xw(r,[e],[n])}}),Cg({slice2d_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=kg(t,"x","slice2d");return jp(2===r.rank,(()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`)),xw(r,e,n)}}),Cg({slice3d_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=kg(t,"x","slice3d");return jp(3===r.rank,(()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`)),xw(r,e,n)}}),Cg({slice4d_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=kg(t,"x","slice4d");return jp(4===r.rank,(()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`)),xw(r,e,n)}}),Cg({softmax_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=-1){const n=kg(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const r={logits:n},s={dim:e};return Ey.runKernel("Softmax",r,s)}});const rx=Cg({fft_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){jp("complex64"===t.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`));const e={input:t};return Ey.runKernel("FFT",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sx=Cg({ifft_:function(t){jp("complex64"===t.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`));const e={input:t};return Ey.runKernel("IFFT",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({irfft_:function(t){const e=t.shape[t.shape.length-1],n=t.size/e;let r;if(e<=2){const s=gw(t,[n,e]);r=sx(s)}else{const s=[n,2*(e-1)],o=gw(Eb(t),[n,e]),i=gw(Nb(t),[n,e]),a=ex(xw(o,[0,1],[n,e-2]),1),u=ew(ex(xw(i,[0,1],[n,e-2]),1),qw(-1)),c=ww([o,a],1),l=ww([i,u],1),f=gw(Og(c,l),[s[0],s[1]]);r=sx(f)}if(r=Eb(r),3===t.rank&&0!==t.shape[0]){const e=r,n=t.shape[0];r=gw(r,[n,r.shape[0]/n,r.shape[1]]),e.dispose()}return r}});const ox=Cg({split_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n=0){const r={x:kg(t,"x","split")},s={numOrSizeSplits:e,axis:n};return Ey.runKernel("SplitV",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ix=Cg({rfft_:function(t,e){jp("float32"===t.dtype,(()=>`The dtype for rfft() must be real value but got ${t.dtype}`));let n=t.shape[t.shape.length-1];const r=t.size/n;let s;if(null!=e&&e<n){const r=t.shape.map((t=>0)),o=t.shape.map((t=>t));o[t.shape.length-1]=e,s=xw(t,r,o),n=e}else if(null!=e&&e>n){const r=t.shape.map((t=>t));r[t.shape.length-1]=e-n,s=ww([t,vv(r)],t.shape.length-1),n=e}else s=t;const o=Mw(s),i=gw(Og(s,o),[r,n]),a=rx(i),u=Math.floor(n/2)+1,c=Eb(a),l=Nb(a),f=ox(c,[u,n-u],c.shape.length-1),h=ox(l,[u,n-u],l.shape.length-1),p=s.shape.slice();return p[s.shape.length-1]=u,gw(Og(f[0],h[0]),p)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ax=Cg({squaredDifference_:function(t,e){let n=kg(t,"a","squaredDifference"),r=kg(e,"b","squaredDifference");[n,r]=gy(n,r),kb(n.shape,r.shape);const s={a:n,b:r};return Ey.runKernel("SquaredDifference",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ux=Cg({squeeze_:function(t,e){const n=kg(t,"x","squeeze");return gw(n,ed(n.shape,e).newShape)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cx=Cg({stack_:function(t,e=0){const n=Ag(t,"tensors","stack","string_or_numeric");jp(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&jp(e<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const r=n,s={axis:e};return Ey.runKernel("Pack",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lx=Cg({step_:function(t,e=0){const n={x:kg(t,"x","step")},r={alpha:e};return Ey.runKernel("Step",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function fx(t,e){qp(t);const n=Sg(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Ig(t,null,n,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hx(t,e,n){if(qp(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");const r=Sg(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Ig(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({stridedSlice_:function(t,e,n,r,s=0,o=0,i=0,a=0,u=0){const c={x:kg(t,"x","stridedSlice","string_or_numeric")},l={begin:e,end:n,strides:r,beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};return Ey.runKernel("StridedSlice",c,l)}}),Cg({tan_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:kg(t,"x","tan","float32")};return Ey.runKernel("Tan",e)}}),Cg({topk_:function(t,e=1,n=!0){const r=kg(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const s=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const o={x:r},i={k:e,sorted:n},[a,u]=Ey.runKernel("TopK",o,i);return{values:a,indices:u}}}),Cg({truncatedNormal_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0,n=1,r,s){if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const o=new Kv(e,n,r,!0,s),i=ab(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}}),Cg({unique_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0){const n=kg(t,"x","unique","string_or_numeric");jp(n.rank>0,(()=>"The input tensor must be at least 1D"));const r={x:n},s={axis:e},[o,i]=Ey.runKernel("Unique",r,s);return{values:o,indices:i}}}),Cg({unsortedSegmentSum_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=kg(t,"x","unsortedSegmentSum"),s=kg(e,"segmentIds","unsortedSegmentSum","int32");jp(Jp(n),(()=>"numSegments must be of dtype int"));const o={x:r,segmentIds:s},i={numSegments:n};return Ey.runKernel("UnsortedSegmentSum",o,i)}});const px=Cg({unstack_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0){const n=kg(t,"x","unstack","string_or_numeric");jp(e>=-n.shape.length&&e<n.shape.length,(()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`));const r={value:n},s={axis:e};return Ey.runKernel("Unpack",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dx(t,e,n){const r=1-t%2,s=new Float32Array(t);for(let o=0;o<t;++o){const i=2*Math.PI*o/(t+r-1);s[o]=e-n*Math.cos(i)}return fx(s,"float32")}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({movingAverage_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s=!0){const o=kg(t,"v","movingAverage"),i=kg(e,"x","movingAverage"),a=kg(n,"decay","movingAverage");!function(t,e){jp(t.dtype===e.dtype,(()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`))}(o,i),jp(Xp(o.shape,i.shape),(()=>"Shape mismatch in v and x"));const u=qw(1),c=hv(u,a);let l=ew(hv(i,o),c);if(s){jp(null!=r,(()=>"When using zeroDebias: true, step is required."));const t=kg(r,"step","movingAverage");l=tw(l,hv(u,Gw(a,t)))}return Zb(o,l)}}),Cg({scatterND_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=kg(t,"indices","scatterND","int32"),s=kg(e,"updates","scatterND");Ib(s,r,n);const o={indices:r,updates:s},i={shape:n};return Ey.runKernel("ScatterNd",o,i)}}),Cg({sparseToDense_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=0){const s=kg(t,"sparseIndices","sparseToDense","int32"),o=kg(e,"sparseValues","sparseToDense","string_or_numeric"),i=kg(r,"defaultValue","sparseToDense",o.dtype);!function(t,e,n,r){if("int32"!==t.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const s=t.rank>0?t.shape[0]:1,o=t.rank>1?t.shape[1]:1;if(n.length!==o)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${o}.`);const i=e.size;if(0!==e.rank&&(1!==e.rank||i!==s))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${s}]`);if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(s,o,n,i);const a={sparseIndices:s,sparseValues:o,defaultValue:i},u={outputShape:n};return Ey.runKernel("SparseToDense",a,u)}}),Cg({gatherND_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=kg(e,"indices","gatherND","int32"),r={params:kg(t,"x","gatherND","string_or_numeric"),indices:n};return Ey.runKernel("GatherNd",r)}}),Cg({dropout_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const s=kg(t,"x","dropout");if(jp("float32"===s.dtype,(()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${s.dtype} tensor instead.`)),jp(e>=0&&e<1,(()=>`rate must be a float in the range [0, 1), but got ${e}.`)),0===e)return t instanceof ay?s.clone():s;const o=
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){if(null==e)return t.shape.slice();if(Xp(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let r=0;r<t.shape.length;r++)null==e[r]&&null!=t.shape[r]?n.push(t.shape[r]):n.push(e[r]);return n}return e}(s,n),i=1-e,a=tw(rv(Zb(Yv(o,0,1,"float32",r),i)),i);return ew(s,a)}});const mx=Cg({conv2DBackpropFilter_:function(t,e,n,r,s,o="NHWC",i){let a=t;3===t.rank&&(a=gw(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=gw(e,[1,e.shape[0],e.shape[1],e.shape[2]])),jp(4===a.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`)),jp(4===u.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`)),jp(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const c="NHWC"===o?a.shape[3]:a.shape[1],l="NHWC"===o?u.shape[3]:u.shape[1];jp(c===n[2],(()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`)),jp(l===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${l}) must match output depth for filter (${n[3]}).`)),yw("conv2dDerFilter",s,i);const f={x:a,dy:u},h={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,filterShape:n};return Ey.runKernel("Conv2DBackpropFilter",f,h)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yx(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return ew(t,lx(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function gx(t,e){let n=e;const r=Tb(t.shape,e.shape);return r.length>0&&(n=Xw(n,r)),gw(n,t.shape)}function bx(t,e,n,r){if("linear"===e)return t;if("relu"===e)return Qv(t);if("elu"===e)return Rw(t);if("relu6"===e)return tx(t);if("prelu"===e)return _v(t,n);if("leakyrelu"===e)return iv(t,r);if("sigmoid"===e)return vw(t);throw new Error(`Unknown fused activation ${e}.`)}const wx=(t,e)=>!(t>0)||"linear"===e;
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({fusedConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(u=u||"linear",!1===wx(Ey.state.gradientDepth,u)){jp("NHWC"===s,(()=>`Error in fused conv2d: got dataFormat of ${s} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`));let f=Tw(t,e,n,r,s,o,i);return null!=a&&(f=Zb(f,a)),bx(f,u,c,l)}const f=kg(t,"x","conv2d","float32"),h=kg(e,"filter","conv2d","float32");let p=f,d=!1;3===f.rank&&(d=!0,p=gw(f,[1,f.shape[0],f.shape[1],f.shape[2]])),jp(4===p.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`)),jp(4===h.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`)),yw("fused conv2d",r,i);const m="NHWC"===s?p.shape[3]:p.shape[1];jp(h.shape[2]===m,(()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${h.shape[2]}.`)),jp(dw(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const y=iw(p.shape,h.shape,n,o,r,i);let g,b;if(null!=a&&(g=kg(a,"bias","fused conv2d"),[g]=gy(g,f),"NHWC"===s?kb(y.outShape,g.shape):(jp(g.shape.length<=1,(()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${g.shape.length}.`)),jp(0===g.shape.length||g.shape[0]===y.outChannels||1===g.shape[0],(()=>`Error in fused conv2d: bias shape (${g.shape}) is not compatible with the number of output channels (${y.outChannels})`)))),null!=c){const t=c.shape;if(jp(t.length<=1||3===t.length,(()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${t.length}.`)),1===t.length)jp(1===t[0]||t[0]===y.outChannels,(()=>`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the number of output channels (${y.outChannels}).`));else if(3===t.length)try{kb(t,y.outShape)}catch(e){const n=`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the output shape of the conv2d (${y.outShape}).`;throw Error(n)}b=kg(c,"prelu weights","fused conv2d")}const w=(t,e)=>{jp("NHWC"===s,(()=>`Error in gradient of fused conv2D: got dataFormat of ${s} but only NHWC is currently supported.`));const[i,a,c,l]=e,f=yx(t,c,u);jp(pw(o),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`));const h=[kw(a.shape,f,i,n,r),mx(a,f,i.shape,n,r)];if(null!=l){const t=gx(l,f);h.push(t)}return h},v={x:p,filter:h,bias:g,preluActivationWeights:b},x={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=lv(((t,e,n)=>{let r=Ey.runKernel("FusedConv2D",v,x);return n([e,t,r]),d&&(r=gw(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:w}}));return t(p,h)}{const t=lv(((t,e,n,r)=>{let s=Ey.runKernel("FusedConv2D",v,x);return r([e,t,s,n]),d&&(s=gw(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:w}}));return t(p,h,g)}}});const vx=Cg({depthwiseConv2dNativeBackpropFilter_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s,o=[1,1],i){let a=t;3===t.rank&&(a=gw(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=gw(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:u},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,filterShape:n};return Ey.runKernel("DepthwiseConv2dNativeBackpropFilter",c,l)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xx=Cg({depthwiseConv2dNativeBackpropInput_:function(t,e,n,r,s,o=[1,1],i){let a=e,u=!1;3===e.rank&&(u=!0,a=gw(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,inputShape:t},f=Ey.runKernel("DepthwiseConv2dNativeBackpropInput",c,l);return u?gw(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({fusedDepthwiseConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(!1===wx(Ey.state.gradientDepth,u)){let f=Cw(t,e,n,r,s,o,i);return null!=a&&(f=Zb(f,a)),bx(f,u,c,l)}const f=kg(t,"x","depthwiseConv2d","float32"),h=kg(e,"filter","depthwiseConv2d","float32");let p=f,d=!1;3===f.rank&&(d=!0,p=gw(f,[1,f.shape[0],f.shape[1],f.shape[2]])),jp(4===p.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`)),jp(4===h.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`)),jp(p.shape[3]===h.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${p.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`)),null==o&&(o=[1,1]),jp(dw(n,o),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),yw("fused depthwiseConv2d",r,i);const m=iw(p.shape,h.shape,n,o,r,i,!0);let y,g;null!=a&&(y=kg(a,"bias","fused conv2d"),[y]=gy(y,f),kb(m.outShape,y.shape)),null!=c&&(g=kg(c,"prelu weights","fused depthwiseConv2d"));const b=(t,e)=>{jp(pw(o),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`));const[s,a,c,l]=e,f=yx(t,c,u),h=xx(a.shape,f,s,n,r,o,i),p=vx(a,f,s.shape,n,r,o,i);if(null!=l){return[h,p,gx(y,f)]}return[h,p]},w={x:p,filter:h,bias:y,preluActivationWeights:g},v={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=lv(((t,e,n)=>{let r=Ey.runKernel("FusedDepthwiseConv2D",w,v);return n([e,t,r]),d&&(r=gw(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}}));return t(p,h)}{const t=lv(((t,e,n,r)=>{let s=Ey.runKernel("FusedDepthwiseConv2D",w,v);return r([e,t,s,n]),d&&(s=gw(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:b}}));return t(p,h,y)}}}),Cg({fusedMatMul_:
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function({a:t,b:e,transposeA:n=!1,transposeB:r=!1,bias:s,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a}){if(!1===wx(Ey.state.gradientDepth,o)){let u=gb(t,e,n,r);return null!=s&&(u=Zb(u,s)),bx(u,o,i,a)}let u=kg(t,"a","fused matMul"),c=kg(e,"b","fused matMul");[u,c]=gy(u,c);const l=n?u.shape[u.rank-2]:u.shape[u.rank-1],f=r?c.shape[c.rank-1]:c.shape[c.rank-2],h=n?u.shape[u.rank-1]:u.shape[u.rank-2],p=r?c.shape[c.rank-2]:c.shape[c.rank-1],d=u.shape.slice(0,-2),m=c.shape.slice(0,-2),y=Kp(d),g=Kp(m);jp(l===f,(()=>`Error in fused matMul: inner shapes (${l}) and (${f}) of Tensors with shapes ${u.shape} and ${c.shape} and transposeA=${n} and transposeB=${r} must match.`));const b=kb(u.shape.slice(0,-2),c.shape.slice(0,-2)).concat([h,p]),w=gw(u,n?[y,l,h]:[y,h,l]),v=gw(c,r?[g,p,f]:[g,f,p]);let x,N;null!=s&&(x=kg(s,"bias","fused matMul"),[x]=gy(x,u),kb(b,x.shape)),null!=i&&(N=kg(i,"prelu weights","fused matMul"));const $=(t,e)=>{const[i,a,u,c]=e,l=yx(gw(t,u.shape),u,o);let f,h;if(n||r?!n&&r?(f=gb(l,a,!1,!1),h=gb(l,i,!0,!1)):n&&!r?(f=gb(a,l,!1,!0),h=gb(i,l,!1,!1)):(f=gb(a,l,!0,!0),h=gb(l,i,!0,!0)):(f=gb(l,a,!1,!0),h=gb(i,l,!0,!1)),null!=s){return[f,h,gx(c,l)]}return[f,h]},E={a:w,b:v,bias:x,preluActivationWeights:N},S={transposeA:n,transposeB:r,activation:o,leakyreluAlpha:a};if(null==s){const t=lv(((t,e,n)=>{const r=Ey.runKernel("_FusedMatMul",E,S);return n([t,e,r]),{value:gw(r,b),gradFunc:$}}));return t(w,v)}{const t=lv(((t,e,n,r)=>{const s=Ey.runKernel("_FusedMatMul",E,S);return r([t,e,s,n]),{value:gw(s,b),gradFunc:$}}));return t(w,v,x)}}}),Cg({hammingWindow_:
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){return dx(t,.54,.46)}});const Nx=Cg({hannWindow_:
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){return dx(t,.5,.5)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $x=Cg({frame_:function(t,e,n,r=!1,s=0){let o=0;const i=[];for(;o+e<=t.size;)i.push(xw(t,o,e)),o+=n;if(r)for(;o<t.size;){const r=o+e-t.size,a=ww([xw(t,o,e-r),nv([r],s)]);i.push(a),o+=n}return 0===i.length?hx([],[0,e]):gw(ww(i),[i.length,e])}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ex(t,e,n,r,s,o){null==r&&(r=.5),null==s&&(s=Number.NEGATIVE_INFINITY),null==o&&(o=0);const i=t.shape[0];return n=Math.min(n,i),jp(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),jp(2===t.rank,(()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`)),jp(4===t.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`)),jp(1===e.rank,(()=>"scores must be a 1D tensor")),jp(e.shape[0]===i,(()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`)),jp(0<=o&&o<=1,(()=>`softNmsSigma must be in [0, 1], but was '${o}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:s,softNmsSigma:o}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Sx(t,e,n){const r=function(t,e,n){return function(t,e,n){let r=0,s=t.length,o=0,i=!1;for(;r<s;){o=r+(s-r>>>1);const a=n(e,t[o]);a>0?r=o+1:(s=o,i=!a)}return i?r:-r-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e,n||_x)}(t,e,n),s=r<0?-(r+1):r;t.splice(s,0,e)}function _x(t,e){return t>e?1:t<e?-1:0}function Tx(t,e,n,r,s,o,i=!1,a=!1,u=!1){const c=[];for(let t=0;t<e.length;t++)e[t]>s&&c.push({score:e[t],boxIndex:t,suppressBeginIndex:0});c.sort(Cx);const l=o>0?-.5/o:0,f=[],h=[];for(;f.length<n&&c.length>0;){const e=c.pop(),{score:n,boxIndex:o,suppressBeginIndex:i}=e;if(n<s)break;let a=!1;for(let n=f.length-1;n>=i;--n){const i=kx(t,o,f[n]);if(i>=r){a=!0;break}if(e.score=e.score*Ax(r,l,i),e.score<=s)break}e.suppressBeginIndex=f.length,a||(e.score===n?(f.push(o),h.push(e.score)):e.score>s&&Sx(c,e,Cx))}const p=f.length,d=n-p;a&&d>0&&(f.push(...new Array(d).fill(0)),h.push(...new Array(d).fill(0)));const m={selectedIndices:f};return i&&(m.selectedScores=h),u&&(m.validOutputs=p),m}function kx(t,e,n){const r=t.subarray(4*e,4*e+4),s=t.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(s[0],s[2]),l=Math.min(s[1],s[3]),f=Math.max(s[0],s[2]),h=Math.max(s[1],s[3]),p=(a-o)*(u-i),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;const m=Math.max(o,c),y=Math.max(i,l),g=Math.min(a,f),b=Math.min(u,h),w=Math.max(g-m,0)*Math.max(b-y,0);return w/(p+d-w)}function Ax(t,e,n){const r=Math.exp(e*n*n);return n<=t?r:0}function Cx(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ox(t,e=!1){return Ey.tidy((()=>{jp(2===t.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`));const n=t.shape[0],r=t.shape[1];let s=ev(n),o=cb(t);const i=hx([[1]],[1,1]);let a=cb(i);const u=n>=r?r:n;for(let t=0;t<u;++t){const e=o,u=a,c=s;[a,o,s]=Ey.tidy((()=>{const e=xw(o,[t,t],[n-t,1]),u=Yw(e),c=xw(o,[t,t],[1,1]),l=Iw(sv(c,0),hx([[-1]]),hx([[1]])),f=hv(c,ew(l,u)),h=tw(e,f);a=1===h.shape[0]?cb(i):ww([i,xw(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);const p=$b(tw(gb(l,f),u)),d=xw(o,[t,0],[n-t,r]),m=ew(p,a),y=Sb(a);if(0===t)o=hv(d,gb(m,gb(y,d)));else{const e=hv(d,gb(m,gb(y,d)));o=ww([xw(o,[0,0],[t,r]),e],0)}const g=Sb(m),b=xw(s,[0,t],[n,s.shape[1]-t]);if(0===t)s=hv(b,gb(gb(b,a),g));else{const e=hv(b,gb(gb(b,a),g));s=ww([xw(s,[0,0],[n,t]),e],1)}return[a,o,s]})),xb([e,u,c])}return!e&&n>r&&(s=xw(s,[0,0],[n,r]),o=xw(o,[0,0],[r,r])),[s,o]}))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var Ix;Cg({stft_:function(t,e,n,r,s=Nx){
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var o;null==r&&(o=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));const i=$x(t,e,n),a=ew(i,s(e));return ix(a,r)}}),Cg({cropAndResize_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s="bilinear",o=0){const i=kg(t,"image","cropAndResize"),a=kg(e,"boxes","cropAndResize","float32"),u=kg(n,"boxInd","cropAndResize","int32"),c=a.shape[0];jp(4===i.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`)),jp(2===a.rank&&4===a.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`)),jp(1===u.rank&&u.shape[0]===c,(()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`)),jp(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),jp(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),jp("bilinear"===s||"nearest"===s,(()=>`method must be bilinear or nearest, but was ${s}`));const l={image:i,boxes:a,boxInd:u},f={method:s,extrapolationValue:o,cropSize:r};return Ey.runKernel("CropAndResize",l,f)}}),Cg({flipLeftRight_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e=kg(t,"image","flipLeftRight","float32");jp(4===e.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`));const n={image:e};return Ey.runKernel("FlipLeftRight",n,{})}}),Cg({grayscaleToRGB_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e=kg(t,"image","grayscaleToRGB"),n=e.rank-1,r=e.shape[n];jp(e.rank>=2,(()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`)),jp(1===r,(()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`));const s=new Array(e.rank);return s.fill(1,0,n),s[n]=3,tv(e,s)}}),Cg({rotateWithOffset_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n=0,r=.5){const s=kg(t,"image","rotateWithOffset","float32");jp(4===s.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${s.rank}.`));const o={image:s},i={radians:e,fillValue:n,center:r};return Ey.runKernel("RotateWithOffset",o,i)}}),Cg({nonMaxSuppression_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const o=kg(t,"boxes","nonMaxSuppression","float32"),i=kg(e,"scores","nonMaxSuppression","float32"),a=Ex(o,i,n,r,s),u={maxOutputSize:n=a.maxOutputSize,iouThreshold:r=a.iouThreshold,scoreThreshold:s=a.scoreThreshold};return Ey.runKernel("NonMaxSuppressionV3",{boxes:o,scores:i},u)}}),Cg({nonMaxSuppressionWithScore_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=kg(t,"boxes","nonMaxSuppression"),a=kg(e,"scores","nonMaxSuppression"),u=Ex(i,a,n,r,s,o),c={boxes:i,scores:a},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:s=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},f=Ey.runKernel("NonMaxSuppressionV5",c,l);return{selectedIndices:f[0],selectedScores:f[1]}}}),Cg({nonMaxSuppressionPadded_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=kg(t,"boxes","nonMaxSuppression"),a=kg(e,"scores","nonMaxSuppression"),u=Ex(i,a,n,r,s,null),c={boxes:i,scores:a},l={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:o},f=Ey.runKernel("NonMaxSuppressionV4",c,l);return{selectedIndices:f[0],validOutputs:f[1]}}}),Cg({resizeBilinear_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n=!1,r=!1){const s=kg(t,"images","resizeBilinear");jp(3===s.rank||4===s.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${s.rank}.`)),jp(2===e.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`)),jp(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=gw(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=Ey.runKernel("ResizeBilinear",a,u);return i?gw(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),Cg({resizeNearestNeighbor_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n=!1,r=!1){const s=kg(t,"images","resizeNearestNeighbor");jp(3===s.rank||4===s.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${s.rank}.`)),jp(2===e.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`)),jp("float32"===s.dtype||"int32"===s.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),jp(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=gw(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=Ey.runKernel("ResizeNearestNeighbor",a,u);return i?gw(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),Cg({threshold_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e="binary",n=!1,r=.5){const s=kg(t,"image","threshold"),o=s.shape[0]*s.shape[1];let i,a,u,c,l=ew(fx([r]),255);if(jp(3===s.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${s.rank}.`)),jp(3===s.shape[2]||1===s.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${s.shape[2]}.`)),jp("int32"===s.dtype||"float32"===s.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${s.dtype}.`)),jp("otsu"===e||"binary"===e,(()=>`Method must be binary or otsu, but was ${e}`)),3===s.shape[2]){[i,a,u]=ox(s,[1,1,1],-1);const t=ew(i,.2989),e=ew(a,.587),n=ew(u,.114);c=Zb(Zb(t,e),n)}else c=t;if("otsu"===e){l=function(t,e){let n,r,s,o,i,a,u=fx([-1]),c=fx([0]),l=fx([0]);for(let f=0;f<t.size-1;f++){n=xw(t,0,f+1),r=xw(t,f+1),i=tw(Xw(n),e),a=tw(Xw(r),e);const h=Xw(ew(n,Zv(0,n.size)));s=tw(h,Xw(n));const p=nv(r.shape,n.size),d=Zb(Zv(0,r.size),p),m=ew(r,d);o=tw(Xw(m),Xw(r));const y=hv(s,o),g=hv(s,o),b=ew(i,a);l=ew(ew(b,y),g);const w=sv(l,c);c=Iw(w,l,c),u=Iw(w,fx([f]),u)}return u}(Sw(ub(nx(c),"int32"),Ig(f=[],h,Sg(f,p),p),256),o)}var f,h,p;const d=n?av(c,l):sv(c,l);return ub(ew(d,255),"int32")}}),Cg({transform_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n="nearest",r="constant",s=0,o){const i=kg(t,"image","transform","float32"),a=kg(e,"transforms","transform","float32");jp(4===i.rank,(()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`)),jp(2===a.rank&&(a.shape[0]===i.shape[0]||1===a.shape[0])&&8===a.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),jp(null==o||2===o.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`));const u={image:i,transforms:a},c={interpolation:n,fillMode:r,fillValue:s,outputShape:o};return Ey.runKernel("Transform",u,c)}}),Cg({bandPart_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){jp(e%1==0,(()=>`bandPart(): numLower must be an integer, got ${e}.`)),jp(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`));const r=kg(t,"a","bandPart");jp(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));const s=r.shape,[o,i]=r.shape.slice(-2);if(!(e<=o))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`);if(!(n<=i))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${i}).`);e<0&&(e=o),n<0&&(n=i);const a=gw(Zv(0,o,1,"int32"),[-1,1]),u=Zv(0,i,1,"int32"),c=hv(a,u),l=dv(av(c,qw(+e,"int32")),ov(c,qw(-n,"int32"))),f=vv([o,i],r.dtype);return gw(cx(px(gw(r,[-1,o,i])).map((t=>Iw(l,t,f)))),s)}}),Cg({gramSchmidt_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){let e;if(Array.isArray(t)){e=!1,jp(null!=t&&t.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=t[0].shape[0];for(let e=1;e<t.length;++e)jp(t[e].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[e].shape[0]} vs. ${n})`))}else e=!0,t=ox(t,t.shape[0],0).map((t=>ux(t,[0])));jp(t.length<=t[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`));const n=[],r=t;for(let e=0;e<t.length;++e)n.push(Ey.tidy((()=>{let t=r[e];if(e>0)for(let r=0;r<e;++r){const e=ew(Xw(ew(n[r],t)),n[r]);t=hv(t,e)}return tw(t,Yw(t,"euclidean"))})));return e?cx(n,0):n}}),Cg({qr_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=!1){if(jp(t.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`)),2===t.rank)return Ox(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce(((t,e)=>t*e)),r=px(gw(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),s=[],o=[];r.forEach((t=>{const[n,r]=Ox(t,e);s.push(n),o.push(r)}));return[gw(cx(s,0),t.shape),gw(cx(o,0),t.shape)]}}}),function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Ix||(Ix={}));const Mx=Cg({computeWeightedLoss_:function(t,e,n=Ix.SUM_BY_NONZERO_WEIGHTS){const r=kg(t,"losses","computeWeightedLoss");let s=null;null!=e&&(s=kg(e,"weights","computeWeightedLoss"));const o=null==s?r:ew(r,s);if(n===Ix.NONE)return o;if(n===Ix.SUM)return Xw(o);if(n===Ix.MEAN){if(null==s)return wv(o);{const t=r.size/s.size,e=tw(Xw(o),Xw(s));return t>1?tw(e,qw(t)):e}}if(n===Ix.SUM_BY_NONZERO_WEIGHTS){if(null==s)return tw(Xw(o),qw(r.size));{const t=ew(s,xv(r.shape)),e=ub(Xw($v(t,qw(0))),"float32");return tw(Xw(o),e)}}throw Error(`Unknown reduction: ${n}`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Cg({absoluteDifference_:function(t,e,n,r=Ix.SUM_BY_NONZERO_WEIGHTS){const s=kg(t,"labels","absoluteDifference"),o=kg(e,"predictions","absoluteDifference");let i=null;null!=n&&(i=kg(n,"weights","absoluteDifference")),Gp(s.shape,o.shape,"Error in absoluteDifference: ");const a=nw(hv(s,o));return Mx(a,i,r)}}),Cg({cosineDistance_:function(t,e,n,r,s=Ix.SUM_BY_NONZERO_WEIGHTS){const o=kg(t,"labels","cosineDistance"),i=kg(e,"predictions","cosineDistance");let a=null;null!=r&&(a=kg(r,"weights","cosineDistance")),Gp(o.shape,i.shape,"Error in cosineDistance: ");const u=qw(1),c=hv(u,Xw(ew(o,i),n,!0));return Mx(c,a,s)}}),Cg({hingeLoss_:function(t,e,n,r=Ix.SUM_BY_NONZERO_WEIGHTS){let s=kg(t,"labels","hingeLoss");const o=kg(e,"predictions","hingeLoss");let i=null;null!=n&&(i=kg(n,"weights","hingeLoss")),Gp(s.shape,o.shape,"Error in hingeLoss: ");const a=qw(1);s=hv(ew(qw(2),s),a);const u=Qv(hv(a,ew(s,o)));return Mx(u,i,r)}}),Cg({huberLoss_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=1,s=Ix.SUM_BY_NONZERO_WEIGHTS){const o=kg(t,"labels","huberLoss"),i=kg(e,"predictions","huberLoss");let a=null;null!=n&&(a=kg(n,"weights","huberLoss")),Gp(o.shape,i.shape,"Error in huberLoss: ");const u=qw(r),c=nw(hv(i,o)),l=Nv(c,u),f=hv(c,l),h=Zb(ew(qw(.5),Kw(l)),ew(u,f));return Mx(h,a,s)}}),Cg({logLoss_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=1e-7,s=Ix.SUM_BY_NONZERO_WEIGHTS){const o=kg(t,"labels","logLoss"),i=kg(e,"predictions","logLoss");let a=null;null!=n&&(a=kg(n,"weights","logLoss")),Gp(o.shape,i.shape,"Error in logLoss: ");const u=qw(1),c=qw(r),l=$b(ew(o,uv(Zb(i,c)))),f=ew(hv(u,o),uv(Zb(hv(u,i),c))),h=hv(l,f);return Mx(h,a,s)}}),Cg({meanSquaredError_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=Ix.SUM_BY_NONZERO_WEIGHTS){const s=kg(t,"labels","meanSquaredError"),o=kg(e,"predictions","meanSquaredError");let i=null;null!=n&&(i=kg(n,"weights","meanSquaredError")),Gp(s.shape,o.shape,"Error in meanSquaredError: ");const a=ax(s,o);return Mx(a,i,r)}}),Cg({sigmoidCrossEntropy_:function(t,e,n,r=0,s=Ix.SUM_BY_NONZERO_WEIGHTS){let o=kg(t,"multiClassLabels","sigmoidCrossEntropy");const i=kg(e,"logits","sigmoidCrossEntropy");let a=null;if(null!=n&&(a=kg(n,"weights","sigmoidCrossEntropy")),Gp(o.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){const t=qw(r),e=qw(1),n=qw(.5);o=Zb(ew(o,hv(e,t)),ew(n,t))}const u=
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=kg(t,"labels","sigmoidCrossEntropyWithLogits"),r=kg(e,"logits","sigmoidCrossEntropyWithLogits");Gp(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const s=Qv(r),o=ew(r,n),i=cv(Zw($b(nw(r))));return Zb(hv(s,o),i)}(o,i);return Mx(u,a,s)}}),Cg({softmaxCrossEntropy_:function(t,e,n,r=0,s=Ix.SUM_BY_NONZERO_WEIGHTS){let o=kg(t,"onehotLabels","softmaxCrossEntropy");const i=kg(e,"logits","softmaxCrossEntropy");let a=null;if(null!=n&&(a=kg(n,"weights","softmaxCrossEntropy")),Gp(o.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){const t=qw(r),e=qw(1),n=qw(o.shape[1]);o=Zb(ew(o,hv(e,t)),tw(t,n))}const u=
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n=-1){if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);const r=lv(((t,e,r)=>{const s=pv(e,[n],!0),o=hv(ub(e,"float32"),s);r([t,o]);const i=$b(ew(o,t));return{value:Xw(i,[n]),gradFunc:(t,e)=>{const[r,s]=e,o=Pw(t.shape,[n]);return[ew(gw(t,o),hv(ub(r,"float32"),Zw(s))),ew(gw(t,o),hv(Zw(s),ub(r,"float32")))]}}}));return r(t,e)}(o,i);return Mx(u,a,s)}}),Cg({sparseFillEmptyRows_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const s=kg(t,"indices","sparseFillEmptyRows","int32"),o=kg(e,"values","sparseFillEmptyRows"),i=kg(n,"denseShape","sparseFillEmptyRows","int32"),a=kg(r,"defaultValue","sparseFillEmptyRows",o.dtype);if(2!==s.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${s.shape}`);if(1!==o.rank)throw new Error(`Values should be Tensor1D but received shape ${o.shape}`);if(1!==i.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${i.shape}`);if(0!==a.rank)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const u={indices:s,values:o,denseShape:i,defaultValue:a},c=Ey.runKernel("SparseFillEmptyRows",u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}}),Cg({sparseReshape_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=kg(t,"inputIndices","sparseReshape","int32"),s=kg(e,"inputShape","sparseReshape","int32"),o=kg(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==s.rank)throw new Error(`Input shape should be Tensor1D but received shape ${s.shape}`);if(1!==o.rank)throw new Error(`New shape should be Tensor1D but received shape ${o.shape}`);const i={inputIndices:r,inputShape:s,newShape:o},a=Ey.runKernel("SparseReshape",i);return{outputIndices:a[0],outputShape:a[1]}}}),Cg({sparseSegmentMean_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=kg(t,"data","sparseSegmentMean"),s=kg(e,"indices","sparseSegmentMean","int32"),o=kg(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return Ey.runKernel("SparseSegmentMean",i)}}),Cg({sparseSegmentSum_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=kg(t,"data","sparseSegmentSum"),s=kg(e,"indices","sparseSegmentSum","int32"),o=kg(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return Ey.runKernel("SparseSegmentSum",i)}}),Cg({stringNGrams_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s,o,i,a){const u=kg(t,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error(`Data must be a vector, saw: ${u.shape}`);const c=kg(e,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");const l={separator:n,nGramWidths:r,leftPad:s,rightPad:o,padWidth:i,preserveShortSequences:a},f={data:u,dataSplits:c},h=Ey.runKernel("StringNGrams",f,l);return{nGrams:h[0],nGramsSplits:h[1]}}}),Cg({stringSplit_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n=!0){const r=kg(t,"input","stringSplit","string"),s=kg(e,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(0!==s.rank)throw new Error(`Delimiter should be a scalar but received shape ${s.shape}`);const o={skipEmpty:n},i={input:r,delimiter:s},a=Ey.runKernel("StringSplit",i,o);return{indices:a[0],values:a[1],shape:a[2]}}}),Cg({stringToHashBucketFast_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=kg(t,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const s={input:n};return Ey.runKernel("StringToHashBucketFast",s,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Rx extends class{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}{minimize(t,e=!1,n){const{value:r,grads:s}=this.computeGradients(t,n);if(null!=n){const t=n.map((t=>({name:t.name,tensor:s[t.name]})));this.applyGradients(t)}else this.applyGradients(s);return xb(s),e?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return function(t,e){jp(ud(t),(()=>"The f passed in variableGrads(f) must be a function")),jp(null==e||Array.isArray(e)&&e.every((t=>t instanceof uy)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=e;if(!n){e=[];for(const t in Ey.registeredVariables)e.push(Ey.registeredVariables[t])}const r=n?e.filter((t=>!t.trainable)):null,s=e.length;e=e.filter((t=>t.trainable)),jp(e.length>0,(()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${s} variables is trainable.`));const{value:o,grads:i}=Ey.gradients(t,e,null,!0);jp(i.some((t=>null!=t)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),jp(0===o.rank,(()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`));const a={};return e.forEach(((t,e)=>{null!=i[e]&&(a[t.name]=i[e])})),null!=r&&r.forEach((t=>a[t.name]=null)),{value:o,grads:a}}(t,e)}dispose(){null!=this.iterations_&&xb(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:qw(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(Rx,Symbol.hasInstance,{value:t=>null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Dx extends Rx{constructor(t,e,n=null){super(),this.learningRate=t,this.rho=e,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=Ey.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Ey.registeredVariables[e];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${e}/accum_grad`,variable:vb((()=>Mw(r).variable(false)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${e}/accum_var`,variable:vb((()=>Mw(r).variable(false)))});const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const o=this.accumulatedGrads[n].variable,i=this.accumulatedUpdates[n].variable;vb((()=>{const t=Zb(ew(o,this.rho),ew(Kw(s),1-this.rho)),e=ew(tw(Hw(Zb(i,this.epsilon)),Hw(Zb(o,this.epsilon))),s),n=Zb(ew(i,this.rho),ew(Kw(e),1-this.rho));o.assign(t),i.assign(n);const a=Zb(ew(e,-this.learningRate),r);r.assign(a)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(xb(this.accumulatedGrads.map((t=>t.variable))),xb(this.accumulatedUpdates.map((t=>t.variable))))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){const e=(t=await this.extractIterations(t)).length/2;this.accumulatedGrads=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedUpdates=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}Dx.className="Adadelta",Yb(Dx);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Fx extends Rx{constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Ey.registeredVariables[e];if(null==this.accumulatedGrads[n]){const t=!1;this.accumulatedGrads[n]={originalName:`${e}/accumulator`,variable:vb((()=>nv(r.shape,this.initialAccumulatorValue).variable(t)))}}const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const o=this.accumulatedGrads[n].variable;vb((()=>{const t=Zb(o,Kw(s));o.assign(t);const e=Zb(ew(tw(s,Hw(Zb(t,Ey.backend.epsilon()))),-this.learningRate),r);r.assign(e)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&xb(this.accumulatedGrads.map((t=>t.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulatedGrads=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}Fx.className="Adagrad",Yb(Fx);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Lx extends Rx{constructor(t,e,n,r=null){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],vb((()=>{this.accBeta1=qw(e).variable(),this.accBeta2=qw(n).variable()})),null==r&&(this.epsilon=Ey.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);vb((()=>{const n=hv(1,this.accBeta1),r=hv(1,this.accBeta2);e.forEach(((e,s)=>{const o=Ey.registeredVariables[e];null==this.accumulatedFirstMoment[s]&&(this.accumulatedFirstMoment[s]={originalName:`${e}/m`,variable:vb((()=>Mw(o).variable(false)))}),null==this.accumulatedSecondMoment[s]&&(this.accumulatedSecondMoment[s]={originalName:`${e}/v`,variable:vb((()=>Mw(o).variable(false)))});const i=Array.isArray(t)?t[s].tensor:t[e];if(null==i)return;const a=this.accumulatedFirstMoment[s].variable,u=this.accumulatedSecondMoment[s].variable,c=Zb(ew(a,this.beta1),ew(i,1-this.beta1)),l=Zb(ew(u,this.beta2),ew(Kw(i),1-this.beta2)),f=tw(c,n),h=tw(l,r);a.assign(c),u.assign(l);const p=Zb(ew(tw(f,Zb(Hw(h),this.epsilon)),-this.learningRate),o);o.assign(p)})),this.accBeta1.assign(ew(this.accBeta1,this.beta1)),this.accBeta2.assign(ew(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&xb(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedSecondMoment&&xb(this.accumulatedSecondMoment.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t),vb((()=>{this.accBeta1.assign(Gw(this.beta1,this.iterations_+1)),this.accBeta2.assign(Gw(this.beta2,this.iterations_+1))}));const e=t.length/2;this.accumulatedFirstMoment=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedSecondMoment=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}Lx.className="Adam",Yb(Lx);
/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/
class Px extends Rx{constructor(t,e,n,r=null,s=0){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],vb((()=>{this.iteration=qw(0).variable(),this.accBeta1=qw(e).variable()})),null==r&&(this.epsilon=Ey.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);vb((()=>{const n=hv(1,this.accBeta1),r=tw(-this.learningRate,Zb(ew(this.iteration,this.decay),1));e.forEach(((e,s)=>{const o=Ey.registeredVariables[e];null==this.accumulatedFirstMoment[s]&&(this.accumulatedFirstMoment[s]={originalName:`${e}/m`,variable:Mw(o).variable(false)}),null==this.accumulatedWeightedInfNorm[s]&&(this.accumulatedWeightedInfNorm[s]={originalName:`${e}/v`,variable:Mw(o).variable(false)});const i=Array.isArray(t)?t[s].tensor:t[e];if(null==i)return;const a=this.accumulatedFirstMoment[s].variable,u=this.accumulatedWeightedInfNorm[s].variable,c=Zb(ew(a,this.beta1),ew(i,1-this.beta1)),l=ew(u,this.beta2),f=nw(i),h=bv(l,f);a.assign(c),u.assign(h);const p=Zb(ew(tw(r,n),tw(c,Zb(h,this.epsilon))),o);o.assign(p)})),this.iteration.assign(Zb(this.iteration,1)),this.accBeta1.assign(ew(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&xb(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedWeightedInfNorm&&xb(this.accumulatedWeightedInfNorm.map((t=>t.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}Px.className="Adamax",Yb(Px);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Bx extends Rx{constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);e.forEach(((e,n)=>{const r=Array.isArray(t)?t[n].tensor:t[e];if(null==r)return;const s=Ey.registeredVariables[e];vb((()=>{const t=Zb(ew(this.c,r),s);s.assign(t)}))})),this.incrementIterations()}setLearningRate(t){var e;this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=(e=qw(-t),Ey.keep(e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(0!==(t=await this.extractIterations(t)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}Bx.className="SGD",Yb(Bx);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Vx extends Bx{constructor(t,e,n=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=n,this.accumulations=[],this.m=qw(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Ey.registeredVariables[e];if(null==this.accumulations[n]){const t=!1;this.accumulations[n]={originalName:`${e}/momentum`,variable:vb((()=>Mw(r).variable(t)))}}const s=this.accumulations[n].variable,o=Array.isArray(t)?t[n].tensor:t[e];null!=o&&vb((()=>{let t;const e=Zb(ew(this.m,s),o);t=this.useNesterov?Zb(ew(this.c,Zb(o,ew(e,this.m))),r):Zb(ew(this.c,e),r),s.assign(e),r.assign(t)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&xb(this.accumulations.map((t=>t.variable)))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulations=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}Vx.className="Momentum",Yb(Vx);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class zx extends Rx{constructor(t,e=.9,n=0,r=null,s=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,null==r&&(this.epsilon=Ey.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Ey.registeredVariables[e],s=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${e}/rms`,variable:vb((()=>Mw(r).variable(s)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${e}/momentum`,variable:vb((()=>Mw(r).variable(s)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${e}/mg`,variable:vb((()=>Mw(r).variable(s)))});const o=Array.isArray(t)?t[n].tensor:t[e];if(null==o)return;const i=this.accumulatedMeanSquares[n].variable,a=this.accumulatedMoments[n].variable;vb((()=>{const t=Zb(ew(i,this.decay),ew(Kw(o),1-this.decay));if(this.centered){const e=this.accumulatedMeanGrads[n].variable,s=Zb(ew(e,this.decay),ew(o,1-this.decay)),u=tw(ew(o,this.learningRate),Hw(hv(t,Zb(Kw(s),this.epsilon)))),c=Zb(ew(a,this.momentum),u);i.assign(t),e.assign(s),a.assign(c);const l=hv(r,c);r.assign(l)}else{const t=Zb(ew(i,this.decay),ew(Kw(o),1-this.decay)),e=Zb(ew(a,this.momentum),tw(ew(o,this.learningRate),Hw(Zb(t,this.epsilon))));i.assign(t),a.assign(e);const n=hv(r,e);r.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&xb(this.accumulatedMeanSquares.map((t=>t.variable))),null!=this.accumulatedMeanGrads&&this.centered&&xb(this.accumulatedMeanGrads.map((t=>t.variable))),null!=this.accumulatedMoments&&xb(this.accumulatedMoments.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,n=!1;this.accumulatedMeanSquares=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.accumulatedMoments=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}zx.className="RMSProp",Yb(zx);
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Wx="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:t=>t();
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ux(t,e){const n=t[0].length;t.forEach(((t,e)=>{jp(t.length===n,(()=>`Error in concat${n}D: rank of tensors[${e}] must be the same as the rank of the rest (${n})`))})),jp(e>=0&&e<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));const r=t[0];t.forEach(((t,s)=>{for(let o=0;o<n;o++)jp(o===e||t[o]===r[o],(()=>`Error in concat${n}D: Shape of tensors[${s}] (${t}) does not match the shape of the rest (${r}) along the non-concatenated axis ${s}.`))}))}function jx(t,e){const n=t[0].slice();for(let r=1;r<t.length;r++)n[e]+=t[r][e];return n}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gx(t){return t<=30?t:cd(t,Math.floor(Math.sqrt(t)))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qx(t,e,n){return[n*("number"==typeof t?t:t[0]),e*("number"==typeof t?t:t[1])]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hx(t,e,n,r=!0){let s=[];if(r)s=s.concat(e.slice(0)),s.push(t[0]/n),s=s.concat(t.slice(1));else{s=s.concat(t[0]);const n=e.length;for(let r=0;r<n;++r)s=s.concat([t[r+1]/e[r],e[r]]);s=s.concat(t.slice(n+1))}return s}function Kx(t,e,n=!0){const r=[];if(n){r.push(e);for(let n=e+1;n<t;++n)n<=2*e?(r.push(n),r.push(n-(e+1))):r.push(n)}else{const n=[],s=[];for(let r=1;r<t;++r)r>=2*e+1||r%2==1?s.push(r):n.push(r);r.push(...n),r.push(0),r.push(...s)}return r}function Xx(t,e,n,r=!0){const s=[];r?s.push(t[0]/n):s.push(t[0]*n);for(let n=1;n<t.length;++n)n<=e.length?r?s.push(e[n-1]*t[n]):s.push(t[n]/e[n-1]):s.push(t[n]);return s}function Jx(t,e){const n=[0];for(let r=0;r<e;++r)n.push(t[r][0]);return n}function Yx(t,e,n){const r=t.slice(0,1);for(let s=0;s<n;++s)r.push(t[s+1]-e[s][0]-e[s][1]);return r}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Zx(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(2*t.length);for(let r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Qx=/->/g;function tN(t,e){const n=((t=t.replace(/\s/g,"")).length-t.replace(Qx,"").length)/"->".length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("->").');const[r,s]=t.split("->");jp(-1===r.indexOf("..."),(()=>'The ellipsis notation ("...") is not supported yet.'));const o=r.split(","),i=o.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let t=0;t<s.length;++t){const e=s[t];if(!o.some((t=>-1!==t.indexOf(e))))throw new Error(`Output subscripts contain the label ${e} not present in the input subscripts.`);-1===a.indexOf(e)&&a.push(e)}for(let t=0;t<r.length;++t){const e=r[t];-1===a.indexOf(e)&&","!==e&&a.push(e)}const u=new Array(o.length);for(let t=0;t<i;++t){if(new Set(o[t].split("")).size!==o[t].length)throw new Error(`Found duplicate axes in input component ${o[t]}. Support for duplicate axes in input is not implemented yet.`);u[t]=[];for(let e=0;e<o[t].length;++e)u[t].push(a.indexOf(o[t][e]))}const c=a.length,l=[];for(let t=s.length;t<c;++t)l.push(t);return{allDims:a,summedDims:l,idDims:u}}function eN(t,e){let n=new Array(t);n.fill(-1);for(let t=0;t<e.length;++t)n[e[t]]=t;const r=[];for(let e=0;e<t;++e)-1===n[e]&&r.push(e);return n=n.filter((t=>-1!==t)),{permutationIndices:n,expandDims:r}}function nN(t,e,n){const r=new Array(t);for(let t=0;t<n.length;++t){const s=n[t].shape;for(let n=0;n<e[t].length;++n)void 0===r[e[t][n]]?r[e[t][n]]=s[n]:jp(r[e[t][n]]===s[n],(()=>`Expected dimension ${r[e[t][n]]} at axis ${n} of input shaped ${JSON.stringify(s)}, but got dimension ${s[n]}`))}}function rN(t,e){const n=t,r=[];let s=0;0===t.length&&n.push(-1),s=t.length+1;for(let t=0;t<s;++t)r.push([]);const o=[];for(let t=0;t<n.length;++t){const s=oN(e,n[t]);for(const e of s)-1===o.indexOf(e)&&(r[t].push(e),o.push(e))}return{path:n,steps:r}}function sN(t){return t.every(((t,e)=>t===e))}function oN(t,e){const n=[];for(let r=0;r<t.length;++r)0!==t[r].length&&-1===t[r].indexOf(e)&&-1!==e||n.push(r);return n}function iN(t,e,n=0){let r=[];if("number"==typeof e)jp(t.shape[n]%e==0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(e).fill(t.shape[n]/e);else{jp(e.reduce(((t,e)=>(-1===e&&(t+=1),t)),0)<=1,(()=>"There should be only one negative value in split array."));const s=e.indexOf(-1);if(-1!==s){const r=e.reduce(((t,e)=>e>0?t+e:t));e[s]=t.shape[n]-r}jp(t.shape[n]===e.reduce(((t,e)=>t+e)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=e}return r}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aN(t){return`Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ${t}`}function uN(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function cN(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lN(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function fN(t,e){return`size ${t} must be non-negative, not ${e}`}function hN(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function pN(t,e){return`Input to reshape is a SparseTensor with ${Kp(t)}\n  dense values, but the requested shape requires a multiple of ${Kp(e)}. inputShape=${t} outputShape= ${e}`}function dN(t,e){return`Input to reshape is a tensor with ${Kp(t)} dense values, but the requested shape has ${Kp(e)}. inputShape=${t} outputShape=${e}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mN(){return"segment ids must be >= 0"}function yN(){return"segment ids are not increasing"}function gN(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function bN(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wN(t,e){let n,r=!1;for(t<=30?(n=t,r=!0):n=cd(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=cd(t,n+1);return n}function vN(t,e,n){const r=[],s=t.length;for(let o=0;o<s;o++)o!==e?r.push(t[o]):r.push(n);return r}function xN(t,e,n,r){const s=e.shape.length,o=t.shape.length;if(0!==r&&(r<-s||r>s))throw new Error(`Expect batchDims in the range of [-${s}, ${s}], but got ${r}`);if(r<0&&(r+=s),r>o)throw new Error(`batchDims (${r}) must be less than rank(x) (\n    ${o}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let n=0;n<r;++n)if(t.shape[n]!==e.shape[n])throw new Error(`x.shape[${n}]: ${t.shape[n]} should be equal to indices.shape[${n}]: ${e.shape[n]}.`);const i=t.shape[n],a=[];let u=1,c=1,l=1;for(let e=0;e<r;++e)a.push(t.shape[e]),u*=t.shape[e];for(let e=r;e<n;e++)a.push(t.shape[e]),c*=t.shape[e];for(let t=r;t<s;t++)a.push(e.shape[t]);for(let e=n+1;e<o;e++)a.push(t.shape[e]),l*=t.shape[e];return{batchSize:u,sliceSize:l,outerSize:c,dimSize:i,outputShape:a}}var NN=Object.freeze({__proto__:null,segOpComputeOptimalWindowSize:wN,computeOutShape:vN,collectGatherOpShapeInfo:xN});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $N(t){try{return t.map((t=>Xm(t)))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function EN(t){return t.map((t=>Km(t)))}var SN=Object.freeze({__proto__:null,slice_util:Xb,segment_util:NN,fromUint8ToStringArray:$N,fromStringArrayToUint8:EN,upcastType:my,axesAreInnerMostDims:Dw,combineLocations:Fw,computeOutAndReduceShapes:Lw,expandShapeToKeepDim:Pw,assertAxesAreInnerMostDims:Bw,getAxesPermutation:Vw,getUndoAxesPermutation:zw,getInnerMostAxes:Ww,getBroadcastDims:_b,getReductionAxes:Tb,assertAndGetBroadcastShape:kb,assertParamsConsistent:Ux,computeOutShape:jx,computeDilation2DInfo:rw,computePool2DInfo:sw,computePool3DInfo:ow,computeConv2DInfo:iw,computeConv3DInfo:aw,computeDefaultPad:uw,tupleValuesAreOne:pw,eitherStridesOrDilationsAreOne:dw,convertConv2DDataFormat:mw,checkPadOnDimRoundingMode:yw,getFusedDyActivation:yx,getFusedBiasGradient:gx,applyActivation:bx,shouldFuse:wx,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:Gx,getImageCenter:qx,getReshaped:Hx,getPermuted:Kx,getReshapedPermuted:Xx,getSliceBeginCoords:Jx,getSliceSize:Yx,prepareAndValidate:Cb,validateUpdateShape:Ob,validateInput:Ib,calculateShapes:Mb,SELU_SCALEALPHA:1.7580993408473768,SELU_SCALE:1.0507009873554805,ERF_P:.3275911,ERF_A1:.254829592,ERF_A2:-.284496736,ERF_A3:1.421413741,ERF_A4:-1.453152027,ERF_A5:1.061405429,warn:Zd,log:function(...t){xd().getBool("IS_TEST")||xd().getBool("PROD")||console.log(...t)},mergeRealAndImagArrays:Zx,splitRealAndImagArrays:function(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}},complexWithEvenIndex:function(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=0;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}},complexWithOddIndex:function(t){const e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=2;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}},getComplexWithIndex:function(t,e){return{real:t[2*e],imag:t[2*e+1]}},assignToTypedArray:function(t,e,n,r){t[2*r]=e,t[2*r+1]=n},exponents:function(t,e){const n=new Float32Array(t/2),r=new Float32Array(t/2);for(let s=0;s<Math.ceil(t/2);s++){const o=(e?2:-2)*Math.PI*(s/t);n[s]=Math.cos(o),r[s]=Math.sin(o)}return{real:n,imag:r}},exponent:function(t,e,n){const r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}},decodeEinsumEquation:tN,getEinsumPermutation:eN,checkEinsumDimSizes:nN,getEinsumComputePath:rN,isIdentityPermutation:sN,prepareSplitSize:iN,getSparseFillEmptyRowsIndicesDenseShapeMismatch:aN,getSparseFillEmptyRowsNegativeIndexErrorMessage:uN,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:cN,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:lN,getSparseReshapeNegativeOutputDimErrorMessage:fN,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:hN,getSparseReshapeInputOutputMultipleErrorMessage:pN,getSparseReshapeInputOutputMismatchErrorMessage:dN,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:mN,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:yN,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:gN,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:bN});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _N={},TN={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function kN(t,e){if(!(t in _N)||null!=e){const n=function(t,e){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=null==e?function(t){if("undefined"!=typeof OffscreenCanvas&&2===t)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t):e;if(n.addEventListener("webglcontextlost",(e=>{e.preventDefault(),delete _N[t]}),!1),1===t)return n.getContext("webgl",TN)||n.getContext("experimental-webgl",TN);return n.getContext("webgl2",TN)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e);if(null===n)return console.log("Could not get context for WebGL version",t),null;_N[t]=n}const n=_N[t];return null==n||n.isContextLost()?(delete _N[t],kN(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),_N[t])}var AN,CN,ON;function IN(t,e){return[e,t]}function MN(t){const e=Kp(t);return Yp(Math.ceil(e/4))}function RN(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function DN(t,e){const n=t;let r,s,o,i,a,u,c,l,f,h;return 2===xd().getNumber("WEBGL_VERSION")?(r=n.R32F,s=n.R16F,o=n.RGBA16F,i=n.RGBA32F,a=n.RED,c=4,l=1,f=n.HALF_FLOAT,h=n.FLOAT,u=n.RGBA8):(r=t.RGBA,s=t.RGBA,o=t.RGBA,i=n.RGBA,a=t.RGBA,c=4,l=4,f=null!=e?e.HALF_FLOAT_OES:null,h=t.FLOAT,u=t.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:s,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:u,downloadUnpackNumChannels:c,defaultNumChannels:l,textureTypeHalfFloat:f,textureTypeFloat:h}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FN(t,e){const n=e();return xd().getBool("DEBUG")&&function(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+function(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}(t,e))}(t),n}!function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"}(AN||(AN={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(CN||(CN={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(ON||(ON={}));function LN(t){return!!(xd().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||5.96e-8<Math.abs(t)&&Math.abs(t)<65504)}function PN(t,e){return HN(t,(()=>t.getExtension(e)),'Extension "'+e+'" not supported on this browser.')}const BN=/ERROR: [0-9]+:([0-9]+):/g;function VN(t,e){const n=BN.exec(e);if(null==n)return console.log(`Couldn't parse line number in error: ${e}`),void console.log(t);const r=+n[1],s=t.split("\n"),o=s.length.toString().length+2,i=s.map(((t,e)=>Zp((e+1).toString(),o)+t));let a=0;for(let t=0;t<i.length;t++)a=Math.max(i[t].length,a);const u=i.slice(0,r-1),c=i.slice(r-1,r),l=i.slice(r);console.log(u.join("\n")),console.log(e.split("\n")[0]),console.log(`%c ${Zp(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(l.join("\n"))}function zN(t,e){if(FN(t,(()=>t.validateProgram(e))),!1===t.getProgramParameter(e,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function WN(t,e,n,r,s,o,i){const a=t.getAttribLocation(e,n);return-1!==a&&(FN(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,r))),FN(t,(()=>t.vertexAttribPointer(a,s,t.FLOAT,!1,o,i))),FN(t,(()=>t.enableVertexAttribArray(a))),!0)}function UN(t,e,n){!function(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n){throw new Error(`textureUnit must be in ${`[gl.TEXTURE0, gl.TEXTURE${n}]`}.`)}}(t,n),FN(t,(()=>t.activeTexture(t.TEXTURE0+n))),FN(t,(()=>t.bindTexture(t.TEXTURE_2D,e)))}function jN(t,e,n){FN(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,n))),FN(t,(()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)))}function GN(t,e){FN(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,e))),FN(t,(()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)))}function qN(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}(t,e))}function HN(t,e,n){const r=FN(t,(()=>e()));if(null==r)throw new Error(n);return r}function KN(t,e=2){return Kp(t.slice(0,t.length-e))}function XN(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function JN(t){let e=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(e=[KN(t),...XN(t)]),e}function YN(t){return t%2==0}function ZN(t,e){if(Xp(t=t.slice(-2),e=e.slice(-2)))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){const n=t.slice(-1)[0],r=e.slice(-1)[0];if(n===r)return!0;if(YN(n)&&YN(r)&&(1===t[0]||1===e[0]))return!0}return t[1]===e[1]&&YN(t[0])&&YN(e[0])}let QN,t$;function e$(t,e){return null!=t.getExtension(e)}function n$(t){try{if(null!=kN(t))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function r$(t){if(0===t)return!1;const e=kN(t);if(1!==t){if(e$(e,"EXT_color_buffer_float"))return s$(e);const t="EXT_color_buffer_half_float";if(e$(e,t)){const n=e.getExtension(t);return function(t,e){const n=DN(t,e),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);const s=1,o=1;t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,s,o,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(i),a}(e,n)}return!1}if(!e$(e,"OES_texture_float"))return!1;if(!e$(e,"WEBGL_color_buffer_float"))return!1;return s$(e)}function s$(t){const e=DN(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const s=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),s}function o$(t,e){Array.isArray(t)||(t=[t]),t.forEach((t=>{null!=t&&jp("complex64"!==t.dtype,(()=>`${e} does not support complex64 tensors in the WebGL backend.`))}))}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i$=xd();
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function a$(){let t,e,n,r,s,o,i,a,u,c;return 2===xd().getNumber("WEBGL_VERSION")?(t="#version 300 es",e="in",n="out",r="in",s="texture",o="outputColor",i="out vec4 outputColor;",a="\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",n="varying",r="varying",s="texture2D",o="gl_FragColor",i="",a="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:s,output:o,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:u,defineRound:c}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u$(t,e,n="index"){const r=ld(e);return r.map(((e,s)=>`${`int ${t[s]} = ${n} / ${e}`}; ${s===r.length-1?`int ${t[s+1]} = ${n} - ${t[s]} * ${e}`:`index -= ${t[s]} * ${e}`};`)).join("")}function c$(t,e,n="index"){const r=ld(e);return r.map(((e,s)=>`${`int ${t[s]} = ${n} / outShapeStrides[${s}]`}; ${s===r.length-1?`int ${t[s+1]} = ${n} - ${t[s]} * outShapeStrides[${s}]`:`index -= ${t[s]} * outShapeStrides[${s}]`};`)).join("")}function l$(t,e,n="index"){const r=t.map(((t,e)=>e)),s=function(t,e){const n=t.length,r=t.map((t=>`${e}[${t}]`)),s=new Array(n-1);s[n-2]=r[n-1];for(let t=n-3;t>=0;--t)s[t]=`(${s[t+1]} * ${r[t+1]})`;return s}(r,e);return s.map(((e,r)=>`${`int ${t[r]} = ${n} / ${s[r]}`}; ${r===s.length-1?`int ${t[r+1]} = ${n} - ${t[r]} * ${s[r]}`:`index -= ${t[r]} * ${s[r]}`};`)).join("")}function f$(t){const e=ld(t).map((t=>t.toString()));return`\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;\n  }\n`}i$.registerFlag("HAS_WEBGL",(()=>i$.getNumber("WEBGL_VERSION")>0)),i$.registerFlag("WEBGL_VERSION",(()=>n$(2)?2:n$(1)?1:0)),i$.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(()=>!1)),i$.registerFlag("WEBGL_BUFFER_SUPPORTED",(()=>2===i$.get("WEBGL_VERSION"))),i$.registerFlag("WEBGL_CPU_FORWARD",(()=>!0)),i$.registerFlag("WEBGL_FORCE_F16_TEXTURES",(()=>!1)),i$.registerFlag("WEBGL_PACK",(()=>i$.getBool("HAS_WEBGL"))),i$.registerFlag("WEBGL_PACK_NORMALIZATION",(()=>i$.getBool("WEBGL_PACK"))),i$.registerFlag("WEBGL_PACK_CLIP",(()=>i$.getBool("WEBGL_PACK"))),i$.registerFlag("WEBGL_PACK_DEPTHWISECONV",(()=>i$.getBool("WEBGL_PACK"))),i$.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(()=>i$.getBool("WEBGL_PACK"))),i$.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(()=>i$.getBool("WEBGL_PACK"))),i$.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(()=>i$.getBool("WEBGL_PACK"))),i$.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(()=>i$.getBool("WEBGL_PACK"))),i$.registerFlag("WEBGL_PACK_REDUCE",(()=>i$.getBool("WEBGL_PACK"))),i$.registerFlag("WEBGL_LAZILY_UNPACK",(()=>i$.getBool("WEBGL_PACK"))),i$.registerFlag("WEBGL_CONV_IM2COL",(()=>i$.getBool("WEBGL_PACK"))),i$.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(()=>function(t){if(null==QN){const e=kN(t);QN=e.getParameter(e.MAX_TEXTURE_SIZE)}return QN}(i$.getNumber("WEBGL_VERSION")))),i$.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(()=>function(t){if(null==t$){const e=kN(t);t$=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,t$)}(i$.getNumber("WEBGL_VERSION")))),i$.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(()=>{const t=i$.getNumber("WEBGL_VERSION");return 0===t?0:function(t){if(0===t)return 0;let e;const n=kN(t);return e=e$(n,"EXT_disjoint_timer_query_webgl2")&&2===t?2:e$(n,"EXT_disjoint_timer_query")?1:0,e}(t)})),i$.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(()=>i$.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!_y())),i$.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(()=>function(t){if(0===t)return!1;const e=kN(t);if(1===t){if(!e$(e,"OES_texture_float"))return!1}else if(!e$(e,"EXT_color_buffer_float"))return!1;return s$(e)}(i$.getNumber("WEBGL_VERSION")))),i$.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(()=>!i$.getBool("WEBGL_FORCE_F16_TEXTURES")&&i$.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))),i$.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(()=>r$(i$.getNumber("WEBGL_VERSION")))),i$.registerFlag("WEBGL_FENCE_API_ENABLED",(()=>{return 2===(t=i$.getNumber("WEBGL_VERSION"))&&null!=kN(t).fenceSync;var t})),i$.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(()=>i$.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0)),i$.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(()=>-1),(t=>{if(t<0&&-1!==t)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)})),i$.registerFlag("WEBGL_FLUSH_THRESHOLD",(()=>_y()?1:-1),(t=>{if(t<0&&-1!==t)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)})),i$.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(()=>128)),i$.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(()=>!1)),i$.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(()=>1e5)),i$.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(()=>128));const h$="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:p$}=SN;
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d$(t,e,n){const r=[];if(t.forEach((t=>{const e=Kp(t.shapeInfo.logicalShape);if(t.shapeInfo.isUniform?r.push(`uniform float ${t.name}${e>1?`[${e}]`:""};`):(r.push(`uniform sampler2D ${t.name};`),r.push(`uniform int offset${t.name};`)),n.enableShapeUniforms){const{uniformShape:e}=S$(n.packedInputs,t.shapeInfo.logicalShape,t.shapeInfo.texShape);switch(e.length){case 1:r.push(`uniform int ${t.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${t.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${t.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${t.name}Shape;`)}r.push(`uniform ivec2 ${t.name}TexShape;`)}})),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((t=>{r.push(`uniform ${t.type} ${t.name}${t.arrayIndex?`[${t.arrayIndex}]`:""};`)}));const s=r.join("\n"),o=t.map((t=>function(t,e,n=!1,r){let s="";s+=n?y$(t,r):m$(t,r);const o=t.shapeInfo.logicalShape,i=e.logicalShape;o.length<=i.length&&(s+=n?function(t,e){const n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),s="get"+r+"AtOutCoords",o=t.shapeInfo.logicalShape.length,i=e.logicalShape.length,a=p$(t.shapeInfo.logicalShape,e.logicalShape),u=E$(i),c=i-o;let l;const f=["x","y","z","w","u","v"];l=0===o?"":i<2&&a.length>=1?"coords = 0;":a.map((t=>`coords.${f[t+c]} = 0;`)).join("\n");let h="";h=i<2&&o>0?"coords":t.shapeInfo.logicalShape.map(((t,e)=>`coords.${f[e+c]}`)).join(", ");let p="return outputValue;";const d=1===Kp(t.shapeInfo.logicalShape),m=1===Kp(e.logicalShape);if(1!==o||d||m){if(d&&!m)p=1===i?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(a.length){const t=o-2,e=o-1;a.indexOf(t)>-1&&a.indexOf(e)>-1?p="return vec4(outputValue.x);":a.indexOf(t)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(e)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return`\n    vec4 ${s}() {\n      ${u} coords = getOutputCoords();\n      ${l}\n      vec4 outputValue = get${r}(${h});\n      ${p}\n    }\n  `}(t,e):function(t,e){const n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),s="get"+r+"AtOutCoords",o=e.texShape,i=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===u&&null==t.shapeInfo.flatOffset&&Xp(i,o))return`\n      float ${s}() {\n        return sampleTexture(${n}, resultUV);\n      }\n    `;const c=E$(u),l=p$(t.shapeInfo.logicalShape,e.logicalShape),f=u-a;let h;const p=["x","y","z","w","u","v"];h=0===a?"":u<2&&l.length>=1?"coords = 0;":l.map((t=>`coords.${p[t+f]} = 0;`)).join("\n");let d="";d=u<2&&a>0?"coords":t.shapeInfo.logicalShape.map(((t,e)=>`coords.${p[e+f]}`)).join(", ");return`\n    float ${s}() {\n      ${c} coords = getOutputCoords();\n      ${h}\n      return get${r}(${d});\n    }\n  `}(t,e));return s}(t,e,n.packedInputs,n.enableShapeUniforms))).join("\n"),i=e.texShape,a=a$(),u=function(t){return`\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ${t.texture2D}(textureSampler, uv).r;\n    }\n  `}(a);let c,l,f=function(t){return`${t.version}\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ${t.varyingFs} vec2 resultUV;\n    ${t.defineOutput}\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ${t.defineSpecialNaN}\n    ${t.defineSpecialInf}\n    ${t.defineRound}\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ${g$}\n    ${b$}\n    ${w$}\n  `}(a);e.isPacked?(c=function(t,e,n){switch(t.length){case 0:return x$();case 1:return function(t,e,n){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(1===r[0])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ${r[1]}.0);\n      }\n    `;if(1===r[1])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ${r[0]}.0);\n      }\n    `;if(n)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);\n    }\n  `}(0,e,n);case 2:return function(t,e,n){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Xp(t,e))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));\n      }\n    `;const s=Math.ceil(t[1]/2);if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n      int r = 2 * (index / ${s});\n      int c = imod(index, ${s}) * 2;\n\n      return ivec2(r, c);\n    }\n  `}(t,e,n);case 3:return function(t,e,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(t[2]/2),o=s*Math.ceil(t[1]/2);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      int b = index / ${o};\n      index -= b * ${o};\n\n      int r = 2 * (index / ${s});\n      int c = imod(index, ${s}) * 2;\n\n      return ivec3(b, r, c);\n    }\n  `}(t,e,n);default:return function(t,e,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(t[t.length-1]/2),o=s*Math.ceil(t[t.length-2]/2);let i=o,a="",u="b, r, c";for(let e=2;e<t.length-1;e++)i*=t[t.length-e-1],a=`\n      int b${e} = index / ${i};\n      index -= b${e} * ${i};\n    `+a,u=`b${e}, `+u;return`\n    ivec${t.length} getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      ${a}\n\n      int b = index / ${o};\n      index -= b * ${o};\n\n      int r = 2 * (index / ${s});\n      int c = imod(index, ${s}) * 2;\n\n      return ivec${t.length}(${u});\n    }\n  `}(t,e,n)}}(e.logicalShape,i,n.enableShapeUniforms),l=function(t){return`\n    void setOutput(vec4 val) {\n      ${t.output} = val;\n    }\n  `}(a)):(c=function(t,e,n){switch(t.length){case 0:return x$();case 1:return function(t,e,n){if(1===e[0])return n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.x * ${e[1]}.0);\n      }\n    `;if(1===e[1])return n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.y * ${e[0]}.0);\n      }\n    `;if(n)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      return resTexRC.x * ${e[1]} + resTexRC.y;\n    }\n  `}(0,e,n);case 2:return function(t,e,n){if(Xp(t,e))return n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));\n      }\n    `;if(1===t[1])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${e[0]}, ${e[1]}));\n        int index = resTexRC.x * ${e[1]} + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    `;if(1===t[0])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${e[0]}, ${e[1]}));\n        int index = resTexRC.x * ${e[1]} + resTexRC.y;\n        return ivec2(0, index);\n      }\n    `;if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      int r = index / ${t[1]};\n      int c = index - r * ${t[1]};\n      return ivec2(r, c);\n    }\n  `}(t,e,n);case 3:return function(t,e,n){if(n){return`\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ${c$(["r","c","d"],t)}\n    return ivec3(r, c, d);\n  }\n`}const r=u$(["r","c","d"],t);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      ${r}\n      return ivec3(r, c, d);\n    }\n  `}(t,e,n);case 4:return function(t,e,n){if(n){return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ${c$(["r","c","d","d2"],t)}\n      return ivec4(r, c, d, d2);\n    }\n  `}const r=u$(["r","c","d","d2"],t);return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      ${r}\n      return ivec4(r, c, d, d2);\n    }\n  `}(t,e,n);case 5:return function(t,e){const n=u$(["r","c","d","d2","d3"],t);return`\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},\n                             ${e[1]}));\n\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  `}(t,e);case 6:return function(t,e){const n=u$(["r","c","d","d2","d3","d4"],t);return`\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  `}(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}(e.logicalShape,i,n.enableShapeUniforms),l=function(t){return`\n    void setOutput(float val) {\n      ${t.output} = vec4(val, 0, 0, 0);\n    }\n  `}(a)),n.packedInputs&&(f+=v$);return[f,u,l,s,c,o,n.userCode].join("\n")}function m$(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;const[s,o]=t.shapeInfo.texShape;if(1===s&&1===o)return`\n      float ${r}() {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const i=N$(n);if(e)return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${i});\n      return sampleTexture(${n}, uv);\n    }\n  `;const[a,u]=t.shapeInfo.texShape;return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${a}, ${u}, ${i});\n      return sampleTexture(${n}, uv);\n    }\n  `}(t,e);case 1:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`\n      float ${r}(int index) {\n        ${$$(t)}\n      }\n    `;const s=t.shapeInfo.texShape,o=s[0],i=s[1];if(1===i&&1===o)return`\n      float ${r}(int index) {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const a=N$(n);if(1===i)return e?`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${o}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(1===o)return e?`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(e)return`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});\n      return sampleTexture(${n}, uv);\n    }\n  `;return`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${o}, ${i}, index + ${a});\n      return sampleTexture(${n}, uv);\n    }\n  `}(t,e);case 2:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t.shapeInfo.texShape;if(null!=o&&Xp(n,o)){if(e)return`\n      float ${s}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `;const t=o[0];return`\n    float ${s}(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(${o[1]}.0, ${t}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `}const{newShape:i,keptDims:a}=ed(n),u=i;if(u.length<n.length){const n=["row","col"];return`\n      ${m$(_$(t,u),e)}\n      float ${s}(int row, int col) {\n        return ${s}(${T$(n,a)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${s}(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));\n        ${$$(t)}\n      }\n    `;const c=o[0],l=o[1],f=N$(r);if(1===l)return e?`\n      float ${s}(int row, int col) {\n        float index = dot(vec3(row, col, ${f}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${s}(int row, int col) {\n      float index = dot(vec3(row, col, ${f}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `;if(1===c)return e?`\n      float ${s}(int row, int col) {\n        float index = dot(vec3(row, col, ${f}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${s}(int row, int col) {\n      float index = dot(vec3(row, col, ${f}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2((index + 0.5) / ${l}.0, 0.5);\n      return sampleTexture(${r}, uv);\n    }\n  `;if(e)return`\n      float ${s}(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${r}Shape[1] + col + ${f};\n        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n        return sampleTexture(${r}, uv);\n      }\n    `;return`\n  float ${s}(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ${n[1]} + col + ${f};\n    vec2 uv = uvFromFlat(${c}, ${l}, index);\n    return sampleTexture(${r}, uv);\n  }\n`}(t,e);case 3:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n[1]*n[2],i=n[2],{newShape:a,keptDims:u}=ed(n),c=a;if(c.length<n.length){const n=["row","col","depth"];return`\n        ${m$(_$(t,c),e)}\n        float ${s}(int row, int col, int depth) {\n          return ${s}(${T$(n,u)});\n        }\n      `}if(t.shapeInfo.isUniform)return`\n      float ${s}(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(${o}, ${i}, 1)));\n        ${$$(t)}\n      }\n    `;const l=t.shapeInfo.texShape,f=l[0],h=l[1],p=t.shapeInfo.flatOffset;if(h===o&&null==p)return e?`\n      float ${s}(int row, int col, int depth) {\n        int stride1 = ${r}Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n        float ${s}(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(${i}, 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(${h}.0, ${f}.0);\n          return sampleTexture(${r}, uv);\n        }\n      `;if(h===i&&null==p)return e?`\n      float ${s}(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${s}(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${f}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `;const d=N$(r);if(e)return`\n    float ${s}(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ${r}Shape[1] * ${r}Shape[2];\n      int stride1 = ${r}Shape[2];\n      int index = row * ${o} + col * ${i} + depth + ${d};\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n      return sampleTexture(${r}, uv);\n    }\n    `;return`\n      float ${s}(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${o} + col * ${i} + depth + ${d};\n        vec2 uv = uvFromFlat(${f}, ${h}, index);\n        return sampleTexture(${r}, uv);\n      }\n  `}(t,e);case 4:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n[3],i=n[2]*o,a=n[1]*i,{newShape:u,keptDims:c}=ed(n);if(u.length<n.length){const n=["row","col","depth","depth2"];return`\n      ${m$(_$(t,u),e)}\n      float ${s}(int row, int col, int depth, int depth2) {\n        return ${s}(${T$(n,c)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${s}(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(${a}, ${i}, ${o}, 1)));\n        ${$$(t)}\n      }\n    `;const l=t.shapeInfo.flatOffset,f=t.shapeInfo.texShape,h=f[0],p=f[1],d=`int stride2 = ${r}Shape[3];`,m=`int stride1 = ${r}Shape[2] * stride2;`,y=`int stride0 = ${r}Shape[1] * stride1;`;if(p===a&&null==l)return e?`\n      float ${s}(int row, int col, int depth, int depth2) {\n        ${d}\n        ${m}\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${s}(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(${i}, ${o}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${h}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;if(p===o&&null==l)return e?`\n      float ${s}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${s}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${n[1]*n[2]}, ${n[2]}, 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${h}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;const g=N$(r);if(e)return`\n    float ${s}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ${d}\n      ${m}\n      ${y}\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${g});\n      return sampleTexture(${r}, uv);\n    }\n  `;return`\n    float ${s}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${a} + col * ${i} +\n          depth * ${o} + depth2;\n      vec2 uv = uvFromFlat(${h}, ${p}, index + ${g});\n      return sampleTexture(${r}, uv);\n    }\n  `}(t,e);case 5:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),s=e[4],o=e[3]*s,i=e[2]*o,a=e[1]*i,{newShape:u,keptDims:c}=ed(e);if(u.length<e.length){const e=["row","col","depth","depth2","depth3"];return`\n      ${m$(_$(t,u))}\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        return ${r}(${T$(e,c)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${a}, ${i}, ${o}, ${s})) +\n          depth3;\n        ${$$(t)}\n      }\n    `;const l=t.shapeInfo.flatOffset,f=t.shapeInfo.texShape,h=f[0],p=f[1];if(p===a&&null==l)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(${i}, ${o}, ${s}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${h}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(p===s&&null==l)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${e[1]*e[2]*e[3]},\n               ${e[2]*e[3]}, ${e[3]}, 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${h}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const d=N$(n);return`\n    float ${r}(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${a} + col * ${i} + depth * ${o} +\n          depth2 * ${s} + depth3 + ${d};\n      vec2 uv = uvFromFlat(${h}, ${p}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(t);case 6:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:s,keptDims:o}=ed(e);if(s.length<e.length){const e=["row","col","depth","depth2","depth3","depth4"];return`\n      ${m$(_$(t,s))}\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ${r}(${T$(e,o)});\n      }\n    `}const i=e[5],a=e[4]*i,u=e[3]*a,c=e[2]*u,l=e[1]*c;if(t.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(${l}, ${c}, ${u}, ${a})) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(${i}, 1)));\n        ${$$(t)}\n      }\n    `;const f=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,p=h[0],d=h[1];if(d===l&&null==f)return`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(${c}, ${u}, ${a}, ${i})) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${d}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(d===i&&null==f)return`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(${e[1]*e[2]*e[3]*e[4]},\n               ${e[2]*e[3]*e[4]},\n               ${e[3]*e[4]},\n               ${e[4]})) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${d}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const m=N$(n);return`\n    float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${l} + col * ${c} + depth * ${u} +\n          depth2 * ${a} + depth3 * ${i} + depth4 + ${m};\n      vec2 uv = uvFromFlat(${p}, ${d}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function y$(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return function(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=a$();return`\n    vec4 ${n}() {\n      return ${r.texture2D}(${e}, halfCR);\n    }\n  `}(t);case 1:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),s=t.shapeInfo.texShape,o=a$();if(e)return`\n    vec4 ${r}(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ${o.texture2D}(${n}, uv);\n    }\n  `;const i=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];return`\n    vec4 ${r}(int index) {\n      vec2 uv = packedUVfrom1D(\n        ${i[0]}, ${i[1]}, index);\n      return ${o.texture2D}(${n}, uv);\n    }\n  `}(t,e);case 2:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t.shapeInfo.texShape,i=o[0],a=o[1],u=a$();if(null!=o&&Xp(n,o))return e?`\n      vec4 ${s}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n\n        return ${u.texture2D}(${r}, uv);\n      }\n    `:`\n      vec4 ${s}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);\n\n        return ${u.texture2D}(${r}, uv);\n      }\n    `;if(e)return`\n    vec4 ${s}(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ${u.texture2D}(${r}, uv);\n    }\n  `;const c=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],l=Math.ceil(n[1]/2);return`\n    vec4 ${s}(int row, int col) {\n      vec2 uv = packedUVfrom2D(${l}, ${c[0]}, ${c[1]}, row, col);\n      return ${u.texture2D}(${r}, uv);\n    }\n  `}(t,e);case 3:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===n[0]){const r=[1,2],o=["b","row","col"];return`\n        ${y$(_$(t,n.slice(1)),e)}\n        vec4 ${s}(int b, int row, int col) {\n          return ${s}(${T$(o,r)});\n        }\n      `}const a=a$();if(e)return`\n    vec4 ${s}(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ${a.texture2D}(${r}, uv);\n    }\n  `;const u=i[0],c=i[1],l=Math.ceil(n[2]/2),f=l*Math.ceil(n[1]/2);return`\n    vec4 ${s}(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ${u}, ${c}, ${f}, ${l}, b, row, col);\n      return ${a.texture2D}(${r}, uv);\n    }\n  `}(t,e);default:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),s=a$();if(e)return`\n    vec4 ${r}(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ${n}Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${s.texture2D}(${n}, uv);\n    }\n  `;const o=t.shapeInfo.logicalShape,i=o.length,a=t.shapeInfo.texShape,u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=u[0],l=u[1],f=Math.ceil(o[i-1]/2);let h=f*Math.ceil(o[i-2]/2),p="int b, int row, int col",d=`b * ${h} + (row / 2) * ${f} + (col / 2)`;for(let t=2;t<i-1;t++)p=`int b${t}, `+p,h*=o[i-t-1],d=`b${t} * ${h} + `+d;return`\n    vec4 ${r}(${p}) {\n      int index = ${d};\n      int texR = index / ${l};\n      int texC = index - texR * ${l};\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${l}, ${c});\n      return ${s.texture2D}(${n}, uv);\n    }\n  `}(t,e)}}const g$="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",b$="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",w$="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",v$="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function x$(){return"\n    int getOutputCoords() {\n      return 0;\n    }\n  "}function N$(t){return`offset${t}`}function $$(t){const e=t.name,n=Kp(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`\n    for (int i = 0; i < ${n}; i++) {\n      if (i == index) {\n        return ${e}[i];\n      }\n    }\n  `}function E$(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function S$(t,e,n){const{newShape:r,keptDims:s}=ed(e),o=e.length,i=t&&3===o&&1===e[0],a=i?e.slice(1):r,u=!t&&o>1&&!Xp(e,n)&&r.length<o||i;return{useSqueezeShape:u,uniformShape:u?a:e,keptDims:s}}function _$(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function T$(t,e){return e.map((e=>t[e])).join(", ")}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k$(t,e,n,r){const s=n.map(((t,n)=>{const r={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(r.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[n],shapeInfo:r}})),o=s.map((t=>t.shapeInfo)),i={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},a=d$(s,i,e),u=function(t,e){const n=HN(t,(()=>t.createShader(t.FRAGMENT_SHADER)),"Unable to create fragment WebGLShader.");if(FN(t,(()=>t.shaderSource(n,e))),FN(t,(()=>t.compileShader(n))),xd().get("ENGINE_COMPILE_ONLY"))return n;if(!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw VN(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(t.gl,a),c=t.createProgram(u);return xd().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:u,source:a,webGLProgram:c,inShapeInfos:o,outShapeInfo:i,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:e,fragmentShader:u,source:a,webGLProgram:c,inShapeInfos:o,outShapeInfo:i},A$(t,e,c))}function A$(t,e,n){const r={},s={},o={},i=[];let a,u,c,l=null,f=null;f=t.getUniformLocation(n,"NAN",!1),1===xd().getNumber("WEBGL_VERSION")&&(l=t.getUniformLocation(n,"INFINITY",!1));const h=!1;for(let i=0;i<e.variableNames.length;i++){const a=e.variableNames[i];r[a]=t.getUniformLocation(n,a,h),r[`offset${a}`]=t.getUniformLocation(n,`offset${a}`,h),e.enableShapeUniforms&&(s[`${a}Shape`]=t.getUniformLocation(n,`${a}Shape`,h),o[`${a}TexShape`]=t.getUniformLocation(n,`${a}TexShape`,h))}return e.enableShapeUniforms&&(a=t.getUniformLocation(n,"outShape",h),c=t.getUniformLocation(n,"outShapeStrides",h),u=t.getUniformLocation(n,"outTexShape",h)),e.customUniforms&&e.customUniforms.forEach(((e,r)=>{i[r]=t.getUniformLocation(n,e.name,h)})),{uniformLocations:r,customUniformLocations:i,infLoc:l,nanLoc:f,inShapesLocations:s,inTexShapesLocations:o,outShapeLocation:a,outShapeStridesLocation:c,outTexShapeLocation:u}}function C$(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach(((t,n)=>{const r=t.logicalShape,s=e[n],o=s.shape;if(!Xp(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(t.isUniform&&s.isUniform)return;const i=t.texShape,a=s.isUniform?null:s.texData.texShape;if(!Xp(i,a))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${i} and ${a} must match`)}))}function O$(t){return xd().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class I${constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=AN.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=a$();this.outputShape=t,this.enableShapeUniforms=O$(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?c$(["r","c","d"],t):u$(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${e.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M${constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=AN.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=a$();this.outputShape=t,this.enableShapeUniforms=O$(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?c$(["r","c","d"],t):u$(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${e.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R${constructor(t){this.variableNames=["A"],this.outTexUsage=CN.DOWNLOAD;const e=a$();this.outputShape=t,this.userCode=`\n      ${h$}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${e.output} = encode_float(x);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D${constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=CN.DOWNLOAD;const e=a$();this.outputShape=t,this.userCode=`\n      ${h$}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${e.output} = encode_float(x);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class F${constructor(t,e=!1){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=a$();this.outputShape=t,this.enableShapeUniforms=O$(this.outputShape.length);let r="result";e&&(r="floor(result * 255. + 0.5)"),this.userCode=`\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":f$(t)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / texShape[1];\n        int c = imod(flatIndex, texShape[1]);\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n        vec4 values = ${n.texture2D}(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ${n.output} = vec4(${r}, 0., 0., 0.);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L${constructor(t,e=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=a$();this.outputShape=t,this.enableShapeUniforms=O$(this.outputShape.length);let r="",s="result";e&&(s="floor(result * 255. + 0.5)");for(let e=0;e<=1;e++)for(let s=0;s<=1;s++){const o=2*e+s;r+=`\n          localCoords = coords;\n          if(localCoords[2] + ${s} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {\n          localCoords[2] += ${s};\n          if (localCoords[1] + ${e} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {\n            localCoords[1] += ${e};\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ${n.texture2D}(A, uv);\n\n            if (offset == 0) {\n              result[${o}] = values[0];\n            } else if (offset == 1) {\n              result[${o}] = values[1];\n            } else if (offset == 2) {\n              result[${o}] = values[2];\n            } else {\n              result[${o}] = values[3];\n            }\n          }\n        }\n        `}this.userCode=`\n        ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":f$(t)}\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ${r}\n\n          ${n.output} = ${s};\n        }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P$(t){const e=a$();return function(t,e){const n=HN(t,(()=>t.createShader(t.VERTEX_SHADER)),"Unable to create vertex WebGLShader.");if(FN(t,(()=>t.shaderSource(n,e))),FN(t,(()=>t.compileShader(n))),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(t,`${e.version}\n    precision highp float;\n    ${e.attribute} vec3 clipSpacePos;\n    ${e.attribute} vec2 uv;\n    ${e.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`)}function B$(t){return function(t,e){const n=HN(t,(()=>t.createBuffer()),"Unable to create WebGLBuffer");return FN(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,n))),FN(t,(()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW))),n}(t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function V$(t){return function(t,e){const n=HN(t,(()=>t.createBuffer()),"Unable to create WebGLBuffer");return FN(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n))),FN(t,(()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW))),n}(t,new Uint16Array([0,1,2,2,1,3]))}function z$(t,e,n,r,s,o){!function(t,e){const n=xd().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0)throw new Error(`Requested texture size [${t}x${e}] is invalid.`);if(t>n||e>n)throw new Error(`Requested texture size [${t}x${e}] greater than WebGL maximum on this browser / GPU [${n}x${n}].`)}(e,n);const i=function(t){return HN(t,(()=>t.createTexture()),"Unable to create WebGLTexture.")}(t),a=t.TEXTURE_2D;return FN(t,(()=>t.bindTexture(a,i))),FN(t,(()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE))),FN(t,(()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE))),FN(t,(()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST))),FN(t,(()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST))),1===xd().getNumber("WEBGL_VERSION")?FN(t,(()=>t.texImage2D(a,0,r,e,n,0,s,o,null))):FN(t,(()=>t.texStorage2D(a,1,r,e,n))),FN(t,(()=>t.bindTexture(t.TEXTURE_2D,null))),{texture:i,texShape:[n,e]}}function W$(t){return t.internalFormatFloat}function U$(t){return t.internalFormatHalfFloat}function j$(t){return t.downloadTextureFormat}function G$(t){return t.internalFormatPackedFloat}function q$(t){return t.internalFormatPackedHalfFloat}function H$(t,e,n,r,s,o,i,a){const u=t,c=new Float32Array(function(t,e){const[n,r]=RN(t,e);return n*r*4}(o,i));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class K${constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const e=xd().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,function(t,e){_N[t]=e}(e,t)):this.gl=kN(e);let n="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===xd().getNumber("WEBGL_VERSION")){const t="OES_texture_float",e="OES_texture_half_float";if(this.textureFloatExtension=PN(this.gl,t),e$(this.gl,e))this.textureHalfFloatExtension=PN(this.gl,e);else if(xd().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),e$(this.gl,r))this.colorBufferHalfFloatExtension=PN(this.gl,r);else if(xd().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",e$(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!e$(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=B$(this.gl),this.indexBuffer=V$(this.gl),this.framebuffer=function(t){return HN(t,(()=>t.createFramebuffer()),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=DN(this.gl,this.textureHalfFloatExtension)}get debug(){return xd().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;FN(t,(()=>t.finish())),FN(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,null))),FN(t,(()=>t.deleteFramebuffer(this.framebuffer))),FN(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,null))),FN(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null))),FN(t,(()=>t.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[s,o]=IN(e,n);return z$(t,s,o,W$(r),r.textureFormatFloat,t.FLOAT)}(this.gl,t,e,this.textureConfig)}createFloat16MatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[s,o]=IN(e,n);return z$(t,s,o,U$(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,t,e,this.textureConfig)}createUnsignedBytesMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[s,o]=IN(e,n);return z$(t,s,o,j$(r),t.RGBA,t.UNSIGNED_BYTE)}(this.gl,t,e,this.textureConfig)}uploadPixelDataToTexture(t,e){this.throwIfDisposed(),function(t,e,n){FN(t,(()=>t.bindTexture(t.TEXTURE_2D,e))),n.data instanceof Uint8Array?2===xd().getNumber("WEBGL_VERSION")?FN(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data))):FN(t,(()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data))):2===xd().getNumber("WEBGL_VERSION")?FN(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n))):FN(t,(()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n))),FN(t,(()=>t.bindTexture(t.TEXTURE_2D,null)))}(this.gl,t,e)}uploadDenseMatrixToTexture(t,e,n,r){this.throwIfDisposed(),function(t,e,n,r,s,o){let i,a,u;FN(t,(()=>t.bindTexture(t.TEXTURE_2D,e))),s instanceof Uint8Array?(i=new Uint8Array(n*r*4),a=t.UNSIGNED_BYTE,u=t.RGBA):(i=new Float32Array(n*r*4),a=t.FLOAT,u=o.internalFormatPackedFloat),i.set(s),2===xd().getNumber("WEBGL_VERSION")?FN(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,r,t.RGBA,a,i))):FN(t,(()=>t.texImage2D(t.TEXTURE_2D,0,u,n,r,0,t.RGBA,a,i))),FN(t,(()=>t.bindTexture(t.TEXTURE_2D,null)))}(this.gl,t,e,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[s,o]=RN(e,n);return z$(t,s,o,q$(r),t.RGBA,r.textureTypeHalfFloat)}(this.gl,t,e,this.textureConfig)}createPackedMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[s,o]=RN(e,n);return z$(t,s,o,G$(r),t.RGBA,t.FLOAT)}(this.gl,t,e,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(GN(this.gl,this.framebuffer),this.outputTexture=null),FN(this.gl,(()=>this.gl.deleteTexture(t)))}downloadByteEncodedFloatMatrixFromOutputTexture(t,e,n){return this.downloadMatrixDriver(t,(()=>function(t,e,n,r){const[s,o]=IN(e,n),i=new Uint8Array(e*n*4);return FN(t,(()=>t.readPixels(0,0,s,o,r.downloadTextureFormat,t.UNSIGNED_BYTE,i))),new Float32Array(i.buffer)}(this.gl,e,n,this.textureConfig)))}downloadPackedMatrixFromBuffer(t,e,n,r,s,o){return H$(this.gl,t,0,0,0,s,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,e){return function(t,e,n){const r=t,s=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,s),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),s}(this.gl,t,e)}createBufferFromTexture(t,e,n){this.bindTextureToFrameBuffer(t);const r=function(t,e,n,r){const s=t.createBuffer();FN(t,(()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,s)));const o=16*e*n;return FN(t,(()=>t.bufferData(t.PIXEL_PACK_BUFFER,o,t.STREAM_READ))),FN(t,(()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0))),FN(t,(()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null))),s}(this.gl,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let e,n;if(xd().getBool("WEBGL_FENCE_API_ENABLED")){const r=t,s=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=()=>{const t=r.clientWaitSync(s,0,0);return t===r.ALREADY_SIGNALED||t===r.CONDITION_SATISFIED},e=s}else xd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(e,xd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:e,isFencePassed:n}}downloadMatrixFromPackedTexture(t,e,n){return this.downloadMatrixDriver(t,(()=>function(t,e,n){const r=new Float32Array(e*n*4);return FN(t,(()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,r))),r}(this.gl,e,n)))}createProgram(t){this.throwIfDisposed();const e=this.gl;null==this.vertexShader&&(this.vertexShader=P$(e));const n=function(t){return HN(t,(()=>t.createProgram()),"Unable to create WebGLProgram.")}(e);return FN(e,(()=>e.attachShader(n,this.vertexShader))),FN(e,(()=>e.attachShader(n,t))),function(t,e){if(FN(t,(()=>t.linkProgram(e))),!xd().get("ENGINE_COMPILE_ONLY")&&!1===t.getProgramParameter(e,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}(e,n),this.debug&&zN(e,n),this.vertexAttrsAreBound||(this.setProgram(n),this.vertexAttrsAreBound=function(t,e,n){return FN(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,n))),WN(t,e,"clipSpacePos",n,3,20,0)&&WN(t,e,"uv",n,2,20,12)}(e,this.program,this.vertexBuffer)),n}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&FN(this.gl,(()=>this.gl.deleteProgram(t)))}setProgram(t){this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&zN(this.gl,this.program),FN(this.gl,(()=>this.gl.useProgram(t)))}getUniformLocation(t,e,n=!0){return this.throwIfDisposed(),n?function(t,e,n){return HN(t,(()=>t.getUniformLocation(e,n)),'uniform "'+n+'" not present in program.')}(this.gl,t,e):function(t,e,n){return t.getUniformLocation(e,n)}(this.gl,t,e)}getAttributeLocation(t,e){return this.throwIfDisposed(),FN(this.gl,(()=>this.gl.getAttribLocation(t,e)))}getUniformLocationNoThrow(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)}setInputMatrixTexture(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(t,e,n,r){FN(t,(()=>UN(t,e,r))),FN(t,(()=>t.uniform1i(n,r)))}(this.gl,t,e,n)}setOutputMatrixTexture(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)}setOutputPackedMatrixTexture(t,e,n){this.throwIfDisposed();const[r,s]=RN(e,n);this.setOutputMatrixTextureDriver(t,r,s)}setOutputMatrixWriteRegion(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)}setOutputPackedMatrixWriteRegion(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&zN(this.gl,this.program),qN(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;this.debug&&this.debugValidate(),FN(t,(()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),FN(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=PN(this.gl,2===xd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===xd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}const t=this.getQueryTimerExtensionWebGL1(),e=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,e),e}endQuery(){if(2===xd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2();return void t.endQuery(e.TIME_ELAPSED_EXT)}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await Qp((()=>this.disposed||this.isQueryAvailable(t,xd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(t,xd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,e){if(0===e)return null;if(2===e){const e=this.gl;return e.getQueryParameter(t,e.QUERY_RESULT)/1e6}{const e=this.getQueryTimerExtensionWebGL1();return e.getQueryObjectEXT(t,e.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,e){if(0===e)return!0;if(2===e){const e=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const e=this.getQueryTimerExtensionWebGL1(),n=e.getQueryObjectEXT(t,e.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(e.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(t){return new Promise((e=>{this.addItemToPoll((()=>t.isFencePassed()),(()=>e()))}))}pollItems(){const t=function(t){let e=0;for(;e<t.length;++e){if(!t[e]())break}return e-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(this.itemsToPoll.map((t=>t.isDoneFn)));for(let e=0;e<=t;++e){const{resolveFn:t}=this.itemsToPoll[e];t()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,e){this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||Qp((()=>(this.pollItems(),0===this.itemsToPoll.length)))}bindTextureToFrameBuffer(t){this.throwIfDisposed(),jN(this.gl,t,this.framebuffer),this.debug&&qN(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(jN(this.gl,this.outputTexture,this.framebuffer),this.debug&&qN(this.gl)):GN(this.gl,this.framebuffer)}downloadMatrixDriver(t,e){this.bindTextureToFrameBuffer(t);const n=e();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(t,e,n){this.throwIfDisposed();const r=this.gl;jN(r,t,this.framebuffer),this.debug&&qN(r),this.outputTexture=t,FN(r,(()=>r.viewport(0,0,e,n))),FN(r,(()=>r.scissor(0,0,e,n)))}setOutputMatrixWriteRegionDriver(t,e,n,r){this.throwIfDisposed(),FN(this.gl,(()=>this.gl.scissor(t,e,n,r)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function X$(t){return(e,n,r,s,o)=>{const i=kb(e,n),a=i.length,u=ld(i),c=nd(o,Kp(i)),l=e.length,f=n.length,h=ld(e),p=ld(n),d=_b(e,i),m=_b(n,i);if(d.length+m.length===0)for(let e=0;e<c.length;++e)c[e]=t(r[e%r.length],s[e%s.length]);else for(let e=0;e<c.length;++e){const n=gd(e,a,u),o=n.slice(-l);d.forEach((t=>o[t]=0));const i=yd(o,l,h),y=n.slice(-f);m.forEach((t=>y[t]=0));const g=yd(y,f,p);c[e]=t(r[i],s[g])}return[c,i]}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J$=X$(((t,e)=>t+e));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Y$(t){return(e,n,r)=>{const s=nd(n,e.length);for(let n=0;n<e.length;++n)s[n]=t(e[n],r);return s}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z$=Y$((t=>Math.ceil(t)));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Q$=X$(((t,e)=>t===e?1:0)),tE=Y$((t=>Math.exp(t))),eE=Y$((t=>Math.expm1(t))),nE=Y$((t=>Math.floor(t)));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const rE=X$(((t,e)=>t>e?1:0)),sE=X$(((t,e)=>t>=e?1:0)),oE=X$(((t,e)=>t<e?1:0)),iE=X$(((t,e)=>t<=e?1:0));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const aE=Y$((t=>Math.log(t)));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const uE=X$(((t,e)=>Math.max(t,e))),cE=X$(((t,e)=>Math.min(t,e))),lE=X$(((t,e)=>t*e));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const fE=X$(((t,e)=>t!==e?1:0));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const hE=Y$((t=>1/Math.sqrt(t)));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const pE=Y$((t=>1/(1+Math.exp(-t))));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const dE=Y$((t=>Math.sqrt(t))),mE=X$(((t,e)=>{const n=t-e;return n*n}));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class yE{constructor(t,e,n,r,s,o){this.separator=Km(t),this.nGramWidths=e,this.leftPad=Km(n),this.rightPad=Km(r),this.padWidth=s,this.preserveShort=o}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,e){const n=this.getPadWidth(e);return Math.max(0,t+2*n-e+1)}createNGrams(t,e,n,r,s,o){for(let i=0;i<s;++i){const a=this.getPadWidth(o),u=Math.max(0,a-i),c=Math.max(0,a-(s-(i+1))),l=o-(u+c),f=e+(u>0?0:i-a);let h=0;h+=u*this.leftPad.length;for(let e=0;e<l;++e)h+=t[f+e].length;h+=c*this.rightPad.length;h+=(u+c+l-1)*this.separator.length,n[r+i]=new Uint8Array(h);const p=n[r+i];let d=0;const m=t=>t.forEach((t=>p[d++]=t));for(let t=0;t<u;++t)m(this.leftPad),m(this.separator);for(let e=0;e<l-1;++e)m(t[f+e]),m(this.separator);if(l>0){m(t[f+l-1]);for(let t=0;t<c;++t)m(this.separator),m(this.rightPad)}else{for(let t=0;t<c-1;++t)m(this.rightPad),m(this.separator);m(this.rightPad)}}}compute(t,e){const n=t.length,r=e.length;if(r>0){let t=e[0];if(0!==t)throw new Error(`First split value must be 0, got ${t}`);for(let s=1;s<r;++s){let r=e[s]>=t;if(r=r&&e[s]<=n,!r)throw new Error(`Invalid split value ${e[s]}, must be in [${t}, ${n}]`);t=e[s]}if(t!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${t}`)}const s=r-1,o=rd("int32",r);if(0===n||0===r){const t=new Array(n);for(let t=0;t<=s;++t)o[t]=0;return[t,o]}o[0]=0;for(let t=1;t<=s;++t){const n=e[t]-e[t-1];let r=0;this.nGramWidths.forEach((t=>{r+=this.getNumNGrams(n,t)})),this.preserveShort&&n>0&&0===r&&(r=1),o[t]=o[t-1]+r}const i=new Array(o[s]);for(let n=0;n<s;++n){const r=e[n];let s=o[n];if(this.nGramWidths.forEach((o=>{const a=e[n+1]-e[n],u=this.getNumNGrams(a,o);this.createNGrams(t,r,i,s,u,o),s+=u})),this.preserveShort&&s===o[n]){const o=e[n+1]-e[n];if(0===o)continue;const a=o+2*this.padWidth,u=1;this.createNGrams(t,r,i,s,u,a)}}return[i,o]}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function gE(t,e,n,r){if(!t.length)return;if(0===e.length){for(let e=0;e<t.length;++e)r.push(t.subarray(e,e+1));return}if(1===e.length){const s=e[0];let o=t.indexOf(s);for(;-1!==o;){const e=t.subarray(0,o);n&&0===e.length||r.push(e),t=t.subarray(o+1),o=t.indexOf(s)}return void(n&&0===t.length||r.push(t))}let s=0;for(let o=0;o<t.length+1;o++)if(o===t.length||-1!==e.indexOf(t[o])){const e=t.subarray(s,o);n&&0===e.length||r.push(e),s=o+1}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const bE=X$(((t,e)=>t-e));
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const wE=(t,e)=>{const n=e.value-t.value;return 0===n?t.index-e.index:n};function vE(t,e,n=0,r=t.length-1){for(;r>n;){if(r-n>600){const s=r-n+1,o=e-n+1,i=Math.log(s),a=.5*Math.exp(2*i/3),u=.5*Math.sqrt(i*a*(s-a)/s)*Math.sign(o-s/2);vE(t,e,Math.max(n,Math.floor(e-o*a/s+u)),Math.min(r,Math.floor(e+(s-o)*a/s+u)))}const s=t[e];let o=n,i=r;for(Up(t,n,e),wE(t[r],s)>0&&Up(t,n,r);o<i;){for(Up(t,o,i),o++,i--;wE(t[o],s)<0;)o+=1;for(;wE(t[i],s)>0;)i-=1}0===wE(t[n],s)?Up(t,n,i):(i+=1,Up(t,i,r)),i<=e&&(n=i+1),e<=i&&(r=i-1)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var xE=Object.freeze({__proto__:null,simpleAbsImpl:function(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e},addImpl:J$,bincountImpl:function(t,e,n,r,s){const o=Kp(r),i=dd(s,n);for(let n=0;n<t.length;n++){const r=t[n];if(r<0)throw new Error("Input x must be non-negative!");r>=s||(i[r]+=o>0?e[n]:1)}return i},bincountReduceImpl:function(t,e,n,r=!1){const s=t.shape[0],o=t.shape[1],i=ab([s,n],e.dtype);for(let a=0;a<s;a++)for(let s=0;s<o;s++){const o=t.get(a,s);if(o<0)throw new Error("Input x must be non-negative!");o>=n||(r?i.set(1,a,o):e.size>0?i.set(i.get(a,o)+e.get(a,s),a,o):i.set(i.get(a,o)+1,a,o))}return i},ceilImpl:Z$,concatImpl:function(t,e,n,r){const s=rd(n,Kp(e));if(r&&"string"!==n){let e=0;t.forEach((t=>{const n=Kp(t.shape);s.set(t.vals,e),e+=n}))}else{let r=0;t.forEach((t=>{const o="string"===n?$N(t.vals):t.vals;let i=0;for(let n=0;n<t.shape[0];++n){const a=n*e[1]+r;for(let e=0;e<t.shape[1];++e)s[a+e]=o[i++]}r+=t.shape[1]}))}return s},equalImpl:Q$,expImpl:tE,expm1Impl:eE,floorImpl:nE,gatherNdImpl:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s,o,i,a,u){const c=ab([r,o],n);for(let n=0;n<r;n++){const r=[];let l=0;for(let e=0;e<s;e++){const o=t[n*s+e];l+=o*i[e],r.push(o)}if(l<0||l>=u/o)throw new Error(`Invalid indices: ${r} does not index into ${a}`);for(let t=0;t<o;t++)c.values[n*o+t]=e.get(...e.indexToLoc(l*o+t))}return c}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,gatherV2Impl:function(t,e,n){const r=ab(n,t.dtype);for(let n=0;n<r.size;++n){const s=r.indexToLoc(n).slice(),o=s[0],i=s[2],a=e.locToIndex([o,i]);s[2]=e.values[a];const u=t.locToIndex(s);0<=u&&u<t.values.length&&(r.values[n]=t.values[u])}return r},greaterImpl:rE,greaterEqualImpl:sE,lessImpl:oE,lessEqualImpl:iE,linSpaceImpl:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=(e-t)/(n-1),s=dd(n,"float32");s[0]=t;for(let t=1;t<s.length;t++)s[t]=s[t-1]+r;return s},logImpl:aE,maxImpl:function(t,e,n,r){const s=nd(r,Kp(n));for(let n=0;n<s.length;++n){const r=n*e;let o=t[r];for(let n=0;n<e;++n){const e=t[r+n];(Number.isNaN(e)||e>o)&&(o=e)}s[n]=o}return s},maximumImpl:uE,minimumImpl:cE,multiplyImpl:lE,negImpl:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=Gm(-1,n);return lE([],e,r,t,n)},notEqualImpl:fE,prodImpl:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const[s,o]=Lw(t,r),i=my(e,"int32"),a=dd(Kp(s),i),u=Kp(o);for(let t=0;t<a.length;++t){const e=t*u;let r=1;for(let t=0;t<u;++t)r*=n[e+t];a[t]=r}return{outVals:a,outShape:s,outDtype:i}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,rangeImpl:function(t,e,n,r){if(t===e||t<e&&n<0||e<t&&n>1)return dd(0,r);const s=dd(Math.abs(Math.ceil((e-t)/n)),r);e<t&&1===n&&(n=-1),s[0]=t;for(let t=1;t<s.length;t++)s[t]=s[t-1]+n;return s},rsqrtImpl:hE,scatterImpl:function(t,e,n,r,s,o,i,a,u,c){const l=[r/s,s],f=t.values,h=e.values;if(0===r)return ab(n,e.dtype);const p=ab(l,e.dtype);"string"==typeof u||"number"==typeof u?p.values.fill(u):"boolean"==typeof u&&p.values.fill(+u);for(let t=0;t<o;t++){const o=[];let u=0;for(let e=0;e<i;e++){const n=f[t*i+e];o.push(n),u+=n*a[e]}if(u<0||u>=r/s)throw new Error(`Invalid indices: ${o} does not index into ${n}`);for(let n=0;n<s;n++)c?p.values[u*s+n]+=h[t*s+n]:p.values[u*s+n]=0===e.rank?h[0]:h[t*s+n]}return p},sigmoidImpl:pE,sliceImpl:function(t,e,n,r,s){const o=jb(r,e,n),i=Kp(n),a=ld(r);if(o){const n=Gb(e,a);return"string"===s?t.slice(n,n+i):t.subarray(n,n+i)}const u=ab(r,s,"string"===s?$N(t):t),c=ab(n,s);for(let t=0;t<c.size;++t){const n=c.indexToLoc(t),r=n.map(((t,n)=>t+e[n]));c.set(u.get(...r),...n)}return"string"===s?EN(c.values):c.values}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,sparseFillEmptyRowsImpl:function(t,e,n,r,s,o,i){const a=e[0],u=o[0],c=new Array(u),l=new Array(a),f=e[1];if(0===u){if(0!==a)throw new Error(aN(a));return[rd(n,0),[0,f],rd(s,0),c,l]}let h=!0,p=0;const d=new Array(u).fill(0);for(let e=0;e<a;++e){const n=t[e*f];if(n<0)throw new Error(uN(e,n));if(n>=u)throw new Error(cN(e,n,u));++d[n],h=h&&n>=p,p=n}let m=!0;for(let t=0;t<u;++t){const e=0===d[t];c[t]=e,m=m&&!e,d[t]=Math.max(d[t],1),t>0&&(d[t]+=d[t-1])}if(m&&h){const e=t,n=r;for(let t=0;t<a;++t)l[t]=t;return[e,[a,f],n,c,l]}{const e=d[u-1],o=rd(n,e*f),h=rd(s,e),p=new Array(u).fill(0);for(let e=0;e<a;++e){const n=t[e*f],s=p[n],i=(0===n?0:d[n-1])+s;p[n]++;for(let n=0;n<f;++n)o[i*f+n]=t[e*f+n];h[i]=r[e],l[e]=i}for(let t=0;t<u;++t){if(0===p[t]){const e=0===t?0:d[t-1];o[e*f+0]=t;for(let t=1;t<f;++t)o[e*f+t]=0;h[e]=i}}return[o,[e,f],h,c,l]}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,sparseReshapeImpl:function(t,e,n,r,s){const o=Kp(r),i=e[0],a=s.length,u=[];let c=1,l=-1;for(let t=0;t<a;++t){const e=s[t];if(-1===e){if(-1!==l)throw new Error(lN(l,t));l=t,u.push(1)}else{if(e<0)throw new Error(fN(t,e));c*=e,u.push(e)}}if(-1!==l){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");const t=Math.trunc(o/c);if(c*t!==o)throw new Error(pN(r,u));u[l]=t}if(Kp(u)!==o)throw new Error(dN(r,u));const f=r.length,h=[];if(f>0){h[f-1]=1;for(let t=f-2;t>=0;--t)h[t]=h[t+1]*r[t+1]}const p=[];if(a>0){p[a-1]=1;for(let t=a-2;t>=0;--t)p[t]=p[t+1]*u[t+1]}const d=rd(n,i*a);for(let e=0;e<i;++e){let n=0;for(let r=0;r<f;++r)n+=t[e*f+r]*h[r];for(let t=0;t<a;++t)d[e*a+t]=Math.trunc(n/p[t]),n%=p[t]}return[d,[i,a],u]}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,sparseSegmentReductionImpl:function(t,e,n,r,s,o=!1,i=0){const a=r.length,u=[e[0],t.length/e[0]],c=u[1],l=a>0?s[a-1]+1:0;if(l<0)throw new Error("segment ids must be >= 0");const f=e.slice();f[0]=l;const h=rd(n,f.reduce(((t,e)=>t*e),1));if(0===a)return l>0&&h.fill(i),[h,f];if(l<=0)throw new Error("segment ids must be >= 0");let p=0,d=1,m=0,y=s[p];for(;;){let e=0;if(d<a){if(e=s[d],y===e){++d;continue}if(y>=e)throw new Error("segment ids are not increasing")}if(y<0||y>=l)throw new Error(gN(y,l));y>m&&h.fill(i,m*c,y*c);for(let e=p;e<d;++e){const n=r[e];if(n<0||n>=u[0])throw new Error(bN(e,r[e],u[0]));for(let e=0;e<c;e++)h[y*c+e]+=t[n*c+e]}if(o)for(let t=0;t<c;t++)h[y*c+t]/=d-p;if(p=d,++d,m=y+1,y=e,d>a)break}return m<l&&h.fill(i,m*c,l*c),[h,f]},sqrtImpl:dE,squaredDifferenceImpl:mE,stridedSliceImpl:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const s=ab(t,e.dtype);for(let t=0;t<s.size;t++){const o=s.indexToLoc(t),i=new Array(o.length);for(let t=0;t<i.length;t++)i[t]=o[t]*n[t]+r[t];s.set(e.get(...i),...o)}return s},stringNGramsImpl:function(t,e,n,r,s,o,i,a){return new yE(n,r,s,o,i,a).compute(t,e)},stringSplitImpl:function(t,e,n){const r=t.length,s=[];let o=0,i=0;const a=new Array(r);for(let u=0;u<r;++u){const r=s.length;gE(t[u],e,n,s);const c=s.length-r;a[u]=c,o+=c,i=Math.max(i,c)}const u=rd("int32",2*o),c=new Array(o),l=[r,i];let f=0;for(let t=0;t<r;++t)for(let e=0;e<a[t];++e)u[2*f]=t,u[2*f+1]=e,c[f]=s[f],++f;return[u,c,l]}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,stringToHashBucketFastImpl:function(t,e){const n=rd("int32",t.length);for(let r=0;r<t.length;++r)n[r]=jm(t[r]).modulo(e).getLowBitsUnsigned();return n},subImpl:bE,tileImpl:function(t,e){const n=new Array(t.rank);for(let r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];const r=ab(n,t.dtype);for(let e=0;e<r.values.length;++e){const n=r.indexToLoc(e),s=new Array(t.rank);for(let e=0;e<s.length;e++)s[e]=n[e]%t.shape[e];const o=t.locToIndex(s);r.values[e]=t.values[o]}return r},topKImpl:function(t,e,n,r,s){const o=e[e.length-1],[i,a]=[t.length/o,o],u=nd(n,i*r),c=nd("int32",i*r);for(let e=0;e<i;e++){const n=e*a,o=t.subarray(n,n+a);let i=new Array(o.length);o.forEach(((t,e)=>i[e]={value:t,index:e})),r<i.length&&(vE(i,r),i=i.slice(0,r)),s&&i.sort(wE);const l=e*r,f=u.subarray(l,l+r),h=c.subarray(l,l+r);for(let t=0;t<r;t++)f[t]=i[t].value,h[t]=i[t].index}const l=e.slice();return l[l.length-1]=r,[ab(l,n,u),ab(l,"int32",c)]}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,transposeImpl:function(t,e,n,r,s){const o=e.length,i=Kp(e),a=ld(e),u=ld(s),c=nd(n,Kp(s));for(let e=0;e<i;++e){const n=gd(e,o,a),s=new Array(n.length);for(let t=0;t<s.length;t++)s[t]=n[r[t]];c[yd(s,o,u)]=t[e]}return c},uniqueImpl:function(t,e,n,r){const s=td(e,n)[0],o=[1,n[0],1];for(let t=0;t<s;t++)o[0]*=n[t];o[1]=n[s];for(let t=s+1;t<n.length;t++)o[2]*=n[t];const i={},a=new Int32Array(n[s]),u=new sy(o,r,t),c=[],l=1===o[0]&&1===o[2];for(let e=0;e<n[s];e++){let n;if(l)n=t[e].toString();else{const t=[];for(let n=0;n<o[0];n++)for(let r=0;r<o[2];r++)t.push(u.get(n,e,r));n=t.join(",")}if(void 0!==i[n])a[e]=i[n];else{const t=Object.keys(i).length;i[n]=t,a[e]=t,c.push(e)}}const f=o.slice();f[1]=Object.keys(i).length;const h=new sy(f,r);c.forEach(((t,e)=>{for(let n=0;n<o[0];n++)for(let r=0;r<o[2];r++)h.set(u.get(n,t,r),n,e,r)}));const p=n.slice();return p[s]=f[1],{outputValues:h.values,outputShape:p,indices:a}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:NE,bincountImpl:$E,bincountReduceImpl:EE,ceilImpl:SE,concatImpl:_E,equalImpl:TE,expImpl:kE,expm1Impl:AE,floorImpl:CE,gatherNdImpl:OE,gatherV2Impl:IE,greaterImpl:ME,greaterEqualImpl:RE,lessImpl:DE,lessEqualImpl:FE,linSpaceImpl:LE,logImpl:PE,maxImpl:BE,maximumImpl:VE,minimumImpl:zE,multiplyImpl:WE,negImpl:UE,notEqualImpl:jE,prodImpl:GE,rangeImpl:qE,rsqrtImpl:HE,scatterImpl:KE,sigmoidImpl:XE,simpleAbsImpl:JE,sliceImpl:YE,sparseFillEmptyRowsImpl:ZE,sparseReshapeImpl:QE,sparseSegmentReductionImpl:tS,sqrtImpl:eS,stridedSliceImpl:nS,stringNGramsImpl:rS,stringSplitImpl:sS,stringToHashBucketFastImpl:oS,subImpl:iS,tileImpl:aS,topKImpl:uS,transposeImpl:cS,uniqueImpl:lS}=xE;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fS(t,e){return["x","y","z","w","u","v"].slice(0,e).map((e=>`${t}.${e}`))}function hS(t,e){return 1===e?[t]:fS(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class pS{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=O$(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const t=hS("rc",this.rank),e=E$(this.rank),n=this.getOutOfBoundsCondition(t),r=this.getSetup(t),s=this.getOutput(t);this.userCode=`\n        void main() {\n          ${e} rc = getOutputCoords();\n\n          if(${n}) {\n            setOutput(vec4(0));\n          } else {\n            ${r}\n\n            setOutput(vec4(${s}));\n          }\n        }\n      `}}getSourceCoordsArr(t){const e=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let s=`${0===n?"r":"rp1"}, ${0===r?"c":"cp1"}`;for(let e=2;e<this.rank;e++)s=`${t[t.length-1-e]},`+s;e.push(s)}return e}getOutOfBoundsCondition(t){if(1===this.rank)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let e="";for(let n=this.rank-2;n<this.rank;n++)e+=`${t[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(e+="||");return e}getSetup(t){if(1===this.rank)return"";const e=t.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`\n      int r = ${e[0]};\n      int c = ${e[1]};\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ${n};\n      bool rEdge = rp1 >= ${r};\n    `}getOutput(t){const e=this.getSourceCoordsArr(t);if(1===this.rank){return`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`}return`getA(${e[0]}),\n            cEdge ? 0. : getA(${e[1]}),\n            rEdge ? 0. : getA(${e[2]}),\n            rEdge || cEdge ? 0. : getA(${e[3]})`}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dS{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=O$(this.outputShape.length);let n="";for(let t=0;t<4;t++){let e="thisRC = rc;";t%2==1&&(e+="thisRC.z += 1;"),t>1&&(e+="thisRC.y += 1;"),n+=`\n        ${e}\n        ${t>0?"if(thisRC.y < rows && thisRC.z < cols){":""}\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${t}] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ${t>0?"}":""}\n      `}var r,s;
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */this.userCode=`\n      ${r=e,s=this.enableShapeUniforms,`\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${s?l$(["r","c","d"],"inputShape"):u$(["r","c","d"],r)}\n      return ivec3(r, c, d);\n    }\n  `}\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":f$(t)}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};\n        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};\n\n        ${n}\n\n        setOutput(result);\n      }\n    `}}class mS{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(t,e,n){const r=gS(e,n),s=bS(t,r,n);s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]);const o=yS(t,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const t=this.freeTextures[s].shift();return this.usedTextures[s].push(t),t}let i;return r===ON.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):r===ON.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):r===ON.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):r===ON.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):r===ON.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[s].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}releaseTexture(t,e,n,r){if(null==this.freeTextures)return;const s=gS(n,r),o=bS(e,s,r);o in this.freeTextures||(this.freeTextures[o]=[]);const i=yS(e,s,this.gpgpu.gl,this.gpgpu.textureConfig,r),a=xd().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==a&&this._numBytesAllocated>a?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=i):(this.freeTextures[o].push(t),this.numFreeTextures++,this._numBytesFree+=i),this.numUsedTextures--;const u=this.usedTextures[o],c=u.indexOf(t);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(c,1),this.log()}log(){if(!this.logEnabled)return;const t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);const e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const t in this.freeTextures)this.freeTextures[t].forEach((t=>{this.gpgpu.deleteMatrixTexture(t.texture)}));for(const t in this.usedTextures)this.usedTextures[t].forEach((t=>{this.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function yS(t,e,n,r,s){const o=function(t,e){switch(t){case ON.PACKED_2X2_FLOAT32:return G$(e);case ON.PACKED_2X2_FLOAT16:return q$(e);case ON.UNPACKED_FLOAT32:return W$(e);case ON.UNPACKED_FLOAT16:return U$(e);case ON.PACKED_4X1_UNSIGNED_BYTE:return j$(e);default:throw new Error(`Unknown physical texture type ${t}`)}}(e,r);let i;if(s){const[e,n]=RN(t[0],t[1]);i=e*n}else{const[e,n]=IN(t[0],t[1]);i=e*n}const a=function(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}(n,o);return i*a}function gS(t,e){if(t===CN.UPLOAD)return ON.PACKED_2X2_FLOAT32;if(t===CN.RENDER||null==t)return function(t){return xd().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?ON.PACKED_2X2_FLOAT32:ON.UNPACKED_FLOAT32:t?ON.PACKED_2X2_FLOAT16:ON.UNPACKED_FLOAT16}(e);if(t===CN.DOWNLOAD||t===CN.PIXELS)return ON.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function bS(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wS{constructor(t,e){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=O$(this.outputShape.length),this.userCode=`\n      float unaryOperation(float x) {\n        ${e}\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}const vS="return x;";class xS{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=O$(this.outputShape.length),this.userCode=`\n      vec4 unaryOperation(vec4 x) {\n        ${e}\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NS{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=O$(this.outputShape.length);const e=t.length,n=hS("rc",e),r=E$(e),s=function(t,e){if(1===t)return"rc";let n="";for(let r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}(e,n),o=n.slice(-2),i=e<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`\n      void main() {\n        ${r} rc = getOutputCoords();\n        vec4 packedInput = getA(${s});\n\n        setOutput(getChannel(packedInput, ${i}));\n      }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $S=function(t,e){const n=[];for(let t=0;t<e.length;t++)e[t]&&n.push(t);const r=ab(t,"int32"),s=ab([n.length,t.length],"int32");for(let e=0;e<n.length;e++){const o=r.indexToLoc(n[e]),i=e*t.length;s.values.set(o,i)}return s.toTensor()},ES={};const SS=xd().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class _S extends Bp{constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!xd().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let e;if(null!=t){if(t instanceof K$)e=t;else{const n=kN(xd().getNumber("WEBGL_VERSION"),t);e=new K$(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const t=kN(xd().getNumber("WEBGL_VERSION"));e=new K$(t),this.binaryCache=((n=xd().getNumber("WEBGL_VERSION"))in ES||(ES[n]={}),ES[n]),this.gpgpuCreatedLocally=!0}var n;this.gpgpu=e,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new mS(this.gpgpu),this.numMBBeforeWarning=null==xd().global.screen?1024:xd().global.screen.height*xd().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new Pp(this,wb())}nextDataId(){return _S.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(t,e,n){if((xd().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||xd().getBool("DEBUG"))&&this.checkNumericalProblems(t),"complex64"===n&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:e,dtype:n,values:t,usage:CN.UPLOAD,refCount:1}),r}refCount(t){if(this.texData.has(t)){return this.texData.get(t).refCount}return 0}incRef(t){this.texData.get(t).refCount++}decRef(t){if(this.texData.has(t)){this.texData.get(t).refCount--}}move(t,e,n,r,s){if(xd().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:n,dtype:r,values:e,usage:CN.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){const e=this.texData.get(t),{values:n,dtype:r,complexTensorInfos:s,slice:o,shape:i,isPacked:a}=e;if(null!=o){let e;e=a?new xS(i,vS):new wS(i,vS);const n=this.runWebGLProgram(e,[{dataId:t,shape:i,dtype:r}],r),s=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),s}if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===r)return n;const u=null!=this.activeTimers;let c,l;if(u&&(c=Hm()),"complex64"===r){l=Zx(this.readSync(s.real.dataId),this.readSync(s.imag.dataId))}else l=this.getValuesFromTexture(t);return u&&(this.downloadWaitMs+=Hm()-c),this.convertAndCacheOnCPU(t,l)}async read(t){if(this.pendingRead.has(t)){const e=this.pendingRead.get(t);return new Promise((t=>e.push(t)))}const e=this.texData.get(t),{values:n,shape:r,slice:s,dtype:o,complexTensorInfos:i,isPacked:a}=e;if(null!=s){let e;e=a?new xS(r,vS):new wS(r,vS);const n=this.runWebGLProgram(e,[{dataId:t,shape:r,dtype:o}],o),s=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),s}if(null!=n)return this.convertAndCacheOnCPU(t);if(xd().getBool("DEBUG")&&!xd().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===xd().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u,c,l=null;if("complex64"!==o&&xd().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(t);const e=this.texData.get(u.dataId);l=this.gpgpu.createBufferFromTexture(e.texture.texture,...MN(r))}if(this.pendingRead.set(t,[]),"complex64"!==o&&await this.gpgpu.createAndWaitForFence(),"complex64"===o){const t=await Promise.all([this.read(i.real.dataId),this.read(i.imag.dataId)]);c=Zx(t[0],t[1])}else if(null==l)c=this.getValuesFromTexture(t);else{const t=Kp(r);c=this.gpgpu.downloadFloat32MatrixFromBuffer(l,t)}if(null!=u&&this.disposeIntermediateTensorInfo(u),null!=l){const t=this.gpgpu.gl;FN(t,(()=>t.deleteBuffer(l)))}const f=this.convertAndCacheOnCPU(t,c),h=this.pendingRead.get(t);return this.pendingRead.delete(t),h.forEach((t=>t(f))),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&wb().removeDataId(t,this),this.pendingDeletes--),f}readToGPU(t,e={}){const n=this.texData.get(t),{values:r,shape:s,slice:o,dtype:i,isPacked:a,texture:u}=n;if("complex64"===i)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=o){let n;n=a?new xS(s,vS):new wS(s,vS);const r=this.runWebGLProgram(n,[{dataId:t,shape:s,dtype:i}],i),o=this.readToGPU(r,e);return this.disposeIntermediateTensorInfo(r),o}if(null==u)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(t,e.customTexShape),l=wb().makeTensorFromTensorInfo(c),f=this.texData.get(c.dataId);return Object.assign({tensorRef:l},f.texture)}bufferSync(t){const e=this.readSync(t.dataId);if("string"===t.dtype)try{const n=e.map((t=>Xm(t)));return ab(t.shape,t.dtype,n)}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return ab(t.shape,t.dtype,e)}checkNumericalProblems(t){if(null!=t)for(let e=0;e<t.length;e++){const n=t[e];if(!LN(n)){if(xd().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(t){const{shape:e,dtype:n,isPacked:r}=this.texData.get(t),s=Kp(e);if(xd().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(t),r=this.texData.get(n.dataId),o=this.gpgpu.downloadMatrixFromPackedTexture(r.texture.texture,...MN(e)).subarray(0,s);return this.disposeIntermediateTensorInfo(n),o}const o=xd().getBool("WEBGL_PACK")&&!0===r,i=o?JN(e):e,a=o?new D$(i):new R$(i),u=this.runWebGLProgram(a,[{shape:i,dtype:n,dataId:t}],"float32"),c=this.texData.get(u.dataId),l=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(u),l}timerAvailable(){return xd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){const e=this.activeTimers,n=[];let r=!1;null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,t();const s=Hp(this.activeTimers.map((t=>t.query))).filter((t=>null!=t)),o=Hp(this.activeTimers.map((t=>t.name))).filter((t=>null!=t));this.activeTimers=e,r&&(this.programTimersStack=null);const i={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(xd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const t=await Promise.all(s);i.kernelMs=function(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}(t),i.getExtraProfileInfo=()=>t.map(((t,e)=>({name:o[e],ms:t}))).map((t=>`${t.name}: ${t.ms}`)).join(", ")}else i.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,i})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return xd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Hm(),endMs:null}}endTimer(t){return xd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Hm(),t)}async getQueryTime(t){if(xd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const e=t;return e.endMs-e.startMs}disposeData(t,e=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(e?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!e&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);const{complexTensorInfos:n}=this.texData.get(t);return null!=n&&(this.disposeData(n.real.dataId,e),this.disposeData(n.imag.dataId,e)),this.texData.delete(t),!0}releaseGPUData(t){const{texture:e,dtype:n,texShape:r,usage:s,isPacked:o,slice:i}=this.texData.get(t),a=i&&i.origDataId||t,u=this.dataRefCount.get(a);u>1?this.dataRefCount.set(a,u-1):(this.dataRefCount.delete(a),null!=e&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(e,r,s,o)));const c=this.texData.get(t);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,e=SS){return xd().getBool("WEBGL_CPU_FORWARD")&&t.every((t=>null==this.texData.get(t.dataId).texture&&Kp(t.shape)<e))}getGPGPUContext(){return this.gpgpu}where(t){Zd("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const e=t.dataSync();return $S(t.shape,e)}packedUnaryOp(t,e,n){const r=new xS(t.shape,e),s=this.compileAndRun(r,[t],n);return wb().makeTensorFromTensorInfo(s)}abs(t){if(this.shouldExecuteOnCPU([t])&&"complex64"!==t.dtype){const e=JE(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,e)}if(xd().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,"return abs(x);",t.dtype);const e=new wS(t.shape,"return abs(x);"),n=this.compileAndRun(e,[t]);return wb().makeTensorFromTensorInfo(n)}makeTensorInfo(t,e,n){let r;if("string"===e&&null!=n&&n.length>0&&id(n[0])){const s=n.map((t=>Km(t)));r=this.write(s,t,e)}else r=this.write(n,t,e);return this.texData.get(r).usage=null,{dataId:r,shape:t,dtype:e}}makeOutput(t,e,n){return wb().makeTensorFromTensorInfo(this.makeTensorInfo(t,e,n),this)}unpackTensor(t){const e=new NS(t.shape);return this.runWebGLProgram(e,[t],t.dtype)}packTensor(t){const e=new pS(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)}packedReshape(t,e){const n=[KN(t.shape),...XN(t.shape)],r={dtype:t.dtype,shape:n,dataId:t.dataId},s=[KN(e),...XN(e)],o=new dS(s,n),i=[n],a=this.runWebGLProgram(o,[r],t.dtype,i,!0);return{dataId:a.dataId,shape:e,dtype:a.dtype}}decode(t,e){const n=this.texData.get(t),{isPacked:r,shape:s,dtype:o}=n;if(null!=e){jp(Kp(s)<=e[0]*e[1]*4,(()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."))}const i=JN(s);let a;a=r?new M$(i):new I$(i);const u=[null!=e?e:MN(i)];return{dtype:o,shape:s,dataId:this.runWebGLProgram(a,[{shape:i,dtype:o,dataId:t}],o,u,!0,e).dataId}}runWebGLProgram(t,e,n,r,s=!1,o){const i=this.makeTensorInfo(t.outputShape,n),a=this.texData.get(i.dataId);if(t.packedOutput&&(a.isPacked=!0),t.outPackingScheme===AN.DENSE){const e=null!=o?o:MN(t.outputShape);a.texShape=e.map((t=>2*t))}if(null!=t.outTexUsage&&(a.usage=t.outTexUsage),0===Kp(i.shape))return a.values=nd(i.dtype,0),i;const u=[],c=e.map((e=>{if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(e.dataId);if(null==n.texture){if(!t.packedInputs&&Kp(e.shape)<=xd().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:n.values};t.packedInputs&&(n.isPacked=!0,n.shape=e.shape)}if(this.uploadToGPU(e.dataId),!!n.isPacked!=!!t.packedInputs)e=n.isPacked?this.unpackTensor(e):this.packTensor(e),u.push(e),n=this.texData.get(e.dataId);else if(n.isPacked&&!ZN(n.shape,e.shape)){const t=e,r=e.shape;e.shape=n.shape,e=this.packedReshape(e,r),u.push(e),n=this.texData.get(e.dataId),t.shape=r}return{shape:e.shape,texData:n,isUniform:!1}}));this.uploadToGPU(i.dataId);const l={shape:i.shape,texData:a,isUniform:!1},f=function(t,e,n){let r="";e.concat(n).forEach((e=>{const s=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!e.isUniform){const o=e.texData.texShape,{useSqueezeShape:i,uniformShape:a,keptDims:u}=S$(t.packedInputs,e.shape,o);let c="",l="",f="";if(1===a.length&&t.packedInputs){const t=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];c=`${t[0]>1}_${t[1]>1}`}else if(2!==a.length||t.packedInputs){if(a.length>2&&!t.packedInputs){const t=ld(a);f=`${t[0]===o[1]}_${t[t.length-1]===o[1]}`}}else l=`${a[0]>1}_${a[1]>1}`;const h=e.shape.length,p=2===a.length&&Xp(e.shape,o),d=1===Kp(e.shape),m=_b(e.shape,n.shape),y=!t.packedInputs&&h===n.shape.length&&Xp(o,n.texData.texShape),g=t.packedInputs||a.length>2?"":`${o[0]>1}_${o[1]>1}`;r+=`${h}_${y}_${i?u:""}_${a.length}_${d}_${m}_${p}_${c}_${l}_${f}_${g}_${s}`}else{const t=e.isUniform?"uniform":e.texData.texShape;r+=`${e.shape}_${t}_${s}`}}));const s=t.userCode;let o=t.constructor.name;return o+="_"+r+"_"+s+`${xd().getNumber("WEBGL_VERSION")}`,o}(t,c,l),h=this.getAndSaveBinary(f,(()=>k$(this.gpgpu,t,c,l))),p=null!=this.activeTimers;let d;p&&(d=this.startTimer()),xd().get("ENGINE_COMPILE_ONLY")||function(t,e,n,r,s){e.program.enableShapeUniforms||(C$(e.inShapeInfos,n),C$([e.outShapeInfo],[r]));const o=r.texData.texture,i=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(o.texture,i[0],i[1]):t.setOutputMatrixTexture(o.texture,i[0],i[1]),t.setProgram(e.webGLProgram),1===xd().getNumber("WEBGL_VERSION")&&null!==e.infLoc&&t.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&t.gl.uniform1f(e.nanLoc,NaN),n.forEach(((n,r)=>{const s=e.program.variableNames[r],o=e.uniformLocations[s],i=e.uniformLocations[`offset${s}`],a=e.inShapesLocations[`${s}Shape`],u=e.inTexShapesLocations[`${s}TexShape`];if(a){const{uniformShape:r}=S$(e.program.packedInputs,n.shape,n.texData.texShape);switch(r.length){case 1:t.gl.uniform1iv(a,new Int32Array(r));break;case 2:t.gl.uniform2iv(a,new Int32Array(r));break;case 3:t.gl.uniform3iv(a,new Int32Array(r));break;case 4:t.gl.uniform4iv(a,new Int32Array(r))}}if(u&&t.gl.uniform2i(u,n.texData.texShape[0],n.texData.texShape[1]),null!=o)if(n.isUniform)if(Kp(n.shape)<2)t.gl.uniform1f(o,n.uniformValues[0]);else{let e=n.uniformValues;e instanceof Float32Array||(e=new Float32Array(e)),t.gl.uniform1fv(o,e)}else null!=n.texData.slice&&null!=i&&t.gl.uniform1i(i,n.texData.slice.flatOffset),t.setInputMatrixTexture(n.texData.texture.texture,o,r)}));const a=e.outShapeLocation;if(a)switch(r.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(r.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(r.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(r.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(r.shape))}if(e.outShapeStridesLocation){const n=ld(r.shape);switch(r.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(n));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(n));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(n))}}e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&s&&e.program.customUniforms.forEach(((n,r)=>{const o=e.customUniformLocations[r],i=s[r];if("float"===n.type)t.gl.uniform1fv(o,i);else if("vec2"===n.type)t.gl.uniform2fv(o,i);else if("vec3"===n.type)t.gl.uniform3fv(o,i);else if("vec4"===n.type)t.gl.uniform4fv(o,i);else if("int"===n.type)t.gl.uniform1iv(o,i);else if("ivec2"===n.type)t.gl.uniform2iv(o,i);else if("ivec3"===n.type)t.gl.uniform3iv(o,i);else{if("ivec4"!==n.type)throw Error(`uniform type ${n.type} is not supported yet.`);t.gl.uniform4iv(o,i)}})),t.executeProgram()}(this.gpgpu,h,c,l,r),u.forEach((t=>this.disposeIntermediateTensorInfo(t))),p&&(d=this.endTimer(d),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(d)}));const m=xd().get("WEBGL_FLUSH_THRESHOLD");if(m>0){const t=Hm();t-this.lastGlFlushTime>m&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=t)}if(!xd().getBool("WEBGL_LAZILY_UNPACK")&&a.isPacked&&!1===s){const t=this.unpackTensor(i);return this.disposeIntermediateTensorInfo(i),t}return i}compileAndRun(t,e,n,r,s=!1){n=n||e[0].dtype;return this.runWebGLProgram(t,e,n,r,s)}getAndSaveBinary(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){if(!this.disposed){if(!xd().getBool("IS_TEST")){Object.keys(this.binaryCache).forEach((t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}))}this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=vb((()=>{if(!xd().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=xd().getBool("DEBUG");xd().set("DEBUG",!1);const e=this.abs(qw(1e-8)).dataSync()[0];if(xd().set("DEBUG",t),e>0)return 32}return 16}))),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(t){const e=this.texData.get(t),{shape:n,dtype:r,values:s,texture:o,usage:i,isPacked:a}=e;if(null!=o)return;const u=null!=this.activeTimers;let c;u&&(c=Hm());let l=e.texShape;if(null==l&&(l=function(t,e=!1){let n=xd().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(n*=2,t=t.map(((e,n)=>n>=t.length-2?Wp(t[n]):t[n])),1===t.length&&(t=[2,t[0]])),2!==t.length){const e=ed(t);t=e.newShape}let r=Kp(t);if(t.length<=1&&r<=n)return[1,r];if(2===t.length&&t[0]<=n&&t[1]<=n)return t;if(3===t.length&&t[0]*t[1]<=n&&t[2]<=n)return[t[0]*t[1],t[2]];if(3===t.length&&t[0]<=n&&t[1]*t[2]<=n)return[t[0],t[1]*t[2]];if(4===t.length&&t[0]*t[1]*t[2]<=n&&t[3]<=n)return[t[0]*t[1]*t[2],t[3]];if(4===t.length&&t[0]<=n&&t[1]*t[2]*t[3]<=n)return[t[0],t[1]*t[2]*t[3]];if(e){const e=KN(t);let n=2,s=2;return t.length&&([n,s]=XN(t)),r=e*(n/2)*(s/2),Yp(r).map((t=>2*t))}return Yp(r)}(n,a),e.texShape=l),null!=s){const t=JN(n);let o,i=l[1],f=l[0];const h=s instanceof Uint8Array||s instanceof Uint8ClampedArray;!a&&h||([i,f]=RN(l[0],l[1])),o=a?new L$(t,h):new F$(t,h);const p=h?[f,i]:l,d=this.makeTensorInfo(p,r),m=this.texData.get(d.dataId);m.usage=h?CN.PIXELS:CN.UPLOAD,m.texShape=p,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(d.dataId),i,f,s);const y=[[f,i]],g=!0,b=this.runWebGLProgram(o,[d],r,y,g),w=this.texData.get(b.dataId);e.texShape=w.texShape,e.isPacked=w.isPacked,e.usage=w.usage,xd().get("ENGINE_COMPILE_ONLY")?this.disposeData(b.dataId):(e.texture=w.texture,e.values=null,this.texData.delete(b.dataId)),this.disposeIntermediateTensorInfo(d),u&&(this.uploadWaitMs+=Hm()-c)}else{const t=this.acquireTexture(l,i,r,a);e.texture=t}}convertAndCacheOnCPU(t,e){const n=this.texData.get(t),{dtype:r}=n;return this.releaseGPUData(t),null!=e&&(n.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){const n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length);for(let e=0;e<n.length;++e)n[e]=Math.round(t[e]);return n}throw new Error(`Unknown dtype ${e}`)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(e,r)),n.values}acquireTexture(t,e,n,r){if(this.numBytesInGPU+=this.computeBytes(t,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const t=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${t} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,e,r)}computeBytes(t,e){return t[0]*t[1]*od(e)}checkCompileCompletion(){for(const[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){const t=[];if(this.gpgpu.parallelCompilationExtension){for(const[,e]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(e));return Promise.all(t)}for(const[,e]of Object.entries(this.binaryCache)){const n=new Promise((t=>{try{this.checkCompletion_(e),t(!0)}catch(t){throw t}}));t.push(n)}return Promise.all(t)}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await new Promise((t=>Wx((()=>t())))),this.checkCompletionAsync_(t))}checkCompletion_(t){if(!1===this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw VN(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}getUniformLocations(){for(const[,t]of Object.entries(this.binaryCache)){const{uniformLocations:e,customUniformLocations:n,infLoc:r,nanLoc:s,inShapesLocations:o,inTexShapesLocations:i,outShapeLocation:a,outShapeStridesLocation:u,outTexShapeLocation:c}=A$(this.gpgpu,t.program,t.webGLProgram);t.uniformLocations=e,t.customUniformLocations=n,t.infLoc=r,t.nanLoc=s,t.inShapesLocations=o,t.inTexShapesLocations=i,t.outShapeLocation=a,t.outShapeStridesLocation=u,t.outTexShapeLocation=c}}}_S.nextDataId=0,Ty()&&function(t,e,n=1){Ey.registerBackend(t,e,n)}("webgl",(()=>new _S),2)
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */;class TS{constructor(t,e,n){this.variableNames=["A","B"],this.outputShape=kb(e,n),this.enableShapeUniforms=O$(this.outputShape.length),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${t}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kS{constructor(t,e,n,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=kb(e,n);const s=this.outputShape.length;this.enableShapeUniforms=O$(s);let o="";if(r)if(0===s||1===Kp(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{if(o=`\n          ${E$(s)} coords = getOutputCoords();\n        `,1===s)this.enableShapeUniforms?o+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":o+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{const t=hS("coords",s);this.enableShapeUniforms?o+=`\n            bool nextRowOutOfBounds =\n              (${t[s-2]} + 1) >= outShape[${s} - 2];\n            bool nextColOutOfBounds =\n              (${t[s-1]} + 1) >= outShape[${s} - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `:o+=`\n            bool nextRowOutOfBounds =\n              (${t[s-2]} + 1) >= ${this.outputShape[s-2]};\n            bool nextColOutOfBounds =\n              (${t[s-1]} + 1) >= ${this.outputShape[s-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${t}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${o}\n\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AS(t){const{inputs:e,backend:n}=t,{x:r}=e;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const CS={kernelName:"Identity",backendName:"webgl",kernelFunc:AS};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OS(t){const{inputs:e,backend:n}=t,{real:r,imag:s}=e,o=n.makeTensorInfo(r.shape,"complex64"),i=n.texData.get(o.dataId),a=AS({inputs:{x:r},backend:n}),u=AS({inputs:{x:s},backend:n});return i.complexTensorInfos={real:a,imag:u},o}const IS={kernelName:"Complex",backendName:"webgl",kernelFunc:OS},MS="return (a < 0.) ? b * a : a;",RS="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DS={kernelName:"LeakyRelu",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{alpha:o}=r,i=n.makeTensorInfo([],"float32",Gm(o,"float32")),a=xd().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new kS(RS,s.shape,i.shape):new TS(MS,s.shape,i.shape),u=n.runWebGLProgram(a,[s,i],"float32");return n.disposeIntermediateTensorInfo(i),u}},FS="return (a < 0.) ? b * a : a;",LS="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PS={kernelName:"Prelu",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r,alpha:s}=e,o=xd().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new kS(LS,r.shape,s.shape):new TS(FS,r.shape,s.shape);return n.runWebGLProgram(o,[r,s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BS({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:r}){return({inputs:s,backend:o})=>{const{x:i}=s,a=o,u=r||i.dtype;if(a.shouldExecuteOnCPU([i])&&null!=n){const t=a.texData.get(i.dataId),e=n(t.values,u);return a.makeTensorInfo(i.shape,u,e)}let c;return c=xd().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=e?new xS(i.shape,e):new wS(i.shape,t),a.runWebGLProgram(c,[i],u)}}function VS({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:s,dtype:o}){return({inputs:i,backend:a})=>{const{a:u,b:c}=i,l=a;if(r&&"complex64"===u.dtype){const e=l.texData.get(u.dataId),n=l.texData.get(c.dataId),[r,s]=[[e.complexTensorInfos.real,n.complexTensorInfos.real],[e.complexTensorInfos.imag,n.complexTensorInfos.imag]].map((e=>{const[n,r]=e,s={dataId:n.dataId,dtype:n.dtype,shape:u.shape},o={dataId:r.dataId,dtype:r.dtype,shape:c.shape},i=new TS(t,u.shape,c.shape);return l.runWebGLProgram(i,[s,o],my(n.dtype,r.dtype))})),o=OS({inputs:{real:r,imag:s},backend:l});return l.disposeIntermediateTensorInfo(r),l.disposeIntermediateTensorInfo(s),o}const f=o||my(u.dtype,c.dtype);if(("string"===u.dtype||"string"===c.dtype||l.shouldExecuteOnCPU([u,c]))&&null!=s){const t=l.texData.get(u.dataId).values,e=l.texData.get(c.dataId).values,n="string"===u.dtype?$N(t):t,r="string"===u.dtype?$N(e):e,[o,i]=s(u.shape,c.shape,n,r,f),a=l.makeTensorInfo(i,f);return l.texData.get(a.dataId).values=o,a}let h;return h=xd().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=e?new kS(e,u.shape,c.shape,n):new TS(t,u.shape,c.shape),l.runWebGLProgram(h,[u,c],f)}}function zS(t,e=!1){if("linear"===t)return"return x;";if("relu"===t)return e?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n";if("elu"===t)return e?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===t)return e?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n";if("prelu"===t)return e?LS:FS;if("leakyrelu"===t)return e?RS:MS;if("sigmoid"===t)return"return 1.0 / (1.0 + exp(-1.0 * x));";throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WS{constructor(t,e,n,r=!1,s=!1,o=!1,i=null,a=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=O$(this.outputShape.length);const c=r?t[1]:t[2],l=Math.ceil(c/2),f=r?"i * 2, rc.y":"rc.y, i * 2",h=s?"rc.z, i * 2":"i * 2, rc.z",p=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=s?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let m="",y="";i&&(m=a?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${i}\n        }`:u?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${i}\n        }`:`vec4 activation(vec4 x) {\n          ${i}\n        }`,y="result = activation(result);");const g=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let b="rc.x",w="rc.x";t[0]<e[0]?b=`int(min(float(rc.x), ${t[0]-1}.))`:e[0]<t[0]&&(w=`int(min(float(rc.x), ${e[0]-1}.))`),this.userCode=`\n      ${m}\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ${l}.0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ${l}; i++) {\n          int batchA = ${b};\n          int batchB = ${w};\n          vec4 a = getMatrixA(batchA, ${f});\n          vec4 b = getMatrixB(batchB, ${h});\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (${p[0]} * ${d[0]});\n          result += (${p[1]} * ${d[1]});\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ${g}\n\n        ${y}\n\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const US="return areal * breal - aimag * bimag;",jS="return areal * bimag + aimag * breal;";class GS{constructor(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=kb(e,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${t}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qS="return a * b;";function HS(t){const{inputs:e,backend:n}=t,{a:r,b:s}=e,o=my(r.dtype,s.dtype);if("complex64"===r.dtype){const t=n.texData.get(r.dataId),e=n.texData.get(s.dataId),o=new GS(US,r.shape,s.shape),i=new GS(jS,r.shape,s.shape),a=[{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:r.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:s.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:s.shape}],u=n.runWebGLProgram(o,a,"float32"),c=n.runWebGLProgram(i,a,"float32"),l=OS({inputs:{real:u,imag:c},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),l}if(n.shouldExecuteOnCPU([r,s])){const t=n.texData.get(r.dataId),e=n.texData.get(s.dataId),[i,a]=WE(r.shape,s.shape,t.values,e.values,o),u=n.makeTensorInfo(a,o);return n.texData.get(u.dataId).values=i,u}let i;return i=xd().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new kS(qS,r.shape,s.shape):new TS(qS,r.shape,s.shape),n.runWebGLProgram(i,[r,s],o)}const KS={kernelName:"Multiply",backendName:"webgl",kernelFunc:HS};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function XS(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{shape:o}=r,i=n,a=Kp(s.shape),u=function(t,e){let n=1,r=-1;for(let e=0;e<t.length;++e)if(t[e]>=0)n*=t[e];else if(-1===t[e]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${e}`);r=e}else if(t[e]<0)throw Error(`Shapes can not be < 0. Found ${t[e]} at dim ${e}`);if(-1===r){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(0===n)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const s=t.slice();return s[r]=e/n,s}(o,a),c=Kp(u);jp(a===c,(()=>`The new shape (${u}) has ${c} elements and the old shape (${s.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`));const l=i.texData.get(s.dataId);return!l.isPacked||ZN(s.shape,u)||null!==l.texture&&ZN(l.shape,u)?(i.incRef(s.dataId),{dataId:s.dataId,shape:u,dtype:s.dtype}):function(t,e,n){const r=[KN(t.shape),...XN(t.shape)],s={dtype:t.dtype,shape:r,dataId:t.dataId},o=[KN(e),...XN(e)],i=new dS(o,r),a=[r],u=n.runWebGLProgram(i,[s],t.dtype,a,!0);return{dataId:u.dataId,shape:e,dtype:u.dtype}}(s,u,i)}const JS={kernelName:"Reshape",backendName:"webgl",kernelFunc:XS};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YS{constructor(t,e){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:s,outSize:o}=t;this.outputShape=[r,o];const i=4*Math.floor(n/4),a=n%4;let u="sumValue += dot(values, ones);";if(null!=e){const t=1/e;u=`sumValue += dot(values * ${Jp(t)?t.toPrecision(2):t}, ones);`}let c="";s%n>0&&(c=`\n        if (inIdx < 0 || inIdx >= ${s}) {\n          return 0.0;\n        }\n      `),this.userCode=`\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${c}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${i}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${u}\n        }\n\n        int inIdx = inOffset + ${i};\n        if (${1===a}) {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ${u}\n        } else if (${2===a}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ${u}\n        } else if (${3===a}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ${u}\n        }\n        setOutput(sumValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZS{constructor(t,e){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:s,outSize:o}=t;this.outputShape=[r,o];let i="0.0",a="";"prod"===e?i="1.0":"min"===e?(i="1.0 / 1e-20",a="min"):"max"===e&&(i="-1.0 / 1e-20",a="max");let u=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"sum"===e?u="sumValue":"prod"===e?u="prodValue":"all"===e?u="allValue":"any"===e&&(u="anyValue");const c=4*Math.floor(n/4),l=n%4;let f=`\n      if (${"sum"===e}) {\n        sumValue += dot(values, ones);\n      } else if (${"prod"===e}) {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ${a}(values, minMaxValue);\n        if (${"min"===e} || ${"max"===e}) {\n          minMaxValue = ${a}(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    `,h="vec4";"all"===e?(i="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===e&&(i="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");let p="";s%n>0&&(p=`\n        if (inIdx < 0 || inIdx >= ${s}) {\n          return initializationValue;\n        }\n      `),this.userCode=`\n      const float initializationValue = ${i};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${p}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        vec4 minMaxValue = vec4(${i});\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ${c}; i += 4) {\n          int inIdx = inOffset + i;\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${f}\n        }\n\n        int inIdx = inOffset + ${c};\n        if (${1===l}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ${f}\n        } else if (${2===l}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ${f}\n        } else if (${3===l}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ${f}\n        }\n        setOutput(${u});\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QS(t,e,n,r){const s=function(t){const e=[];for(;0===e.length||1!==e[e.length-1].outSize;){const n=e.length?e[e.length-1].outSize:t[1],r=Gx(n);e.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return e}(t.shape);let o=t;for(let i=0;i<s.length;i++){const{inSize:a,windowSize:u,outSize:c}=s[i];let l,f;l="mean"===n?0===i?new YS({windowSize:u,inSize:a,batchSize:t.shape[0],outSize:c},a):new YS({windowSize:u,inSize:a,batchSize:t.shape[0],outSize:c}):new ZS({windowSize:u,inSize:a,batchSize:t.shape[0],outSize:c},n),f=o,o=r.runWebGLProgram(l,[o],e),f.dataId!==t.dataId&&r.disposeIntermediateTensorInfo(f)}return o}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class t_{constructor(t,e){this.variableNames=["A"];const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;const r=E$(this.rank),s=function(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e);for(let e=0;e<t.length;e++)r[t[e]]=n[e];return r.join()}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(e);this.userCode=`\n    void main() {\n      ${r} resRC = getOutputCoords();\n      setOutput(getA(${s}));\n    }\n    `}}class e_{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=t[e[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=E$(this.rank),s=fS("rc",this.rank),o=new Array(this.rank);for(let t=0;t<e.length;t++)o[e[t]]=s[t];const i=`vec2(${o.slice(-2).join()})`,a=`++${s[this.rank-1]} < ${n[this.rank-1]}`,u=`getChannel(getA(${o.join()}), ${i})`;this.userCode=`\n    void main() {\n      ${r} rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ${u};\n      if(${a}) {\n        result[1] = ${u};\n      }\n      --${s[this.rank-1]};\n      if(++${s[this.rank-2]} < ${n[this.rank-2]}) {\n        result[2] = ${u};\n        if(${a}) {\n          result[3] = ${u};\n        }\n      }\n      setOutput(result);\n    }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n_(t,e,n){const r=xd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new e_(t.shape,e):new t_(t.shape,e);return n.runWebGLProgram(r,[t],t.dtype)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function r_(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:o,keepDims:i}=r;return function(t,e,n,r){const s=e,o=t.shape.length,i=td(s,t.shape);let a=i;const u=Vw(a,o),c=null!=u;let l=t;c&&(l=n_(t,u,r),a=Ww(a.length,o)),Bw("sum",a,o);const[f,h]=Lw(l.shape,a);let p=f;n&&(p=Pw(f,i));const d=Kp(h),m=XS({inputs:{x:l},attrs:{shape:[Kp(t.shape)/d,d]},backend:r}),y=QS(m,yy(t.dtype),"sum",r),g=XS({inputs:{x:y},attrs:{shape:p},backend:r});return r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(y),c&&r.disposeIntermediateTensorInfo(l),g}(s,o,i,n)}const s_={kernelName:"Sum",backendName:"webgl",kernelFunc:r_};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o_(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{perm:o}=r,i=n,a=s.shape.length,u=new Array(a);for(let t=0;t<u.length;t++)u[t]=s.shape[o[t]];let c;if(i.shouldExecuteOnCPU([s])){const t=i.texData.get(s.dataId).values,e=cS(t,s.shape,s.dtype,o,u);c=i.makeTensorInfo(u,s.dtype);i.texData.get(c.dataId).values=e}else c=n_(s,o,i);return c}const i_={kernelName:"Transpose",backendName:"webgl",kernelFunc:o_};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a_({a:t,b:e,transposeA:n,transposeB:r,backend:s,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:u=null}){const c=t.shape.length,l=e.shape.length,f=n?t.shape[c-2]:t.shape[c-1],h=r?e.shape[l-1]:e.shape[l-2],p=n?t.shape[c-1]:t.shape[c-2],d=r?e.shape[l-2]:e.shape[l-1],m=t.shape.slice(0,-2),y=e.shape.slice(0,-2),g=Kp(m),b=Kp(y),w=kb(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([p,d]);jp(f===h,(()=>`Error in matMul: inner shapes (${f}) and (${h}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${r} must match.`));const v=n?[g,f,p]:[g,p,f],x=r?[b,d,h]:[b,h,d],N=XS({inputs:{x:t},backend:s,attrs:{shape:v}}),$=XS({inputs:{x:e},backend:s,attrs:{shape:x}}),E=[N,$],S=Math.max(g,b),_=n?N.shape[1]:N.shape[2],T=null!=o,k=null!=i,A="leakyrelu"===u,C=null!=u?zS(u,!0):null;let O;if((1===p||1===d)&&_>1e3&&!1===(T||k||A||null!=C)){let t=N,e=$;n&&(t=o_({inputs:{x:N},backend:s,attrs:{perm:[0,2,1]}}),E.push(t)),r&&(e=o_({inputs:{x:$},backend:s,attrs:{perm:[0,2,1]}}),E.push(e));const o=1===d;let i=t;1!==d&&(i=XS({inputs:{x:t},backend:s,attrs:{shape:[S,_,1]}}),E.push(i));const a=1===d?2:1;let u=e;o&&(u=XS({inputs:{x:e},backend:s,attrs:{shape:[S,1,_]}}),E.push(u));const c=HS({inputs:{a:i,b:u},backend:s});O=r_({inputs:{x:c},backend:s,attrs:{axis:a,keepDims:!0}}),E.push(c)}else{const u=my(t.dtype,e.dtype),c=new WS(v,x,[S,p,d],n,r,T,C,k,A),l=[N,$];if(null!=o&&l.push(o),k&&l.push(i),A){const t=s.makeTensorInfo([],"float32",Gm(a,"float32"));l.push(t),E.push(t)}O=s.runWebGLProgram(c,l,u)}const I=XS({inputs:{x:O},backend:s,attrs:{shape:w}});E.push(O);for(const t of E)s.disposeIntermediateTensorInfo(t);return I}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u_={kernelName:"_FusedMatMul",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{a:s,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:u,transposeB:c,activation:l,leakyreluAlpha:f}=r;return a_({a:s,b:o,transposeA:u,transposeB:c,backend:n,bias:i,preluActivationWeights:a,leakyreluAlpha:f,activation:l})}},c_="return abs(x);";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l_={kernelName:"Abs",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e;if(n.shouldExecuteOnCPU([r])&&"complex64"!==r.dtype){const t=n.texData.get(r.dataId),e=JE(t.values);return n.makeTensorInfo(r.shape,r.dtype,e)}let s;return s=xd().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new xS(r.shape,c_):new wS(r.shape,c_),n.runWebGLProgram(s,[r],r.dtype)}},f_={kernelName:"Acos",backendName:"webgl",kernelFunc:BS({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"})},h_={kernelName:"Acosh",backendName:"webgl",kernelFunc:BS({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"})},p_="return a + b;",d_={kernelName:"Add",backendName:"webgl",kernelFunc:VS({opSnippet:p_,packedOpSnippet:p_,supportsComplex:!0,cpuKernelImpl:NE})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class m_{constructor(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map(((t,e)=>`T${e}`));const n=[];this.variableNames.forEach((t=>{n.push(`float v${t} = get${t}AtOutCoords();`)}));const r=this.variableNames.map((t=>`v${t}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        float result = ${r};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y_{constructor(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map(((t,e)=>`T${e}`));const n=[];this.variableNames.forEach((t=>{n.push(`vec4 v${t} = get${t}AtOutCoords();`)}));const r=this.variableNames.map((t=>`v${t}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        vec4 result = ${r};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g_={kernelName:"AddN",backendName:"webgl",kernelFunc:function t(e){const{inputs:n,backend:r}=e,s=n;if(1===s.length)return AS({inputs:{x:s[0]},backend:r});if(s.length>xd().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const e=Math.floor(s.length/2),n=t({inputs:s.slice(0,e),backend:r}),o=t({inputs:s.slice(e),backend:r});return t({inputs:[n,o],backend:r})}const o=s.map((t=>t.dtype)).reduce(((t,e)=>my(t,e))),i=s.map((t=>t.shape)),a=xd().getBool("WEBGL_PACK")?new y_(s[0].shape,i):new m_(s[0].shape,i);return r.runWebGLProgram(a,s,o)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b_={kernelName:"All",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:o,keepDims:i}=r,a=s.shape.length,u=td(o,s.shape);let c=u;const l=Vw(c,a);let f=s;null!=l&&(f=o_({inputs:{x:s},backend:n,attrs:{perm:l}}),c=Ww(c.length,a)),Bw("all",c,a);const[h,p]=Lw(f.shape,c),d=XS({inputs:{x:f},backend:n,attrs:{shape:[-1,Kp(p)]}}),m=QS(d,d.dtype,"all",n);let y;if(i){y=XS({inputs:{x:m},backend:n,attrs:{shape:Pw(h,u)}})}else y=XS({inputs:{x:m},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),null!=l&&n.disposeIntermediateTensorInfo(f),y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w_={kernelName:"Any",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:o,keepDims:i}=r,a=s.shape.length,u=td(o,s.shape);let c=u;const l=Vw(c,a);let f=s;null!=l&&(f=o_({inputs:{x:s},backend:n,attrs:{perm:l}}),c=Ww(c.length,a)),Bw("any",c,a);const[h,p]=Lw(f.shape,c),d=XS({inputs:{x:f},backend:n,attrs:{shape:[-1,Kp(p)]}}),m=QS(d,d.dtype,"any",n);let y;if(i){y=XS({inputs:{x:m},backend:n,attrs:{shape:Pw(h,u)}})}else y=XS({inputs:{x:m},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),null!=l&&n.disposeIntermediateTensorInfo(f),y}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class v_{constructor(t,e,n){this.variableNames=["A"];const{windowSize:r,batchSize:s,outSize:o}=t;n||this.variableNames.push("bestIndicesA"),this.outputShape=[s,o];const i="max"===e?">":"<",a=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${r};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${r}; i++) {\n          int inIdx = ${a};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${i} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x_{constructor(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,jp(t.length>2,(()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`));const s=t[t.length-1],o=Math.ceil(s/e);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const i=this.outputShape,a=i.length,u=E$(a),c=hS("coords",a);let l,f;if(1===o){f=a+1;const t=E$(f);l=`\n        ${t} sourceLocR = ${t}(${c.join()}, 0);\n        ++${c[a-1]};\n        ${t} sourceLocG = ${t}(${c.join()}, 0);\n        ++${c[a-2]};\n        ${t} sourceLocA = ${t}(${c.join()}, 0);\n        --${c[a-1]};\n        ${t} sourceLocB = ${t}(${c.join()}, 0);\n        --${c[a-2]};`}else f=a,l=`\n        ${u} sourceLocR = coords;\n        ++${c[a-1]};\n        ${u} sourceLocG = coords;\n        ++${c[a-2]};\n        ${u} sourceLocA = coords;\n        --${c[a-1]};\n        ${u} sourceLocB = coords;\n        --${c[a-2]};`;const h=["x","y","z","w","u","v"].slice(0,f),p="."+h[f-1],d=h.map((t=>"int "+t)),m=hS("sourceLocR",f-1).concat("inIdx.r"),y=hS("sourceLocG",f-1).concat("inIdx.g"),g=hS("sourceLocB",f-1).concat("inIdx.b"),b=hS("sourceLocA",f-1).concat("inIdx.a"),w="max"===n?"greaterThan":"lessThan",v=r?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${m.join()}),\n                             getBestIndicesAChannel(${y.join()}),\n                             getBestIndicesAChannel(${g.join()}),\n                             getBestIndicesAChannel(${b.join()})));`,x=`vec4(\n            getAChannel(${m.join()}),\n            hasNextCol ? getAChannel(${y.join()}) : 0.,\n            hasNextRow ? getAChannel(${g.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,N=r?"":`\n      float getBestIndicesAChannel(${d.join()}) {\n        return getChannel(getBestIndicesA(${h.join()}),\n                                          vec2(${h.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${d.join()}) {\n        return getChannel(getA(${h.join()}),\n                               vec2(${h.slice(-2).join()}));\n      }\n      ${N}\n      void main() {\n        ${u} coords = getOutputCoords();\n        bool hasNextCol = ${c[a-1]} < ${i[a-1]-1};\n        bool hasNextRow = ${c[a-2]} < ${i[a-2]-1};\n        ${l}\n        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},\n          sourceLocB${p}, sourceLocA${p}) * ${e};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${x};\n\n        for (int i = 0; i < ${e}; i++) {\n          inIdx = srcIdx;\n          ${v}\n          vec4 candidate = ${x};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${w}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N_(t,e,n,r=null){let s=e.shape[0],o=e.shape[1];null!=r&&(s=r.shape[0],o=r.shape[1]);const i=Gx(o),a={windowSize:i,inSize:o,batchSize:s,outSize:Math.ceil(o/i)},u=new v_(a,n,null==r),c=[e];null!=r&&c.push(r);const l=t.runWebGLProgram(u,c,"int32");if(1===l.shape[1])return l;const f=N_(t,e,n,l);return t.disposeIntermediateTensorInfo(l),f}function $_(t,e,n,r=null){const s=null!=r?r.shape:e.shape,o=Gx(s[s.length-1]),i=new x_(s,o,n,null==r),a=null==r?[e]:[e,r],u=t.runWebGLProgram(i,a,"int32");if(u.shape.length===e.shape.length){const r=$_(t,e,n,u);return t.disposeIntermediateTensorInfo(u),r}return u}function E_(t,e,n,r){const s=[n];if(Bw("arg"+r.charAt(0).toUpperCase()+r.slice(1),s,e.shape.length),!xd().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const n=[],o=t.texData.get(e.dataId);let i=e;null!==o&&o.isPacked&&(i=t.unpackTensor(e),n.push(i));const[a,u]=Lw(i.shape,s),c=Kp(u),l=XS({inputs:{x:i},backend:t,attrs:{shape:[-1,c]}});n.push(l);const f=N_(t,l,r);n.push(f);const h=XS({inputs:{x:f},backend:t,attrs:{shape:a}});return n.forEach((e=>t.disposeIntermediateTensorInfo(e))),h}return $_(t,e,r)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S_={kernelName:"ArgMax",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:o}=r;let i=td(o,s.shape);const a=Vw(i,s.shape.length);let u=s;const c=[];null!=a&&(u=o_({inputs:{x:s},backend:n,attrs:{perm:a}}),c.push(u),i=Ww(i.length,u.shape.length)),Bw("argMax",[i[0]],u.shape.length);const l=E_(n,u,i[0],"max");return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),l}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const __={kernelName:"ArgMin",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:o}=r;let i=td(o,s.shape);const a=Vw(i,s.shape.length);let u=s;const c=[];null!=a&&(u=o_({inputs:{x:s},backend:n,attrs:{perm:a}}),c.push(u),i=Ww(i.length,u.shape.length)),Bw("argMin",[i[0]],u.shape.length);const l=E_(n,u,i[0],"min");return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),l}},T_={kernelName:"Asin",backendName:"webgl",kernelFunc:BS({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"})},k_={kernelName:"Asinh",backendName:"webgl",kernelFunc:BS({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"})},A_={kernelName:"Atan",backendName:"webgl",kernelFunc:BS({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"})},C_={kernelName:"Atan2",backendName:"webgl",kernelFunc:VS({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"})},O_={kernelName:"Atanh",backendName:"webgl",kernelFunc:BS({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class I_{constructor(t,e,n,r=!1,s=!1){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");const o=t.filterWidth,i=t.strideHeight,a=t.strideWidth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;const d="avg"===e,m=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,y=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`;let g="0.0";if(d||(g="-1.0 / 1e-20"),n){const e=">=";return void(this.userCode=`\n        const ivec2 strides = ivec2(${i}, ${a});\n        const ivec2 pads = ivec2(${h}, ${p});\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ${l};\n              wR += ${u}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${f};\n                wC += ${c}) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ${e} currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ${r?s?m:y:`wR * ${f} + wC`};\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let b=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===e&&(b="avgValue / count");const w=4*Math.floor(o/4),v=o%4,x=`\n      if (${d}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec2 strides = ivec2(${i}, ${a});\n      const ivec2 pads = ivec2(${h}, ${p});\n      const float initializationValue = ${g};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ${t.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${g});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ${l};\n            wR += ${u}) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ${t.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${w}; wC += 4) {\n            int xC = xCCorner + wC * ${c};\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${c}, d),\n              getValue(batch, xR, xC + 2 * ${c}, d),\n              getValue(batch, xR, xC + 3 * ${c}, d)\n            );\n\n            ${x}\n          }\n\n          int xC = xCCorner + ${w};\n          if (${1===v}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ${x}\n          } else if (${2===v}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${c}, d),\n              initializationValue,\n              initializationValue\n            );\n\n            ${x}\n          } else if (${3===v}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${c}, d),\n              getValue(batch, xR, xC + 2 * ${c}, d),\n              initializationValue\n            );\n\n            ${x}\n          }\n        }\n        setOutput(${b});\n      }\n    `}}class M_{constructor(t,e,n,r=!1,s=!1){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");const o=t.filterWidth,i=t.strideDepth,a=t.strideHeight,u=t.strideWidth,c=t.dilationDepth,l=t.dilationHeight,f=t.dilationWidth,h=t.effectiveFilterDepth,p=t.effectiveFilterHeight,d=t.effectiveFilterWidth,m=t.padInfo.front,y=t.padInfo.top,g=t.padInfo.left;this.outputShape=t.outShape;const b="avg"===e;let w="0.0";if(b||(w="-1.0 / 1e-20"),n){const e=">=";return void(this.userCode=`\n        const ivec3 strides =\n            ivec3(${i}, ${a}, ${u});\n        const ivec3 pads = ivec3(${m}, ${y}, ${g});\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ${h};\n              wD += ${c}) {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ${t.inDepth}) {\n              continue;\n            }\n\n            for (int wR = 0; wR < ${p};\n                wR += ${l}) {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ${t.inHeight}) {\n                continue;\n              }\n\n              for (int wC = 0; wC < ${d};\n                  wC += ${f}) {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ${t.inWidth}) {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ${e} currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ${r?s?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${p} * ${d} +\n                      wR * ${d} + wC`};\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let v=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===e&&(v="avgValue / count");const x=4*Math.floor(o/4),N=o%4,$=`\n      if (${b}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec3 strides =\n        ivec3(${i}, ${a}, ${u});\n      const ivec3 pads = ivec3(${m}, ${y}, ${g});\n      const float initializationValue = ${w};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ${t.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${w});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ${h};\n            wD += ${c}) {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ${t.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${p};\n            wR += ${l}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${x}; wC += 4) {\n              int xC = xCCorner + wC * ${f};\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${f}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${f}, ch),\n                getValue(batch, xD, xR, xC + 3 * ${f}, ch)\n              );\n\n              ${$}\n            }\n\n            int xC = xCCorner + ${x};\n            if (${1===N}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ${$}\n            } else if (${2===N}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${f}, ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ${$}\n            } else if (${3===N}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${f}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${f}, ch),\n                initializationValue\n              );\n\n              ${$}\n            }\n          }\n          setOutput(${v});\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R_={kernelName:"AvgPool",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e;o$(s,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:u}=r;jp(dw(i,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '1'`));const c=sw(s.shape,o,i,1,a,u);if(1===c.filterWidth&&1===c.filterHeight&&Xp(c.inShape,c.outShape))return AS({inputs:{x:s},backend:n});const l=new I_(c,"avg",!1);return n.runWebGLProgram(l,[s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D_={kernelName:"AvgPool3D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:u,dataFormat:c}=r,l=ow(s.shape,o,i,[1,1,1],a,u,c),f=new M_(l,"avg",!1);return n.runWebGLProgram(f,[s],"float32")}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class F_{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,s=t.strideWidth,o=t.dilationHeight,i=t.dilationWidth,a=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=a-1-t.padInfo.top,l=u-1-t.padInfo.left,f=1/(e*n);this.userCode=`\n      const ivec2 pads = ivec2(${c}, ${l});\n      const float avgMultiplier = float(${f});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${a};\n            wR += ${o}) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${u};\n            wC+= ${i}) {\n            float dyC = float(dyCCorner + wC) / ${s}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class L_{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,s=t.strideDepth,o=t.strideHeight,i=t.strideWidth,a=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,f=t.effectiveFilterHeight,h=t.effectiveFilterWidth,p=l-1-t.padInfo.front,d=f-1-t.padInfo.top,m=h-1-t.padInfo.left,y=1/(e*n*r);this.userCode=`\n      const ivec3 pads = ivec3(${p}, ${d}, ${m});\n      const float avgMultiplier = float(${y});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${l};\n            wD += ${a}) {\n          float dyD = float(dyDCorner + wD) / ${s}.0;\n\n          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${f};\n              wR += ${u}) {\n            float dyR = float(dyRCorner + wR) / ${o}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${h};\n                wC += ${c}) {\n              float dyC = float(dyCCorner + wC) / ${i}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P_={kernelName:"AvgPool3DGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,input:o}=e,i=o,{filterSize:a,strides:u,pad:c,dimRoundingMode:l}=r,f=ow(i.shape,a,u,[1,1,1],c,l),h=new L_(f);return n.runWebGLProgram(h,[s],i.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B_={kernelName:"AvgPoolGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,input:o}=e,i=o;o$([s,o],"avgPoolGrad");const{filterSize:a,strides:u,pad:c}=r,l=sw(i.shape,a,u,1,c),f=new F_(l);return n.runWebGLProgram(f,[s],i.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V_={kernelName:"BatchMatMul",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{a:s,b:o}=e,{transposeA:i,transposeB:a}=r;return a_({a:s,b:o,transposeA:i,transposeB:a,backend:n})}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class z_{constructor(t,e,n,r,s,o){this.outputShape=[],this.variableNames=["x","mean","variance"],kb(t,e),kb(t,n);let i="0.0";null!=r&&(kb(t,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");let a="1.0";null!=s&&(kb(t,s),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ${i};\n        float scale = ${a};\n        float inv = scale * inversesqrt(variance + float(${o}));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W_{constructor(t,e,n,r,s,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],kb(t,e),kb(t,n);let i="vec4(0.0)";null!=r&&(kb(t,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");let a="vec4(1.0)";null!=s&&(kb(t,s),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        vec4 offset = ${i};\n        vec4 scale = ${a};\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(${o}));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U_={kernelName:"FusedBatchNorm",backendName:"webgl",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,mean:s,variance:o,offset:i,scale:a}=t;jp(s.shape.length===o.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),jp(null==i||s.shape.length===i.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),jp(null==a||s.shape.length===a.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));let{varianceEpsilon:u}=n;null==u&&(u=.001);const c=[r,s,o];let l=null;null!=i&&(l=i.shape,c.push(i));let f=null;null!=a&&(f=a.shape,c.push(a));const h=xd().getBool("WEBGL_PACK_NORMALIZATION")?new W_(r.shape,s.shape,o.shape,l,f,u):new z_(r.shape,s.shape,o.shape,l,f,u);return e.runWebGLProgram(h,c,c[0].dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class j_{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const e=E$(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=function(t){if(1===t)return"sourceLoc";if(t<=6)return G_.slice(0,t).map((t=>"sourceLoc."+t)).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(this.rank);let r;const s=t.map(((t,e)=>`sourceLoc.${G_[e]} = start[${e}] + coords.${G_[e]};`));r=`\n        ${e} sourceLoc;\n        ${e} coords = getOutputCoords();\n        ${s.join("\n")}\n      `,this.userCode=`\n      void main() {\n        ${r}\n        setOutput(getSource(${n}));\n      }\n    `}}const G_=["x","y","z","w","u","v"];class q_{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const e=E$(this.rank),n=hS("coords",this.rank),r=hS("sourceLoc",this.rank),s=1===this.rank?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${s})`,i=`\n      result.x = ${o};\n      if (++${n[this.rank-1]} < ${t[this.rank-1]}) {\n        ++${r[this.rank-1]};\n        result.y = ${o};\n        --${r[this.rank-1]};\n      }\n    `,a=1===this.rank?"":`\n      --${n[this.rank-1]};\n      if (++${n[this.rank-2]} < ${t[this.rank-2]}) {\n        ++${r[this.rank-2]};\n        result.z = ${o};\n        if (++${n[this.rank-1]} < ${t[this.rank-1]}) {\n          ++${r[this.rank-1]};\n          result.w = ${o};\n        }\n      }\n    `,u=this.rank<=4?`sourceLoc = coords +\n            ${e}(${t.map(((t,e)=>`start[${e}]`)).join()});`:t.map(((t,e)=>`${r[e]} = ${n[e]} + start[${e}];`)).join("\n");this.userCode=`\n      void main() {\n        ${e} coords = getOutputCoords();\n        ${e} sourceLoc;\n        ${u}\n        vec4 result = vec4(0.);\n        ${i}\n        ${a}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H_(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{begin:o,size:i}=r,[a,u]=qb(s,o,i);if(Rb(s,a,u),0===Kp(u))return n.makeTensorInfo(u,s.dtype,[]);if(n.shouldExecuteOnCPU([s])||"string"===s.dtype){const t=n.texData.get(s.dataId),e=YE(t.values,a,u,s.shape,s.dtype);return n.makeTensorInfo(u,s.dtype,e)}const{isPacked:c}=n.texData.get(s.dataId),l=jb(s.shape,a,u);if(c||!l){const t=xd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new q_(u):new j_(u),e=[a];return n.runWebGLProgram(t,[s],s.dtype,e)}return n.uploadToGPU(s.dataId),function(t,e,n,r){const s=r.texData.get(t.dataId),o=r.makeTensorInfo(n,t.dtype),i=r.texData.get(o.dataId);Object.assign(i,s),i.refCount=1,i.shape=n,i.dtype=t.dtype;let a=Gb(e,ld(t.shape));s.slice&&(a+=s.slice.flatOffset),i.slice={flatOffset:a,origDataId:s.slice&&s.slice.origDataId||t.dataId};const u=r.dataRefCount.get(i.slice.origDataId)||1;return r.dataRefCount.set(i.slice.origDataId,u+1),o}(s,a,u,n)}const K_={kernelName:"Slice",backendName:"webgl",kernelFunc:H_},X_={kernelName:"BatchToSpaceND",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{blockShape:o,crops:i}=r;jp(s.shape.length<=4,(()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"));const a=o.reduce(((t,e)=>t*e)),u=Hx(s.shape,o,a),c=Kx(u.length,o.length),l=Xx(s.shape,o,a),f=Jx(i,o.length),h=Yx(l,i,o.length),p=[],d=XS({inputs:{x:s},backend:n,attrs:{shape:u}}),m=o_({inputs:{x:d},backend:n,attrs:{perm:c}}),y=XS({inputs:{x:m},backend:n,attrs:{shape:l}}),g=H_({inputs:{x:y},backend:n,attrs:{begin:f,size:h}});return p.push(d),p.push(m),p.push(y),p.forEach((t=>n.disposeIntermediateTensorInfo(t))),g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J_={kernelName:"Bincount",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,weights:o}=e,{size:i}=r,a=n.readSync(s.dataId),u=n.readSync(o.dataId),c=$E(a,u,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,c)}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y_={kernelName:"BroadcastArgs",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{s0:r,s1:s}=e,o=n.readSync(r.dataId),i=n.readSync(s.dataId),a=kb(Array.from(o),Array.from(i));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}},Z_=VS({opSnippet:"return float(a != b);",cpuKernelImpl:jE,dtype:"bool"}),Q_={kernelName:"NotEqual",backendName:"webgl",kernelFunc:Z_};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function tT(t){const{inputs:e,backend:n}=t,{input:r}=e;return AS({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}const eT={kernelName:"Real",backendName:"webgl",kernelFunc:tT};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nT={kernelName:"Cast",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function t(e){const{inputs:n,backend:r,attrs:s}=e,{x:o}=n,{dtype:i}=s;if("complex64"===i){if("complex64"===o.dtype)return AS({inputs:{x:o},backend:r});const e=vv(o.shape),n=t({inputs:{x:o},backend:r,attrs:{dtype:"float32"}}),s=OS({inputs:{real:n,imag:e},backend:r});return e.dispose(),r.disposeIntermediateTensorInfo(n),s}if("complex64"===o.dtype){const e=tT({inputs:{input:o},backend:r}),n=t({inputs:{x:e},backend:r,attrs:{dtype:i}});return r.disposeIntermediateTensorInfo(e),n}if(a=o.dtype,"complex64"===(u=i)||"float32"===u&&"complex64"!==a||"int32"===u&&"float32"!==a&&"complex64"!==a||"bool"===u&&"bool"===a){const t=AS({inputs:{x:o},backend:r});return{dataId:t.dataId,shape:t.shape,dtype:i}}var a,u;if("int32"===i)return function(t,e){const n=new wS(t.shape,"return float(int(x));"),r=e.runWebGLProgram(n,[t],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(o,r);if("bool"===i){const t=r.makeTensorInfo([],"bool",nd("bool",1)),e=Z_({inputs:{a:o,b:t},backend:r});return r.disposeIntermediateTensorInfo(t),e}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${i}`)}},rT="return ceil(x);",sT={kernelName:"Ceil",backendName:"webgl",kernelFunc:BS({opSnippet:rT,packedOpSnippet:rT,cpuKernelImpl:SE})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class oT{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iT{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aT={kernelName:"ClipByValue",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{clipValueMin:o,clipValueMax:i}=r;let a;a=xd().getBool("WEBGL_PACK_CLIP")?new iT(s.shape):new oT(s.shape);const u=[[o],[i]];return n.runWebGLProgram(a,[s],s.dtype,u)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uT{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cT(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}const lT={kernelName:"ComplexAbs",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e,s=n.texData.get(r.dataId),o=new uT(r.shape),i=[cT(r,s.complexTensorInfos.real),cT(r,s.complexTensorInfos.imag)];return n.runWebGLProgram(o,i,i[0].dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fT{constructor(t){this.outputShape=[],this.outputShape=jx(t,1),this.variableNames=t.map(((t,e)=>`T${e}`));const e=new Array(t.length-1);e[0]=t[0][1];for(let n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];const n=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let t=1;t<e.length;t++){const r=e[t-1];n.push(`else if (yC < ${e[t]}) setOutput(getT${t}(yR, yC-${r}));`)}const r=e.length,s=e[e.length-1];n.push(`else setOutput(getT${r}(yR, yC-${s}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hT{constructor(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=jx(t,e);const n=this.outputShape,r=n.length,s=E$(r),o=hS("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(((t,e)=>`T${e}`));const a=new Array(t.length-1);a[0]=t[0][e];for(let n=1;n<a.length;n++)a[n]=a[n-1]+t[n][e];const u=i[e],c=i.slice(-2),l=i.join();let f=`if (${u} < ${a[0]}) {\n        return getChannel(\n            getT0(${l}), vec2(${c.join()}));\n        }`;for(let t=1;t<a.length;t++){const e=a[t-1];f+=`\n        if (${u} < ${a[t]}  && ${u} >= ${a[t-1]}) {\n          return getChannel(\n            getT${t}(${pT(i,u,e)}),\n            vec2(${pT(c,u,e)}));\n        }`}const h=a.length,p=a[a.length-1];f+=`\n        return getChannel(\n          getT${h}(${pT(i,u,p)}),\n          vec2(${pT(c,u,p)}));`,this.userCode=`\n      float getValue(${i.map((t=>"int "+t))}) {\n        ${f}\n      }\n\n      void main() {\n        ${s} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${o}), 0., 0., 0.);\n\n        ${o[r-1]} = ${o[r-1]} + 1;\n        if (${o[r-1]} < ${n[r-1]}) {\n          result.g = getValue(${o});\n        }\n\n        ${o[r-2]} = ${o[r-2]} + 1;\n        if (${o[r-2]} < ${n[r-2]}) {\n          result.a = getValue(${o});\n        }\n\n        ${o[r-1]} = ${o[r-1]} - 1;\n        if (${o[r-2]} < ${n[r-2]} &&\n            ${o[r-1]} < ${n[r-1]}) {\n          result.b = getValue(${o});\n        }\n        setOutput(result);\n      }\n    `}}function pT(t,e,n){const r=t.indexOf(e),s=t.map(((t,e)=>e===r?`${t} - ${n}`:t));return s.join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dT(t){const{inputs:e,backend:n}=t,{input:r}=e;return AS({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}const mT={kernelName:"Imag",backendName:"webgl",kernelFunc:dT};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yT(t,e,n){const r=t[0].dtype;if("complex64"===r){const r=t.map((t=>tT({inputs:{input:t},backend:n}))),s=t.map((t=>dT({inputs:{input:t},backend:n}))),o=yT(r,e,n),i=yT(s,e,n),a=OS({inputs:{real:o,imag:i},backend:n});return r.forEach((t=>n.disposeIntermediateTensorInfo(t))),s.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),a}let s=n.shouldExecuteOnCPU(t);if("string"===r&&(s=!0),s){const s=t.map((t=>{const r=Kp(t.shape.slice(e));return XS({inputs:{x:t},backend:n,attrs:{shape:[-1,r]}})})),o=s.map((t=>({vals:n.readSync(t.dataId),shape:t.shape}))),i=jx(s.map((t=>t.shape)),1),a=1===s[0].shape[0],u=_E(o,i,r,a),c=jx(t.map((t=>t.shape)),e),l=n.makeTensorInfo(c,r,u);return s.forEach((t=>n.disposeIntermediateTensorInfo(t))),l}if(t.length>xd().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const r=Math.floor(t.length/2),s=yT(t.slice(0,r),e,n),o=yT(t.slice(r),e,n),i=yT([s,o],e,n);return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),i}if(xd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].shape.length>1){const s=new hT(t.map((t=>t.shape)),e);return n.runWebGLProgram(s,t,r)}const{tensors2D:o,outShape:i}=function(t,e,n){const r=jx(t.map((t=>t.shape)),e),s=t.map((t=>XS({inputs:{x:t},attrs:{shape:[-1,Kp(t.shape.slice(e))]},backend:n})));return{tensors2D:s,outShape:r}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e,n),a=new fT(o.map((t=>t.shape))),u=n.runWebGLProgram(a,o,r);o.forEach((t=>n.disposeIntermediateTensorInfo(t)));const c=XS({inputs:{x:u},attrs:{shape:i},backend:n});return n.disposeIntermediateTensorInfo(u),c}function gT(t){const{inputs:e,backend:n,attrs:r}=t,{axis:s}=r,o=td(s,e[0].shape)[0],i=jx(e.map((t=>t.shape)),o);if(0===Kp(i))return n.makeTensorInfo(i,e[0].dtype,[]);const a=e.filter((t=>Kp(t.shape)>0));if(1===a.length)return AS({inputs:{x:a[0]},backend:n});const u=a.map((t=>t.shape));return Ux(u,o),yT(a,o,n)}const bT={kernelName:"Concat",backendName:"webgl",kernelFunc:gT};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wT{constructor(t,e=!1,n=null,r=!1,s=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const o=t.padInfo.top,i=t.padInfo.left,a=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,f=t.filterHeight,h=t.filterWidth,p=4*Math.floor(t.inChannels/4),d=t.inChannels%4,m="channelsLast"===t.dataFormat,y=m?1:2,g=m?2:3,b=m?3:1;let w="",v="";n&&(w=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:s?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,v="result = activation(result);");const x=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${w}\n\n      const ivec2 strides = ivec2(${a}, ${u});\n      const ivec2 pads = ivec2(${o}, ${i});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${b}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${y}], coords[${g}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${f}; wR++) {\n          int xR = xRCorner + wR * ${c};\n\n          if (xR < 0 || xR >= ${t.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${h}; wC++) {\n            int xC = xCCorner + wC * ${l};\n\n            if (xC < 0 || xC >= ${t.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${p}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${m}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===d}) {\n\n              if (${m}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${p}) *\n                    getW(wR, wC, ${p}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${p}, xR, xC) *\n                    getW(wR, wC, ${p}, d2);\n              }\n\n            } else if (${2===d}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2)\n              );\n\n              if (${m}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===d}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2),\n                getW(wR, wC, ${p} + 2, d2)\n              );\n\n              if (${m}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1),\n                  getX(batch, xR, xC, ${p} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC),\n                  getX(batch, ${p} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${x}\n        ${v}\n        setOutput(result);\n      }\n    `}}class vT{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,s=t.strideDepth,o=t.strideHeight,i=t.strideWidth,a=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterDepth,f=t.filterHeight,h=t.filterWidth,p=4*Math.floor(t.inChannels/4),d=t.inChannels%4;this.userCode=`\n      const ivec3 strides = ivec3(${s}, ${o}, ${i});\n      const ivec3 pads = ivec3(${e}, ${n}, ${r});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${l}; wF++) {\n          int xF = xFCorner + wF * ${a};\n\n          if (xF < 0 || xF >= ${t.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${f}; wR++) {\n            int xR = xRCorner + wR * ${u};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${h}; wC++) {\n              int xC = xCCorner + wC * ${c};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ${p}; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (${1===d}) {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ${p}) *\n                  getW(wF, wR, wC, ${p}, d2);\n              } else if (${2===d}) {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (${3===d}) {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1),\n                  getX(batch, xF, xR, xC, ${p} + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2),\n                  getW(wF, wR, wC, ${p} + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xT{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=O$(this.outputShape.length);const{dataFormat:n}=e,r=a$(),s="channelsLast"===n,o=s?0:1,i=s?1:2,a=this.enableShapeUniforms?"if(blockIndex < outShape[1] && pos < outShape[0]) {":`if(blockIndex < ${t[1]} && pos < ${t[0]}) {`;let u="";for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)u+=`\n          blockIndex = rc.y + ${e};\n          pos = rc.x + ${t};\n\n          ${a}\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[${o}] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[${i}] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (${s}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*t+e}] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*t+e}] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${u}\n\n        ${r.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NT({x:t,filter:e,convInfo:n,backend:r,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const u=t.shape,c=r.texData.get(t.dataId),l=n.inChannels,f=u[0]*u[1]*u[2],h=n.outChannels,p="channelsLast"===n.dataFormat;let d;const m=[];if(null!=o&&!p&&3===o.shape.length){const t=o_({inputs:{x:o},backend:r,attrs:{perm:[1,2,0]}});m.push(t),o=t}if(!((1===f||1===h)&&l>1e3)&&c.isPacked&&p&&null!=c.texture&&u[2]%2!=0&&Xp(c.shape.slice(-3),u.slice(-3))){const l=u[0]*u[1]*(u[2]+1),f={dataId:t.dataId,shape:[1,l,n.inChannels],dtype:t.dtype},h=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,jp(ZN(c.shape,f.shape),(()=>`packed reshape ${c.shape} to ${f.shape} isn't free`));const p=XS({inputs:{x:e},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});m.push(p);const y=a_({a:f,b:p,backend:r,transposeA:false,transposeB:false,bias:s,activation:a,preluActivationWeights:o,leakyreluAlpha:i}),g=r.texData.get(y.dataId);jp(g.isPacked,(()=>"batchMatMul result is expected to be packed")),c.shape=h,g.shape=n.outShape,d=AS({inputs:{x:y},backend:r}),d.shape=n.outShape,m.push(y)}else{const u=p?t:o_({inputs:{x:t},backend:r,attrs:{perm:[0,2,3,1]}}),c=u.shape,l=XS({inputs:{x:u},backend:r,attrs:{shape:[1,c[0]*c[1]*c[2],n.inChannels]}}),f=XS({inputs:{x:e},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),h=a_({a:l,b:f,transposeA:false,transposeB:false,backend:r,bias:s,activation:a,preluActivationWeights:o,leakyreluAlpha:i}),y=XS({inputs:{x:h},backend:r,attrs:{shape:[n.batchSize,n.outHeight,n.outWidth,n.outChannels]}});d=p?y:o_({inputs:{x:y},backend:r,attrs:{perm:[0,3,1,2]}}),p||(m.push(u),m.push(y)),m.push(l),m.push(f),m.push(h)}for(const t of m)r.disposeIntermediateTensorInfo(t);return d}function $T({x:t,filter:e,convInfo:n,backend:r,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const{filterWidth:u,filterHeight:c,inChannels:l,outWidth:f,outHeight:h,dataFormat:p}=n,d="channelsLast"===p,m=u*c*l,y=h*f,g=[m,y],b=[];if(null!=o&&!d&&3===o.shape.length){const t=o_({inputs:{x:o},backend:r,attrs:{perm:[1,2,0]}});b.push(t),o=t}const w=XS({inputs:{x:t},backend:r,attrs:{shape:t.shape.slice(1)}}),v=XS({inputs:{x:e},backend:r,attrs:{shape:[1,m,Kp(e.shape)/m]}});b.push(w),b.push(v);const x=new xT(g,n),N=[w.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],$=r.runWebGLProgram(x,[w],"float32",N),E=XS({inputs:{x:$},backend:r,attrs:{shape:[1,g[0],g[1]]}});b.push($),b.push(E);const S=null!=s,_=null!=o,T="leakyrelu"===a,k=a?zS(a,!0):null,A=new WS(E.shape,v.shape,[1,y,n.outChannels],!0,!1,S,k,_,T),C=[E,v];if(s&&C.push(s),_&&C.push(o),T){const t=r.makeTensorInfo([],"float32",Gm(i,"float32"));C.push(t),b.push(t)}const O=r.runWebGLProgram(A,C,"float32"),I=XS({inputs:{x:O},backend:r,attrs:{shape:[1,h,f,n.outChannels]}}),M=d?I:o_({inputs:{x:I},backend:r,attrs:{perm:[0,3,1,2]}});d||b.push(I),b.push(O);for(const t of b)r.disposeIntermediateTensorInfo(t);return M}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ET={kernelName:"Conv2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:o}=e,{strides:i,pad:a,dataFormat:u,dilations:c,dimRoundingMode:l}=r,f=mw(u),h=iw(s.shape,o.shape,i,c,a,l,!1,f);let p;if(1!==h.filterHeight||1!==h.filterWidth||1!==h.dilationHeight||1!==h.dilationWidth||1!==h.strideHeight||1!==h.strideWidth||"SAME"!==h.padInfo.type&&"VALID"!==h.padInfo.type)if(xd().getBool("WEBGL_CONV_IM2COL")&&1===s.shape[0])p=$T({x:s,filter:o,convInfo:h,backend:n});else{const t=new wT(h);p=n.runWebGLProgram(t,[s,o],"float32")}else p=NT({x:s,filter:o,convInfo:h,backend:n});const d=XS({inputs:{x:p},backend:n,attrs:{shape:h.outShape}});return n.disposeIntermediateTensorInfo(p),d}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ST{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,s=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${e} - ${r};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${s};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              if (${o}) {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class _T{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,s=t.strideWidth,o="channelsLast"===t.dataFormat,i=e-1-t.padInfo.top,a=n-1-t.padInfo.left,u=o?1:2,c=o?2:3,l=o?3:1;this.userCode=`\n      const ivec2 pads = ivec2(${i}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${l}];\n\n        ivec2 dyCorner = ivec2(coords[${u}], coords[${c}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${s}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n\n              if (${o}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class TT{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,s=t.padInfo.front,o=t.padInfo.top,i=t.padInfo.left;this.userCode=`\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yF = 0; yF < ${t.outDepth}; yF++) {\n            int xF = wF + yF * ${e} - ${s};\n\n            if (xF < 0 || xF >= ${t.inDepth}) {\n              continue;\n            }\n\n            for (int yR = 0; yR < ${t.outHeight}; yR++) {\n              int xR = wR + yR * ${n} - ${o};\n\n              if (xR < 0 || xR >= ${t.inHeight}) {\n                continue;\n              }\n\n              for (int yC = 0; yC < ${t.outWidth}; yC++) {\n                int xC = wC + yC * ${r} - ${i};\n\n                if (xC < 0 || xC >= ${t.inWidth}) {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class kT{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,s=t.strideDepth,o=t.strideHeight,i=t.strideWidth,a=e-1-t.padInfo.front,u=n-1-t.padInfo.top,c=r-1-t.padInfo.left;this.userCode=`\n      const ivec3 pads = ivec3(${a}, ${u}, ${c});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${e}; wF++) {\n          float dyF = float(dyFCorner + wF) / ${s}.0;\n\n          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ${e} - 1 - wF;\n\n          for (int wR = 0; wR < ${n}; wR++) {\n            float dyR = float(dyRCorner + wR) / ${o}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ${n} - 1 - wR;\n\n            for (int wC = 0; wC < ${r}; wC++) {\n              float dyC = float(dyCCorner + wC) / ${i}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ${r} - 1 - wC;\n\n              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AT={kernelName:"Conv2DBackpropFilter",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,dy:o}=e,{strides:i,pad:a,dataFormat:u,dimRoundingMode:c,filterShape:l}=r,f=mw(u),h=iw(s.shape,l,i,1,a,c,!1,f),p=new ST(h);return n.runWebGLProgram(p,[s,o],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CT={kernelName:"Conv2DBackpropInput",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,filter:o}=e,{inputShape:i,strides:a,pad:u,dataFormat:c,dimRoundingMode:l}=r,f=mw(c),h=iw(i,o.shape,a,1,u,l,!1,f),p=new _T(h);return n.runWebGLProgram(p,[s,o],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OT={kernelName:"Conv3D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:o}=e,{strides:i,pad:a,dilations:u}=r,c=aw(s.shape,o.shape,i,u,a),l=new vT(c);return n.runWebGLProgram(l,[s,o],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IT={kernelName:"Conv3DBackpropFilterV2",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,dy:o}=e,{strides:i,pad:a,filterShape:u}=r,c=aw(s.shape,u,i,1,a),l=new TT(c);return n.runWebGLProgram(l,[s,o],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MT={kernelName:"Conv3DBackpropInputV2",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,filter:o}=e,{pad:i,strides:a,inputShape:u}=r,c=aw(u,o.shape,a,1,i),l=new kT(c);return n.runWebGLProgram(l,[s,o],"float32")}},RT={kernelName:"Cos",backendName:"webgl",kernelFunc:BS({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n"})},DT={kernelName:"Cosh",backendName:"webgl",kernelFunc:BS({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class FT{constructor(t,e,n,r,s){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,i,a,u]=t,[c]=e,[l,f]=n;this.outputShape=[c,l,f,u];const h="bilinear"===r?1:0,[p,d]=[i-1+".0",a-1+".0"],[m,y,g]=l>1?[""+(i-1)/(l-1),"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[b,w,v]=f>1?[""+(a-1)/(f-1),"(x2-x1) * width_ratio",`x1*${d} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${d}`];this.userCode=`\n      const float height_ratio = float(${m});\n      const float width_ratio = float(${b});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${o}) {\n          return;\n        }\n\n        float height_scale = ${y};\n        float width_scale = ${w};\n\n        float in_y = ${g};\n        if( in_y < 0.0 || in_y > ${p} ) {\n          setOutput(float(${s}));\n          return;\n        }\n        float in_x = ${v};\n        if( in_x < 0.0 || in_x > ${d} ) {\n          setOutput(float(${s}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${h} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LT={kernelName:"CropAndResize",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{image:s,boxes:o,boxInd:i}=e,{cropSize:a,method:u,extrapolationValue:c}=r,l=new FT(s.shape,o.shape,a,u,c);return n.runWebGLProgram(l,[s,o,i],"float32")}};var PT;!function(t){t.Prod="*",t.Sum="+"}(PT||(PT={}));class BT{constructor(t,e,n,r){this.op=t,this.outputShape=e,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const s=this.outputShape.length,o=this.op===PT.Prod?"1.0":"0.0",i=n?o:`getX(${VT(s,"coords",this.op)})`,a=this.outputShape[this.outputShape.length-1];let u="",c="";n?(u=r?"end != "+(a-1):"end != 0",c=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${a}`:"end >= pow2",c=r?"end + pow2":"end - pow2"),this.userCode=`\n      void main() {\n        ${E$(s)} coords = getOutputCoords();\n        int end = ${zT(s,"coords",this.op)};\n        float val = ${i};\n        int pow2 = int(pow(2.0, index));\n        if (${u}) {\n          int idx = ${c};\n          ${zT(s,"coords",this.op)} = idx;\n          val ${this.op}= getX(${VT(s,"coords",this.op)});\n        }\n        setOutput(val);\n      }\n    `}}function VT(t,e,n){if(1===t)return`${e}`;if(2===t)return`${e}.x, ${e}.y`;if(3===t)return`${e}.x, ${e}.y, ${e}.z`;if(4===t)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function zT(t,e,n){if(1===t)return`${e}`;if(2===t)return`${e}.y`;if(3===t)return`${e}.z`;if(4===t)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WT(t,e,n,r,s,o){const i=e.shape.length,a=Vw([r],i);let u=e;null!=a&&(u=o_({inputs:{x:e},backend:n,attrs:{perm:a}}));const c=Ww(1,i)[0];if(c!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${r}`);const l=u.shape[c];let f=AS({inputs:{x:u},backend:n});for(let e=0;e<=Math.ceil(Math.log2(l))-1;e++){const r=new BT(t,u.shape,!1,o),s=[[e]],i=f;f=n.runWebGLProgram(r,[f],f.dtype,s),n.disposeIntermediateTensorInfo(i)}if(s){const e=new BT(t,u.shape,s,o),r=f;f=n.runWebGLProgram(e,[f],f.dtype),n.disposeIntermediateTensorInfo(r)}if(null!=a){const t=o_({inputs:{x:f},backend:n,attrs:{perm:zw(a)}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(u),t}return f}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UT={kernelName:"Cumprod",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:o,exclusive:i,reverse:a}=r;return WT(PT.Prod,s,n,o,i,a)}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jT={kernelName:"Cumsum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:o,exclusive:i,reverse:a}=r;return WT(PT.Sum,s,n,o,i,a)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GT={kernelName:"DenseBincount",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,weights:o}=e,{size:i,binaryOutput:a}=r;if(1===s.shape.length){const t=n.readSync(s.dataId),e=n.readSync(o.dataId),r=$E(t,e,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,r)}if(2===s.shape.length){const t=n.bufferSync(s),e=n.bufferSync(o),r=EE(t,e,i,a);return n.makeTensorInfo(r.shape,o.dtype,r.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qT{constructor(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode=`\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ${this.getHeightCoordString()};\n      int w = ${this.getWidthCoordString()};\n      int d = ${this.getDepthCoordString()};\n\n      int in_h = h / ${e};\n      int offset_h = imod(h, ${e});\n      int in_w = w / ${e};\n      int offset_w = imod(w, ${e});\n      int offset_d = (offset_h * ${e} + offset_w) *\n        ${this.getOutputDepthSize()};\n      int in_d = d + offset_d;\n\n      float result = ${this.getInputSamplingString()};\n      setOutput(result);\n    }\n  `}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HT={kernelName:"DepthToSpace",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{blockSize:o,dataFormat:i}=r,a=s.shape[0],u=("NHWC"===i?s.shape[1]:s.shape[2])*o,c=("NHWC"===i?s.shape[2]:s.shape[3])*o,l=("NHWC"===i?s.shape[3]:s.shape[1])/(o*o),f=new qT("NHWC"===i?[a,u,c,l]:[a,l,u,c],o,i);return n.runWebGLProgram(f,[s],s.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KT{constructor(t,e=!1,n=null,r=!1,s=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=O$(this.outputShape.length);const o=t.filterHeight,i=t.filterWidth,a=t.outChannels/t.inChannels;let u="",c="";n&&(u=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:s?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,c="result = activation(result);");const l=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${u}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${a};\n        int q = d2 - d1 * ${a};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${o}; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${i}; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${l}\n        ${c}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XT{constructor(t,e=!1,n=null,r=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=O$(this.outputShape.length);const o=t.outChannels/t.inChannels,i=t.padInfo.left,a=t.strideWidth,u=t.dilationWidth,c=t.filterHeight,l=t.filterWidth,f=l;let h="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let t=0;t<l;t++)h+=`\n          vec4 xTexelC${2*t};\n          int xTexelC${2*t}Ready;\n          vec4 xTexelC${2*t+1};\n          int xTexelC${2*t+1}Ready;\n          vec4 xC${t};`;h+=`\n    for (int r = 0; r < ${c}; r++) {\n      `;for(let t=0;t<l;t++)h+=`\n          xTexelC${2*t} = vec4(0.0);\n          xTexelC${2*t}Ready = 0;\n          xTexelC${2*t+1} = vec4(0.0);\n          xTexelC${2*t+1}Ready = 0;\n          xC${t} = vec4(0.0);`;h+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let t=0;t<(f+1)/2;t++){const e=2*t;if(h+=`\n          xC = xCCorner + ${e*u};\n          `,1===a){if(e<l&&(i%2==1?(h+=`\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n              `,h+=1===u&&e>0?`\n                xC${e} = vec4(xTexelC${e-2}.zw, xTexelC${e}.xy);\n                `:`\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC${e} = vec4(previous.zw, xTexelC${e}.xy);\n                  } else {\n                    xC${e} = vec4(0.0, 0.0, xTexelC${e}.xy);\n                  }\n                  `):h+=`\n                if (xC >= 0 && xC < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                xC${e} = xTexelC${e};\n                `,e+1<l)){const t=i%2==0?Wp(u):u;u%2==0&&i%2==1||u%2!=0&&i%2!=1?(h+=`\n                  xCOffset = xC + imod(pads[1], 2) + ${t};\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                    xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC${e+1}.zw = vec2(0.0);\n                    }\n                    xTexelC${e+1}Ready = 1;\n                  }\n                  `,u>1&&(h+=`\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                      xTexelC${e} = getX(batch, xR, xCOffset, d1);\n                      xTexelC${e}Ready = 1;\n                    }\n                    `),h+=`\n                  xC${e+1} = vec4(xTexelC${e}.zw, xTexelC${e+1}.xy);\n                  `):h+=1===t?`\n                    xC${e+1} = xTexelC${e};\n                    `:`\n                    xCOffset = xC + ${t};\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                      xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC${e+1}.zw = vec2(0.0);\n                      }\n                      xTexelC${e+1}Ready = 1;\n                    }\n\n                    xC${e+1} = xTexelC${e+1};\n                    `}}else e<l&&(i%2==1?(h+=`\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${e+1}Ready == 0) {\n                  xTexelC${e+1} = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC${e+1}.zw = vec2(0.0);\n                  }\n                  xTexelC${e+1}Ready = 1;\n                }\n\n                xC${e} = vec4(xTexelC${e}.zw, xTexelC${e+1}.zw);\n              `,e+1<l&&(h+=`\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC${e+1} = vec4(xTexelC${e+1}.xy, final.xy);\n                `)):(h+=`\n                if(xC >= 0 && xC < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                  xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e+1}.zw = vec2(0.);\n                  }\n                  xTexelC${e+1}Ready = 1;\n                }\n\n                xC${e} = vec4(\n                  xTexelC${e}.xy, xTexelC${e+1}.xy);\n              `,e+1<l&&(h+=`\n                  xC${e+1} = vec4(xTexelC${e}.zw, xTexelC${e+1}.zw);\n                `)));e<l&&(h+=`\n            wTexel = getW(r, ${e}, d1, q);\n            dotProd += xC${e} * vec4(wTexel.xz, wTexel.xz);\n          `,e+1<l&&(h+=`\n              wTexel = getW(r, ${e+1}, d1, q);\n              dotProd += xC${e+1} * vec4(wTexel.xz, wTexel.xz);\n            `))}h+="\n    }\n  ",h+="\n      }\n    ";let p="",d="";n&&(p=r?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:s?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,d="result = activation(result);");const m=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${p}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${o};\n        int q = d2 - d1 * ${o};\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ${h}\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ${m}\n        ${d}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JT={kernelName:"DepthwiseConv2dNative",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:o}=e,{strides:i,pad:a,dilations:u,dimRoundingMode:c}=r;let l=u;null==l&&(l=[1,1]),jp(dw(i,l),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`));const f=iw(s.shape,o.shape,i,l,a,c,!0);let h;h=xd().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels==1?new XT(f):new KT(f);const p=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return n.runWebGLProgram(h,[s,o],"float32",p)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YT{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,s=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ${o} + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${e} - ${r};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${s};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class ZT{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,s=t.strideWidth,o=e-1-t.padInfo.top,i=n-1-t.padInfo.left,a=t.outChannels/t.inChannels;this.userCode=`\n      const ivec2 pads = ivec2(${o}, ${i});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${s}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ${a}; dm++) {\n              int d2 = d1 * ${a} + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QT={kernelName:"DepthwiseConv2dNativeBackpropFilter",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,dy:o}=e,{strides:i,dilations:a,pad:u,dimRoundingMode:c,filterShape:l}=r,f=iw(s.shape,l,i,a,u,c,!0),h=new YT(f);return n.runWebGLProgram(h,[s,o],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tk={kernelName:"DepthwiseConv2dNativeBackpropInput",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,filter:o}=e,{strides:i,dilations:a,pad:u,dimRoundingMode:c,inputShape:l}=r,f=iw(l,o.shape,i,a,u,c,!0),h=new ZT(f);return n.runWebGLProgram(h,[s,o],"float32")}};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ek{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nk={kernelName:"Diag",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e,s=[...r.shape,...r.shape],o=Kp(r.shape),i=XS({inputs:{x:r},backend:n,attrs:{shape:[o]}}),a=new ek(o),u=n.runWebGLProgram(a,[i],i.dtype),c=XS({inputs:{x:u},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(u),c}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rk{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:e,inWidth:n,padInfo:r,strideHeight:s,strideWidth:o,filterHeight:i,filterWidth:a,dilationHeight:u,dilationWidth:c}=t,{top:l,left:f}=r;this.userCode=`\n      const ivec2 strides = ivec2(${s}, ${o});\n      const ivec2 pads = ivec2(${l}, ${f});\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ${i}; h++) {\n          int hIn = hBeg + h * ${u};\n\n          if (hIn >= 0 && hIn < ${e}) {\n            for (int w = 0; w < ${a}; w++) {\n              int wIn = wBeg + w * ${c};\n\n              if (wIn >= 0 && wIn < ${n}) {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sk={kernelName:"Dilation2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:o}=e,{strides:i,pad:a,dilations:u}=r,c=rw(s.shape,o.shape,i,a,"NHWC",u);let l;const f=new rk(c);l=n.runWebGLProgram(f,[s,o],"float32");const h=XS({inputs:{x:l},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(l),h}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ok={kernelName:"Einsum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{equation:s}=r,o=e,{allDims:i,summedDims:a,idDims:u}=tN(s,o.length);nN(i.length,u,o);const{path:c,steps:l}=rN(a,u),f=l.length;let h=null,p=i.length;const d=[];for(let t=0;t<f;++t){for(const e of l[t]){const{permutationIndices:t,expandDims:r}=eN(p,u[e]);let s;sN(t)?s=o[e]:(s=o_({inputs:{x:o[e]},backend:n,attrs:{perm:t}}),d.push(s));const i=s.shape.slice();for(let t=0;t<r.length;++t)i.splice(r[t],0,1);Xp(s.shape,i)||(s=XS({inputs:{x:s},backend:n,attrs:{shape:i}}),d.push(s)),null===h?h=s:(h=HS({inputs:{a:s,b:h},backend:n}),d.push(h))}t<f-1&&(c[t]>=0&&(h=r_({inputs:{x:h},backend:n,attrs:{axis:c[t]-(i.length-p),keepDims:!1}}),d.push(h)),p--)}for(const t of d)t!==h&&n.disposeIntermediateTensorInfo(t);return h}},ik={kernelName:"Elu",backendName:"webgl",kernelFunc:BS({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"})},ak={kernelName:"EluGrad",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n}=t,{dy:r,y:s}=e,o=xd().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new kS("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,s.shape):new TS("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,s.shape);return n.runWebGLProgram(o,[r,s],r.dtype)}},uk={kernelName:"Equal",backendName:"webgl",kernelFunc:VS({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:TE})},ck={kernelName:"Erf",backendName:"webgl",kernelFunc:BS({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n'})},lk=BS({opSnippet:"if (isnan(x)) return x;\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:kE,dtype:"float32"}),fk={kernelName:"Exp",backendName:"webgl",kernelFunc:lk};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function hk(t){const{inputs:e,attrs:n,backend:r}=t,{dim:s}=n,{input:o}=e,i=o.shape.length,a=o.shape.slice();let u=s;return s<0&&(jp(-(i+1)<=s,(()=>`Axis must be in the interval [${-(i+1)}, ${i}]`)),u=i+s+1),a.splice(u,0,1),XS({inputs:{x:o},backend:r,attrs:{shape:a}})}const pk={kernelName:"ExpandDims",backendName:"webgl",kernelFunc:hk},dk="return exp(x) - 1.0;",mk={kernelName:"Expm1",backendName:"webgl",kernelFunc:BS({opSnippet:dk,packedOpSnippet:dk,cpuKernelImpl:AE})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class yk{constructor(t,e,n){this.variableNames=["real","imag"];const r=e[1];this.outputShape=e;const s=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=n?`${r}.0`:"1.0";let i;if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);i="return real * expI + imag * expR;"}this.userCode=`\n      const float exponentMultiplier = ${s};\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ${i}\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(${r});\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ${r}; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ${o};\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gk(t,e,n){const r=n.texData.get(t.dataId),s=Kp(t.shape),o=t.shape[t.shape.length-1],i=XS({inputs:{x:t},backend:n,attrs:{shape:[s/o,o]}}),a=i.shape,u=new yk("real",a,e),c=new yk("imag",a,e),l=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:a},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:a}],f=n.runWebGLProgram(u,l,"float32"),h=n.runWebGLProgram(c,l,"float32"),p=OS({inputs:{real:f,imag:h},backend:n});n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h);const d=XS({inputs:{x:p},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(p),d}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bk={kernelName:"FFT",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{input:r}=e;return gk(r,!1,n)}};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wk{constructor(t,e){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vk(t){const{backend:e,attrs:n}=t,{shape:r,value:s}=n;let{dtype:o}=n;if(o=o||ad(s),"string"===o){const t=rd(o,Kp(r));return t.fill(s),e.makeTensorInfo(r,o,t)}{const t=new wk(r,s),n=[[s]];return e.runWebGLProgram(t,[],o,n)}}const xk={kernelName:"Fill",backendName:"webgl",kernelFunc:vk};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nk{constructor(t){this.variableNames=["Image"],this.outputShape=[];const e=t[2];this.outputShape=t,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ${e} - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ${e}) {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $k={kernelName:"FlipLeftRight",backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,r=e,s=new Nk(n.shape);return r.runWebGLProgram(s,[n],n.dtype)}},Ek="return floor(x);",Sk={kernelName:"Floor",backendName:"webgl",kernelFunc:BS({opSnippet:Ek,packedOpSnippet:Ek,cpuKernelImpl:CE})},_k={kernelName:"FloorDiv",backendName:"webgl",kernelFunc:VS({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Tk{constructor(t){this.variableNames=["A"];const e=a$(),[n,r]=t;this.outputShape=t,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${n}.0);\n\n        vec4 values = ${e.texture2D}(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kk{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const e=a$(),[n,r]=t;this.outputShape=t,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(${r}.0, ${n}.0);\n            vec4 values = ${e.texture2D}(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ${e.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ak={kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t;let{pixels:s}=e;const{numChannels:o}=r,i="undefined"!=typeof HTMLVideoElement&&s instanceof HTMLVideoElement,a="undefined"!=typeof HTMLImageElement&&s instanceof HTMLImageElement,[u,c]=i?[s.videoWidth,s.videoHeight]:[s.width,s.height],l=[c,u],f=[c,u,o];(a||i)&&(null==Ck&&(Ck=document.createElement("canvas").getContext("2d")),Ck.canvas.width=u,Ck.canvas.height=c,Ck.drawImage(s,0,0,u,c),s=Ck.canvas);const h=n.makeTensorInfo(l,"int32");n.texData.get(h.dataId).usage=CN.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),s);const p=xd().getBool("WEBGL_PACK")?new kk(f):new Tk(f),d=n.runWebGLProgram(p,[h],"int32");return n.disposeData(h.dataId),d}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */};let Ck;const Ok={kernelName:"FusedConv2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:o,bias:i,preluActivationWeights:a}=e,{strides:u,pad:c,dataFormat:l,dilations:f,dimRoundingMode:h,activation:p,leakyreluAlpha:d}=r,m=mw(l),y=iw(s.shape,o.shape,u,f,c,h,!1,m);let g;const b=[];if(1!==y.filterHeight||1!==y.filterWidth||1!==y.dilationHeight||1!==y.dilationWidth||1!==y.strideHeight||1!==y.strideWidth||"SAME"!==y.padInfo.type&&"VALID"!==y.padInfo.type)if(xd().getBool("WEBGL_CONV_IM2COL")&&1===s.shape[0])g=$T({x:s,filter:o,convInfo:y,backend:n,bias:i,activation:p,preluActivationWeights:a,leakyreluAlpha:d});else{const t=null!=i,e=null!=a,r="leakyrelu"===p,u=p?zS(p,!1):null,c=new wT(y,t,u,e,r),f=[s,o],h=(t,e)=>{if("NCHW"===e&&1===t.shape.length&&1!==t.shape[0]){const e=XS({inputs:{x:t},backend:n,attrs:{shape:[t.shape[0],1,1]}});return b.push(e),e}return t};if(t&&f.push(h(i,l)),e&&f.push(h(a,l)),r){const t=n.makeTensorInfo([],"float32",Gm(d,"float32"));f.push(t),b.push(t)}g=n.runWebGLProgram(c,f,"float32")}else g=NT({x:s,filter:o,convInfo:y,backend:n,bias:i,activation:p,preluActivationWeights:a,leakyreluAlpha:d});const w=XS({inputs:{x:g},backend:n,attrs:{shape:y.outShape}});return b.push(g),b.forEach((t=>n.disposeIntermediateTensorInfo(t))),w}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ik={kernelName:"FusedDepthwiseConv2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:o,bias:i,preluActivationWeights:a}=e,{strides:u,pad:c,dilations:l,dimRoundingMode:f,activation:h,leakyreluAlpha:p}=r,d=[];let m=l;null==m&&(m=[1,1]),jp(dw(u,m),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${m}'`));const y=iw(s.shape,o.shape,u,m,c,f,!0),g=xd().getBool("WEBGL_PACK_DEPTHWISECONV")&&y.strideWidth<=2&&y.outChannels/y.inChannels==1,b=h?zS(h,g):null,w=[s,o],v=null!=i,x=null!=a,N="leakyrelu"===h;if(v&&w.push(i),x&&w.push(a),N){const t=n.makeTensorInfo([],"float32",Gm(p,"float32"));w.push(t),d.push(t)}let $;$=g?new XT(y,v,b,x,N):new KT(y,v,b,x,N);const E=[[y.padInfo.top,y.padInfo.left],[y.strideHeight,y.strideWidth],[y.dilationHeight,y.dilationWidth],[y.inHeight,y.inWidth]],S=n.runWebGLProgram($,w,"float32",E);return d.forEach((t=>n.disposeIntermediateTensorInfo(t))),S}};class Mk{constructor(t,e,n){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=n;const r=E$(e.length),s=E$(n.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`\n        ${r} strides = ${r}(${this.strides});\n         void main() {\n          ${s} coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ${this.sliceDim}; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ${o};\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rk={kernelName:"GatherNd",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{params:r,indices:s}=e,o=s.shape,i=o[o.length-1],a=Kp(r.shape),[u,c,l,f]=Cb(r,s),h=XS({inputs:{x:s},backend:n,attrs:{shape:[c,i]}}),p=XS({inputs:{x:r},backend:n,attrs:{shape:[Kp(r.shape)/l,l]}});if(n.shouldExecuteOnCPU([r,s])||"string"===r.dtype){const t=n.readSync(s.dataId),e=n.bufferSync(r),o=OE(t,e,r.dtype,c,i,l,f,r.shape,a);return n.makeTensorInfo(u,r.dtype,o.values)}const d=new Mk(i,f,[c,l]),m=n.runWebGLProgram(d,[p,h],p.dtype),y=XS({inputs:{x:m},backend:n,attrs:{shape:u}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),y}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dk{constructor(t,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;const n=E$(this.rank),r=function(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let e=0;e<t.length;e++)2===e?r.push("index"):r.push(`${n[e]}`);return r.join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t);this.userCode=`\n      void main() {\n        ${n} resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;\n        setOutput(inBounds * getA(${r}));\n      }\n    `}}function Fk(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,indices:o}=e,{axis:i,batchDims:a}=r,u=td(i,s.shape)[0];if(xd().get("DEBUG")){const t=n.readSync(o.dataId),e=s.shape[u];for(let n=0;n<t.length;++n){const r=t[n];jp(r<=e-1&&r>=0,(()=>`GatherV2: the index value ${r} is not in [0, ${e-1}]`))}}const c=xN(s,o,u,a),l=Kp(o.shape),f=[],h=XS({inputs:{x:s},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),p=XS({inputs:{x:o},backend:n,attrs:{shape:[c.batchSize,l/c.batchSize]}});f.push(h),f.push(p);const d=[c.batchSize,c.outerSize,l/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([s,o])||"string"===s.dtype){const t=n.bufferSync(p),e=n.bufferSync(h),r=IE(e,t,d);return f.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(c.outputShape,r.dtype,r.values)}const m=new Dk(h.shape,d),y=n.runWebGLProgram(m,[h,p],h.dtype);f.push(y);const g=XS({inputs:{x:y},backend:n,attrs:{shape:c.outputShape}});return f.forEach((t=>n.disposeIntermediateTensorInfo(t))),g}const Lk={kernelName:"GatherV2",backendName:"webgl",kernelFunc:Fk},Pk={kernelName:"Greater",backendName:"webgl",kernelFunc:VS({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:ME,dtype:"bool"})},Bk={kernelName:"GreaterEqual",backendName:"webgl",kernelFunc:VS({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:RE})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vk={kernelName:"IFFT",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n}=t,{input:r}=e;return gk(r,!0,n)}},zk={kernelName:"IsFinite",backendName:"webgl",kernelFunc:BS({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"})},Wk={kernelName:"IsInf",backendName:"webgl",kernelFunc:BS({opSnippet:"return float(isinf(x));",dtype:"bool"})},Uk={kernelName:"IsNan",backendName:"webgl",kernelFunc:BS({opSnippet:"return float(isnan(x));",dtype:"bool"})},jk={kernelName:"Less",backendName:"webgl",kernelFunc:VS({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:DE,dtype:"bool"})},Gk={kernelName:"LessEqual",backendName:"webgl",kernelFunc:VS({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:FE,dtype:"bool"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qk={kernelName:"LinSpace",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{backend:e,attrs:n}=t,{start:r,stop:s,num:o}=n,i=LE(r,s,o);return e.makeTensorInfo([i.length],"float32",i)}},Hk={kernelName:"Log",backendName:"webgl",kernelFunc:BS({opSnippet:"if (isnan(x)) return x;\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:PE})},Kk={kernelName:"Log1p",backendName:"webgl",kernelFunc:BS({opSnippet:"if (isnan(x)) return x;\n  return log(1.0 + x);\n"})},Xk={kernelName:"LogicalAnd",backendName:"webgl",kernelFunc:VS({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"})},Jk={kernelName:"LogicalNot",backendName:"webgl",kernelFunc:BS({opSnippet:"return float(!(x >= 1.0));"})},Yk={kernelName:"LogicalOr",backendName:"webgl",kernelFunc:VS({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Zk{constructor(t,e,n,r,s){this.variableNames=["x"],this.outputShape=[];const o=e,i=t[3]-1;let a;this.outputShape=t;const u=`float(${n}) + float(${r}) * sum`;a=.5===s?`inversesqrt(${u})`:1===s?`1.0/(${u})`:`exp(log(${u}) * float(-${s}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -${o}; j <= ${o}; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ${i}) {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ${a};\n        setOutput(val);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qk{constructor(t,e,n,r,s){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=e,i=t[3]-1;let a;this.outputShape=t;const u=`float(${n}) + float(${r}) * sum`;a=.5===s?`inversesqrt(${u})`:1===s?`1.0/(${u})`:`exp(log(${u}) * float(-${s}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ${this.outputShape[3]};\n        bool hasNextRow = c < ${this.outputShape[2]};\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ${o};\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ${o}; j <= ${o}; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${i}));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ${a};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tA={kernelName:"LRN",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{depthRadius:o,bias:i,alpha:a,beta:u}=r,c=xd().getBool("WEBGL_PACK_NORMALIZATION")?new Qk(s.shape,o,i,a,u):new Zk(s.shape,o,i,a,u);return n.runWebGLProgram(c,[s],s.dtype)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class eA{constructor(t,e,n,r,s){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=s,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ${this.depth}; ++d) {\n          int depthBegin = int(max(0.0, float(d - ${e})));\n          int depthEnd = int(min(float(${this.depth}),\n              float(d + ${e} + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ${this.depth};\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(${r}) * norm + float(${n});\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(${r})\n                * float(${s})\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ${s});\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nA={kernelName:"LRNGrad",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:s,y:o,dy:i}=e,{depthRadius:a,bias:u,alpha:c,beta:l}=r,f=new eA(s.shape,a,u,c,l);return n.runWebGLProgram(f,[s,o,i],s.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function rA(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{reductionIndices:o,keepDims:i}=r,a=s.shape.length,u=td(o,s.shape);let c=u;const l=Vw(c,a),f=null!=l,h=n.shouldExecuteOnCPU([s]);let p=s;if(f){if(h){const t=n.texData.get(p.dataId).values,e=new Array(a);for(let t=0;t<e.length;t++)e[t]=s.shape[l[t]];const r=cS(t,s.shape,s.dtype,l,e);p=n.makeTensorInfo(e,s.dtype);n.texData.get(p.dataId).values=r}else p=n_(s,l,n);c=Ww(c.length,a)}Bw("max",c,a);const[d,m]=Lw(p.shape,c);let y,g=d;if(i&&(g=Pw(d,u)),h){const t=n.texData.get(p.dataId).values,e=BE(t,Kp(m),g,s.dtype);y=n.makeTensorInfo(g,s.dtype);n.texData.get(y.dataId).values=e}else y=
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const s=Kp(e),o=XS({inputs:{x:t},attrs:{shape:[Kp(t.shape)/s,s]},backend:r}),i=QS(o,t.dtype,"max",r),a=XS({inputs:{x:i},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(i),a}(p,m,g,n);return f&&n.disposeIntermediateTensorInfo(p),y}const sA={kernelName:"Max",backendName:"webgl",kernelFunc:rA},oA={kernelName:"Maximum",backendName:"webgl",kernelFunc:VS({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:VE})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iA={kernelName:"MaxPool",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e;o$(s,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:u}=r;jp(dw(i,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '1'`));const c=sw(s.shape,o,i,1,a,u);if(1===c.filterWidth&&1===c.filterHeight&&Xp(c.inShape,c.outShape))return AS({inputs:{x:s},backend:n});const l=new I_(c,"max",!1);return n.runWebGLProgram(l,[s],s.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aA={kernelName:"MaxPool3D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{filterSize:o,strides:i,pad:a,dataFormat:u,dimRoundingMode:c}=r,l=ow(s.shape,o,i,[1,1,1],a,c,u),f=new M_(l,"max",!1);return n.runWebGLProgram(f,[s],s.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uA{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideHeight,n=t.strideWidth,r=t.dilationHeight,s=t.effectiveFilterHeight,o=t.effectiveFilterWidth,i=s-1-t.padInfo.top,a=o-1-t.padInfo.left,u=s*o-1;this.userCode=`\n      const ivec2 pads = ivec2(${i}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${s};\n          wR += ${r}) {\n          float dyR = float(dyRCorner + wR) / ${e}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${o}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${n}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ${o} + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class cA{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,s=t.dilationDepth,o=t.dilationHeight,i=t.dilationWidth,a=t.effectiveFilterDepth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=a-1-t.padInfo.front,f=u-1-t.padInfo.top,h=c-1-t.padInfo.left,p=a*u*c-1;this.userCode=`\n      const ivec3 pads = ivec3(${l}, ${f}, ${h});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${a};\n           wD += ${s}) {\n          float dyD = float(dyDCorner + wD) / ${e}.0;\n\n          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${u};\n              wR += ${o}) {\n            float dyR = float(dyRCorner + wR) / ${n}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${c};\n                wC += ${i}) {\n              float dyC = float(dyCCorner + wC) / ${r}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ${p} -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ${u} * ${c} +\n                  wR * ${c} + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lA={kernelName:"MaxPool3DGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,input:o}=e,i=o,{filterSize:a,strides:u,pad:c,dimRoundingMode:l}=r,f=ow(i.shape,a,u,[1,1,1],c,l),h=new M_(f,"max",!0),p=n.runWebGLProgram(h,[i],i.dtype),d=new cA(f),m=n.runWebGLProgram(d,[s,p],i.dtype);return n.disposeIntermediateTensorInfo(p),m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fA={kernelName:"MaxPoolGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,input:o,output:i}=e,a=o;o$([o,i],"maxPoolGrad");const{filterSize:u,strides:c,pad:l,dimRoundingMode:f}=r,h=sw(a.shape,u,c,1,l,f),p=new I_(h,"max",!0),d=n.runWebGLProgram(p,[a],a.dtype),m=new uA(h),y=n.runWebGLProgram(m,[s,d],a.dtype);return n.disposeIntermediateTensorInfo(d),y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const hA={kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{filterSize:s,strides:o,pad:i,includeBatchInIndex:a}=e,u=n;jp(4===r.shape.length,(()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`));const c=[1,1];jp(dw(o,c),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`));const l=sw(r.shape,s,o,c,i),[f,h]=function(t,e,n,r){let s=new I_(n,"max",!1);const o=r.runWebGLProgram(s,[t],"float32");return s=new I_(n,"max",!0,!0,e),[o,r.runWebGLProgram(s,[t],"float32")]}(r,a,l,u);return[f,h]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const pA={kernelName:"Mean",backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{keepDims:s,axis:o}=e,i=n,a=r.shape.length,u=td(o,r.shape);let c=u;const l=Vw(c,a),f=null!=l,h=i.shouldExecuteOnCPU([r]),p=[];let d=r;if(f){if(h){const t=i.texData.get(d.dataId).values,e=new Array(a);for(let t=0;t<e.length;t++)e[t]=r.shape[l[t]];const n=cS(t,r.shape,r.dtype,l,e);d=i.makeTensorInfo(e,r.dtype);i.texData.get(d.dataId).values=n}else d=n_(r,l,i);p.push(d),c=Ww(c.length,a)}Bw("sum",c,a);const[m,y]=Lw(d.shape,c);let g=m;s&&(g=Pw(m,u));const b=function(t,e,n,r){const s=Kp(e),o=XS({inputs:{x:t},attrs:{shape:[Kp(t.shape)/s,s]},backend:r}),i=QS(o,"float32","mean",r),a=XS({inputs:{x:i},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(i),a}(d,y,g,i);for(const t of p)i.disposeIntermediateTensorInfo(t);return b}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dA={kernelName:"Min",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:o,keepDims:i}=r,a=s.shape.length,u=td(o,s.shape);let c=u;const l=Vw(c,a);let f=s;null!=l&&(f=o_({inputs:{x:s},backend:n,attrs:{perm:l}}),c=Ww(c.length,s.shape.length)),Bw("min",c,a);const[h,p]=Lw(f.shape,c),d=XS({inputs:{x:f},backend:n,attrs:{shape:[-1,Kp(p)]}}),m=QS(d,d.dtype,"min",n);let y;if(i){y=XS({inputs:{x:m},backend:n,attrs:{shape:Pw(h,u)}})}else y=XS({inputs:{x:m},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),null!=l&&n.disposeIntermediateTensorInfo(f),y}},mA={kernelName:"Minimum",backendName:"webgl",kernelFunc:VS({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:zE})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class yA{constructor(t,e,n){this.variableNames=["x"],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,s=E$(r),o=e.map((t=>t[0])).join(","),i=e.map(((e,n)=>e[0]+t[n])).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u="reflect"===n?0:1;this.userCode=1!==r?`\n      ${s} start = ${s}(${o});\n      ${s} end = ${s}(${i});\n\n      void main() {\n        ${s} outC = getOutputCoords();\n        for (int i = 0; i < ${r}; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ${u};\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};\n          }\n        }\n        ${s} coords = outC - start;\n        setOutput(getX(${a}));\n      }\n    `:`\n        int start = ${o};\n        int end = ${i};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ${u};\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ${u};\n          }\n          setOutput(getX(outC - start));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gA{constructor(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,s=E$(r),o=e.map((t=>t[0])).join(","),i=e.map(((e,n)=>e[0]+t[n])).join(","),a=hS("rc",r),u=hS("source",r),c=`${a[r-1]} < ${this.outputShape[r-1]}`,l=1===r?"source":`vec2(${u.slice(-2).join()})`,f="reflect"===n?0:1;let h="";if(1===r){const t=`\n        ${s} source = rc;\n        if (source < start) {\n          source = start * 2 - source - ${f};\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ${f};\n        }\n        source -= start;\n      `;h=`\n        ${s} rc = outputLoc;\n        ${t}\n        result[0] = getChannel(getX(${u.join()}), ${l});\n        ${a[r-1]} += 1;\n        if(${c}) {\n          ${t}\n          result[1] = getChannel(getX(${u.join()}), ${l});\n        }\n      `}else{const t=`\n        ${s} source = rc;\n        ${s} lt = ${s}(lessThan(source, start));\n        ${s} gte = ${s}(greaterThanEqual(source, end));\n        ${s} orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ${f}) +\n                gte * ((end - 1) * 2 - source + ${f});\n        source -= start;\n      `;h=`\n        ${s} rc = outputLoc;\n        ${t}\n        result[0] = getChannel(getX(${u.join()}), ${l});\n        ${a[r-1]} += 1;\n        if(${c}) {\n          ${t}\n          result[1] = getChannel(getX(${u.join()}), ${l});\n        }\n        rc = outputLoc;\n        ${a[r-2]} += 1;\n        if(${a[r-2]} < ${this.outputShape[r-2]}) {\n          ${t}\n          result[2] = getChannel(getX(${u.join()}), ${l});\n          ${a[r-1]} += 1;\n          if(${c}) {\n            ${t}\n            result[3] = getChannel(getX(${u.join()}), ${l});\n          }\n        }\n      `}this.userCode=`\n      const ${s} start = ${s}(${o});\n      const ${s} end = ${s}(${i});\n\n      void main() {\n        ${s} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${h}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bA={kernelName:"MirrorPad",backendName:"webgl",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r}=t,{paddings:s,mode:o}=n,i=xd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new gA(r.shape,s,o):new yA(r.shape,s,o);return e.runWebGLProgram(i,[r],r.dtype)}},wA={kernelName:"Mod",backendName:"webgl",kernelFunc:VS({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"})};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class vA{constructor(t,e,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,n],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ${e-1}; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(${e-1}));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xA=VS({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),NA={kernelName:"RealDiv",backendName:"webgl",kernelFunc:xA},$A="return a - b;",EA=VS({opSnippet:$A,packedOpSnippet:$A,supportsComplex:!0,cpuKernelImpl:iS}),SA={kernelName:"Sub",backendName:"webgl",kernelFunc:EA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function _A(t){const{inputs:e,backend:n,attrs:r}=t,{logits:s}=e,{dim:o}=r,i=td([o],s.shape),a=rA({inputs:{x:s},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),u=Pw(a.shape,i),c=XS({inputs:{x:a},backend:n,attrs:{shape:u}}),l=EA({inputs:{a:s,b:c},backend:n}),f=lk({inputs:{x:l},backend:n}),h=r_({inputs:{x:f},backend:n,attrs:{axis:i,keepDims:!1}}),p=XS({inputs:{x:h},backend:n,attrs:{shape:u}}),d=xA({inputs:{a:f,b:p},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),d}const TA={kernelName:"Softmax",backendName:"webgl",kernelFunc:_A};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kA={kernelName:"Multinomial",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{logits:s}=e,{numSamples:o,seed:i,normalized:a}=r,u=a?s:_A({inputs:{logits:s},backend:n,attrs:{dim:s.shape.length-1}}),c=u.shape[0],l=u.shape[1],f=new vA(c,l,o),h=[[i]],p=n.runWebGLProgram(f,[u],"int32",h);return a||n.disposeIntermediateTensorInfo(u),p}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AA={kernelName:"Neg",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e;if(n.shouldExecuteOnCPU([r])){const t=n.texData.get(r.dataId),[e,s]=UE(t.values,r.shape,r.dtype);return n.makeTensorInfo(s,r.dtype,e)}let s;return s=xd().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new xS(r.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new wS(r.shape,"if (isnan(x)) return x;\n  return -x;\n"),n.runWebGLProgram(s,[r],r.dtype)}},CA=function(t,e,n,r,s){return Tx(t,e,n,r,s,0)};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OA={kernelName:"NonMaxSuppressionV3",backendName:"webgl",kernelFunc:function(t){Zd("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:s,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:u}=r,c=n.readSync(s.dataId),l=n.readSync(o.dataId),{selectedIndices:f}=CA(c,l,i,a,u);return n.makeTensorInfo([f.length],"int32",new Int32Array(f))}},IA=function(t,e,n,r,s,o){return Tx(t,e,n,r,s,0,!1,o,!0)};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MA={kernelName:"NonMaxSuppressionV4",backendName:"webgl",kernelFunc:function(t){Zd("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:s,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:u,padToMaxOutputSize:c}=r,l=n.readSync(s.dataId),f=n.readSync(o.dataId),{selectedIndices:h,validOutputs:p}=IA(l,f,i,a,u,c);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},RA=function(t,e,n,r,s,o){return Tx(t,e,n,r,s,o,!0)};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DA={kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(t){Zd("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:s,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:u,softNmsSigma:c}=r,l=n.readSync(s.dataId),f=n.readSync(o.dataId),h=i,p=a,d=u,m=c,{selectedIndices:y,selectedScores:g}=RA(l,f,h,p,d,m);return[n.makeTensorInfo([y.length],"int32",new Int32Array(y)),n.makeTensorInfo([g.length],"float32",new Float32Array(g))]}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FA{constructor(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(${r}), float(${n}),\n                      float(index == coords.y)));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LA={kernelName:"OneHot",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{indices:s}=e,{depth:o,onValue:i,offValue:a}=r,u=Kp(s.shape),c=new FA(u,o,i,a),l=XS({inputs:{x:s},backend:n,attrs:{shape:[u]}}),f=n.runWebGLProgram(c,[l],s.dtype);n.disposeIntermediateTensorInfo(l);const h=XS({inputs:{x:f},backend:n,attrs:{shape:[...s.shape,o]}});return n.disposeIntermediateTensorInfo(f),h}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function PA(t){const{inputs:e,backend:n}=t,{x:r}=e;if("complex64"===r.dtype){const t=tT({inputs:{input:r},backend:n}),e=PA({inputs:{x:t},backend:n}),s=dT({inputs:{input:r},backend:n}),o=PA({inputs:{x:s},backend:n}),i=OS({inputs:{real:e,imag:o},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),i}return vk({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}const BA={kernelName:"ZerosLike",backendName:"webgl",kernelFunc:PA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VA={kernelName:"OnesLike",backendName:"webgl",kernelFunc:function t(e){const{inputs:n,backend:r}=e,{x:s}=n;if("string"===s.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===s.dtype){const e=tT({inputs:{input:s},backend:r}),n=t({inputs:{x:e},backend:r}),o=dT({inputs:{input:s},backend:r}),i=PA({inputs:{x:o},backend:r}),a=OS({inputs:{real:n,imag:i},backend:r});return r.disposeIntermediateTensorInfo(e),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(i),a}return vk({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:r})}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zA={kernelName:"Pack",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{axis:s}=r;if(1===e.length)return hk({inputs:{input:e[0]},backend:n,attrs:{dim:s}});const o=e[0].shape,i=e[0].dtype;e.forEach((t=>{Gp(o,t.shape,"All tensors passed to stack must have matching shapes"),jp(i===t.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const a=[],u=e.map((t=>{const e=hk({inputs:{input:t},backend:n,attrs:{dim:s}});return a.push(e),e})),c=gT({inputs:u,backend:n,attrs:{axis:s}});return a.forEach((t=>n.disposeIntermediateTensorInfo(t))),c}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WA{constructor(t,e,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,s=E$(r),o=e.map((t=>t[0])).join(","),i=e.map(((e,n)=>e[0]+t[n])).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?`\n      ${s} start = ${s}(${o});\n      ${s} end = ${s}(${i});\n\n      void main() {\n        ${s} outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ${s} coords = outC - start;\n          setOutput(getX(${a}));\n        }\n      }\n    `:`\n        int start = ${o};\n        int end = ${i};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UA{constructor(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,s=E$(r),o=e.map((t=>t[0])).join(","),i=e.map(((e,n)=>e[0]+t[n])).join(","),a=hS("rc",r),u=hS("source",r),c=`${a[r-1]} < ${this.outputShape[r-1]}`,l=1===r?"source":`vec2(${u.slice(-2).join()})`,f=[`${s} rc = outputLoc;`,`${a[r-1]} += 1;\n       if(${c}) {\n      `,1===r?"":`}\n       rc = outputLoc;\n       ${a[r-2]} += 1;\n       if(${a[r-2]} < ${this.outputShape[r-2]}) {`,1===r?"":`  ${a[r-1]} += 1;\n         if(${c}) {`],h=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let t=0,e=1===r?2:4;t<e;t++)p+=`\n        ${f[t]}\n        if (${h}) {\n          result[${t}] = float(value);\n        } else {\n          ${s} source = rc - start;\n          result[${t}] = getChannel(getX(${u.join()}), ${l});\n        }\n      `;p+=1===r?"} ":"}}",this.userCode=`\n      const ${s} start = ${s}(${o});\n      const ${s} end = ${s}(${i});\n\n      void main() {\n        ${s} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${p}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jA=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{paddings:o,constantValue:i}=r;if(0===Kp(s.shape)){const t=o.map(((t,e)=>t[0]+s.shape[e]+t[1]));return vk({backend:n,attrs:{shape:t,value:i,dtype:s.dtype}})}const a=xd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new UA(s.shape,o,i):new WA(s.shape,o,i),u=[[i]];return n.runWebGLProgram(a,[s],s.dtype,u)},GA={kernelName:"PadV2",backendName:"webgl",kernelFunc:jA},qA={kernelName:"Pow",backendName:"webgl",kernelFunc:VS({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"})};const HA={kernelName:"Prod",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:o,keepDims:i}=r,a=s.shape.length,u=[],c=td(o,s.shape);let l=c;const f=Vw(l,a);let h,p=s;if(null!=f&&(p=o_({inputs:{x:s},backend:n,attrs:{perm:f}}),l=Ww(l.length,a),u.push(p)),Bw("prod",l,a),n.shouldExecuteOnCPU([p])){const t=n.texData.get(p.dataId).values,{outVals:e,outShape:r,outDtype:s}=GE(p.shape,p.dtype,t,l);h=n.makeTensorInfo(r,s,e)}else{const[t,e]=Lw(p.shape,l),r=Kp(e),o=XS({inputs:{x:p},backend:n,attrs:{shape:[-1,r]}}),i=QS(o,yy(s.dtype),"prod",n);h=XS({inputs:{x:i},backend:n,attrs:{shape:t}}),u.push(o),u.push(i)}if(i){u.push(h);const t=Pw(h.shape,c);h=XS({inputs:{x:h},backend:n,attrs:{shape:t}})}return u.forEach((t=>n.disposeIntermediateTensorInfo(t))),h}},KA=t=>{const{backend:e,attrs:n}=t,{start:r,stop:s,step:o,dtype:i}=n,a=qE(r,s,o,i);return e.makeTensorInfo([a.length],i,a)},XA={kernelName:"Range",backendName:"webgl",kernelFunc:KA},JA={kernelName:"Reciprocal",backendName:"webgl",kernelFunc:BS({opSnippet:"return 1.0 / x;"})},YA={kernelName:"Relu",backendName:"webgl",kernelFunc:BS({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"})},ZA={kernelName:"Relu6",backendName:"webgl",kernelFunc:BS({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class QA{constructor(t,e,n,r,s){this.variableNames=["A"],this.outputShape=[];const[o,i,a,u]=t;this.outputShape=[o,e,n,u];const c=[r&&e>1?i-1:i,r&&n>1?a-1:a],l=[r&&e>1?e-1:e,r&&n>1?n-1:n];let f;f=s?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${c[0]/l[0]},\n          ${c[1]/l[1]});\n      const vec2 inputShapeRC = vec2(${i}.0, ${a}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${f};\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tC{constructor(t,e,n,r,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,i,a,u]=t;this.outputShape=[o,e,n,u];const c=[r&&e>1?i-1:i,r&&n>1?a-1:a],l=[r&&e>1?e-1:e,r&&n>1?n-1:n];let f;f=s?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${c[0]/l[0]},\n          ${c[1]/l[1]},\n          ${c[1]/l[1]});\n      const vec3 inputShapeRC = vec3(${i}.0, ${a}.0,\n                                     ${a}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${f};\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${u-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eC={kernelName:"ResizeBilinear",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:s}=e,{alignCorners:o,halfPixelCenters:i,size:a}=r,[u,c]=a,l=xd().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new tC(s.shape,u,c,o,i):new QA(s.shape,u,c,o,i);return n.runWebGLProgram(l,[s],"float32")}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nC{constructor(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,r,s]=e,[,o,i]=t,a=[n&&o>1?r-1:r,n&&i>1?s-1:s],u=[n&&o>1?o-1:o,n&&i>1?i-1:i],c=a[0]/u[0],l=a[1]/u[1],f=1/c,h=1/l,p=2*Math.ceil(f)+2,d=2*Math.ceil(h)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${c});\n        const float widthScale = float(${l});\n\n        const float invHeightScale = float(${f});\n        const float invWidthScale = float(${h});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${d});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${o}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${i}) {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ${s-1}.0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rC={kernelName:"ResizeBilinearGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:s,dy:o}=e,{alignCorners:i}=r,a=new nC(o.shape,s.shape,i);return n.runWebGLProgram(a,[o],o.dtype)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sC{constructor(t,e,n,r,s){this.variableNames=["A"],this.outputShape=[];const[o,i,a,u]=t;this.outputShape=[o,e,n,u];const c=[r&&e>1?i-1:i,r&&n>1?a-1:a],l=[r&&e>1?e-1:e,r&&n>1?n-1:n],f=r?"0.5":"0.0";let h;h=s?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${c[0]/l[0]},\n          ${c[1]/l[1]});\n      const vec2 inputShapeRC = vec2(${i}.0, ${a}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${h};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oC{constructor(t,e,n,r,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,i,a,u]=t;this.outputShape=[o,e,n,u];const c=[r&&e>1?i-1:i,r&&n>1?a-1:a],l=[r&&e>1?e-1:e,r&&n>1?n-1:n],f=r?"0.5":"0.0";let h;h=s?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${c[0]/l[0]},\n          ${c[1]/l[1]},\n          ${c[1]/l[1]});\n      const vec3 inputShapeRC = vec3(${i}.0, ${a}.0,\n                                     ${a}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${h};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${u-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iC={kernelName:"ResizeNearestNeighbor",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:s}=e,{alignCorners:o,halfPixelCenters:i,size:a}=r,[u,c]=a,l=xd().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new oC(s.shape,u,c,o,i):new sC(s.shape,u,c,o,i);return n.runWebGLProgram(l,[s],s.dtype)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aC{constructor(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,r,s]=e,[,o,i]=t,a=[n&&o>1?r-1:r,n&&i>1?s-1:s],u=[n&&o>1?o-1:o,n&&i>1?i-1:i],c=a[0]/u[0],l=a[1]/u[1],f=1/c,h=1/l,p=2*Math.ceil(f)+2,d=2*Math.ceil(h)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${c});\n        const float widthScale = float(${l});\n\n        const float invHeightScale = float(${f});\n        const float invWidthScale = float(${h});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${d});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${o}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${i}) {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(${a[0]}) *\n                (float(dyR) / float(${u[0]}));\n\n            float sourceFracCol =\n                float(${a[1]}) *\n                  (float(dyC) / float(${u[1]}));\n\n            int sourceNearestRow = int(min(\n                float(int(${r}) - 1),\n                ${n} ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(${s}) - 1),\n                ${n} ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uC={kernelName:"ResizeNearestNeighborGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:s,dy:o}=e,{alignCorners:i}=r,a=new aC(o.shape,s.shape,i);return n.runWebGLProgram(a,[o],o.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cC{constructor(t,e){this.variableNames=["x"];const n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=t,1===n)return void(this.userCode=`\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(${t[0]} - coord - 1));\n        }\n      `);const r=t.map(((n,r)=>(n=>-1!==e.indexOf(n)&&1!==t[n]?`${t[n]} - coords[${n}] - 1`:`coords[${n}]`)(r))).join(","),s=E$(n);this.userCode=`\n      void main() {\n        ${s} coords = getOutputCoords();\n        setOutput(getX(${r}));\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lC{constructor(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=t;const r=hS("rc",n),s=`${r[n-1]} + 1 < ${this.outputShape[n-1]}`,o=`${r[n-2]} + 1 < ${this.outputShape[n-2]}`,i=E$(n);function a(n){const r=t.map(((r,s)=>function(n,r){return-1!==e.indexOf(n)&&1!==t[n]?`${t[n]} - ${r[n]} - 1`:`${r[n]}`}(s,n)));return`getChannel(getX(${r.join(",")}), vec2(${r.slice(-2).join(",")}))`}this.userCode=1===n?`\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(${t[0]} - rc - 1),\n            ${t[0]} - rc - 1);\n          if(${s}){\n              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),\n                ${t[0]} - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      `:`\n        void main() {\n          ${i} rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ${function(t){return a(t)}(r.slice())};\n          if(${s}){\n            result.g = ${function(t){return t[n-1]="("+t[n-1]+" + 1)",a(t)}(r.slice())};\n          }\n          if(${o}) {\n            result.b = ${function(t){return t[n-2]="("+t[n-2]+" + 1)",a(t)}(r.slice())};\n            if(${s}) {\n              result.a = ${function(t){return t[n-1]="("+t[n-1]+" + 1)",t[n-2]="("+t[n-2]+" + 1)",a(t)}(r.slice())};\n            }\n          }\n          setOutput(result);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fC={kernelName:"Reverse",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{dims:o}=r,i=s.shape.length,a=td(o,s.shape);if(0===i)return AS({inputs:{x:s},backend:n});const u=xd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new lC(s.shape,a):new cC(s.shape,a);return n.runWebGLProgram(u,[s],s.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hC{constructor(t,e){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const n=t[1],r=t[2];this.outputShape=t;let s="";s="number"==typeof e?`float outputValue = ${e.toFixed(2)};`:`\n        vec3 fill = vec3(${e.join(",")});\n        float outputValue = fill[coords[3]];`,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ${s}\n          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${n}) {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pC={kernelName:"RotateWithOffset",backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,{radians:s,fillValue:o,center:i}=e,a=n,u=new hC(r.shape,o),[c,l]=qx(i,r.shape[1],r.shape[2]),f=[[c,l,Math.sin(s),Math.cos(s)]];return a.runWebGLProgram(u,[r],r.dtype,f)}},dC={kernelName:"Round",backendName:"webgl",kernelFunc:BS({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"})},mC={kernelName:"Rsqrt",backendName:"webgl",kernelFunc:BS({opSnippet:"return inversesqrt(x);",cpuKernelImpl:HE})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class yC{constructor(t,e,n,r,s,o,i=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const a=E$(s.length),u=E$(o.length);let c="";1===n?c="i":2===n&&(c="i, j");const l=`getIndices(${c})`;let f="";1===r?f="i":2===r&&(f="i, coords[1]");const h=`getUpdates(${f})`,p=e>1?"strides[j]":"strides";this.userCode=`\n        ${a} strides = ${a}(${s});\n\n        void main() {\n          ${u} coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ${t}; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ${e}; j++) {\n              int index = round(${l});\n              flattenedIndex += index * ${p};\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ${h};\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gC={kernelName:"ScatterNd",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{indices:s,updates:o}=e,{shape:i}=r,{sliceRank:a,numUpdates:u,sliceSize:c,strides:l,outputSize:f}=Mb(0,s,i),h=[f/c,c];if(0===f)return n.makeTensorInfo(i,s.dtype);const p=XS({inputs:{x:s},backend:n,attrs:{shape:[u,a]}}),d=XS({inputs:{x:o},backend:n,attrs:{shape:[u,c]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0])),y=new yC(u,a,p.shape.length,d.shape.length,l,h),g=n.runWebGLProgram(y,[d,p,m],d.dtype),b=XS({inputs:{x:g},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),b}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bC{constructor(t,e,n,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,n];const s=`for (int i = 0; i < ${Math.ceil(Math.log2(e+1))}; ++i) { if (left >= right) break;`,o=2===xd().getNumber("WEBGL_VERSION")?"while (left < right) {":s,i="left"===r?"<":"<=";this.userCode=`\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ${o}\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ${i} value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     `}}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wC={kernelName:"SearchSorted",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{sortedSequence:s,values:o}=e,{side:i}=r,a=new bC(s.shape[0],s.shape[1],o.shape[1],i),u=[[s.shape[1]]];return n.runWebGLProgram(a,[s,o],"int32",u)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vC{constructor(t,e,n){let r,s;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error(`Where for rank ${n} is not yet supported`);if(1===n)s="resRC",r="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],i=[];for(let r=0;r<e.length;r++)i.push(`${n[r]}`),r<t&&o.push(`${n[r]}`);r=o.join(),s=i.join()}const o=E$(n);this.userCode=`\n      void main() {\n        ${o} resRC = getOutputCoords();\n        float cVal = getC(${r});\n        if (cVal >= 1.0) {\n          setOutput(getA(${s}));\n        } else {\n          setOutput(getB(${s}));\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xC={kernelName:"Select",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{condition:r,t:s,e:o}=e,i=new vC(r.shape.length,s.shape,s.shape.length);return n.runWebGLProgram(i,[r,s,o],my(s.dtype,o.dtype))}},NC={kernelName:"Selu",backendName:"webgl",kernelFunc:BS({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n"})},$C={kernelName:"Sigmoid",backendName:"webgl",kernelFunc:BS({opSnippet:"if (isnan(x)) return x;\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:XE})},EC={kernelName:"Sign",backendName:"webgl",kernelFunc:BS({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"})},SC={kernelName:"Sin",backendName:"webgl",kernelFunc:BS({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n"})},_C={kernelName:"Sinh",backendName:"webgl",kernelFunc:BS({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"})},TC={kernelName:"Softplus",backendName:"webgl",kernelFunc:BS({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"})},kC={kernelName:"SpaceToBatchND",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{blockShape:o,paddings:i}=r;jp(s.shape.length<=4,(()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"));const a=o.reduce(((t,e)=>t*e)),u=[[0,0]];u.push(...i);for(let t=1+o.length;t<s.shape.length;++t)u.push([0,0]);const c=[],l=jA({inputs:{x:s},backend:n,attrs:{paddings:u,constantValue:0}}),f=Hx(l.shape,o,a,!1),h=Kx(f.length,o.length,!1),p=Xx(l.shape,o,a,!1),d=XS({inputs:{x:l},backend:n,attrs:{shape:f}}),m=o_({inputs:{x:d},backend:n,attrs:{perm:h}}),y=XS({inputs:{x:m},backend:n,attrs:{shape:p}});return c.push(l),c.push(d),c.push(m),c.forEach((t=>n.disposeIntermediateTensorInfo(t))),y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AC={kernelName:"SparseFillEmptyRows",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n}=t,{indices:r,values:s,denseShape:o,defaultValue:i}=e;if(1!==o.shape.length)throw new Error(`Dense shape must be a vector, saw:\n         ${o.shape}`);if(2!==r.shape.length)throw new Error(`Indices must be a matrix, saw:\n         ${r.shape}`);if(1!==s.shape.length)throw new Error(`Values must be a vector, saw:\n         ${s.shape}`);if(0!==i.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${i.shape}`);const a=n.readSync(r.dataId),u=n.readSync(s.dataId),c=n.readSync(o.dataId),l=n.readSync(i.dataId)[0],[f,h,p,d,m]=ZE(a,r.shape,r.dtype,u,s.dtype,c,l);return[n.makeTensorInfo(h,r.dtype,f),n.makeTensorInfo([h[0]],s.dtype,p),n.makeTensorInfo([d.length],"bool",new Uint8Array(d.map((t=>Number(t))))),n.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CC={kernelName:"SparseReshape",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{inputIndices:r,inputShape:s,newShape:o}=e;if(2!==r.shape.length)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(1!==s.shape.length)throw new Error(`Input shape should be a vector but received shape ${s.shape}`);if(1!==o.shape.length)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(n.readSync(s.dataId)),a=n.readSync(r.dataId),u=Array.from(n.readSync(o.dataId)),[c,l,f]=QE(a,r.shape,r.dtype,i,u);return[n.makeTensorInfo(l,r.dtype,c),n.makeTensorInfo([f.length],o.dtype,new Int32Array(f))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OC={kernelName:"SparseSegmentMean",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:s,segmentIds:o}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.shape.length)throw new Error(`Indices should be a vector but received shape\n              ${s.shape}`);if(1!==o.shape.length)throw new Error(`Segment ids should be a vector but received shape\n              ${o.shape}`);const i=n.readSync(r.dataId),a=n.readSync(s.dataId),u=n.readSync(o.dataId),[c,l]=tS(i,r.shape,r.dtype,a,u,!0);return n.makeTensorInfo(l,r.dtype,c)}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IC={kernelName:"SparseSegmentSum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:s,segmentIds:o}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.shape.length)throw new Error(`Indices should be a vector but received shape\n             ${s.shape}`);if(1!==o.shape.length)throw new Error(`Segment ids should be a vector but received shape\n             ${o.shape}`);const i=n.readSync(r.dataId),a=n.readSync(s.dataId),u=n.readSync(o.dataId),[c,l]=tS(i,r.shape,r.dtype,a,u);return n.makeTensorInfo(l,r.dtype,c)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MC={kernelName:"SparseToDense",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{sparseIndices:s,sparseValues:o,defaultValue:i}=e,{outputShape:a}=r,{sliceRank:u,numUpdates:c,sliceSize:l,strides:f,outputSize:h}=Mb(0,s,a);if("string"===o.dtype){const t=n.bufferSync(s),e=n.bufferSync(o),r=Xm(n.readSync(i.dataId)[0]),p=KE(t,e,a,h,l,c,u,f,r,false);return n.makeTensorInfo(a,p.dtype,p.values)}const p=new yC(c,u,s.shape.length,o.shape.length,f,[h,1],false),d=n.runWebGLProgram(p,[o,s,i],o.dtype),m=XS({inputs:{x:d},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(d),m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RC={kernelName:"SplitV",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{numOrSizeSplits:o,axis:i}=r,a=td(i,s.shape)[0],u=iN(s,o,a),c=s.shape.length,l=new Array(c).fill(0),f=s.shape.slice();return u.map((t=>{const e=[...f];e[a]=t;const r=H_({inputs:{x:s},backend:n,attrs:{begin:l,size:e}});return l[a]+=t,r}))}},DC="return sqrt(x);",FC={kernelName:"Sqrt",backendName:"webgl",kernelFunc:BS({opSnippet:DC,packedOpSnippet:DC,cpuKernelImpl:eS})},LC={kernelName:"Square",backendName:"webgl",kernelFunc:BS({opSnippet:"return x * x;"})},PC={kernelName:"SquaredDifference",backendName:"webgl",kernelFunc:VS({opSnippet:"return (a - b) * (a - b);",packedOpSnippet:"return (a - b) * (a - b);"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BC={kernelName:"Step",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function({inputs:t,attrs:e,backend:n}){const{x:r}=t,s=`if (isnan(x)) return x;\n    return x > 0.0 ? 1.0 : float(${e.alpha});\n  `,o=new wS(r.shape,s);return n.runWebGLProgram(o,[r],r.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VC{constructor(t,e,n){this.variableNames=["x"],this.outputShape=n;const r=n.length,s=E$(n.length),o=E$(n.length);let i="";if(1===r)i="coords * strides + begin";else{let t=0;i=n.map(((e,r)=>(t++,1===n.length?`coords * strides[${r}] + begin[${r}]`:`coords[${t-1}] * strides[${r}] + begin[${r}]`))).join(",")}this.userCode=`\n      ${s} begin = ${s}(${t});\n      ${s} strides = ${s}(${e});\n\n      void main() {\n        ${o} coords = getOutputCoords();\n        setOutput(getX(${i}));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zC={kernelName:"StridedSlice",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{begin:o,end:i,strides:a,beginMask:u,endMask:c,ellipsisMask:l,newAxisMask:f,shrinkAxisMask:h}=r,{finalShapeSparse:p,finalShape:d,isIdentity:m,sliceDim0:y,isSimpleSlice:g,begin:b,end:w,strides:v}=Hb(s.shape,o,i,a,u,c,l,f,h);let x;if(m)x=XS({inputs:{x:s},backend:n,attrs:{shape:d}});else if(y||g){jp(s.shape.length>=1,(()=>`Input must have rank at least 1, got: ${s.shape.length}`));const t=Db(b,w,v),e=H_({inputs:{x:s},backend:n,attrs:{begin:b,size:t}});x=XS({inputs:{x:e},backend:n,attrs:{shape:d}}),n.disposeIntermediateTensorInfo(e)}else{if(n.shouldExecuteOnCPU([s])){const t=n.readSync(s.dataId),e=ab(s.shape,s.dtype,t),r=nS(p,e,v,b);x=n.makeTensorInfo(d,s.dtype,r.values)}else{const t=new VC(b,v,p);x=n.runWebGLProgram(t,[s],s.dtype)}}const N=XS({inputs:{x},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(x),N}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WC={kernelName:"StringNGrams",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{separator:s,nGramWidths:o,leftPad:i,rightPad:a,padWidth:u,preserveShortSequences:c}=r,{data:l,dataSplits:f}=e,h=n.readSync(l.dataId),p=n.readSync(f.dataId),[d,m]=rS(h,p,s,o,i,a,u,c);return[n.makeTensorInfo([d.length],"string",d),n.makeTensorInfo(f.shape,"int32",m)]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UC={kernelName:"StringSplit",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{skipEmpty:s}=r,{input:o,delimiter:i}=e;if("string"!==o.dtype)throw new Error("Input must be of datatype string");if(1!==o.shape.length)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(0!==i.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=n.readSync(o.dataId),u=n.readSync(i.dataId)[0],[c,l,f]=sS(a,u,s),h=l.length;return[n.makeTensorInfo([h,2],"int32",c),n.makeTensorInfo([h],"string",l),n.makeTensorInfo([2],"int32",new Int32Array(f))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jC={kernelName:"StringToHashBucketFast",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{numBuckets:s}=r,{input:o}=e;if("string"!==o.dtype)throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const i=n.readSync(o.dataId),a=oS(i,s);return n.makeTensorInfo(o.shape,"int32",a)}},GC={kernelName:"Tan",backendName:"webgl",kernelFunc:BS({opSnippet:"return tan(x);"})},qC={kernelName:"Tanh",backendName:"webgl",kernelFunc:BS({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class HC{constructor(t,e){this.variableNames=["A"];const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;const r=E$(this.rank),s=function(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(1===e)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let e=0;e<t.length;e++)r.push(`imod(${n[e]}, ${t[e]})`);return r.join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t);this.userCode=`\n      void main() {\n        ${r} resRC = getOutputCoords();\n        setOutput(getA(${s}));\n      }\n    `}}function KC(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{reps:o}=r;if("string"===s.dtype||s.shape.length>5){const t=n.readSync(s.dataId),e="string"===s.dtype?t.map((t=>Xm(t))):t,r=ab(s.shape,s.dtype,e),i=aS(r,o);return n.makeTensorInfo(i.shape,i.dtype,i.values)}const i=new HC(s.shape,o);return n.runWebGLProgram(i,[s],s.dtype)}const XC={kernelName:"Tile",backendName:"webgl",kernelFunc:KC};class JC{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "}}class YC{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZC(t,e){null!==e&&t.disposeIntermediateTensorInfo(e)}function QC(t){let e=1;for(;e<t;)e*=2;return e}const tO={kernelName:"TopK",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{k:o,sorted:i}=r,a=xd().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=xd().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=s.shape,l=c[c.length-1];if(n.shouldExecuteOnCPU([s])||l<a||o>u){const t=n.readSync(s.dataId),[e,r]=uS(t,c,s.dtype,o,i);return[n.makeTensorInfo(e.shape,e.dtype,e.values),n.makeTensorInfo(r.shape,r.dtype,r.values)]}if(0===o)return c[c.length-1]=0,[n.makeTensorInfo(c,s.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(1===l)return[s,vk({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const f=n.texData.get(s.dataId),h=null!==f&&f.isPacked,p=h?n.unpackTensor(s):s,d=Kp(c)/l,m=XS({inputs:{x:p},attrs:{shape:[d,l]},backend:n});h&&ZC(n,p);const y=QC(o),g=QC(l);let b=null;const w=()=>null===b?[m,m]:[m,b],v=(t,e,r)=>{const s=w(),o=new JC(r),i=[[l],[null===b?1:0],[Number.NEGATIVE_INFINITY],[t],[e]],a=b;b=n.runWebGLProgram(o,s,"int32",i),ZC(n,a)};for(let t=1;t<y;t*=2){const e=2*t;for(let n=t;n>=1;n/=2)v(e,n,[d,g])}for(let t=g;t>y;t/=2){const e=w(),r=new YC([d,t/2]),s=[[l],[null===b?1:0],[y]],o=b;b=n.runWebGLProgram(r,e,"int32",s),ZC(n,o);const i=y/2,a=2*i;for(let t=i;t>=1;t/=2)v(a,t,b.shape)}let x=b;b=H_({inputs:{x:b},backend:n,attrs:{begin:0,size:[d,o]}}),ZC(n,x);let N=Fk({inputs:{x:m,indices:b},backend:n,attrs:{axis:1,batchDims:1}});ZC(n,m);const $=c.slice(0,-1);$.push(o),x=b,b=XS({inputs:{x:b},attrs:{shape:$},backend:n}),ZC(n,x);const E=N;return N=XS({inputs:{x:N},attrs:{shape:$},backend:n}),ZC(n,E),[N,b]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eO{constructor(t,e,n,r,s,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const i="nearest"===n?1:2;let a;switch(r){case"constant":default:a=1;break;case"reflect":a=2;break;case"wrap":a=3;break;case"nearest":a=4}this.userCode=`\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(${a} == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${a} == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${a} == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${e}) {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(${s});\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(${s});\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(${e}));\n                float mapY = mapCoord(inY, float(${t}));\n\n                if (${i} == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        `}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nO={kernelName:"Transform",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{image:s,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:u,outputShape:c}=r,[l,f,h,p]=s.shape,[d,m]=null!=c?c:[f,h],y=new eO(f,h,i,a,u,[l,d,m,p]);return n.runWebGLProgram(y,[s,o],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rO={kernelName:"Unique",backendName:"webgl",kernelFunc:function(t){const{inputs:e,attrs:n,backend:r}=t,{axis:s}=n,{x:o}=e;o$(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const i=r.readSync(o.dataId),{outputValues:a,outputShape:u,indices:c}=lS(i,s,o.shape,o.dtype);return[r.makeTensorInfo(u,o.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sO={kernelName:"Unpack",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{value:s}=e;let{axis:o}=r;o<0&&(o+=s.shape.length);const i=s,a=i.shape.length,u=s.shape[o],c=new Array(a-1);let l=0;for(let t=0;t<a;t++)t!==o&&(c[l++]=i.shape[t]);const f=[],h=new Array(a).fill(0),p=i.shape.slice();p[o]=1;const d=new Array(u);for(let t=0;t<d.length;t++){h[o]=t;const e=H_({inputs:{x:i},backend:n,attrs:{begin:h,size:p}}),r=XS({inputs:{x:e},backend:n,attrs:{shape:c}});d[t]=r,f.push(e)}return f.forEach((t=>n.disposeIntermediateTensorInfo(t))),d}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oO{constructor(t,e){this.variableNames=["x","segmentIds"];const n=t.windowSize,r=t.batchSize,s=t.inSize,o=t.numSegments,i=o*Math.ceil(s/n);this.outputShape=[r,i];const a=4*Math.floor(n/4),u=n%4,c="\n        sumValue += dot(values, segFilter);\n    ";let l="";s%n>0&&(l=`\n        if (inIdx < 0 || inIdx >= ${s}) {\n          return initializationValue;\n        }\n      `);let f="";s%n>0&&(f=`\n        if (inIdx < 0 || inIdx >= ${s}) {\n          return -1.0;\n        }\n      `),this.userCode=`\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ${l}\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ${f}\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ${o})) * float(${n}));\n        int currentSeg = int(mod(float(outIdx), float(${o})));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${a}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ${c}\n        }\n\n        int inIdx = inOffset + ${a};\n        if (${1===u}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ${c}\n        } else if (${2===u}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ${c}\n        } else if (${3===u}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ${c}\n        }\n        setOutput(sumValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iO={kernelName:"UnsortedSegmentSum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,segmentIds:o}=e,{numSegments:i}=r,a=s.shape.length,u=[];let c=0;const l=Vw([c],a);let f=s;null!=l&&(f=o_({inputs:{x:s},backend:n,attrs:{perm:l}}),u.push(f),c=Ww(1,a)[0]);const h=vN(f.shape,c,i),p=Kp([f.shape[c]]),d=XS({inputs:{x:f},backend:n,attrs:{shape:[-1,p]}});u.push(d);const m=yy(s.dtype),y=(t,e,r,s,o)=>{const i=t.shape[0],a=t.shape[1],c=wN(a,o),l=new oO({windowSize:c,inSize:a,batchSize:i,numSegments:o},e),f=n.compileAndRun(l,[t,r],s);if(u.push(f),f.shape[1]===o)return f;const h=KA({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),p=KC({inputs:{x:h},backend:n,attrs:{reps:[a/c]}});u.push(h),u.push(p);return y(f,e,p,s,o)},g=XS({inputs:{x:y(d,"unsortedSegmentSum",o,m,i)},backend:n,attrs:{shape:h}});let b=g;if(null!=l){u.push(g);const t=zw(l);b=o_({inputs:{x:b},backend:n,attrs:{perm:t}})}return u.forEach((t=>n.disposeIntermediateTensorInfo(t))),b}},aO=[u_,l_,f_,h_,d_,g_,b_,w_,S_,__,T_,k_,A_,C_,O_,R_,D_,P_,B_,V_,U_,X_,J_,Y_,nT,sT,aT,IS,lT,bT,ET,AT,CT,OT,IT,MT,RT,DT,LT,UT,jT,GT,HT,JT,QT,tk,nk,sk,ok,ik,ak,uk,ck,fk,pk,mk,bk,xk,$k,Sk,_k,Ak,Ok,Ik,Rk,Lk,Pk,Bk,CS,Vk,mT,zk,Wk,Uk,DS,jk,Gk,qk,Hk,Kk,Xk,Jk,Yk,tA,nA,sA,oA,iA,aA,lA,fA,hA,pA,dA,mA,bA,wA,kA,KS,AA,OA,MA,DA,Q_,LA,VA,zA,GA,qA,PS,HA,XA,eT,NA,JA,YA,ZA,JS,eC,rC,iC,uC,fC,pC,dC,mC,gC,wC,xC,NC,$C,EC,SC,_C,K_,TA,TC,kC,AC,CC,OC,IC,MC,RC,FC,LC,PC,BC,zC,WC,UC,jC,SA,s_,GC,qC,XC,tO,nO,i_,rO,sO,iO,BA];
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */for(const t of aO)sm(t);
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
var uO,cO;let lO;xd().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"}(uO||(uO={})),function(t){var e;(e=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(cO||(cO={}));const fO=Fp.PART_CHANNELS;class hO extends d{get poseType(){return"bodypix"}get parts(){return fO}async onMetadata(){super.onMetadata(),await async function(){lO&&(lO.dispose(),lO=void 0),lO=await Fp.load({architecture:"MobileNetV1",outputStride:16,multiplier:.5,quantBytes:2})}(),this.poseDetectionFrame()}async poseDetectionFrame(){if((this.isPlaying||this.forceOneTimePoseProcess)&&this.videoEl.readyState>1){const t=await async function(t,e=0,n=0){const r=[];if(lO){const s=await lO.segmentPersonParts(t.videoElement,{internalResolution:"medium",segmentationThreshold:.7,maxDetections:1,scoreThreshold:.3,nmsRadius:20});s&&s.allPoses.forEach(((s,o)=>{const i={time:Date.now()-e,score:s.score,pose:o,points:[],aspectRatio:t.aspectRatio};s.keypoints.forEach((e=>{e.score>=n&&i.points.push({name:e.part,score:e.score,position:[e.position.x/t.videoElement.width,e.position.y/t.videoElement.height]})})),r.push(i)}))}return r}(this,this.recordingStartTime,this.minConfidence/100);this.onPoseFrame(t),this.forceOneTimePoseProcess=!1}requestAnimationFrame((()=>this.poseDetectionFrame()))}}customElements.define("bodypix-video",hO);function pO(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dO(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function mO(t,e,n=""){dO(wO(t,e),(()=>n+` Shapes ${t} and ${e} must match`))}function yO(t){dO(null!=t,(()=>"The input to the tensor constructor must be a non-null value."))}function gO(t,e=[],n=!1){if(null==e&&(e=[]),Array.isArray(t)||$O(t)&&!n)for(let r=0;r<t.length;++r)gO(t[r],e,n);else e.push(t);return e}function bO(t){if(0===t.length)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function wO(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function vO(t){return t%1==0}function xO(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function NO(t,e){const n=e.length;return t=null==t?e.map(((t,e)=>e)):[].concat(t),dO(t.every((t=>t>=-n&&t<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`)),dO(t.every((t=>vO(t))),(()=>`All values in axis param must be integers but got axis ${t}`)),t.map((t=>t<0?n+t:t))}function $O(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function EO(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error(`Unknown dtype ${t}`)}function SO(t){return"string"==typeof t||t instanceof String}function _O(t){return Array.isArray(t)?_O(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":"number"==typeof t?"float32":SO(t)?"string":function(t){return"boolean"==typeof t}(t)?"bool":"float32"}function TO(t){return!!(t&&t.constructor&&t.call&&t.apply)}function kO(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function AO(t,e,n,r=!1){const s=new Array;if(1===e.length){const o=e[0]*(r?2:1);for(let e=0;e<o;e++)s[e]=n[t+e]}else{const o=e[0],i=e.slice(1),a=i.reduce(((t,e)=>t*e))*(r?2:1);for(let e=0;e<o;e++)s[e]=AO(t+e*a,i,n,r)}return s}function CO(t,e,n=!1){if(0===t.length)return e[0];const r=t.reduce(((t,e)=>t*e))*(n?2:1);if(0===r)return[];if(r!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return AO(0,t,e,n)}function OO(t,e){const n=IO(t,e);for(let t=0;t<n.length;t++)n[t]=1;return n}function IO(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function MO(t){t.forEach((e=>{dO(Number.isInteger(e)&&e>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`))}))}function RO(t){return t&&t.then&&"function"==typeof t.then}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DO{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=FO,this.populateURLFlags()}setPlatform(t,e){null!=this.platform&&(LO().getBool("IS_TEST")||LO().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=e}registerFlag(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){const e=this.urlFlags[t];LO().getBool("IS_TEST")||LO().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${e}.`),this.set(t,e)}}async getAsync(t){return t in this.flags||(this.flags[t]=await this.evaluateFlag(t)),this.flags[t]}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(RO(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(null==this.flagRegistry[t])throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(null==this.flagRegistry[t])throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const t=this.getQueryParams(this.global.location.search);if("tfjsflags"in t){t.tfjsflags.split(",").forEach((t=>{const[e,n]=t.split(":");this.urlFlags[e]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}(e,n)}))}}}function FO(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((t,...n)=>(function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")))),e}function LO(){return PO}let PO=null;var BO="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function VO(){throw new Error("setTimeout has not been defined")}function zO(){throw new Error("clearTimeout has not been defined")}var WO=VO,UO=zO;function jO(t){if(WO===setTimeout)return setTimeout(t,0);if((WO===VO||!WO)&&setTimeout)return WO=setTimeout,setTimeout(t,0);try{return WO(t,0)}catch(e){try{return WO.call(null,t,0)}catch(e){return WO.call(this,t,0)}}}"function"==typeof BO.setTimeout&&(WO=setTimeout),"function"==typeof BO.clearTimeout&&(UO=clearTimeout);var GO,qO=[],HO=!1,KO=-1;function XO(){HO&&GO&&(HO=!1,GO.length?qO=GO.concat(qO):KO=-1,qO.length&&JO())}function JO(){if(!HO){var t=jO(XO);HO=!0;for(var e=qO.length;e;){for(GO=qO,qO=[];++KO<e;)GO&&GO[KO].run();KO=-1,e=qO.length}GO=null,HO=!1,function(t){if(UO===clearTimeout)return clearTimeout(t);if((UO===zO||!UO)&&clearTimeout)return UO=clearTimeout,clearTimeout(t);try{UO(t)}catch(e){try{return UO.call(null,t)}catch(e){return UO.call(this,t)}}}(t)}}function YO(t,e){this.fun=t,this.array=e}YO.prototype.run=function(){this.fun.apply(null,this.array)};function ZO(){}var QO=ZO,tI=ZO,eI=ZO,nI=ZO,rI=ZO,sI=ZO,oI=ZO;var iI=BO.performance||{},aI=iI.now||iI.mozNow||iI.msNow||iI.oNow||iI.webkitNow||function(){return(new Date).getTime()};var uI=new Date;var cI={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];qO.push(new YO(t,e)),1!==qO.length||HO||jO(JO)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:QO,addListener:tI,once:eI,off:nI,removeListener:rI,removeAllListeners:sI,emit:oI,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*aI.call(iI),n=Math.floor(e),r=Math.floor(e%1*1e9);return t&&(n-=t[0],(r-=t[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-uI)/1e3}},lI=cI;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
let fI;function hI(){if(null==fI){let t;if("undefined"!=typeof window)t=window;else if(void 0!==BO)t=BO;else if(void 0!==lI)t=lI;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}fI=t}return fI}function pI(t,e){const n=function(){const t=hI();return null==t._tfGlobals&&(t._tfGlobals=new Map),t._tfGlobals}();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function dI(...t){LO().getBool("IS_TEST")||LO().getBool("PROD")||console.warn(...t)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mI=pI("kernelRegistry",(()=>new Map)),yI=pI("gradRegistry",(()=>new Map));function gI(t,e){const n=function(t,e){return`${e}_${t}`}(t,e);return mI.get(n)}function bI(t){return yI.get(t)}function wI(t){const e=mI.entries(),n=[];for(;;){const{done:r,value:s}=e.next();if(r)break;const[o,i]=s,[a]=o.split("_");a===t&&n.push(i)}return n}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vI(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=gO(t)),LO().getBool("DEBUG")&&function(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){const e=new Uint8Array(t.length);for(let n=0;n<e.length;++n)0!==Math.round(t[n])&&(e[n]=1);return e}throw new Error(`Unknown data type ${e}`)}function xI(){return LO().platform.now()}function NI(t,e="utf-8"){return e=e||"utf-8",LO().platform.decode(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $I{constructor(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new SI)}profileKernel(t,e,n){let r;const s=()=>{r=n()};let o;const i=xI();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(s);else{s();for(const t of r)t.dataSync();o=Promise.resolve({kernelMs:xI()-i})}if(LO().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let e=0;e<r.length;e++){const n=r[e];n.data().then((e=>{EI(e,n.dtype,t)}))}return{kernelName:t,outputs:r,inputs:e,timeMs:o.then((t=>t.kernelMs)),extraInfo:o.then((t=>null!=t.getExtraProfileInfo?t.getExtraProfileInfo():""))}}logKernelProfile(t){const{kernelName:e,outputs:n,timeMs:r,inputs:s,extraInfo:o}=t;n.forEach((t=>{Promise.all([t.data(),r,o]).then((n=>{this.logger.logKernelProfile(e,t,n[0],n[1],s,n[2])}))}))}}function EI(t,e,n){if("float32"!==e)return!1;for(let e=0;e<t.length;e++){const r=t[e];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class SI{logKernelProfile(t,e,n,r,s,o){const i="number"==typeof r?xO(`${r}ms`,9):r.error,a=xO(t,25),u=e.rank,c=e.size,l=xO(e.shape.toString(),14);let f="";for(const t in s){const n=s[t];if(null!=n){const r=n.shape||e.shape,s=r.length;f+=`${t}: ${s}D ${s>0?r:""} `}}console.log(`%c${a}\t%c${i}\t%c${u}D ${l}\t%c${c}\t%c${f}\t%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _I(t,e,n,r){const s=kO(e),o=function(t,e,n,r){const s=bO(e),o=r[r.length-1],i=new Array(o).fill(0),a=e.length,u="complex64"===n?CI(t):t;if(a>1)for(let t=0;t<s/o;t++){const e=t*o;for(let t=0;t<o;t++)i[t]=Math.max(i[t],TI(u[e+t],0,n).length)}return i}(t,e,n,s),i=e.length,a=AI(t,e,n,s,o),u=["Tensor"];return r&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${i}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(a.map((t=>"    "+t)).join("\n")),u.join("\n")}function TI(t,e,n){let r;return r=Array.isArray(t)?`${parseFloat(t[0].toFixed(7))} + ${parseFloat(t[1].toFixed(7))}j`:SO(t)?`'${t}'`:"bool"===n?kI(t):parseFloat(t.toFixed(7)).toString(),xO(r,e)}function kI(t){return 0===t?"false":"true"}function AI(t,e,n,r,s,o=!0){const i="complex64"===n?2:1,a=e[0],u=e.length;if(0===u){if("complex64"===n){return[TI(CI(t)[0],0,n)]}return"bool"===n?[kI(t[0])]:[t[0].toString()]}if(1===u){if(a>20){const e=3*i;let r=Array.from(t.slice(0,e)),o=Array.from(t.slice((a-3)*i,a*i));return"complex64"===n&&(r=CI(r),o=CI(o)),["["+r.map(((t,e)=>TI(t,s[e],n))).join(", ")+", ..., "+o.map(((t,e)=>TI(t,s[a-3+e],n))).join(", ")+"]"]}return["["+("complex64"===n?CI(t):Array.from(t)).map(((t,e)=>TI(t,s[e],n))).join(", ")+"]"]}const c=e.slice(1),l=r.slice(1),f=r[0]*i,h=[];if(a>20){for(let e=0;e<3;e++){const r=e*f,o=r+f;h.push(...AI(t.slice(r,o),c,n,l,s,!1))}h.push("...");for(let e=a-3;e<a;e++){const r=e*f,o=r+f;h.push(...AI(t.slice(r,o),c,n,l,s,e===a-1))}}else for(let e=0;e<a;e++){const r=e*f,o=r+f;h.push(...AI(t.slice(r,o),c,n,l,s,e===a-1))}const p=2===u?",":"";h[0]="["+h[0]+p;for(let t=1;t<h.length-1;t++)h[t]=" "+h[t]+p;let d=",\n";for(let t=2;t<u;t++)d+="\n";return h[h.length-1]=" "+h[h.length-1]+"]"+(o?"":d),h}function CI(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OI{constructor(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=bO(t),null!=n){const t=n.length;dO(t===this.size,(()=>`Length of values '${t}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||function(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error(`Unknown data type ${t}`);n=new Array(e)}return n}(e,this.size),this.strides=kO(t)}set(t,...e){0===e.length&&(e=[0]),dO(e.length===this.rank,(()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`));const n=this.locToIndex(e);this.values[n]=t}get(...t){0===t.length&&(t=[0]);let e=0;for(const n of t){if(n<0||n>=this.shape[e]){const e=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(e)}e++}let n=t[t.length-1];for(let e=0;e<t.length-1;++e)n+=this.strides[e]*t[e];return this.values[n]}locToIndex(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];let e=t[t.length-1];for(let n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e}indexToLoc(t){if(0===this.rank)return[];if(1===this.rank)return[t];const e=new Array(this.shape.length);for(let n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return II().makeTensor(this.values,this.shape,this.dtype)}}let II=null,MI=null;class RI{constructor(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=bO(t),this.strides=kO(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return MI.buffer(this.shape,this.dtype,t)}bufferSync(){return MI.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return CO(this.shape,t,"complex64"===this.dtype)}arraySync(){return CO(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const t=II().read(this.dataId);if("string"===this.dtype){const e=await t;try{return e.map((t=>NI(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),II().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=II().readSync(this.dataId);if("string"===this.dtype)try{return t.map((t=>NI(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await II().read(this.dataId);return"string"===this.dtype?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(II().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return MI.print(this,t)}clone(){return this.throwIfDisposed(),MI.clone(this)}toString(t=!1){return _I(this.dataSync(),this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),MI.cast(this,t)}variable(t=!0,e,n){return this.throwIfDisposed(),II().makeVariable(this,t,e,n)}}Object.defineProperty(RI,Symbol.hasInstance,{value:t=>!!t&&null!=t.data&&null!=t.dataSync&&null!=t.throwIfDisposed}),pI("Tensor",(()=>RI));class DI extends RI{constructor(t,e,n,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=e,this.name=n}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!wO(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);II().disposeTensor(this),this.dataId=t.dataId,II().incRef(this,null)}dispose(){II().disposeVariable(this),this.isDisposedInternal=!0}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var FI,LI,PI,BI,VI;Object.defineProperty(DI,Symbol.hasInstance,{value:t=>t instanceof RI&&null!=t.assign&&t.assign instanceof Function}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(FI||(FI={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(LI||(LI={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(PI||(PI={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(BI||(BI={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(VI||(VI={}));const zI={float32:BI,int32:LI,bool:PI,complex64:VI};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function WI(t,e){if(t.dtype===e.dtype)return[t,e];const n=function(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return zI[t][e]}(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function UI(t){const e=[];return jI(t,e,new Set),e}function jI(t,e,n){if(null==t)return;if(t instanceof RI)return void e.push(t);if(r=t,!Array.isArray(r)&&"object"!=typeof r)return;var r;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s=t;for(const t in s){const r=s[t];n.has(r)||(n.add(r),jI(r,e,n))}}function GI(t){return null!=t.kernelName}class qI{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((t=>t.name))))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class HI{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new qI}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;{const{asyncInit:e}=this.initializeBackend(t);if(e)return null}}return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,n=1){return t in this.registryFactory?(dI(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:n},!0)}async setBackend(t){if(null==this.registryFactory[t])throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,null==this.registry[t]){this.backendInstance=null;const{success:e,asyncInit:n}=this.initializeBackend(t);if(!(n?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new $I(this.backendInstance),!0}setupRegisteredKernels(){wI(this.backendName).forEach((t=>{null!=t.setupFunc&&t.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(t){wI(t).forEach((e=>{null!=e.disposeFunc&&e.disposeFunc(this.registry[t])}))}initializeBackend(t){const e=this.registryFactory[t];if(null==e)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const n=e.factory();if(!n||n instanceof class{refCount(t){return pO("refCount")}incRef(t){return pO("incRef")}timerAvailable(){return!0}time(t){return pO("time")}read(t){return pO("read")}readSync(t){return pO("readSync")}readToGPU(t,e){return pO("readToGPU")}numDataIds(){return pO("numDataIds")}disposeData(t,e){return pO("disposeData")}write(t,e,n){return pO("write")}move(t,e,n,r,s){return pO("move")}memory(){return pO("memory")}floatPrecision(){return pO("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return pO("dispose")}}||"function"!=typeof n.then)return this.registry[t]=n,{success:!0,asyncInit:!1};{const e=++this.pendingBackendInitId,r=n.then((n=>!(e<this.pendingBackendInitId)&&(this.registry[t]=n,this.pendingBackendInit=null,!0))).catch((n=>(e<this.pendingBackendInitId||(this.pendingBackendInit=null,dI(`Initialization of backend ${t} failed`),dI(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(e){return dI(`Initialization of backend ${t} failed`),dI(e.stack||e.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority))}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e],{success:r,asyncInit:s}=this.initializeBackend(n);if(s||r)return{name:n,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const n=this.state.tensorInfo.get(e),r=n.backend,s=this.readSync(e),o=r.refCount(e);r.disposeData(e,!0),n.backend=t,t.move(e,s,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let n,r=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=e(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(t,e,n){t();try{const t=n();return e(),t}catch(t){throw e(),t}}nextTensorId(){return HI.nextTensorId++}nextVariableId(){return HI.nextVariableId++}clone(t){const e=XI.runKernel("Identity",{x:t}),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(t=>({x:()=>{const e={x:t},n={dtype:"float32"};return XI.runKernel("Cast",e,n)}})),[],{}),e}runKernel(t,e,n){null==this.backendName&&this.backend;if(!(null!=gI(t,this.backendName)))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,n){const r=this.backend.numDataIds();let s=0;n.forEach((t=>{s+="complex64"===t.dtype?3:1}));const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=r-e-s-o;if(i>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${i} data ids) after running '${t}'`)}runKernelFunc(t){let e,n=[];const r=this.isTapeOn(),s=this.state.numBytes,o=this.state.numTensors;let i,a;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const u=GI(t)?t.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(GI(t)){const{kernelName:e,inputs:s,attrs:o}=t;null==this.backendName&&this.backend;const u=gI(e,this.backendName);dO(null!=u,(()=>`Cannot find registered kernel '${e}' for backend '${this.backendName}'`)),i=()=>{const t=this.backend.numDataIds();a=u.kernelFunc({inputs:s,attrs:o,backend:this.backend});const i=Array.isArray(a)?a:[a];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(e,t,i);const c=i.map((t=>null!=t.rank?t:this.makeTensorFromTensorInfo(t)));if(r){const t=this.getTensorsForGradient(e,s,c);n=this.saveTensorsForBackwardMode(t)}return c}}else{const{forwardFunc:e}=t,s=t=>{r&&(n=t.map((t=>this.keep(this.clone(t)))))};i=()=>{const t=this.backend.numDataIds();a=this.tidy((()=>e(this.backend,s)));const n=Array.isArray(a)?a:[a];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,t,n),n}}const{inputs:c,attrs:l}=t,f=GI(t)?null:t.backwardsFunc;let h;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(h=this.profiler.profileKernel(u,c,(()=>i())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(h),e=h.outputs):e=i()})),r&&this.addTapeNode(u,c,e,f,n,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map((t=>null!=c[t]?c[t].shape:null)),outputShapes:e.map((t=>t.shape)),kernelTimeMs:h.timeMs,extraInfo:h.extraInfo}),Array.isArray(a)?e:e[0]}saveTensorsForBackwardMode(t){const e=t.map((t=>this.keep(this.clone(t))));return e}getTensorsForGradient(t,e,n){const r=bI(t);if(null!=r){const t=r.inputsToSave||[],s=r.outputsToSave||[];let o;r.saveAllInputs?(dO(Array.isArray(e),(()=>"saveAllInputs is true, expected inputs to be an array.")),o=Object.keys(e).map((t=>e[t]))):o=t.map((t=>e[t]));const i=n.filter(((t,e)=>s[e]));return o.concat(i)}return[]}makeTensor(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let s=t;"string"===n&&SO(t[0])&&(s=t.map((t=>function(t,e="utf-8"){return e=e||"utf-8",LO().platform.encode(t,e)}(t))));const o=r.write(s,e,n),i=new RI(e,n,o,this.nextTensorId());if(this.trackTensor(i,r),"string"===n){const t=this.state.tensorInfo.get(o),e=function(t){if(null==t)return 0;let e=0;return t.forEach((t=>e+=t.length)),e}(s);this.state.numBytes+=e-t.bytes,t.bytes=e}return i}makeTensorFromDataId(t,e,n,r){const s={dataId:t,shape:e,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(s,r)}makeTensorFromTensorInfo(t,e){const{dataId:n,shape:r,dtype:s}=t,o=new RI(r,s,n,this.nextTensorId());return this.trackTensor(o,e),o}makeVariable(t,e=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.cast(r));const s=new DI(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[s.name])throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(t,e){this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*EO(t.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n})),t instanceof DI||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,"string"===t.dtype&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),"complex64"!==t.dtype&&"string"!==t.dtype){const e=t.size*EO(t.dtype);this.state.numBytes-=e}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((t=>t.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const t of this.state.activeProfile.kernels)t.kernelTimeMs=await t.kernelTimeMs,t.extraInfo=await t.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(t,e,n,r,s,o){const i={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:s},a=bI(t);null!=a&&(r=a.gradFunc),null!=r&&(i.gradient=t=>(t=t.map(((t,e)=>{if(null==t){const t=n[e],r=IO(t.size,t.dtype);return this.makeTensor(r,t.shape,t.dtype)}return t})),r(t.length>1?t:t[0],s,o))),this.state.activeTape.push(i)}keep(t){return t.kept=!0,t}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=UI(t),n=new Set(e.map((t=>t.id)));for(let t=0;t<this.state.activeScope.track.length;t++){const e=this.state.activeScope.track[t];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach((t=>{t.kept||t.scopeId!==r.id||this.track(t)}))}gradients(t,e,n,r=!1){if(dO(e.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const s=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",t)));dO(s instanceof RI,(()=>"The result y returned by f() must be a tensor."));const o=function(t,e,n){const r={},s={};for(let t=0;t<e.length;t++)r[e[t].id]=!0;for(let n=0;n<t.length;n++){const o=t[n],i=o.inputs;for(const t in i){const n=i[t];let a=!1;for(let t=0;t<e.length;t++)if(r[n.id]){o.outputs.forEach((t=>r[t.id]=!0)),a=!0,s[o.id]=!0;break}if(a)break}}const o={};o[n.id]=!0;const i={};for(let e=t.length-1;e>=0;e--){const n=t[e],r=n.inputs;for(let t=0;t<n.outputs.length;t++)if(o[n.outputs[t].id]){for(const t in r)o[r[t].id]=!0,i[n.id]=!0;break}}const a=[];for(let e=0;e<t.length;e++){const n=t[e];if(s[n.id]&&i[n.id]){const t={};for(const e in n.inputs){const s=n.inputs[e];r[s.id]&&(t[e]=s)}const e=Object.assign({},n);e.inputs=t,e.outputs=n.outputs,a.push(e)}}return a}(this.state.activeTape,e,s);if(!r&&0===o.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const t={};t[s.id]=null==n?function(t){const e=OO(bO(t),"float32");return XI.makeTensor(e,t,"float32")}(s.shape):n,function(t,e,n,r){for(let s=e.length-1;s>=0;s--){const o=e[s],i=[];if(o.outputs.forEach((e=>{const n=t[e.id];null!=n?i.push(n):i.push(null)})),null==o.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const e in o.inputs){if(!(e in a))throw new Error(`Cannot backprop through input ${e}. Available gradients found: ${Object.keys(a)}.`);const s=n((()=>a[e]()));if("float32"!==s.dtype)throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${e} must have 'float32' dtype, but has '${s.dtype}'`);const i=o.inputs[e];if(!wO(s.shape,i.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${e}' has shape '${s.shape}', which does not match the shape of the input '${i.shape}'`);if(null==t[i.id])t[i.id]=s;else{const e=t[i.id];t[i.id]=r(e,s),e.dispose()}}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,o,(t=>this.tidy(t)),JI);const r=e.map((e=>t[e.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((t=>{for(const e of t.saved)e.dispose()})),this.state.activeTape=null),{value:s,grads:r}}))}customGrad(t){return dO(TO(t),(()=>"The f passed in customGrad(f) must be a function.")),(...e)=>{let n;dO(e.every((t=>t instanceof RI)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};e.forEach(((t,e)=>{r[e]=t}));return this.runKernelFunc({forwardFunc:(r,s)=>(n=t(...e,s),dO(n.value instanceof RI,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),dO(TO(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(t,r)=>{const s=n.gradFunc(t,r),o=Array.isArray(s)?s:[s];dO(o.length===e.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),dO(o.every((t=>t instanceof RI)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const i={};return o.forEach(((t,e)=>{i[e]=()=>t})),i},inputs:r})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)}async time(t){const e=xI(),n=await this.backend.time(t);return n.wallMs=xI()-e,n}track(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new qI;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function KI(){const t=hI();if(null==t._tfengine){const e=new DO(t);t._tfengine=new HI(e)}var e;return e=t._tfengine.ENV,PO=e,II=()=>t._tfengine,t._tfengine}HI.nextTensorId=0,HI.nextVariableId=0;const XI=KI();function JI(t,e){const n={a:t,b:e};return XI.runKernel("Add",n)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YI=LO();YI.registerFlag("DEBUG",(()=>!1),(t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),YI.registerFlag("IS_BROWSER",(()=>"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope)),YI.registerFlag("IS_NODE",(()=>void 0!==lI&&void 0!==lI.versions&&void 0!==lI.versions.node)),YI.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),YI.registerFlag("PROD",(()=>!1)),YI.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>YI.getBool("DEBUG"))),YI.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),YI.registerFlag("IS_TEST",(()=>!1)),YI.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>!0)),YI.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),YI.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));var ZI=[],QI=[],tM="undefined"!=typeof Uint8Array?Uint8Array:Array,eM=!1;function nM(){eM=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,n=t.length;e<n;++e)ZI[e]=t[e],QI[t.charCodeAt(e)]=e;QI["-".charCodeAt(0)]=62,QI["_".charCodeAt(0)]=63}function rM(t,e,n){for(var r,s,o=[],i=e;i<n;i+=3)r=(t[i]<<16)+(t[i+1]<<8)+t[i+2],o.push(ZI[(s=r)>>18&63]+ZI[s>>12&63]+ZI[s>>6&63]+ZI[63&s]);return o.join("")}function sM(t){var e;eM||nM();for(var n=t.length,r=n%3,s="",o=[],i=16383,a=0,u=n-r;a<u;a+=i)o.push(rM(t,a,a+i>u?u:a+i));return 1===r?(e=t[n-1],s+=ZI[e>>2],s+=ZI[e<<4&63],s+="=="):2===r&&(e=(t[n-2]<<8)+t[n-1],s+=ZI[e>>10],s+=ZI[e>>4&63],s+=ZI[e<<2&63],s+="="),o.push(s),o.join("")}function oM(t,e,n,r,s){var o,i,a=8*s-r-1,u=(1<<a)-1,c=u>>1,l=-7,f=n?s-1:0,h=n?-1:1,p=t[e+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+t[e+f],f+=h,l-=8);for(i=o&(1<<-l)-1,o>>=-l,l+=r;l>0;i=256*i+t[e+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return i?NaN:1/0*(p?-1:1);i+=Math.pow(2,r),o-=c}return(p?-1:1)*i*Math.pow(2,o-r)}function iM(t,e,n,r,s,o){var i,a,u,c=8*o-s-1,l=(1<<c)-1,f=l>>1,h=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,i=l):(i=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-i))<1&&(i--,u*=2),(e+=i+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(i++,u/=2),i+f>=l?(a=0,i=l):i+f>=1?(a=(e*u-1)*Math.pow(2,s),i+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,s),i=0));s>=8;t[n+p]=255&a,p+=d,a/=256,s-=8);for(i=i<<s|a,c+=s;c>0;t[n+p]=255&i,p+=d,i/=256,c-=8);t[n+p-d]|=128*m}var aM={}.toString,uM=Array.isArray||function(t){return"[object Array]"==aM.call(t)};function cM(){return fM.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function lM(t,e){if(cM()<e)throw new RangeError("Invalid typed array length");return fM.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=fM.prototype:(null===t&&(t=new fM(e)),t.length=e),t}function fM(t,e,n){if(!(fM.TYPED_ARRAY_SUPPORT||this instanceof fM))return new fM(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return dM(this,t)}return hM(this,t,e,n)}function hM(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);fM.TYPED_ARRAY_SUPPORT?(t=e).__proto__=fM.prototype:t=mM(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!fM.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|bM(e,n),s=(t=lM(t,r)).write(e,n);s!==r&&(t=t.slice(0,s));return t}(t,e,n):function(t,e){if(gM(e)){var n=0|yM(e.length);return 0===(t=lM(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?lM(t,0):mM(t,e);if("Buffer"===e.type&&uM(e.data))return mM(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function pM(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function dM(t,e){if(pM(e),t=lM(t,e<0?0:0|yM(e)),!fM.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function mM(t,e){var n=e.length<0?0:0|yM(e.length);t=lM(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function yM(t){if(t>=cM())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+cM().toString(16)+" bytes");return 0|t}function gM(t){return!(null==t||!t._isBuffer)}function bM(t,e){if(gM(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return jM(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return GM(t).length;default:if(r)return jM(t).length;e=(""+e).toLowerCase(),r=!0}}function wM(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return MM(this,e,n);case"utf8":case"utf-8":return CM(this,e,n);case"ascii":return OM(this,e,n);case"latin1":case"binary":return IM(this,e,n);case"base64":return AM(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return RM(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function vM(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function xM(t,e,n,r,s){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=s?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(s)return-1;n=t.length-1}else if(n<0){if(!s)return-1;n=0}if("string"==typeof e&&(e=fM.from(e,r)),gM(e))return 0===e.length?-1:NM(t,e,n,r,s);if("number"==typeof e)return e&=255,fM.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):NM(t,[e],n,r,s);throw new TypeError("val must be string, number or Buffer")}function NM(t,e,n,r,s){var o,i=1,a=t.length,u=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;i=2,a/=2,u/=2,n/=2}function c(t,e){return 1===i?t[e]:t.readUInt16BE(e*i)}if(s){var l=-1;for(o=n;o<a;o++)if(c(t,o)===c(e,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*i}else-1!==l&&(o-=o-l),l=-1}else for(n+u>a&&(n=a-u),o=n;o>=0;o--){for(var f=!0,h=0;h<u;h++)if(c(t,o+h)!==c(e,h)){f=!1;break}if(f)return o}return-1}function $M(t,e,n,r){n=Number(n)||0;var s=t.length-n;r?(r=Number(r))>s&&(r=s):r=s;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var i=0;i<r;++i){var a=parseInt(e.substr(2*i,2),16);if(isNaN(a))return i;t[n+i]=a}return i}function EM(t,e,n,r){return qM(jM(e,t.length-n),t,n,r)}function SM(t,e,n,r){return qM(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function _M(t,e,n,r){return SM(t,e,n,r)}function TM(t,e,n,r){return qM(GM(e),t,n,r)}function kM(t,e,n,r){return qM(function(t,e){for(var n,r,s,o=[],i=0;i<t.length&&!((e-=2)<0);++i)r=(n=t.charCodeAt(i))>>8,s=n%256,o.push(s),o.push(r);return o}(e,t.length-n),t,n,r)}function AM(t,e,n){return 0===e&&n===t.length?sM(t):sM(t.slice(e,n))}function CM(t,e,n){n=Math.min(t.length,n);for(var r=[],s=e;s<n;){var o,i,a,u,c=t[s],l=null,f=c>239?4:c>223?3:c>191?2:1;if(s+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=t[s+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=t[s+1],i=t[s+2],128==(192&o)&&128==(192&i)&&(u=(15&c)<<12|(63&o)<<6|63&i)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=t[s+1],i=t[s+2],a=t[s+3],128==(192&o)&&128==(192&i)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&i)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),s+=f}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=4096));return n}(r)}fM.TYPED_ARRAY_SUPPORT=void 0===BO.TYPED_ARRAY_SUPPORT||BO.TYPED_ARRAY_SUPPORT,cM(),fM.poolSize=8192,fM._augment=function(t){return t.__proto__=fM.prototype,t},fM.from=function(t,e,n){return hM(null,t,e,n)},fM.TYPED_ARRAY_SUPPORT&&(fM.prototype.__proto__=Uint8Array.prototype,fM.__proto__=Uint8Array),fM.alloc=function(t,e,n){return function(t,e,n,r){return pM(e),e<=0?lM(t,e):void 0!==n?"string"==typeof r?lM(t,e).fill(n,r):lM(t,e).fill(n):lM(t,e)}(null,t,e,n)},fM.allocUnsafe=function(t){return dM(null,t)},fM.allocUnsafeSlow=function(t){return dM(null,t)},fM.isBuffer=function(t){return null!=t&&(!!t._isBuffer||HM(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&HM(t.slice(0,0))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t))},fM.compare=function(t,e){if(!gM(t)||!gM(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,s=0,o=Math.min(n,r);s<o;++s)if(t[s]!==e[s]){n=t[s],r=e[s];break}return n<r?-1:r<n?1:0},fM.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},fM.concat=function(t,e){if(!uM(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return fM.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=fM.allocUnsafe(e),s=0;for(n=0;n<t.length;++n){var o=t[n];if(!gM(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,s),s+=o.length}return r},fM.byteLength=bM,fM.prototype._isBuffer=!0,fM.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)vM(this,e,e+1);return this},fM.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)vM(this,e,e+3),vM(this,e+1,e+2);return this},fM.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)vM(this,e,e+7),vM(this,e+1,e+6),vM(this,e+2,e+5),vM(this,e+3,e+4);return this},fM.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?CM(this,0,t):wM.apply(this,arguments)},fM.prototype.equals=function(t){if(!gM(t))throw new TypeError("Argument must be a Buffer");return this===t||0===fM.compare(this,t)},fM.prototype.inspect=function(){var t="";return this.length>0&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(t+=" ... ")),"<Buffer "+t+">"},fM.prototype.compare=function(t,e,n,r,s){if(!gM(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===s&&(s=this.length),e<0||n>t.length||r<0||s>this.length)throw new RangeError("out of range index");if(r>=s&&e>=n)return 0;if(r>=s)return-1;if(e>=n)return 1;if(this===t)return 0;for(var o=(s>>>=0)-(r>>>=0),i=(n>>>=0)-(e>>>=0),a=Math.min(o,i),u=this.slice(r,s),c=t.slice(e,n),l=0;l<a;++l)if(u[l]!==c[l]){o=u[l],i=c[l];break}return o<i?-1:i<o?1:0},fM.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},fM.prototype.indexOf=function(t,e,n){return xM(this,t,e,n,!0)},fM.prototype.lastIndexOf=function(t,e,n){return xM(this,t,e,n,!1)},fM.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var s=this.length-e;if((void 0===n||n>s)&&(n=s),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return $M(this,t,e,n);case"utf8":case"utf-8":return EM(this,t,e,n);case"ascii":return SM(this,t,e,n);case"latin1":case"binary":return _M(this,t,e,n);case"base64":return TM(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return kM(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},fM.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function OM(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(127&t[s]);return r}function IM(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(t[s]);return r}function MM(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var s="",o=e;o<n;++o)s+=UM(t[o]);return s}function RM(t,e,n){for(var r=t.slice(e,n),s="",o=0;o<r.length;o+=2)s+=String.fromCharCode(r[o]+256*r[o+1]);return s}function DM(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function FM(t,e,n,r,s,o){if(!gM(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function LM(t,e,n,r){e<0&&(e=65535+e+1);for(var s=0,o=Math.min(t.length-n,2);s<o;++s)t[n+s]=(e&255<<8*(r?s:1-s))>>>8*(r?s:1-s)}function PM(t,e,n,r){e<0&&(e=4294967295+e+1);for(var s=0,o=Math.min(t.length-n,4);s<o;++s)t[n+s]=e>>>8*(r?s:3-s)&255}function BM(t,e,n,r,s,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function VM(t,e,n,r,s){return s||BM(t,0,n,4),iM(t,e,n,r,23,4),n+4}function zM(t,e,n,r,s){return s||BM(t,0,n,8),iM(t,e,n,r,52,8),n+8}fM.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),fM.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=fM.prototype;else{var s=e-t;n=new fM(s,void 0);for(var o=0;o<s;++o)n[o]=this[o+t]}return n},fM.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||DM(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r},fM.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||DM(t,e,this.length);for(var r=this[t+--e],s=1;e>0&&(s*=256);)r+=this[t+--e]*s;return r},fM.prototype.readUInt8=function(t,e){return e||DM(t,1,this.length),this[t]},fM.prototype.readUInt16LE=function(t,e){return e||DM(t,2,this.length),this[t]|this[t+1]<<8},fM.prototype.readUInt16BE=function(t,e){return e||DM(t,2,this.length),this[t]<<8|this[t+1]},fM.prototype.readUInt32LE=function(t,e){return e||DM(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},fM.prototype.readUInt32BE=function(t,e){return e||DM(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},fM.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||DM(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r>=(s*=128)&&(r-=Math.pow(2,8*e)),r},fM.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||DM(t,e,this.length);for(var r=e,s=1,o=this[t+--r];r>0&&(s*=256);)o+=this[t+--r]*s;return o>=(s*=128)&&(o-=Math.pow(2,8*e)),o},fM.prototype.readInt8=function(t,e){return e||DM(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},fM.prototype.readInt16LE=function(t,e){e||DM(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},fM.prototype.readInt16BE=function(t,e){e||DM(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},fM.prototype.readInt32LE=function(t,e){return e||DM(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},fM.prototype.readInt32BE=function(t,e){return e||DM(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},fM.prototype.readFloatLE=function(t,e){return e||DM(t,4,this.length),oM(this,t,!0,23,4)},fM.prototype.readFloatBE=function(t,e){return e||DM(t,4,this.length),oM(this,t,!1,23,4)},fM.prototype.readDoubleLE=function(t,e){return e||DM(t,8,this.length),oM(this,t,!0,52,8)},fM.prototype.readDoubleBE=function(t,e){return e||DM(t,8,this.length),oM(this,t,!1,52,8)},fM.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||FM(this,t,e,n,Math.pow(2,8*n)-1,0);var s=1,o=0;for(this[e]=255&t;++o<n&&(s*=256);)this[e+o]=t/s&255;return e+n},fM.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||FM(this,t,e,n,Math.pow(2,8*n)-1,0);var s=n-1,o=1;for(this[e+s]=255&t;--s>=0&&(o*=256);)this[e+s]=t/o&255;return e+n},fM.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||FM(this,t,e,1,255,0),fM.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},fM.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||FM(this,t,e,2,65535,0),fM.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):LM(this,t,e,!0),e+2},fM.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||FM(this,t,e,2,65535,0),fM.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):LM(this,t,e,!1),e+2},fM.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||FM(this,t,e,4,4294967295,0),fM.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):PM(this,t,e,!0),e+4},fM.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||FM(this,t,e,4,4294967295,0),fM.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):PM(this,t,e,!1),e+4},fM.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);FM(this,t,e,n,s-1,-s)}var o=0,i=1,a=0;for(this[e]=255&t;++o<n&&(i*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},fM.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);FM(this,t,e,n,s-1,-s)}var o=n-1,i=1,a=0;for(this[e+o]=255&t;--o>=0&&(i*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},fM.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||FM(this,t,e,1,127,-128),fM.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},fM.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||FM(this,t,e,2,32767,-32768),fM.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):LM(this,t,e,!0),e+2},fM.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||FM(this,t,e,2,32767,-32768),fM.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):LM(this,t,e,!1),e+2},fM.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||FM(this,t,e,4,2147483647,-2147483648),fM.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):PM(this,t,e,!0),e+4},fM.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||FM(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),fM.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):PM(this,t,e,!1),e+4},fM.prototype.writeFloatLE=function(t,e,n){return VM(this,t,e,!0,n)},fM.prototype.writeFloatBE=function(t,e,n){return VM(this,t,e,!1,n)},fM.prototype.writeDoubleLE=function(t,e,n){return zM(this,t,e,!0,n)},fM.prototype.writeDoubleBE=function(t,e,n){return zM(this,t,e,!1,n)},fM.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var s,o=r-n;if(this===t&&n<e&&e<r)for(s=o-1;s>=0;--s)t[s+e]=this[s+n];else if(o<1e3||!fM.TYPED_ARRAY_SUPPORT)for(s=0;s<o;++s)t[s+e]=this[s+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},fM.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var s=t.charCodeAt(0);s<256&&(t=s)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!fM.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var i=gM(t)?t:jM(new fM(t,r).toString()),a=i.length;for(o=0;o<n-e;++o)this[o+e]=i[o%a]}return this};var WM=/[^+\/0-9A-Za-z-_]/g;function UM(t){return t<16?"0"+t.toString(16):t.toString(16)}function jM(t,e){var n;e=e||1/0;for(var r=t.length,s=null,o=[],i=0;i<r;++i){if((n=t.charCodeAt(i))>55295&&n<57344){if(!s){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(i+1===r){(e-=3)>-1&&o.push(239,191,189);continue}s=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),s=n;continue}n=65536+(s-55296<<10|n-56320)}else s&&(e-=3)>-1&&o.push(239,191,189);if(s=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function GM(t){return function(t){var e,n,r,s,o,i;eM||nM();var a=t.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===t[a-2]?2:"="===t[a-1]?1:0,i=new tM(3*a/4-o),r=o>0?a-4:a;var u=0;for(e=0,n=0;e<r;e+=4,n+=3)s=QI[t.charCodeAt(e)]<<18|QI[t.charCodeAt(e+1)]<<12|QI[t.charCodeAt(e+2)]<<6|QI[t.charCodeAt(e+3)],i[u++]=s>>16&255,i[u++]=s>>8&255,i[u++]=255&s;return 2===o?(s=QI[t.charCodeAt(e)]<<2|QI[t.charCodeAt(e+1)]>>4,i[u++]=255&s):1===o&&(s=QI[t.charCodeAt(e)]<<10|QI[t.charCodeAt(e+1)]<<4|QI[t.charCodeAt(e+2)]>>2,i[u++]=s>>8&255,i[u++]=255&s),i}(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(WM,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function qM(t,e,n,r){for(var s=0;s<r&&!(s+n>=e.length||s>=t.length);++s)e[s+n]=t[s];return s}function HM(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function KM(t,e){let n=t;if($O(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||$O(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&LO().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&XM(t,r,[]),r}function XM(t,e,n){if(n=n||[],!Array.isArray(t)&&!$O(t))return void dO(0===e.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`));dO(e.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`)),dO(t.length===e[0],(()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`));const r=e.slice(1);for(let e=0;e<t.length;++e)XM(t[e],r,n.concat(e))}function JM(t,e,n,r){if("string_or_numeric"!==t){if(null==t)throw new Error("Expected dtype cannot be null.");if("numeric"!==t&&t!==e||"numeric"===t&&"string"===e)throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}}function YM(t,e,n,r="numeric"){if(t instanceof RI)return JM(r,t.dtype,e,n),t;let s=_O(t);if("string"!==s&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),JM(r,s,e,n),null==t||!$O(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){const r=null==t?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const o=KM(t,s);$O(t)||Array.isArray(t)||(t=[t]);const i="string"!==s?vI(t,s):gO(t,[],!0);return XI.makeTensor(i,o,s)}function ZM(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map(((t,s)=>YM(t,`${e}[${s}]`,n,r)))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QM(t){const e=Object.keys(t);if(1!==e.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const s=(...t)=>{XI.startScope(n);try{const e=r(...t);return RO(e)&&console.error("Cannot return a Promise inside of tidy."),XI.endScope(e),e}catch(t){throw XI.endScope(null),t}};return Object.defineProperty(s,"name",{value:n,configurable:!0}),s}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tR=QM({complex_:function(t,e){const n=YM(t,"real","complex"),r=YM(e,"imag","complex");mO(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const s={real:n,imag:r};return XI.runKernel("Complex",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eR(t,e,n,r){if(null==r&&(r=_O(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!$O(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){MO(e);const t=bO(e),r=bO(n);dO(t===r,(()=>`Based on the provided shape, [${e}], the tensor should have ${t} values but has ${r}`));for(let t=0;t<n.length;++t){const r=n[t],s=t!==n.length-1||r!==bO(e.slice(t));dO(n[t]===e[t]||!s,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `))}}return $O(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?vI(t,r):gO(t,[],!0),XI.makeTensor(t,e,r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nR(t,e,n){return eR(t,e,KM(t,n),n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rR={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};const sR="undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa;function oR(t){return sR?fM.byteLength(t):new Blob([t]).size}function iR(t){if(1===t.length)return t[0];let e=0;t.forEach((t=>{e+=t.byteLength}));const n=new Uint8Array(e);let r=0;return t.forEach((t=>{n.set(new Uint8Array(t),r),r+=t.byteLength})),n.buffer}function aR(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:oR(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:oR(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}function uR(){const t=function(){const t=t=>{let e=t<<13,n=0;for(;0==(8388608&e);)n-=8388608,e<<=1;return e&=-8388609,n+=947912704,e|n},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}(),e=function(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}(),n=function(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}();return r=>{const s=new ArrayBuffer(4*r.length),o=new Uint32Array(s);for(let s=0;s<r.length;s++){const i=r[s],a=t[n[i>>10]+(1023&i)]+e[i>>10];o[s]=a}return new Float32Array(s)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cR{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==cR.instance&&(cR.instance=new cR),cR.instance}static registerSaveRouter(t){cR.getInstance().saveRouters.push(t)}static registerLoadRouter(t){cR.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return cR.getHandlers(t,"save")}static getLoadHandlers(t,e){return cR.getHandlers(t,"load",e)}static getHandlers(t,e,n){const r=[];return("load"===e?cR.getInstance().loadRouters:cR.getInstance().saveRouters).forEach((e=>{const s=e(t,n);null!==s&&r.push(s)})),r}}function lR(){if(!LO().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t="undefined"==typeof window?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function fR(t){const e=t.result;e.createObjectStore("models_store",{keyPath:"modelPath"}),e.createObjectStore("model_info_store",{keyPath:"modelPath"})}class hR{constructor(t){if(this.indexedDB=lR(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise(((t,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>fR(r),r.onsuccess=()=>{const s=r.result;if(null==e){const e=s.transaction("models_store","readonly"),r=e.objectStore("models_store").get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return s.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));t(r.result.modelArtifacts)},r.onerror=t=>(s.close(),n(r.error)),e.oncomplete=()=>s.close()}else{const r=aR(e),o=s.transaction("model_info_store","readwrite");let i=o.objectStore("model_info_store");const a=i.put({modelPath:this.modelPath,modelArtifactsInfo:r});let u;a.onsuccess=()=>{u=s.transaction("models_store","readwrite");const a=u.objectStore("models_store").put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:r});a.onsuccess=()=>t({modelArtifactsInfo:r}),a.onerror=t=>{i=o.objectStore("model_info_store");const e=i.delete(this.modelPath);e.onsuccess=()=>(s.close(),n(a.error)),e.onerror=t=>(s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}}},r.onerror=t=>n(r.error)}))}}hR.URL_SCHEME="indexeddb://";const pR=t=>{return LO().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(hR.URL_SCHEME)?(e=t.slice(hR.URL_SCHEME.length),new hR(e)):null;var e};cR.registerSaveRouter(pR),cR.registerLoadRouter(pR);class dR{constructor(){this.indexedDB=lR()}async listModels(){return new Promise(((t,e)=>{const n=this.indexedDB.open("tensorflowjs",1);n.onupgradeneeded=()=>fR(n),n.onsuccess=()=>{const r=n.result,s=r.transaction("model_info_store","readonly"),o=s.objectStore("model_info_store").getAll();o.onsuccess=()=>{const e={};for(const t of o.result)e[t.modelPath]=t.modelArtifactsInfo;t(e)},o.onerror=t=>(r.close(),e(o.error)),s.oncomplete=()=>r.close()},n.onerror=t=>e(n.error)}))}async removeModel(t){var e;return t=(e=t).startsWith(hR.URL_SCHEME)?e.slice(hR.URL_SCHEME.length):e,new Promise(((e,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>fR(r),r.onsuccess=()=>{const s=r.result,o=s.transaction("model_info_store","readwrite"),i=o.objectStore("model_info_store"),a=i.get(t);let u;a.onsuccess=()=>{if(null==a.result)return s.close(),n(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const r=i.delete(t),o=()=>{u=s.transaction("models_store","readwrite");const r=u.objectStore("models_store").delete(t);r.onsuccess=()=>e(a.result.modelArtifactsInfo),r.onerror=t=>n(a.error)};r.onsuccess=o,r.onerror=t=>(o(),s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}},r.onerror=t=>n(r.error)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mR="tensorflowjs_models",yR="info",gR="model_topology",bR="weight_specs",wR="weight_data",vR="model_metadata";function xR(t){return{info:[mR,t,yR].join("/"),topology:[mR,t,gR].join("/"),weightSpecs:[mR,t,bR].join("/"),weightData:[mR,t,wR].join("/"),modelMetadata:[mR,t,vR].join("/")}}function NR(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function $R(t){const e=t.split("/");if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join("/")}class ER{constructor(t){if(!LO().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=xR(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=aR(t);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(sR)return fM.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let t=0,r=e.length;t<r;t++)n+=String.fromCharCode(e[t]);return btoa(n)}(t.weightData));const s={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:r}}catch(t){throw NR(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(null==t)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=r;const s=this.LS.getItem(this.keys.modelMetadata);if(null!=s){const t=JSON.parse(s);e.format=t.format,e.generatedBy=t.generatedBy,e.convertedBy=t.convertedBy,null!=t.signature&&(e.signature=t.signature),null!=t.userDefinedMetadata&&(e.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(e.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(e.trainingConfig=t.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(null==o)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=function(t){if(sR){const e=fM.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;++t)n.set([e.charCodeAt(t)],t);return n.buffer}(o),e}}ER.URL_SCHEME="localstorage://";const SR=t=>{return LO().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(ER.URL_SCHEME)?(e=t.slice(ER.URL_SCHEME.length),new ER(e)):null;var e};cR.registerSaveRouter(SR),cR.registerLoadRouter(SR);class _R{constructor(){dO(LO().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),dO("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const t={},e=mR+"/",n="/"+yR;for(let r=0;r<this.LS.length;++r){const s=this.LS.key(r);if(s.startsWith(e)&&s.endsWith(n)){t[$R(s)]=JSON.parse(this.LS.getItem(s))}}return t}async removeModel(t){var e;const n=xR(t=(e=t).startsWith(ER.URL_SCHEME)?e.slice(ER.URL_SCHEME.length):e);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(n.info));return NR(n),r}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TR{constructor(){this.managers={}}static getInstance(){return null==TR.instance&&(TR.instance=new TR),TR.instance}static registerManager(t,e){dO(null!=t,(()=>"scheme must not be undefined or null.")),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),dO(t.length>0,(()=>"scheme must not be an empty string."));const n=TR.getInstance();dO(null==n.managers[t],(()=>`A model store manager is already registered for scheme '${t}'.`)),n.managers[t]=e}static getManager(t){const e=this.getInstance().managers[t];if(null==e)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kR{fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}}if(LO().get("IS_BROWSER")){LO().setPlatform("browser",new kR);try{TR.registerManager(ER.URL_SCHEME,new _R)}catch(t){}try{TR.registerManager(hR.URL_SCHEME,new dR)}catch(t){}}const AR=()=>require("node-fetch");let CR;class OR{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return null!=LO().global.fetch?LO().global.fetch(t,e):(null==CR&&(CR=AR()),CR(t,e))}now(){const t=lI.hrtime();return 1e3*t[0]+t[1]/1e6}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)}}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function IR(t,e="float32",n){return e=e||"float32",MO(t),new OI(t,e,n)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */LO().get("IS_NODE")&&!LO().get("IS_BROWSER")&&LO().setPlatform("node",new OR);const MR=QM({cast_:function(t,e){const n=YM(t,"x","cast");if(!function(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},s={dtype:e};return XI.runKernel("Cast",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RR=QM({clone_:function(t){const e={x:YM(t,"x","clone","string_or_numeric")};return XI.runKernel("Identity",e)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
KI();const DR={buffer:IR,cast:MR,clone:RR,print:function(t,e=!1){console.log(t.toString(e))}};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function FR(t,e,n,r){!function(t){dO(null!=t&&Array.isArray(t)&&t.length>0,(()=>"promises must be a none empty array"))}(t),function(t,e){dO(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${t}`)),dO(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${e}`)),dO(e>=t,(()=>`startFraction must be no more than endFraction, but got startFraction ${t} and endFraction ${e}`))}(n=null==n?0:n,r=null==r?1:r);let s=0;return Promise.all(t.map((o=>(o.then((o=>{const i=n+ ++s/t.length*(r-n);return e(i),o})),o))))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */!function(t){MI=t}(DR);class LR{constructor(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,this.weightUrlConverter=e.weightUrlConverter,null!=e.fetchFunc?(dO("function"==typeof e.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=e.fetchFunc):this.fetch=LO().platform.fetch,dO(null!=t&&t.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(t)&&dO(2===t.length,(()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`)),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData;const n=function(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),n}(t,[{paths:["./model.weights.bin"],weights:t.weightSpecs}]);e.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin");const r=await this.fetch(this.path,e);if(r.ok)return{modelArtifactsInfo:aR(t),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let e;try{e=await t.json()}catch(t){let e=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=e.modelTopology,r=e.weightsManifest;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return async function(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),null!=t.weightsManifest){const[r,s]=await e(t.weightsManifest);n.weightSpecs=r,n.weightData=s}return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),n}(e,(t=>this.loadWeights(t)))}async loadWeights(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),r=t.substring(0,e),s=n>e?t.substring(n):"";return[r+"/",s]}(e),s=this.weightPathPrefix||n,o=[];for(const e of t)o.push(...e.weights);const i=[],a=[];for(const e of t)for(const t of e.paths)null!=this.weightUrlConverter?a.push(this.weightUrlConverter(t)):i.push(s+t+r);this.weightUrlConverter&&i.push(...await Promise.all(a));const u=await async function(t,e){null==e&&(e={});const n=null==e.fetchFunc?LO().platform.fetch:e.fetchFunc,r=t.map((t=>n(t,e.requestInit,{isBinary:!0}))),s=(null==e.onProgress?await Promise.all(r):await FR(r,e.onProgress,0,.5)).map((t=>t.arrayBuffer()));return null==e.onProgress?await Promise.all(s):await FR(s,e.onProgress,.5,1)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(i,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[o,iR(u)]}}function PR(t){return null!=t.match(LR.URL_SCHEME_REGEX)}LR.URL_SCHEME_REGEX=/^https?:\/\//;const BR=(t,e)=>{if("undefined"==typeof fetch&&(null==e||null==e.fetchFunc))return null;{let n=!0;if(n=Array.isArray(t)?t.every((t=>PR(t))):PR(t),n)return VR(t,e)}return null};function VR(t,e){return new LR(t,e)}function zR(t,e){return VR(t,e)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */cR.registerSaveRouter(BR),cR.registerLoadRouter(BR);const WR=QM({matMul_:function(t,e,n=!1,r=!1){let s=YM(t,"a","matMul"),o=YM(e,"b","matMul");[s,o]=WI(s,o);const i={a:s,b:o},a={transposeA:n,transposeB:r};return XI.runKernel("BatchMatMul",i,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UR=QM({oneHot_:function(t,e,n=1,r=0){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const s={indices:YM(t,"indices","oneHot","int32")},o={depth:e,onValue:n,offValue:r};return XI.runKernel("OneHot",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jR(t,e){return XI.tidy(t,e)}function GR(t){return XI.keep(t)}const qR=QM({imag_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={input:YM(t,"input","imag")};return XI.runKernel("Imag",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HR=QM({neg_:function(t){const e={x:YM(t,"x","neg")};return XI.runKernel("Neg",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KR=QM({real_:function(t){const e={input:YM(t,"input","real")};return XI.runKernel("Real",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XR=QM({transpose_:function(t,e,n){const r=YM(t,"x","transpose");if(null==e&&(e=r.shape.map(((t,e)=>e)).reverse()),dO(r.rank===e.length,(()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`)),e.forEach((t=>{dO(t>=0&&t<r.rank,(()=>"All entries in 'perm' must be between 0 and "+(r.rank-1)+` but got ${e}`))})),r.rank<=1)return r.clone();const s={x:r},o={perm:e};return"complex64"===r.dtype?jR((()=>{let t=KR(r),e=qR(r);return t=XI.runKernel("Transpose",{x:t},o),e=XI.runKernel("Transpose",{x:e},o),n&&(e=HR(e)),tR(t,e)})):XI.runKernel("Transpose",s,o)}});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JR(t,e){const n=[],r=Math.max(t.length,e.length);for(let s=0;s<r;s++){let r=t[t.length-s-1];null==r&&(r=1);let o=e[e.length-s-1];if(null==o&&(o=1),1===r)n.unshift(o);else if(1===o)n.unshift(r);else{if(r!==o){throw Error(`Operands could not be broadcast together with shapes ${t} and ${e}.`)}n.unshift(r)}}return n}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
let YR;const ZR=QM({fromPixels_:function(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,s=!1,o=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)s=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)o=!0;else if(null!=t.getContext)i=!0;else{if(!("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);a=!0}if(s){const e=2;if(s&&t.readyState<e)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=gI("FromPixels",XI.backendName)){const n={pixels:t},r={numChannels:e};return XI.runKernel("FromPixels",n,r)}const[u,c]=s?[t.videoWidth,t.videoHeight]:[t.width,t.height];let l,f;if(i)l=t.getContext("2d").getImageData(0,0,u,c).data;else if(r||n)l=t.data;else if(o||s||a){if(null==YR)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");YR=new OffscreenCanvas(1,1).getContext("2d")}else YR=document.createElement("canvas").getContext("2d");YR.canvas.width=u,YR.canvas.height=c,YR.drawImage(t,0,0,u,c),l=YR.getImageData(0,0,u,c).data}if(4===e)f=new Int32Array(l);else{const t=u*c;f=new Int32Array(t*e);for(let n=0;n<t;n++)for(let t=0;t<e;++t)f[n*e+t]=l[4*n+t]}return function(t,e,n){if(yO(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");const r=KM(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return eR(t,e,r,n)}(f,[c,u,e],"int32")}});function QR(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if("int32"!==e.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===e.size)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(0===t.size)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}!function(t,e,n){const r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${s}.`;if(n.rank<s)throw new Error(o+` update.rank < ${s}. `);if(t.length<r+(n.rank-s))throw new Error(o+` Output shape length < ${r+(n.rank-s)}`);if(n.rank!==s+t.length-r)throw new Error(o+" update.rank != "+(s+t.length-r));for(let t=0;t<s;++t)if(n.shape[t]!==e.shape[t])throw new Error(o+` updates.shape[${t}] (${n.shape[t]}) != indices.shape[${t}] (${e.shape[t]}).`);for(let e=0;e<n.rank-s;++e)if(n.shape[e+s]!==t[e+r])throw new Error(o+` updates.shape[${e+s}] (${n.shape[e+s]}) != shape[${e+s}] (${t[e+s]})`)}(n,e,t)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tD=QM({add_:function(t,e){let n=YM(t,"a","add"),r=YM(e,"b","add");[n,r]=WI(n,r);const s={a:n,b:r};return XI.runKernel("Add",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eD=QM({floorDiv_:function(t,e){let n=YM(t,"a","floorDiv"),r=YM(e,"b","floorDiv");[n,r]=WI(n,r);const s={a:n,b:r};return XI.runKernel("FloorDiv",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nD=QM({div_:function(t,e){let n=YM(t,"a","div"),r=YM(e,"b","div");if([n,r]=WI(n,r),"int32"===n.dtype&&"int32"===r.dtype)return eD(n,r);const s={a:n,b:r};return XI.runKernel("RealDiv",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rD=QM({mul_:function(t,e){let n=YM(t,"a","mul"),r=YM(e,"b","mul");[n,r]=WI(n,r);const s={a:n,b:r};return XI.runKernel("Multiply",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sD=QM({abs_:function(t){const e=YM(t,"x","abs");if("complex64"===e.dtype){const t={x:e};return XI.runKernel("ComplexAbs",t)}{const t={x:e};return XI.runKernel("Abs",t)}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oD=QM({acos_:function(t){const e={x:YM(t,"x","acos")};return XI.runKernel("Acos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iD=QM({acosh_:function(t){const e={x:YM(t,"x","acosh")};return XI.runKernel("Acosh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aD=QM({addN_:function(t){dO(Array.isArray(t),(()=>"The argument passed to tf.addN() must be a list of tensors")),dO(t.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`));const e=t.map(((t,e)=>YM(t,`tensors${e}`,"addN"))),n=e[0];e.forEach((t=>{if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((t=>{if(!wO(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const r=e;return XI.runKernel("AddN",r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uD=QM({all_:function(t,e=null,n=!1){const r={x:YM(t,"x","all","bool")},s={axis:e,keepDims:n};return XI.runKernel("All",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cD=QM({any_:function(t,e=null,n=!1){const r={x:YM(t,"x","any","bool")},s={axis:e,keepDims:n};return XI.runKernel("Any",r,s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lD=QM({argMax_:function(t,e=0){const n={x:YM(t,"x","argMax")},r={axis:e};return XI.runKernel("ArgMax",n,r)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fD=QM({argMin_:function(t,e=0){const n={x:YM(t,"x","argMin")},r={axis:e};return XI.runKernel("ArgMin",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hD=QM({asin_:function(t){const e={x:YM(t,"x","asin")};return XI.runKernel("Asin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pD=QM({asinh_:function(t){const e={x:YM(t,"x","asinh")};return XI.runKernel("Asinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dD=QM({atan_:function(t){const e={x:YM(t,"x","atan")};return XI.runKernel("Atan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mD=QM({atan2_:function(t,e){let n=YM(t,"a","atan2"),r=YM(e,"b","atan2");[n,r]=WI(n,r);const s={a:n,b:r};return XI.runKernel("Atan2",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yD=QM({atanh_:function(t){const e={x:YM(t,"x","atanh")};return XI.runKernel("Atanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gD(t,e,n,r,s,o,i=!1,a="channelsLast"){let[u,c,l,f]=[-1,-1,-1,-1];if("channelsLast"===a)[u,c,l,f]=t;else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);[u,f,c,l]=t}const[h,p,,d]=e,[m,y]=bD(n),[g,b]=bD(r),w=wD(h,g),v=wD(p,b),{padInfo:x,outHeight:N,outWidth:$}=function(t,e,n,r,s,o,i,a,u){let c,l,f;if("number"==typeof t){c={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};const s=function(t,e,n,r,s){null==r&&(r=function(t,e,n,r=1){const s=wD(e,r);return Math.floor((t[0]*(n-1)-n+s)/2)}(t,e,n));const o=t[0],i=t[1],a=vD((o-e+2*r)/n+1,s),u=vD((i-e+2*r)/n+1,s);return[a,u]}([e,n],o,r,t,a);l=s[0],f=s[1]}else if("same"===t){l=Math.ceil(e/r),f=Math.ceil(n/s);const t=Math.max(0,(l-1)*r+o-e),a=Math.max(0,(f-1)*s+i-n),u=Math.floor(t/2),h=t-u,p=Math.floor(a/2);c={top:u,bottom:h,left:p,right:a-p,type:"SAME"}}else if("valid"===t)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-o+1)/r),f=Math.ceil((n-i+1)/s);else{if("object"!=typeof t)throw Error(`Unknown padding parameter: ${t}`);{const h="channelsLast"===u?t[1][0]:t[2][0],p="channelsLast"===u?t[1][1]:t[2][1],d="channelsLast"===u?t[2][0]:t[3][0],m="channelsLast"===u?t[2][1]:t[3][1];c={top:h,bottom:p,left:d,right:m,type:0===h&&0===p&&0===d&&0===m?"VALID":"EXPLICIT"},l=vD((e-o+h+p)/r+1,a),f=vD((n-i+d+m)/s+1,a)}}return{padInfo:c,outHeight:l,outWidth:f}}(s,c,l,m,y,w,v,o,a),E=i?d*f:d;let S;return"channelsFirst"===a?S=[u,E,N,$]:"channelsLast"===a&&(S=[u,N,$,E]),{batchSize:u,dataFormat:a,inHeight:c,inWidth:l,inChannels:f,outHeight:N,outWidth:$,outChannels:E,padInfo:x,strideHeight:m,strideWidth:y,filterHeight:h,filterWidth:p,effectiveFilterHeight:w,effectiveFilterWidth:v,dilationHeight:g,dilationWidth:b,inShape:t,outShape:S,filterShape:e}}function bD(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function wD(t,e){return e<=1?t:t+(t-1)*(e-1)}function vD(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function xD(t){const[e,n,r]=bD(t);return 1===e&&1===n&&1===r}function ND(t,e){return xD(t)||xD(e)}function $D(t,e,n){if(null!=n){if("string"==typeof e)throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if("number"==typeof e)dO(vO(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`));else{if("object"!=typeof e)throw Error(`Error in ${t}: Unknown padding parameter: ${e}`);e.forEach((e=>{e.forEach((e=>{dO(vO(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`))}))}))}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ED=QM({reshape_:function(t,e){const n={x:YM(t,"x","reshape","string_or_numeric")},r={shape:e};return XI.runKernel("Reshape",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SD=QM({avgPool_:function(t,e,n,r,s){const o=YM(t,"x","avgPool","float32");dO(ND(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let i=o,a=!1;3===o.rank&&(a=!0,i=ED(o,[1,o.shape[0],o.shape[1],o.shape[2]])),dO(4===i.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${i.rank}.`)),$D("avgPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s};let l=XI.runKernel("AvgPool",u,c);return l=MR(l,o.dtype),a?ED(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _D=QM({avgPool3d_:function(t,e,n,r,s,o="NDHWC"){const i=YM(t,"x","avgPool3d","float32");let a=i,u=!1;4===i.rank&&(u=!0,a=ED(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),dO(5===a.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`)),dO("NDHWC"===o,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),$D("avgPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o};let f=XI.runKernel("AvgPool3D",c,l);return f=MR(f,a.dtype),u?ED(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TD=QM({concat_:function(t,e=0){dO(t.length>=1,(()=>"Pass at least one tensor to concat"));const n=ZM(t,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((t=>{if("complex64"!==t.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${t.dtype}. `)})),1===n.length)return RR(n[0]);const r=n,s={axis:e};return XI.runKernel("Concat",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kD=QM({sigmoid_:function(t){const e={x:YM(t,"x","sigmoid","float32")};return XI.runKernel("Sigmoid",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AD=QM({slice_:function(t,e,n){const r=YM(t,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const s={x:r},o={begin:e,size:n};return XI.runKernel("Slice",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CD=QM({tanh_:function(t){const e={x:YM(t,"x","tanh","float32")};return XI.runKernel("Tanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OD=QM({batchToSpaceND_:function(t,e,n){const r=YM(t,"x","batchToSpaceND"),s=e.reduce(((t,e)=>t*e));dO(r.rank>=1+e.length,(()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`)),dO(n.length===e.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`)),dO(r.shape[0]%s==0,(()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${s}`));const o={x:r},i={blockShape:e,crops:n};return XI.runKernel("BatchToSpaceND",o,i)}});const ID=QM({batchNorm_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s,o){null==o&&(o=.001);const i=YM(t,"x","batchNorm"),a=YM(e,"mean","batchNorm"),u=YM(n,"variance","batchNorm");let c,l;null!=s&&(c=YM(s,"scale","batchNorm")),null!=r&&(l=YM(r,"offset","batchNorm")),dO(a.rank===u.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),dO(null==l||a.rank===l.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),dO(null==c||a.rank===c.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const f=function(t){let e;return e=0===t.rank||1===t.rank?ED(t,[1,1,1,t.size]):2===t.rank?ED(t,[1,1,t.shape[0],t.shape[1]]):3===t.rank?ED(t,[1,t.shape[0],t.shape[1],t.shape[2]]):t,e}(i),h={x:f,scale:c,offset:l,mean:a,variance:u},p={varianceEpsilon:o},d=XI.runKernel("FusedBatchNorm",h,p);return ED(d,i.shape)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MD=QM({bincount_:function(t,e,n){const r=YM(t,"x","bincount"),s=YM(e,"weights","bincount");dO("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),dO(n>=0,(()=>`size must be non-negative, but got ${n}.`)),dO(s.size===r.size||0===s.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${s.shape}.`));const o={x:r,weights:s},i={size:n};return XI.runKernel("Bincount",o,i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RD=QM({broadcastArgs_:function(t,e){const n=YM(t,"s0","broadcastArgs","int32"),r=YM(e,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(1!==r.rank)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const s={s0:n,s1:r};return XI.runKernel("BroadcastArgs",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DD=QM({broadcastTo_:function(t,e){let n=YM(t,"broadcastTo","x");const r=n.shape;if(e.some((t=>!(t>0)||t%1!=0)))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const t=n.shape.slice();for(;t.length<e.length;)t.unshift(1);n=ED(n,t)}const s=n.shape,o=Array.from(e);for(let t=e.length-1;t>=0;t--)if(s[t]===e[t])o[t]=1;else if(1!==n.shape[t])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);const i=o.map(((t,e)=>t>1?e:-1)).filter((t=>t>=0));if(0===i.length)return RR(n);const a={x:n},u={reps:o};return XI.runKernel("Tile",a,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FD=QM({ceil_:function(t){const e={x:YM(t,"x","ceil","float32")};return XI.runKernel("Ceil",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LD=QM({clipByValue_:function(t,e,n){const r=YM(t,"x","clipByValue");dO(e<=n,(()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`));const s={x:r},o={clipValueMin:e,clipValueMax:n};return XI.runKernel("ClipByValue",s,o)}});const PD=QM({concat2d_:function(t,e){return TD(t,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BD=QM({conv2d_:function(t,e,n,r,s="NHWC",o=[1,1],i){const a=YM(t,"x","conv2d","float32"),u=YM(e,"filter","conv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=ED(a,[1,a.shape[0],a.shape[1],a.shape[2]])),dO(4===c.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`)),dO(4===u.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`)),$D("conv2d",r,i);const f="NHWC"===s?c.shape[3]:c.shape[1];dO(f===u.shape[2],(()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`)),dO(ND(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const h={x:c,filter:u},p={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},d=XI.runKernel("Conv2D",h,p);return l?ED(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});const VD=QM({conv1d_:function(t,e,n,r,s="NWC",o=1,i){const a=YM(t,"x","conv1d"),u=YM(e,"filter","conv1d");let c=a,l=!1;2===a.rank&&(l=!0,c=ED(a,[1,a.shape[0],a.shape[1]])),dO(3===c.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`)),dO(3===u.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`)),$D("conv1d",r,i),dO(c.shape[2]===u.shape[1],(()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`)),dO(ND(n,o),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${o}'`)),dO("NWC"===s,(()=>`Error in conv1d: got dataFormat of ${s} but only NWC is currently supported.`));const f=ED(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=ED(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=BD(h,f,[1,n],r,"NHWC",[1,o],i);return ED(p,l?[p.shape[2],p.shape[3]]:[p.shape[0],p.shape[2],p.shape[3]])}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zD=QM({conv2DBackpropInput_:function(t,e,n,r,s,o="NHWC",i){dO(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let a=t,u=e,c=!1;3===e.rank&&(c=!0,u=ED(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),dO(4===a.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`)),dO(4===u.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`)),dO(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const l="NHWC"===o?a[3]:a[1],f="NHWC"===o?u.shape[3]:u.shape[1];dO(l===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[2]}.`)),dO(f===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${n.shape[3]}.`)),$D("conv2dDerInput",s,i);const h={dy:u,filter:n},p={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,inputShape:a},d=XI.runKernel("Conv2DBackpropInput",h,p);return c?ED(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});const WD=QM({conv2dTranspose_:function(t,e,n,r,s,o){const i=YM(t,"x","conv2dTranspose"),a=YM(e,"filter","conv2dTranspose");return zD(n,i,a,r,s,"NHWC",o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UD=QM({conv3d_:function(t,e,n,r,s="NDHWC",o=[1,1,1]){const i=YM(t,"x","conv3d"),a=YM(e,"filter","conv3d");let u=i,c=!1;4===i.rank&&(c=!0,u=ED(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),dO(5===u.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`)),dO(5===a.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`)),dO(u.shape[4]===a.shape[3],(()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${a.shape[3]}.`)),dO(ND(n,o),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),dO("NDHWC"===s,(()=>`Error in conv3d: got dataFormat of ${s} but only NDHWC is currently supported.`));const l={x:u,filter:a},f={strides:n,pad:r,dataFormat:s,dilations:o},h=XI.runKernel("Conv3D",l,f);return c?ED(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jD=QM({cos_:function(t){const e={x:YM(t,"x","cos","float32")};return XI.runKernel("Cos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GD=QM({cosh_:function(t){const e={x:YM(t,"x","cosh","float32")};return XI.runKernel("Cosh",e)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qD=QM({cumprod_:function(t,e=0,n=!1,r=!1){const s={x:YM(t,"x","cumprod")},o={axis:e,exclusive:n,reverse:r};return XI.runKernel("Cumprod",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HD=QM({cumsum_:function(t,e=0,n=!1,r=!1){const s={x:YM(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:r};return XI.runKernel("Cumsum",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KD=QM({denseBincount_:function(t,e,n,r=!1){const s=YM(t,"x","denseBincount"),o=YM(e,"weights","denseBincount");dO("int32"===s.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${s.dtype}`)),dO(s.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${s.rank}.`)),dO(n>=0,(()=>`size must be non-negative, but got ${n}.`)),dO(o.size===s.size||0===o.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${s.shape}, weights shape: ${o.shape}.`));const i={x:s,weights:o},a={size:n,binaryOutput:r};return XI.runKernel("DenseBincount",i,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XD=QM({depthToSpace_:function(t,e,n="NHWC"){const r=YM(t,"x","depthToSpace","float32"),s="NHWC"===n?r.shape[1]:r.shape[2],o="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];dO(e>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`)),dO(s*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${s} and ${e}  for depthToSpace with input shape\n    ${r.shape}`)),dO(o*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${o} and ${e} for depthToSpace with input shape\n        ${r.shape}`)),dO(i%(e*e)==0,(()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${r.shape}`));const a={x:r},u={blockSize:e,dataFormat:n};return XI.runKernel("DepthToSpace",a,u)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JD=QM({depthwiseConv2d_:function(t,e,n,r,s="NHWC",o=[1,1],i){const a=YM(t,"x","depthwiseConv2d","float32"),u=YM(e,"filter","depthwiseConv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=ED(a,[1,a.shape[0],a.shape[1],a.shape[2]])),dO(4===c.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`)),dO(4===u.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`)),dO(c.shape[3]===u.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`)),$D("depthwiseConv2d",r,i);const f={x:c,filter:u},h={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},p=XI.runKernel("DepthwiseConv2dNative",f,h);return l?ED(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YD=QM({dilation2d_:function(t,e,n,r,s=[1,1],o="NHWC"){const i=YM(t,"x","dilation2d"),a=YM(e,"filter","dilation2d");dO(3===i.rank||4===i.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`)),dO(3===a.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`)),dO("NHWC"===o,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`));let u=i,c=!1;3===i.rank&&(u=ED(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=!0);const l={x:u,filter:a},f={strides:n,pad:r,dilations:s},h=XI.runKernel("Dilation2D",l,f);return c?ED(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZD=QM({equal_:function(t,e){let n=YM(t,"a","equal","string_or_numeric"),r=YM(e,"b","equal","string_or_numeric");[n,r]=WI(n,r),JR(n.shape,r.shape);const s={a:n,b:r};return XI.runKernel("Equal",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QD=QM({where_:function(t,e,n){const r=YM(e,"a","where"),s=YM(n,"b","where"),o=YM(t,"condition","where","bool"),i=JR(JR(o.shape,r.shape),s.shape),a={condition:DD(o,i),t:DD(r,i),e:DD(s,i)};return XI.runKernel("Select",a)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tF=QM({zerosLike_:function(t){const e={x:YM(t,"x","zerosLike")};return XI.runKernel("ZerosLike",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eF=QM({divNoNan_:function(t,e){let n=YM(t,"a","div"),r=YM(e,"b","div");[n,r]=WI(n,r);const s=nD(n,r),o=tF(s),i=ZD(r,o);return QD(i,o,s)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nF=QM({einsum_:function(t,...e){const n=e.map(((t,e)=>YM(t,`tensors${e}`,"einsum"))),r={equation:t};return XI.runKernel("Einsum",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rF=QM({elu_:function(t){const e={x:YM(t,"x","elu","float32")};return XI.runKernel("Elu",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sF=QM({erf_:function(t){let e=YM(t,"x","erf");dO("int32"===e.dtype||"float32"===e.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===e.dtype&&(e=MR(e,"float32"));const n={x:e};return XI.runKernel("Erf",n)}});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oF(t,e){return function(t,e,n){const r=t.length+e.length,s=[];let o=0,i=0;for(let a=0;a<r;a++)-1===n.indexOf(a)?s.push(t[o++]):s.push(e[i++]);return s}(t,e.map((t=>1)),e)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iF=QM({max_:function(t,e=null,n=!1){const r={x:YM(t,"x","max")},s={reductionIndices:e,keepDims:n};return XI.runKernel("Max",r,s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aF=QM({min_:function(t,e=null,n=!1){const r={x:YM(t,"x","min")},s={axis:e,keepDims:n};return XI.runKernel("Min",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uF=QM({pow_:function(t,e){let n=YM(t,"base","pow"),r=YM(e,"exp","pow");[n,r]=WI(n,r);const s={a:n,b:r};return XI.runKernel("Pow",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cF(t,e){if(($O(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&$O(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return eR(t,[],[],e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lF=QM({sqrt_:function(t){const e={x:YM(t,"x","sqrt","float32")};return XI.runKernel("Sqrt",e)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fF=QM({square_:function(t){const e=YM(t,"x","square");return XI.runKernel("Square",{x:e},{})}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hF=QM({sum_:function(t,e=null,n=!1){let r=YM(t,"x","sum");"bool"===r.dtype&&(r=MR(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return XI.runKernel("Sum",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pF(t,e,n=null){if(0===t.rank)return sD(t);if(1!==t.rank&&null===n)return pF(ED(t,[-1]),e,n);if(1===t.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===e)return hF(sD(t),n);if(e===1/0)return iF(sD(t),n);if(e===-1/0)return aF(sD(t),n);if("euclidean"===e||2===e)return lF(hF(uF(sD(t),cF(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&2===n.length){if(1===e)return iF(hF(sD(t),n[0]),n[1]-1);if(e===1/0)return iF(hF(sD(t),n[1]),n[0]);if(e===-1/0)return aF(hF(sD(t),n[1]),n[0]);if("fro"===e||"euclidean"===e)return lF(hF(fF(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const dF=QM({norm_:function(t,e="euclidean",n=null,r=!1){const s=pF(t=YM(t,"x","norm"),e,n);let o=s.shape;if(r){const e=NO(n,t.shape);o=oF(s.shape,e)}return ED(s,o)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mF=QM({euclideanNorm_:function(t,e=null,n=!1){return dF(t,"euclidean",e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yF=QM({exp_:function(t){const e={x:YM(t,"x","exp")};return XI.runKernel("Exp",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gF=QM({expandDims_:function(t,e=0){const n=YM(t,"x","expandDims","string_or_numeric");dO(e<=n.rank,(()=>"Axis must be <= rank of the tensor"));const r={input:n},s={dim:e};return XI.runKernel("ExpandDims",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bF=QM({expm1_:function(t){const e={x:YM(t,"x","expm1")};return XI.runKernel("Expm1",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wF=QM({tile_:function(t,e){const n=YM(t,"x","tile","string_or_numeric");dO(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`));const r={x:n},s={reps:e};return XI.runKernel("Tile",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vF=QM({eye_:function(t,e,n,r="float32"){null==e&&(e=t);const s=IR([t,e],r),o=t<=e?t:e;for(let t=0;t<o;++t)s.set(1,t,t);const i=ED(s.toTensor(),[t,e]);if(null==n)return i;if(1===n.length)return wF(gF(i,0),[n[0],1,1]);if(2===n.length)return wF(gF(gF(i,0),0),[n[0],n[1],1,1]);if(3===n.length)return wF(gF(gF(gF(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xF(t,e,n){const r={shape:t,value:e,dtype:n};return XI.runKernel("Fill",{},r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NF=QM({floor_:function(t){const e={x:YM(t,"x","floor","float32")};return XI.runKernel("Floor",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $F=QM({gather_:function(t,e,n=0,r=0){const s={x:YM(t,"x","gather"),indices:YM(e,"indices","gather","int32")},o={axis:n,batchDims:r};return XI.runKernel("GatherV2",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EF=QM({greater_:function(t,e){let n=YM(t,"a","greater","string_or_numeric"),r=YM(e,"b","greater","string_or_numeric");[n,r]=WI(n,r),JR(n.shape,r.shape);const s={a:n,b:r};return XI.runKernel("Greater",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SF=QM({greaterEqual_:function(t,e){let n=YM(t,"a","greaterEqual","string_or_numeric"),r=YM(e,"b","greaterEqual","string_or_numeric");[n,r]=WI(n,r),JR(n.shape,r.shape);const s={a:n,b:r};return XI.runKernel("GreaterEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _F=QM({isNaN_:function(t){const e={x:YM(t,"x","isNaN")};return XI.runKernel("IsNan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TF=QM({leakyRelu_:function(t,e=.2){const n={x:YM(t,"x","leakyRelu")},r={alpha:e};return XI.runKernel("LeakyRelu",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kF=QM({less_:function(t,e){let n=YM(t,"a","less","string_or_numeric"),r=YM(e,"b","less","string_or_numeric");[n,r]=WI(n,r),JR(n.shape,r.shape);const s={a:n,b:r};return XI.runKernel("Less",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AF=QM({lessEqual_:function(t,e){let n=YM(t,"a","lessEqual","string_or_numeric"),r=YM(e,"b","lessEqual","string_or_numeric");[n,r]=WI(n,r),JR(n.shape,r.shape);const s={a:n,b:r};return XI.runKernel("LessEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CF(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:t,stop:e,num:n};return XI.runKernel("LinSpace",{},r)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OF=QM({localResponseNormalization_:function(t,e=5,n=1,r=1,s=.5){const o=YM(t,"x","localResponseNormalization");dO(4===o.rank||3===o.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${o.rank}.`)),dO(vO(e),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`));let i=o,a=!1;3===o.rank&&(a=!0,i=ED(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const u={x:i},c={depthRadius:e,bias:n,alpha:r,beta:s},l=XI.runKernel("LRN",u,c);return a?ED(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IF=QM({log_:function(t){const e={x:YM(t,"x","log","float32")};return XI.runKernel("Log",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MF=QM({log1p_:function(t){const e={x:YM(t,"x","log1p")};return XI.runKernel("Log1p",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RF(t){return XI.customGrad(t)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DF=QM({softplus_:function(t){const e={x:YM(t,"x","softplus")};return XI.runKernel("Softplus",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FF=QM({sub_:function(t,e){let n=YM(t,"a","sub"),r=YM(e,"b","sub");[n,r]=WI(n,r);const s={a:n,b:r};return XI.runKernel("Sub",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LF=QM({logSoftmax_:function(t,e=-1){const n=YM(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);const r=RF(((t,n)=>{const r=iF(t,e,!0),s=FF(t,r),o=FF(MR(s,"float32"),IF(hF(yF(s),e,!0)));n([o]);return{value:o,gradFunc:(t,n)=>{const[r]=n,s=yF(r);return FF(t,rD(hF(t,e,!0),s))}}}));return r(n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PF=QM({logSumExp_:function(t,e=null,n=!1){const r=YM(t,"x","logSumExp"),s=NO(e,r.shape),o=iF(r,s,!0),i=FF(r,o),a=yF(i),u=hF(a,s),c=IF(u),l=tD(ED(o,c.shape),c);if(n){const t=oF(l.shape,s);return ED(l,t)}return l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BF=QM({logicalAnd_:function(t,e){const n=YM(t,"a","logicalAnd","bool"),r=YM(e,"b","logicalAnd","bool");JR(n.shape,r.shape);const s={a:n,b:r};return XI.runKernel("LogicalAnd",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VF=QM({logicalNot_:function(t){const e={x:YM(t,"x","logicalNot","bool")};return XI.runKernel("LogicalNot",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zF=QM({logicalOr_:function(t,e){const n=YM(t,"a","logicalOr","bool"),r=YM(e,"b","logicalOr","bool");JR(n.shape,r.shape);const s={a:n,b:r};return XI.runKernel("LogicalOr",s)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WF=QM({searchSorted_:function(t,e,n="left"){const r=YM(t,"sortedSequence","searchSorted"),s=YM(e,"values","searchSorted"),o=r.shape[r.shape.length-1],i=s.shape[s.shape.length-1],a=ED(r,[-1,o]),u=ED(s,[-1,i]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(bO(u.shape)>=2147483648)throw new Error("values tensor size must less than 2147483648");if(a.shape[1]>=2147483648)throw new Error(`trailing dim_size must less than 2147483648 for int32 output type, was ${a.shape[1]}`);const c={sortedSequence:a,values:u},l={side:n};return XI.runKernel("SearchSorted",c,l)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UF(t,e){return WF(t,e,"left")}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jF=QM({maxPool_:function(t,e,n,r,s){const o=YM(t,"x","maxPool");let i=o,a=!1;3===o.rank&&(a=!0,i=ED(o,[1,o.shape[0],o.shape[1],o.shape[2]])),dO(4===i.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${i.rank}.`)),dO(ND(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),$D("maxPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s},l=XI.runKernel("MaxPool",u,c);return a?ED(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GF=QM({maxPool3d_:function(t,e=[1,1,1],n,r,s,o="NDHWC"){const i=YM(t,"x","maxPool3d");let a=i,u=!1;4===i.rank&&(u=!0,a=ED(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),dO(5===a.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`)),dO("NDHWC"===o,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),$D("maxPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o},f=XI.runKernel("MaxPool3D",c,l);return u?ED(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qF=QM({maxPoolWithArgmax_:function(t,e,n,r,s=!1){const o={x:YM(t,"x","maxPoolWithArgmax")},i={filterSize:e,strides:n,pad:r,includeBatchInIndex:s},a=XI.runKernel("MaxPoolWithArgmax",o,i);return{result:a[0],indexes:a[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HF=QM({maximum_:function(t,e){let n=YM(t,"a","maximum"),r=YM(e,"b","maximum");[n,r]=WI(n,r),"bool"===n.dtype&&(n=MR(n,"int32"),r=MR(r,"int32")),JR(n.shape,r.shape);const s={a:n,b:r};return XI.runKernel("Maximum",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KF=QM({mean_:function(t,e=null,n=!1){const r={x:YM(t,"x","mean")},s={axis:e,keepDims:n};return XI.runKernel("Mean",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XF(t,e="float32"){if("complex64"===e){const e=XF(t,"float32"),n=XF(t,"float32");return tR(e,n)}const n=IO(bO(t),e);return XI.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JF(t,e="float32"){if("complex64"===e){const e=JF(t,"float32"),n=XF(t,"float32");return tR(e,n)}const n=OO(bO(t),e);return XI.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YF=QM({minimum_:function(t,e){let n=YM(t,"a","minimum"),r=YM(e,"b","minimum");[n,r]=WI(n,r),"bool"===n.dtype&&(n=MR(n,"int32"),r=MR(r,"int32")),JR(n.shape,r.shape);const s={a:n,b:r};return XI.runKernel("Minimum",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZF=QM({mirrorPad_:function(t,e,n){dO("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const r=YM(t,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");dO(e.length===r.rank,(()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`));const s="reflect"===n?1:0;for(let t=0;t<r.rank;t++)dO(2===e[t].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),dO(e[t][0]>=0&&e[t][0]<=r.shape[t]-s&&e[t][1]>=0&&e[t][1]<=r.shape[t]-s,(()=>`Padding in dimension ${t} cannot be greater than or equal to ${r.shape[t]-s} or less than 0 for input of shape ${r.shape}`));const o={paddings:e,mode:n},i={x:r};return XI.runKernel("MirrorPad",i,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QF=QM({mod_:function(t,e){let n=YM(t,"a","mod"),r=YM(e,"b","mod");[n,r]=WI(n,r);const s={a:n,b:r};return XI.runKernel("Mod",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tL=QM({multinomial_:function(t,e,n,r=!1){const s=YM(t,"logits","multinomial"),o=s.size,i=s.rank;if(o<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${o}.`);if(i>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${i}`);n=n||Math.random();const a={logits:1===i?ED(s,[1,-1]):s},u={numSamples:e,seed:n,normalized:r},c=XI.runKernel("Multinomial",a,u);return 1===i?ED(c,[c.size]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eL=QM({notEqual_:function(t,e){let n=YM(t,"a","notEqual","string_or_numeric"),r=YM(e,"b","notEqual","string_or_numeric");[n,r]=WI(n,r),JR(n.shape,r.shape);const s={a:n,b:r};return XI.runKernel("NotEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nL=QM({onesLike_:function(t){const e={x:YM(t,"x","onesLike")};return XI.runKernel("OnesLike",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rL=QM({pad_:function(t,e,n=0){const r=YM(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:n},o={x:r};return XI.runKernel("PadV2",o,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sL=QM({spaceToBatchND_:function(t,e,n){const r=YM(t,"x","spaceToBatchND");dO(r.rank>=1+e.length,(()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`)),dO(n.length===e.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`)),dO(r.shape.reduce(((t,r,s)=>s>0&&s<=e.length?t&&(r+n[s-1][0]+n[s-1][1])%e[s-1]==0:t),!0),(()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`));const s={x:r},o={blockShape:e,paddings:n};return XI.runKernel("SpaceToBatchND",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oL=QM({prelu_:function(t,e){const n={x:YM(t,"x","prelu"),alpha:YM(e,"alpha","prelu")};return XI.runKernel("Prelu",n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iL=QM({prod_:function(t,e=null,n=!1){let r=YM(t,"x","prod");"bool"===r.dtype&&(r=MR(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return XI.runKernel("Prod",s,o)}});var aL={exports:{}};!function(t,e,n){function r(t){var e=this,n=function(){var t=4022871197,e=function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)};return e}();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}function s(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var n=new r(t),o=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.alea=o}(0,aL,!1);var uL={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor128=o}(0,uL,!1);var cL={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorwow=o}(0,cL,!1);var lL={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,s=e.i;return t=r[s],n=(t^=t>>>7)^t<<24,n^=(t=r[s+1&7])^t>>>10,n^=(t=r[s+3&7])^t>>>3,n^=(t=r[s+4&7])^t<<7,t=r[s+7&7],n^=(t^=t<<13)^t<<9,r[s]=n,e.i=s+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function s(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.x&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorshift7=o}(0,lL,!1);var fL={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,s=e.X,o=e.i;return e.w=r=r+1640531527|0,n=s[o+34&127],t=s[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=s[o]=n^t,e.i=o,n+(r^r>>>16)|0},function(t,e){var n,r,s,o,i,a=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),s=0,o=-32;o<u;++o)e&&(r^=e.charCodeAt((o+32)%e.length)),0===o&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(i=i+1640531527|0,s=0==(n=a[127&o]^=r+i)?s+1:0);for(s>=128&&(a[127&(e&&e.length||0)]=-1),s=127,o=512;o>0;--o)r=a[s+34&127],n=a[s=s+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,a[s]=r^n;t.w=i,t.X=a,t.i=s}(e,t)}function s(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.X&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor4096=o}(0,fL,!1);var hL={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,s=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^s,s=s-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^s,e.a=s-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.tychei=o}(0,hL,!1);var pL={exports:{}};!function(t){!function(e,n){var r,s=this,o=256,i=n.pow(o,6),a=n.pow(2,52),u=2*a,c=255;function l(t,c,l){var y=[],g=d(p((c=1==c?{entropy:!0}:c||{}).entropy?[t,m(e)]:null==t?function(){try{var t;return r&&(t=r.randomBytes)?t=t(o):(t=new Uint8Array(o),(s.crypto||s.msCrypto).getRandomValues(t)),m(t)}catch(t){var n=s.navigator,i=n&&n.plugins;return[+new Date,s,i,s.screen,m(e)]}}():t,3),y),b=new f(y),w=function(){for(var t=b.g(6),e=i,n=0;t<a;)t=(t+n)*o,e*=o,n=b.g(1);for(;t>=u;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,d(m(b.S),e),(c.pass||l||function(t,e,r,s){return s&&(s.S&&h(s,b),t.state=function(){return h(b,{})}),r?(n.random=t,e):t})(w,g,"global"in c?c.global:this==n,c.state)}function f(t){var e,n=t.length,r=this,s=0,i=r.i=r.j=0,a=r.S=[];for(n||(t=[n++]);s<o;)a[s]=s++;for(s=0;s<o;s++)a[s]=a[i=c&i+t[s%n]+(e=a[s])],a[i]=e;(r.g=function(t){for(var e,n=0,s=r.i,i=r.j,a=r.S;t--;)e=a[s=c&s+1],n=n*o+a[c&(a[s]=a[i=c&i+e])+(a[i]=e)];return r.i=s,r.j=i,n})(o)}function h(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function p(t,e){var n,r=[],s=typeof t;if(e&&"object"==s)for(n in t)try{r.push(p(t[n],e-1))}catch(t){}return r.length?r:"string"==s?t:t+"\0"}function d(t,e){for(var n,r=t+"",s=0;s<r.length;)e[c&s]=c&(n^=19*e[c&s])+r.charCodeAt(s++);return m(e)}function m(t){return String.fromCharCode.apply(0,t)}if(n.seedrandom=l,d(n.random(),e),t.exports){t.exports=l;try{r=require("crypto")}catch(t){}}}([],Math)}(pL);var dL=aL.exports,mL=uL.exports,yL=cL.exports,gL=lL.exports,bL=fL.exports,wL=hL.exports,vL=pL.exports;vL.alea=dL,vL.xor128=mL,vL.xorwow=yL,vL.xorshift7=gL,vL.xor4096=bL,vL.tychei=wL;var xL=vL;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NL{constructor(t,e,n,r,s){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const o=s||Math.random();this.random=xL.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const t=this.nextVal;return this.nextVal=NaN,t}let t,e,n=!1;for(;!n;){let r,s,o;do{r=2*this.random()-1,s=2*this.random()-1,o=r*r+s*s}while(o>=1||0===o);const i=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*r*i,e=this.mean+this.stdDev*s*i,this.truncated&&!this.isValidTruncated(t)||(n=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class $L{constructor(t=0,e=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=xL.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EL=QM({randomUniform_:function(t,e=0,n=1,r="float32",s){const o=IR(t,r),i=new $L(e,n,null,s);for(let t=0;t<o.values.length;t++)o.values[t]=i.nextValue();return o.toTensor()}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SL(t,e,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");const s={start:t,stop:e,step:n,dtype:r};return XI.runKernel("Range",{},s)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _L=QM({reciprocal_:function(t){const e={x:YM(t,"x","reciprocal")};return XI.runKernel("Reciprocal",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TL=QM({relu_:function(t){const e={x:YM(t,"x","relu")};return XI.runKernel("Relu",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kL=QM({relu6_:function(t){const e={x:YM(t,"x","relu6")};return XI.runKernel("Relu6",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AL=QM({reverse_:function(t,e){const n={x:YM(t,"x","reverse")},r={dims:e};return XI.runKernel("Reverse",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CL=QM({round_:function(t){const e={x:YM(t,"x","round")};return XI.runKernel("Round",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OL=QM({rsqrt_:function(t){const e={x:YM(t,"x","rsqrt","float32")};return XI.runKernel("Rsqrt",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IL=QM({selu_:function(t){const e={x:YM(t,"x","selu")};return XI.runKernel("Selu",e)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ML=async function(t,e){const n=YM(t,"x","setdiff1d"),r=YM(e,"y","setdiff1d");dO(n.dtype===r.dtype,(()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`)),dO(1===n.rank,(()=>`x should be 1D tensor, but got x (${n.shape}).`)),dO(1===r.rank,(()=>`y should be 1D tensor, but got y (${r.shape}).`));const s=await n.data(),o=await r.data(),i=new Set(o);let a=0;for(let t=0;t<s.length;t++)i.has(s[t])||a++;const u=new OI([a],n.dtype),c=new OI([a],"int32");for(let t=0,e=0;t<s.length;t++)i.has(s[t])||(u.values[e]=s[t],c.values[e]=t,e++);return[u.toTensor(),c.toTensor()]};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RL=QM({sign_:function(t){const e={x:YM(t,"x","sign")};return XI.runKernel("Sign",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DL=QM({sin_:function(t){const e={x:YM(t,"x","sin","float32")};return XI.runKernel("Sin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FL=QM({sinh_:function(t){const e={x:YM(t,"x","sinh")};return XI.runKernel("Sinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LL=QM({softmax_:function(t,e=-1){const n=YM(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const r={logits:n},s={dim:e};return XI.runKernel("Softmax",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PL=QM({fft_:function(t){dO("complex64"===t.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`));const e={input:t};return XI.runKernel("FFT",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BL=QM({ifft_:function(t){dO("complex64"===t.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`));const e={input:t};return XI.runKernel("IFFT",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VL=QM({irfft_:function(t){const e=t.shape[t.shape.length-1],n=t.size/e;let r;if(e<=2){const s=ED(t,[n,e]);r=BL(s)}else{const s=[n,2*(e-1)],o=ED(KR(t),[n,e]),i=ED(qR(t),[n,e]),a=AL(AD(o,[0,1],[n,e-2]),1),u=rD(AL(AD(i,[0,1],[n,e-2]),1),cF(-1)),c=TD([o,a],1),l=TD([i,u],1),f=ED(tR(c,l),[s[0],s[1]]);r=BL(f)}if(r=KR(r),3===t.rank&&0!==t.shape[0]){const e=r,n=t.shape[0];r=ED(r,[n,r.shape[0]/n,r.shape[1]]),e.dispose()}return r}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zL=QM({split_:function(t,e,n=0){const r={x:YM(t,"x","split")},s={numOrSizeSplits:e,axis:n};return XI.runKernel("SplitV",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WL=QM({rfft_:function(t,e){dO("float32"===t.dtype,(()=>`The dtype for rfft() must be real value but got ${t.dtype}`));let n=t.shape[t.shape.length-1];const r=t.size/n;let s;if(null!=e&&e<n){const r=t.shape.map((t=>0)),o=t.shape.map((t=>t));o[t.shape.length-1]=e,s=AD(t,r,o),n=e}else if(null!=e&&e>n){const r=t.shape.map((t=>t));r[t.shape.length-1]=e-n,s=TD([t,XF(r)],t.shape.length-1),n=e}else s=t;const o=tF(s),i=ED(tR(s,o),[r,n]),a=PL(i),u=Math.floor(n/2)+1,c=KR(a),l=qR(a),f=zL(c,[u,n-u],c.shape.length-1),h=zL(l,[u,n-u],l.shape.length-1),p=s.shape.slice();return p[s.shape.length-1]=u,ED(tR(f[0],h[0]),p)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UL=QM({squaredDifference_:function(t,e){let n=YM(t,"a","squaredDifference"),r=YM(e,"b","squaredDifference");[n,r]=WI(n,r),JR(n.shape,r.shape);const s={a:n,b:r};return XI.runKernel("SquaredDifference",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jL=QM({squeeze_:function(t,e){const n=YM(t,"x","squeeze");return ED(n,function(t,e){const n=[],r=[],s=null!=e&&Array.isArray(e)&&0===e.length,o=null==e||s?null:NO(e,t).sort();let i=0;for(let e=0;e<t.length;++e){if(null!=o){if(o[i]===e&&1!==t[e])throw new Error(`Can't squeeze axis ${e} since its dim '${t[e]}' is not 1`);(null==o[i]||o[i]>e)&&1===t[e]&&(n.push(t[e]),r.push(e)),o[i]<=e&&i++}1!==t[e]&&(n.push(t[e]),r.push(e))}return{newShape:n,keptDims:r}}(n.shape,e).newShape)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GL=QM({stack_:function(t,e=0){const n=ZM(t,"tensors","stack","string_or_numeric");dO(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&dO(e<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const r=n,s={axis:e};return XI.runKernel("Pack",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qL=QM({step_:function(t,e=0){const n={x:YM(t,"x","step")},r={alpha:e};return XI.runKernel("Step",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HL=QM({stridedSlice_:function(t,e,n,r,s=0,o=0,i=0,a=0,u=0){const c={x:YM(t,"x","stridedSlice","string_or_numeric")},l={begin:e,end:n,strides:r,beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};return XI.runKernel("StridedSlice",c,l)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KL=QM({tan_:function(t){const e={x:YM(t,"x","tan","float32")};return XI.runKernel("Tan",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XL(t,e){yO(t);const n=KM(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return eR(t,null,n,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JL(t,e,n){if(yO(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");const r=KM(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return eR(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YL=QM({topk_:function(t,e=1,n=!0){const r=YM(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const s=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const o={x:r},i={k:e,sorted:n},[a,u]=XI.runKernel("TopK",o,i);return{values:a,indices:u}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZL=QM({truncatedNormal_:function(t,e=0,n=1,r,s){if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const o=new NL(e,n,r,!0,s),i=IR(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QL=QM({unique_:function(t,e=0){const n=YM(t,"x","unique","string_or_numeric");dO(n.rank>0,(()=>"The input tensor must be at least 1D"));const r={x:n},s={axis:e},[o,i]=XI.runKernel("Unique",r,s);return{values:o,indices:i}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tP=QM({unstack_:function(t,e=0){const n=YM(t,"x","unstack","string_or_numeric");dO(e>=-n.shape.length&&e<n.shape.length,(()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`));const r={value:n},s={axis:e};return XI.runKernel("Unpack",r,s)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eP(t,e){return WF(t,e,"right")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nP=
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
async function(t){const e=YM(t,"condition","whereAsync","bool"),n=await e.data(),r=function(t,e){const n=[];for(let t=0;t<e.length;t++)e[t]&&n.push(t);const r=IR(t,"int32"),s=IR([n.length,t.length],"int32");for(let e=0;e<n.length;e++){const o=r.indexToLoc(n[e]),i=e*t.length;s.values.set(o,i)}return s.toTensor()}(e.shape,n);return t!==e&&e.dispose(),r};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rP=QM({scatterND_:function(t,e,n){const r=YM(t,"indices","scatterND","int32"),s=YM(e,"updates","scatterND");QR(s,r,n);const o={indices:r,updates:s},i={shape:n};return XI.runKernel("ScatterNd",o,i)}});const sP=QM({sparseToDense_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=0){const s=YM(t,"sparseIndices","sparseToDense","int32"),o=YM(e,"sparseValues","sparseToDense","string_or_numeric"),i=YM(r,"defaultValue","sparseToDense",o.dtype);!function(t,e,n,r){if("int32"!==t.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const s=t.rank>0?t.shape[0]:1,o=t.rank>1?t.shape[1]:1;if(n.length!==o)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${o}.`);const i=e.size;if(0!==e.rank&&(1!==e.rank||i!==s))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${s}]`);if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(s,o,n,i);const a={sparseIndices:s,sparseValues:o,defaultValue:i},u={outputShape:n};return XI.runKernel("SparseToDense",a,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oP=QM({gatherND_:function(t,e){const n=YM(e,"indices","gatherND","int32"),r={params:YM(t,"x","gatherND","string_or_numeric"),indices:n};return XI.runKernel("GatherNd",r)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iP(t,e,n){const r=1-t%2,s=new Float32Array(t);for(let o=0;o<t;++o){const i=2*Math.PI*o/(t+r-1);s[o]=e-n*Math.cos(i)}return XL(s,"float32")}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aP=QM({conv2DBackpropFilter_:function(t,e,n,r,s,o="NHWC",i){let a=t;3===t.rank&&(a=ED(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=ED(e,[1,e.shape[0],e.shape[1],e.shape[2]])),dO(4===a.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`)),dO(4===u.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`)),dO(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const c="NHWC"===o?a.shape[3]:a.shape[1],l="NHWC"===o?u.shape[3]:u.shape[1];dO(c===n[2],(()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`)),dO(l===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${l}) must match output depth for filter (${n[3]}).`)),$D("conv2dDerFilter",s,i);const f={x:a,dy:u},h={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,filterShape:n};return XI.runKernel("Conv2DBackpropFilter",f,h)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uP(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return rD(t,qL(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function cP(t,e){let n=e;const r=function(t,e){const n=[];for(let r=0;r<e.length;r++){const s=t[t.length-r-1],o=e.length-r-1,i=e[o];(null==s||1===s&&i>1)&&n.unshift(o)}return n}(t.shape,e.shape);return r.length>0&&(n=hF(n,r)),ED(n,t.shape)}function lP(t,e,n,r){if("linear"===e)return t;if("relu"===e)return TL(t);if("elu"===e)return rF(t);if("relu6"===e)return kL(t);if("prelu"===e)return oL(t,n);if("leakyrelu"===e)return TF(t,r);if("sigmoid"===e)return kD(t);throw new Error(`Unknown fused activation ${e}.`)}const fP=(t,e)=>!(t>0)||"linear"===e;
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hP=QM({fusedConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(u=u||"linear",!1===fP(XI.state.gradientDepth,u)){dO("NHWC"===s,(()=>`Error in fused conv2d: got dataFormat of ${s} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`));let f=BD(t,e,n,r,s,o,i);return null!=a&&(f=tD(f,a)),lP(f,u,c,l)}const f=YM(t,"x","conv2d","float32"),h=YM(e,"filter","conv2d","float32");let p=f,d=!1;3===f.rank&&(d=!0,p=ED(f,[1,f.shape[0],f.shape[1],f.shape[2]])),dO(4===p.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`)),dO(4===h.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`)),$D("fused conv2d",r,i);const m="NHWC"===s?p.shape[3]:p.shape[1];dO(h.shape[2]===m,(()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${h.shape[2]}.`)),dO(ND(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const y=gD(p.shape,h.shape,n,o,r,i);let g,b;if(null!=a&&(g=YM(a,"bias","fused conv2d"),[g]=WI(g,f),"NHWC"===s?JR(y.outShape,g.shape):(dO(g.shape.length<=1,(()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${g.shape.length}.`)),dO(0===g.shape.length||g.shape[0]===y.outChannels||1===g.shape[0],(()=>`Error in fused conv2d: bias shape (${g.shape}) is not compatible with the number of output channels (${y.outChannels})`)))),null!=c){const t=c.shape;if(dO(t.length<=1||3===t.length,(()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${t.length}.`)),1===t.length)dO(1===t[0]||t[0]===y.outChannels,(()=>`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the number of output channels (${y.outChannels}).`));else if(3===t.length)try{JR(t,y.outShape)}catch(e){const n=`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the output shape of the conv2d (${y.outShape}).`;throw Error(n)}b=YM(c,"prelu weights","fused conv2d")}const w=(t,e)=>{dO("NHWC"===s,(()=>`Error in gradient of fused conv2D: got dataFormat of ${s} but only NHWC is currently supported.`));const[i,a,c,l]=e,f=uP(t,c,u);dO(xD(o),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`));const h=[zD(a.shape,f,i,n,r),aP(a,f,i.shape,n,r)];if(null!=l){const t=cP(l,f);h.push(t)}return h},v={x:p,filter:h,bias:g,preluActivationWeights:b},x={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=RF(((t,e,n)=>{let r=XI.runKernel("FusedConv2D",v,x);return n([e,t,r]),d&&(r=ED(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:w}}));return t(p,h)}{const t=RF(((t,e,n,r)=>{let s=XI.runKernel("FusedConv2D",v,x);return r([e,t,s,n]),d&&(s=ED(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:w}}));return t(p,h,g)}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pP=QM({depthwiseConv2dNativeBackpropFilter_:function(t,e,n,r,s,o=[1,1],i){let a=t;3===t.rank&&(a=ED(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=ED(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:u},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,filterShape:n};return XI.runKernel("DepthwiseConv2dNativeBackpropFilter",c,l)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dP=QM({depthwiseConv2dNativeBackpropInput_:function(t,e,n,r,s,o=[1,1],i){let a=e,u=!1;3===e.rank&&(u=!0,a=ED(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,inputShape:t},f=XI.runKernel("DepthwiseConv2dNativeBackpropInput",c,l);return u?ED(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mP=QM({fusedDepthwiseConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(!1===fP(XI.state.gradientDepth,u)){let f=JD(t,e,n,r,s,o,i);return null!=a&&(f=tD(f,a)),lP(f,u,c,l)}const f=YM(t,"x","depthwiseConv2d","float32"),h=YM(e,"filter","depthwiseConv2d","float32");let p=f,d=!1;3===f.rank&&(d=!0,p=ED(f,[1,f.shape[0],f.shape[1],f.shape[2]])),dO(4===p.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`)),dO(4===h.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`)),dO(p.shape[3]===h.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${p.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`)),null==o&&(o=[1,1]),dO(ND(n,o),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),$D("fused depthwiseConv2d",r,i);const m=gD(p.shape,h.shape,n,o,r,i,!0);let y,g;null!=a&&(y=YM(a,"bias","fused conv2d"),[y]=WI(y,f),JR(m.outShape,y.shape)),null!=c&&(g=YM(c,"prelu weights","fused depthwiseConv2d"));const b=(t,e)=>{dO(xD(o),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`));const[s,a,c,l]=e,f=uP(t,c,u),h=dP(a.shape,f,s,n,r,o,i),p=pP(a,f,s.shape,n,r,o,i);if(null!=l){return[h,p,cP(y,f)]}return[h,p]},w={x:p,filter:h,bias:y,preluActivationWeights:g},v={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=RF(((t,e,n)=>{let r=XI.runKernel("FusedDepthwiseConv2D",w,v);return n([e,t,r]),d&&(r=ED(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}}));return t(p,h)}{const t=RF(((t,e,n,r)=>{let s=XI.runKernel("FusedDepthwiseConv2D",w,v);return r([e,t,s,n]),d&&(s=ED(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:b}}));return t(p,h,y)}}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yP=QM({fusedMatMul_:function({a:t,b:e,transposeA:n=!1,transposeB:r=!1,bias:s,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a}){if(!1===fP(XI.state.gradientDepth,o)){let u=WR(t,e,n,r);return null!=s&&(u=tD(u,s)),lP(u,o,i,a)}let u=YM(t,"a","fused matMul"),c=YM(e,"b","fused matMul");[u,c]=WI(u,c);const l=n?u.shape[u.rank-2]:u.shape[u.rank-1],f=r?c.shape[c.rank-1]:c.shape[c.rank-2],h=n?u.shape[u.rank-1]:u.shape[u.rank-2],p=r?c.shape[c.rank-2]:c.shape[c.rank-1],d=u.shape.slice(0,-2),m=c.shape.slice(0,-2),y=bO(d),g=bO(m);dO(l===f,(()=>`Error in fused matMul: inner shapes (${l}) and (${f}) of Tensors with shapes ${u.shape} and ${c.shape} and transposeA=${n} and transposeB=${r} must match.`));const b=JR(u.shape.slice(0,-2),c.shape.slice(0,-2)).concat([h,p]),w=ED(u,n?[y,l,h]:[y,h,l]),v=ED(c,r?[g,p,f]:[g,f,p]);let x,N;null!=s&&(x=YM(s,"bias","fused matMul"),[x]=WI(x,u),JR(b,x.shape)),null!=i&&(N=YM(i,"prelu weights","fused matMul"));const $=(t,e)=>{const[i,a,u,c]=e,l=uP(ED(t,u.shape),u,o);let f,h;if(n||r?!n&&r?(f=WR(l,a,!1,!1),h=WR(l,i,!0,!1)):n&&!r?(f=WR(a,l,!1,!0),h=WR(i,l,!1,!1)):(f=WR(a,l,!0,!0),h=WR(l,i,!0,!0)):(f=WR(l,a,!1,!0),h=WR(i,l,!0,!1)),null!=s){return[f,h,cP(c,l)]}return[f,h]},E={a:w,b:v,bias:x,preluActivationWeights:N},S={transposeA:n,transposeB:r,activation:o,leakyreluAlpha:a};if(null==s){const t=RF(((t,e,n)=>{const r=XI.runKernel("_FusedMatMul",E,S);return n([t,e,r]),{value:ED(r,b),gradFunc:$}}));return t(w,v)}{const t=RF(((t,e,n,r)=>{const s=XI.runKernel("_FusedMatMul",E,S);return r([t,e,s,n]),{value:ED(s,b),gradFunc:$}}));return t(w,v,x)}}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */QM({hammingWindow_:function(t){return iP(t,.54,.46)}});const gP=QM({hannWindow_:
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){return iP(t,.5,.5)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bP=QM({frame_:function(t,e,n,r=!1,s=0){let o=0;const i=[];for(;o+e<=t.size;)i.push(AD(t,o,e)),o+=n;if(r)for(;o<t.size;){const r=o+e-t.size,a=TD([AD(t,o,e-r),xF([r],s)]);i.push(a),o+=n}return 0===i.length?JL([],[0,e]):ED(TD(i),[i.length,e])}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */QM({stft_:function(t,e,n,r,s=gP){var o;null==r&&(o=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));const i=bP(t,e,n),a=rD(i,s(e));return WL(a,r)}});const wP=QM({cropAndResize_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s="bilinear",o=0){const i=YM(t,"image","cropAndResize"),a=YM(e,"boxes","cropAndResize","float32"),u=YM(n,"boxInd","cropAndResize","int32"),c=a.shape[0];dO(4===i.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`)),dO(2===a.rank&&4===a.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`)),dO(1===u.rank&&u.shape[0]===c,(()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`)),dO(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),dO(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),dO("bilinear"===s||"nearest"===s,(()=>`method must be bilinear or nearest, but was ${s}`));const l={image:i,boxes:a,boxInd:u},f={method:s,extrapolationValue:o,cropSize:r};return XI.runKernel("CropAndResize",l,f)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vP=QM({flipLeftRight_:function(t){const e=YM(t,"image","flipLeftRight","float32");dO(4===e.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`));const n={image:e};return XI.runKernel("FlipLeftRight",n,{})}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xP=QM({grayscaleToRGB_:function(t){const e=YM(t,"image","grayscaleToRGB"),n=e.rank-1,r=e.shape[n];dO(e.rank>=2,(()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`)),dO(1===r,(()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`));const s=new Array(e.rank);return s.fill(1,0,n),s[n]=3,wF(e,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NP=QM({rotateWithOffset_:function(t,e,n=0,r=.5){const s=YM(t,"image","rotateWithOffset","float32");dO(4===s.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${s.rank}.`));const o={image:s},i={radians:e,fillValue:n,center:r};return XI.runKernel("RotateWithOffset",o,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $P(t,e,n,r,s,o){null==r&&(r=.5),null==s&&(s=Number.NEGATIVE_INFINITY),null==o&&(o=0);const i=t.shape[0];return n=Math.min(n,i),dO(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),dO(2===t.rank,(()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`)),dO(4===t.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`)),dO(1===e.rank,(()=>"scores must be a 1D tensor")),dO(e.shape[0]===i,(()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`)),dO(0<=o&&o<=1,(()=>`softNmsSigma must be in [0, 1], but was '${o}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:s,softNmsSigma:o}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EP=QM({nonMaxSuppression_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const o=YM(t,"boxes","nonMaxSuppression","float32"),i=YM(e,"scores","nonMaxSuppression","float32"),a=$P(o,i,n,r,s),u={maxOutputSize:n=a.maxOutputSize,iouThreshold:r=a.iouThreshold,scoreThreshold:s=a.scoreThreshold};return XI.runKernel("NonMaxSuppressionV3",{boxes:o,scores:i},u)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SP(t,e,n){const r=function(t,e,n){return function(t,e,n){let r=0,s=t.length,o=0,i=!1;for(;r<s;){o=r+(s-r>>>1);const a=n(e,t[o]);a>0?r=o+1:(s=o,i=!a)}return i?r:-r-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e,n||_P)}(t,e,n),s=r<0?-(r+1):r;t.splice(s,0,e)}function _P(t,e){return t>e?1:t<e?-1:0}function TP(t,e,n,r,s,o,i=!1,a=!1,u=!1){const c=[];for(let t=0;t<e.length;t++)e[t]>s&&c.push({score:e[t],boxIndex:t,suppressBeginIndex:0});c.sort(CP);const l=o>0?-.5/o:0,f=[],h=[];for(;f.length<n&&c.length>0;){const e=c.pop(),{score:n,boxIndex:o,suppressBeginIndex:i}=e;if(n<s)break;let a=!1;for(let n=f.length-1;n>=i;--n){const i=kP(t,o,f[n]);if(i>=r){a=!0;break}if(e.score=e.score*AP(r,l,i),e.score<=s)break}e.suppressBeginIndex=f.length,a||(e.score===n?(f.push(o),h.push(e.score)):e.score>s&&SP(c,e,CP))}const p=f.length,d=n-p;a&&d>0&&(f.push(...new Array(d).fill(0)),h.push(...new Array(d).fill(0)));const m={selectedIndices:f};return i&&(m.selectedScores=h),u&&(m.validOutputs=p),m}function kP(t,e,n){const r=t.subarray(4*e,4*e+4),s=t.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(s[0],s[2]),l=Math.min(s[1],s[3]),f=Math.max(s[0],s[2]),h=Math.max(s[1],s[3]),p=(a-o)*(u-i),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;const m=Math.max(o,c),y=Math.max(i,l),g=Math.min(a,f),b=Math.min(u,h),w=Math.max(g-m,0)*Math.max(b-y,0);return w/(p+d-w)}function AP(t,e,n){const r=Math.exp(e*n*n);return n<=t?r:0}function CP(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OP=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const o=YM(t,"boxes","nonMaxSuppressionAsync"),i=YM(e,"scores","nonMaxSuppressionAsync"),a=$P(o,i,n,r,s);n=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;const u=await Promise.all([o.data(),i.data()]),c=u[0],l=u[1],{selectedIndices:f}=function(t,e,n,r,s){return TP(t,e,n,r,s,0)}(c,l,n,r,s);return o!==t&&o.dispose(),i!==e&&i.dispose(),XL(f,"int32")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IP=QM({nonMaxSuppressionWithScore_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=YM(t,"boxes","nonMaxSuppression"),a=YM(e,"scores","nonMaxSuppression"),u=$P(i,a,n,r,s,o),c={boxes:i,scores:a},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:s=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},f=XI.runKernel("NonMaxSuppressionV5",c,l);return{selectedIndices:f[0],selectedScores:f[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MP=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=YM(t,"boxes","nonMaxSuppressionAsync"),a=YM(e,"scores","nonMaxSuppressionAsync"),u=$P(i,a,n,r,s,o);n=u.maxOutputSize,r=u.iouThreshold,s=u.scoreThreshold,o=u.softNmsSigma;const c=await Promise.all([i.data(),a.data()]),l=c[0],f=c[1],{selectedIndices:h,selectedScores:p}=function(t,e,n,r,s,o){return TP(t,e,n,r,s,o,!0)}(l,f,n,r,s,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:XL(h,"int32"),selectedScores:XL(p)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RP=QM({nonMaxSuppressionPadded_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=YM(t,"boxes","nonMaxSuppression"),a=YM(e,"scores","nonMaxSuppression"),u=$P(i,a,n,r,s,null),c={boxes:i,scores:a},l={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:o},f=XI.runKernel("NonMaxSuppressionV4",c,l);return{selectedIndices:f[0],validOutputs:f[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DP=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=YM(t,"boxes","nonMaxSuppressionAsync"),a=YM(e,"scores","nonMaxSuppressionAsync"),u=$P(i,a,n,r,s,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[h,p]=await Promise.all([i.data(),a.data()]),{selectedIndices:d,validOutputs:m}=function(t,e,n,r,s,o){return TP(t,e,n,r,s,0,!1,o,!0)}(h,p,c,l,f,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:XL(d,"int32"),validOutputs:cF(m,"int32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FP=QM({resizeBilinear_:function(t,e,n=!1,r=!1){const s=YM(t,"images","resizeBilinear");dO(3===s.rank||4===s.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${s.rank}.`)),dO(2===e.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`)),dO(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=ED(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=XI.runKernel("ResizeBilinear",a,u);return i?ED(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LP=QM({resizeNearestNeighbor_:function(t,e,n=!1,r=!1){const s=YM(t,"images","resizeNearestNeighbor");dO(3===s.rank||4===s.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${s.rank}.`)),dO(2===e.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`)),dO("float32"===s.dtype||"int32"===s.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),dO(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=ED(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=XI.runKernel("ResizeNearestNeighbor",a,u);return i?ED(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PP=QM({threshold_:function(t,e="binary",n=!1,r=.5){const s=YM(t,"image","threshold"),o=s.shape[0]*s.shape[1];let i,a,u,c,l=rD(XL([r]),255);if(dO(3===s.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${s.rank}.`)),dO(3===s.shape[2]||1===s.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${s.shape[2]}.`)),dO("int32"===s.dtype||"float32"===s.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${s.dtype}.`)),dO("otsu"===e||"binary"===e,(()=>`Method must be binary or otsu, but was ${e}`)),3===s.shape[2]){[i,a,u]=zL(s,[1,1,1],-1);const t=rD(i,.2989),e=rD(a,.587),n=rD(u,.114);c=tD(tD(t,e),n)}else c=t;if("otsu"===e){l=function(t,e){let n,r,s,o,i,a,u=XL([-1]),c=XL([0]),l=XL([0]);for(let f=0;f<t.size-1;f++){n=AD(t,0,f+1),r=AD(t,f+1),i=nD(hF(n),e),a=nD(hF(r),e);const h=hF(rD(n,SL(0,n.size)));s=nD(h,hF(n));const p=xF(r.shape,n.size),d=tD(SL(0,r.size),p),m=rD(r,d);o=nD(hF(m),hF(r));const y=FF(s,o),g=FF(s,o),b=rD(i,a);l=rD(rD(b,y),g);const w=EF(l,c);c=QD(w,l,c),u=QD(w,XL([f]),u)}return u}(MD(MR(CL(c),"int32"),nR([]),256),o)}const f=n?AF(c,l):EF(c,l);return MR(rD(f,255),"int32")}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BP=QM({transform_:function(t,e,n="nearest",r="constant",s=0,o){const i=YM(t,"image","transform","float32"),a=YM(e,"transforms","transform","float32");dO(4===i.rank,(()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`)),dO(2===a.rank&&(a.shape[0]===i.shape[0]||1===a.shape[0])&&8===a.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),dO(null==o||2===o.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`));const u={image:i,transforms:a},c={interpolation:n,fillMode:r,fillValue:s,outputShape:o};return XI.runKernel("Transform",u,c)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VP(t,e=!1){return XI.tidy((()=>{dO(2===t.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`));const n=t.shape[0],r=t.shape[1];let s=vF(n),o=RR(t);const i=JL([[1]],[1,1]);let a=RR(i);const u=n>=r?r:n;for(let t=0;t<u;++t){const e=o,u=a,c=s;[a,o,s]=XI.tidy((()=>{const e=AD(o,[t,t],[n-t,1]),u=dF(e),c=AD(o,[t,t],[1,1]),l=QD(EF(c,0),JL([[-1]]),JL([[1]])),f=FF(c,rD(l,u)),h=nD(e,f);a=1===h.shape[0]?RR(i):TD([i,AD(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);const p=HR(nD(WR(l,f),u)),d=AD(o,[t,0],[n-t,r]),m=rD(p,a),y=XR(a);if(0===t)o=FF(d,WR(m,WR(y,d)));else{const e=FF(d,WR(m,WR(y,d)));o=TD([AD(o,[0,0],[t,r]),e],0)}const g=XR(m),b=AD(s,[0,t],[n,s.shape[1]-t]);if(0===t)s=FF(b,WR(WR(b,a),g));else{const e=FF(b,WR(WR(b,a),g));s=TD([AD(s,[0,0],[n,t]),e],1)}return[a,o,s]})),UI([e,u,c]).forEach((t=>t.dispose()))}return!e&&n>r&&(s=AD(s,[0,0],[n,r]),o=AD(o,[0,0],[r,r])),[s,o]}))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var zP;QM({bandPart_:function(t,e,n){dO(e%1==0,(()=>`bandPart(): numLower must be an integer, got ${e}.`)),dO(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`));const r=YM(t,"a","bandPart");dO(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));const s=r.shape,[o,i]=r.shape.slice(-2);if(!(e<=o))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`);if(!(n<=i))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${i}).`);e<0&&(e=o),n<0&&(n=i);const a=ED(SL(0,o,1,"int32"),[-1,1]),u=SL(0,i,1,"int32"),c=FF(a,u),l=BF(AF(c,cF(+e,"int32")),SF(c,cF(-n,"int32"))),f=XF([o,i],r.dtype);return ED(GL(tP(ED(r,[-1,o,i])).map((t=>QD(l,t,f)))),s)}}),QM({gramSchmidt_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){let e;if(Array.isArray(t)){e=!1,dO(null!=t&&t.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=t[0].shape[0];for(let e=1;e<t.length;++e)dO(t[e].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[e].shape[0]} vs. ${n})`))}else e=!0,t=zL(t,t.shape[0],0).map((t=>jL(t,[0])));dO(t.length<=t[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`));const n=[],r=t;for(let e=0;e<t.length;++e)n.push(XI.tidy((()=>{let t=r[e];if(e>0)for(let r=0;r<e;++r){const e=rD(hF(rD(n[r],t)),n[r]);t=FF(t,e)}return nD(t,dF(t,"euclidean"))})));return e?GL(n,0):n}}),QM({qr_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=!1){if(dO(t.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`)),2===t.rank)return VP(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce(((t,e)=>t*e)),r=tP(ED(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),s=[],o=[];r.forEach((t=>{const[n,r]=VP(t,e);s.push(n),o.push(r)}));return[ED(GL(s,0),t.shape),ED(GL(o,0),t.shape)]}}}),function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(zP||(zP={}));const WP=QM({computeWeightedLoss_:function(t,e,n=zP.SUM_BY_NONZERO_WEIGHTS){const r=YM(t,"losses","computeWeightedLoss");let s=null;null!=e&&(s=YM(e,"weights","computeWeightedLoss"));const o=null==s?r:rD(r,s);if(n===zP.NONE)return o;if(n===zP.SUM)return hF(o);if(n===zP.MEAN){if(null==s)return KF(o);{const t=r.size/s.size,e=nD(hF(o),hF(s));return t>1?nD(e,cF(t)):e}}if(n===zP.SUM_BY_NONZERO_WEIGHTS){if(null==s)return nD(hF(o),cF(r.size));{const t=rD(s,JF(r.shape)),e=MR(hF(eL(t,cF(0))),"float32");return nD(hF(o),e)}}throw Error(`Unknown reduction: ${n}`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */QM({absoluteDifference_:function(t,e,n,r=zP.SUM_BY_NONZERO_WEIGHTS){const s=YM(t,"labels","absoluteDifference"),o=YM(e,"predictions","absoluteDifference");let i=null;null!=n&&(i=YM(n,"weights","absoluteDifference")),mO(s.shape,o.shape,"Error in absoluteDifference: ");const a=sD(FF(s,o));return WP(a,i,r)}}),QM({cosineDistance_:function(t,e,n,r,s=zP.SUM_BY_NONZERO_WEIGHTS){const o=YM(t,"labels","cosineDistance"),i=YM(e,"predictions","cosineDistance");let a=null;null!=r&&(a=YM(r,"weights","cosineDistance")),mO(o.shape,i.shape,"Error in cosineDistance: ");const u=cF(1),c=FF(u,hF(rD(o,i),n,!0));return WP(c,a,s)}}),QM({hingeLoss_:function(t,e,n,r=zP.SUM_BY_NONZERO_WEIGHTS){let s=YM(t,"labels","hingeLoss");const o=YM(e,"predictions","hingeLoss");let i=null;null!=n&&(i=YM(n,"weights","hingeLoss")),mO(s.shape,o.shape,"Error in hingeLoss: ");const a=cF(1);s=FF(rD(cF(2),s),a);const u=TL(FF(a,rD(s,o)));return WP(u,i,r)}}),QM({huberLoss_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=1,s=zP.SUM_BY_NONZERO_WEIGHTS){const o=YM(t,"labels","huberLoss"),i=YM(e,"predictions","huberLoss");let a=null;null!=n&&(a=YM(n,"weights","huberLoss")),mO(o.shape,i.shape,"Error in huberLoss: ");const u=cF(r),c=sD(FF(i,o)),l=YF(c,u),f=FF(c,l),h=tD(rD(cF(.5),fF(l)),rD(u,f));return WP(h,a,s)}}),QM({logLoss_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=1e-7,s=zP.SUM_BY_NONZERO_WEIGHTS){const o=YM(t,"labels","logLoss"),i=YM(e,"predictions","logLoss");let a=null;null!=n&&(a=YM(n,"weights","logLoss")),mO(o.shape,i.shape,"Error in logLoss: ");const u=cF(1),c=cF(r),l=HR(rD(o,IF(tD(i,c)))),f=rD(FF(u,o),IF(tD(FF(u,i),c))),h=FF(l,f);return WP(h,a,s)}}),QM({meanSquaredError_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=zP.SUM_BY_NONZERO_WEIGHTS){const s=YM(t,"labels","meanSquaredError"),o=YM(e,"predictions","meanSquaredError");let i=null;null!=n&&(i=YM(n,"weights","meanSquaredError")),mO(s.shape,o.shape,"Error in meanSquaredError: ");const a=UL(s,o);return WP(a,i,r)}}),QM({sigmoidCrossEntropy_:function(t,e,n,r=0,s=zP.SUM_BY_NONZERO_WEIGHTS){let o=YM(t,"multiClassLabels","sigmoidCrossEntropy");const i=YM(e,"logits","sigmoidCrossEntropy");let a=null;if(null!=n&&(a=YM(n,"weights","sigmoidCrossEntropy")),mO(o.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){const t=cF(r),e=cF(1),n=cF(.5);o=tD(rD(o,FF(e,t)),rD(n,t))}const u=
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=YM(t,"labels","sigmoidCrossEntropyWithLogits"),r=YM(e,"logits","sigmoidCrossEntropyWithLogits");mO(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const s=TL(r),o=rD(r,n),i=MF(yF(HR(sD(r))));return tD(FF(s,o),i)}(o,i);return WP(u,a,s)}}),QM({softmaxCrossEntropy_:function(t,e,n,r=0,s=zP.SUM_BY_NONZERO_WEIGHTS){let o=YM(t,"onehotLabels","softmaxCrossEntropy");const i=YM(e,"logits","softmaxCrossEntropy");let a=null;if(null!=n&&(a=YM(n,"weights","softmaxCrossEntropy")),mO(o.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){const t=cF(r),e=cF(1),n=cF(o.shape[1]);o=tD(rD(o,FF(e,t)),nD(t,n))}const u=
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n=-1){if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);const r=RF(((t,e,r)=>{const s=PF(e,[n],!0),o=FF(MR(e,"float32"),s);r([t,o]);const i=HR(rD(o,t));return{value:hF(i,[n]),gradFunc:(t,e)=>{const[r,s]=e,o=oF(t.shape,[n]);return[rD(ED(t,o),FF(MR(r,"float32"),yF(s))),rD(ED(t,o),FF(yF(s),MR(r,"float32")))]}}}));return r(t,e)}(o,i);return WP(u,a,s)}});const UP=QM({sparseFillEmptyRows_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const s=YM(t,"indices","sparseFillEmptyRows","int32"),o=YM(e,"values","sparseFillEmptyRows"),i=YM(n,"denseShape","sparseFillEmptyRows","int32"),a=YM(r,"defaultValue","sparseFillEmptyRows",o.dtype);if(2!==s.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${s.shape}`);if(1!==o.rank)throw new Error(`Values should be Tensor1D but received shape ${o.shape}`);if(1!==i.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${i.shape}`);if(0!==a.rank)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const u={indices:s,values:o,denseShape:i,defaultValue:a},c=XI.runKernel("SparseFillEmptyRows",u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jP=QM({sparseReshape_:function(t,e,n){const r=YM(t,"inputIndices","sparseReshape","int32"),s=YM(e,"inputShape","sparseReshape","int32"),o=YM(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==s.rank)throw new Error(`Input shape should be Tensor1D but received shape ${s.shape}`);if(1!==o.rank)throw new Error(`New shape should be Tensor1D but received shape ${o.shape}`);const i={inputIndices:r,inputShape:s,newShape:o},a=XI.runKernel("SparseReshape",i);return{outputIndices:a[0],outputShape:a[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GP=QM({sparseSegmentMean_:function(t,e,n){const r=YM(t,"data","sparseSegmentMean"),s=YM(e,"indices","sparseSegmentMean","int32"),o=YM(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return XI.runKernel("SparseSegmentMean",i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qP=QM({sparseSegmentSum_:function(t,e,n){const r=YM(t,"data","sparseSegmentSum"),s=YM(e,"indices","sparseSegmentSum","int32"),o=YM(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return XI.runKernel("SparseSegmentSum",i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HP=QM({stringNGrams_:function(t,e,n,r,s,o,i,a){const u=YM(t,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error(`Data must be a vector, saw: ${u.shape}`);const c=YM(e,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");const l={separator:n,nGramWidths:r,leftPad:s,rightPad:o,padWidth:i,preserveShortSequences:a},f={data:u,dataSplits:c},h=XI.runKernel("StringNGrams",f,l);return{nGrams:h[0],nGramsSplits:h[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KP=QM({stringSplit_:function(t,e,n=!0){const r=YM(t,"input","stringSplit","string"),s=YM(e,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(0!==s.rank)throw new Error(`Delimiter should be a scalar but received shape ${s.shape}`);const o={skipEmpty:n},i={input:r,delimiter:s},a=XI.runKernel("StringSplit",i,o);return{indices:a[0],values:a[1],shape:a[2]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XP=QM({stringToHashBucketFast_:function(t,e){const n=YM(t,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const s={input:n};return XI.runKernel("StringToHashBucketFast",s,r)}}),JP={flipLeftRight:vP,grayscaleToRGB:xP,resizeNearestNeighbor:LP,resizeBilinear:FP,rotateWithOffset:NP,cropAndResize:wP,nonMaxSuppression:EP,nonMaxSuppressionAsync:OP,nonMaxSuppressionWithScore:IP,nonMaxSuppressionWithScoreAsync:MP,nonMaxSuppressionPadded:RP,nonMaxSuppressionPaddedAsync:DP,threshold:PP,transform:BP},YP={sparseFillEmptyRows:UP,sparseReshape:jP,sparseSegmentMean:GP,sparseSegmentSum:qP},ZP={stringNGrams:HP,stringSplit:KP,stringToHashBucketFast:XP};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
var QP,tB;LO().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"}(QP||(QP={})),function(t){var e;(e=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(tB||(tB={}));
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const eB={};function nB(t){return eB[t]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rB(t,e,n,r,s){const o=e.inputParams[t];if(o&&void 0!==o.inputIndexStart){const t=o.inputIndexStart,i=0===o.inputIndexEnd?void 0:void 0===o.inputIndexEnd?t+1:o.inputIndexEnd;if("tensor"===o.type)return sB(e.inputNames[o.inputIndexStart],n,r,s);if("tensors"===o.type){return e.inputNames.slice(t,i).map((t=>sB(t,n,r,s)))}const a=sB(e.inputNames.slice(t)[0],n,r,s),u=a.dataSync();return"number"===o.type?u[0]:CO(a.shape,u)}const i=e.attrParams[t];return i&&i.value}function sB(t,e,n,r){const[s,o]=aB(t);if(null!=r){const t=r.getHashTableHandleByName(s);if(null!=t)return t}const i=n.currentContextIds.find((t=>!!e[iB(s,t)]));return void 0!==i?e[iB(s,i)][o]:void 0}function oB(t,e){const[n,r,s]=aB(t);return[iB(n,e&&e.currentContextId),r,s]}function iB(t,e){return e?`${t}-${e}`:t}function aB(t){const e=t.split(":");if(1===e.length)return[t,0,void 0];const n=e[0],r=3===e.length?e[1]:void 0;return[n,Number(e[e.length-1]),r]}function uB(t,e,n){let r=rB("pad",t,e,n);if("explicit"===r){r=rB("explicitPaddings",t,e,n);const s=[[0,0],[0,0],[0,0],[0,0]];for(let t=0;t<4;t++)s[t][0]=r[2*t],s[t][1]=r[2*t+1];return s}return r}function cB(t){return t.kept?t:RR(t)}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var lB=Object.freeze({__proto__:null,json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var fB=Object.freeze({__proto__:null,json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var hB=Object.freeze({__proto__:null,json:[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var pB=Object.freeze({__proto__:null,json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var dB=Object.freeze({__proto__:null,json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var mB=Object.freeze({__proto__:null,json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var yB=Object.freeze({__proto__:null,json:[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var gB=Object.freeze({__proto__:null,json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var bB=Object.freeze({__proto__:null,json:[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var wB=Object.freeze({__proto__:null,json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var vB=Object.freeze({__proto__:null,json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var xB=Object.freeze({__proto__:null,json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var NB=Object.freeze({__proto__:null,json:[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var $B=Object.freeze({__proto__:null,json:[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var EB=Object.freeze({__proto__:null,json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var SB=Object.freeze({__proto__:null,json:[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var _B=Object.freeze({__proto__:null,json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var TB=Object.freeze({__proto__:null,json:[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var kB=Object.freeze({__proto__:null,json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}]});class AB{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const t=[].concat(...[lB,fB,hB,pB,dB,mB,yB,gB,bB,wB,vB,xB,NB,$B,EB,SB,_B,TB,kB].map((t=>t.json)));this.opMappers=t.reduce(((t,e)=>(t[e.tfOpName]=e,t)),{})}transformGraph(t,e={}){const n=t.node,r=[],s=[],o=[],i=n.reduce(((t,e)=>(t[e.name]=this.mapNode(e),e.op.startsWith("Placeholder")?r.push(t[e.name]):"Const"===e.op?s.push(t[e.name]):null!=e.input&&0!==e.input.length||o.push(t[e.name]),t)),{});let a=[];const u=[];let c={},l={};null!=e&&(c=this.mapSignatureEntries(e.inputs),l=this.mapSignatureEntries(e.outputs));const f=Object.keys(i);f.forEach((t=>{const e=i[t];e.inputNames.forEach(((t,n)=>{const[r,,s]=oB(t),o=i[r];if(null!=o.outputs){const t=o.outputs.indexOf(s);if(-1!==t){const s=`${r}:${t}`;e.inputNames[n]=s}}e.inputs.push(o),o.children.push(e)}))})),0===Object.keys(l).length?f.forEach((t=>{const e=i[t];0===e.children.length&&u.push(e)})):Object.keys(l).forEach((t=>{const[e]=oB(t),n=i[e];null!=n&&(n.signatureKey=l[t],u.push(n))})),Object.keys(c).length>0?Object.keys(c).forEach((t=>{const[e]=oB(t),n=i[e];n&&(n.signatureKey=c[t],a.push(n))})):a=r;let h={};null!=t.library&&null!=t.library.function&&(h=t.library.function.reduce(((t,e)=>(t[e.signature.name]=this.mapFunction(e),t)),{}));const p={nodes:i,inputs:a,outputs:u,weights:s,placeholders:r,signature:e,functions:h};return o.length>0&&(p.initNodes=o),p}mapSignatureEntries(t){return Object.keys(t||{}).reduce(((e,n)=>(e[t[n].name]=n,e)),{})}mapNode(t){const e=nB(t.op)||this.opMappers[t.op]||{};null==t.attr&&(t.attr={});const n={name:t.name,op:t.op,category:e.category,inputNames:(t.input||[]).map((t=>t.startsWith("^")?t.slice(1):t)),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr,outputs:e.outputs};return null!=e.inputs&&(n.inputParams=e.inputs.reduce(((t,e)=>(t[e.name]={type:e.type,inputIndexStart:e.start,inputIndexEnd:e.end},t)),{})),null!=e.attrs&&(n.attrParams=e.attrs.reduce(((e,n)=>{const r=n.type;let s;switch(n.type){case"string":s=OB(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=OB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":s=zB(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=zB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":s=MB(t.attr,n.tfName,n.defaultValue||0),void 0===s&&n.tfDeprecatedName&&(s=MB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":s=VB(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=VB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":s=IB(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=IB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":s=UB(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=UB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":s=BB(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=BB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":s=WB(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=WB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":s=FB(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=FB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":s=LB(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=LB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":s=DB(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=DB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${n.type} for op: ${t.op}`)}return e[n.name]={value:s,type:r},e}),{})),n}mapFunction(t){const e=t.nodeDef,n=[];let r={};null!=e&&(r=e.reduce(((t,e)=>(t[e.name]=this.mapNode(e),"Const"===e.op&&n.push(t[e.name]),t)),{}));const s=[],o=[];t.signature.inputArg.forEach((t=>{const[e]=oB(t.name),n={name:e,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:RB(t.type),type:"dtype"}},children:[]};n.signatureKey=t.name,s.push(n),r[e]=n}));Object.keys(r).forEach((t=>{const e=r[t];e.inputNames.forEach(((t,n)=>{const[s,,o]=oB(t),i=r[s];if(null!=i.outputs){const t=i.outputs.indexOf(o);if(-1!==t){const r=`${s}:${t}`;e.inputNames[n]=r}}e.inputs.push(i),i.children.push(e)}))}));const i=t.ret;t.signature.outputArg.forEach((t=>{const[e,n]=oB(i[t.name]),s=r[e];null!=s&&(s.defaultOutput=n,o.push(s))}));const a=this.mapArgsToSignature(t);return{nodes:r,inputs:s,outputs:o,weights:n,placeholders:[],signature:a}}mapArgsToSignature(t){return{methodName:t.signature.name,inputs:t.signature.inputArg.reduce(((t,e)=>(t[e.name]=this.mapArgToTensorInfo(e),t)),{}),outputs:t.signature.outputArg.reduce(((e,n)=>(e[n.name]=this.mapArgToTensorInfo(n,t.ret),e)),{})}}mapArgToTensorInfo(t,e){let n=t.name;return null!=e&&(n=e[n]),{name:n,dtype:t.type}}}function CB(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):function(t){const e=LO().global;return void 0!==e.atob?e.atob(t):new fM(t,"base64").toString()}(t);return e?n:n.toLowerCase()}function OB(t,e,n,r=!1){const s=t[e];return null!=s?CB(s.s,r):n}function IB(t,e,n){const r=t[e];return r?r.b:n}function MB(t,e,n){const r=t[e]||{},s=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof s?s:parseInt(s,10)}function RB(t){switch("string"==typeof t&&(t=QP[t]),t){case QP.DT_FLOAT:case QP.DT_HALF:return"float32";case QP.DT_INT32:case QP.DT_INT64:case QP.DT_INT8:case QP.DT_UINT8:return"int32";case QP.DT_BOOL:return"bool";case QP.DT_DOUBLE:return"float32";case QP.DT_STRING:return"string";default:return null}}function DB(t,e,n){const r=t[e];return r&&r.func?r.func.name:n}function FB(t,e,n){const r=t[e];return r&&r.type?RB(r.type):n}function LB(t,e,n){const r=t[e];return r&&r.list&&r.list.type?r.list.type.map((t=>RB(t))):n}function PB(t){if(!t.unknownRank)return null!=t.dim?t.dim.map((t=>"number"==typeof t.size?t.size:parseInt(t.size,10))):[]}function BB(t,e,n){const r=t[e];return r&&r.shape?PB(r.shape):n}function VB(t,e,n){const r=t[e];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((t=>"number"==typeof t?t:parseInt(t,10))):n}function zB(t,e,n,r=!1){const s=t[e];return s&&s.list&&s.list.s?s.list.s.map((t=>CB(t,r))):n}function WB(t,e,n){const r=t[e];return r&&r.list&&r.list.shape?r.list.shape.map((t=>PB(t))):n}function UB(t,e,n){const r=t[e];return r&&r.list&&r.list.b?r.list.b:n}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jB{constructor(t,e,n){this.node=t,this.tensorMap=e,this.context=n,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((t=>this.getInput(t))),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce(((t,e)=>(t[e]=this.getAttr(e),t)),{}))}getInput(t){return sB(t,this.tensorMap,this.context)}getAttr(t,e){const n=this.node.rawAttrs[t];if(null!=n.tensor)return sB(t,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return MB(this.node.rawAttrs,t,e);if(null!=n.s)return OB(this.node.rawAttrs,t,e);if(null!=n.b)return IB(this.node.rawAttrs,t,e);if(null!=n.shape)return BB(this.node.rawAttrs,t,e);if(null!=n.type)return FB(this.node.rawAttrs,t,e);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return VB(this.node.rawAttrs,t,e);if(null!=n.list.s)return zB(this.node.rawAttrs,t,e);if(null!=n.list.shape)return WB(this.node.rawAttrs,t,e);if(null!=n.list.b)return UB(this.node.rawAttrs,t,e);if(null!=n.list.type)return LB(this.node.rawAttrs,t,e)}return e}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function GB(t,e,n=""){if("number"!=typeof t&&"number"!=typeof e){dO(t.length===e.length,(()=>n+` Shapes ${t} and ${e} must match`));for(let r=0;r<t.length;r++){const s=t[r],o=e[r];dO(s<0||o<0||s===o,(()=>n+` Shapes ${t} and ${e} must match`))}}}function qB(t){return"number"!=typeof t&&!t.some((t=>t<0))}function HB(t,e,n){let r=KB(t,n);const s=!qB(r);if(s&&0===e.length)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(s&&e.forEach((t=>{r=KB(t.shape,r)})),!qB(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function KB(t,e){if("number"==typeof t)return e;if("number"==typeof e)return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let r=0;r<t.length;++r){const s=t[r],o=e[r];if(s>=0&&o>=0&&s!==o)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[r]=s>=0?s:o}return n}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XB{constructor(t,e,n,r,s,o,i){this.name=t,this.dtype=e,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=s,this.dynamicSize=o,this.clearAfterRead=i,this.tensors=[],this.closed_=!1,this.idTensor=cF(0),GR(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.tensor.id)||e.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||t>=this.size())throw new Error(`Tried to read from index ${t}, but array size is: ${this.size()}`);const e=this.tensors[t];if(e.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${t} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor}readMany(t){return t.map((t=>this.read(t)))}write(t,e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error(`Tried to write to index ${t}, but array is not resizeable and size is: ${this.maxSize}`);const n=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t},\n          because the value dtype is ${e.dtype}, but TensorArray dtype is ${this.dtype}.`);if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=e.shape),GB(this.elementShape,e.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${t}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been written.`);n.tensor=e,GR(e),n.written=!0,this.tensors[t]=n}writeMany(t,e){if(t.length!==e.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${t.length} is not the same as tensors size: ${e.length}.`);t.forEach(((t,n)=>this.write(t,e[n])))}gather(t,e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${e}`);if(t)t=t.slice(0,this.size());else{t=[];for(let e=0;e<this.size();e++)t.push(e)}if(0===t.length)return nR([],[0].concat(this.elementShape));const n=this.readMany(t);return GB(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),GL(n,0)}concat(t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${t}`);if(0===this.size())return nR([],[0].concat(this.elementShape));const e=[];for(let t=0;t<this.size();t++)e.push(t);const n=this.readMany(e);return GB(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),TD(n,0)}scatter(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);const n=Math.max(...t);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(t,tP(e,0))}split(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);let n=0;const r=t.map((t=>(n+=t,n)));if(n!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${n}, and tensor's shape is: ${e.shape}`);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${t.length}), and the TensorArray is not marked as dynamically resizeable`);const s=0===n?0:e.size/n,o=[];jR((()=>{e=ED(e,[1,n,s]);for(let n=0;n<t.length;++n){const i=[0,0===n?0:r[n-1],0],a=[1,t[n],s];o[n]=ED(AD(e,i,a),this.elementShape)}return o}));const i=[];for(let e=0;e<t.length;e++)i[e]=e;this.writeMany(i,o)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JB{constructor(t,e,n,r=-1){this.tensors=t,this.elementShape=e,this.elementDtype=n,null!=t&&t.forEach((t=>{if(n!==t.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${t.dtype}`);GB(e,t.shape,"TensorList shape mismatch: "),GR(t)})),this.idTensor=cF(0),this.maxNumElements=r,GR(this.idTensor)}get id(){return this.idTensor.id}copy(){return new JB([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.id)||e.dispose()})),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,e,n=-1){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(-1!==n&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);GB(t,this.elementShape,"TensorList shape mismatch: ");const r=HB(this.elementShape,this.tensors,t);return jR((()=>{const t=this.tensors.map((t=>ED(t,r)));return GL(t,0)}))}popBack(t,e){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=HB(this.elementShape,this.tensors,t),r=this.tensors.pop();return GB(r.shape,t,"TensorList shape mismatch: "),ED(r,n)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(GB(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");GR(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);const e=new JB([],this.elementShape,this.elementDtype,this.maxNumElements);e.tensors.length=t;for(let n=0;n<Math.min(this.tensors.length,t);++n)e.tensors[n]=this.tensors[n];return e}getItem(t,e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(null==this.tensors[t])throw new Error(`element at index ${t} is null.`);GB(this.tensors[t].shape,e,"TensorList shape mismatch: ");const r=HB(this.elementShape,this.tensors,e);return ED(this.tensors[t],r)}setItem(t,e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(t<0||-1!==this.maxNumElements&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);GB(this.elementShape,e.shape,"TensorList shape mismatch: "),GR(e),this.tensors[t]=e}gather(t,e,n){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);GB(this.elementShape,n,"TensorList shape mismatch: "),t=t.slice(0,this.size());const r=HB(this.elementShape,this.tensors,n);return 0===t.length?nR([],[0].concat(r)):jR((()=>{const e=t.map((t=>ED(this.tensors[t],r)));return GL(e,0)}))}concat(t,e){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);GB(this.elementShape,e,"TensorList shape mismatch: ");const n=HB(this.elementShape,this.tensors,e);return 0===this.size()?nR([],[0].concat(n)):jR((()=>{const t=this.tensors.map((t=>ED(t,n)));return TD(t,0)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const YB=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const r=rB("thenBranch",t,e,n),s=rB("elseBranch",t,e,n),o=rB("cond",t,e,n),i=rB("args",t,e,n);return(await o.data())[0]?n.functionMap[r].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap):n.functionMap[s].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=rB("body",t,e,n),s=rB("cond",t,e,n),o=rB("args",t,e,n),i=await n.functionMap[s].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap),a=o.map((t=>t.id));let u=await i[0].data();i.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||t.dispose()}));let c=o;for(;u[0];){const t=c;c=await n.functionMap[r].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);const e=c.map((t=>t.id));t.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}));const o=await n.functionMap[s].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);u=await o[0].data(),o.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}))}return c}case"LoopCond":return[cB(rB("pred",t,e,n))];case"Switch":{const r=rB("pred",t,e,n);let s=rB("data",t,e,n);return s.kept||(s=cB(s)),(await r.data())[0]?[void 0,s]:[s,void 0]}case"Merge":{const r=t.inputNames.find((t=>void 0!==sB(t,e,n)));if(r){return[cB(sB(r,e,n))]}return}case"Enter":{const r=rB("frameName",t,e,n),s=rB("tensor",t,e,n);return n.enterFrame(r),[cB(s)]}case"Exit":{const r=rB("tensor",t,e,n);return n.exitFrame(),[cB(r)]}case"NextIteration":{const r=rB("tensor",t,e,n);return n.nextIteration(),[cB(r)]}case"TensorArrayV3":{const r=rB("size",t,e,n),s=rB("dtype",t,e,n),o=rB("elementShape",t,e,n),i=rB("dynamicSize",t,e,n),a=rB("clearAfterRead",t,e,n),u=rB("identicalElementShapes",t,e,n),c=rB("name",t,e,n),l=new XB(c,s,r,o,u,i,a);return n.addTensorArray(l),[l.idTensor,cF(1)]}case"TensorArrayWriteV3":{const r=rB("tensorArrayId",t,e,n),s=rB("index",t,e,n),o=rB("tensor",t,e,n),i=n.getTensorArray(r.id);return i.write(s,o),[i.idTensor]}case"TensorArrayReadV3":{const r=rB("tensorArrayId",t,e,n),s=rB("index",t,e,n);return[n.getTensorArray(r.id).read(s)]}case"TensorArrayGatherV3":{const r=rB("tensorArrayId",t,e,n),s=rB("indices",t,e,n),o=rB("dtype",t,e,n);return[n.getTensorArray(r.id).gather(s,o)]}case"TensorArrayScatterV3":{const r=rB("tensorArrayId",t,e,n),s=rB("indices",t,e,n),o=rB("tensor",t,e,n),i=n.getTensorArray(r.id);return i.scatter(s,o),[i.idTensor]}case"TensorArrayConcatV3":{const r=rB("tensorArrayId",t,e,n),s=n.getTensorArray(r.id),o=rB("dtype",t,e,n);return[s.concat(o)]}case"TensorArraySplitV3":{const r=rB("tensorArrayId",t,e,n),s=rB("tensor",t,e,n),o=rB("lengths",t,e,n),i=n.getTensorArray(r.id);return i.split(o,s),[i.idTensor]}case"TensorArraySizeV3":{const r=rB("tensorArrayId",t,e,n);return[cF(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{const r=rB("tensorArrayId",t,e,n),s=n.getTensorArray(r.id);return s.clearAndClose(),[s.idTensor]}case"TensorListSetItem":{const r=rB("tensorListId",t,e,n),s=rB("index",t,e,n),o=rB("tensor",t,e,n),i=n.getTensorList(r.id);return i.setItem(s,o),[i.idTensor]}case"TensorListGetItem":{const r=rB("tensorListId",t,e,n),s=rB("index",t,e,n),o=rB("elementShape",t,e,n),i=rB("elementDType",t,e,n);return[n.getTensorList(r.id).getItem(s,o,i)]}case"TensorListScatterV2":case"TensorListScatter":{const r=rB("indices",t,e,n),s=function(t,e,n,r){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const s=Math.max(...e);if(null!=r&&-1!==r&&s>=r)throw new Error(`Max index must be < array size (${s}  vs. ${r})`);const o=new JB([],n,t.dtype,r),i=tP(t,0);return e.forEach(((t,e)=>{o.setItem(t,i[e])})),o}(rB("tensor",t,e,n),r,rB("elementShape",t,e,n),rB("numElements",t,e,n));return n.addTensorList(s),[s.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=rB("elementShape",t,e,n),s=rB("elementDType",t,e,n);let o;o="TensorListReserve"===t.op?"numElements":"maxNumElements";const i=function(t,e,n){return new JB([],t,e,n)}(r,s,rB(o,t,e,n));return n.addTensorList(i),[i.idTensor]}case"TensorListGather":{const r=rB("tensorListId",t,e,n),s=rB("indices",t,e,n),o=rB("elementShape",t,e,n),i=rB("elementDType",t,e,n);return[n.getTensorList(r.id).gather(s,i,o)]}case"TensorListStack":{const r=rB("tensorListId",t,e,n),s=rB("elementShape",t,e,n),o=rB("elementDType",t,e,n),i=rB("numElements",t,e,n);return[n.getTensorList(r.id).stack(s,o,i)]}case"TensorListFromTensor":{const r=function(t,e,n){const r=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);GB(t.shape.slice(1),e,"TensorList shape mismatch: ");const s=tP(t);return new JB(s,e,r)}(rB("tensor",t,e,n),rB("elementShape",t,e,n),rB("elementDType",t,e,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const r=rB("tensorListId",t,e,n),s=n.getTensorList(r.id),o=rB("dtype",t,e,n),i=rB("elementShape",t,e,n);return[s.concat(o,i)]}case"TensorListPushBack":{const r=rB("tensorListId",t,e,n),s=rB("tensor",t,e,n),o=n.getTensorList(r.id);return o.pushBack(s),[o.idTensor]}case"TensorListPopBack":{const r=rB("tensorListId",t,e,n),s=rB("elementShape",t,e,n),o=rB("elementDType",t,e,n);return[n.getTensorList(r.id).popBack(s,o)]}case"TensorListSplit":{const r=rB("tensor",t,e,n),s=rB("elementShape",t,e,n),o=function(t,e,n){let r=0;const s=e.map((t=>(r+=t,r)));if(r!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${r}, and tensor's shape is: ${t.shape}`);const o=KB(t.shape.slice(1),n),i=0===r?0:t.size/r,a=jR((()=>{const n=[];t=ED(t,[1,r,i]);for(let r=0;r<e.length;++r){const a=[0,0===r?0:s[r-1],0],u=[1,e[r],i];n[r]=ED(AD(t,a,u),o)}return t.dispose(),n})),u=new JB([],n,t.dtype,e.length);for(let t=0;t<a.length;t++)u.setItem(t,a[t]);return u}(r,rB("lengths",t,e,n),s);return n.addTensorList(o),[o.idTensor]}case"TensorListLength":{const r=rB("tensorListId",t,e,n);return[cF(n.getTensorList(r.id).size(),"int32")]}case"TensorListResize":{const r=rB("tensorListId",t,e,n),s=rB("size",t,e,n),o=n.getTensorList(r.id).resize(s);return n.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZB(t,e,n){const[r,s]=rB("fusedOps",t,e,n),o="biasadd"===r,i=!o,a="prelu"===s,u="fusedbatchnorm"===r,c=rB("numArgs",t,e,n);if(o){if(a&&2!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&o&&1!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(u)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const l=rB("strides",t,e,n),f=uB(t,e,n),h=rB("dataFormat",t,e,n).toUpperCase(),p=rB("dilations",t,e,n);let[d,m]=rB("args",t,e,n);i&&(m=d,d=void 0);return{stride:l,pad:f,dataFormat:h,dilations:p,biasArg:d,preluArg:m,activationFunc:s,leakyreluAlpha:rB("leakyreluAlpha",t,e,n)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function QB(t,e,n){return{boxes:rB("boxes",t,e,n),scores:rB("scores",t,e,n),maxOutputSize:rB("maxOutputSize",t,e,n),iouThreshold:rB("iouThreshold",t,e,n),scoreThreshold:rB("scoreThreshold",t,e,n),softNmsSigma:rB("softNmsSigma",t,e,n)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class tV{constructor(t,e){this.keyDType=t,this.valueDType=e,this.handle=cF(0),this.tensorMap=new Map,GR(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return cF(this.size(),"int32")}async import(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),jR((()=>{const t=tP(e),r=n.length,s=t.length;dO(r===s,(()=>`The number of elements doesn't match, keys has ${r} elements, the values has ${s} elements.`));for(let e=0;e<r;e++){const r=n[e],s=t[e];GR(s),this.tensorMap.set(r,s)}return this.handle}))}async find(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return jR((()=>{const t=[];for(let r=0;r<n.length;r++){const s=n[r],o=this.findWithDefault(s,e);t.push(o)}return GL(t)}))}findWithDefault(t,e){const n=this.tensorMap.get(t);return null!=n?n:e}checkKeyAndValueTensor(t,e){if(t.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${t.dtype}`);if(e.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${e.dtype}`)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function eV(t,e,n,r){const s=((t,e,n)=>{switch(t.category){case"arithmetic":return jR((()=>((t,e,n)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[tD(rB("a",t,e,n),rB("b",t,e,n))];case"AddN":return[aD(rB("tensors",t,e,n))];case"FloorMod":case"Mod":return[QF(rB("a",t,e,n),rB("b",t,e,n))];case"Mul":return[rD(rB("a",t,e,n),rB("b",t,e,n))];case"RealDiv":case"Div":return[nD(rB("a",t,e,n),rB("b",t,e,n))];case"DivNoNan":return[eF(rB("a",t,e,n),rB("b",t,e,n))];case"FloorDiv":return[eD(rB("a",t,e,n),rB("b",t,e,n))];case"Sub":return[FF(rB("a",t,e,n),rB("b",t,e,n))];case"Minimum":return[YF(rB("a",t,e,n),rB("b",t,e,n))];case"Maximum":return[HF(rB("a",t,e,n),rB("b",t,e,n))];case"Pow":return[uF(rB("a",t,e,n),rB("b",t,e,n))];case"SquaredDifference":return[UL(rB("a",t,e,n),rB("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"basic_math":return jR((()=>((t,e,n)=>{switch(t.op){case"Abs":case"ComplexAbs":return[sD(rB("x",t,e,n))];case"Acos":return[oD(rB("x",t,e,n))];case"Acosh":return[iD(rB("x",t,e,n))];case"Asin":return[hD(rB("x",t,e,n))];case"Asinh":return[pD(rB("x",t,e,n))];case"Atan":return[dD(rB("x",t,e,n))];case"Atan2":return[mD(rB("x",t,e,n),rB("y",t,e,n))];case"Atanh":return[yD(rB("x",t,e,n))];case"Ceil":return[FD(rB("x",t,e,n))];case"Complex":return[tR(rB("real",t,e,n),rB("imag",t,e,n))];case"Cos":return[jD(rB("x",t,e,n))];case"Cosh":return[GD(rB("x",t,e,n))];case"Elu":return[rF(rB("x",t,e,n))];case"Erf":return[sF(rB("x",t,e,n))];case"Exp":return[yF(rB("x",t,e,n))];case"Expm1":return[bF(rB("x",t,e,n))];case"Floor":return[NF(rB("x",t,e,n))];case"Log":return[IF(rB("x",t,e,n))];case"Log1p":return[MF(rB("x",t,e,n))];case"Imag":return[qR(rB("x",t,e,n))];case"Neg":return[HR(rB("x",t,e,n))];case"Reciprocal":return[_L(rB("x",t,e,n))];case"Real":return[KR(rB("x",t,e,n))];case"Relu":return[TL(rB("x",t,e,n))];case"Round":return[CL(rB("x",t,e,n))];case"Selu":return[IL(rB("x",t,e,n))];case"Sigmoid":return[kD(rB("x",t,e,n))];case"Sin":return[DL(rB("x",t,e,n))];case"Sign":return[RL(rB("x",t,e,n))];case"Sinh":return[FL(rB("x",t,e,n))];case"Softplus":return[DF(rB("x",t,e,n))];case"Sqrt":return[lF(rB("x",t,e,n))];case"Square":return[fF(rB("x",t,e,n))];case"Tanh":return[CD(rB("x",t,e,n))];case"Tan":return[KL(rB("x",t,e,n))];case"ClipByValue":return[LD(rB("x",t,e,n),rB("clipValueMin",t,e,n),rB("clipValueMax",t,e,n))];case"Relu6":return[kL(rB("x",t,e,n))];case"Rsqrt":return[OL(sB(t.inputNames[0],e,n))];case"Prod":return[iL(rB("x",t,e,n),rB("axes",t,e,n))];case"LeakyRelu":return[TF(rB("x",t,e,n),rB("alpha",t,e,n))];case"Prelu":return[oL(rB("x",t,e,n),rB("alpha",t,e,n))];case"IsNan":return[_F(sB(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"control":return YB(t,e,n);case"convolution":return jR((()=>((t,e,n)=>{switch(t.op){case"Conv1D":{const r=rB("stride",t,e,n),s=rB("pad",t,e,n),o=rB("dataFormat",t,e,n).toUpperCase(),i=rB("dilation",t,e,n);return[VD(rB("x",t,e,n),rB("filter",t,e,n),r,s,o,i)]}case"Conv2D":{const r=rB("strides",t,e,n),s=uB(t,e,n),o=rB("dataFormat",t,e,n).toUpperCase(),i=rB("dilations",t,e,n);return[BD(rB("x",t,e,n),rB("filter",t,e,n),[r[1],r[2]],s,o,[i[1],i[2]])]}case"_FusedConv2D":{const{stride:r,pad:s,dataFormat:o,dilations:i,biasArg:a,preluArg:u,activationFunc:c,leakyreluAlpha:l}=ZB(t,e,n);return[hP({x:rB("x",t,e,n),filter:rB("filter",t,e,n),strides:[r[1],r[2]],pad:s,dataFormat:o,dilations:[i[1],i[2]],bias:a,activation:c,preluActivationWeights:u,leakyreluAlpha:l})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:s,dataFormat:o,dilations:i,biasArg:a,preluArg:u,activationFunc:c,leakyreluAlpha:l}=ZB(t,e,n);return[mP({x:rB("x",t,e,n),filter:rB("filter",t,e,n),strides:[r[1],r[2]],pad:s,dataFormat:o,dilations:[i[1],i[2]],bias:a,activation:c,preluActivationWeights:u,leakyreluAlpha:l})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=rB("outputShape",t,e,n),s=rB("strides",t,e,n),o=uB(t,e,n);return[WD(rB("x",t,e,n),rB("filter",t,e,n),r,[s[1],s[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=rB("strides",t,e,n),s=uB(t,e,n),o=rB("dilations",t,e,n),i=rB("dataFormat",t,e,n).toUpperCase();return[JD(rB("input",t,e,n),rB("filter",t,e,n),[r[1],r[2]],s,i,[o[1],o[2]])]}case"Conv3D":{const r=rB("strides",t,e,n),s=rB("pad",t,e,n),o=rB("dataFormat",t,e,n).toUpperCase(),i=rB("dilations",t,e,n);return[UD(rB("x",t,e,n),rB("filter",t,e,n),[r[1],r[2],r[3]],s,o,[i[1],i[2],i[3]])]}case"AvgPool":{const r=rB("strides",t,e,n),s=rB("pad",t,e,n),o=rB("kernelSize",t,e,n);return[SD(rB("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s)]}case"MaxPool":{const r=rB("strides",t,e,n),s=rB("pad",t,e,n),o=rB("kernelSize",t,e,n);return[jF(rB("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s)]}case"MaxPoolWithArgmax":{const r=rB("strides",t,e,n),s=rB("pad",t,e,n),o=rB("kernelSize",t,e,n),i=rB("includeBatchInIndex",t,e,n),{result:a,indexes:u}=qF(rB("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s,i);return[a,u]}case"AvgPool3D":{const r=rB("strides",t,e,n),s=rB("pad",t,e,n),o=rB("kernelSize",t,e,n);return[_D(rB("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],s)]}case"MaxPool3D":{const r=rB("strides",t,e,n),s=rB("pad",t,e,n),o=rB("kernelSize",t,e,n);return[GF(rB("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],s)]}case"Dilation2D":{const r=rB("strides",t,e,n),s=rB("pad",t,e,n),o=rB("dilations",t,e,n),i=r[1],a=r[2],u=o[1],c=o[2];return[YD(rB("x",t,e,n),rB("filter",t,e,n),[i,a],s,[u,c],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"creation":return jR((()=>((t,e,n)=>{switch(t.op){case"Fill":{const r=rB("shape",t,e,n),s=rB("dtype",t,e,n);return[xF(r,rB("value",t,e,n),s)]}case"LinSpace":return[CF(rB("start",t,e,n),rB("stop",t,e,n),rB("num",t,e,n))];case"Multinomial":{const r=rB("logits",t,e,n),s=rB("numSamples",t,e,n),o=rB("seed",t,e,n);return[tL(r,s,o)]}case"OneHot":{const r=rB("indices",t,e,n),s=rB("depth",t,e,n),o=rB("onValue",t,e,n),i=rB("offValue",t,e,n);return[UR(r,s,o,i)]}case"Ones":return[JF(rB("shape",t,e,n),rB("dtype",t,e,n))];case"OnesLike":return[nL(rB("x",t,e,n))];case"RandomUniform":return[EL(rB("shape",t,e,n),rB("minval",t,e,n),rB("maxval",t,e,n),rB("dtype",t,e,n))];case"Range":return[SL(rB("start",t,e,n),rB("stop",t,e,n),rB("step",t,e,n),rB("dtype",t,e,n))];case"TruncatedNormal":{const r=rB("shape",t,e,n),s=rB("mean",t,e,n),o=rB("stdDev",t,e,n),i=rB("seed",t,e,n);return[ZL(r,s,o,rB("dtype",t,e,n),i)]}case"Zeros":return[XF(rB("shape",t,e,n),rB("dtype",t,e,n))];case"ZerosLike":return[tF(rB("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"dynamic":return(async(t,e,n)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a,softNmsSigma:u}=QB(t,e,n),c=await JP.nonMaxSuppressionWithScoreAsync(r,s,o,i,a,u);return[c.selectedIndices,c.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a}=QB(t,e,n),u=rB("padToMaxOutputSize",t,e,n),c=await JP.nonMaxSuppressionPaddedAsync(r,s,o,i,a,u);return[c.selectedIndices,c.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a}=QB(t,e,n);return[await JP.nonMaxSuppressionAsync(r,s,o,i,a)]}case"Where":{const r=MR(rB("condition",t,e,n),"bool"),s=[await nP(r)];return r.dispose(),s}case"ListDiff":return ML(rB("x",t,e,n),rB("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n);case"evaluation":return jR((()=>((t,e,n)=>{switch(t.op){case"LowerBound":return[UF(rB("sortedSequence",t,e,n),rB("values",t,e,n))];case"TopKV2":{const r=rB("x",t,e,n),s=rB("k",t,e,n),o=rB("sorted",t,e,n),i=YL(r,s,o);return[i.values,i.indices]}case"UpperBound":return[eP(rB("sortedSequence",t,e,n),rB("values",t,e,n))];case"Unique":{const r=rB("x",t,e,n),s=QL(r);return[s.values,s.indices]}case"UniqueV2":{const r=rB("x",t,e,n),s=rB("axis",t,e,n),o=QL(r,s);return[o.values,o.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"image":return jR((()=>((t,e,n)=>{switch(t.op){case"ResizeBilinear":{const r=rB("images",t,e,n),s=rB("size",t,e,n),o=rB("alignCorners",t,e,n),i=rB("halfPixelCenters",t,e,n);return[JP.resizeBilinear(r,[s[0],s[1]],o,i)]}case"ResizeNearestNeighbor":{const r=rB("images",t,e,n),s=rB("size",t,e,n),o=rB("alignCorners",t,e,n),i=rB("halfPixelCenters",t,e,n);return[JP.resizeNearestNeighbor(r,[s[0],s[1]],o,i)]}case"CropAndResize":{const r=rB("image",t,e,n),s=rB("boxes",t,e,n),o=rB("boxInd",t,e,n),i=rB("cropSize",t,e,n),a=rB("method",t,e,n),u=rB("extrapolationValue",t,e,n);return[JP.cropAndResize(r,s,o,i,a,u)]}case"ImageProjectiveTransformV3":{const r=rB("images",t,e,n),s=rB("transforms",t,e,n),o=rB("outputShape",t,e,n),i=rB("fillValue",t,e,n),a=rB("interpolation",t,e,n),u=rB("fillMode",t,e,n);return[JP.transform(r,s,a.toLowerCase(),u.toLowerCase(),i,o)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"graph":return jR((()=>((t,e,n)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const r=rB("default",t,e,n);return[sB(t.name,e,n)||r];case"Placeholder":return[sB(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[cB(rB("x",t,e,n))];case"IdentityN":return rB("x",t,e,n).map((t=>cB(t)));case"Shape":return[XL(rB("x",t,e,n).shape,"int32")];case"ShapeN":return rB("x",t,e,n).map((t=>XL(t.shape)));case"Size":return[cF(rB("x",t,e,n).size,"int32")];case"Rank":return[cF(rB("x",t,e,n).rank,"int32")];case"NoOp":return[cF(1)];case"Print":const s=rB("x",t,e,n),o=rB("data",t,e,n),i=rB("message",t,e,n),a=rB("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(i);for(let t=0;t<o.length;t++)console.log(Array.prototype.slice.call(o[t].dataSync()).slice(0,a));return[s];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"logical":return jR((()=>((t,e,n)=>{switch(t.op){case"Equal":return[ZD(rB("a",t,e,n),rB("b",t,e,n))];case"NotEqual":return[eL(rB("a",t,e,n),rB("b",t,e,n))];case"Greater":return[EF(rB("a",t,e,n),rB("b",t,e,n))];case"GreaterEqual":return[SF(rB("a",t,e,n),rB("b",t,e,n))];case"Less":return[kF(rB("a",t,e,n),rB("b",t,e,n))];case"LessEqual":return[AF(rB("a",t,e,n),rB("b",t,e,n))];case"LogicalAnd":return[BF(rB("a",t,e,n),rB("b",t,e,n))];case"LogicalNot":return[VF(rB("a",t,e,n))];case"LogicalOr":return[zF(rB("a",t,e,n),rB("b",t,e,n))];case"Select":case"SelectV2":return[QD(rB("condition",t,e,n),rB("a",t,e,n),rB("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"matrices":return jR((()=>((t,e,n)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[WR(rB("a",t,e,n),rB("b",t,e,n),rB("transposeA",t,e,n),rB("transposeB",t,e,n))];case"Einsum":return[nF(rB("equation",t,e,n),...rB("tensors",t,e,n))];case"Transpose":return[XR(rB("x",t,e,n),rB("perm",t,e,n))];case"_FusedMatMul":const[r,s]=rB("fusedOps",t,e,n),o="biasadd"===r,i="prelu"===s,a=rB("numArgs",t,e,n),u=rB("leakyreluAlpha",t,e,n);if(o){if(i&&2!==a)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!i&&1!==a)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[c,l]=rB("args",t,e,n);return[yP({a:rB("a",t,e,n),b:rB("b",t,e,n),transposeA:rB("transposeA",t,e,n),transposeB:rB("transposeB",t,e,n),bias:c,activation:s,preluActivationWeights:l,leakyreluAlpha:u})];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"normalization":return jR((()=>((t,e,n)=>{switch(t.op){case"EuclideanNorm":return[mF(rB("x",t,e,n),rB("axis",t,e,n),rB("keepDims",t,e,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[ID(rB("x",t,e,n),rB("mean",t,e,n),rB("variance",t,e,n),rB("offset",t,e,n),rB("scale",t,e,n),rB("epsilon",t,e,n))];case"LRN":return[OF(rB("x",t,e,n),rB("radius",t,e,n),rB("bias",t,e,n),rB("alpha",t,e,n),rB("beta",t,e,n))];case"Softmax":return[LL(rB("x",t,e,n))];case"LogSoftmax":return[LF(rB("x",t,e,n))];case"SparseToDense":return[sP(rB("sparseIndices",t,e,n),rB("outputShape",t,e,n),rB("sparseValues",t,e,n),rB("defaultValue",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"reduction":return jR((()=>((t,e,n)=>{switch(t.op){case"Max":{const r=rB("axis",t,e,n),s=rB("keepDims",t,e,n);return[iF(rB("x",t,e,n),r,s)]}case"Mean":{const r=rB("axis",t,e,n),s=rB("keepDims",t,e,n);return[KF(rB("x",t,e,n),r,s)]}case"Min":{const r=rB("axis",t,e,n),s=rB("keepDims",t,e,n);return[aF(rB("x",t,e,n),r,s)]}case"Sum":{const r=rB("axis",t,e,n),s=rB("keepDims",t,e,n);return[hF(rB("x",t,e,n),r,s)]}case"All":{const r=rB("axis",t,e,n),s=rB("keepDims",t,e,n);return[uD(rB("x",t,e,n),r,s)]}case"Any":{const r=rB("axis",t,e,n),s=rB("keepDims",t,e,n);return[cD(rB("x",t,e,n),r,s)]}case"ArgMax":{const r=rB("axis",t,e,n);return[lD(rB("x",t,e,n),r)]}case"ArgMin":{const r=rB("axis",t,e,n);return[fD(rB("x",t,e,n),r)]}case"Prod":{const r=rB("axis",t,e,n),s=rB("keepDims",t,e,n);return[iL(rB("x",t,e,n),r,s)]}case"Cumprod":{const r=rB("axis",t,e,n),s=rB("exclusive",t,e,n),o=rB("reverse",t,e,n);return[qD(rB("x",t,e,n),r,s,o)]}case"Cumsum":{const r=rB("axis",t,e,n),s=rB("exclusive",t,e,n),o=rB("reverse",t,e,n);return[HD(rB("x",t,e,n),r,s,o)]}case"Bincount":const r=rB("x",t,e,n),s=rB("weights",t,e,n),o=rB("size",t,e,n);return[MD(r,s,o)];case"DenseBincount":{const r=rB("x",t,e,n),s=rB("weights",t,e,n),o=rB("size",t,e,n),i=rB("binaryOutput",t,e,n);return[KD(r,s,o,i)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"slice_join":return jR((()=>((t,e,n)=>{switch(t.op){case"ConcatV2":case"Concat":{const r=rB("n",t,e,n),s=rB("axis",t,e,n);let o=rB("tensors",t,e,n);return o=o.slice(0,r),[TD(o,s)]}case"Gather":{const r=rB("x",t,e,n),s=rB("indices",t,e,n);return[$F(r,MR(s,"int32"),0)]}case"GatherV2":{const r=rB("axis",t,e,n),s=rB("batchDims",t,e,n),o=rB("x",t,e,n),i=rB("indices",t,e,n);return[$F(o,MR(i,"int32"),r,s)]}case"Reverse":{const r=rB("dims",t,e,n),s=[];for(let t=0;t<r.length;t++)r[t]&&s.push(t);const o=rB("x",t,e,n);return[AL(o,s)]}case"ReverseV2":{const r=rB("axis",t,e,n),s=rB("x",t,e,n);return[AL(s,r)]}case"Slice":{const r=rB("begin",t,e,n),s=rB("size",t,e,n);return[AD(rB("x",t,e,n),r,s)]}case"StridedSlice":{const r=rB("begin",t,e,n),s=rB("end",t,e,n),o=rB("strides",t,e,n),i=rB("beginMask",t,e,n),a=rB("endMask",t,e,n),u=rB("ellipsisMask",t,e,n),c=rB("newAxisMask",t,e,n),l=rB("shrinkAxisMask",t,e,n),f=rB("x",t,e,n);return[HL(f,r,s,o,i,a,u,c,l)]}case"Pack":return jR((()=>{const r=rB("axis",t,e,n),s=rB("tensors",t,e,n),o=s[0].shape,i=jL(s[0]).shape,a=s.map((t=>{const e=wO(t.shape,o);if(!e&&!wO(jL(t).shape,i))throw new Error("the input tensors shape does not match");return e?t:ED(t,o)}));return[GL(a,r)]}));case"Unpack":{const r=rB("axis",t,e,n),s=rB("tensor",t,e,n);return tP(s,r)}case"Tile":{const r=rB("reps",t,e,n);return[wF(rB("x",t,e,n),r)]}case"Split":case"SplitV":{const r=rB("axis",t,e,n),s=rB("numOrSizeSplits",t,e,n),o=rB("x",t,e,n);return zL(o,s,r)}case"ScatterNd":{const r=rB("indices",t,e,n),s=rB("values",t,e,n),o=rB("shape",t,e,n);return[rP(r,s,o)]}case"GatherNd":{const r=rB("x",t,e,n),s=rB("indices",t,e,n);return[oP(r,s)]}case"SparseToDense":{const r=rB("sparseIndices",t,e,n),s=rB("outputShape",t,e,n),o=rB("sparseValues",t,e,n),i=rB("defaultValue",t,e,n);return[sP(r,o,s,o.dtype===i.dtype?i:MR(i,o.dtype))]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"sparse":return jR((()=>((t,e,n)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:s,emptyRowIndicator:o,reverseIndexMap:i}=YP.sparseFillEmptyRows(rB("indices",t,e,n),rB("values",t,e,n),rB("denseShape",t,e,n),rB("defaultValue",t,e,n));return[r,s,o,i]}case"SparseReshape":{const{outputIndices:r,outputShape:s}=YP.sparseReshape(rB("inputIndices",t,e,n),rB("inputShape",t,e,n),rB("newShape",t,e,n));return[r,s]}case"SparseSegmentMean":return[YP.sparseSegmentMean(rB("data",t,e,n),rB("indices",t,e,n),rB("segmentIds",t,e,n))];case"SparseSegmentSum":return[YP.sparseSegmentSum(rB("data",t,e,n),rB("indices",t,e,n),rB("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"spectral":return jR((()=>((t,e,n)=>{switch(t.op){case"FFT":return[PL(rB("x",t,e,n))];case"IFFT":return[BL(rB("x",t,e,n))];case"RFFT":return[WL(rB("x",t,e,n))];case"IRFFT":return[VL(rB("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"string":return jR((()=>((t,e,n)=>{switch(t.op){case"StringNGrams":{const{nGrams:r,nGramsSplits:s}=ZP.stringNGrams(rB("data",t,e,n),rB("dataSplits",t,e,n),rB("separator",t,e,n),rB("nGramWidths",t,e,n),rB("leftPad",t,e,n),rB("rightPad",t,e,n),rB("padWidth",t,e,n),rB("preserveShortSequences",t,e,n));return[r,s]}case"StringSplit":{const{indices:r,values:s,shape:o}=ZP.stringSplit(rB("input",t,e,n),rB("delimiter",t,e,n),rB("skipEmpty",t,e,n));return[r,s,o]}case"StringToHashBucketFast":return[ZP.stringToHashBucketFast(rB("input",t,e,n),rB("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"transformation":return jR((()=>((t,e,n)=>{switch(t.op){case"Cast":return[MR(rB("x",t,e,n),rB("dtype",t,e,n))];case"ExpandDims":{const r=rB("axis",t,e,n);return[gF(rB("x",t,e,n),r)]}case"Squeeze":{const r=rB("axis",t,e,n);return[jL(rB("x",t,e,n),r)]}case"Reshape":return[ED(rB("x",t,e,n),rB("shape",t,e,n))];case"MirrorPad":return[ZF(rB("x",t,e,n),rB("padding",t,e,n),rB("mode",t,e,n))];case"PadV2":case"Pad":return[rL(rB("x",t,e,n),rB("padding",t,e,n),rB("constantValue",t,e,n))];case"SpaceToBatchND":{const r=rB("blockShape",t,e,n),s=rB("paddings",t,e,n);return[sL(rB("x",t,e,n),r,s)]}case"BatchToSpaceND":{const r=rB("blockShape",t,e,n),s=rB("crops",t,e,n);return[OD(rB("x",t,e,n),r,s)]}case"DepthToSpace":{const r=rB("blockSize",t,e,n),s=rB("dataFormat",t,e,n).toUpperCase();return[XD(rB("x",t,e,n),r,s)]}case"BroadcastTo":return[DD(rB("x",t,e,n),rB("shape",t,e,n))];case"BroadcastArgs":return[RD(rB("s0",t,e,n),rB("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"hash_table":return(async(t,e,n,r)=>{switch(t.op){case"HashTable":case"HashTableV2":{const s=rB("keyDType",t,e,n),o=rB("valueDType",t,e,n),i=new tV(s,o);return r.addHashTable(t.name,i),[i.handle]}case"LookupTableImport":case"LookupTableImportV2":{const s=rB("tableHandle",t,e,n,r),o=rB("keys",t,e,n),i=rB("values",t,e,n),a=r.getHashTableById(s.id);return[await a.import(o,i)]}case"LookupTableFind":case"LookupTableFindV2":{const s=rB("tableHandle",t,e,n,r),o=rB("keys",t,e,n),i=rB("defaultValue",t,e,n),a=r.getHashTableById(s.id);return[await a.find(o,i)]}case"LookupTableSize":case"LookupTableSizeV2":{const s=rB("tableHandle",t,e,n,r);return[r.getHashTableById(s.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n,r);case"custom":const s=nB(t.op);if(s&&s.customExecutor)return s.customExecutor(new jB(t,e,n));throw TypeError(`Custom op ${t.op} is not registered.`);default:throw TypeError(`Unknown op '${t.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return RO(s)?s.then((t=>[].concat(t))):[].concat(s)}class nV{constructor(t={},e={},n={},r={}){this.weightMap=t,this.tensorArrayMap=e,this.tensorListMap=n,this.functionMap=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(t,e){return{id:t,frameName:e,iterationId:0}}set currentContext(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const t=[];for(let e=0;e<this.contexts.length-1;e++){const n=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(n))}t.push(""),this._currentContextIds=t}contextIdforContexts(t){return t?t.map((t=>0===t.id&&0===t.iterationId?"":`${t.frameName}-${t.iterationId}`)).join("/"):""}enterFrame(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(t){return this.weightMap[t]}addTensorArray(t){this.tensorArrayMap[t.id]=t}getTensorArray(t){return this.tensorArrayMap[t]}addTensorList(t){this.tensorListMap[t.id]=t}getTensorList(t){return this.tensorListMap[t]}dispose(t){for(const e in this.tensorArrayMap)this.tensorArrayMap[e].clearAndClose(t);for(const e in this.tensorListMap)this.tensorListMap[e].clearAndClose(t)}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rV(t,e,n,r){const s=new Set,o=[];let i=null,a=null;const u=new Set,c=Object.keys(t).map((t=>aB(t)[0]));let l=[];null!=r&&(l=r.map((t=>aB(t.name)[0])));const f=[...e];for(;f.length>0;){const t=f.pop();(aV(t)||uV(t)||cV(t))&&null==i&&(i=t,a=i.children.map((t=>t.name)).filter((t=>s.has(t)))),s.add(t.name),null==n[t.name]&&(-1===c.indexOf(t.name)&&-1===l.indexOf(t.name)&&(0!==t.inputs.length?t.inputs.forEach((t=>{u.has(t.name)||(u.add(t.name),f.push(t))})):o.push(t.name)))}return{inputs:t,outputs:e,usedNodes:s,missingInputs:o,dynamicNode:i,syncInputs:a}}const sV=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],oV=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],iV=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function aV(t){return sV.indexOf(t.op)>=0}function uV(t){return oV.indexOf(t.op)>=0}function cV(t){return iV.indexOf(t.op)>=0}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lV{constructor(t,e){this.graph=t,this.parent=e,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((e=>{this._functionExecutorMap[e]=new lV(t.functions[e],this)}))}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){const e=Object.keys(t).map((e=>t[e].map((t=>t.id))));this._weightIds=[].concat(...e),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get outputs(){return this._outputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get inputNodes(){return this._inputs.map((t=>t.signatureKey||t.name))}get outputNodes(){return this._outputs.map((t=>{const e=t.signatureKey||t.name;return t.defaultOutput?`${e}:${t.defaultOutput}`:e}))}get functions(){return Object.keys(this._functions).reduce(((t,e)=>(t[e]=this._functions[e].signature,t)),{})}getCompilationKey(t,e){const n=t.map((t=>t.name)).sort(),r=e.map((t=>t.name)).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}compile(t,e){const n=rV(t,e,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:s,syncInputs:o}=n;if(null!=s)throw new Error(`This execution contains the node '${s.name}', which has the dynamic op '${s.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(r.length>0){const n=e.map((t=>t.name)),s=Object.keys(t);throw new Error(`Cannot compute the outputs [${n}] from the provided inputs [${s}]. Missing the following inputs: [${r}]`)}return function(t,e,n){const{usedNodes:r,inputs:s}=n,o=[],i=Object.keys(s).map((t=>aB(t)[0])).map((e=>t.nodes[e])),a=t.initNodes;i.forEach((t=>{r.has(t.name)&&o.push(t)})),t.weights.forEach((t=>{r.has(t.name)&&o.push(t)})),null!=a&&a.forEach((t=>{r.has(t.name)&&o.push(t)}));const u=new Set,c=[];for(;o.length>0;){const t=o.pop();u.add(t.name),e[t.name]||c.push(t),t.children.forEach((t=>{!u.has(t.name)&&r.has(t.name)&&t.inputs.every((t=>u.has(t.name)))&&o.push(t)}))}return c}(this.graph,this.weightMap,n)}execute(t,e){t=this.mapInputs(t);const n=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e);const r=n.map((t=>this.graph.nodes[aB(t)[0]])),s=e.map((t=>aB(t)[0]));let o=s.map((t=>this.graph.nodes[t]));this.resetIntermediateTensors(),0===o.length&&(o=this._outputs);const i=this.getCompilationKey(r,o);let a=this.compiledMap.get(i);null==a&&(a=this.compile(t,o),this.compiledMap.set(i,a));const u={},c={};return jR((()=>{const n=new nV(this.weightMap,u,c,this.functionExecutorMap),r=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,s]=aB(e),o=[];o[s]=t[e],r[n]=o}));const o=this.getFrozenTensorIds(r),i={};for(let t=0;t<a.length;t++){const e=a[t];if(!r[e.name]){const t=eV(e,r,n,this._resourceManager);if(RO(t))throw new Error(`The execution of the op '${e.op}' returned a promise. Please use model.executeAsync() instead.`);r[e.name]=t,this.checkTensorForDisposal(e.name,e,r,n,o,s,i)}}return null==this.parent&&n.dispose(o),e.map((t=>sB(t,r,n)))}))}getFrozenTensorIds(t){const e=[].concat.apply([],Object.keys(t).map((e=>t[e])).map((t=>t.map((t=>t.id)))));return new Set(e)}checkTensorForDisposal(t,e,n,r,s,o,i){"control"!==e.category&&-1===o.indexOf(t)&&(n[t].forEach((t=>{null!=t&&(i[t.id]=(i[t.id]||0)+e.children.length)})),e.inputs.forEach((t=>{if("control"!==t.category){const o=function(t,e,n){return e[iB(t,n.currentContextId)]}(t.name,n,r);null!=o&&o.forEach((t=>{if(t&&!t.kept&&!s.has(t.id)){const n=i[t.id];if(1===n){if(this.keepTensorForDebug){const[n,s]=oB(e.name,r);this.intermediateTensors[n]||(this.intermediateTensors[n]=[]),this.intermediateTensors[n][s]=t}else t.dispose();delete i[t.id]}else null!=n&&i[t.id]--}}))}})))}async executeAsync(t,e){return this._executeAsync(t,e)}disposeIntermediateTensors(){this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach((t=>this.intermediateTensors[t].forEach((t=>t.dispose())))),this.disposeTensorsMap())}disposeTensorsMap(){this.tensorsMap&&Object.keys(this.tensorsMap).forEach((t=>{this.tensorsMap[t].forEach((t=>{!t||t.kept||t.isDisposed||this.keepIds.has(t.id)||t.dispose()}))}))}getIntermediateTensors(){return this.tensorsMap}resetIntermediateTensors(){for(const t in this.intermediateTensors)this.intermediateTensors[t].forEach((t=>t.dispose())),delete this.intermediateTensors[t]}async _executeAsync(t,e,n=!1,r={},s={}){n||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e));try{this.keepTensorForDebug=LO().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(t){console.warn(t.message)}this.resetIntermediateTensors();const o=new nV(this.weightMap,r,s,this.functionExecutorMap);this.tensorsMap=await this.executeWithControlFlow(t,o,e,n);const i=e.map((t=>sB(t,this.tensorsMap,o))),a=i.map((t=>t.id)),u=Object.keys(t).map((e=>t[e].id));return this.keepIds=new Set([...a,...u,...this.weightIds]),this.keepTensorForDebug||this.disposeTensorsMap(),null==this.parent&&o.dispose(this.keepIds),i}async executeFunctionAsync(t,e,n){const r=t.reduce(((t,e,n)=>(t[this.inputs[n].name]=e,t)),{});return this._executeAsync(r,this.outputNodes,!0,e,n)}async executeWithControlFlow(t,e,n,r){const s=Object.keys(t),o=s.map((t=>this.graph.nodes[aB(t)[0]])),i=n.map((t=>aB(t)[0]));let a=i.map((t=>this.graph.nodes[t]));0===a.length&&(a=this._outputs);const{usedNodes:u,missingInputs:c,dynamicNode:l,syncInputs:f}=rV(t,a,this.weightMap,this._initNodes),h=[...o,...this.graph.weights,...this._initNodes||[]].map((t=>({node:t,contexts:e.currentContext}))),p=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,r]=aB(e),s=[];s[r]=t[e],p[n]=s}));const d={},m=this.getFrozenTensorIds(p),y={};for(;h.length>0;){const t=this.processStack(o,h,e,p,y,m,i,d,u);await Promise.all(t)}null!=l||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const g=a.filter((t=>!aV(t)&&!sB(t.name,p,e))).map((t=>t.name));if(g.length>0){let t="";throw null!=l&&(t=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${f}]`),new Error(`Cannot compute the outputs [${g}] from the provided inputs [${s}]. Consider providing the following inputs: [${c}]. ${t}`)}return p}processStack(t,e,n,r,s,o,i,a,u){const c=[];for(;e.length>0;){const t=e.pop();n.currentContext=t.contexts;let l="";if("Enter"===t.node.op&&rB("isConstant",t.node,r,n)&&([l]=oB(t.node.name,n)),null==r[t.node.name]){const f=eV(t.node,r,n,this._resourceManager);l||([l]=oB(t.node.name,n));const h=n.currentContext;RO(f)?c.push(f.then((c=>(r[l]=c,n.currentContext=h,this.checkTensorForDisposal(l,t.node,r,n,o,i,a),this.processChildNodes(t.node,e,n,r,s,u),c)))):(r[l]=f,this.checkTensorForDisposal(l,t.node,r,n,o,i,a),this.processChildNodes(t.node,e,n,r,s,u))}else this.processChildNodes(t.node,e,n,r,s,u)}return c}processChildNodes(t,e,n,r,s,o){t.children.forEach((t=>{const[i]=oB(t.name,n);!s[i]&&o.has(t.name)&&("Merge"===t.op?t.inputNames.some((t=>!!sB(t,r,n)))&&(s[i]=!0,e.push({contexts:n.currentContext,node:t})):t.inputNames.every((t=>!!sB(t,r,n)))&&(s[i]=!0,e.push({contexts:n.currentContext,node:t})))}))}dispose(){Object.keys(this.weightMap).forEach((t=>this.weightMap[t].forEach((t=>t.dispose()))))}checkInputShapeAndType(t){Object.keys(t).forEach((e=>{const n=t[e],[r]=aB(e),s=this.graph.nodes[r];if(s.attrParams.shape&&s.attrParams.shape.value){const t=s.attrParams.shape.value,e=t.length===n.shape.length&&n.shape.every(((e,n)=>-1===t[n]||t[n]===e));dO(e,(()=>`The shape of dict['${s.name}'] provided in model.execute(dict) must be [${t}], but was [${n.shape}]`))}s.attrParams.dtype&&s.attrParams.dtype.value&&dO(n.dtype===s.attrParams.dtype.value,(()=>`The dtype of dict['${s.name}'] provided in model.execute(dict) must be ${s.attrParams.dtype.value}, but was ${n.dtype}`))}))}mapInputs(t){const e={};for(const n in t)if(null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]){e[this._signature.inputs[n].name]=t[n]}else e[n]=t[n];return e}checkInputs(t){const e=Object.keys(t).filter((t=>{const[e]=aB(t);return null==this.graph.nodes[e]}));if(e.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${e}] that are not part of graph`)}mapOutputs(t){return t.map((t=>{if(null!=this._signature&&null!=this._signature.outputs&&null!=this._signature.outputs[t]){return this._signature.outputs[t].name}return t}),{})}checkOutputs(t){t.forEach((t=>{const[e]=aB(t);if(!this.graph.nodes[e])throw new Error(`The output '${t}' is not found in the graph`)}))}}class fV{constructor(t={},e={}){this.hashTableNameToHandle=t,this.hashTableMap=e}addHashTable(t,e){this.hashTableNameToHandle[t]=e.handle,this.hashTableMap[e.id]=e}getHashTableHandleByName(t){return this.hashTableNameToHandle[t]}getHashTableById(t){return this.hashTableMap[t]}dispose(){for(const t in this.hashTableMap)this.hashTableMap[t].clearAndClose(),delete this.hashTableMap[t];for(const t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hV{constructor(t,e={}){this.modelUrl=t,this.loadOptions=e,this.version="n/a",null==e&&(this.loadOptions={}),this.resourceManager=new fV}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}findIOHandler(){const t=this.modelUrl;if(null!=t.load)this.handler=t;else if(null!=this.loadOptions.requestInit)this.handler=zR(t,this.loadOptions);else{const r=(e=t,n=this.loadOptions,cR.getLoadHandlers(e,n));if(0===r.length)r.push(zR(t,this.loadOptions));else if(r.length>1)throw new Error(`Found more than one (${r.length}) load handlers for URL '${[t]}'`);this.handler=r[0]}var e,n;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */}load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const t=this.handler.load();return RO(t)?t.then((t=>this.loadSync(t))):this.loadSync(t)}loadSync(t){this.artifacts=t;const e=this.artifacts.modelTopology;let n;n=null!=this.artifacts.userDefinedMetadata&&null!=this.artifacts.userDefinedMetadata.signature?this.artifacts.userDefinedMetadata.signature:this.artifacts.signature,this.signature=n,this.version=`${e.versions.producer}.${e.versions.minConsumer}`;const r=function(t,e){const n={};let r,s=0;for(const o of e){const e=o.name,i=o.dtype,a=o.shape,u=bO(a);let c;if("quantization"in o){const n=o.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error(`Weight ${o.name} with quantization ${n.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==n.dtype)throw new Error(`Weight ${o.name} has unknown quantization dtype ${n.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==i)throw new Error(`Weight ${o.name} is quantized with ${n.dtype} which only supports weights of type float32 not ${i}.`)}const a=rR[n.dtype],l=t.slice(s,s+u*a),f="uint8"===n.dtype?new Uint8Array(l):new Uint16Array(l);if("float32"===i)if("uint8"===n.dtype||"uint16"===n.dtype){c=new Float32Array(f.length);for(let t=0;t<f.length;t++){const e=f[t];c[t]=e*n.scale+n.min}}else{if("float16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type float32.`);void 0===r&&(r=uR()),c=r(f)}else{if("int32"!==i)throw new Error(`Unsupported dtype in weight '${e}': ${i}`);if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type int32.`);c=new Int32Array(f.length);for(let t=0;t<f.length;t++){const e=f[t];c[t]=Math.round(e*n.scale+n.min)}}s+=u*a}else if("string"===i){const e=bO(o.shape);c=[];for(let n=0;n<e;n++){const e=new Uint32Array(t.slice(s,s+4))[0];s+=4;const n=new Uint8Array(t.slice(s,s+e));c.push(n),s+=e}}else{const r=rR[i],o=t.slice(s,s+u*r);if("float32"===i)c=new Float32Array(o);else if("int32"===i)c=new Int32Array(o);else if("bool"===i)c=new Uint8Array(o);else{if("complex64"!==i)throw new Error(`Unsupported dtype in weight '${e}': ${i}`);{c=new Float32Array(o);const t=new Float32Array(c.length/2),r=new Float32Array(c.length/2);for(let e=0;e<t.length;e++)t[e]=c[2*e],r[e]=c[2*e+1];const s=nR(t,a,"float32"),i=nR(r,a,"float32");n[e]=tR(s,i),s.dispose(),i.dispose()}}s+=u*r}"complex64"!==i&&(n[e]=nR(c,a,i))}return n}(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new lV(AB.Instance.transformGraph(e,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=t.modelInitializer&&null!=t.modelInitializer.node){const e=AB.Instance.transformGraph(t.modelInitializer);this.initializer=new lV(e),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(t,e){if("string"==typeof t){const e=(n=t,cR.getSaveHandlers(n));if(0===e.length)throw new Error(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new Error(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}var n;if(null==t.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return t.save(this.artifacts)}predict(t,e){return this.execute(t,this.outputNodes)}normalizeInputs(t){if(!(t instanceof RI||Array.isArray(t)))return t;if((t=Array.isArray(t)?t:[t]).length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${t.length} input tensors.`);return this.inputNodes.reduce(((e,n,r)=>(e[n]=t[r],e)),{})}normalizeOutputs(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]}execute(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=this.executor.execute(t,e);return n.length>1?n:n[0]}async executeAsync(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=await this.executor.executeAsync(t,e);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(t){return Object.keys(t).reduce(((e,n)=>(e[n]=[t[n]],e)),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}async function pV(t,e={}){if(null==t)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==e&&(e={}),e.fromTFHub&&"string"==typeof t&&(t=function(t){t.endsWith("/")||(t+="/");return`${t}model.json?tfjs-format=file`}
/**
    * @license
    * Copyright 2021 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */(t));const n=new hV(t,e);return await n.load(),n}var dV=function(){return(dV=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)};function mV(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}u((r=r.apply(t,e||[])).next())}))}function yV(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((s=(s=i.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function gV(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}u((r=r.apply(t,e||[])).next())}))}function bV(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=(s=i.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var wV=function(t){return{startEndTensor:t,startPoint:AD(t,[0,0],[-1,2]),endPoint:AD(t,[0,2],[-1,2])}},vV={strides:[8,16],anchors:[2,6]};function xV(t,e){var n,r,s;if(t.topLeft instanceof RI&&t.bottomRight instanceof RI){var o=jR((function(){return[TD([AD(FF(e-1,t.topLeft),0,1),AD(t.topLeft,1,1)]),TD([FF(e-1,AD(t.bottomRight,0,1)),AD(t.bottomRight,1,1)])]}));n=o[0],r=o[1],null!=t.landmarks&&(s=jR((function(){var n=FF(XL([e-1,0]),t.landmarks),r=XL([1,-1]);return rD(n,r)})))}else{var i=t.topLeft,a=i[0],u=i[1],c=t.bottomRight,l=c[0],f=c[1];n=[e-1-a,u],r=[e-1-l,f],null!=t.landmarks&&(s=t.landmarks.map((function(t){return[e-1-t[0],t[1]]})))}var h={topLeft:n,bottomRight:r};return null!=s&&(h.landmarks=s),null!=t.probability&&(h.probability=t.probability instanceof RI?t.probability.clone():t.probability),h}function NV(t,e){return jR((function(){var n;return n=t.hasOwnProperty("box")?t.box:t,jL(function(t,e){var n=rD(t.startPoint,e),r=rD(t.endPoint,e),s=PD([n,r],1);return wV(s)}(n,e).startEndTensor)}))}var $V=function(){function t(t,e,n,r,s,o){this.blazeFaceModel=t,this.width=e,this.height=n,this.maxFaces=r,this.anchorsData=function(t,e,n){for(var r=[],s=0;s<n.strides.length;s++)for(var o=n.strides[s],i=Math.floor((e+o-1)/o),a=Math.floor((t+o-1)/o),u=n.anchors[s],c=0;c<i;c++)for(var l=o*(c+.5),f=0;f<a;f++)for(var h=o*(f+.5),p=0;p<u;p++)r.push([h,l]);return r}(e,n,vV),this.anchors=JL(this.anchorsData),this.inputSizeData=[e,n],this.inputSize=XL([e,n]),this.iouThreshold=s,this.scoreThreshold=o}return t.prototype.getBoundingBoxes=function(t,e,n){return void 0===n&&(n=!0),gV(this,void 0,void 0,(function(){var r,s,o,i,a,u,c,l,f,h,p,d,m,y,g=this;return bV(this,(function(b){switch(b.label){case 0:return r=jR((function(){var e=JP.resizeBilinear(t,[g.width,g.height]),n=rD(FF(nD(e,255),.5),2),r=g.blazeFaceModel.predict(n),s=jL(r),o=function(t,e,n){var r=AD(t,[0,1],[-1,2]),s=tD(r,e),o=AD(t,[0,3],[-1,2]),i=nD(o,n),a=nD(s,n),u=nD(i,2),c=FF(a,u),l=tD(a,u),f=rD(c,n),h=rD(l,n);return PD([f,h],1)}(s,g.anchors,g.inputSize),i=AD(s,[0,0],[-1,1]);return[s,o,jL(kD(i))]})),s=r[0],o=r[1],i=r[2],a=console.warn,console.warn=function(){},u=JP.nonMaxSuppression(o,i,this.maxFaces,this.iouThreshold,this.scoreThreshold),console.warn=a,[4,u.array()];case 1:return c=b.sent(),u.dispose(),l=c.map((function(t){return AD(o,[t,0],[1,-1])})),e?[3,3]:[4,Promise.all(l.map((function(t){return gV(g,void 0,void 0,(function(){var e;return bV(this,(function(n){switch(n.label){case 0:return[4,t.array()];case 1:return e=n.sent(),t.dispose(),[2,e]}}))}))})))];case 2:l=b.sent(),b.label=3;case 3:for(f=t.shape[1],h=t.shape[2],p=e?nD([h,f],this.inputSize):[h/this.inputSizeData[0],f/this.inputSizeData[1]],d=[],m=function(t){var r=l[t],o=jR((function(){var o=wV(r instanceof RI?r:JL(r));if(!n)return o;var a,u=c[t];return a=e?AD(g.anchors,[u,0],[1,2]):g.anchorsData[u],{box:o,landmarks:ED(jL(AD(s,[u,5],[1,-1])),[6,-1]),probability:AD(i,[u],[1]),anchor:a}}));d.push(o)},y=0;y<l.length;y++)m(y);return o.dispose(),i.dispose(),s.dispose(),[2,{boxes:d,scaleFactor:p}]}}))}))},t.prototype.estimateFaces=function(t,e,n,r){return void 0===e&&(e=!1),void 0===n&&(n=!1),void 0===r&&(r=!0),gV(this,void 0,void 0,(function(){var s,o,i,a,u,c,l=this;return bV(this,(function(f){switch(f.label){case 0:return s=function(t){return t instanceof RI?[t.shape[0],t.shape[1]]:[t.height,t.width]}(t),o=s[1],i=jR((function(){return t instanceof RI||(t=ZR(t)),gF(MR(t,"float32"),0)})),[4,this.getBoundingBoxes(i,e,r)];case 1:return a=f.sent(),u=a.boxes,c=a.scaleFactor,i.dispose(),e?[2,u.map((function(t){var e=NV(t,c),s={topLeft:AD(e,[0],[2]),bottomRight:AD(e,[2],[2])};if(r){var i=t,a=i.landmarks,u=i.probability,l=i.anchor,f=rD(tD(a,l),c);s.landmarks=f,s.probability=u}return n&&(s=xV(s,o)),s}))]:[2,Promise.all(u.map((function(t){return gV(l,void 0,void 0,(function(){var e,s,i,a,u,l,f,h,p,d,m,y=this;return bV(this,(function(g){switch(g.label){case 0:return e=NV(t,c),r?[3,2]:[4,e.array()];case 1:return u=g.sent(),s={topLeft:u.slice(0,2),bottomRight:u.slice(2)},[3,4];case 2:return[4,Promise.all([t.landmarks,e,t.probability].map((function(t){return gV(y,void 0,void 0,(function(){return bV(this,(function(e){return[2,t.array()]}))}))})))];case 3:i=g.sent(),a=i[0],u=i[1],l=i[2],f=t.anchor,p=(h=c)[0],d=h[1],m=a.map((function(t){return[(t[0]+f[0])*p,(t[1]+f[1])*d]})),s={topLeft:u.slice(0,2),bottomRight:u.slice(2),landmarks:m,probability:l},function(t){t.startEndTensor.dispose(),t.startPoint.dispose(),t.endPoint.dispose()}(t.box),t.landmarks.dispose(),t.probability.dispose(),g.label=4;case 4:return e.dispose(),n&&(s=xV(s,o)),[2,s]}}))}))})))]}}))}))},t}();function EV(t){var e=void 0===t?{}:t,n=e.maxFaces,r=void 0===n?10:n,s=e.inputWidth,o=void 0===s?128:s,i=e.inputHeight,a=void 0===i?128:i,u=e.iouThreshold,c=void 0===u?.3:u,l=e.scoreThreshold,f=void 0===l?.75:l,h=e.modelUrl;return gV(this,void 0,void 0,(function(){var t;return bV(this,(function(e){switch(e.label){case 0:return null==h?[3,2]:[4,pV(h)];case 1:return t=e.sent(),[3,4];case 2:return[4,pV("https://tfhub.dev/tensorflow/tfjs-model/blazeface/1/default/1",{fromTFHub:!0})];case 3:t=e.sent(),e.label=4;case 4:return[2,new $V(t,o,a,r,c,f)]}}))}))}var SV={silhouette:[10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109],lipsUpperOuter:[61,185,40,39,37,0,267,269,270,409,291],lipsLowerOuter:[146,91,181,84,17,314,405,321,375,291],lipsUpperInner:[78,191,80,81,82,13,312,311,310,415,308],lipsLowerInner:[78,95,88,178,87,14,317,402,318,324,308],rightEyeUpper0:[246,161,160,159,158,157,173],rightEyeLower0:[33,7,163,144,145,153,154,155,133],rightEyeUpper1:[247,30,29,27,28,56,190],rightEyeLower1:[130,25,110,24,23,22,26,112,243],rightEyeUpper2:[113,225,224,223,222,221,189],rightEyeLower2:[226,31,228,229,230,231,232,233,244],rightEyeLower3:[143,111,117,118,119,120,121,128,245],rightEyebrowUpper:[156,70,63,105,66,107,55,193],rightEyebrowLower:[35,124,46,53,52,65],rightEyeIris:[473,474,475,476,477],leftEyeUpper0:[466,388,387,386,385,384,398],leftEyeLower0:[263,249,390,373,374,380,381,382,362],leftEyeUpper1:[467,260,259,257,258,286,414],leftEyeLower1:[359,255,339,254,253,252,256,341,463],leftEyeUpper2:[342,445,444,443,442,441,413],leftEyeLower2:[446,261,448,449,450,451,452,453,464],leftEyeLower3:[372,340,346,347,348,349,350,357,465],leftEyebrowUpper:[383,300,293,334,296,336,285,417],leftEyebrowLower:[265,353,276,283,282,295],leftEyeIris:[468,469,470,471,472],midwayBetweenEyes:[168],noseTip:[1],noseBottom:[2],noseRightCorner:[98],noseLeftCorner:[327],rightCheek:[205],leftCheek:[425]};function _V(t){return[Math.abs(t.endPoint[0]-t.startPoint[0]),Math.abs(t.endPoint[1]-t.startPoint[1])]}function TV(t){return[t.startPoint[0]+(t.endPoint[0]-t.startPoint[0])/2,t.startPoint[1]+(t.endPoint[1]-t.startPoint[1])/2]}function kV(t,e){void 0===e&&(e=1.5);var n=TV(t),r=_V(t),s=[e*r[0]/2,e*r[1]/2];return{startPoint:[n[0]-s[0],n[1]-s[1]],endPoint:[n[0]+s[0],n[1]+s[1]],landmarks:t.landmarks}}function AV(t){var e=TV(t),n=_V(t),r=Math.max.apply(Math,n)/2;return{startPoint:[e[0]-r,e[1]-r],endPoint:[e[0]+r,e[1]+r],landmarks:t.landmarks}}var CV=[[1,0,0],[0,1,0],[0,0,1]];function OV(t,e){return[[1,0,t],[0,1,e],[0,0,1]]}function IV(t,e){for(var n=0,r=0;r<t.length;r++)n+=t[r]*e[r];return n}function MV(t,e){for(var n=[],r=0;r<t.length;r++)n.push(t[r][e]);return n}function RV(t,e){for(var n=[],r=t.length,s=0;s<r;s++){n.push([]);for(var o=0;o<r;o++)n[s].push(IV(t[s],MV(e,o)))}return n}function DV(t,e){var n=Math.cos(t),r=Math.sin(t),s=[[n,-r,0],[r,n,0],[0,0,1]],o=RV(OV(e[0],e[1]),s);return RV(o,OV(-e[0],-e[1]))}var FV=[13,SV.midwayBetweenEyes[0]],LV=[3,2],PV=SV.leftEyeLower0,BV=[PV[0],PV[PV.length-1]],VV=SV.rightEyeLower0,zV=[VV[0],VV[VV.length-1]],WV=[{key:"EyeUpper0",indices:[9,10,11,12,13,14,15]},{key:"EyeUpper1",indices:[25,26,27,28,29,30,31]},{key:"EyeUpper2",indices:[41,42,43,44,45,46,47]},{key:"EyeLower0",indices:[0,1,2,3,4,5,6,7,8]},{key:"EyeLower1",indices:[16,17,18,19,20,21,22,23,24]},{key:"EyeLower2",indices:[32,33,34,35,36,37,38,39,40]},{key:"EyeLower3",indices:[54,55,56,57,58,59,60,61,62]},{key:"EyebrowUpper",indices:[63,64,65,66,67,68,69,70]},{key:"EyebrowLower",indices:[48,49,50,51,52,53]}];function UV(t,e,n,r){for(var s=0;s<WV.length;s++){var o=WV[s],i=o.key,a=o.indices,u=SV[""+n+i];if(null==r||r.includes(i))for(var c=0;c<a.length;c++){var l=a[c];t[u[c]]=[e[l][0],e[l][1],(e[l][2]+t[u[c]][2])/2]}}}var jV=function(){function t(t,e,n,r,s,o,i){this.regionsOfInterest=[],this.runsWithoutFaceDetector=0,this.boundingBoxDetector=t,this.meshDetector=e,this.irisModel=i,this.meshWidth=n,this.meshHeight=r,this.maxContinuousChecks=s,this.maxFaces=o}return t.prototype.transformRawCoords=function(t,e,n,r){var s,o,i,a,u=this,c=_V({startPoint:e.startPoint,endPoint:e.endPoint}),l=[c[0]/this.meshWidth,c[1]/this.meshHeight],f=t.map((function(t){return[l[0]*(t[0]-u.meshWidth/2),l[1]*(t[1]-u.meshHeight/2),t[2]]})),h=DV(n,[0,0]),p=f.map((function(t){return function(t,e){return[IV(t,e[0]),IV(t,e[1])]}(t,h).concat([t[2]])})),d=(o=[[(s=r)[0][0],s[1][0]],[s[0][1],s[1][1]]],i=[s[0][2],s[1][2]],a=[-IV(o[0],i),-IV(o[1],i)],[o[0].concat(a[0]),o[1].concat(a[1]),[0,0,1]]),m=TV({startPoint:e.startPoint,endPoint:e.endPoint}).concat([1]),y=[IV(m,d[0]),IV(m,d[1])];return p.map((function(t){return[t[0]+y[0],t[1]+y[1],t[2]]}))},t.prototype.getLeftToRightEyeDepthDifference=function(t){return t[BV[0]][2]-t[zV[0]][2]},t.prototype.getEyeBox=function(t,e,n,r,s){void 0===s&&(s=!1);var o=AV(kV(this.calculateLandmarksBoundingBox([t[n],t[r]]),2.3)),i=_V(o),a=JP.cropAndResize(e,[[o.startPoint[1]/this.meshHeight,o.startPoint[0]/this.meshWidth,o.endPoint[1]/this.meshHeight,o.endPoint[0]/this.meshWidth]],[0],[64,64]);return s&&(a=JP.flipLeftRight(a)),{box:o,boxSize:i,crop:a}},t.prototype.getEyeCoords=function(t,e,n,r){void 0===r&&(r=!1);for(var s=[],o=0;o<76;o++){var i=t[3*o],a=t[3*o+1],u=t[3*o+2];s.push([(r?1-i/64:i/64)*n[0]+e.startPoint[0],a/64*n[1]+e.startPoint[1],u])}return{rawCoords:s,iris:s.slice(71)}},t.prototype.getAdjustedIrisCoords=function(t,e,n){var r=t[SV[n+"EyeUpper0"][3]][2],s=t[SV[n+"EyeLower0"][4]][2],o=(r+s)/2;return e.map((function(t,e){var n=o;return 2===e?n=r:4===e&&(n=s),[t[0],t[1],n]}))},t.prototype.predict=function(t,e){return mV(this,void 0,void 0,(function(){var n,r,s,o,i=this;return yV(this,(function(a){switch(a.label){case 0:return this.shouldUpdateRegionsOfInterest()?[4,this.boundingBoxDetector.getBoundingBoxes(t,!1,!0)]:[3,2];case 1:return n=a.sent(),r=n.boxes,s=n.scaleFactor,0===r.length?(this.regionsOfInterest=[],[2,null]):(o=r.map((function(t){var e,n,r={startPoint:jL(t.box.startPoint).arraySync(),endPoint:jL(t.box.endPoint).arraySync()},o=AV(kV((n=s,{startPoint:[(e=r).startPoint[0]*n[0],e.startPoint[1]*n[1]],endPoint:[e.endPoint[0]*n[0],e.endPoint[1]*n[1]]})));return dV({},o,{landmarks:t.landmarks.arraySync()})})),r.forEach((function(t){null!=t&&null!=t.startPoint&&(t.startEndTensor.dispose(),t.startPoint.dispose(),t.endPoint.dispose())})),this.updateRegionsOfInterest(o),this.runsWithoutFaceDetector=0,[3,3]);case 2:this.runsWithoutFaceDetector++,a.label=3;case 3:return[2,jR((function(){return i.regionsOfInterest.map((function(n,r){var s,o=n.landmarks.length>=468,a=FV[0],u=FV[1];!1===o&&(a=LV[0],u=LV[1]),s=function(t,e){var n;return(n=Math.PI/2-Math.atan2(-(e[1]-t[1]),e[0]-t[0]))-2*Math.PI*Math.floor((n+Math.PI)/(2*Math.PI))}(n.landmarks[a],n.landmarks[u]);var c=TV({startPoint:n.startPoint,endPoint:n.endPoint}),l=[c[0]/t.shape[2],c[1]/t.shape[1]],f=t,h=CV;0!==s&&(f=JP.rotateWithOffset(t,s,0,l),h=DV(-s,c));var p={startPoint:n.startPoint,endPoint:n.endPoint},d=nD(function(t,e,n){var r=e.shape[1],s=e.shape[2],o=[[t.startPoint[1]/r,t.startPoint[0]/s,t.endPoint[1]/r,t.endPoint[0]/s]];return JP.cropAndResize(e,o,[0],n,"bilinear",0)}(p,f,[i.meshHeight,i.meshWidth]),255),m=i.meshDetector.predict(d),y=m[1],g=m[2],b=ED(g,[-1,3]).arraySync();if(e){var w=i.getEyeBox(b,d,BV[0],BV[1],!0),v=w.box,x=w.boxSize,N=w.crop,$=i.getEyeBox(b,d,zV[0],zV[1]),E=$.box,S=$.boxSize,_=$.crop,T=i.irisModel.predict(TD([N,_])).dataSync(),k=T.slice(0,228),A=i.getEyeCoords(k,v,x,!0),C=A.rawCoords,O=A.iris,I=T.slice(228),M=i.getEyeCoords(I,E,S),R=M.rawCoords,D=M.iris,F=i.getLeftToRightEyeDepthDifference(b);Math.abs(F)<30?(UV(b,C,"left"),UV(b,R,"right")):F<1?UV(b,C,"left",["EyeUpper0","EyeLower0"]):UV(b,R,"right",["EyeUpper0","EyeLower0"]);var L=i.getAdjustedIrisCoords(b,O,"left"),P=i.getAdjustedIrisCoords(b,D,"right");b=b.concat(L).concat(P)}var B=i.transformRawCoords(b,n,s,h),V=JL(B),z=kV(i.calculateLandmarksBoundingBox(B)),W=AV(z);return i.regionsOfInterest[r]=dV({},W,{landmarks:V.arraySync()}),{coords:JL(b,[b.length,3]),scaledCoords:V,box:z,flag:jL(y)}}))}))]}}))}))},t.prototype.updateRegionsOfInterest=function(t){for(var e=0;e<t.length;e++){var n=t[e],r=this.regionsOfInterest[e],s=0;if(r&&r.startPoint){var o=n.startPoint,i=o[0],a=o[1],u=n.endPoint,c=u[0],l=u[1],f=r.startPoint,h=f[0],p=f[1],d=r.endPoint,m=d[0],y=d[1],g=Math.max(i,h),b=Math.max(a,p),w=(Math.min(c,m)-g)*(Math.min(l,y)-b);s=w/((c-i)*(l-a)+(m-h)*(y-a)-w)}s<.25&&(this.regionsOfInterest[e]=n)}this.regionsOfInterest=this.regionsOfInterest.slice(0,t.length)},t.prototype.clearRegionOfInterest=function(t){null!=this.regionsOfInterest[t]&&(this.regionsOfInterest=this.regionsOfInterest.slice(0,t).concat(this.regionsOfInterest.slice(t+1)))},t.prototype.shouldUpdateRegionsOfInterest=function(){var t=this.regionsOfInterest.length,e=0===t;return 1===this.maxFaces||e?e:t!==this.maxFaces&&this.runsWithoutFaceDetector>=this.maxContinuousChecks},t.prototype.calculateLandmarksBoundingBox=function(t){var e=t.map((function(t){return t[0]})),n=t.map((function(t){return t[1]}));return{startPoint:[Math.min.apply(Math,e),Math.min.apply(Math,n)],endPoint:[Math.max.apply(Math,e),Math.max.apply(Math,n)]}},t}(),GV=[[.499976992607117,.652534008026123],[.500025987625122,.547487020492554],[.499974012374878,.602371990680695],[.482113003730774,.471979022026062],[.500150978565216,.527155995368958],[.499909996986389,.498252987861633],[.499523013830185,.40106201171875],[.289712011814117,.380764007568359],[.499954998493195,.312398016452789],[.499987006187439,.269918978214264],[.500023007392883,.107050001621246],[.500023007392883,.666234016418457],[.5000159740448,.679224014282227],[.500023007392883,.692348003387451],[.499976992607117,.695277988910675],[.499976992607117,.70593398809433],[.499976992607117,.719385027885437],[.499976992607117,.737019002437592],[.499967992305756,.781370997428894],[.499816000461578,.562981009483337],[.473773002624512,.573909997940063],[.104906998574734,.254140973091125],[.365929991006851,.409575998783112],[.338757991790771,.41302502155304],[.311120003461838,.409460008144379],[.274657994508743,.389131009578705],[.393361985683441,.403706014156342],[.345234006643295,.344011008739471],[.370094001293182,.346076011657715],[.319321990013123,.347265005111694],[.297903001308441,.353591024875641],[.24779200553894,.410809993743896],[.396889001131058,.842755019664764],[.280097991228104,.375599980354309],[.106310002505779,.399955987930298],[.2099249958992,.391353011131287],[.355807989835739,.534406006336212],[.471751004457474,.65040397644043],[.474155008792877,.680191993713379],[.439785003662109,.657229006290436],[.414617002010345,.66654098033905],[.450374007225037,.680860996246338],[.428770989179611,.682690978050232],[.374971002340317,.727805018424988],[.486716985702515,.547628998756409],[.485300987958908,.527395009994507],[.257764995098114,.314490020275116],[.401223003864288,.455172002315521],[.429818987846375,.548614978790283],[.421351999044418,.533740997314453],[.276895999908447,.532056987285614],[.483370006084442,.499586999416351],[.33721199631691,.282882988452911],[.296391993761063,.293242990970612],[.169294998049736,.193813979625702],[.447580009698868,.302609980106354],[.392390012741089,.353887975215912],[.354490011930466,.696784019470215],[.067304998636246,.730105042457581],[.442739009857178,.572826027870178],[.457098007202148,.584792017936707],[.381974011659622,.694710969924927],[.392388999462128,.694203019142151],[.277076005935669,.271932005882263],[.422551989555359,.563233017921448],[.385919004678726,.281364023685455],[.383103013038635,.255840003490448],[.331431001424789,.119714021682739],[.229923993349075,.232002973556519],[.364500999450684,.189113974571228],[.229622006416321,.299540996551514],[.173287004232407,.278747975826263],[.472878992557526,.666198015213013],[.446828007698059,.668527007102966],[.422762006521225,.673889994621277],[.445307999849319,.580065965652466],[.388103008270264,.693961024284363],[.403039008378983,.706539988517761],[.403629004955292,.693953037261963],[.460041999816895,.557139039039612],[.431158006191254,.692366003990173],[.452181994915009,.692366003990173],[.475387006998062,.692366003990173],[.465828001499176,.779190003871918],[.472328990697861,.736225962638855],[.473087012767792,.717857003211975],[.473122000694275,.704625964164734],[.473033010959625,.695277988910675],[.427942007780075,.695277988910675],[.426479011774063,.703539967536926],[.423162013292313,.711845993995667],[.4183090031147,.720062971115112],[.390094995498657,.639572978019714],[.013953999616206,.560034036636353],[.499913990497589,.58014702796936],[.413199990987778,.69539999961853],[.409626007080078,.701822996139526],[.468080013990402,.601534962654114],[.422728985548019,.585985004901886],[.463079988956451,.593783974647522],[.37211999297142,.47341400384903],[.334562003612518,.496073007583618],[.411671012639999,.546965003013611],[.242175996303558,.14767599105835],[.290776997804642,.201445996761322],[.327338010072708,.256527006626129],[.399509996175766,.748921036720276],[.441727995872498,.261676013469696],[.429764986038208,.187834024429321],[.412198007106781,.108901023864746],[.288955003023148,.398952007293701],[.218936994671822,.435410976409912],[.41278201341629,.398970007896423],[.257135003805161,.355440020561218],[.427684992551804,.437960982322693],[.448339998722076,.536936044692993],[.178560003638268,.45755398273468],[.247308000922203,.457193970680237],[.286267012357712,.467674970626831],[.332827985286713,.460712015628815],[.368755996227264,.447206974029541],[.398963987827301,.432654976844788],[.476410001516342,.405806005001068],[.189241006970406,.523923993110657],[.228962004184723,.348950982093811],[.490725994110107,.562400996685028],[.404670000076294,.485132992267609],[.019469000399113,.401564002037048],[.426243007183075,.420431017875671],[.396993011236191,.548797011375427],[.266469985246658,.376977026462555],[.439121007919312,.51895797252655],[.032313998788595,.644356966018677],[.419054001569748,.387154996395111],[.462783008813858,.505746960639954],[.238978996872902,.779744982719421],[.198220998048782,.831938028335571],[.107550002634525,.540755033493042],[.183610007166862,.740257024765015],[.134409993886948,.333683013916016],[.385764002799988,.883153975009918],[.490967005491257,.579378008842468],[.382384985685349,.508572995662689],[.174399003386497,.397670984268188],[.318785011768341,.39623498916626],[.343364000320435,.400596976280212],[.396100014448166,.710216999053955],[.187885001301765,.588537991046906],[.430987000465393,.944064974784851],[.318993002176285,.898285031318665],[.266247987747192,.869701027870178],[.500023007392883,.190576016902924],[.499976992607117,.954452991485596],[.366169989109039,.398822009563446],[.393207013607025,.39553701877594],[.410373002290726,.391080021858215],[.194993004202843,.342101991176605],[.388664990663528,.362284004688263],[.365961998701096,.355970978736877],[.343364000320435,.355356991291046],[.318785011768341,.35834002494812],[.301414996385574,.363156020641327],[.058132998645306,.319076001644135],[.301414996385574,.387449026107788],[.499987989664078,.618434011936188],[.415838003158569,.624195992946625],[.445681989192963,.566076993942261],[.465844005346298,.620640993118286],[.49992299079895,.351523995399475],[.288718998432159,.819945991039276],[.335278987884521,.852819979190826],[.440512001514435,.902418971061707],[.128294005990028,.791940987110138],[.408771991729736,.373893976211548],[.455606997013092,.451801002025604],[.499877005815506,.908990025520325],[.375436991453171,.924192011356354],[.11421000212431,.615022003650665],[.448662012815475,.695277988910675],[.4480200111866,.704632043838501],[.447111994028091,.715808033943176],[.444831997156143,.730794012546539],[.430011987686157,.766808986663818],[.406787008047104,.685672998428345],[.400738000869751,.681069016456604],[.392399996519089,.677703022956848],[.367855995893478,.663918972015381],[.247923001646996,.601333022117615],[.452769994735718,.420849978923798],[.43639200925827,.359887003898621],[.416164010763168,.368713974952698],[.413385987281799,.692366003990173],[.228018000721931,.683571994304657],[.468268007040024,.352671027183533],[.411361992359161,.804327011108398],[.499989002943039,.469825029373169],[.479153990745544,.442654013633728],[.499974012374878,.439637005329132],[.432112008333206,.493588984012604],[.499886006116867,.866917014122009],[.49991300702095,.821729004383087],[.456548988819122,.819200992584229],[.344549000263214,.745438992977142],[.37890899181366,.574010014533997],[.374292999505997,.780184984207153],[.319687992334366,.570737957954407],[.357154995203018,.604269981384277],[.295284003019333,.621580958366394],[.447750002145767,.862477004528046],[.410986006259918,.508723020553589],[.31395098567009,.775308012962341],[.354128003120422,.812552988529205],[.324548006057739,.703992962837219],[.189096003770828,.646299958229065],[.279776990413666,.71465802192688],[.1338230073452,.682700991630554],[.336768001317978,.644733011722565],[.429883986711502,.466521978378296],[.455527991056442,.548622965812683],[.437114000320435,.558896005153656],[.467287987470627,.529924988746643],[.414712011814117,.335219979286194],[.37704598903656,.322777986526489],[.344107985496521,.320150971412659],[.312875986099243,.32233202457428],[.283526003360748,.333190023899078],[.241245999932289,.382785975933075],[.102986000478268,.468762993812561],[.267612010240555,.424560010433197],[.297879010438919,.433175981044769],[.333433985710144,.433878004550934],[.366427004337311,.426115989685059],[.396012008190155,.416696012020111],[.420121014118195,.41022801399231],[.007561000064015,.480777025222778],[.432949006557465,.569517970085144],[.458638995885849,.479089021682739],[.473466008901596,.545744001865387],[.476087987422943,.563830018043518],[.468472003936768,.555056989192963],[.433990985155106,.582361996173859],[.483518004417419,.562983989715576],[.482482999563217,.57784903049469],[.42645001411438,.389798998832703],[.438998997211456,.39649498462677],[.450067013502121,.400434017181396],[.289712011814117,.368252992630005],[.276670008897781,.363372981548309],[.517862021923065,.471948027610779],[.710287988185883,.380764007568359],[.526226997375488,.573909997940063],[.895093023777008,.254140973091125],[.634069979190826,.409575998783112],[.661242008209229,.41302502155304],[.688880026340485,.409460008144379],[.725341975688934,.389131009578705],[.606630027294159,.40370500087738],[.654766023159027,.344011008739471],[.629905998706818,.346076011657715],[.680678009986877,.347265005111694],[.702096998691559,.353591024875641],[.75221198797226,.410804986953735],[.602918028831482,.842862963676453],[.719901978969574,.375599980354309],[.893692970275879,.399959981441498],[.790081977844238,.391354024410248],[.643998026847839,.534487962722778],[.528249025344849,.65040397644043],[.525849997997284,.680191040039062],[.560214996337891,.657229006290436],[.585384011268616,.66654098033905],[.549625992774963,.680860996246338],[.57122802734375,.682691991329193],[.624852001667023,.72809898853302],[.513050019741058,.547281980514526],[.51509702205658,.527251958847046],[.742246985435486,.314507007598877],[.598631024360657,.454979002475739],[.570338010787964,.548575043678284],[.578631997108459,.533622980117798],[.723087012767792,.532054007053375],[.516445994377136,.499638974666595],[.662801027297974,.282917976379395],[.70362401008606,.293271005153656],[.830704987049103,.193813979625702],[.552385985851288,.302568018436432],[.607609987258911,.353887975215912],[.645429015159607,.696707010269165],[.932694971561432,.730105042457581],[.557260990142822,.572826027870178],[.542901992797852,.584792017936707],[.6180260181427,.694710969924927],[.607590973377228,.694203019142151],[.722943007946014,.271963000297546],[.577413976192474,.563166975975037],[.614082992076874,.281386971473694],[.616907000541687,.255886018276215],[.668509006500244,.119913995265961],[.770092010498047,.232020974159241],[.635536015033722,.189248979091644],[.77039098739624,.299556016921997],[.826722025871277,.278755009174347],[.527121007442474,.666198015213013],[.553171992301941,.668527007102966],[.577238023281097,.673889994621277],[.554691970348358,.580065965652466],[.611896991729736,.693961024284363],[.59696102142334,.706539988517761],[.596370995044708,.693953037261963],[.539958000183105,.557139039039612],[.568841993808746,.692366003990173],[.547818005084991,.692366003990173],[.52461302280426,.692366003990173],[.534089982509613,.779141008853912],[.527670979499817,.736225962638855],[.526912987232208,.717857003211975],[.526877999305725,.704625964164734],[.526966989040375,.695277988910675],[.572058022022247,.695277988910675],[.573521018028259,.703539967536926],[.57683801651001,.711845993995667],[.581691026687622,.720062971115112],[.609944999217987,.639909982681274],[.986046016216278,.560034036636353],[.5867999792099,.69539999961853],[.590372025966644,.701822996139526],[.531915009021759,.601536989212036],[.577268004417419,.585934996604919],[.536915004253387,.593786001205444],[.627542972564697,.473352015018463],[.665585994720459,.495950996875763],[.588353991508484,.546862006187439],[.757824003696442,.14767599105835],[.709249973297119,.201507985591888],[.672684013843536,.256581008434296],[.600408971309662,.74900496006012],[.55826598405838,.261672019958496],[.570303976535797,.187870979309082],[.588165998458862,.109044015407562],[.711045026779175,.398952007293701],[.781069993972778,.435405015945435],[.587247014045715,.398931980133057],[.742869973182678,.355445981025696],[.572156012058258,.437651991844177],[.55186802148819,.536570012569427],[.821442008018494,.457556009292603],[.752701997756958,.457181990146637],[.71375697851181,.467626988887787],[.66711300611496,.460672974586487],[.631101012229919,.447153985500336],[.6008620262146,.432473003864288],[.523481011390686,.405627012252808],[.810747981071472,.523926019668579],[.771045982837677,.348959028720856],[.509127020835876,.562718033790588],[.595292985439301,.485023975372314],[.980530977249146,.401564002037048],[.573499977588654,.420000016689301],[.602994978427887,.548687994480133],[.733529984951019,.376977026462555],[.560611009597778,.519016981124878],[.967685997486115,.644356966018677],[.580985009670258,.387160003185272],[.537728011608124,.505385041236877],[.760966002941132,.779752969741821],[.801778972148895,.831938028335571],[.892440974712372,.54076099395752],[.816350996494293,.740260004997253],[.865594983100891,.333687007427216],[.614073991775513,.883246004581451],[.508952975273132,.579437971115112],[.617941975593567,.508316040039062],[.825608015060425,.397674977779388],[.681214988231659,.39623498916626],[.656635999679565,.400596976280212],[.603900015354156,.710216999053955],[.81208598613739,.588539004325867],[.56801301240921,.944564998149872],[.681007981300354,.898285031318665],[.733752012252808,.869701027870178],[.633830010890961,.398822009563446],[.606792986392975,.39553701877594],[.589659988880157,.391062021255493],[.805015981197357,.342108011245728],[.611334979534149,.362284004688263],[.634037971496582,.355970978736877],[.656635999679565,.355356991291046],[.681214988231659,.35834002494812],[.698584973812103,.363156020641327],[.941866993904114,.319076001644135],[.698584973812103,.387449026107788],[.584177017211914,.624107003211975],[.554318010807037,.566076993942261],[.534153997898102,.62064003944397],[.711217999458313,.819975018501282],[.664629995822906,.852871000766754],[.559099972248077,.902631998062134],[.871706008911133,.791940987110138],[.591234028339386,.373893976211548],[.544341027736664,.451583981513977],[.624562978744507,.924192011356354],[.88577002286911,.615028977394104],[.551338016986847,.695277988910675],[.551980018615723,.704632043838501],[.552887976169586,.715808033943176],[.555167973041534,.730794012546539],[.569944024085999,.767035007476807],[.593203008174896,.685675978660583],[.599261999130249,.681069016456604],[.607599973678589,.677703022956848],[.631937980651855,.663500010967255],[.752032995223999,.601315021514893],[.547226011753082,.420395016670227],[.563543975353241,.359827995300293],[.583841025829315,.368713974952698],[.586614012718201,.692366003990173],[.771915018558502,.683578014373779],[.531597018241882,.352482974529266],[.588370978832245,.804440975189209],[.52079701423645,.442565023899078],[.567984998226166,.493479013442993],[.543282985687256,.819254994392395],[.655317008495331,.745514988899231],[.621008992195129,.574018001556396],[.625559985637665,.78031200170517],[.680198013782501,.570719003677368],[.64276397228241,.604337990283966],[.704662978649139,.621529996395111],[.552012026309967,.862591981887817],[.589071989059448,.508637011051178],[.685944974422455,.775357007980347],[.645735025405884,.812640011310577],[.675342977046967,.703978002071381],[.810858011245728,.646304965019226],[.72012197971344,.714666962623596],[.866151988506317,.682704985141754],[.663187026977539,.644596993923187],[.570082008838654,.466325998306274],[.544561982154846,.548375964164734],[.562758982181549,.558784961700439],[.531987011432648,.530140042304993],[.585271000862122,.335177004337311],[.622952997684479,.32277899980545],[.655896008014679,.320163011550903],[.687132000923157,.322345972061157],[.716481983661652,.333200991153717],[.758756995201111,.382786989212036],[.897013008594513,.468769013881683],[.732392013072968,.424547016620636],[.70211398601532,.433162987232208],[.66652500629425,.433866024017334],[.633504986763,.426087975502014],[.603875994682312,.416586995124817],[.579657971858978,.409945011138916],[.992439985275269,.480777025222778],[.567192018032074,.569419980049133],[.54136598110199,.478899002075195],[.526564002037048,.546118021011353],[.523913025856018,.563830018043518],[.531529009342194,.555056989192963],[.566035985946655,.582329034805298],[.51631098985672,.563053965568542],[.5174720287323,.577877044677734],[.573594987392426,.389806985855103],[.560697972774506,.395331978797913],[.549755990505219,.399751007556915],[.710287988185883,.368252992630005],[.723330020904541,.363372981548309]];function qV(t){return mV(this,void 0,void 0,(function(){var e,n,r,s,o,i,a,u,c,l,f,h,p,d,m,y;return yV(this,(function(g){switch(g.label){case 0:return e=t.maxContinuousChecks,n=void 0===e?5:e,r=t.detectionConfidence,s=void 0===r?.9:r,o=t.maxFaces,i=void 0===o?10:o,a=t.iouThreshold,u=void 0===a?.3:a,c=t.scoreThreshold,l=void 0===c?.75:c,f=t.shouldLoadIrisModel,h=void 0===f||f,p=t.modelUrl,d=t.detectorModelUrl,m=t.irisModelUrl,h?[4,Promise.all([HV(d,i,u,l),KV(p),XV(m)])]:[3,2];case 1:return y=g.sent(),[3,4];case 2:return[4,Promise.all([HV(d,i,u,l),KV(p)])];case 3:y=g.sent(),g.label=4;case 4:return[2,new ZV(y[0],y[1],n,s,i,h?y[2]:null)]}}))}))}function HV(t,e,n,r){return mV(this,void 0,void 0,(function(){return yV(this,(function(s){return[2,EV({modelUrl:t,maxFaces:e,iouThreshold:n,scoreThreshold:r})]}))}))}function KV(t){return mV(this,void 0,void 0,(function(){return yV(this,(function(e){return null!=t?[2,pV(t)]:[2,pV("https://tfhub.dev/mediapipe/tfjs-model/facemesh/1/default/1",{fromTFHub:!0})]}))}))}function XV(t){return mV(this,void 0,void 0,(function(){return yV(this,(function(e){return null!=t?[2,pV(t)]:[2,pV("https://tfhub.dev/mediapipe/tfjs-model/iris/1/default/2",{fromTFHub:!0})]}))}))}function JV(t,e){if(t.mesh instanceof RI){var n=jR((function(){var n=XL([e-1,0,0]),r=XL([1,-1,1]);return jR((function(){return[TD([FF(e-1,AD(t.boundingBox.topLeft,0,1)),AD(t.boundingBox.topLeft,1,1)]),TD([FF(e-1,AD(t.boundingBox.bottomRight,0,1)),AD(t.boundingBox.bottomRight,1,1)]),rD(FF(n,t.mesh),r),rD(FF(n,t.scaledMesh),r)]}))})),r=n[0],s=n[1],o=n[2],i=n[3];return Object.assign({},t,{boundingBox:{topLeft:r,bottomRight:s},mesh:o,scaledMesh:i})}return Object.assign({},t,{boundingBox:{topLeft:[e-1-t.boundingBox.topLeft[0],t.boundingBox.topLeft[1]],bottomRight:[e-1-t.boundingBox.bottomRight[0],t.boundingBox.bottomRight[1]]},mesh:t.mesh.map((function(t){var n=t.slice(0);return n[0]=e-1-t[0],n})),scaledMesh:t.scaledMesh.map((function(t){var n=t.slice(0);return n[0]=e-1-t[0],n}))})}var YV,ZV=function(){function t(t,e,n,r,s,o){this.kind="MediaPipeFaceMesh",this.pipeline=new jV(t,e,192,192,n,s,o),this.detectionConfidence=r}return t.getAnnotations=function(){return SV},t.getUVCoords=function(){return GV},t.prototype.estimateFaces=function(t){return mV(this,void 0,void 0,(function(){var e,n,r,s,o,i,a,u,c,l,f,h,p=this;return yV(this,(function(d){switch(d.label){case 0:if(e=t.returnTensors,n=void 0!==e&&e,r=t.flipHorizontal,s=void 0!==r&&r,o=t.predictIrises,i=void 0===o||o,a=t.input,i&&null==this.pipeline.irisModel)throw new Error("The iris model was not loaded as part of facemesh. Please initialize the model with facemesh.load({shouldLoadIrisModel: true}).");return u=function(t){return t instanceof RI?[t.shape[0],t.shape[1]]:[t.height,t.width]}(a),c=u[1],l=jR((function(){return a instanceof RI||(a=ZR(a)),gF(MR(a,"float32"),0)})),"webgl"!==XI.backendName?[3,2]:(h=LO().get("WEBGL_PACK_DEPTHWISECONV"),LO().set("WEBGL_PACK_DEPTHWISECONV",!0),[4,this.pipeline.predict(l,i)]);case 1:return f=d.sent(),LO().set("WEBGL_PACK_DEPTHWISECONV",h),[3,4];case 2:return[4,this.pipeline.predict(l,i)];case 3:f=d.sent(),d.label=4;case 4:return l.dispose(),null!=f&&f.length>0?[2,Promise.all(f.map((function(t,e){return mV(p,void 0,void 0,(function(){var r,o,a,u,l,f,h,p,d,m,y,g,b,w,v=this;return yV(this,(function(x){switch(x.label){case 0:return r=t.coords,o=t.scaledCoords,a=t.box,u=t.flag,l=[u],n||(l=l.concat([r,o])),[4,Promise.all(l.map((function(t){return mV(v,void 0,void 0,(function(){return yV(this,(function(e){return[2,t.array()]}))}))})))];case 1:if(f=x.sent(),h=f[0],u.dispose(),h<this.detectionConfidence&&this.pipeline.clearRegionOfInterest(e),n)return p={kind:"MediaPipePredictionTensors",faceInViewConfidence:h,mesh:r,scaledMesh:o,boundingBox:{topLeft:XL(a.startPoint),bottomRight:XL(a.endPoint)}},s?[2,JV(p,c)]:[2,p];for(w in d=f.slice(1),m=d[0],y=d[1],o.dispose(),r.dispose(),g={kind:"MediaPipePredictionValues",faceInViewConfidence:h,boundingBox:{topLeft:a.startPoint,bottomRight:a.endPoint},mesh:m,scaledMesh:y},s&&(g=JV(g,c)),b={},SV)(i||!1===w.includes("Iris"))&&(b[w]=SV[w].map((function(t){return g.scaledMesh[t]})));return g.annotations=b,[2,g]}}))}))})))]:[2,[]]}}))}))},t}();(YV||(YV={})).mediapipeFacemesh="mediapipe-facemesh";var QV=Object.freeze({__proto__:null,get SupportedPackages(){return YV},load:function(t,e){return void 0===t&&(t=YV.mediapipeFacemesh),void 0===e&&(e={}),mV(this,void 0,void 0,(function(){return yV(this,(function(n){if(t===YV.mediapipeFacemesh)return[2,qV(e)];throw new Error(t+" is not a valid package name.")}))}))}});let tz;class ez extends d{get poseType(){return"facelandmark"}get parts(){return["silhouette","lipsUpperOuter","lipsLowerOuter","lipsUpperInner","lipsLowerInner","rightEyeUpper0","rightEyeLower0","rightEyeUpper1","rightEyeLower1","rightEyeUpper2","rightEyeLower2","rightEyeLower3","rightEyebrowUpper","rightEyebrowLower","rightEyeIris","leftEyeUpper0","leftEyeLower0","leftEyeUpper1","leftEyeLower1","leftEyeUpper2","leftEyeLower2","leftEyeLower3","leftEyebrowUpper","leftEyebrowLower","leftEyeIris","midwayBetweenEyes","noseTip","noseBottom","noseRightCorner","noseLeftCorner","rightCheek","leftCheek"]}static get observedAttributes(){return super.observedAttributes.concat("maximumFaces","includeMeshPoints")}async onMetadata(){super.onMetadata(),await async function(){tz=await QV.load(QV.SupportedPackages.mediapipeFacemesh)}(),this.poseDetectionFrame()}async poseDetectionFrame(){const t=this.hasAttribute("maximumFaces")?Number(this.getAttribute("maximumFaces")):1;if((this.isPlaying||this.forceOneTimePoseProcess)&&this.videoEl.readyState>1){const e=await(async(t,e=0,n)=>{var r;const s=[];if(tz){const o=await tz.estimateFaces({input:t.videoElement}),i=Math.min(o.length,n.maximumFaces||1);for(let a=0;a<i;a++){const i=o[a];if(n.minConfidence<=i.faceInViewConfidence){const o=i.scaledMesh.slice(),u={time:Date.now()-e,pose:a,points:[],score:i.faceInViewConfidence,aspectRatio:t.aspectRatio};if(Object.keys(i.annotations).forEach((e=>{var r;const s=i.annotations[e],a={name:e,positions:[]};for(let e=0;e<s.length;e++){const i=s[e];if(null===(r=a.positions)||void 0===r||r.push([i[0]/t.naturalSize.width,i[1]/t.naturalSize.height,i[2]]),n.includeMeshPoints){const t=o.findIndex((t=>i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]));-1!==t&&o.splice(t,1)}}a.positions&&a.positions.length>0&&u.points.push(a)})),n.includeMeshPoints){const e={positions:[]};for(let n=0;n<o.length;n++){const s=o[n];null===(r=e.positions)||void 0===r||r.push([s[0]/t.naturalSize.width,s[1]/t.naturalSize.height,s[2]])}e.positions&&e.positions.length>0&&u.points.push(e)}s.push(u)}}}return s})(this,this.recordingStartTime,{maximumFaces:t,minConfidence:this.minConfidence/100,includeMeshPoints:this.hasAttribute("includeMeshPoints")});this.onPoseFrame(e),this.forceOneTimePoseProcess=!1}requestAnimationFrame((()=>this.poseDetectionFrame()))}}function nz(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(n){if("default"!==n&&!(n in t)){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}))})),Object.freeze(t)}customElements.define("facelandmark-video",ez);"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function rz(t){return t&&t.q&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function sz(t){if(t.q)return t;var e=Object.defineProperty({},"q",{value:!0});return Object.keys(t).forEach((function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})})),e}var oz={exports:{}},iz="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};(function(){var t;function e(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}var n="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t};var r=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof iz&&iz];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function s(t,e){if(e)t:{var s=r;t=t.split(".");for(var o=0;o<t.length-1;o++){var i=t[o];if(!(i in s))break t;s=s[i]}(e=e(o=s[t=t[t.length-1]]))!=o&&null!=e&&n(s,t,{configurable:!0,writable:!0,value:e})}}function o(t){return(t={next:t})[Symbol.iterator]=function(){return this},t}function i(t){var n="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return n?n.call(t):{next:e(t)}}function a(t){if(!(t instanceof Array)){t=i(t);for(var e,n=[];!(e=t.next()).done;)n.push(e.value);t=n}return t}s("Symbol",(function(t){function e(t,e){this.g=t,n(this,"description",{configurable:!0,writable:!0,value:e})}if(t)return t;e.prototype.toString=function(){return this.g};var r="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",s=0;return function t(n){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new e(r+(n||"")+"_"+s++,n)}})),s("Symbol.iterator",(function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var s="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),i=0;i<s.length;i++){var a=r[s[i]];"function"==typeof a&&"function"!=typeof a.prototype[t]&&n(a.prototype,t,{configurable:!0,writable:!0,value:function(){return o(e(this))}})}return t}));var u,c="function"==typeof Object.create?Object.create:function(t){function e(){}return e.prototype=t,new e};if("function"==typeof Object.setPrototypeOf)u=Object.setPrototypeOf;else{var l;t:{var f={};try{f.__proto__={a:!0},l=f.a;break t}catch(t){}l=!1}u=l?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var h=u;function p(t,e){if(t.prototype=c(e.prototype),t.prototype.constructor=t,h)h(t,e);else for(var n in e)if("prototype"!=n)if(Object.defineProperties){var r=Object.getOwnPropertyDescriptor(e,n);r&&Object.defineProperty(t,n,r)}else t[n]=e[n];t.ea=e.prototype}function d(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.s=this.m=0,this.j=null}function m(t){if(t.l)throw new TypeError("Generator is already running");t.l=!0}function y(t,e){t.j={U:e,V:!0},t.g=t.m||t.s}function g(t,e,n){return t.g=n,{value:e}}function b(t){this.g=new d,this.h=t}function w(t,e,n,r){try{var s=e.call(t.g.i,n);if(!(s instanceof Object))throw new TypeError("Iterator result "+s+" is not an object");if(!s.done)return t.g.l=!1,s;var o=s.value}catch(e){return t.g.i=null,y(t.g,e),v(t)}return t.g.i=null,r.call(t.g,o),v(t)}function v(t){for(;t.g.g;)try{var e=t.h(t.g);if(e)return t.g.l=!1,{value:e.value,done:!1}}catch(e){t.g.h=void 0,y(t.g,e)}if(t.g.l=!1,t.g.j){if(e=t.g.j,t.g.j=null,e.V)throw e.U;return{value:e.return,done:!0}}return{value:void 0,done:!0}}function x(t){this.next=function(e){return m(t.g),t.g.i?e=w(t,t.g.i.next,e,t.g.o):(t.g.o(e),e=v(t)),e},this.throw=function(e){return m(t.g),t.g.i?e=w(t,t.g.i.throw,e,t.g.o):(y(t.g,e),e=v(t)),e},this.return=function(e){return function(t,e){m(t.g);var n=t.g.i;return n?w(t,"return"in n?n.return:function(t){return{value:t,done:!0}},e,t.g.return):(t.g.return(e),v(t))}(t,e)},this[Symbol.iterator]=function(){return this}}function N(t,e){return e=new x(new b(e)),h&&t.prototype&&h(e,t.prototype),e}d.prototype.o=function(t){this.h=t},d.prototype.return=function(t){this.j={return:t},this.g=this.s};var $="function"==typeof Object.assign?Object.assign:function(t,e){for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r)for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t};s("Object.assign",(function(t){return t||$})),s("Promise",(function(t){function e(t){this.h=0,this.i=void 0,this.g=[],this.o=!1;var e=this.j();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function n(){this.g=null}function s(t){return t instanceof e?t:new e((function(e){e(t)}))}if(t)return t;n.prototype.h=function(t){if(null==this.g){this.g=[];var e=this;this.i((function(){e.l()}))}this.g.push(t)};var o=r.setTimeout;n.prototype.i=function(t){o(t,0)},n.prototype.l=function(){for(;this.g&&this.g.length;){var t=this.g;this.g=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.j(t)}}}this.g=null},n.prototype.j=function(t){this.i((function(){throw t}))},e.prototype.j=function(){function t(t){return function(r){n||(n=!0,t.call(e,r))}}var e=this,n=!1;return{resolve:t(this.C),reject:t(this.l)}},e.prototype.C=function(t){if(t===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.F(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.u(t):this.m(t)}},e.prototype.u=function(t){var e=void 0;try{e=t.then}catch(t){return void this.l(t)}"function"==typeof e?this.G(e,t):this.m(t)},e.prototype.l=function(t){this.s(2,t)},e.prototype.m=function(t){this.s(1,t)},e.prototype.s=function(t,e){if(0!=this.h)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.h);this.h=t,this.i=e,2===this.h&&this.D(),this.A()},e.prototype.D=function(){var t=this;o((function(){if(t.B()){var e=r.console;void 0!==e&&e.error(t.i)}}),1)},e.prototype.B=function(){if(this.o)return!1;var t=r.CustomEvent,e=r.Event,n=r.dispatchEvent;return void 0===n||("function"==typeof t?t=new t("unhandledrejection",{cancelable:!0}):"function"==typeof e?t=new e("unhandledrejection",{cancelable:!0}):(t=r.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,t),t.promise=this,t.reason=this.i,n(t))},e.prototype.A=function(){if(null!=this.g){for(var t=0;t<this.g.length;++t)a.h(this.g[t]);this.g=null}};var a=new n;return e.prototype.F=function(t){var e=this.j();t.J(e.resolve,e.reject)},e.prototype.G=function(t,e){var n=this.j();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},e.prototype.then=function(t,n){function r(t,e){return"function"==typeof t?function(e){try{s(t(e))}catch(t){o(t)}}:e}var s,o,i=new e((function(t,e){s=t,o=e}));return this.J(r(t,s),r(n,o)),i},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.J=function(t,e){function n(){switch(r.h){case 1:t(r.i);break;case 2:e(r.i);break;default:throw Error("Unexpected state: "+r.h)}}var r=this;null==this.g?a.h(n):this.g.push(n),this.o=!0},e.resolve=s,e.reject=function(t){return new e((function(e,n){n(t)}))},e.race=function(t){return new e((function(e,n){for(var r=i(t),o=r.next();!o.done;o=r.next())s(o.value).J(e,n)}))},e.all=function(t){var n=i(t),r=n.next();return r.done?s([]):new e((function(t,e){function o(e){return function(n){i[e]=n,0==--a&&t(i)}}var i=[],a=0;do{i.push(void 0),a++,s(r.value).J(o(i.length-1),e),r=n.next()}while(!r.done)}))},e})),s("Object.is",(function(t){return t||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}})),s("Array.prototype.includes",(function(t){return t||function(t,e){var n=this;n instanceof String&&(n=String(n));var r=n.length;for(0>(e=e||0)&&(e=Math.max(e+r,0));e<r;e++){var s=n[e];if(s===t||Object.is(s,t))return!0}return!1}})),s("String.prototype.includes",(function(t){return t||function(t,e){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==this.indexOf(t,e||0)}})),s("Array.prototype.keys",(function(t){return t||function(){return function(t,e){t instanceof String&&(t+="");var n=0,r=!1,s={next:function(){if(!r&&n<t.length){var s=n++;return{value:e(s,t[s]),done:!1}}return r=!0,{done:!0,value:void 0}}};return s[Symbol.iterator]=function(){return s},s}(this,(function(t){return t}))}}));var E=this||self;function S(t,e){t=t.split(".");var n,r=E;t[0]in r||void 0===r.execScript||r.execScript("var "+t[0]);for(;t.length&&(n=t.shift());)t.length||void 0===e?r=r[n]&&r[n]!==Object.prototype[n]?r[n]:r[n]={}:r[n]=e}function _(t,e){return e=String.fromCharCode.apply(null,e),null==t?e:t+e}var T,k,A="undefined"!=typeof TextDecoder,C="undefined"!=typeof TextEncoder;function O(t){if(C)t=(k||(k=new TextEncoder)).encode(t);else{var e=void 0;e=void 0!==e&&e;for(var n=0,r=new Uint8Array(3*t.length),s=0;s<t.length;s++){var o=t.charCodeAt(s);if(128>o)r[n++]=o;else{if(2048>o)r[n++]=o>>6|192;else{if(55296<=o&&57343>=o){if(56319>=o&&s<t.length){var i=t.charCodeAt(++s);if(56320<=i&&57343>=i){o=1024*(o-55296)+i-56320+65536,r[n++]=o>>18|240,r[n++]=o>>12&63|128,r[n++]=o>>6&63|128,r[n++]=63&o|128;continue}s--}if(e)throw Error("Found an unpaired surrogate");o=65533}r[n++]=o>>12|224,r[n++]=o>>6&63|128}r[n++]=63&o|128}}t=r.subarray(0,n)}return t}var I={},M=null;function R(t,e){void 0===e&&(e=0),F(),e=I[e];for(var n=Array(Math.floor(t.length/3)),r=e[64]||"",s=0,o=0;s<t.length-2;s+=3){var i=t[s],a=t[s+1],u=t[s+2],c=e[i>>2];i=e[(3&i)<<4|a>>4],a=e[(15&a)<<2|u>>6],u=e[63&u],n[o++]=c+i+a+u}switch(c=0,u=r,t.length-s){case 2:u=e[(15&(c=t[s+1]))<<2]||r;case 1:t=t[s],n[o]=e[t>>2]+e[(3&t)<<4|c>>4]+u+r}return n.join("")}function D(t){var e=t.length,n=3*e/4;n%3?n=Math.floor(n):-1!="=.".indexOf(t[e-1])&&(n=-1!="=.".indexOf(t[e-2])?n-2:n-1);var r=new Uint8Array(n),s=0;return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),s=M[n];if(null!=s)return s;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}F();for(var r=0;;){var s=n(-1),o=n(0),i=n(64),a=n(64);if(64===a&&-1===s)break;e(s<<2|o>>4),64!=i&&(e(o<<4&240|i>>2),64!=a&&e(i<<6&192|a))}}(t,(function(t){r[s++]=t})),r.subarray(0,s)}function F(){if(!M){M={};for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++){var r=t.concat(e[n].split(""));I[n]=r;for(var s=0;s<r.length;s++){var o=r[s];void 0===M[o]&&(M[o]=s)}}}}var L,P="function"==typeof Uint8Array.prototype.slice;function B(t,e,n){return e===n?L||(L=new Uint8Array(0)):P?t.slice(e,n):new Uint8Array(t.subarray(e,n))}var V=0;function z(t,e){e=void 0!==(e=void 0===e?{}:e).v&&e.v,this.h=null,this.g=this.i=this.j=0,this.l=!1,this.v=e,t&&W(this,t)}function W(t,e){e=e.constructor===Uint8Array?e:e.constructor===ArrayBuffer||e.constructor===Array?new Uint8Array(e):e.constructor===String?D(e):e instanceof Uint8Array?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(0),t.h=e,t.j=0,t.i=t.h.length,t.g=t.j}function U(t){var e=t.h,n=e[t.g],r=127&n;return 128>n?(t.g+=1,r):(r|=(127&(n=e[t.g+1]))<<7,128>n?(t.g+=2,r):(r|=(127&(n=e[t.g+2]))<<14,128>n?(t.g+=3,r):(r|=(127&(n=e[t.g+3]))<<21,128>n?(t.g+=4,r):(r|=(15&(n=e[t.g+4]))<<28,128>n?(t.g+=5,r>>>0):(t.g+=5,128<=e[t.g++]&&128<=e[t.g++]&&128<=e[t.g++]&&128<=e[t.g++]&&t.g++,r)))))}function j(t){var e=t.h[t.g],n=t.h[t.g+1],r=t.h[t.g+2],s=t.h[t.g+3];return t.g+=4,t=2*((n=(e<<0|n<<8|r<<16|s<<24)>>>0)>>31)+1,e=n>>>23&255,n&=8388607,255==e?n?NaN:1/0*t:0==e?t*Math.pow(2,-149)*n:t*Math.pow(2,e-150)*(n+Math.pow(2,23))}z.prototype.reset=function(){this.g=this.j};var G=[];function q(){this.g=new Uint8Array(64),this.h=0}function H(t,e){for(;127<e;)t.push(127&e|128),e>>>=7;t.push(e)}function K(t){var e={},n=void 0!==e.N&&e.N;this.o={v:void 0!==e.v&&e.v},this.N=n,e=this.o,G.length?(n=G.pop(),e&&(n.v=e.v),t&&W(n,t),t=n):t=new z(t,e),this.g=t,this.m=this.g.g,this.h=this.i=this.l=-1,this.j=!1}function X(t){var e=t.g;if((e=e.g==e.i)||(e=t.j)||(e=(e=t.g).l||0>e.g||e.g>e.i),e)return!1;t.m=t.g.g;var n=7&(e=U(t.g));return 0!=n&&5!=n&&1!=n&&2!=n&&3!=n&&4!=n?(t.j=!0,!1):(t.i=e,t.l=e>>>3,t.h=n,!0)}function J(t){switch(t.h){case 0:if(0!=t.h)J(t);else{for(t=t.g;128&t.h[t.g];)t.g++;t.g++}break;case 1:1!=t.h?J(t):(t=t.g).g+=8;break;case 2:if(2!=t.h)J(t);else{var e=U(t.g);(t=t.g).g+=e}break;case 5:5!=t.h?J(t):(t=t.g).g+=4;break;case 3:for(e=t.l;;){if(!X(t)){t.j=!0;break}if(4==t.h){t.l!=e&&(t.j=!0);break}J(t)}break;default:t.j=!0}}function Y(t,e,n){var r=t.g.i,s=U(t.g),o=t.g.g+s;if(t.g.i=o,n(e,t),0!==(n=o-t.g.g))throw Error("Message parsing ended unexpectedly. Expected to read "+s+" bytes, instead read "+(s-n)+" bytes, either the data ended unexpectedly or the message misreported its own length");return t.g.g=o,t.g.i=r,e}function Z(t){var e,n=U(t.g),r=(t=t.g).g;if(t.g+=n,t=t.h,A)(e=T)||(e=T=new TextDecoder("utf-8",{fatal:!1})),e=e.decode(t.subarray(r,r+n));else{n=r+n;for(var s,o,i,a=[],u=null;r<n;)128>(s=t[r++])?a.push(s):224>s?r>=n?a.push(65533):(o=t[r++],194>s||128!=(192&o)?(r--,a.push(65533)):a.push((31&s)<<6|63&o)):240>s?r>=n-1?a.push(65533):128!=(192&(o=t[r++]))||224===s&&160>o||237===s&&160<=o||128!=(192&(e=t[r++]))?(r--,a.push(65533)):a.push((15&s)<<12|(63&o)<<6|63&e):244>=s?r>=n-2?a.push(65533):128!=(192&(o=t[r++]))||0!=o-144+(s<<28)>>30||128!=(192&(e=t[r++]))||128!=(192&(i=t[r++]))?(r--,a.push(65533)):(s=(7&s)<<18|(63&o)<<12|(63&e)<<6|63&i,s-=65536,a.push(55296+(s>>10&1023),56320+(1023&s))):a.push(65533),8192<=a.length&&(u=_(u,a),a.length=0);e=_(u,a)}return e}function Q(){this.h=[],this.i=0,this.g=new q}function tt(t,e){0!==e.length&&(t.h.push(e),t.i+=e.length)}function et(t){var e=t.i+t.g.length();if(0===e)return new Uint8Array(0);e=new Uint8Array(e);for(var n=t.h,r=n.length,s=0,o=0;o<r;o++){var i=n[o];0!==i.length&&(e.set(i,s),s+=i.length)}return 0!==(r=(n=t.g).h)&&(e.set(n.g.subarray(0,r),s),n.h=0),t.h=[e],e}function nt(t,e,n){if(null!=n){H(t.g,8*e+5),t=t.g;var r=n;0===(r=(n=0>r?1:0)?-r:r)?0<1/r?V=0:(0,V=2147483648):isNaN(r)?(0,V=2147483647):34028234663852886e22<r?(0,V=(n<<31|2139095040)>>>0):11754943508222875e-54>r?(r=Math.round(r/Math.pow(2,-149)),0,V=(n<<31|r)>>>0):(e=Math.floor(Math.log(r)/Math.LN2),r*=Math.pow(2,-e),16777216<=(r=Math.round(8388608*r))&&++e,0,V=(n<<31|e+127<<23|8388607&r)>>>0),n=V,t.push(n>>>0&255),t.push(n>>>8&255),t.push(n>>>16&255),t.push(n>>>24&255)}}q.prototype.push=function(t){if(!(this.h+1<this.g.length)){var e=this.g;this.g=new Uint8Array(Math.ceil(1+2*this.g.length)),this.g.set(e)}this.g[this.h++]=t},q.prototype.length=function(){return this.h},q.prototype.end=function(){var t=this.g,e=this.h;return this.h=0,B(t,0,e)},K.prototype.reset=function(){this.g.reset(),this.h=this.l=-1};var rt="function"==typeof Uint8Array;function st(t,e,n){if(null!=t)return"object"==typeof t?rt&&t instanceof Uint8Array?n(t):ot(t,e,n):e(t)}function ot(t,e,n){if(Array.isArray(t)){for(var r=Array(t.length),s=0;s<t.length;s++)r[s]=st(t[s],e,n);return Array.isArray(t)&&t.W&&ct(r),r}for(s in r={},t)r[s]=st(t[s],e,n);return r}function it(t){return"number"==typeof t?isFinite(t)?t:String(t):t}var at,ut={W:{value:!0,configurable:!0}};function ct(t){return Array.isArray(t)&&!Object.isFrozen(t)&&Object.defineProperties(t,ut),t}function lt(t,e,n){var r=at;if(at=null,t||(t=r),r=this.constructor.ca,t||(t=r?[r]:[]),this.j=r?0:-1,this.i=null,this.g=t,t=(r=this.g.length)-1,!r||(null===(r=this.g[t])||"object"!=typeof r||Array.isArray(r)||rt&&r instanceof Uint8Array)?void 0!==e&&-1<e?(this.l=Math.max(e,t+1-this.j),this.h=null):this.l=Number.MAX_VALUE:(this.l=t-this.j,this.h=r),n)for(e=0;e<n.length;e++)(t=n[e])<this.l?(t+=this.j,(r=this.g[t])?ct(r):this.g[t]=ft):(ht(this),(r=this.h[t])?ct(r):this.h[t]=ft)}var ft=Object.freeze(ct([]));function ht(t){var e=t.l+t.j;t.g[e]||(t.h=t.g[e]={})}function pt(t,e,n){return-1===e?null:void 0!==n&&n||e>=t.l?t.h?t.h[e]:void 0:t.g[e+t.j]}function dt(t){var e=void 0!==e&&e,n=pt(t,1,e);return null==n&&(n=ft),n===ft&&yt(t,1,n=ct([]),e),n}function mt(t,e,n){return null==(t=null==(t=pt(t,e))?t:+t)?void 0===n?0:n:t}function yt(t,e,n,r){void 0!==r&&r||e>=t.l?(ht(t),t.h[e]=n):t.g[e+t.j]=n}function gt(t,e){t.i||(t.i={});var n=t.i[1];if(!n){var r=dt(t);n=[];for(var s=0;s<r.length;s++)n[s]=new e(r[s]);t.i[1]=n}return n}function bt(t,e,n,r){var s=gt(t,n);e=e||new n,t=dt(t),null!=r?(s.splice(r,0,e),t.splice(r,0,wt(e))):(s.push(e),t.push(wt(e)))}function wt(t,e){if(t.i)for(var n in t.i){var r=t.i[n];if(Array.isArray(r))for(var s=0;s<r.length;s++)r[s]&&wt(r[s]);else r&&wt(r)}return t.g}function vt(t,e){return null==(t=pt(t,e))?0:t}function xt(t,e){return null==(t=pt(t,e))?"":t}function Nt(t,e){if(t=t.m){tt(e,e.g.end());for(var n=0;n<t.length;n++)tt(e,t[n])}}function $t(t,e){if(4==e.h)return!1;var n=e.m;return J(e),e.N||(e=B(e.g.h,n,e.g.g),(n=t.m)?n.push(e):t.m=[e]),!0}function Et(t,e){var n=void 0;return new(n||(n=Promise))((function(r,s){function o(t){try{a(e.next(t))}catch(t){s(t)}}function i(t){try{a(e.throw(t))}catch(t){s(t)}}function a(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(o,i)}a((e=e.apply(t,void 0)).next())}))}function St(t){lt.call(this,t)}function _t(t,e){for(;X(e);)switch(e.i){case 8:var n=U(e.g);yt(t,1,n);break;case 21:yt(t,2,n=j(e.g));break;case 26:yt(t,3,n=Z(e));break;case 34:yt(t,4,n=Z(e));break;default:if(!$t(t,e))return t}return t}function Tt(t){lt.call(this,t,-1,kt)}lt.prototype.toJSON=function(){return ot(wt(this),it,R)},lt.prototype.toString=function(){return wt(this).toString()},p(St,lt),p(Tt,lt),Tt.prototype.addClassification=function(t,e){return bt(this,t,St,e),this};var kt=[1];function At(t){lt.call(this,t)}function Ct(t,e){for(;X(e);)switch(e.i){case 13:var n=j(e.g);yt(t,1,n);break;case 21:yt(t,2,n=j(e.g));break;case 29:yt(t,3,n=j(e.g));break;case 37:yt(t,4,n=j(e.g));break;case 45:yt(t,5,n=j(e.g));break;default:if(!$t(t,e))return t}return t}function Ot(t){lt.call(this,t,-1,It)}p(At,lt),p(Ot,lt);var It=[1];function Mt(t){lt.call(this,t)}function Rt(t,e,n){if(n=t.createShader(0===n?t.VERTEX_SHADER:t.FRAGMENT_SHADER),t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw Error("Could not compile WebGL shader.\n\n"+t.getShaderInfoLog(n));return n}function Dt(t){return gt(t,St).map((function(t){return{index:vt(t,1),Y:mt(t,2),label:null!=pt(t,3)?xt(t,3):void 0,displayName:null!=pt(t,4)?xt(t,4):void 0}}))}function Ft(t){return{x:mt(t,1),y:mt(t,2),z:mt(t,3),visibility:null!=pt(t,4)?mt(t,4):void 0}}function Lt(t){t:{var e=new Ot;for(t=new K(t);X(t);)if(10===t.i){bt(e,Y(t,new At,Ct),At,void 0)}else if(!$t(e,t))break t}return gt(e,At).map(Ft)}function Pt(t,e){this.h=t,this.g=e,this.l=0}function Bt(t,e,n){return function(t,e){var n=t.g;if(void 0===t.m){var r=Rt(n,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",0),s=Rt(n,"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D sampler0;\n  void main(){\n    gl_FragColor = texture2D(sampler0, vTex);\n  }",1),o=n.createProgram();if(n.attachShader(o,r),n.attachShader(o,s),n.linkProgram(o),!n.getProgramParameter(o,n.LINK_STATUS))throw Error("Could not compile WebGL program.\n\n"+n.getProgramInfoLog(o));r=t.m=o,n.useProgram(r),s=n.getUniformLocation(r,"sampler0"),t.j={I:n.getAttribLocation(r,"aVertex"),H:n.getAttribLocation(r,"aTex"),da:s},t.s=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,t.s),n.enableVertexAttribArray(t.j.I),n.vertexAttribPointer(t.j.I,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),t.o=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,t.o),n.enableVertexAttribArray(t.j.H),n.vertexAttribPointer(t.j.H,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.uniform1i(s,0)}r=t.j,n.useProgram(t.m),n.canvas.width=e.width,n.canvas.height=e.height,n.viewport(0,0,e.width,e.height),n.activeTexture(n.TEXTURE0),t.h.bindTexture2d(e.glName),n.enableVertexAttribArray(r.I),n.bindBuffer(n.ARRAY_BUFFER,t.s),n.vertexAttribPointer(r.I,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.H),n.bindBuffer(n.ARRAY_BUFFER,t.o),n.vertexAttribPointer(r.H,2,n.FLOAT,!1,0,0),n.bindFramebuffer(n.DRAW_FRAMEBUFFER?n.DRAW_FRAMEBUFFER:n.FRAMEBUFFER,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.colorMask(!0,!0,!0,!0),n.drawArrays(n.TRIANGLE_FAN,0,4),n.disableVertexAttribArray(r.I),n.disableVertexAttribArray(r.H),n.bindBuffer(n.ARRAY_BUFFER,null),t.h.bindTexture2d(0)}(t,e),"function"==typeof t.g.canvas.transferToImageBitmap?Promise.resolve(t.g.canvas.transferToImageBitmap()):n?Promise.resolve(t.g.canvas):"function"==typeof createImageBitmap?createImageBitmap(t.g.canvas):(void 0===t.i&&(t.i=document.createElement("canvas")),new Promise((function(e){t.i.height=t.g.canvas.height,t.i.width=t.g.canvas.width,t.i.getContext("2d",{}).drawImage(t.g.canvas,0,0,t.g.canvas.width,t.g.canvas.height),e(t.i)})))}function Vt(t){this.g=t}p(Mt,lt);var zt=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Wt(t,e){return e+t}function Ut(t,e){window[t]=e}function jt(t){if(this.g=t,this.listeners={},this.j={},this.F={},this.m={},this.s={},this.G=this.o=this.R=!0,this.C=Promise.resolve(),this.P="",this.B={},this.locateFile=t&&t.locateFile||Wt,"object"==typeof window)var e=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else{if("undefined"==typeof location)throw Error("solutions can only be loaded on a web page or in a web worker");e=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"}if(this.S=e,t.options)for(var n=(e=i(Object.keys(t.options))).next();!n.done;n=e.next()){n=n.value;var r=t.options[n].default;void 0!==r&&(this.j[n]="function"==typeof r?r():r)}}function Gt(t){return Et(t,(function t(){var e,n,r,s,o,i,u,c,l,f,h,p=this;return N(t,(function(t){switch(t.g){case 1:return e=p,p.R?(n=function(t,e){return void 0===t.g.files?[]:"function"==typeof t.g.files?t.g.files(e):t.g.files}(p,p.j),g(t,function(){return Et(this,(function t(){return N(t,(function(t){switch(t.g){case 1:return t.m=2,g(t,WebAssembly.instantiate(zt),4);case 4:t.g=3,t.m=0;break;case 2:return t.m=0,t.j=null,t.return(!1);case 3:return t.return(!0)}}))}))}(),2)):t.return();case 2:if(r=t.h,"object"==typeof window)return Ut("createMediapipeSolutionsWasm",{locateFile:p.locateFile}),Ut("createMediapipeSolutionsPackedAssets",{locateFile:p.locateFile}),i=n.filter((function(t){return void 0!==t.data})),u=n.filter((function(t){return void 0===t.data})),c=Promise.all(i.map((function(t){var n=qt(e,t.url);if(void 0!==t.path){var r=t.path;n=n.then((function(t){return e.overrideFile(r,t),Promise.resolve(t)}))}return n}))),l=Promise.all(u.map((function(t){return void 0===t.simd||t.simd&&r||!t.simd&&!r?function(t){var e=document.createElement("script");return e.setAttribute("src",t),e.setAttribute("crossorigin","anonymous"),new Promise((function(t){e.addEventListener("load",(function(){t()}),!1),e.addEventListener("error",(function(){t()}),!1),document.body.appendChild(e)}))}(e.locateFile(t.url,e.S)):Promise.resolve()}))).then((function(){return Et(e,(function t(){var e,n,r=this;return N(t,(function(t){if(1==t.g)return e=window.createMediapipeSolutionsWasm,n=window.createMediapipeSolutionsPackedAssets,g(t,e(n),2);r.h=t.h,t.g=0}))}))})),f=Et(e,(function t(){var e=this;return N(t,(function(t){return e.g.graph&&e.g.graph.url?t=g(t,qt(e,e.g.graph.url),0):(t.g=0,t=void 0),t}))})),g(t,Promise.all([l,c,f]),7);if("function"!=typeof importScripts)throw Error("solutions can only be loaded on a web page or in a web worker");return s=n.filter((function(t){return void 0===t.simd||t.simd&&r||!t.simd&&!r})).map((function(t){return e.locateFile(t.url,e.S)})),importScripts.apply(null,a(s)),g(t,createMediapipeSolutionsWasm(Module),6);case 6:p.h=t.h,p.l=new OffscreenCanvas(1,1),p.h.canvas=p.l,o=p.h.GL.createContext(p.l,{antialias:!1,alpha:!1,ba:"undefined"!=typeof WebGL2RenderingContext?2:1}),p.h.GL.makeContextCurrent(o),t.g=4;break;case 7:if(p.l=document.createElement("canvas"),!(h=p.l.getContext("webgl2",{}))&&!(h=p.l.getContext("webgl",{})))return alert("Failed to create WebGL canvas context when passing video frame."),t.return();p.D=h,p.h.canvas=p.l,p.h.createContext(p.l,!0,!0,{});case 4:p.i=new p.h.SolutionWasm,p.R=!1,t.g=0}}))}))}function qt(t,e){return Et(t,(function t(){var n,r,s=this;return N(t,(function(t){return e in s.F?t.return(s.F[e]):(n=s.locateFile(e,""),r=fetch(n).then((function(t){return t.arrayBuffer()})),s.F[e]=r,t.return(r))}))}))}function Ht(t,e,n){return Et(t,(function t(){var r,s,o,a,u,c,l,f,h,p,d,m,y,b,w=this;return N(t,(function(t){switch(t.g){case 1:if(!n)return t.return(e);for(r={},s=0,o=i(Object.keys(n)),a=o.next();!a.done;a=o.next())u=a.value,"string"!=typeof(c=n[u])&&"texture"===c.type&&void 0!==e[c.stream]&&++s;1<s&&(w.G=!1),l=i(Object.keys(n)),a=l.next();case 2:if(a.done){t.g=4;break}if(f=a.value,"string"==typeof(h=n[f]))return y=r,b=f,g(t,function(t,e,n){return Et(t,(function t(){var r,s=this;return N(t,(function(t){return"number"==typeof n||n instanceof Uint8Array||n instanceof s.h.Uint8BlobList?t.return(n):n instanceof s.h.Texture2dDataOut?((r=s.s[e])||(r=new Pt(s.h,s.D),s.s[e]=r),t.return(Bt(r,n,s.G))):t.return(void 0)}))}))}(w,f,e[h]),14);if(p=e[h.stream],"detection_list"===h.type){if(p){for(var v=p.getRectList(),x=p.getLandmarksList(),$=p.getClassificationsList(),E=[],S=0;S<v.size();++S){var _=v.get(S);t:{var T=new Mt;for(_=new K(_);X(_);)switch(_.i){case 13:var k=j(_.g);yt(T,1,k);break;case 21:yt(T,2,k=j(_.g));break;case 29:yt(T,3,k=j(_.g));break;case 37:yt(T,4,k=j(_.g));break;case 45:yt(T,5,k=j(_.g));break;case 48:for(var A=_.g,C=128,O=0,I=k=0;4>I&&128<=C;I++)O|=(127&(C=A.h[A.g++]))<<7*I;if(128<=C&&(O|=(127&(C=A.h[A.g++]))<<28,k|=(127&C)>>4),128<=C)for(I=0;5>I&&128<=C;I++)k|=(127&(C=A.h[A.g++]))<<7*I+3;128>C?(A=O>>>0,(k=2147483648&(C=k>>>0))&&(C=~C>>>0,0==(A=1+~A>>>0)&&(C=C+1>>>0)),A=4294967296*C+(A>>>0),k=k?-A:A):(A.l=!0,k=void 0),yt(T,6,k);break;default:if(!$t(T,_))break t}}T={Z:mt(T,1),$:mt(T,2),height:mt(T,3),width:mt(T,4),rotation:mt(T,5,0),X:vt(T,6)},_=Lt(x.get(S)),A=$.get(S);t:for(k=new Tt,A=new K(A);X(A);)if(10===A.i)k.addClassification(Y(A,new St,_t));else if(!$t(k,A))break t;T={T,O:_,M:Dt(k)},E.push(T)}v=E}else v=[];r[f]=v,t.g=7;break}if("proto_list"===h.type){if(p){for(v=Array(p.size()),x=0;x<p.size();x++)v[x]=p.get(x);p.delete()}else v=[];r[f]=v,t.g=7;break}if(void 0===p){t.g=3;break}if("float_list"===h.type){r[f]=p,t.g=7;break}if("proto"===h.type){r[f]=p,t.g=7;break}if("texture"!==h.type)throw Error("Unknown output config type: '"+h.type+"'");return(d=w.s[f])||(d=new Pt(w.h,w.D),w.s[f]=d),g(t,Bt(d,p,w.G),13);case 13:m=t.h,r[f]=m;case 7:h.transform&&r[f]&&(r[f]=h.transform(r[f])),t.g=3;break;case 14:y[b]=t.h;case 3:a=l.next(),t.g=2;break;case 4:return t.return(r)}}))}))}function Kt(t,e){for(var n=e.name||"$",r=[].concat(a(e.wants)),s=new t.h.StringList,o=i(e.wants),u=o.next();!u.done;u=o.next())s.push_back(u.value);o=t.h.PacketListener.implement({onResults:function(s){for(var o={},i=0;i<e.wants.length;++i)o[r[i]]=s.get(i);var a=t.listeners[n];a&&(t.C=Ht(t,o,e.outs).then((function(n){n=a(n);for(var s=0;s<e.wants.length;++s){var i=o[r[s]];"object"==typeof i&&i.hasOwnProperty&&i.hasOwnProperty("delete")&&i.delete()}n&&(t.C=n)})))}}),t.i.attachMultiListener(s,o),s.delete()}function Xt(t){switch(void 0===t&&(t=0),t){case 1:return"pose_landmark_full.tflite";case 2:return"pose_landmark_heavy.tflite";default:return"pose_landmark_lite.tflite"}}function Jt(t){var e=this;t=t||{},this.g=new jt({locateFile:t.locateFile,files:function(t){return[{url:"pose_solution_packed_assets_loader.js"},{simd:!1,url:"pose_solution_wasm_bin.js"},{simd:!0,url:"pose_solution_simd_wasm_bin.js"},{data:!0,url:Xt(t.modelComplexity)}]},graph:{url:"pose_web.binarypb"},listeners:[{wants:["pose_landmarks","world_landmarks","segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},poseLandmarks:{type:"proto",stream:"pose_landmarks",transform:Lt},poseWorldLandmarks:{type:"proto",stream:"world_landmarks",transform:Lt},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(t){return Et(e,(function e(){var n,r,s,o=this;return N(e,(function(e){return 1==e.g?(n=Xt(t),r="third_party/mediapipe/modules/pose_landmark/"+n,g(e,qt(o.g,n),2)):(s=e.h,o.g.overrideFile(r,s),e.return(!0))}))}))}},smoothLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothLandmarks",fieldName:"bool_value"}},enableSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorEnableSegmentation",fieldName:"bool_value"}},smoothSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothSegmentation",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"poselandmarkgpu__posedetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"poselandmarkgpu__poselandmarkbyroigpu__tensorstoposelandmarksandsegmentation__ThresholdingCalculator",fieldName:"threshold"}}}})}(t=jt.prototype).close=function(){return this.i&&this.i.delete(),Promise.resolve()},t.reset=function(){return Et(this,(function t(){var e=this;return N(t,(function(t){e.i&&(e.i.reset(),e.m={},e.s={}),t.g=0}))}))},t.setOptions=function(t,e){var n=this;if(e=e||this.g.options){for(var r=[],s=[],o={},a=i(Object.keys(t)),u=a.next();!u.done;o={K:o.K,L:o.L},u=a.next()){var c=u.value;c in this.j&&this.j[c]===t[c]||(this.j[c]=t[c],void 0!==(u=e[c])&&(u.onChange&&(o.K=u.onChange,o.L=t[c],r.push(function(t){return function(){return Et(n,(function e(){var n=this;return N(e,(function(e){if(1==e.g)return g(e,t.K(t.L),2);!0===e.h&&(n.o=!0),e.g=0}))}))}}(o))),u.graphOptionXref&&(c={valueNumber:1===u.type?t[c]:0,valueBoolean:0===u.type&&t[c],valueString:2===u.type?t[c]:""},u=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),u.graphOptionXref),c),s.push(u))))}0===r.length&&0===s.length||(this.o=!0,this.A=(void 0===this.A?[]:this.A).concat(s),this.u=(void 0===this.u?[]:this.u).concat(r))}},t.initialize=function(){return Et(this,(function t(){var e=this;return N(t,(function(t){return 1==t.g?g(t,Gt(e),2):3!=t.g?g(t,function(t){return Et(t,(function t(){var e,n,r,s,o,a,u,c,l=this;return N(t,(function(t){if(1==t.g)return l.g.graph&&l.g.graph.url&&l.P===l.g.graph.url?t.return():(l.o=!0,l.g.graph&&l.g.graph.url?(l.P=l.g.graph.url,g(t,qt(l,l.g.graph.url),3)):void(t.g=2));for(2!=t.g&&(e=t.h,l.i.loadGraph(e)),n=i(Object.keys(l.B)),r=n.next();!r.done;r=n.next())s=r.value,l.i.overrideFile(s,l.B[s]);if(l.B={},l.g.listeners)for(o=i(l.g.listeners),a=o.next();!a.done;a=o.next())u=a.value,Kt(l,u);c=l.j,l.j={},l.setOptions(c),t.g=0}))}))}(e),3):g(t,function(t){return Et(t,(function t(){var e,n,r,s,o,a,u=this;return N(t,(function(t){switch(t.g){case 1:if(!u.o)return t.return();if(!u.u){t.g=2;break}e=i(u.u),n=e.next();case 3:if(n.done){t.g=5;break}return g(t,(0,n.value)(),4);case 4:n=e.next(),t.g=3;break;case 5:u.u=void 0;case 2:if(u.A){for(r=new u.h.GraphOptionChangeRequestList,s=i(u.A),o=s.next();!o.done;o=s.next())a=o.value,r.push_back(a);u.i.changeOptions(r),r.delete(),u.A=void 0}u.o=!1,t.g=0}}))}))}(e),0)}))}))},t.overrideFile=function(t,e){this.i?this.i.overrideFile(t,e):this.B[t]=e},t.clearOverriddenFiles=function(){this.B={},this.i&&this.i.clearOverriddenFiles()},t.send=function(t,e){return Et(this,(function n(){var r,s,o,a,u,c,l,f,h,p=this;return N(n,(function(n){switch(n.g){case 1:return p.g.inputs?(r=1e3*(null==e?performance.now():e),g(n,p.C,2)):n.return();case 2:return g(n,p.initialize(),3);case 3:for(s=new p.h.PacketDataList,o=i(Object.keys(t)),a=o.next();!a.done;a=o.next())if(u=a.value,c=p.g.inputs[u]){t:{var d=p,m=t[u];switch(c.type){case"video":var y=d.m[c.stream];if(y||(y=new Pt(d.h,d.D),d.m[c.stream]=y),0===(d=y).l&&(d.l=d.h.createTexture()),"undefined"!=typeof HTMLVideoElement&&m instanceof HTMLVideoElement){var b=m.videoWidth;y=m.videoHeight}else"undefined"!=typeof HTMLImageElement&&m instanceof HTMLImageElement?(b=m.naturalWidth,y=m.naturalHeight):(b=m.width,y=m.height);y={glName:d.l,width:b,height:y},(b=d.g).canvas.width=y.width,b.canvas.height=y.height,b.activeTexture(b.TEXTURE0),d.h.bindTexture2d(d.l),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,m),d.h.bindTexture2d(0),d=y;break t;case"detections":for((y=d.m[c.stream])||(y=new Vt(d.h),d.m[c.stream]=y),(d=y).data||(d.data=new d.g.DetectionListData),d.data.reset(m.length),y=0;y<m.length;++y){b=m[y];var w=d.data,v=w.setBoundingBox,x=y,N=b.T,$=new Mt;yt($,1,N.Z),yt($,2,N.$),yt($,3,N.height),yt($,4,N.width),yt($,5,N.rotation),yt($,6,N.X);var E=N=new Q;nt(E,1,pt($,1)),nt(E,2,pt($,2)),nt(E,3,pt($,3)),nt(E,4,pt($,4)),nt(E,5,pt($,5));var S=pt($,6);if(null!=S&&null!=S){H(E.g,48);var _=E.g,T=S;S=0>T;var k=(T=Math.abs(T))>>>0;for(T=Math.floor((T-k)/4294967296),T>>>=0,S&&(T=~T>>>0,4294967295<(k=1+(~k>>>0))&&(k=0,4294967295<++T&&(T=0))),S=V=k,k=T;0<k||127<S;)_.push(127&S|128),S=(S>>>7|k<<25)>>>0,k>>>=7;_.push(S)}if(Nt($,E),N=et(N),v.call(w,x,N),b.O)for(w=0;w<b.O.length;++w)E=!!($=b.O[w]).visibility,x=(v=d.data).addNormalizedLandmark,N=y,$=Object.assign(Object.assign({},$),{visibility:E?$.visibility:0}),yt(E=new At,1,$.x),yt(E,2,$.y),yt(E,3,$.z),$.visibility&&yt(E,4,$.visibility),nt(_=$=new Q,1,pt(E,1)),nt(_,2,pt(E,2)),nt(_,3,pt(E,3)),nt(_,4,pt(E,4)),nt(_,5,pt(E,5)),Nt(E,_),$=et($),x.call(v,N,$);if(b.M)for(w=0;w<b.M.length;++w){if(x=(v=d.data).addClassification,N=y,$=b.M[w],yt(E=new St,2,$.Y),$.index&&yt(E,1,$.index),$.label&&yt(E,3,$.label),$.displayName&&yt(E,4,$.displayName),_=$=new Q,null!=(k=pt(E,1))&&null!=k)if(H(_.g,8),S=_.g,0<=k)H(S,k);else{for(T=0;9>T;T++)S.push(127&k|128),k>>=7;S.push(1)}nt(_,2,pt(E,2)),null!=(S=pt(E,3))&&(S=O(S),H(_.g,26),H(_.g,S.length),tt(_,_.g.end()),tt(_,S)),null!=(S=pt(E,4))&&(S=O(S),H(_.g,34),H(_.g,S.length),tt(_,_.g.end()),tt(_,S)),Nt(E,_),$=et($),x.call(v,N,$)}}d=d.data;break t;default:d={}}}switch(l=d,f=c.stream,c.type){case"video":s.pushTexture2d(Object.assign(Object.assign({},l),{stream:f,timestamp:r}));break;case"detections":(h=l).stream=f,h.timestamp=r,s.pushDetectionList(h);break;default:throw Error("Unknown input config type: '"+c.type+"'")}}return p.i.send(s),g(n,p.C,4);case 4:s.delete(),n.g=0}}))}))},t.onResults=function(t,e){this.listeners[e||"$"]=t},S("Solution",jt),S("OptionType",{BOOL:0,NUMBER:1,aa:2,0:"BOOL",1:"NUMBER",2:"STRING"}),(t=Jt.prototype).reset=function(){this.g.reset()},t.close=function(){return this.g.close(),Promise.resolve()},t.onResults=function(t){this.g.onResults(t)},t.initialize=function(){return Et(this,(function t(){var e=this;return N(t,(function(t){return g(t,e.g.initialize(),0)}))}))},t.send=function(t,e){return Et(this,(function n(){var r=this;return N(n,(function(n){return g(n,r.g.send(t,e),0)}))}))},t.setOptions=function(t){this.g.setOptions(t)},S("Pose",Jt),S("POSE_CONNECTIONS",[[0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]]),S("POSE_LANDMARKS",{NOSE:0,LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,LEFT_EAR:7,RIGHT_EAR:8,LEFT_RIGHT:9,RIGHT_LEFT:10,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32}),S("POSE_LANDMARKS_LEFT",{LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,LEFT_EAR:7,LEFT_RIGHT:9,LEFT_SHOULDER:11,LEFT_ELBOW:13,LEFT_WRIST:15,LEFT_PINKY:17,LEFT_INDEX:19,LEFT_THUMB:21,LEFT_HIP:23,LEFT_KNEE:25,LEFT_ANKLE:27,LEFT_HEEL:29,LEFT_FOOT_INDEX:31}),S("POSE_LANDMARKS_RIGHT",{RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,RIGHT_EAR:8,RIGHT_LEFT:10,RIGHT_SHOULDER:12,RIGHT_ELBOW:14,RIGHT_WRIST:16,RIGHT_PINKY:18,RIGHT_INDEX:20,RIGHT_THUMB:22,RIGHT_HIP:24,RIGHT_KNEE:26,RIGHT_ANKLE:28,RIGHT_HEEL:30,RIGHT_FOOT_INDEX:32}),S("POSE_LANDMARKS_NEUTRAL",{NOSE:0}),S("VERSION","0.4.1633558788")}).call(window);class az{refCount(t){return uz("refCount")}incRef(t){return uz("incRef")}timerAvailable(){return!0}time(t){return uz("time")}read(t){return uz("read")}readSync(t){return uz("readSync")}readToGPU(t,e){return uz("readToGPU")}numDataIds(){return uz("numDataIds")}disposeData(t,e){return uz("disposeData")}write(t,e,n){return uz("write")}move(t,e,n,r,s){return uz("move")}memory(){return uz("memory")}floatPrecision(){return uz("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return uz("dispose")}}function uz(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cz(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,fz(t,e,n)}function lz(t,e,n){return Math.max(t,Math.min(e,n))}function fz(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function hz(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function pz(t,e,n=""){hz(gz(t,e),(()=>n+` Shapes ${t} and ${e} must match`))}function dz(t){hz(null!=t,(()=>"The input to the tensor constructor must be a non-null value."))}function mz(t,e=[],n=!1){if(null==e&&(e=[]),Array.isArray(t)||_z(t)&&!n)for(let r=0;r<t.length;++r)mz(t[r],e,n);else e.push(t);return e}function yz(t){if(0===t.length)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function gz(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function bz(t){return t%1==0}function wz(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function vz(t,e){const n=e.length;return t=null==t?e.map(((t,e)=>e)):[].concat(t),hz(t.every((t=>t>=-n&&t<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`)),hz(t.every((t=>bz(t))),(()=>`All values in axis param must be integers but got axis ${t}`)),t.map((t=>t<0?n+t:t))}function xz(t,e){const n=[],r=[],s=null!=e&&Array.isArray(e)&&0===e.length,o=null==e||s?null:vz(e,t).sort();let i=0;for(let e=0;e<t.length;++e){if(null!=o){if(o[i]===e&&1!==t[e])throw new Error(`Can't squeeze axis ${e} since its dim '${t[e]}' is not 1`);(null==o[i]||o[i]>e)&&1===t[e]&&(n.push(t[e]),r.push(e)),o[i]<=e&&i++}1!==t[e]&&(n.push(t[e]),r.push(e))}return{newShape:n,keptDims:r}}function Nz(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error(`Unknown data type ${t}`);n=new Uint8Array(e)}return n}function $z(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error(`Unknown data type ${t}`);n=new Array(e)}return n}function Ez(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function Sz(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function _z(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function Tz(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error(`Unknown dtype ${t}`)}function kz(t){if(null==t)return 0;let e=0;return t.forEach((t=>e+=t.length)),e}function Az(t){return"string"==typeof t||t instanceof String}function Cz(t){return"boolean"==typeof t}function Oz(t){return"number"==typeof t}function Iz(t){return Array.isArray(t)?Iz(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":Oz(t)?"float32":Az(t)?"string":Cz(t)?"bool":"float32"}function Mz(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Rz(t,e){for(let n=e;n<t;++n)if(t%n==0)return n;return t}function Dz(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function Fz(t,e,n,r=!1){const s=new Array;if(1===e.length){const o=e[0]*(r?2:1);for(let e=0;e<o;e++)s[e]=n[t+e]}else{const o=e[0],i=e.slice(1),a=i.reduce(((t,e)=>t*e))*(r?2:1);for(let e=0;e<o;e++)s[e]=Fz(t+e*a,i,n,r)}return s}function Lz(t,e,n=!1){if(0===t.length)return e[0];const r=t.reduce(((t,e)=>t*e))*(n?2:1);if(0===r)return[];if(r!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return Fz(0,t,e,n)}function Pz(t,e){const n=Bz(t,e);for(let t=0;t<n.length;t++)n[t]=1;return n}function Bz(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function Vz(t){t.forEach((e=>{hz(Number.isInteger(e)&&e>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`))}))}function zz(t){return t&&t.then&&"function"==typeof t.then}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wz{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Uz,this.populateURLFlags()}setPlatform(t,e){null!=this.platform&&(jz().getBool("IS_TEST")||jz().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=e}registerFlag(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){const e=this.urlFlags[t];jz().getBool("IS_TEST")||jz().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${e}.`),this.set(t,e)}}async getAsync(t){return t in this.flags||(this.flags[t]=await this.evaluateFlag(t)),this.flags[t]}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(zz(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(null==this.flagRegistry[t])throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(null==this.flagRegistry[t])throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const t=this.getQueryParams(this.global.location.search);if("tfjsflags"in t){t.tfjsflags.split(",").forEach((t=>{const[e,n]=t.split(":");this.urlFlags[e]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}(e,n)}))}}}function Uz(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((t,...n)=>(function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")))),e}function jz(){return Gz}let Gz=null;var qz="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function Hz(){throw new Error("setTimeout has not been defined")}function Kz(){throw new Error("clearTimeout has not been defined")}var Xz=Hz,Jz=Kz;function Yz(t){if(Xz===setTimeout)return setTimeout(t,0);if((Xz===Hz||!Xz)&&setTimeout)return Xz=setTimeout,setTimeout(t,0);try{return Xz(t,0)}catch(e){try{return Xz.call(null,t,0)}catch(e){return Xz.call(this,t,0)}}}"function"==typeof qz.setTimeout&&(Xz=setTimeout),"function"==typeof qz.clearTimeout&&(Jz=clearTimeout);var Zz,Qz=[],tW=!1,eW=-1;function nW(){tW&&Zz&&(tW=!1,Zz.length?Qz=Zz.concat(Qz):eW=-1,Qz.length&&rW())}function rW(){if(!tW){var t=Yz(nW);tW=!0;for(var e=Qz.length;e;){for(Zz=Qz,Qz=[];++eW<e;)Zz&&Zz[eW].run();eW=-1,e=Qz.length}Zz=null,tW=!1,function(t){if(Jz===clearTimeout)return clearTimeout(t);if((Jz===Kz||!Jz)&&clearTimeout)return Jz=clearTimeout,clearTimeout(t);try{Jz(t)}catch(e){try{return Jz.call(null,t)}catch(e){return Jz.call(this,t)}}}(t)}}function sW(t,e){this.fun=t,this.array=e}sW.prototype.run=function(){this.fun.apply(null,this.array)};function oW(){}var iW=oW,aW=oW,uW=oW,cW=oW,lW=oW,fW=oW,hW=oW;var pW=qz.performance||{},dW=pW.now||pW.mozNow||pW.msNow||pW.oNow||pW.webkitNow||function(){return(new Date).getTime()};var mW=new Date;var yW={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];Qz.push(new sW(t,e)),1!==Qz.length||tW||Yz(rW)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:iW,addListener:aW,once:uW,off:cW,removeListener:lW,removeAllListeners:fW,emit:hW,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*dW.call(pW),n=Math.floor(e),r=Math.floor(e%1*1e9);return t&&(n-=t[0],(r-=t[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-mW)/1e3}},gW=yW;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
let bW;function wW(){if(null==bW){let t;if("undefined"!=typeof window)t=window;else if(void 0!==qz)t=qz;else if(void 0!==gW)t=gW;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}bW=t}return bW}function vW(t,e){const n=function(){const t=wW();return null==t._tfGlobals&&(t._tfGlobals=new Map),t._tfGlobals}();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function xW(...t){jz().getBool("IS_TEST")||jz().getBool("PROD")||console.warn(...t)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const NW=vW("kernelRegistry",(()=>new Map)),$W=vW("gradRegistry",(()=>new Map));function EW(t,e){const n=kW(t,e);return NW.get(n)}function SW(t){return $W.get(t)}function _W(t){const e=NW.entries(),n=[];for(;;){const{done:r,value:s}=e.next();if(r)break;const[o,i]=s,[a]=o.split("_");a===t&&n.push(i)}return n}function TW(t){const{kernelName:e,backendName:n}=t,r=kW(e,n);NW.has(r)&&xW(`The kernel '${e}' for backend '${n}' is already registered`),NW.set(r,t)}function kW(t,e){return`${e}_${t}`}var AW=OW,CW=null;try{CW=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(Yot){}function OW(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function IW(t){return!0===(t&&t._)}OW.prototype._,Object.defineProperty(OW.prototype,"_",{value:!0}),OW.isLong=IW;var MW={},RW={};function DW(t,e){var n,r,s;return e?(s=0<=(t>>>=0)&&t<256)&&(r=RW[t])?r:(n=LW(t,(0|t)<0?-1:0,!0),s&&(RW[t]=n),n):(s=-128<=(t|=0)&&t<128)&&(r=MW[t])?r:(n=LW(t,t<0?-1:0,!1),s&&(MW[t]=n),n)}function FW(t,e){if(isNaN(t))return e?qW:GW;if(e){if(t<0)return qW;if(t>=WW)return YW}else{if(t<=-UW)return ZW;if(t+1>=UW)return JW}return t<0?FW(-t,e).neg():LW(t%zW|0,t/zW|0,e)}function LW(t,e,n){return new OW(t,e,n)}OW.fromInt=DW,OW.fromNumber=FW,OW.fromBits=LW;var PW=Math.pow;function BW(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return GW;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return BW(t.substring(1),e,n).neg();for(var s=FW(PW(n,8)),o=GW,i=0;i<t.length;i+=8){var a=Math.min(8,t.length-i),u=parseInt(t.substring(i,i+a),n);if(a<8){var c=FW(PW(n,a));o=o.mul(c).add(FW(u))}else o=(o=o.mul(s)).add(FW(u))}return o.unsigned=e,o}function VW(t,e){return"number"==typeof t?FW(t,e):"string"==typeof t?BW(t,e):LW(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}OW.fromString=BW,OW.fromValue=VW;var zW=4294967296,WW=zW*zW,UW=WW/2,jW=DW(1<<24),GW=DW(0);OW.ZERO=GW;var qW=DW(0,!0);OW.UZERO=qW;var HW=DW(1);OW.ONE=HW;var KW=DW(1,!0);OW.UONE=KW;var XW=DW(-1);OW.NEG_ONE=XW;var JW=LW(-1,2147483647,!1);OW.MAX_VALUE=JW;var YW=LW(-1,-1,!0);OW.MAX_UNSIGNED_VALUE=YW;var ZW=LW(0,-2147483648,!1);OW.MIN_VALUE=ZW;var QW=OW.prototype;QW.toInt=function(){return this.unsigned?this.low>>>0:this.low},QW.toNumber=function(){return this.unsigned?(this.high>>>0)*zW+(this.low>>>0):this.high*zW+(this.low>>>0)},QW.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(ZW)){var e=FW(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var s=FW(PW(t,6),this.unsigned),o=this,i="";;){var a=o.div(s),u=(o.sub(a.mul(s)).toInt()>>>0).toString(t);if((o=a).isZero())return u+i;for(;u.length<6;)u="0"+u;i=""+u+i}},QW.getHighBits=function(){return this.high},QW.getHighBitsUnsigned=function(){return this.high>>>0},QW.getLowBits=function(){return this.low},QW.getLowBitsUnsigned=function(){return this.low>>>0},QW.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ZW)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},QW.isZero=function(){return 0===this.high&&0===this.low},QW.eqz=QW.isZero,QW.isNegative=function(){return!this.unsigned&&this.high<0},QW.isPositive=function(){return this.unsigned||this.high>=0},QW.isOdd=function(){return 1==(1&this.low)},QW.isEven=function(){return 0==(1&this.low)},QW.equals=function(t){return IW(t)||(t=VW(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},QW.eq=QW.equals,QW.notEquals=function(t){return!this.eq(t)},QW.neq=QW.notEquals,QW.ne=QW.notEquals,QW.lessThan=function(t){return this.comp(t)<0},QW.lt=QW.lessThan,QW.lessThanOrEqual=function(t){return this.comp(t)<=0},QW.lte=QW.lessThanOrEqual,QW.le=QW.lessThanOrEqual,QW.greaterThan=function(t){return this.comp(t)>0},QW.gt=QW.greaterThan,QW.greaterThanOrEqual=function(t){return this.comp(t)>=0},QW.gte=QW.greaterThanOrEqual,QW.ge=QW.greaterThanOrEqual,QW.compare=function(t){if(IW(t)||(t=VW(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},QW.comp=QW.compare,QW.negate=function(){return!this.unsigned&&this.eq(ZW)?ZW:this.not().add(HW)},QW.neg=QW.negate,QW.add=function(t){IW(t)||(t=VW(t));var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,o=t.high>>>16,i=65535&t.high,a=t.low>>>16,u=0,c=0,l=0,f=0;return l+=(f+=s+(65535&t.low))>>>16,c+=(l+=r+a)>>>16,u+=(c+=n+i)>>>16,u+=e+o,LW((l&=65535)<<16|(f&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},QW.subtract=function(t){return IW(t)||(t=VW(t)),this.add(t.neg())},QW.sub=QW.subtract,QW.multiply=function(t){if(this.isZero())return GW;if(IW(t)||(t=VW(t)),CW)return LW(CW.mul(this.low,this.high,t.low,t.high),CW.get_high(),this.unsigned);if(t.isZero())return GW;if(this.eq(ZW))return t.isOdd()?ZW:GW;if(t.eq(ZW))return this.isOdd()?ZW:GW;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(jW)&&t.lt(jW))return FW(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,o=t.high>>>16,i=65535&t.high,a=t.low>>>16,u=65535&t.low,c=0,l=0,f=0,h=0;return f+=(h+=s*u)>>>16,l+=(f+=r*u)>>>16,f&=65535,l+=(f+=s*a)>>>16,c+=(l+=n*u)>>>16,l&=65535,c+=(l+=r*a)>>>16,l&=65535,c+=(l+=s*i)>>>16,c+=e*u+n*a+r*i+s*o,LW((f&=65535)<<16|(h&=65535),(c&=65535)<<16|(l&=65535),this.unsigned)},QW.mul=QW.multiply,QW.divide=function(t){if(IW(t)||(t=VW(t)),t.isZero())throw Error("division by zero");var e,n,r;if(CW)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?LW((this.unsigned?CW.div_u:CW.div_s)(this.low,this.high,t.low,t.high),CW.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?qW:GW;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return qW;if(t.gt(this.shru(1)))return KW;r=qW}else{if(this.eq(ZW))return t.eq(HW)||t.eq(XW)?ZW:t.eq(ZW)?HW:(e=this.shr(1).div(t).shl(1)).eq(GW)?t.isNegative()?HW:XW:(n=this.sub(t.mul(e)),r=e.add(n.div(t)));if(t.eq(ZW))return this.unsigned?qW:GW;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=GW}for(n=this;n.gte(t);){e=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(e)/Math.LN2),o=s<=48?1:PW(2,s-48),i=FW(e),a=i.mul(t);a.isNegative()||a.gt(n);)a=(i=FW(e-=o,this.unsigned)).mul(t);i.isZero()&&(i=HW),r=r.add(i),n=n.sub(a)}return r},QW.div=QW.divide,QW.modulo=function(t){return IW(t)||(t=VW(t)),CW?LW((this.unsigned?CW.rem_u:CW.rem_s)(this.low,this.high,t.low,t.high),CW.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},QW.mod=QW.modulo,QW.rem=QW.modulo,QW.not=function(){return LW(~this.low,~this.high,this.unsigned)},QW.and=function(t){return IW(t)||(t=VW(t)),LW(this.low&t.low,this.high&t.high,this.unsigned)},QW.or=function(t){return IW(t)||(t=VW(t)),LW(this.low|t.low,this.high|t.high,this.unsigned)},QW.xor=function(t){return IW(t)||(t=VW(t)),LW(this.low^t.low,this.high^t.high,this.unsigned)},QW.shiftLeft=function(t){return IW(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?LW(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):LW(0,this.low<<t-32,this.unsigned)},QW.shl=QW.shiftLeft,QW.shiftRight=function(t){return IW(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?LW(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):LW(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},QW.shr=QW.shiftRight,QW.shiftRightUnsigned=function(t){if(IW(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?LW(this.low>>>t|e<<32-t,e>>>t,this.unsigned):LW(32===t?e:e>>>t-32,0,this.unsigned)},QW.shru=QW.shiftRightUnsigned,QW.shr_u=QW.shiftRightUnsigned,QW.toSigned=function(){return this.unsigned?LW(this.low,this.high,!1):this},QW.toUnsigned=function(){return this.unsigned?this:LW(this.low,this.high,!0)},QW.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},QW.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},QW.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},OW.fromBytes=function(t,e,n){return n?OW.fromBytesLE(t,e):OW.fromBytesBE(t,e)},OW.fromBytesLE=function(t,e){return new OW(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},OW.fromBytesBE=function(t,e){return new OW(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const tU=AW||nz({__proto__:null,default:AW},[AW]);function eU(t){return tU.fromString(t,!0,16)}const nU=eU("c3a5c85c97cb3127"),rU=eU("b492b66fbe98f273"),sU=eU("9ae16a3b2f90404f");function oU(t){return t.xor(t.shru(47))}function iU(t,e,n){const r=t.slice(e,e+n);return tU.fromBytes(Array.from(r),!0,!0)}function aU(t,e){return iU(t,e,8)}function uU(t,e){return iU(t,e,4)}function cU(t,e){return 0===e?t:t.shru(e).or(t.shl(64-e))}function lU(t,e,n=eU("9ddfea08eb382d69")){let r=t.xor(e).mul(n);r=r.xor(r.shru(47));let s=e.xor(r).mul(n);return s=s.xor(s.shru(47)),s=s.mul(n),s}function fU(t,e,n,r){return function(t,e,n,r,s,o){s=s.add(t),o=cU(o.add(s).add(r),21);const i=s;return s=(s=s.add(e)).add(n),o=o.add(cU(s,44)),[s.add(r),o.add(i)]}(aU(t,e),aU(t,e+8),aU(t,e+16),aU(t,e+24),n,r)}function hU(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=mz(t)),jz().getBool("DEBUG")&&Ez(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){const e=new Uint8Array(t.length);for(let n=0;n<e.length;++n)0!==Math.round(t[n])&&(e[n]=1);return e}throw new Error(`Unknown data type ${e}`)}function pU(){return jz().platform.now()}function dU(t,e="utf-8"){return e=e||"utf-8",jz().platform.encode(t,e)}function mU(t,e="utf-8"){return e=e||"utf-8",jz().platform.decode(t,e)}var yU=Object.freeze({__proto__:null,createScalarValue:
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){return"string"===e?dU(t):hU([t],e)},toTypedArray:hU,now:pU,fetch:function(t,e){return jz().platform.fetch(t,e)},encodeString:dU,decodeString:mU,shuffle:cz,shuffleCombo:function(t,e){if(t.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${e.length}`);let n=t.length,r=0;for(;n>0;)r=Math.random()*n|0,n--,fz(t,n,r),fz(e,n,r)},clamp:lz,nearestLargerEven:function(t){return t%2==0?t:t+1},swap:fz,sum:function(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e},randUniform:function(t,e){const n=Math.random();return e*n+(1-n)*t},distSquared:function(t,e){let n=0;for(let r=0;r<t.length;r++){const s=Number(t[r])-Number(e[r]);n+=s*s}return n},assert:hz,assertShapesMatch:pz,assertNonNull:dz,flatten:mz,sizeFromShape:yz,isScalarShape:function(t){return 0===t.length},arraysEqual:gz,isInt:bz,tanh:function(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{const e=Math.exp(2*t);return(e-1)/(e+1)}},sizeToSquarishShape:function(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]},createShuffledIndices:function(t){const e=new Uint32Array(t);for(let n=0;n<t;++n)e[n]=n;return cz(e),e},rightPad:wz,repeatedTry:function(t,e=(t=>0),n){return new Promise(((r,s)=>{let o=0;const i=()=>{if(t())return void r();o++;const a=e(o);null!=n&&o>=n?s():setTimeout(i,a)};i()}))},inferFromImplicitShape:function(t,e){let n=1,r=-1;for(let e=0;e<t.length;++e)if(t[e]>=0)n*=t[e];else if(-1===t[e]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${e}`);r=e}else if(t[e]<0)throw Error(`Shapes can not be < 0. Found ${t[e]} at dim ${e}`);if(-1===r){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(0===n)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const s=t.slice();return s[r]=e/n,s},parseAxisParam:vz,squeezeShape:xz,getTypedArrayFromDType:Nz,getArrayFromDType:$z,checkConversionForErrors:Ez,isValidDtype:Sz,hasEncodingLoss:function(t,e){return"complex64"!==e&&(("float32"!==e||"complex64"===t)&&(("int32"!==e||"float32"===t||"complex64"===t)&&("bool"!==e||"bool"!==t)))},isTypedArray:_z,bytesPerElement:Tz,bytesFromStringArray:kz,isString:Az,isBoolean:Cz,isNumber:Oz,inferDtype:Iz,isFunction:Mz,nearestDivisor:Rz,computeStrides:Dz,toNestedArray:Lz,makeOnesTypedArray:Pz,makeZerosTypedArray:Bz,makeZerosNestedTypedArray:function(t,e){const n=t.reduce(((t,e)=>t*e),1);if(null==e||"float32"===e)return Lz(t,new Float32Array(n));if("int32"===e)return Lz(t,new Int32Array(n));if("bool"===e)return Lz(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)},assertNonNegativeIntegerDimensions:Vz,locToIndex:function(t,e,n){if(0===e)return 0;if(1===e)return t[0];let r=t[t.length-1];for(let e=0;e<t.length-1;++e)r+=n[e]*t[e];return r},indexToLoc:function(t,e,n){if(0===e)return[];if(1===e)return[t];const r=new Array(e);for(let e=0;e<r.length-1;++e)r[e]=Math.floor(t/n[e]),t-=r[e]*n[e];return r[r.length-1]=t,r},isPromise:zz,hexToLong:eU,fingerPrint64:function(t,e=t.length){const n=tU.fromNumber(81,!0);if(e<=32)return e<=16?function(t,e=t.length){if(e>=8){const n=sU.add(2*e),r=aU(t,0).add(sU),s=aU(t,e-8);return lU(cU(s,37).mul(n).add(r),cU(r,25).add(s).mul(n),n)}if(e>=4){const n=sU.add(2*e);return lU(uU(t,0).shl(3).add(e),uU(t,e-4),n)}if(e>0){const n=t[0]+(t[e>>1]<<8),r=e+(t[e-1]<<2);return oU(sU.mul(n).xor(nU.mul(r))).mul(sU)}return sU}(t,e):function(t,e=t.length){const n=sU.add(2*e),r=aU(t,0).mul(rU),s=aU(t,8),o=aU(t,e-8).mul(n),i=aU(t,e-16).mul(sU);return lU(cU(r.add(s),43).add(cU(o,30)).add(i),r.add(cU(s.add(sU),18)).add(o),n)}(t,e);if(e<=64)return function(t,e=t.length){const n=sU.add(2*e),r=aU(t,0).mul(sU),s=aU(t,8),o=aU(t,e-8).mul(n),i=aU(t,e-16).mul(sU),a=cU(r.add(s),43).add(cU(o,30)).add(i),u=lU(a,r.add(cU(s.add(sU),18)).add(o),n),c=aU(t,16).mul(n),l=aU(t,24),f=a.add(aU(t,e-32)).mul(n),h=u.add(aU(t,e-24)).mul(n);return lU(cU(c.add(l),43).add(cU(f,30)).add(h),c.add(cU(l.add(r),18)).add(f),n)}(t,e);let r=n,s=n.mul(rU).add(113),o=oU(s.mul(sU).add(113)).mul(sU),i=[tU.UZERO,tU.UZERO],a=[tU.UZERO,tU.UZERO];r=r.mul(sU).add(aU(t,0));let u=0;const c=64*(e-1>>6),l=c+(e-1&63)-63;do{r=cU(r.add(s).add(i[0]).add(aU(t,u+8)),37).mul(rU),s=cU(s.add(i[1]).add(aU(t,u+48)),42).mul(rU),r=r.xor(a[1]),s=s.add(i[0]).add(aU(t,u+40)),o=cU(o.add(a[0]),33).mul(rU),i=fU(t,u,i[1].mul(rU),r.add(a[0])),a=fU(t,u+32,o.add(a[1]),s.add(aU(t,u+16))),[o,r]=[r,o],u+=64}while(u!==c);const f=rU.add(o.and(255).shl(1));return u=l,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),r=cU(r.add(s).add(i[0]).add(aU(t,u+8)),37).mul(f),s=cU(s.add(i[1]).add(aU(t,u+48)),42).mul(f),r=r.xor(a[1].mul(9)),s=s.add(i[0].mul(9).add(aU(t,u+40))),o=cU(o.add(a[0]),33).mul(f),i=fU(t,u,i[1].mul(f),r.add(a[0])),a=fU(t,u+32,o.add(a[1]),s.add(aU(t,u+16))),[o,r]=[r,o],lU(lU(i[0],a[0],f).add(oU(s).mul(nU)).add(o),lU(i[1],a[1],f).add(r),f)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gU{constructor(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new wU)}profileKernel(t,e,n){let r;const s=()=>{r=n()};let o;const i=pU();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(s);else{s();for(const t of r)t.dataSync();o=Promise.resolve({kernelMs:pU()-i})}if(jz().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let e=0;e<r.length;e++){const n=r[e];n.data().then((e=>{bU(e,n.dtype,t)}))}return{kernelName:t,outputs:r,inputs:e,timeMs:o.then((t=>t.kernelMs)),extraInfo:o.then((t=>null!=t.getExtraProfileInfo?t.getExtraProfileInfo():""))}}logKernelProfile(t){const{kernelName:e,outputs:n,timeMs:r,inputs:s,extraInfo:o}=t;n.forEach((t=>{Promise.all([t.data(),r,o]).then((n=>{this.logger.logKernelProfile(e,t,n[0],n[1],s,n[2])}))}))}}function bU(t,e,n){if("float32"!==e)return!1;for(let e=0;e<t.length;e++){const r=t[e];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class wU{logKernelProfile(t,e,n,r,s,o){const i="number"==typeof r?wz(`${r}ms`,9):r.error,a=wz(t,25),u=e.rank,c=e.size,l=wz(e.shape.toString(),14);let f="";for(const t in s){const n=s[t];if(null!=n){const r=n.shape||e.shape,s=r.length;f+=`${t}: ${s}D ${s>0?r:""} `}}console.log(`%c${a}\t%c${i}\t%c${u}D ${l}\t%c${c}\t%c${f}\t%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vU(t,e,n,r){const s=Dz(e),o=function(t,e,n,r){const s=yz(e),o=r[r.length-1],i=new Array(o).fill(0),a=e.length,u="complex64"===n?EU(t):t;if(a>1)for(let t=0;t<s/o;t++){const e=t*o;for(let t=0;t<o;t++)i[t]=Math.max(i[t],xU(u[e+t],0,n).length)}return i}(t,e,n,s),i=e.length,a=$U(t,e,n,s,o),u=["Tensor"];return r&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${i}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(a.map((t=>"    "+t)).join("\n")),u.join("\n")}function xU(t,e,n){let r;return r=Array.isArray(t)?`${parseFloat(t[0].toFixed(7))} + ${parseFloat(t[1].toFixed(7))}j`:Az(t)?`'${t}'`:"bool"===n?NU(t):parseFloat(t.toFixed(7)).toString(),wz(r,e)}function NU(t){return 0===t?"false":"true"}function $U(t,e,n,r,s,o=!0){const i="complex64"===n?2:1,a=e[0],u=e.length;if(0===u){if("complex64"===n){return[xU(EU(t)[0],0,n)]}return"bool"===n?[NU(t[0])]:[t[0].toString()]}if(1===u){if(a>20){const e=3*i;let r=Array.from(t.slice(0,e)),o=Array.from(t.slice((a-3)*i,a*i));return"complex64"===n&&(r=EU(r),o=EU(o)),["["+r.map(((t,e)=>xU(t,s[e],n))).join(", ")+", ..., "+o.map(((t,e)=>xU(t,s[a-3+e],n))).join(", ")+"]"]}return["["+("complex64"===n?EU(t):Array.from(t)).map(((t,e)=>xU(t,s[e],n))).join(", ")+"]"]}const c=e.slice(1),l=r.slice(1),f=r[0]*i,h=[];if(a>20){for(let e=0;e<3;e++){const r=e*f,o=r+f;h.push(...$U(t.slice(r,o),c,n,l,s,!1))}h.push("...");for(let e=a-3;e<a;e++){const r=e*f,o=r+f;h.push(...$U(t.slice(r,o),c,n,l,s,e===a-1))}}else for(let e=0;e<a;e++){const r=e*f,o=r+f;h.push(...$U(t.slice(r,o),c,n,l,s,e===a-1))}const p=2===u?",":"";h[0]="["+h[0]+p;for(let t=1;t<h.length-1;t++)h[t]=" "+h[t]+p;let d=",\n";for(let t=2;t<u;t++)d+="\n";return h[h.length-1]=" "+h[h.length-1]+"]"+(o?"":d),h}function EU(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SU{constructor(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=yz(t),null!=n){const t=n.length;hz(t===this.size,(()=>`Length of values '${t}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||$z(e,this.size),this.strides=Dz(t)}set(t,...e){0===e.length&&(e=[0]),hz(e.length===this.rank,(()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`));const n=this.locToIndex(e);this.values[n]=t}get(...t){0===t.length&&(t=[0]);let e=0;for(const n of t){if(n<0||n>=this.shape[e]){const e=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(e)}e++}let n=t[t.length-1];for(let e=0;e<t.length-1;++e)n+=this.strides[e]*t[e];return this.values[n]}locToIndex(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];let e=t[t.length-1];for(let n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e}indexToLoc(t){if(0===this.rank)return[];if(1===this.rank)return[t];const e=new Array(this.shape.length);for(let n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return _U().makeTensor(this.values,this.shape,this.dtype)}}let _U=null,TU=null;class kU{constructor(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=yz(t),this.strides=Dz(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return TU.buffer(this.shape,this.dtype,t)}bufferSync(){return TU.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return Lz(this.shape,t,"complex64"===this.dtype)}arraySync(){return Lz(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const t=_U().read(this.dataId);if("string"===this.dtype){const e=await t;try{return e.map((t=>mU(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),_U().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=_U().readSync(this.dataId);if("string"===this.dtype)try{return t.map((t=>mU(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await _U().read(this.dataId);return"string"===this.dtype?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(_U().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return TU.print(this,t)}clone(){return this.throwIfDisposed(),TU.clone(this)}toString(t=!1){return vU(this.dataSync(),this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),TU.cast(this,t)}variable(t=!0,e,n){return this.throwIfDisposed(),_U().makeVariable(this,t,e,n)}}Object.defineProperty(kU,Symbol.hasInstance,{value:t=>!!t&&null!=t.data&&null!=t.dataSync&&null!=t.throwIfDisposed}),vW("Tensor",(()=>kU));class AU extends kU{constructor(t,e,n,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=e,this.name=n}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!gz(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);_U().disposeTensor(this),this.dataId=t.dataId,_U().incRef(this,null)}dispose(){_U().disposeVariable(this),this.isDisposedInternal=!0}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var CU,OU,IU,MU,RU;Object.defineProperty(AU,Symbol.hasInstance,{value:t=>t instanceof kU&&null!=t.assign&&t.assign instanceof Function}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(CU||(CU={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(OU||(OU={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(IU||(IU={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(MU||(MU={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(RU||(RU={}));const DU={float32:MU,int32:OU,bool:IU,complex64:RU};function FU(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return DU[t][e]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function LU(t,e){if(t.dtype===e.dtype)return[t,e];const n=FU(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function PU(t,e){hz(t.dtype===e.dtype,(()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`))}function BU(t){const e=[];return VU(t,e,new Set),e}function VU(t,e,n){if(null==t)return;if(t instanceof kU)return void e.push(t);if(r=t,!Array.isArray(r)&&"object"!=typeof r)return;var r;const s=t;for(const t in s){const r=s[t];n.has(r)||(n.add(r),VU(r,e,n))}}var zU=Object.freeze({__proto__:null,makeTypesMatch:LU,assertTypesMatch:PU,isTensorInList:function(t,e){return e.some((e=>e.id===t.id))},getTensorsInContainer:BU});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WU(t){return null!=t.kernelName}class UU{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((t=>t.name))))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class jU{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new UU}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;{const{asyncInit:e}=this.initializeBackend(t);if(e)return null}}return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,n=1){return t in this.registryFactory?(xW(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:n},!0)}async setBackend(t){if(null==this.registryFactory[t])throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,null==this.registry[t]){this.backendInstance=null;const{success:e,asyncInit:n}=this.initializeBackend(t);if(!(n?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new gU(this.backendInstance),!0}setupRegisteredKernels(){_W(this.backendName).forEach((t=>{null!=t.setupFunc&&t.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(t){_W(t).forEach((e=>{null!=e.disposeFunc&&e.disposeFunc(this.registry[t])}))}initializeBackend(t){const e=this.registryFactory[t];if(null==e)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const n=e.factory();if(!n||n instanceof az||"function"!=typeof n.then)return this.registry[t]=n,{success:!0,asyncInit:!1};{const e=++this.pendingBackendInitId,r=n.then((n=>!(e<this.pendingBackendInitId)&&(this.registry[t]=n,this.pendingBackendInit=null,!0))).catch((n=>(e<this.pendingBackendInitId||(this.pendingBackendInit=null,xW(`Initialization of backend ${t} failed`),xW(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(e){return xW(`Initialization of backend ${t} failed`),xW(e.stack||e.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority))}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e],{success:r,asyncInit:s}=this.initializeBackend(n);if(s||r)return{name:n,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const n=this.state.tensorInfo.get(e),r=n.backend,s=this.readSync(e),o=r.refCount(e);r.disposeData(e,!0),n.backend=t,t.move(e,s,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let n,r=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=e(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(t,e,n){t();try{const t=n();return e(),t}catch(t){throw e(),t}}nextTensorId(){return jU.nextTensorId++}nextVariableId(){return jU.nextVariableId++}clone(t){const e=qU.runKernel("Identity",{x:t}),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(t=>({x:()=>{const e={x:t},n={dtype:"float32"};return qU.runKernel("Cast",e,n)}})),[],{}),e}runKernel(t,e,n){null==this.backendName&&this.backend;if(!(null!=EW(t,this.backendName)))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,n){const r=this.backend.numDataIds();let s=0;n.forEach((t=>{s+="complex64"===t.dtype?3:1}));const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=r-e-s-o;if(i>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${i} data ids) after running '${t}'`)}runKernelFunc(t){let e,n=[];const r=this.isTapeOn(),s=this.state.numBytes,o=this.state.numTensors;let i,a;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const u=WU(t)?t.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(WU(t)){const{kernelName:e,inputs:s,attrs:o}=t;null==this.backendName&&this.backend;const u=EW(e,this.backendName);hz(null!=u,(()=>`Cannot find registered kernel '${e}' for backend '${this.backendName}'`)),i=()=>{const t=this.backend.numDataIds();a=u.kernelFunc({inputs:s,attrs:o,backend:this.backend});const i=Array.isArray(a)?a:[a];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(e,t,i);const c=i.map((t=>null!=t.rank?t:this.makeTensorFromTensorInfo(t)));if(r){const t=this.getTensorsForGradient(e,s,c);n=this.saveTensorsForBackwardMode(t)}return c}}else{const{forwardFunc:e}=t,s=t=>{r&&(n=t.map((t=>this.keep(this.clone(t)))))};i=()=>{const t=this.backend.numDataIds();a=this.tidy((()=>e(this.backend,s)));const n=Array.isArray(a)?a:[a];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,t,n),n}}const{inputs:c,attrs:l}=t,f=WU(t)?null:t.backwardsFunc;let h;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(h=this.profiler.profileKernel(u,c,(()=>i())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(h),e=h.outputs):e=i()})),r&&this.addTapeNode(u,c,e,f,n,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map((t=>null!=c[t]?c[t].shape:null)),outputShapes:e.map((t=>t.shape)),kernelTimeMs:h.timeMs,extraInfo:h.extraInfo}),Array.isArray(a)?e:e[0]}saveTensorsForBackwardMode(t){const e=t.map((t=>this.keep(this.clone(t))));return e}getTensorsForGradient(t,e,n){const r=SW(t);if(null!=r){const t=r.inputsToSave||[],s=r.outputsToSave||[];let o;r.saveAllInputs?(hz(Array.isArray(e),(()=>"saveAllInputs is true, expected inputs to be an array.")),o=Object.keys(e).map((t=>e[t]))):o=t.map((t=>e[t]));const i=n.filter(((t,e)=>s[e]));return o.concat(i)}return[]}makeTensor(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let s=t;"string"===n&&Az(t[0])&&(s=t.map((t=>dU(t))));const o=r.write(s,e,n),i=new kU(e,n,o,this.nextTensorId());if(this.trackTensor(i,r),"string"===n){const t=this.state.tensorInfo.get(o),e=kz(s);this.state.numBytes+=e-t.bytes,t.bytes=e}return i}makeTensorFromDataId(t,e,n,r){const s={dataId:t,shape:e,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(s,r)}makeTensorFromTensorInfo(t,e){const{dataId:n,shape:r,dtype:s}=t,o=new kU(r,s,n,this.nextTensorId());return this.trackTensor(o,e),o}makeVariable(t,e=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.cast(r));const s=new AU(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[s.name])throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(t,e){this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*Tz(t.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n})),t instanceof AU||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,"string"===t.dtype&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),"complex64"!==t.dtype&&"string"!==t.dtype){const e=t.size*Tz(t.dtype);this.state.numBytes-=e}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((t=>t.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const t of this.state.activeProfile.kernels)t.kernelTimeMs=await t.kernelTimeMs,t.extraInfo=await t.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(t,e,n,r,s,o){const i={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:s},a=SW(t);null!=a&&(r=a.gradFunc),null!=r&&(i.gradient=t=>(t=t.map(((t,e)=>{if(null==t){const t=n[e],r=Bz(t.size,t.dtype);return this.makeTensor(r,t.shape,t.dtype)}return t})),r(t.length>1?t:t[0],s,o))),this.state.activeTape.push(i)}keep(t){return t.kept=!0,t}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=BU(t),n=new Set(e.map((t=>t.id)));for(let t=0;t<this.state.activeScope.track.length;t++){const e=this.state.activeScope.track[t];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach((t=>{t.kept||t.scopeId!==r.id||this.track(t)}))}gradients(t,e,n,r=!1){if(hz(e.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const s=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",t)));hz(s instanceof kU,(()=>"The result y returned by f() must be a tensor."));const o=function(t,e,n){const r={},s={};for(let t=0;t<e.length;t++)r[e[t].id]=!0;for(let n=0;n<t.length;n++){const o=t[n],i=o.inputs;for(const t in i){const n=i[t];let a=!1;for(let t=0;t<e.length;t++)if(r[n.id]){o.outputs.forEach((t=>r[t.id]=!0)),a=!0,s[o.id]=!0;break}if(a)break}}const o={};o[n.id]=!0;const i={};for(let e=t.length-1;e>=0;e--){const n=t[e],r=n.inputs;for(let t=0;t<n.outputs.length;t++)if(o[n.outputs[t].id]){for(const t in r)o[r[t].id]=!0,i[n.id]=!0;break}}const a=[];for(let e=0;e<t.length;e++){const n=t[e];if(s[n.id]&&i[n.id]){const t={};for(const e in n.inputs){const s=n.inputs[e];r[s.id]&&(t[e]=s)}const e=Object.assign({},n);e.inputs=t,e.outputs=n.outputs,a.push(e)}}return a}(this.state.activeTape,e,s);if(!r&&0===o.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const t={};t[s.id]=null==n?function(t){const e=Pz(yz(t),"float32");return qU.makeTensor(e,t,"float32")}(s.shape):n,function(t,e,n,r){for(let s=e.length-1;s>=0;s--){const o=e[s],i=[];if(o.outputs.forEach((e=>{const n=t[e.id];null!=n?i.push(n):i.push(null)})),null==o.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const e in o.inputs){if(!(e in a))throw new Error(`Cannot backprop through input ${e}. Available gradients found: ${Object.keys(a)}.`);const s=n((()=>a[e]()));if("float32"!==s.dtype)throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${e} must have 'float32' dtype, but has '${s.dtype}'`);const i=o.inputs[e];if(!gz(s.shape,i.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${e}' has shape '${s.shape}', which does not match the shape of the input '${i.shape}'`);if(null==t[i.id])t[i.id]=s;else{const e=t[i.id];t[i.id]=r(e,s),e.dispose()}}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,o,(t=>this.tidy(t)),HU);const r=e.map((e=>t[e.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((t=>{for(const e of t.saved)e.dispose()})),this.state.activeTape=null),{value:s,grads:r}}))}customGrad(t){return hz(Mz(t),(()=>"The f passed in customGrad(f) must be a function.")),(...e)=>{let n;hz(e.every((t=>t instanceof kU)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};e.forEach(((t,e)=>{r[e]=t}));return this.runKernelFunc({forwardFunc:(r,s)=>(n=t(...e,s),hz(n.value instanceof kU,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),hz(Mz(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(t,r)=>{const s=n.gradFunc(t,r),o=Array.isArray(s)?s:[s];hz(o.length===e.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),hz(o.every((t=>t instanceof kU)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const i={};return o.forEach(((t,e)=>{i[e]=()=>t})),i},inputs:r})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)}async time(t){const e=pU(),n=await this.backend.time(t);return n.wallMs=pU()-e,n}track(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new UU;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function GU(){const t=wW();if(null==t._tfengine){const e=new Wz(t);t._tfengine=new jU(e)}var e;return e=t._tfengine.ENV,Gz=e,_U=()=>t._tfengine,t._tfengine}jU.nextTensorId=0,jU.nextVariableId=0;const qU=GU();function HU(t,e){const n={a:t,b:e};return qU.runKernel("Add",n)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let KU;function XU(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var JU=Object.freeze({__proto__:null,mockIsMobile:function(t){KU=t},isMobile:function(t){if(void 0!==KU)return KU;if(t||"undefined"!=typeof navigator&&null!=navigator){if(t||(t=navigator),"ReactNative"===t.product)return!0;const e=t.userAgent||t.vendor||("undefined"!=typeof window?window.opera:"");if(!e){const e=t;return e.userAgentData&&e.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1},isBrowser:XU});const YU=jz();YU.registerFlag("DEBUG",(()=>!1),(t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),YU.registerFlag("IS_BROWSER",(()=>XU())),YU.registerFlag("IS_NODE",(()=>void 0!==gW&&void 0!==gW.versions&&void 0!==gW.versions.node)),YU.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),YU.registerFlag("PROD",(()=>!1)),YU.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>YU.getBool("DEBUG"))),YU.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),YU.registerFlag("IS_TEST",(()=>!1)),YU.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>!0)),YU.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),YU.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));var ZU=[],QU=[],tj="undefined"!=typeof Uint8Array?Uint8Array:Array,ej=!1;function nj(){ej=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,n=t.length;e<n;++e)ZU[e]=t[e],QU[t.charCodeAt(e)]=e;QU["-".charCodeAt(0)]=62,QU["_".charCodeAt(0)]=63}function rj(t,e,n){for(var r,s,o=[],i=e;i<n;i+=3)r=(t[i]<<16)+(t[i+1]<<8)+t[i+2],o.push(ZU[(s=r)>>18&63]+ZU[s>>12&63]+ZU[s>>6&63]+ZU[63&s]);return o.join("")}function sj(t){var e;ej||nj();for(var n=t.length,r=n%3,s="",o=[],i=16383,a=0,u=n-r;a<u;a+=i)o.push(rj(t,a,a+i>u?u:a+i));return 1===r?(e=t[n-1],s+=ZU[e>>2],s+=ZU[e<<4&63],s+="=="):2===r&&(e=(t[n-2]<<8)+t[n-1],s+=ZU[e>>10],s+=ZU[e>>4&63],s+=ZU[e<<2&63],s+="="),o.push(s),o.join("")}function oj(t,e,n,r,s){var o,i,a=8*s-r-1,u=(1<<a)-1,c=u>>1,l=-7,f=n?s-1:0,h=n?-1:1,p=t[e+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+t[e+f],f+=h,l-=8);for(i=o&(1<<-l)-1,o>>=-l,l+=r;l>0;i=256*i+t[e+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return i?NaN:1/0*(p?-1:1);i+=Math.pow(2,r),o-=c}return(p?-1:1)*i*Math.pow(2,o-r)}function ij(t,e,n,r,s,o){var i,a,u,c=8*o-s-1,l=(1<<c)-1,f=l>>1,h=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,i=l):(i=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-i))<1&&(i--,u*=2),(e+=i+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(i++,u/=2),i+f>=l?(a=0,i=l):i+f>=1?(a=(e*u-1)*Math.pow(2,s),i+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,s),i=0));s>=8;t[n+p]=255&a,p+=d,a/=256,s-=8);for(i=i<<s|a,c+=s;c>0;t[n+p]=255&i,p+=d,i/=256,c-=8);t[n+p-d]|=128*m}var aj={}.toString,uj=Array.isArray||function(t){return"[object Array]"==aj.call(t)};function cj(){return fj.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function lj(t,e){if(cj()<e)throw new RangeError("Invalid typed array length");return fj.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=fj.prototype:(null===t&&(t=new fj(e)),t.length=e),t}function fj(t,e,n){if(!(fj.TYPED_ARRAY_SUPPORT||this instanceof fj))return new fj(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return dj(this,t)}return hj(this,t,e,n)}function hj(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);fj.TYPED_ARRAY_SUPPORT?(t=e).__proto__=fj.prototype:t=mj(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!fj.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|bj(e,n),s=(t=lj(t,r)).write(e,n);s!==r&&(t=t.slice(0,s));return t}(t,e,n):function(t,e){if(gj(e)){var n=0|yj(e.length);return 0===(t=lj(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?lj(t,0):mj(t,e);if("Buffer"===e.type&&uj(e.data))return mj(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function pj(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function dj(t,e){if(pj(e),t=lj(t,e<0?0:0|yj(e)),!fj.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function mj(t,e){var n=e.length<0?0:0|yj(e.length);t=lj(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function yj(t){if(t>=cj())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+cj().toString(16)+" bytes");return 0|t}function gj(t){return!(null==t||!t._isBuffer)}function bj(t,e){if(gj(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return jj(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Gj(t).length;default:if(r)return jj(t).length;e=(""+e).toLowerCase(),r=!0}}function wj(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return Mj(this,e,n);case"utf8":case"utf-8":return Cj(this,e,n);case"ascii":return Oj(this,e,n);case"latin1":case"binary":return Ij(this,e,n);case"base64":return Aj(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Rj(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function vj(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function xj(t,e,n,r,s){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=s?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(s)return-1;n=t.length-1}else if(n<0){if(!s)return-1;n=0}if("string"==typeof e&&(e=fj.from(e,r)),gj(e))return 0===e.length?-1:Nj(t,e,n,r,s);if("number"==typeof e)return e&=255,fj.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):Nj(t,[e],n,r,s);throw new TypeError("val must be string, number or Buffer")}function Nj(t,e,n,r,s){var o,i=1,a=t.length,u=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;i=2,a/=2,u/=2,n/=2}function c(t,e){return 1===i?t[e]:t.readUInt16BE(e*i)}if(s){var l=-1;for(o=n;o<a;o++)if(c(t,o)===c(e,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*i}else-1!==l&&(o-=o-l),l=-1}else for(n+u>a&&(n=a-u),o=n;o>=0;o--){for(var f=!0,h=0;h<u;h++)if(c(t,o+h)!==c(e,h)){f=!1;break}if(f)return o}return-1}function $j(t,e,n,r){n=Number(n)||0;var s=t.length-n;r?(r=Number(r))>s&&(r=s):r=s;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var i=0;i<r;++i){var a=parseInt(e.substr(2*i,2),16);if(isNaN(a))return i;t[n+i]=a}return i}function Ej(t,e,n,r){return qj(jj(e,t.length-n),t,n,r)}function Sj(t,e,n,r){return qj(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function _j(t,e,n,r){return Sj(t,e,n,r)}function Tj(t,e,n,r){return qj(Gj(e),t,n,r)}function kj(t,e,n,r){return qj(function(t,e){for(var n,r,s,o=[],i=0;i<t.length&&!((e-=2)<0);++i)r=(n=t.charCodeAt(i))>>8,s=n%256,o.push(s),o.push(r);return o}(e,t.length-n),t,n,r)}function Aj(t,e,n){return 0===e&&n===t.length?sj(t):sj(t.slice(e,n))}function Cj(t,e,n){n=Math.min(t.length,n);for(var r=[],s=e;s<n;){var o,i,a,u,c=t[s],l=null,f=c>239?4:c>223?3:c>191?2:1;if(s+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=t[s+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=t[s+1],i=t[s+2],128==(192&o)&&128==(192&i)&&(u=(15&c)<<12|(63&o)<<6|63&i)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=t[s+1],i=t[s+2],a=t[s+3],128==(192&o)&&128==(192&i)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&i)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),s+=f}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=4096));return n}(r)}fj.TYPED_ARRAY_SUPPORT=void 0===qz.TYPED_ARRAY_SUPPORT||qz.TYPED_ARRAY_SUPPORT,cj(),fj.poolSize=8192,fj._augment=function(t){return t.__proto__=fj.prototype,t},fj.from=function(t,e,n){return hj(null,t,e,n)},fj.TYPED_ARRAY_SUPPORT&&(fj.prototype.__proto__=Uint8Array.prototype,fj.__proto__=Uint8Array),fj.alloc=function(t,e,n){return function(t,e,n,r){return pj(e),e<=0?lj(t,e):void 0!==n?"string"==typeof r?lj(t,e).fill(n,r):lj(t,e).fill(n):lj(t,e)}(null,t,e,n)},fj.allocUnsafe=function(t){return dj(null,t)},fj.allocUnsafeSlow=function(t){return dj(null,t)},fj.isBuffer=function(t){return null!=t&&(!!t._isBuffer||Hj(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&Hj(t.slice(0,0))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t))},fj.compare=function(t,e){if(!gj(t)||!gj(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,s=0,o=Math.min(n,r);s<o;++s)if(t[s]!==e[s]){n=t[s],r=e[s];break}return n<r?-1:r<n?1:0},fj.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},fj.concat=function(t,e){if(!uj(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return fj.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=fj.allocUnsafe(e),s=0;for(n=0;n<t.length;++n){var o=t[n];if(!gj(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,s),s+=o.length}return r},fj.byteLength=bj,fj.prototype._isBuffer=!0,fj.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)vj(this,e,e+1);return this},fj.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)vj(this,e,e+3),vj(this,e+1,e+2);return this},fj.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)vj(this,e,e+7),vj(this,e+1,e+6),vj(this,e+2,e+5),vj(this,e+3,e+4);return this},fj.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?Cj(this,0,t):wj.apply(this,arguments)},fj.prototype.equals=function(t){if(!gj(t))throw new TypeError("Argument must be a Buffer");return this===t||0===fj.compare(this,t)},fj.prototype.inspect=function(){var t="";return this.length>0&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(t+=" ... ")),"<Buffer "+t+">"},fj.prototype.compare=function(t,e,n,r,s){if(!gj(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===s&&(s=this.length),e<0||n>t.length||r<0||s>this.length)throw new RangeError("out of range index");if(r>=s&&e>=n)return 0;if(r>=s)return-1;if(e>=n)return 1;if(this===t)return 0;for(var o=(s>>>=0)-(r>>>=0),i=(n>>>=0)-(e>>>=0),a=Math.min(o,i),u=this.slice(r,s),c=t.slice(e,n),l=0;l<a;++l)if(u[l]!==c[l]){o=u[l],i=c[l];break}return o<i?-1:i<o?1:0},fj.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},fj.prototype.indexOf=function(t,e,n){return xj(this,t,e,n,!0)},fj.prototype.lastIndexOf=function(t,e,n){return xj(this,t,e,n,!1)},fj.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var s=this.length-e;if((void 0===n||n>s)&&(n=s),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return $j(this,t,e,n);case"utf8":case"utf-8":return Ej(this,t,e,n);case"ascii":return Sj(this,t,e,n);case"latin1":case"binary":return _j(this,t,e,n);case"base64":return Tj(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return kj(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},fj.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Oj(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(127&t[s]);return r}function Ij(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(t[s]);return r}function Mj(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var s="",o=e;o<n;++o)s+=Uj(t[o]);return s}function Rj(t,e,n){for(var r=t.slice(e,n),s="",o=0;o<r.length;o+=2)s+=String.fromCharCode(r[o]+256*r[o+1]);return s}function Dj(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function Fj(t,e,n,r,s,o){if(!gj(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function Lj(t,e,n,r){e<0&&(e=65535+e+1);for(var s=0,o=Math.min(t.length-n,2);s<o;++s)t[n+s]=(e&255<<8*(r?s:1-s))>>>8*(r?s:1-s)}function Pj(t,e,n,r){e<0&&(e=4294967295+e+1);for(var s=0,o=Math.min(t.length-n,4);s<o;++s)t[n+s]=e>>>8*(r?s:3-s)&255}function Bj(t,e,n,r,s,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function Vj(t,e,n,r,s){return s||Bj(t,0,n,4),ij(t,e,n,r,23,4),n+4}function zj(t,e,n,r,s){return s||Bj(t,0,n,8),ij(t,e,n,r,52,8),n+8}fj.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),fj.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=fj.prototype;else{var s=e-t;n=new fj(s,void 0);for(var o=0;o<s;++o)n[o]=this[o+t]}return n},fj.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||Dj(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r},fj.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||Dj(t,e,this.length);for(var r=this[t+--e],s=1;e>0&&(s*=256);)r+=this[t+--e]*s;return r},fj.prototype.readUInt8=function(t,e){return e||Dj(t,1,this.length),this[t]},fj.prototype.readUInt16LE=function(t,e){return e||Dj(t,2,this.length),this[t]|this[t+1]<<8},fj.prototype.readUInt16BE=function(t,e){return e||Dj(t,2,this.length),this[t]<<8|this[t+1]},fj.prototype.readUInt32LE=function(t,e){return e||Dj(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},fj.prototype.readUInt32BE=function(t,e){return e||Dj(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},fj.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||Dj(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r>=(s*=128)&&(r-=Math.pow(2,8*e)),r},fj.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||Dj(t,e,this.length);for(var r=e,s=1,o=this[t+--r];r>0&&(s*=256);)o+=this[t+--r]*s;return o>=(s*=128)&&(o-=Math.pow(2,8*e)),o},fj.prototype.readInt8=function(t,e){return e||Dj(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},fj.prototype.readInt16LE=function(t,e){e||Dj(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},fj.prototype.readInt16BE=function(t,e){e||Dj(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},fj.prototype.readInt32LE=function(t,e){return e||Dj(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},fj.prototype.readInt32BE=function(t,e){return e||Dj(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},fj.prototype.readFloatLE=function(t,e){return e||Dj(t,4,this.length),oj(this,t,!0,23,4)},fj.prototype.readFloatBE=function(t,e){return e||Dj(t,4,this.length),oj(this,t,!1,23,4)},fj.prototype.readDoubleLE=function(t,e){return e||Dj(t,8,this.length),oj(this,t,!0,52,8)},fj.prototype.readDoubleBE=function(t,e){return e||Dj(t,8,this.length),oj(this,t,!1,52,8)},fj.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||Fj(this,t,e,n,Math.pow(2,8*n)-1,0);var s=1,o=0;for(this[e]=255&t;++o<n&&(s*=256);)this[e+o]=t/s&255;return e+n},fj.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||Fj(this,t,e,n,Math.pow(2,8*n)-1,0);var s=n-1,o=1;for(this[e+s]=255&t;--s>=0&&(o*=256);)this[e+s]=t/o&255;return e+n},fj.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||Fj(this,t,e,1,255,0),fj.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},fj.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||Fj(this,t,e,2,65535,0),fj.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):Lj(this,t,e,!0),e+2},fj.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||Fj(this,t,e,2,65535,0),fj.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):Lj(this,t,e,!1),e+2},fj.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||Fj(this,t,e,4,4294967295,0),fj.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):Pj(this,t,e,!0),e+4},fj.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||Fj(this,t,e,4,4294967295,0),fj.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Pj(this,t,e,!1),e+4},fj.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);Fj(this,t,e,n,s-1,-s)}var o=0,i=1,a=0;for(this[e]=255&t;++o<n&&(i*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},fj.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);Fj(this,t,e,n,s-1,-s)}var o=n-1,i=1,a=0;for(this[e+o]=255&t;--o>=0&&(i*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},fj.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||Fj(this,t,e,1,127,-128),fj.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},fj.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||Fj(this,t,e,2,32767,-32768),fj.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):Lj(this,t,e,!0),e+2},fj.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||Fj(this,t,e,2,32767,-32768),fj.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):Lj(this,t,e,!1),e+2},fj.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||Fj(this,t,e,4,2147483647,-2147483648),fj.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):Pj(this,t,e,!0),e+4},fj.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||Fj(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),fj.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Pj(this,t,e,!1),e+4},fj.prototype.writeFloatLE=function(t,e,n){return Vj(this,t,e,!0,n)},fj.prototype.writeFloatBE=function(t,e,n){return Vj(this,t,e,!1,n)},fj.prototype.writeDoubleLE=function(t,e,n){return zj(this,t,e,!0,n)},fj.prototype.writeDoubleBE=function(t,e,n){return zj(this,t,e,!1,n)},fj.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var s,o=r-n;if(this===t&&n<e&&e<r)for(s=o-1;s>=0;--s)t[s+e]=this[s+n];else if(o<1e3||!fj.TYPED_ARRAY_SUPPORT)for(s=0;s<o;++s)t[s+e]=this[s+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},fj.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var s=t.charCodeAt(0);s<256&&(t=s)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!fj.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var i=gj(t)?t:jj(new fj(t,r).toString()),a=i.length;for(o=0;o<n-e;++o)this[o+e]=i[o%a]}return this};var Wj=/[^+\/0-9A-Za-z-_]/g;function Uj(t){return t<16?"0"+t.toString(16):t.toString(16)}function jj(t,e){var n;e=e||1/0;for(var r=t.length,s=null,o=[],i=0;i<r;++i){if((n=t.charCodeAt(i))>55295&&n<57344){if(!s){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(i+1===r){(e-=3)>-1&&o.push(239,191,189);continue}s=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),s=n;continue}n=65536+(s-55296<<10|n-56320)}else s&&(e-=3)>-1&&o.push(239,191,189);if(s=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function Gj(t){return function(t){var e,n,r,s,o,i;ej||nj();var a=t.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===t[a-2]?2:"="===t[a-1]?1:0,i=new tj(3*a/4-o),r=o>0?a-4:a;var u=0;for(e=0,n=0;e<r;e+=4,n+=3)s=QU[t.charCodeAt(e)]<<18|QU[t.charCodeAt(e+1)]<<12|QU[t.charCodeAt(e+2)]<<6|QU[t.charCodeAt(e+3)],i[u++]=s>>16&255,i[u++]=s>>8&255,i[u++]=255&s;return 2===o?(s=QU[t.charCodeAt(e)]<<2|QU[t.charCodeAt(e+1)]>>4,i[u++]=255&s):1===o&&(s=QU[t.charCodeAt(e)]<<10|QU[t.charCodeAt(e+1)]<<4|QU[t.charCodeAt(e+2)]>>2,i[u++]=s>>8&255,i[u++]=255&s),i}(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(Wj,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function qj(t,e,n,r){for(var s=0;s<r&&!(s+n>=e.length||s>=t.length);++s)e[s+n]=t[s];return s}function Hj(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function Kj(t,e){let n=t;if(_z(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||_z(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&jz().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Xj(t,r,[]),r}function Xj(t,e,n){if(n=n||[],!Array.isArray(t)&&!_z(t))return void hz(0===e.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`));hz(e.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`)),hz(t.length===e[0],(()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`));const r=e.slice(1);for(let e=0;e<t.length;++e)Xj(t[e],r,n.concat(e))}function Jj(t,e,n,r){if("string_or_numeric"!==t){if(null==t)throw new Error("Expected dtype cannot be null.");if("numeric"!==t&&t!==e||"numeric"===t&&"string"===e)throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}}function Yj(t,e,n,r="numeric"){if(t instanceof kU)return Jj(r,t.dtype,e,n),t;let s=Iz(t);if("string"!==s&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),Jj(r,s,e,n),null==t||!_z(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){const r=null==t?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const o=Kj(t,s);_z(t)||Array.isArray(t)||(t=[t]);const i="string"!==s?hU(t,s):mz(t,[],!0);return qU.makeTensor(i,o,s)}function Zj(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map(((t,s)=>Yj(t,`${e}[${s}]`,n,r)))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qj(t){const e=Object.keys(t);if(1!==e.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const s=(...t)=>{qU.startScope(n);try{const e=r(...t);return zz(e)&&console.error("Cannot return a Promise inside of tidy."),qU.endScope(e),e}catch(t){throw qU.endScope(null),t}};return Object.defineProperty(s,"name",{value:n,configurable:!0}),s}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tG=Qj({complex_:function(t,e){const n=Yj(t,"real","complex"),r=Yj(e,"imag","complex");pz(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const s={real:n,imag:r};return qU.runKernel("Complex",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eG(t,e,n,r){if(null==r&&(r=Iz(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!_z(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){Vz(e);const t=yz(e),r=yz(n);hz(t===r,(()=>`Based on the provided shape, [${e}], the tensor should have ${t} values but has ${r}`));for(let t=0;t<n.length;++t){const r=n[t],s=t!==n.length-1||r!==yz(e.slice(t));hz(n[t]===e[t]||!s,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `))}}return _z(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?hU(t,r):mz(t,[],!0),qU.makeTensor(t,e,r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nG(t,e,n){return eG(t,e,Kj(t,n),n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rG={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};function sG(t,e){const n={};let r,s=0;for(const o of e){const e=o.name,i=o.dtype,a=o.shape,u=yz(a);let c;if("quantization"in o){const n=o.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error(`Weight ${o.name} with quantization ${n.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==n.dtype)throw new Error(`Weight ${o.name} has unknown quantization dtype ${n.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==i)throw new Error(`Weight ${o.name} is quantized with ${n.dtype} which only supports weights of type float32 not ${i}.`)}const a=rG[n.dtype],l=t.slice(s,s+u*a),f="uint8"===n.dtype?new Uint8Array(l):new Uint16Array(l);if("float32"===i)if("uint8"===n.dtype||"uint16"===n.dtype){c=new Float32Array(f.length);for(let t=0;t<f.length;t++){const e=f[t];c[t]=e*n.scale+n.min}}else{if("float16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type float32.`);void 0===r&&(r=pG()),c=r(f)}else{if("int32"!==i)throw new Error(`Unsupported dtype in weight '${e}': ${i}`);if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type int32.`);c=new Int32Array(f.length);for(let t=0;t<f.length;t++){const e=f[t];c[t]=Math.round(e*n.scale+n.min)}}s+=u*a}else if("string"===i){const e=yz(o.shape);c=[];for(let n=0;n<e;n++){const e=new Uint32Array(t.slice(s,s+4))[0];s+=4;const n=new Uint8Array(t.slice(s,s+e));c.push(n),s+=e}}else{const r=rG[i],o=t.slice(s,s+u*r);if("float32"===i)c=new Float32Array(o);else if("int32"===i)c=new Int32Array(o);else if("bool"===i)c=new Uint8Array(o);else{if("complex64"!==i)throw new Error(`Unsupported dtype in weight '${e}': ${i}`);{c=new Float32Array(o);const t=new Float32Array(c.length/2),r=new Float32Array(c.length/2);for(let e=0;e<t.length;e++)t[e]=c[2*e],r[e]=c[2*e+1];const s=nG(t,a,"float32"),i=nG(r,a,"float32");n[e]=tG(s,i),s.dispose(),i.dispose()}}s+=u*r}"complex64"!==i&&(n[e]=nG(c,a,i))}return n}function oG(t){if(null===t)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach((t=>{if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${t.constructor.name}`)}));const r=new Uint8Array(e);let s=0;return n.forEach((t=>{r.set(new Uint8Array(t.buffer),s),s+=t.byteLength})),r.buffer}const iG="undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa;function aG(t){return iG?fj.byteLength(t):new Blob([t]).size}function uG(t){if(1===t.length)return t[0];let e=0;t.forEach((t=>{e+=t.byteLength}));const n=new Uint8Array(e);let r=0;return t.forEach((t=>{n.set(new Uint8Array(t),r),r+=t.byteLength})),n.buffer}function cG(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);const e=t.split("/");return e[e.length-1]}function lG(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),n}async function fG(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),null!=t.weightsManifest){const[r,s]=await e(t.weightsManifest);n.weightSpecs=r,n.weightData=s}return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),n}function hG(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:aG(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:aG(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}function pG(){const t=function(){const t=t=>{let e=t<<13,n=0;for(;0==(8388608&e);)n-=8388608,e<<=1;return e&=-8388609,n+=947912704,e|n},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}(),e=function(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}(),n=function(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}();return r=>{const s=new ArrayBuffer(4*r.length),o=new Uint32Array(s);for(let s=0;s<r.length;s++){const i=r[s],a=t[n[i>>10]+(1023&i)]+e[i>>10];o[s]=a}return new Float32Array(s)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dG{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==dG.instance&&(dG.instance=new dG),dG.instance}static registerSaveRouter(t){dG.getInstance().saveRouters.push(t)}static registerLoadRouter(t){dG.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return dG.getHandlers(t,"save")}static getLoadHandlers(t,e){return dG.getHandlers(t,"load",e)}static getHandlers(t,e,n){const r=[];return("load"===e?dG.getInstance().loadRouters:dG.getInstance().saveRouters).forEach((e=>{const s=e(t,n);null!==s&&r.push(s)})),r}}const mG=t=>dG.getSaveHandlers(t),yG=(t,e)=>dG.getLoadHandlers(t,e)
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */;function gG(){if(!jz().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t="undefined"==typeof window?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function bG(t){const e=t.result;e.createObjectStore("models_store",{keyPath:"modelPath"}),e.createObjectStore("model_info_store",{keyPath:"modelPath"})}class wG{constructor(t){if(this.indexedDB=gG(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise(((t,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>bG(r),r.onsuccess=()=>{const s=r.result;if(null==e){const e=s.transaction("models_store","readonly"),r=e.objectStore("models_store").get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return s.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));t(r.result.modelArtifacts)},r.onerror=t=>(s.close(),n(r.error)),e.oncomplete=()=>s.close()}else{const r=hG(e),o=s.transaction("model_info_store","readwrite");let i=o.objectStore("model_info_store");const a=i.put({modelPath:this.modelPath,modelArtifactsInfo:r});let u;a.onsuccess=()=>{u=s.transaction("models_store","readwrite");const a=u.objectStore("models_store").put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:r});a.onsuccess=()=>t({modelArtifactsInfo:r}),a.onerror=t=>{i=o.objectStore("model_info_store");const e=i.delete(this.modelPath);e.onsuccess=()=>(s.close(),n(a.error)),e.onerror=t=>(s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}}},r.onerror=t=>n(r.error)}))}}wG.URL_SCHEME="indexeddb://";const vG=t=>{return jz().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(wG.URL_SCHEME)?(e=t.slice(wG.URL_SCHEME.length),new wG(e)):null;var e};dG.registerSaveRouter(vG),dG.registerLoadRouter(vG);class xG{constructor(){this.indexedDB=gG()}async listModels(){return new Promise(((t,e)=>{const n=this.indexedDB.open("tensorflowjs",1);n.onupgradeneeded=()=>bG(n),n.onsuccess=()=>{const r=n.result,s=r.transaction("model_info_store","readonly"),o=s.objectStore("model_info_store").getAll();o.onsuccess=()=>{const e={};for(const t of o.result)e[t.modelPath]=t.modelArtifactsInfo;t(e)},o.onerror=t=>(r.close(),e(o.error)),s.oncomplete=()=>r.close()},n.onerror=t=>e(n.error)}))}async removeModel(t){var e;return t=(e=t).startsWith(wG.URL_SCHEME)?e.slice(wG.URL_SCHEME.length):e,new Promise(((e,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>bG(r),r.onsuccess=()=>{const s=r.result,o=s.transaction("model_info_store","readwrite"),i=o.objectStore("model_info_store"),a=i.get(t);let u;a.onsuccess=()=>{if(null==a.result)return s.close(),n(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const r=i.delete(t),o=()=>{u=s.transaction("models_store","readwrite");const r=u.objectStore("models_store").delete(t);r.onsuccess=()=>e(a.result.modelArtifactsInfo),r.onerror=t=>n(a.error)};r.onsuccess=o,r.onerror=t=>(o(),s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}},r.onerror=t=>n(r.error)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NG="tensorflowjs_models",$G="info",EG="model_topology",SG="weight_specs",_G="weight_data",TG="model_metadata";function kG(t){return{info:[NG,t,$G].join("/"),topology:[NG,t,EG].join("/"),weightSpecs:[NG,t,SG].join("/"),weightData:[NG,t,_G].join("/"),modelMetadata:[NG,t,TG].join("/")}}function AG(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function CG(t){const e=t.split("/");if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join("/")}class OG{constructor(t){if(!jz().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=kG(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=hG(t);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(iG)return fj.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let t=0,r=e.length;t<r;t++)n+=String.fromCharCode(e[t]);return btoa(n)}(t.weightData));const s={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:r}}catch(t){throw AG(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(null==t)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=r;const s=this.LS.getItem(this.keys.modelMetadata);if(null!=s){const t=JSON.parse(s);e.format=t.format,e.generatedBy=t.generatedBy,e.convertedBy=t.convertedBy,null!=t.signature&&(e.signature=t.signature),null!=t.userDefinedMetadata&&(e.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(e.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(e.trainingConfig=t.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(null==o)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=function(t){if(iG){const e=fj.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;++t)n.set([e.charCodeAt(t)],t);return n.buffer}(o),e}}OG.URL_SCHEME="localstorage://";const IG=t=>{return jz().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(OG.URL_SCHEME)?(e=t.slice(OG.URL_SCHEME.length),new OG(e)):null;var e};dG.registerSaveRouter(IG),dG.registerLoadRouter(IG);class MG{constructor(){hz(jz().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),hz("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const t={},e=NG+"/",n="/"+$G;for(let r=0;r<this.LS.length;++r){const s=this.LS.key(r);if(s.startsWith(e)&&s.endsWith(n)){t[CG(s)]=JSON.parse(this.LS.getItem(s))}}return t}async removeModel(t){var e;const n=kG(t=(e=t).startsWith(OG.URL_SCHEME)?e.slice(OG.URL_SCHEME.length):e);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(n.info));return AG(n),r}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RG{constructor(){this.managers={}}static getInstance(){return null==RG.instance&&(RG.instance=new RG),RG.instance}static registerManager(t,e){hz(null!=t,(()=>"scheme must not be undefined or null.")),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),hz(t.length>0,(()=>"scheme must not be an empty string."));const n=RG.getInstance();hz(null==n.managers[t],(()=>`A model store manager is already registered for scheme '${t}'.`)),n.managers[t]=e}static getManager(t){const e=this.getInstance().managers[t];if(null==e)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}}function DG(t){if(-1===t.indexOf("://"))throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${RG.getSchemes().join(",")}`);return{scheme:t.split("://")[0],path:t.split("://")[1]}}async function FG(t,e,n=!1){hz(t!==e,(()=>`Old path and new path are the same: '${t}'`));const r=dG.getLoadHandlers(t);hz(r.length>0,(()=>`Copying failed because no load handler is found for source URL ${t}.`)),hz(r.length<2,(()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${t}.`));const s=r[0],o=dG.getSaveHandlers(e);hz(o.length>0,(()=>`Copying failed because no save handler is found for destination URL ${e}.`)),hz(o.length<2,(()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${e}.`));const i=o[0],a=DG(t).scheme,u=DG(t).path,c=a===DG(t).scheme,l=await s.load();n&&c&&await RG.getManager(a).removeModel(u);const f=await i.save(l);return n&&!c&&await RG.getManager(a).removeModel(u),f.modelArtifactsInfo}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class LG{fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}}if(jz().get("IS_BROWSER")){jz().setPlatform("browser",new LG);try{RG.registerManager(OG.URL_SCHEME,new MG)}catch(t){}try{RG.registerManager(wG.URL_SCHEME,new xG)}catch(t){}}const PG=()=>require("node-fetch");let BG;class VG{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return null!=jz().global.fetch?jz().global.fetch(t,e):(null==BG&&(BG=PG()),BG(t,e))}now(){const t=gW.hrtime();return 1e3*t[0]+t[1]/1e6}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)}}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function zG(t,e="float32",n){return e=e||"float32",Vz(t),new SU(t,e,n)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */jz().get("IS_NODE")&&!jz().get("IS_BROWSER")&&jz().setPlatform("node",new VG);const WG=Qj({cast_:function(t,e){const n=Yj(t,"x","cast");if(!Sz(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},s={dtype:e};return qU.runKernel("Cast",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UG=Qj({clone_:function(t){const e={x:Yj(t,"x","clone","string_or_numeric")};return qU.runKernel("Identity",e)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jG(t,e=!1){console.log(t.toString(e))}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */GU();!function(t){TU=t}({buffer:zG,cast:WG,clone:UG,print:jG});function GG(t){return new Promise((t=>setTimeout(t))).then(t)}class qG{constructor(t){if(!jz().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(qG.URL_SCHEME)&&(t=t.slice(qG.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}async save(t){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n=lG(t,[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]),r=window.URL.createObjectURL(new Blob([JSON.stringify(n)],{type:"application/json"})),s=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(s.download=this.modelJsonFileName,s.href=r,await GG((()=>s.dispatchEvent(new MouseEvent("click")))),null!=t.weightData){const t=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;t.download=this.weightDataFileName,t.href=e,await GG((()=>t.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:hG(t)}}}}qG.URL_SCHEME="downloads://";class HG{constructor(t){if(null==t||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.jsonFile=t[0],this.weightsFiles=t.slice(1)}async load(){return new Promise(((t,e)=>{const n=new FileReader;n.onload=n=>{const r=JSON.parse(n.target.result),s=r.modelTopology;if(null==s)return void e(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));if(null==r.weightsManifest)return void e(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));if(0===this.weightsFiles.length)return void t({modelTopology:s});const o=fG(r,(t=>this.loadWeights(t)));t(o)},n.onerror=t=>e(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),n.readAsText(this.jsonFile)}))}loadWeights(t){const e=[],n=[];for(const r of t)e.push(...r.weights),n.push(...r.paths);const r=this.checkManifestAndWeightFiles(t),s=n.map((t=>this.loadWeightsFile(t,r[t])));return Promise.all(s).then((t=>[e,uG(t)]))}loadWeightsFile(t,e){return new Promise(((n,r)=>{const s=new FileReader;s.onload=t=>{const e=t.target.result;n(e)},s.onerror=e=>r(`Failed to weights data from file of path '${t}'.`),s.readAsArrayBuffer(e)}))}checkManifestAndWeightFiles(t){const e=[],n=this.weightsFiles.map((t=>cG(t.name))),r={};for(const s of t)s.paths.forEach((t=>{const s=cG(t);if(-1!==e.indexOf(s))throw new Error(`Duplicate file basename found in weights manifest: '${s}'`);if(e.push(s),-1===n.indexOf(s))throw new Error(`Weight file with basename '${s}' is not provided.`);r[t]=this.weightsFiles[n.indexOf(s)]}));if(e.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${e.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function KG(t,e,n,r){!function(t){hz(null!=t&&Array.isArray(t)&&t.length>0,(()=>"promises must be a none empty array"))}(t),function(t,e){hz(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${t}`)),hz(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${e}`)),hz(e>=t,(()=>`startFraction must be no more than endFraction, but got startFraction ${t} and endFraction ${e}`))}(n=null==n?0:n,r=null==r?1:r);let s=0;return Promise.all(t.map((o=>(o.then((o=>{const i=n+ ++s/t.length*(r-n);return e(i),o})),o))))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function XG(t,e){null==e&&(e={});const n=null==e.fetchFunc?jz().platform.fetch:e.fetchFunc,r=t.map((t=>n(t,e.requestInit,{isBinary:!0}))),s=(null==e.onProgress?await Promise.all(r):await KG(r,e.onProgress,0,.5)).map((t=>t.arrayBuffer()));return null==e.onProgress?await Promise.all(s):await KG(s,e.onProgress,.5,1)}function JG(t){return async(e,n="",r)=>{const s=e.map((()=>!1)),o={},i=null!=r?r.map((()=>!1)):[],a=[];if(e.forEach(((t,e)=>{let n=0;t.weights.forEach((t=>{const u="quantization"in t?t.quantization.dtype:t.dtype,c=rG[u]*yz(t.shape),l=()=>{s[e]=!0,null==o[e]&&(o[e]=[]),o[e].push({manifestEntry:t,groupOffset:n,sizeBytes:c})};null!=r?r.forEach(((e,n)=>{e===t.name&&(l(),i[n]=!0)})):l(),a.push(t.name),n+=c}))})),!i.every((t=>t))){const t=r.filter(((t,e)=>!i[e]));throw new Error(`Could not find weights in manifest with names: ${t.join(", ")}. \nManifest JSON has weights with names: ${a.join(", ")}.`)}const u=s.reduce(((t,e,n)=>(e&&t.push(n),t)),[]),c=[];u.forEach((t=>{e[t].paths.forEach((t=>{const e=n+(n.endsWith("/")?"":"/")+t;c.push(e)}))}));const l=await t(c),f={};let h=0;return u.forEach((t=>{const n=e[t].paths.length;let r=0;for(let t=0;t<n;t++)r+=l[h+t].byteLength;const s=new ArrayBuffer(r),i=new Uint8Array(s);let a=0;for(let t=0;t<n;t++){const e=new Uint8Array(l[h+t]);i.set(e,a),a+=e.byteLength}o[t].forEach((t=>{const e=sG(s.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(const t in e)f[t]=e[t]})),h+=n})),f}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */dG.registerSaveRouter((t=>jz().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(qG.URL_SCHEME)?function(t="model"){return new qG(t)}(t.slice(qG.URL_SCHEME.length)):null));class YG{constructor(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,this.weightUrlConverter=e.weightUrlConverter,null!=e.fetchFunc?(hz("function"==typeof e.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=e.fetchFunc):this.fetch=jz().platform.fetch,hz(null!=t&&t.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(t)&&hz(2===t.length,(()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`)),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData;const n=lG(t,[{paths:["./model.weights.bin"],weights:t.weightSpecs}]);e.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin");const r=await this.fetch(this.path,e);if(r.ok)return{modelArtifactsInfo:hG(t),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let e;try{e=await t.json()}catch(t){let e=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=e.modelTopology,r=e.weightsManifest;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return fG(e,(t=>this.loadWeights(t)))}async loadWeights(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),r=t.substring(0,e),s=n>e?t.substring(n):"";return[r+"/",s]}(e),s=this.weightPathPrefix||n,o=[];for(const e of t)o.push(...e.weights);const i=[],a=[];for(const e of t)for(const t of e.paths)null!=this.weightUrlConverter?a.push(this.weightUrlConverter(t)):i.push(s+t+r);this.weightUrlConverter&&i.push(...await Promise.all(a));return[o,uG(await XG(i,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress}))]}}function ZG(t){return null!=t.match(YG.URL_SCHEME_REGEX)}YG.URL_SCHEME_REGEX=/^https?:\/\//;const QG=(t,e)=>{if("undefined"==typeof fetch&&(null==e||null==e.fetchFunc))return null;{let n=!0;if(n=Array.isArray(t)?t.every((t=>ZG(t))):ZG(t),n)return tq(t,e)}return null};function tq(t,e){return new YG(t,e)}function eq(t,e){return tq(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */dG.registerSaveRouter(QG),dG.registerLoadRouter(QG);class nq{constructor(t){this.modelArtifacts=t}load(){return this.modelArtifacts}}class rq{constructor(t){this.saveHandler=t}save(t){return this.saveHandler(t)}}class sq{constructor(t){t.load&&(this.load=()=>Promise.resolve(t.load())),t.save&&(this.save=e=>Promise.resolve(t.save(e)))}}function oq(t,e,n,r){if(1===arguments.length){return null!=t.modelTopology||null!=t.weightSpecs?new nq(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new nq({modelTopology:t}))}return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new nq({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r})}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var iq=Object.freeze({__proto__:null,browserFiles:function(t){return new HG(t)},browserHTTPRequest:eq,concatenateArrayBuffers:uG,decodeWeights:sG,encodeWeights:async function(t,e){const n=[],r=[],s=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);for(let o=0;o<s.length;++o){const i=s[o],a=Array.isArray(t)?t[o].tensor:t[i];if("float32"!==a.dtype&&"int32"!==a.dtype&&"bool"!==a.dtype&&"string"!==a.dtype&&"complex64"!==a.dtype)throw new Error(`Unsupported dtype in weight '${i}': ${a.dtype}`);const u={name:i,shape:a.shape,dtype:a.dtype};if("string"===a.dtype){const t=new Promise((async t=>{const e=await a.bytes(),n=e.reduce(((t,e)=>t+e.length),0)+4*e.length,r=new Uint8Array(n);let s=0;for(let t=0;t<e.length;t++){const n=e[t],o=new Uint8Array(new Uint32Array([n.length]).buffer);r.set(o,s),s+=4,r.set(n,s),s+=n.length}t(r)}));r.push(t)}else r.push(a.data());null!=e&&(u.group=e),n.push(u)}return{data:oG(await Promise.all(r)),specs:n}},fromMemory:function(t,e,n,r){const s=arguments;return new sq(oq(...s))},fromMemorySync:oq,getLoadHandlers:yG,getModelArtifactsForJSON:fG,getModelArtifactsInfoForJSON:hG,getSaveHandlers:mG,http:tq,isHTTPScheme:ZG,loadWeights:async function(t,e="",n,r){return JG((t=>XG(t,{requestInit:r})))(t,e,n)},registerLoadRouter:t=>dG.registerLoadRouter(t),registerSaveRouter:t=>dG.registerSaveRouter(t),weightsLoaderFactory:JG,withSaveHandler:function(t){return new rq(t)},withSaveHandlerSync:function(t){return new rq(t)},copyModel:async function(t,e){return FG(t,e,!1)},listModels:async function(){const t=RG.getSchemes(),e={};for(const n of t){const t=await RG.getManager(n).listModels();for(const r in t){e[n+"://"+r]=t[r]}}return e},moveModel:async function(t,e){return FG(t,e,!0)},removeModel:async function(t){const e=DG(t);return RG.getManager(e.scheme).removeModel(e.path)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aq=Qj({matMul_:function(t,e,n=!1,r=!1){let s=Yj(t,"a","matMul"),o=Yj(e,"b","matMul");[s,o]=LU(s,o);const i={a:s,b:o},a={transposeA:n,transposeB:r};return qU.runKernel("BatchMatMul",i,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uq=Qj({oneHot_:function(t,e,n=1,r=0){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const s={indices:Yj(t,"indices","oneHot","int32")},o={depth:e,onValue:n,offValue:r};return qU.runKernel("OneHot",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cq(t,e){return qU.tidy(t,e)}function lq(t){BU(t).forEach((t=>t.dispose()))}function fq(t){return qU.keep(t)}const hq=Qj({imag_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={input:Yj(t,"input","imag")};return qU.runKernel("Imag",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pq=Qj({neg_:function(t){const e={x:Yj(t,"x","neg")};return qU.runKernel("Neg",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dq=Qj({real_:function(t){const e={input:Yj(t,"input","real")};return qU.runKernel("Real",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mq=Qj({transpose_:function(t,e,n){const r=Yj(t,"x","transpose");if(null==e&&(e=r.shape.map(((t,e)=>e)).reverse()),hz(r.rank===e.length,(()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`)),e.forEach((t=>{hz(t>=0&&t<r.rank,(()=>"All entries in 'perm' must be between 0 and "+(r.rank-1)+` but got ${e}`))})),r.rank<=1)return r.clone();const s={x:r},o={perm:e};return"complex64"===r.dtype?cq((()=>{let t=dq(r),e=hq(r);return t=qU.runKernel("Transpose",{x:t},o),e=qU.runKernel("Transpose",{x:e},o),n&&(e=pq(e)),tG(t,e)})):qU.runKernel("Transpose",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yq=Qj({confusionMatrix_:function(t,e,n){const r=Yj(t,"labels","confusionMatrix"),s=Yj(e,"predictions","confusionMatrix");hz(null==n||n>0&&Number.isInteger(n),(()=>`If provided, numClasses must be a positive integer, but got ${n}`)),hz(1===r.rank,(()=>`Expected the rank of labels to be 1, but got ${r.rank}`)),hz(1===s.rank,(()=>`Expected the rank of predictions to be 1, but got ${s.rank}`)),hz(r.shape[0]===s.shape[0],(()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${s.shape[0]}. Labels and predictions should have the same number of elements.`)),hz(n>0&&Number.isInteger(n),(()=>`numClasses is required to be a positive integer, but got ${n}`));const o=uq(WG(r,"int32"),n),i=uq(WG(s,"int32"),n),a=mq(o),u=aq(a,i);return WG(u,"int32")}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var gq=Object.freeze({__proto__:null,confusionMatrix:yq});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bq(t,e){const n=t.length,r=[];for(let s=0;s<n;s++){const o=n-1-s,i=t[o]||1;(e[e.length-1-s]||1)>1&&1===i&&r.unshift(o)}return r}function wq(t,e){const n=[];for(let r=0;r<e.length;r++){const s=t[t.length-r-1],o=e.length-r-1,i=e[o];(null==s||1===s&&i>1)&&n.unshift(o)}return n}function vq(t,e){const n=[],r=Math.max(t.length,e.length);for(let s=0;s<r;s++){let r=t[t.length-s-1];null==r&&(r=1);let o=e[e.length-s-1];if(null==o&&(o=1),1===r)n.unshift(o);else if(1===o)n.unshift(r);else{if(r!==o){throw Error(`Operands could not be broadcast together with shapes ${t} and ${e}.`)}n.unshift(r)}}return n}var xq=Object.freeze({__proto__:null,getBroadcastDims:bq,getReductionAxes:wq,assertAndGetBroadcastShape:vq});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nq(t,e,n){if(dz(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");const r=Kj(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return eG(t,e,r,n)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let $q;function Eq(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,s=!1,o=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)s=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)o=!0;else if(null!=t.getContext)i=!0;else{if(!("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);a=!0}if(s){const e=2;if(s&&t.readyState<e)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=EW("FromPixels",qU.backendName)){const n={pixels:t},r={numChannels:e};return qU.runKernel("FromPixels",n,r)}const[u,c]=s?[t.videoWidth,t.videoHeight]:[t.width,t.height];let l,f;if(i)l=t.getContext("2d").getImageData(0,0,u,c).data;else if(r||n)l=t.data;else if(o||s||a){if(null==$q)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");$q=new OffscreenCanvas(1,1).getContext("2d")}else $q=document.createElement("canvas").getContext("2d");$q.canvas.width=u,$q.canvas.height=c,$q.drawImage(t,0,0,u,c),l=$q.getImageData(0,0,u,c).data}if(4===e)f=new Int32Array(l);else{const t=u*c;f=new Int32Array(t*e);for(let n=0;n<t;n++)for(let t=0;t<e;++t)f[n*e+t]=l[4*n+t]}return Nq(f,[c,u,e],"int32")}function Sq(t){return"undefined"!=typeof window&&"undefined"!=typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(t instanceof ImageBitmap)&&function(t){return null!=t&&0!==t.width&&0!==t.height}(t)&&!function(t){return null!=t&&t.data instanceof Uint8Array}(t)}const _q=Qj({fromPixels_:Eq});var Tq=Object.freeze({__proto__:null,fromPixelsAsync:async function(t,e=3){let n=null;if(jz().getBool("WRAP_TO_IMAGEBITMAP")&&Sq(t)){let e;try{e=await createImageBitmap(t,{premultiplyAlpha:"none"})}catch(t){e=null}n=null!=e&&e.width===t.width&&e.height===t.height?e:t}else n=t;return Eq(n,e)},toPixels:async function(t,e){let n=Yj(t,"img","toPixels");if(!(t instanceof kU)){const t=n;n=WG(t,"int32"),t.dispose()}if(2!==n.rank&&3!==n.rank)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const[r,s]=n.shape.slice(0,2),o=2===n.rank?1:n.shape[2];if(o>4||2===o)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${o}`);if("float32"!==n.dtype&&"int32"!==n.dtype)throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`);const i=await n.data(),a="float32"===n.dtype?255:1,u=new Uint8ClampedArray(s*r*4);for(let t=0;t<r*s;++t){const e=[0,0,0,255];for(let r=0;r<o;r++){const s=i[t*o+r];if("float32"===n.dtype){if(s<0||s>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${s}.`)}else if("int32"===n.dtype&&(s<0||s>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${s}.`);1===o?(e[0]=s*a,e[1]=s*a,e[2]=s*a):e[r]=s*a}const r=4*t;u[r+0]=Math.round(e[0]),u[r+1]=Math.round(e[1]),u[r+2]=Math.round(e[2]),u[r+3]=Math.round(e[3])}if(null!=e){e.width=s,e.height=r;const t=e.getContext("2d"),n=new ImageData(u,s,r);t.putImageData(n,0,0)}return n!==t&&n.dispose(),u},fromPixels:_q});function kq(t,e){const n=t.shape.length,r=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==e.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${n}`);if(0===yz(t.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const s=e.shape,o=s[s.length-1];let i=1;for(let t=0;t<s.length-1;++t)i*=s[t];const a=t.shape,u=s.slice();u.pop();let c=1;for(let t=o;t<n;++t)c*=a[t],u.push(a[t]);const l=[...Dz(t.shape).map((t=>t/c)),1].slice(0,o);return[u,i,c,l]}var Aq=Object.freeze({__proto__:null,prepareAndValidate:kq});function Cq(t,e,n){const r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${s}.`;if(n.rank<s)throw new Error(o+` update.rank < ${s}. `);if(t.length<r+(n.rank-s))throw new Error(o+` Output shape length < ${r+(n.rank-s)}`);if(n.rank!==s+t.length-r)throw new Error(o+" update.rank != "+(s+t.length-r));for(let t=0;t<s;++t)if(n.shape[t]!==e.shape[t])throw new Error(o+` updates.shape[${t}] (${n.shape[t]}) != indices.shape[${t}] (${e.shape[t]}).`);for(let e=0;e<n.rank-s;++e)if(n.shape[e+s]!==t[e+r])throw new Error(o+` updates.shape[${e+s}] (${n.shape[e+s]}) != shape[${e+s}] (${t[e+s]})`)}function Oq(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if("int32"!==e.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===e.size)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(0===t.size)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}Cq(n,e,t)}function Iq(t,e,n){const r=e.shape.length,s=r>1?e.shape[r-1]:1,o=n.length;let i=1;for(let t=s;t<o;++t)i*=n[t];const a=s<1?1:s;return{sliceRank:s,numUpdates:yz(e.shape)/a,sliceSize:i,strides:[...Dz(n.slice(0,s)),1],outputSize:yz(n)}}var Mq=Object.freeze({__proto__:null,validateUpdateShape:Cq,validateInput:Oq,calculateShapes:Iq});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rq(t,e,n,r){const s=[...t];for(let t=s.length;t<r.length;t++)s.push(1);for(let t=0;t<n;t++)0===t?s[e]=1:(s.splice(e,0,1),s.pop());return s}function Dq(t,e,n){return n<=t?n:n-(e-1)}function Fq(t,e){const n=[];for(let r=0;r<t;r++)n.push(e+r);return n}function Lq(t,e,n,r,s){const o=[...s],i=Fq(n,e);for(let s=0;s<o.length;s++)if(i.indexOf(s)>-1)o[s]=0;else{const i=Dq(e,n,s);let a=r[i];t&1<<i&&(a=0),o[s]=a}return o}function Pq(t,e,n,r,s){const o=[...s],i=Fq(n,e);for(let s=0;s<o.length;s++)if(i.indexOf(s)>-1)o[s]=Number.MAX_SAFE_INTEGER;else{const i=Dq(e,n,s);let a=r[i];t&1<<i&&(a=Number.MAX_SAFE_INTEGER),o[s]=a}for(let t=0;t<o.length;t++){const e=s[t];o[t]<0&&(o[t]+=e),o[t]=lz(0,o[t],s[t])}return o}function Bq(t,e,n){let r=t[e];return(n&1<<e||null==r)&&(r=1),r}function Vq(t,e,n,r,s,o){let i=e[s];const a=n[s]||1;(t&1<<s||o&1<<s||null==i)&&(i=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const u=r[s];return i<0&&(i+=u),i=lz(0,i,u-1),i}function zq(t,e,n,r,s,o){let i=e[s];const a=n[s]||1;(t&1<<s||o&1<<s||null==i)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const u=r[s];return i<0&&(i+=u),i=a>0?lz(0,i,u):lz(-1,i,u-1),i}function Wq(t,e,n,r,s,o){if(s[e])return n>0?o[e]:o[e+1&1];{const e=t<0?r+t:t;return e<o[0]?o[0]:e>o[1]?o[1]:e}}var Uq=Object.freeze({__proto__:null,assertParamsValid:function(t,e,n){const r=t.shape.length;hz(r===e.length,(()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`)),hz(r===n.length,(()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`));for(let s=0;s<r;++s)hz(e[s]+n[s]<=t.shape[s],(()=>`Error in slice${r}D: begin[${s}] + size[${s}] (${e[s]+n[s]}) would overflow input.shape[${s}] (${t.shape[s]})`))},maskToAxes:function(t){const e=[];let n=0;for(;t>0;)1&t&&e.push(n),t/=2,n++;return e},computeOutShape:function(t,e,n){const r=[];for(let s=0;s<t.length;s++)r[s]=Math.ceil((e[s]-t[s])/n[s]);return r},stridesWithElidedDims:Rq,getNormalizedAxes:function(t,e,n,r,s,o,i,a,u){const c=t.length;let l=new Array(c),f=new Array(c),h=new Array(c);if(e.length&&n>0){const u=e[0],c=n+1;l=Lq(i,u,c,r,t),f=Pq(a,u,c,s,t),h=Rq(o,u,c,t)}else for(let e=0;e<c;e++)l[e]=Vq(i,r,o,t,e,u),f[e]=zq(a,s,o,t,e,u),h[e]=Bq(o,e,u);return{begin:l,end:f,strides:h}},startIndicesWithElidedDims:Lq,stopIndicesWithElidedDims:Pq,stridesForAxis:Bq,startForAxis:Vq,stopForAxis:zq,isSliceContinous:function(t,e,n){let r=n.length;for(let t=0;t<n.length;t++)if(n[t]>1){r=t;break}for(let s=r+1;s<n.length;s++)if(e[s]>0||n[s]!==t[s])return!1;return!0},computeFlatOffset:function(t,e){let n=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)n+=t[r]*e[r];return n},parseSliceParams:function(t,e,n){let r;const s=t.shape.length;let o;return r="number"==typeof e?[e,...new Array(s-1).fill(0)]:e.length<s?e.concat(new Array(s-e.length).fill(0)):e.slice(),r.forEach((t=>{hz(-1!==t,(()=>"slice() does not support negative begin indexing."))})),o=null==n?new Array(s).fill(-1):"number"==typeof n?[n,...new Array(s-1).fill(-1)]:n.length<s?n.concat(new Array(s-n.length).fill(-1)):n,o=o.map(((e,n)=>e>=0?e:(hz(-1===e,(()=>`Negative size values should be exactly -1 but got ${e} for the slice() size at index ${n}.`)),t.shape[n]-r[n]))),[r,o]},sliceInfo:function(t,e,n,r,s,o,i,a,u){let c;if(null==r?(c=new Array(e.length),c.fill(1)):c=r,null!=i&&0!=(i&i-1))throw new Error("Multiple ellipses in slice is not allowed.");let l=!1;const f={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};for(let t=0;t<f.dims;t++)l&&0!=(1<<t&a)&&f.numAddAxisAfterEllipsis++,1<<t&i&&(l=!0);l||(f.ellipsisMask|=1<<f.dims,f.dims++);const h={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=null!=t.begin,e.endValid=null!=t.end,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<t.dims;r++)if(1<<r&t.ellipsisMask){const s=Math.min(e.dims-(t.dims-r)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<s;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&t.newAxisMask)e.finalShapeGatherIndices.push(-2),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);null!=t.begin&&(e.begin[n]=t.begin[r]),null!=t.end&&(e.end[n]=t.end[r]),e.strides[n]=t.strides[r],t.beginMask&1<<r&&(e.beginMask|=1<<n),t.endMask&1<<r&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(-1),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[n]=r,n++}}(f,h);let p=!0,d=!0,m=!0;const y=[],g=[];for(let e=0;e<t.length;++e){if(0===h.strides[e])throw Error(`strides[${e}] must be non-zero`);const n=!!(h.shrinkAxisMask&1<<e),r=t[e];if(-1===r){y.push(n?1:-1);continue}const s=[h.beginMask&1<<e,h.endMask&1<<e],o=[h.strides[e]>0?0:-1,h.strides[e]>0?r:r-1];if(n&&h.strides[e]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===h.strides[e];const i=!!(h.beginMask&1<<e&&h.endMask&1<<e);if(h.beginValid&&h.endValid){if(n){const t=h.begin[e]<0?r+h.begin[e]:h.begin[e];if(h.begin[e]=t,h.end[e]=h.begin[e]+1,t<0||t>=r)throw Error(`slice index ${h.begin[e]} of dimension ${e} out of bounds.`)}else h.begin[e]=Wq(h.begin[e],0,h.strides[e],r,s,o),h.end[e]=Wq(h.end[e],1,h.strides[e],r,s,o);const t=1===h.strides[e]&&0===h.begin[e]&&h.end[e]===r;p=p&&t,d=d&&(0===e&&1===h.strides[e]||t)}else p=p&&1===h.strides[e]&&i,d=d&&(0===e&&1===h.strides[e]||i);let a,u=!1;if(h.beginValid&&h.endValid?(a=h.end[e]-h.begin[e],u=!0):n?(a=1,u=!0):i&&r>=0&&(a=h.strides[e]<0?-r:r,u=!0),u){let t;t=0===a||a<0!=h.strides[e]<0?0:Math.trunc(a/h.strides[e])+(a%h.strides[e]!=0?1:0),y.push(t)}else y.push(-1)}for(let t=0;t<h.finalShapeGatherIndices.length;++t){const e=h.finalShapeGatherIndices[t];e>=0?g.push(y[e]):-2===e&&g.push(1)}const b=g.filter(((t,e)=>-2!==h.finalShapeGatherIndices[e]));return{finalShapeSparse:b,finalShape:g,isIdentity:p,sliceDim0:d,isSimpleSlice:m,begin:h.begin,end:h.end,strides:h.strides}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jq{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}class Gq{constructor(){this.classNameMap={}}static getMap(){return null==Gq.instance&&(Gq.instance=new Gq),Gq.instance}static register(t){Gq.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function qq(t){hz(null!=t.className,(()=>"Class being registered does not have the static className property defined.")),hz("string"==typeof t.className,(()=>"className is required to be a string, but got type "+typeof t.className)),hz(t.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),Gq.register(t)}var Hq=Object.freeze({__proto__:null,Serializable:jq,SerializationMap:Gq,registerClass:qq});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kq(){return 32===qU.backend.floatPrecision()?.001:.1}function Xq(t,e,n){let r=!0;if((_z(t)||_z(e))&&(r=!1),_z(t)&&_z(e)&&(r=!0),r){const n=t.constructor.name,r=e.constructor.name;if(n!==r)throw new Error(`Arrays are of different type. Actual: ${n}. Expected: ${r}`)}if(Array.isArray(t)&&Array.isArray(e)){const n=Kj(t),r=Kj(e);if(!gz(n,r))throw new Error(`Arrays have different shapes. Actual: [${n}]. Expected: [${r}]`)}const s=_z(t)?t:mz(t),o=_z(e)?e:mz(e);if(s.length!==o.length)throw new Error(`Arrays have different lengths actual: ${s.length} vs expected: ${o.length}.\nActual:   ${s}.\nExpected: ${o}.`);for(let t=0;t<o.length;++t){const e=s[t],r=o[t];if(!n(e,r))throw new Error(`Arrays differ: actual[${t}] = ${e}, expected[${t}] = ${r}.\nActual:   ${s}.\nExpected: ${o}.`)}}function Jq(t,e,n){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}var Yq=Object.freeze({__proto__:null,TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(t,e,n){return null==n&&(n=Kq()),Xq(t,e,((t,e)=>Jq(t,e,n)))},testEpsilon:Kq,expectPromiseToFail:function(t,e){t().then((()=>e.fail()),(()=>e()))},expectArraysEqual:function(t,e){const n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return Az(t)||Az(t[0])||Az(e)||Az(e[0])?Xq(t,n,((t,e)=>t==e)):Xq(t,e,((t,e)=>Jq(t,e,0)))},expectNumbersClose:function(t,e,n){if(null==n&&(n=Kq()),!Jq(t,e,n))throw new Error(`Numbers differ: actual === ${t}, expected === ${e}`)},expectValuesInRange:function(t,e,n){for(let r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error(`Value out of range:${t[r]} low: ${e}, high: ${n}`)},expectArrayBuffersEqual:function(t,e){const n=new Float32Array(t),r=new Float32Array(e);if(n.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${n.length}`);for(let t=0;t<r.length;t++)if(n[t]!==r[t])throw new Error(`Expected ArrayBuffer value at ${t} to be ${r[t]} but got ${n[t]} instead`)},encodeStrings:function t(e){for(let n=0;n<e.length;n++){const r=e[n];Array.isArray(r)?t(r):e[n]=dU(r)}return e}});
/** @license See the LICENSE file. */const Zq=Qj({add_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=Yj(t,"a","add"),r=Yj(e,"b","add");[n,r]=LU(n,r);const s={a:n,b:r};return qU.runKernel("Add",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qq=Qj({floorDiv_:function(t,e){let n=Yj(t,"a","floorDiv"),r=Yj(e,"b","floorDiv");[n,r]=LU(n,r);const s={a:n,b:r};return qU.runKernel("FloorDiv",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tH=Qj({div_:function(t,e){let n=Yj(t,"a","div"),r=Yj(e,"b","div");if([n,r]=LU(n,r),"int32"===n.dtype&&"int32"===r.dtype)return Qq(n,r);const s={a:n,b:r};return qU.runKernel("RealDiv",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eH=Qj({mul_:function(t,e){let n=Yj(t,"a","mul"),r=Yj(e,"b","mul");[n,r]=LU(n,r);const s={a:n,b:r};return qU.runKernel("Multiply",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nH=Qj({abs_:function(t){const e=Yj(t,"x","abs");if("complex64"===e.dtype){const t={x:e};return qU.runKernel("ComplexAbs",t)}{const t={x:e};return qU.runKernel("Abs",t)}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rH=Qj({acos_:function(t){const e={x:Yj(t,"x","acos")};return qU.runKernel("Acos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sH=Qj({acosh_:function(t){const e={x:Yj(t,"x","acosh")};return qU.runKernel("Acosh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oH=Qj({addN_:function(t){hz(Array.isArray(t),(()=>"The argument passed to tf.addN() must be a list of tensors")),hz(t.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`));const e=t.map(((t,e)=>Yj(t,`tensors${e}`,"addN"))),n=e[0];e.forEach((t=>{if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((t=>{if(!gz(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const r=e;return qU.runKernel("AddN",r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iH=Qj({all_:function(t,e=null,n=!1){const r={x:Yj(t,"x","all","bool")},s={axis:e,keepDims:n};return qU.runKernel("All",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aH=Qj({any_:function(t,e=null,n=!1){const r={x:Yj(t,"x","any","bool")},s={axis:e,keepDims:n};return qU.runKernel("Any",r,s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uH=Qj({argMax_:function(t,e=0){const n={x:Yj(t,"x","argMax")},r={axis:e};return qU.runKernel("ArgMax",n,r)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cH=Qj({argMin_:function(t,e=0){const n={x:Yj(t,"x","argMin")},r={axis:e};return qU.runKernel("ArgMin",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lH=Qj({asin_:function(t){const e={x:Yj(t,"x","asin")};return qU.runKernel("Asin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fH=Qj({asinh_:function(t){const e={x:Yj(t,"x","asinh")};return qU.runKernel("Asinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hH=Qj({atan_:function(t){const e={x:Yj(t,"x","atan")};return qU.runKernel("Atan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pH=Qj({atan2_:function(t,e){let n=Yj(t,"a","atan2"),r=Yj(e,"b","atan2");[n,r]=LU(n,r);const s={a:n,b:r};return qU.runKernel("Atan2",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dH=Qj({atanh_:function(t){const e={x:Yj(t,"x","atanh")};return qU.runKernel("Atanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mH(t,e,n,r,s,o,i="channelsLast"){const[a,u]=wH(e);let c;if("channelsLast"===i)c=[a,u,t[3],t[3]];else{if("channelsFirst"!==i)throw new Error(`Unknown dataFormat ${i}`);c=[a,u,t[1],t[1]]}return yH(t,c,n,r,s,o,!1,i)}function yH(t,e,n,r,s,o,i=!1,a="channelsLast"){let[u,c,l,f]=[-1,-1,-1,-1];if("channelsLast"===a)[u,c,l,f]=t;else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);[u,f,c,l]=t}const[h,p,,d]=e,[m,y]=wH(n),[g,b]=wH(r),w=xH(h,g),v=xH(p,b),{padInfo:x,outHeight:N,outWidth:$}=function(t,e,n,r,s,o,i,a,u){let c,l,f;if("number"==typeof t){c={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};const s=function(t,e,n,r,s){null==r&&(r=bH(t,e,n));const o=t[0],i=t[1],a=NH((o-e+2*r)/n+1,s),u=NH((i-e+2*r)/n+1,s);return[a,u]}([e,n],o,r,t,a);l=s[0],f=s[1]}else if("same"===t){l=Math.ceil(e/r),f=Math.ceil(n/s);const t=Math.max(0,(l-1)*r+o-e),a=Math.max(0,(f-1)*s+i-n),u=Math.floor(t/2),h=t-u,p=Math.floor(a/2);c={top:u,bottom:h,left:p,right:a-p,type:"SAME"}}else if("valid"===t)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-o+1)/r),f=Math.ceil((n-i+1)/s);else{if("object"!=typeof t)throw Error(`Unknown padding parameter: ${t}`);{const h="channelsLast"===u?t[1][0]:t[2][0],p="channelsLast"===u?t[1][1]:t[2][1],d="channelsLast"===u?t[2][0]:t[3][0],m="channelsLast"===u?t[2][1]:t[3][1];c={top:h,bottom:p,left:d,right:m,type:0===h&&0===p&&0===d&&0===m?"VALID":"EXPLICIT"},l=NH((e-o+h+p)/r+1,a),f=NH((n-i+d+m)/s+1,a)}}return{padInfo:c,outHeight:l,outWidth:f}}(s,c,l,m,y,w,v,o,a),E=i?d*f:d;let S;return"channelsFirst"===a?S=[u,E,N,$]:"channelsLast"===a&&(S=[u,N,$,E]),{batchSize:u,dataFormat:a,inHeight:c,inWidth:l,inChannels:f,outHeight:N,outWidth:$,outChannels:E,padInfo:x,strideHeight:m,strideWidth:y,filterHeight:h,filterWidth:p,effectiveFilterHeight:w,effectiveFilterWidth:v,dilationHeight:g,dilationWidth:b,inShape:t,outShape:S,filterShape:e}}function gH(t,e,n,r,s,o=!1,i="channelsLast",a){let[u,c,l,f,h]=[-1,-1,-1,-1,-1];if("channelsLast"===i)[u,c,l,f,h]=t;else{if("channelsFirst"!==i)throw new Error(`Unknown dataFormat ${i}`);[u,h,c,l,f]=t}const[p,d,m,,y]=e,[g,b,w]=vH(n),[v,x,N]=vH(r),$=xH(p,v),E=xH(d,x),S=xH(m,N),{padInfo:_,outDepth:T,outHeight:k,outWidth:A}=function(t,e,n,r,s,o,i,a,u,c,l){let f,h,p,d;if("number"==typeof t){f={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};const o=function(t,e,n,r,s,o){null==s&&(s=bH(t,e,r));const i=t[0],a=t[1],u=t[2],c=NH((i-e+2*s)/r+1,o),l=NH((a-e+2*s)/r+1,o),f=NH((u-e+2*s)/r+1,o);return[c,l,f,n]}([e,n,r,1],a,1,s,t,l);h=o[0],p=o[1],d=o[2]}else if("same"===t){h=Math.ceil(e/s),p=Math.ceil(n/o),d=Math.ceil(r/i);const t=(h-1)*s+a-e,l=(p-1)*o+u-n,m=(d-1)*i+c-r,y=Math.floor(t/2),g=t-y,b=Math.floor(l/2),w=l-b,v=Math.floor(m/2);f={top:b,bottom:w,left:v,right:m-v,front:y,back:g,type:"SAME"}}else{if("valid"!==t)throw Error(`Unknown padding parameter: ${t}`);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((e-a+1)/s),p=Math.ceil((n-u+1)/o),d=Math.ceil((r-c+1)/i)}return{padInfo:f,outDepth:h,outHeight:p,outWidth:d}}(s,c,l,f,g,b,w,$,E,S,a),C=o?y*h:y;let O;return"channelsFirst"===i?O=[u,C,T,k,A]:"channelsLast"===i&&(O=[u,T,k,A,C]),{batchSize:u,dataFormat:i,inDepth:c,inHeight:l,inWidth:f,inChannels:h,outDepth:T,outHeight:k,outWidth:A,outChannels:C,padInfo:_,strideDepth:g,strideHeight:b,strideWidth:w,filterDepth:p,filterHeight:d,filterWidth:m,effectiveFilterDepth:$,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationDepth:v,dilationHeight:x,dilationWidth:N,inShape:t,outShape:O,filterShape:e}}function bH(t,e,n,r=1){const s=xH(e,r);return Math.floor((t[0]*(n-1)-n+s)/2)}function wH(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function vH(t){return"number"==typeof t?[t,t,t]:t}function xH(t,e){return e<=1?t:t+(t-1)*(e-1)}function NH(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function $H(t){const[e,n,r]=wH(t);return 1===e&&1===n&&1===r}function EH(t,e){return $H(t)||$H(e)}function SH(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function _H(t,e,n){if(null!=n){if("string"==typeof e)throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if("number"==typeof e)hz(bz(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`));else{if("object"!=typeof e)throw Error(`Error in ${t}: Unknown padding parameter: ${e}`);e.forEach((e=>{e.forEach((e=>{hz(bz(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`))}))}))}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TH=Qj({reshape_:function(t,e){const n={x:Yj(t,"x","reshape","string_or_numeric")},r={shape:e};return qU.runKernel("Reshape",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kH=Qj({avgPool_:function(t,e,n,r,s){const o=Yj(t,"x","avgPool","float32");hz(EH(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let i=o,a=!1;3===o.rank&&(a=!0,i=TH(o,[1,o.shape[0],o.shape[1],o.shape[2]])),hz(4===i.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${i.rank}.`)),_H("avgPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s};let l=qU.runKernel("AvgPool",u,c);return l=WG(l,o.dtype),a?TH(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AH=Qj({avgPool3d_:function(t,e,n,r,s,o="NDHWC"){const i=Yj(t,"x","avgPool3d","float32");let a=i,u=!1;4===i.rank&&(u=!0,a=TH(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),hz(5===a.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`)),hz("NDHWC"===o,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),_H("avgPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o};let f=qU.runKernel("AvgPool3D",c,l);return f=WG(f,a.dtype),u?TH(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CH=Qj({concat_:function(t,e=0){hz(t.length>=1,(()=>"Pass at least one tensor to concat"));const n=Zj(t,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((t=>{if("complex64"!==t.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${t.dtype}. `)})),1===n.length)return UG(n[0]);const r=n,s={axis:e};return qU.runKernel("Concat",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OH=Qj({sigmoid_:function(t){const e={x:Yj(t,"x","sigmoid","float32")};return qU.runKernel("Sigmoid",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IH=Qj({slice_:function(t,e,n){const r=Yj(t,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const s={x:r},o={begin:e,size:n};return qU.runKernel("Slice",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MH=Qj({tanh_:function(t){const e={x:Yj(t,"x","tanh","float32")};return qU.runKernel("Tanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RH=Qj({basicLSTMCell_:function(t,e,n,r,s,o){const i=Yj(t,"forgetBias","basicLSTMCell"),a=Yj(e,"lstmKernel","basicLSTMCell"),u=Yj(n,"lstmBias","basicLSTMCell"),c=Yj(r,"data","basicLSTMCell"),l=Yj(s,"c","basicLSTMCell"),f=Yj(o,"h","basicLSTMCell"),h=CH([c,f],1),p=aq(h,a),d=Zq(p,u),m=d.shape[0],y=d.shape[1]/4,g=[m,y],b=IH(d,[0,0],g),w=IH(d,[0,y],g),v=IH(d,[0,2*y],g),x=IH(d,[0,3*y],g),N=Zq(eH(OH(b),MH(w)),eH(l,OH(Zq(i,v))));return[N,eH(MH(N),OH(x))]}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DH=Qj({batchToSpaceND_:function(t,e,n){const r=Yj(t,"x","batchToSpaceND"),s=e.reduce(((t,e)=>t*e));hz(r.rank>=1+e.length,(()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`)),hz(n.length===e.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`)),hz(r.shape[0]%s==0,(()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${s}`));const o={x:r},i={blockShape:e,crops:n};return qU.runKernel("BatchToSpaceND",o,i)}});const FH=Qj({batchNorm_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s,o){null==o&&(o=.001);const i=Yj(t,"x","batchNorm"),a=Yj(e,"mean","batchNorm"),u=Yj(n,"variance","batchNorm");let c,l;null!=s&&(c=Yj(s,"scale","batchNorm")),null!=r&&(l=Yj(r,"offset","batchNorm")),hz(a.rank===u.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),hz(null==l||a.rank===l.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),hz(null==c||a.rank===c.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const f=function(t){let e;return e=0===t.rank||1===t.rank?TH(t,[1,1,1,t.size]):2===t.rank?TH(t,[1,1,t.shape[0],t.shape[1]]):3===t.rank?TH(t,[1,t.shape[0],t.shape[1],t.shape[2]]):t,e}(i),h={x:f,scale:c,offset:l,mean:a,variance:u},p={varianceEpsilon:o},d=qU.runKernel("FusedBatchNorm",h,p);return TH(d,i.shape)}});const LH=Qj({batchNorm2d_:function(t,e,n,r,s,o){const i=Yj(t,"x","batchNorm"),a=Yj(e,"mean","batchNorm"),u=Yj(n,"variance","batchNorm");let c,l;return null!=s&&(c=Yj(s,"scale","batchNorm")),null!=r&&(l=Yj(r,"offset","batchNorm")),hz(2===i.rank,(()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`)),hz(2===a.rank||1===a.rank,(()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`)),hz(2===u.rank||1===u.rank,(()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`)),null!=c&&hz(2===c.rank||1===c.rank,(()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`)),null!=l&&hz(2===l.rank||1===l.rank,(()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${l.rank}.`)),FH(i,a,u,l,c,o)}});const PH=Qj({batchNorm3d_:function(t,e,n,r,s,o){const i=Yj(t,"x","batchNorm"),a=Yj(e,"mean","batchNorm"),u=Yj(n,"variance","batchNorm");let c,l;return null!=s&&(c=Yj(s,"scale","batchNorm")),null!=r&&(l=Yj(r,"offset","batchNorm")),hz(3===i.rank,(()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`)),hz(3===a.rank||1===a.rank,(()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`)),hz(3===u.rank||1===u.rank,(()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`)),null!=c&&hz(3===c.rank||1===c.rank,(()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`)),null!=l&&hz(3===l.rank||1===l.rank,(()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${l.rank}.`)),FH(i,a,u,l,c,o)}});const BH=Qj({batchNorm4d_:function(t,e,n,r,s,o){const i=Yj(t,"x","batchNorm"),a=Yj(e,"mean","batchNorm"),u=Yj(n,"variance","batchNorm");let c,l;return null!=s&&(c=Yj(s,"scale","batchNorm")),null!=r&&(l=Yj(r,"offset","batchNorm")),hz(4===i.rank,(()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`)),hz(4===a.rank||1===a.rank,(()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`)),hz(4===u.rank||1===u.rank,(()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`)),null!=c&&hz(4===c.rank||1===c.rank,(()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`)),null!=l&&hz(4===l.rank||1===l.rank,(()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${l.rank}.`)),FH(i,a,u,l,c,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VH=Qj({bincount_:function(t,e,n){const r=Yj(t,"x","bincount"),s=Yj(e,"weights","bincount");hz("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),hz(n>=0,(()=>`size must be non-negative, but got ${n}.`)),hz(s.size===r.size||0===s.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${s.shape}.`));const o={x:r,weights:s},i={size:n};return qU.runKernel("Bincount",o,i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zH=Qj({broadcastArgs_:function(t,e){const n=Yj(t,"s0","broadcastArgs","int32"),r=Yj(e,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(1!==r.rank)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const s={s0:n,s1:r};return qU.runKernel("BroadcastArgs",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WH=Qj({broadcastTo_:function(t,e){let n=Yj(t,"broadcastTo","x");const r=n.shape;if(e.some((t=>!(t>0)||t%1!=0)))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const t=n.shape.slice();for(;t.length<e.length;)t.unshift(1);n=TH(n,t)}const s=n.shape,o=Array.from(e);for(let t=e.length-1;t>=0;t--)if(s[t]===e[t])o[t]=1;else if(1!==n.shape[t])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);const i=o.map(((t,e)=>t>1?e:-1)).filter((t=>t>=0));if(0===i.length)return UG(n);const a={x:n},u={reps:o};return qU.runKernel("Tile",a,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UH=Qj({ceil_:function(t){const e={x:Yj(t,"x","ceil","float32")};return qU.runKernel("Ceil",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jH=Qj({clipByValue_:function(t,e,n){const r=Yj(t,"x","clipByValue");hz(e<=n,(()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`));const s={x:r},o={clipValueMin:e,clipValueMax:n};return qU.runKernel("ClipByValue",s,o)}});const GH=Qj({concat1d_:function(t){return CH(t,0)}});const qH=Qj({concat2d_:function(t,e){return CH(t,e)}});const HH=Qj({concat3d_:function(t,e){return CH(t,e)}});const KH=Qj({concat4d_:function(t,e){return CH(t,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XH=Qj({conv2d_:function(t,e,n,r,s="NHWC",o=[1,1],i){const a=Yj(t,"x","conv2d","float32"),u=Yj(e,"filter","conv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=TH(a,[1,a.shape[0],a.shape[1],a.shape[2]])),hz(4===c.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`)),hz(4===u.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`)),_H("conv2d",r,i);const f="NHWC"===s?c.shape[3]:c.shape[1];hz(f===u.shape[2],(()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`)),hz(EH(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const h={x:c,filter:u},p={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},d=qU.runKernel("Conv2D",h,p);return l?TH(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});const JH=Qj({conv1d_:function(t,e,n,r,s="NWC",o=1,i){const a=Yj(t,"x","conv1d"),u=Yj(e,"filter","conv1d");let c=a,l=!1;2===a.rank&&(l=!0,c=TH(a,[1,a.shape[0],a.shape[1]])),hz(3===c.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`)),hz(3===u.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`)),_H("conv1d",r,i),hz(c.shape[2]===u.shape[1],(()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`)),hz(EH(n,o),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${o}'`)),hz("NWC"===s,(()=>`Error in conv1d: got dataFormat of ${s} but only NWC is currently supported.`));const f=TH(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=TH(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=XH(h,f,[1,n],r,"NHWC",[1,o],i);return TH(p,l?[p.shape[2],p.shape[3]]:[p.shape[0],p.shape[2],p.shape[3]])}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YH=Qj({conv2DBackpropInput_:function(t,e,n,r,s,o="NHWC",i){hz(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let a=t,u=e,c=!1;3===e.rank&&(c=!0,u=TH(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),hz(4===a.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`)),hz(4===u.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`)),hz(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const l="NHWC"===o?a[3]:a[1],f="NHWC"===o?u.shape[3]:u.shape[1];hz(l===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[2]}.`)),hz(f===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${n.shape[3]}.`)),_H("conv2dDerInput",s,i);const h={dy:u,filter:n},p={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,inputShape:a},d=qU.runKernel("Conv2DBackpropInput",h,p);return c?TH(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});const ZH=Qj({conv2dTranspose_:function(t,e,n,r,s,o){const i=Yj(t,"x","conv2dTranspose"),a=Yj(e,"filter","conv2dTranspose");return YH(n,i,a,r,s,"NHWC",o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QH=Qj({conv3d_:function(t,e,n,r,s="NDHWC",o=[1,1,1]){const i=Yj(t,"x","conv3d"),a=Yj(e,"filter","conv3d");let u=i,c=!1;4===i.rank&&(c=!0,u=TH(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),hz(5===u.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`)),hz(5===a.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`)),hz(u.shape[4]===a.shape[3],(()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${a.shape[3]}.`)),hz(EH(n,o),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),hz("NDHWC"===s,(()=>`Error in conv3d: got dataFormat of ${s} but only NDHWC is currently supported.`));const l={x:u,filter:a},f={strides:n,pad:r,dataFormat:s,dilations:o},h=qU.runKernel("Conv3D",l,f);return c?TH(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tK=Qj({conv3DBackpropInput_:function(t,e,n,r,s){hz(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let o=t,i=e,a=!1;4===e.rank&&(a=!0,i=TH(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,t[0],t[1],t[2],t[3]]);const u=o[4],c=i.shape[4];hz(5===o.length,(()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`)),hz(5===i.rank,(()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`)),hz(5===n.rank,(()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`)),hz(u===n.shape[3],(()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[3]}.`)),hz(c===n.shape[4],(()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`));const l={dy:i,filter:n},f={pad:s,strides:r,inputShape:o},h=qU.runKernel("Conv3DBackpropInputV2",l,f);return a?TH(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});const eK=Qj({conv3dTranspose_:function(t,e,n,r,s){const o=Yj(t,"x","conv3dTranspose"),i=Yj(e,"filter","conv3dTranspose");return tK(n,o,i,r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nK=Qj({cos_:function(t){const e={x:Yj(t,"x","cos","float32")};return qU.runKernel("Cos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rK=Qj({cosh_:function(t){const e={x:Yj(t,"x","cosh","float32")};return qU.runKernel("Cosh",e)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sK=Qj({cumprod_:function(t,e=0,n=!1,r=!1){const s={x:Yj(t,"x","cumprod")},o={axis:e,exclusive:n,reverse:r};return qU.runKernel("Cumprod",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oK=Qj({cumsum_:function(t,e=0,n=!1,r=!1){const s={x:Yj(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:r};return qU.runKernel("Cumsum",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iK=Qj({denseBincount_:function(t,e,n,r=!1){const s=Yj(t,"x","denseBincount"),o=Yj(e,"weights","denseBincount");hz("int32"===s.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${s.dtype}`)),hz(s.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${s.rank}.`)),hz(n>=0,(()=>`size must be non-negative, but got ${n}.`)),hz(o.size===s.size||0===o.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${s.shape}, weights shape: ${o.shape}.`));const i={x:s,weights:o},a={size:n,binaryOutput:r};return qU.runKernel("DenseBincount",i,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aK=Qj({depthToSpace_:function(t,e,n="NHWC"){const r=Yj(t,"x","depthToSpace","float32"),s="NHWC"===n?r.shape[1]:r.shape[2],o="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];hz(e>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`)),hz(s*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${s} and ${e}  for depthToSpace with input shape\n    ${r.shape}`)),hz(o*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${o} and ${e} for depthToSpace with input shape\n        ${r.shape}`)),hz(i%(e*e)==0,(()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${r.shape}`));const a={x:r},u={blockSize:e,dataFormat:n};return qU.runKernel("DepthToSpace",a,u)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uK=Qj({depthwiseConv2d_:function(t,e,n,r,s="NHWC",o=[1,1],i){const a=Yj(t,"x","depthwiseConv2d","float32"),u=Yj(e,"filter","depthwiseConv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=TH(a,[1,a.shape[0],a.shape[1],a.shape[2]])),hz(4===c.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`)),hz(4===u.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`)),hz(c.shape[3]===u.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`)),_H("depthwiseConv2d",r,i);const f={x:c,filter:u},h={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},p=qU.runKernel("DepthwiseConv2dNative",f,h);return l?TH(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cK=Qj({diag_:function(t){const e={x:Yj(t,"x","diag")};return qU.runKernel("Diag",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lK=Qj({dilation2d_:function(t,e,n,r,s=[1,1],o="NHWC"){const i=Yj(t,"x","dilation2d"),a=Yj(e,"filter","dilation2d");hz(3===i.rank||4===i.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`)),hz(3===a.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`)),hz("NHWC"===o,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`));let u=i,c=!1;3===i.rank&&(u=TH(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=!0);const l={x:u,filter:a},f={strides:n,pad:r,dilations:s},h=qU.runKernel("Dilation2D",l,f);return c?TH(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fK=Qj({equal_:function(t,e){let n=Yj(t,"a","equal","string_or_numeric"),r=Yj(e,"b","equal","string_or_numeric");[n,r]=LU(n,r),vq(n.shape,r.shape);const s={a:n,b:r};return qU.runKernel("Equal",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hK=Qj({where_:function(t,e,n){const r=Yj(e,"a","where"),s=Yj(n,"b","where"),o=Yj(t,"condition","where","bool"),i=vq(vq(o.shape,r.shape),s.shape),a={condition:WH(o,i),t:WH(r,i),e:WH(s,i)};return qU.runKernel("Select",a)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pK=Qj({zerosLike_:function(t){const e={x:Yj(t,"x","zerosLike")};return qU.runKernel("ZerosLike",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dK=Qj({divNoNan_:function(t,e){let n=Yj(t,"a","div"),r=Yj(e,"b","div");[n,r]=LU(n,r);const s=tH(n,r),o=pK(s),i=fK(r,o);return hK(i,o,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mK=Qj({dot_:function(t,e){const n=Yj(t,"t1","dot"),r=Yj(e,"t2","dot");hz(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`));const s=1===n.rank?n.size:n.shape[1],o=1===r.rank?r.size:r.shape[0];if(hz(s===o,(()=>`Error in dot: inner dimensions of inputs must match, but got ${s} and ${o}.`)),1===n.rank&&1===r.rank){const t=TH(n,[1,-1]),e=TH(r,[-1,1]),s=aq(t,e);return TH(s,[])}if(1===n.rank&&2===r.rank){const t=TH(n,[1,-1]),e=TH(r,[r.shape[0],r.shape[1]]),s=aq(t,e);return TH(s,[s.size])}if(2===n.rank&&1===r.rank){const t=TH(r,[-1,1]),e=aq(n,t);return TH(e,[e.size])}{const t=TH(r,[r.shape[0],r.shape[1]]);return aq(n,t)}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yK=Qj({einsum_:function(t,...e){const n=e.map(((t,e)=>Yj(t,`tensors${e}`,"einsum"))),r={equation:t};return qU.runKernel("Einsum",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gK=Qj({elu_:function(t){const e={x:Yj(t,"x","elu","float32")};return qU.runKernel("Elu",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bK=Qj({erf_:function(t){let e=Yj(t,"x","erf");hz("int32"===e.dtype||"float32"===e.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===e.dtype&&(e=WG(e,"float32"));const n={x:e};return qU.runKernel("Erf",n)}});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wK(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function vK(t,e,n){const r=t.length+e.length,s=[];let o=0,i=0;for(let a=0;a<r;a++)-1===n.indexOf(a)?s.push(t[o++]):s.push(e[i++]);return s}function xK(t,e){return vK(t,e.map((t=>1)),e)}const NK=Qj({max_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=null,n=!1){const r={x:Yj(t,"x","max")},s={reductionIndices:e,keepDims:n};return qU.runKernel("Max",r,s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $K=Qj({min_:function(t,e=null,n=!1){const r={x:Yj(t,"x","min")},s={axis:e,keepDims:n};return qU.runKernel("Min",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EK=Qj({pow_:function(t,e){let n=Yj(t,"base","pow"),r=Yj(e,"exp","pow");[n,r]=LU(n,r);const s={a:n,b:r};return qU.runKernel("Pow",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SK(t,e){if((_z(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&_z(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return eG(t,[],[],e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _K=Qj({sqrt_:function(t){const e={x:Yj(t,"x","sqrt","float32")};return qU.runKernel("Sqrt",e)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TK=Qj({square_:function(t){const e=Yj(t,"x","square");return qU.runKernel("Square",{x:e},{})}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kK=Qj({sum_:function(t,e=null,n=!1){let r=Yj(t,"x","sum");"bool"===r.dtype&&(r=WG(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return qU.runKernel("Sum",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AK(t,e,n=null){if(0===t.rank)return nH(t);if(1!==t.rank&&null===n)return AK(TH(t,[-1]),e,n);if(1===t.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===e)return kK(nH(t),n);if(e===1/0)return NK(nH(t),n);if(e===-1/0)return $K(nH(t),n);if("euclidean"===e||2===e)return _K(kK(EK(nH(t),SK(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&2===n.length){if(1===e)return NK(kK(nH(t),n[0]),n[1]-1);if(e===1/0)return NK(kK(nH(t),n[1]),n[0]);if(e===-1/0)return $K(kK(nH(t),n[1]),n[0]);if("fro"===e||"euclidean"===e)return _K(kK(TK(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const CK=Qj({norm_:function(t,e="euclidean",n=null,r=!1){const s=AK(t=Yj(t,"x","norm"),e,n);let o=s.shape;if(r){const e=vz(n,t.shape);o=xK(s.shape,e)}return TH(s,o)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OK=Qj({euclideanNorm_:function(t,e=null,n=!1){return CK(t,"euclidean",e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IK=Qj({exp_:function(t){const e={x:Yj(t,"x","exp")};return qU.runKernel("Exp",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MK=Qj({expandDims_:function(t,e=0){const n=Yj(t,"x","expandDims","string_or_numeric");hz(e<=n.rank,(()=>"Axis must be <= rank of the tensor"));const r={input:n},s={dim:e};return qU.runKernel("ExpandDims",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RK=Qj({expm1_:function(t){const e={x:Yj(t,"x","expm1")};return qU.runKernel("Expm1",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DK=Qj({tile_:function(t,e){const n=Yj(t,"x","tile","string_or_numeric");hz(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`));const r={x:n},s={reps:e};return qU.runKernel("Tile",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FK=Qj({eye_:function(t,e,n,r="float32"){null==e&&(e=t);const s=zG([t,e],r),o=t<=e?t:e;for(let t=0;t<o;++t)s.set(1,t,t);const i=TH(s.toTensor(),[t,e]);if(null==n)return i;if(1===n.length)return DK(MK(i,0),[n[0],1,1]);if(2===n.length)return DK(MK(MK(i,0),0),[n[0],n[1],1,1]);if(3===n.length)return DK(MK(MK(MK(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LK(t,e,n){const r={shape:t,value:e,dtype:n};return qU.runKernel("Fill",{},r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PK=Qj({floor_:function(t){const e={x:Yj(t,"x","floor","float32")};return qU.runKernel("Floor",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BK=Qj({gather_:function(t,e,n=0,r=0){const s={x:Yj(t,"x","gather"),indices:Yj(e,"indices","gather","int32")},o={axis:n,batchDims:r};return qU.runKernel("GatherV2",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VK=Qj({greater_:function(t,e){let n=Yj(t,"a","greater","string_or_numeric"),r=Yj(e,"b","greater","string_or_numeric");[n,r]=LU(n,r),vq(n.shape,r.shape);const s={a:n,b:r};return qU.runKernel("Greater",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zK=Qj({greaterEqual_:function(t,e){let n=Yj(t,"a","greaterEqual","string_or_numeric"),r=Yj(e,"b","greaterEqual","string_or_numeric");[n,r]=LU(n,r),vq(n.shape,r.shape);const s={a:n,b:r};return qU.runKernel("GreaterEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WK=Qj({isFinite_:function(t){const e={x:Yj(t,"x","isFinite")};return qU.runKernel("IsFinite",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UK=Qj({isInf_:function(t){const e={x:Yj(t,"x","isInf")};return qU.runKernel("IsInf",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jK=Qj({isNaN_:function(t){const e={x:Yj(t,"x","isNaN")};return qU.runKernel("IsNan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GK=Qj({leakyRelu_:function(t,e=.2){const n={x:Yj(t,"x","leakyRelu")},r={alpha:e};return qU.runKernel("LeakyRelu",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qK=Qj({less_:function(t,e){let n=Yj(t,"a","less","string_or_numeric"),r=Yj(e,"b","less","string_or_numeric");[n,r]=LU(n,r),vq(n.shape,r.shape);const s={a:n,b:r};return qU.runKernel("Less",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HK=Qj({lessEqual_:function(t,e){let n=Yj(t,"a","lessEqual","string_or_numeric"),r=Yj(e,"b","lessEqual","string_or_numeric");[n,r]=LU(n,r),vq(n.shape,r.shape);const s={a:n,b:r};return qU.runKernel("LessEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KK(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:t,stop:e,num:n};return qU.runKernel("LinSpace",{},r)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XK=Qj({localResponseNormalization_:function(t,e=5,n=1,r=1,s=.5){const o=Yj(t,"x","localResponseNormalization");hz(4===o.rank||3===o.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${o.rank}.`)),hz(bz(e),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`));let i=o,a=!1;3===o.rank&&(a=!0,i=TH(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const u={x:i},c={depthRadius:e,bias:n,alpha:r,beta:s},l=qU.runKernel("LRN",u,c);return a?TH(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JK=Qj({log_:function(t){const e={x:Yj(t,"x","log","float32")};return qU.runKernel("Log",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YK=Qj({log1p_:function(t){const e={x:Yj(t,"x","log1p")};return qU.runKernel("Log1p",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZK(t,e){hz(Mz(t),(()=>"The f passed in variableGrads(f) must be a function")),hz(null==e||Array.isArray(e)&&e.every((t=>t instanceof AU)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=e;if(!n){e=[];for(const t in qU.registeredVariables)e.push(qU.registeredVariables[t])}const r=n?e.filter((t=>!t.trainable)):null,s=e.length;e=e.filter((t=>t.trainable)),hz(e.length>0,(()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${s} variables is trainable.`));const{value:o,grads:i}=qU.gradients(t,e,null,!0);hz(i.some((t=>null!=t)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),hz(0===o.rank,(()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`));const a={};return e.forEach(((t,e)=>{null!=i[e]&&(a[t.name]=i[e])})),null!=r&&r.forEach((t=>a[t.name]=null)),{value:o,grads:a}}function QK(t){return qU.customGrad(t)}function tX(t){const e=t.filter((t=>null==t)).length;if(e>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eX=Qj({softplus_:function(t){const e={x:Yj(t,"x","softplus")};return qU.runKernel("Softplus",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nX=Qj({logSigmoid_:function(t){const e=Yj(t,"x","logSigmoid"),n=QK((t=>({value:pq(eX(pq(t))),gradFunc:e=>eH(e,OH(pq(t)))})));return n(e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rX=Qj({sub_:function(t,e){let n=Yj(t,"a","sub"),r=Yj(e,"b","sub");[n,r]=LU(n,r);const s={a:n,b:r};return qU.runKernel("Sub",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sX=Qj({logSoftmax_:function(t,e=-1){const n=Yj(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);const r=QK(((t,n)=>{const r=NK(t,e,!0),s=rX(t,r),o=rX(WG(s,"float32"),JK(kK(IK(s),e,!0)));n([o]);return{value:o,gradFunc:(t,n)=>{const[r]=n,s=IK(r);return rX(t,eH(kK(t,e,!0),s))}}}));return r(n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oX=Qj({logSumExp_:function(t,e=null,n=!1){const r=Yj(t,"x","logSumExp"),s=vz(e,r.shape),o=NK(r,s,!0),i=rX(r,o),a=IK(i),u=kK(a,s),c=JK(u),l=Zq(TH(o,c.shape),c);if(n){const t=xK(l.shape,s);return TH(l,t)}return l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iX=Qj({logicalAnd_:function(t,e){const n=Yj(t,"a","logicalAnd","bool"),r=Yj(e,"b","logicalAnd","bool");vq(n.shape,r.shape);const s={a:n,b:r};return qU.runKernel("LogicalAnd",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aX=Qj({logicalNot_:function(t){const e={x:Yj(t,"x","logicalNot","bool")};return qU.runKernel("LogicalNot",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uX=Qj({logicalOr_:function(t,e){const n=Yj(t,"a","logicalOr","bool"),r=Yj(e,"b","logicalOr","bool");vq(n.shape,r.shape);const s={a:n,b:r};return qU.runKernel("LogicalOr",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cX=Qj({logicalXor_:function(t,e){const n=Yj(t,"a","logicalXor","bool"),r=Yj(e,"b","logicalXor","bool");return vq(n.shape,r.shape),iX(uX(t,e),aX(iX(t,e)))}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lX=Qj({searchSorted_:function(t,e,n="left"){const r=Yj(t,"sortedSequence","searchSorted"),s=Yj(e,"values","searchSorted"),o=r.shape[r.shape.length-1],i=s.shape[s.shape.length-1],a=TH(r,[-1,o]),u=TH(s,[-1,i]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(yz(u.shape)>=2147483648)throw new Error("values tensor size must less than 2147483648");if(a.shape[1]>=2147483648)throw new Error(`trailing dim_size must less than 2147483648 for int32 output type, was ${a.shape[1]}`);const c={sortedSequence:a,values:u},l={side:n};return qU.runKernel("SearchSorted",c,l)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fX(t,e){return lX(t,e,"left")}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hX=Qj({maxPool_:function(t,e,n,r,s){const o=Yj(t,"x","maxPool");let i=o,a=!1;3===o.rank&&(a=!0,i=TH(o,[1,o.shape[0],o.shape[1],o.shape[2]])),hz(4===i.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${i.rank}.`)),hz(EH(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),_H("maxPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s},l=qU.runKernel("MaxPool",u,c);return a?TH(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pX=Qj({maxPool3d_:function(t,e=[1,1,1],n,r,s,o="NDHWC"){const i=Yj(t,"x","maxPool3d");let a=i,u=!1;4===i.rank&&(u=!0,a=TH(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),hz(5===a.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`)),hz("NDHWC"===o,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),_H("maxPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o},f=qU.runKernel("MaxPool3D",c,l);return u?TH(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dX=Qj({maxPoolWithArgmax_:function(t,e,n,r,s=!1){const o={x:Yj(t,"x","maxPoolWithArgmax")},i={filterSize:e,strides:n,pad:r,includeBatchInIndex:s},a=qU.runKernel("MaxPoolWithArgmax",o,i);return{result:a[0],indexes:a[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mX=Qj({maximum_:function(t,e){let n=Yj(t,"a","maximum"),r=Yj(e,"b","maximum");[n,r]=LU(n,r),"bool"===n.dtype&&(n=WG(n,"int32"),r=WG(r,"int32")),vq(n.shape,r.shape);const s={a:n,b:r};return qU.runKernel("Maximum",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yX=Qj({mean_:function(t,e=null,n=!1){const r={x:Yj(t,"x","mean")},s={axis:e,keepDims:n};return qU.runKernel("Mean",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gX(t,e="float32"){if("complex64"===e){const e=gX(t,"float32"),n=gX(t,"float32");return tG(e,n)}const n=Bz(yz(t),e);return qU.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bX(t,e="float32"){if("complex64"===e){const e=bX(t,"float32"),n=gX(t,"float32");return tG(e,n)}const n=Pz(yz(t),e);return qU.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wX=Qj({minimum_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=Yj(t,"a","minimum"),r=Yj(e,"b","minimum");[n,r]=LU(n,r),"bool"===n.dtype&&(n=WG(n,"int32"),r=WG(r,"int32")),vq(n.shape,r.shape);const s={a:n,b:r};return qU.runKernel("Minimum",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vX=Qj({mirrorPad_:function(t,e,n){hz("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const r=Yj(t,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");hz(e.length===r.rank,(()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`));const s="reflect"===n?1:0;for(let t=0;t<r.rank;t++)hz(2===e[t].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),hz(e[t][0]>=0&&e[t][0]<=r.shape[t]-s&&e[t][1]>=0&&e[t][1]<=r.shape[t]-s,(()=>`Padding in dimension ${t} cannot be greater than or equal to ${r.shape[t]-s} or less than 0 for input of shape ${r.shape}`));const o={paddings:e,mode:n},i={x:r};return qU.runKernel("MirrorPad",i,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xX=Qj({mod_:function(t,e){let n=Yj(t,"a","mod"),r=Yj(e,"b","mod");[n,r]=LU(n,r);const s={a:n,b:r};return qU.runKernel("Mod",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NX=Qj({moments_:function(t,e=null,n=!1){const r=vz(e,(t=Yj(t,"x","moments")).shape),s=yX(t,r,n);let o=s.shape;n||(o=xK(s.shape,r));const i=TK(rX(WG(t,"float32"),TH(s,o)));return{mean:s,variance:yX(i,r,n)}}});const $X=Qj({multiRNNCell_:function(t,e,n,r){const s=Yj(e,"data","multiRNNCell"),o=Zj(n,"c","multiRNNCell"),i=Zj(r,"h","multiRNNCell");let a=s;const u=[];for(let e=0;e<t.length;e++){const n=t[e](a,o[e],i[e]);u.push(n[0]),u.push(n[1]),a=n[1]}const c=[],l=[];for(let t=0;t<u.length;t+=2)c.push(u[t]),l.push(u[t+1]);return[c,l]}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EX=Qj({multinomial_:function(t,e,n,r=!1){const s=Yj(t,"logits","multinomial"),o=s.size,i=s.rank;if(o<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${o}.`);if(i>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${i}`);n=n||Math.random();const a={logits:1===i?TH(s,[1,-1]):s},u={numSamples:e,seed:n,normalized:r},c=qU.runKernel("Multinomial",a,u);return 1===i?TH(c,[c.size]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SX=Qj({notEqual_:function(t,e){let n=Yj(t,"a","notEqual","string_or_numeric"),r=Yj(e,"b","notEqual","string_or_numeric");[n,r]=LU(n,r),vq(n.shape,r.shape);const s={a:n,b:r};return qU.runKernel("NotEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _X=Qj({onesLike_:function(t){const e={x:Yj(t,"x","onesLike")};return qU.runKernel("OnesLike",e)}});const TX=Qj({outerProduct_:function(t,e){const n=Yj(t,"v1","outerProduct"),r=Yj(e,"v2","outerProduct");hz(1===n.rank&&1===r.rank,(()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`));const s=TH(n,[-1,1]),o=TH(r,[1,-1]);return aq(s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kX=Qj({pad_:function(t,e,n=0){const r=Yj(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:n},o={x:r};return qU.runKernel("PadV2",o,s)}});const AX=Qj({pad1d_:function(t,e,n=0){return hz(2===e.length,(()=>"Invalid number of paddings. Must be length of 2.")),kX(t,[e],n)}});const CX=Qj({pad2d_:function(t,e,n=0){return hz(2===e.length&&2===e[0].length&&2===e[1].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),kX(t,e,n)}});const OX=Qj({pad3d_:function(t,e,n=0){return hz(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),kX(t,e,n)}});const IX=Qj({pad4d_:function(t,e,n=0){return hz(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),kX(t,e,n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MX=Qj({spaceToBatchND_:function(t,e,n){const r=Yj(t,"x","spaceToBatchND");hz(r.rank>=1+e.length,(()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`)),hz(n.length===e.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`)),hz(r.shape.reduce(((t,r,s)=>s>0&&s<=e.length?t&&(r+n[s-1][0]+n[s-1][1])%e[s-1]==0:t),!0),(()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`));const s={x:r},o={blockShape:e,paddings:n};return qU.runKernel("SpaceToBatchND",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RX=Qj({pool_:function(t,e,n,r,s,o,i){null==s&&(s=[1,1]),null==o&&(o=1),0===r&&(r="valid");const a=Yj(t,"x","maxPool");let u=a,c=!1;3===a.rank&&(c=!0,u=TH(a,[1,a.shape[0],a.shape[1],a.shape[2]])),hz(EH(o,s),(()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${s}'`));const l=mH(u.shape,e,o,s,r),f=[l.dilationHeight,l.dilationWidth];let h;h="same"===r?function(t,e){const n=t.map(((t,n)=>t+(t-1)*(e[n]-1))),r=n.map((t=>t-1)),s=r.map((t=>Math.floor(t/2))),o=r.map(((t,e)=>t-s[e]));return r.map(((t,e)=>[s[e],o[e]]))}([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];const p=1===f[0]&&1===f[1],[d,m]=function(t,e,n){const r=n.map((t=>t[0])),s=n.map((t=>t[1])),o=t.concat(r,s),i=e.map(((t,e)=>(t-o[e]%t)%t)),a=s.map(((t,e)=>t+i[e])),u=e.map(((t,e)=>[r[e],a[e]])),c=e.map(((t,e)=>[0,i[e]]));return[u,c]}([l.inHeight,l.inWidth],f,h),y=p?r:"valid",g=p?u:MX(u,f,d),b=("avg"===n?()=>kH(g,e,o,y,i):()=>hX(g,e,o,y,i))(),w=p?b:DH(b,f,m);return c?TH(w,[w.shape[1],w.shape[2],w.shape[3]]):w}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DX=Qj({prelu_:function(t,e){const n={x:Yj(t,"x","prelu"),alpha:Yj(e,"alpha","prelu")};return qU.runKernel("Prelu",n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FX=Qj({prod_:function(t,e=null,n=!1){let r=Yj(t,"x","prod");"bool"===r.dtype&&(r=WG(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return qU.runKernel("Prod",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LX=Qj({rand_:function(t,e,n){const r=yz(t);let s=null;if(null==n||"float32"===n)s=new Float32Array(r);else if("int32"===n)s=new Int32Array(r);else{if("bool"!==n)throw new Error(`Unknown data type ${n}`);s=new Uint8Array(r)}for(let t=0;t<r;t++)s[t]=e();return qU.makeTensor(s,t,n)}});var PX={exports:{}};!function(t,e,n){function r(t){var e=this,n=function(){var t=4022871197,e=function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)};return e}();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}function s(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var n=new r(t),o=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.alea=o}(0,PX,!1);var BX={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor128=o}(0,BX,!1);var VX={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorwow=o}(0,VX,!1);var zX={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,s=e.i;return t=r[s],n=(t^=t>>>7)^t<<24,n^=(t=r[s+1&7])^t>>>10,n^=(t=r[s+3&7])^t>>>3,n^=(t=r[s+4&7])^t<<7,t=r[s+7&7],n^=(t^=t<<13)^t<<9,r[s]=n,e.i=s+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function s(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.x&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorshift7=o}(0,zX,!1);var WX={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,s=e.X,o=e.i;return e.w=r=r+1640531527|0,n=s[o+34&127],t=s[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=s[o]=n^t,e.i=o,n+(r^r>>>16)|0},function(t,e){var n,r,s,o,i,a=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),s=0,o=-32;o<u;++o)e&&(r^=e.charCodeAt((o+32)%e.length)),0===o&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(i=i+1640531527|0,s=0==(n=a[127&o]^=r+i)?s+1:0);for(s>=128&&(a[127&(e&&e.length||0)]=-1),s=127,o=512;o>0;--o)r=a[s+34&127],n=a[s=s+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,a[s]=r^n;t.w=i,t.X=a,t.i=s}(e,t)}function s(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.X&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor4096=o}(0,WX,!1);var UX={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,s=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^s,s=s-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^s,e.a=s-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.tychei=o}(0,UX,!1);var jX={exports:{}};!function(t){!function(e,n){var r,s=this,o=256,i=n.pow(o,6),a=n.pow(2,52),u=2*a,c=255;function l(t,c,l){var y=[],g=d(p((c=1==c?{entropy:!0}:c||{}).entropy?[t,m(e)]:null==t?function(){try{var t;return r&&(t=r.randomBytes)?t=t(o):(t=new Uint8Array(o),(s.crypto||s.msCrypto).getRandomValues(t)),m(t)}catch(t){var n=s.navigator,i=n&&n.plugins;return[+new Date,s,i,s.screen,m(e)]}}():t,3),y),b=new f(y),w=function(){for(var t=b.g(6),e=i,n=0;t<a;)t=(t+n)*o,e*=o,n=b.g(1);for(;t>=u;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,d(m(b.S),e),(c.pass||l||function(t,e,r,s){return s&&(s.S&&h(s,b),t.state=function(){return h(b,{})}),r?(n.random=t,e):t})(w,g,"global"in c?c.global:this==n,c.state)}function f(t){var e,n=t.length,r=this,s=0,i=r.i=r.j=0,a=r.S=[];for(n||(t=[n++]);s<o;)a[s]=s++;for(s=0;s<o;s++)a[s]=a[i=c&i+t[s%n]+(e=a[s])],a[i]=e;(r.g=function(t){for(var e,n=0,s=r.i,i=r.j,a=r.S;t--;)e=a[s=c&s+1],n=n*o+a[c&(a[s]=a[i=c&i+e])+(a[i]=e)];return r.i=s,r.j=i,n})(o)}function h(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function p(t,e){var n,r=[],s=typeof t;if(e&&"object"==s)for(n in t)try{r.push(p(t[n],e-1))}catch(t){}return r.length?r:"string"==s?t:t+"\0"}function d(t,e){for(var n,r=t+"",s=0;s<r.length;)e[c&s]=c&(n^=19*e[c&s])+r.charCodeAt(s++);return m(e)}function m(t){return String.fromCharCode.apply(0,t)}if(n.seedrandom=l,d(n.random(),e),t.exports){t.exports=l;try{r=require("crypto")}catch(t){}}}([],Math)}(jX);var GX=PX.exports,qX=BX.exports,HX=VX.exports,KX=zX.exports,XX=WX.exports,JX=UX.exports,YX=jX.exports;YX.alea=GX,YX.xor128=qX,YX.xorwow=HX,YX.xorshift7=KX,YX.xor4096=XX,YX.tychei=JX;var ZX=YX;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QX{constructor(t,e,n,r,s){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const o=s||Math.random();this.random=ZX.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const t=this.nextVal;return this.nextVal=NaN,t}let t,e,n=!1;for(;!n;){let r,s,o;do{r=2*this.random()-1,s=2*this.random()-1,o=r*r+s*s}while(o>=1||0===o);const i=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*r*i,e=this.mean+this.stdDev*s*i,this.truncated&&!this.isValidTruncated(t)||(n=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class tJ{constructor(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;const s=r||Math.random();this.randu=ZX.alea(s.toString()),this.randn=new QX(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,e,n,r,s,o;for(;;){do{r=this.randn.nextValue(),o=1+this.c*r}while(o<=0);if(o*=o*o,t=r*r,e=1-.331*t*t,n=.5*t+this.d*(1-o+Math.log(o)),s=this.randu(),s<e||Math.log(s)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(t){return"float32"===this.dtype?t:Math.round(t)}}class eJ{constructor(t=0,e=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=ZX.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nJ=Qj({randomGamma_:function(t,e,n=1,r="float32",s){if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error(`Unsupported data type ${r}`);const o=new tJ(e,n,r,s),i=zG(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rJ=Qj({randomNormal_:function(t,e=0,n=1,r,s){if(null!=r&&"bool"===r)throw new Error(`Unsupported data type ${r}`);const o=new QX(e,n,r,!1,s),i=zG(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sJ=Qj({randomUniform_:function(t,e=0,n=1,r="float32",s){const o=zG(t,r),i=new eJ(e,n,null,s);for(let t=0;t<o.values.length;t++)o.values[t]=i.nextValue();return o.toTensor()}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oJ(t,e,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");const s={start:t,stop:e,step:n,dtype:r};return qU.runKernel("Range",{},s)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iJ=Qj({reciprocal_:function(t){const e={x:Yj(t,"x","reciprocal")};return qU.runKernel("Reciprocal",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aJ=Qj({relu_:function(t){const e={x:Yj(t,"x","relu")};return qU.runKernel("Relu",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uJ=Qj({relu6_:function(t){const e={x:Yj(t,"x","relu6")};return qU.runKernel("Relu6",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cJ=Qj({reverse_:function(t,e){const n={x:Yj(t,"x","reverse")},r={dims:e};return qU.runKernel("Reverse",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lJ=Qj({reverse1d_:function(t){const e=Yj(t,"x","reverse");return hz(1===e.rank,(()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`)),cJ(e,0)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fJ=Qj({reverse2d_:function(t,e){const n=Yj(t,"x","reverse");return hz(2===n.rank,(()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`)),cJ(n,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hJ=Qj({reverse3d_:function(t,e){const n=Yj(t,"x","reverse");return hz(3===n.rank,(()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`)),cJ(n,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pJ=Qj({reverse4d_:function(t,e){const n=Yj(t,"x","reverse");return hz(4===n.rank,(()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`)),cJ(n,e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dJ=Qj({round_:function(t){const e={x:Yj(t,"x","round")};return qU.runKernel("Round",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mJ=Qj({rsqrt_:function(t){const e={x:Yj(t,"x","rsqrt","float32")};return qU.runKernel("Rsqrt",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yJ=Qj({selu_:function(t){const e={x:Yj(t,"x","selu")};return qU.runKernel("Selu",e)}});const gJ=Qj({separableConv2d_:function(t,e,n,r,s,o=[1,1],i="NHWC"){const a=Yj(t,"x","separableConv2d"),u=Yj(e,"depthwiseFilter","separableConv2d"),c=Yj(n,"pointwiseFilter","separableConv2d");let l=a,f=!1;if(3===a.rank&&(f=!0,l=TH(a,[1,a.shape[0],a.shape[1],a.shape[2]])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");hz(4===l.rank,(()=>`Error in separableConv2d: input must be rank 4, but got rank ${l.rank}.`)),hz(4===u.rank,(()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`)),hz(4===c.rank,(()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`)),hz(1===c.shape[0],(()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`)),hz(1===c.shape[1],(()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`));const h=u.shape[2],p=u.shape[3];hz(c.shape[2]===h*p,(()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*p}, but got ${c.shape[2]}.`));const d=uK(l,u,r,s,i,o),m=XH(d,c,1,"valid",i);return f?TH(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bJ=async function(t,e){const n=Yj(t,"x","setdiff1d"),r=Yj(e,"y","setdiff1d");hz(n.dtype===r.dtype,(()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`)),hz(1===n.rank,(()=>`x should be 1D tensor, but got x (${n.shape}).`)),hz(1===r.rank,(()=>`y should be 1D tensor, but got y (${r.shape}).`));const s=await n.data(),o=await r.data(),i=new Set(o);let a=0;for(let t=0;t<s.length;t++)i.has(s[t])||a++;const u=new SU([a],n.dtype),c=new SU([a],"int32");for(let t=0,e=0;t<s.length;t++)i.has(s[t])||(u.values[e]=s[t],c.values[e]=t,e++);return[u.toTensor(),c.toTensor()]};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wJ=Qj({sign_:function(t){const e={x:Yj(t,"x","sign")};return qU.runKernel("Sign",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vJ=Qj({sin_:function(t){const e={x:Yj(t,"x","sin","float32")};return qU.runKernel("Sin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xJ=Qj({sinh_:function(t){const e={x:Yj(t,"x","sinh")};return qU.runKernel("Sinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NJ=Qj({slice1d_:function(t,e,n){const r=Yj(t,"x","slice1d");return hz(1===r.rank,(()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`)),IH(r,[e],[n])}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $J=Qj({slice2d_:function(t,e,n){const r=Yj(t,"x","slice2d");return hz(2===r.rank,(()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`)),IH(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EJ=Qj({slice3d_:function(t,e,n){const r=Yj(t,"x","slice3d");return hz(3===r.rank,(()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`)),IH(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SJ=Qj({slice4d_:function(t,e,n){const r=Yj(t,"x","slice4d");return hz(4===r.rank,(()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`)),IH(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _J=Qj({softmax_:function(t,e=-1){const n=Yj(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const r={logits:n},s={dim:e};return qU.runKernel("Softmax",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TJ=Qj({fft_:function(t){hz("complex64"===t.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`));const e={input:t};return qU.runKernel("FFT",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kJ=Qj({ifft_:function(t){hz("complex64"===t.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`));const e={input:t};return qU.runKernel("IFFT",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AJ=Qj({irfft_:function(t){const e=t.shape[t.shape.length-1],n=t.size/e;let r;if(e<=2){const s=TH(t,[n,e]);r=kJ(s)}else{const s=[n,2*(e-1)],o=TH(dq(t),[n,e]),i=TH(hq(t),[n,e]),a=cJ(IH(o,[0,1],[n,e-2]),1),u=eH(cJ(IH(i,[0,1],[n,e-2]),1),SK(-1)),c=CH([o,a],1),l=CH([i,u],1),f=TH(tG(c,l),[s[0],s[1]]);r=kJ(f)}if(r=dq(r),3===t.rank&&0!==t.shape[0]){const e=r,n=t.shape[0];r=TH(r,[n,r.shape[0]/n,r.shape[1]]),e.dispose()}return r}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CJ=Qj({split_:function(t,e,n=0){const r={x:Yj(t,"x","split")},s={numOrSizeSplits:e,axis:n};return qU.runKernel("SplitV",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OJ=Qj({rfft_:function(t,e){hz("float32"===t.dtype,(()=>`The dtype for rfft() must be real value but got ${t.dtype}`));let n=t.shape[t.shape.length-1];const r=t.size/n;let s;if(null!=e&&e<n){const r=t.shape.map((t=>0)),o=t.shape.map((t=>t));o[t.shape.length-1]=e,s=IH(t,r,o),n=e}else if(null!=e&&e>n){const r=t.shape.map((t=>t));r[t.shape.length-1]=e-n,s=CH([t,gX(r)],t.shape.length-1),n=e}else s=t;const o=pK(s),i=TH(tG(s,o),[r,n]),a=TJ(i),u=Math.floor(n/2)+1,c=dq(a),l=hq(a),f=CJ(c,[u,n-u],c.shape.length-1),h=CJ(l,[u,n-u],l.shape.length-1),p=s.shape.slice();return p[s.shape.length-1]=u,TH(tG(f[0],h[0]),p)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IJ=Qj({squaredDifference_:function(t,e){let n=Yj(t,"a","squaredDifference"),r=Yj(e,"b","squaredDifference");[n,r]=LU(n,r),vq(n.shape,r.shape);const s={a:n,b:r};return qU.runKernel("SquaredDifference",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MJ=Qj({squeeze_:function(t,e){const n=Yj(t,"x","squeeze");return TH(n,xz(n.shape,e).newShape)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RJ=Qj({stack_:function(t,e=0){const n=Zj(t,"tensors","stack","string_or_numeric");hz(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&hz(e<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const r=n,s={axis:e};return qU.runKernel("Pack",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DJ=Qj({step_:function(t,e=0){const n={x:Yj(t,"x","step")},r={alpha:e};return qU.runKernel("Step",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FJ=Qj({stridedSlice_:function(t,e,n,r,s=0,o=0,i=0,a=0,u=0){const c={x:Yj(t,"x","stridedSlice","string_or_numeric")},l={begin:e,end:n,strides:r,beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};return qU.runKernel("StridedSlice",c,l)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LJ=Qj({tan_:function(t){const e={x:Yj(t,"x","tan","float32")};return qU.runKernel("Tan",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PJ(t,e){dz(t);const n=Kj(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return eG(t,null,n,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BJ(t,e,n){if(dz(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");const r=Kj(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return eG(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VJ=Qj({topk_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=1,n=!0){const r=Yj(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const s=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const o={x:r},i={k:e,sorted:n},[a,u]=qU.runKernel("TopK",o,i);return{values:a,indices:u}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zJ=Qj({truncatedNormal_:function(t,e=0,n=1,r,s){if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const o=new QX(e,n,r,!0,s),i=zG(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WJ=Qj({unique_:function(t,e=0){const n=Yj(t,"x","unique","string_or_numeric");hz(n.rank>0,(()=>"The input tensor must be at least 1D"));const r={x:n},s={axis:e},[o,i]=qU.runKernel("Unique",r,s);return{values:o,indices:i}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UJ=Qj({unsortedSegmentSum_:function(t,e,n){const r=Yj(t,"x","unsortedSegmentSum"),s=Yj(e,"segmentIds","unsortedSegmentSum","int32");hz(bz(n),(()=>"numSegments must be of dtype int"));const o={x:r,segmentIds:s},i={numSegments:n};return qU.runKernel("UnsortedSegmentSum",o,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jJ=Qj({unstack_:function(t,e=0){const n=Yj(t,"x","unstack","string_or_numeric");hz(e>=-n.shape.length&&e<n.shape.length,(()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`));const r={value:n},s={axis:e};return qU.runKernel("Unpack",r,s)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GJ(t,e){return lX(t,e,"right")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function qJ(t,e){const n=[];for(let t=0;t<e.length;t++)e[t]&&n.push(t);const r=zG(t,"int32"),s=zG([n.length,t.length],"int32");for(let e=0;e<n.length;e++){const o=r.indexToLoc(n[e]),i=e*t.length;s.values.set(o,i)}return s.toTensor()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HJ=async function(t){const e=Yj(t,"condition","whereAsync","bool"),n=await e.data(),r=qJ(e.shape,n);return t!==e&&e.dispose(),r};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KJ=async function(t,e,n){const r=Yj(t,"tensor","boolMask"),s=Yj(e,"mask","boolMask","bool"),o=null==n?0:n,i=s.rank,a=r.shape;hz(i>0,(()=>"mask cannot be scalar")),pz(a.slice(o,o+i),s.shape,"mask's shape must match the first K dimensions of tensor's shape,");let u=1;for(let t=o;t<o+i;t++)u*=a[t];const c=a.slice(0,o).concat([u],a.slice(o+i)),l=TH(r,c),f=TH(s,[-1]),h=await HJ(f),p=MJ(h,[1]),d=BK(l,p,o);return t!==r&&r.dispose(),e!==s&&s.dispose(),p.dispose(),l.dispose(),f.dispose(),h.dispose(),d};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XJ=Qj({movingAverage_:function(t,e,n,r,s=!0){const o=Yj(t,"v","movingAverage"),i=Yj(e,"x","movingAverage"),a=Yj(n,"decay","movingAverage");PU(o,i),hz(gz(o.shape,i.shape),(()=>"Shape mismatch in v and x"));const u=SK(1),c=rX(u,a);let l=eH(rX(i,o),c);if(s){hz(null!=r,(()=>"When using zeroDebias: true, step is required."));const t=Yj(r,"step","movingAverage");l=tH(l,rX(u,EK(a,t)))}return Zq(o,l)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JJ=Qj({scatterND_:function(t,e,n){const r=Yj(t,"indices","scatterND","int32"),s=Yj(e,"updates","scatterND");Oq(s,r,n);const o={indices:r,updates:s},i={shape:n};return qU.runKernel("ScatterNd",o,i)}});const YJ=Qj({sparseToDense_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=0){const s=Yj(t,"sparseIndices","sparseToDense","int32"),o=Yj(e,"sparseValues","sparseToDense","string_or_numeric"),i=Yj(r,"defaultValue","sparseToDense",o.dtype);!function(t,e,n,r){if("int32"!==t.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const s=t.rank>0?t.shape[0]:1,o=t.rank>1?t.shape[1]:1;if(n.length!==o)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${o}.`);const i=e.size;if(0!==e.rank&&(1!==e.rank||i!==s))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${s}]`);if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(s,o,n,i);const a={sparseIndices:s,sparseValues:o,defaultValue:i},u={outputShape:n};return qU.runKernel("SparseToDense",a,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZJ=Qj({gatherND_:function(t,e){const n=Yj(e,"indices","gatherND","int32"),r={params:Yj(t,"x","gatherND","string_or_numeric"),indices:n};return qU.runKernel("GatherNd",r)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QJ=Qj({dropout_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const s=Yj(t,"x","dropout");if(hz("float32"===s.dtype,(()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${s.dtype} tensor instead.`)),hz(e>=0&&e<1,(()=>`rate must be a float in the range [0, 1), but got ${e}.`)),0===e)return t instanceof kU?s.clone():s;const o=function(t,e){if(null==e)return t.shape.slice();if(gz(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let r=0;r<t.shape.length;r++)null==e[r]&&null!=t.shape[r]?n.push(t.shape[r]):n.push(e[r]);return n}return e}(s,n),i=1-e,a=tH(PK(Zq(sJ(o,0,1,"float32",r),i)),i);return eH(s,a)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tY(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function eY(t,e,n){const r=1-t%2,s=new Float32Array(t);for(let o=0;o<t;++o){const i=2*Math.PI*o/(t+r-1);s[o]=e-n*Math.cos(i)}return PJ(s,"float32")}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nY=async function(t,e,n=1){const r=Yj(t,"predictions","inTopK"),s=Yj(e,"targets","inTopK");hz(r.rank>1,(()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`)),hz(r.rank-1===s.rank,(()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${s.rank}`)),pz(r.shape.slice(0,r.shape.length-1),s.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const o=r.shape[r.shape.length-1];hz(n>0&&n<=o,(()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${o}), but got ${n}`));const i=await r.data(),a=await s.data(),[u,c]=[i.length/o,o],l=Nz("bool",u);for(let t=0;t<u;t++){const e=t*c,r=i.subarray(e,e+c),s=[];for(let t=0;t<r.length;t++)s.push({value:r[t],index:t});s.sort(((t,e)=>e.value-t.value)),l[t]=0;for(let e=0;e<n;e++)if(s[e].index===a[t]){l[t]=1;break}}return t!==r&&r.dispose(),e!==s&&s.dispose(),nG(l,s.shape,"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rY=Qj({conv2DBackpropFilter_:function(t,e,n,r,s,o="NHWC",i){let a=t;3===t.rank&&(a=TH(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=TH(e,[1,e.shape[0],e.shape[1],e.shape[2]])),hz(4===a.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`)),hz(4===u.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`)),hz(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const c="NHWC"===o?a.shape[3]:a.shape[1],l="NHWC"===o?u.shape[3]:u.shape[1];hz(c===n[2],(()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`)),hz(l===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${l}) must match output depth for filter (${n[3]}).`)),_H("conv2dDerFilter",s,i);const f={x:a,dy:u},h={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,filterShape:n};return qU.runKernel("Conv2DBackpropFilter",f,h)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sY(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return eH(t,DJ(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function oY(t,e){let n=e;const r=wq(t.shape,e.shape);return r.length>0&&(n=kK(n,r)),TH(n,t.shape)}function iY(t,e,n,r){if("linear"===e)return t;if("relu"===e)return aJ(t);if("elu"===e)return gK(t);if("relu6"===e)return uJ(t);if("prelu"===e)return DX(t,n);if("leakyrelu"===e)return GK(t,r);if("sigmoid"===e)return OH(t);throw new Error(`Unknown fused activation ${e}.`)}const aY=(t,e)=>!(t>0)||"linear"===e;
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uY=Qj({fusedConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(u=u||"linear",!1===aY(qU.state.gradientDepth,u)){hz("NHWC"===s,(()=>`Error in fused conv2d: got dataFormat of ${s} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`));let f=XH(t,e,n,r,s,o,i);return null!=a&&(f=Zq(f,a)),iY(f,u,c,l)}const f=Yj(t,"x","conv2d","float32"),h=Yj(e,"filter","conv2d","float32");let p=f,d=!1;3===f.rank&&(d=!0,p=TH(f,[1,f.shape[0],f.shape[1],f.shape[2]])),hz(4===p.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`)),hz(4===h.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`)),_H("fused conv2d",r,i);const m="NHWC"===s?p.shape[3]:p.shape[1];hz(h.shape[2]===m,(()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${h.shape[2]}.`)),hz(EH(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const y=yH(p.shape,h.shape,n,o,r,i);let g,b;if(null!=a&&(g=Yj(a,"bias","fused conv2d"),[g]=LU(g,f),"NHWC"===s?vq(y.outShape,g.shape):(hz(g.shape.length<=1,(()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${g.shape.length}.`)),hz(0===g.shape.length||g.shape[0]===y.outChannels||1===g.shape[0],(()=>`Error in fused conv2d: bias shape (${g.shape}) is not compatible with the number of output channels (${y.outChannels})`)))),null!=c){const t=c.shape;if(hz(t.length<=1||3===t.length,(()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${t.length}.`)),1===t.length)hz(1===t[0]||t[0]===y.outChannels,(()=>`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the number of output channels (${y.outChannels}).`));else if(3===t.length)try{vq(t,y.outShape)}catch(e){const n=`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the output shape of the conv2d (${y.outShape}).`;throw Error(n)}b=Yj(c,"prelu weights","fused conv2d")}const w=(t,e)=>{hz("NHWC"===s,(()=>`Error in gradient of fused conv2D: got dataFormat of ${s} but only NHWC is currently supported.`));const[i,a,c,l]=e,f=sY(t,c,u);hz($H(o),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`));const h=[YH(a.shape,f,i,n,r),rY(a,f,i.shape,n,r)];if(null!=l){const t=oY(l,f);h.push(t)}return h},v={x:p,filter:h,bias:g,preluActivationWeights:b},x={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=QK(((t,e,n)=>{let r=qU.runKernel("FusedConv2D",v,x);return n([e,t,r]),d&&(r=TH(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:w}}));return t(p,h)}{const t=QK(((t,e,n,r)=>{let s=qU.runKernel("FusedConv2D",v,x);return r([e,t,s,n]),d&&(s=TH(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:w}}));return t(p,h,g)}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cY=Qj({depthwiseConv2dNativeBackpropFilter_:function(t,e,n,r,s,o=[1,1],i){let a=t;3===t.rank&&(a=TH(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=TH(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:u},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,filterShape:n};return qU.runKernel("DepthwiseConv2dNativeBackpropFilter",c,l)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lY=Qj({depthwiseConv2dNativeBackpropInput_:function(t,e,n,r,s,o=[1,1],i){let a=e,u=!1;3===e.rank&&(u=!0,a=TH(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,inputShape:t},f=qU.runKernel("DepthwiseConv2dNativeBackpropInput",c,l);return u?TH(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fY=Qj({fusedDepthwiseConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(!1===aY(qU.state.gradientDepth,u)){let f=uK(t,e,n,r,s,o,i);return null!=a&&(f=Zq(f,a)),iY(f,u,c,l)}const f=Yj(t,"x","depthwiseConv2d","float32"),h=Yj(e,"filter","depthwiseConv2d","float32");let p=f,d=!1;3===f.rank&&(d=!0,p=TH(f,[1,f.shape[0],f.shape[1],f.shape[2]])),hz(4===p.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`)),hz(4===h.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`)),hz(p.shape[3]===h.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${p.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`)),null==o&&(o=[1,1]),hz(EH(n,o),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),_H("fused depthwiseConv2d",r,i);const m=yH(p.shape,h.shape,n,o,r,i,!0);let y,g;null!=a&&(y=Yj(a,"bias","fused conv2d"),[y]=LU(y,f),vq(m.outShape,y.shape)),null!=c&&(g=Yj(c,"prelu weights","fused depthwiseConv2d"));const b=(t,e)=>{hz($H(o),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`));const[s,a,c,l]=e,f=sY(t,c,u),h=lY(a.shape,f,s,n,r,o,i),p=cY(a,f,s.shape,n,r,o,i);if(null!=l){return[h,p,oY(y,f)]}return[h,p]},w={x:p,filter:h,bias:y,preluActivationWeights:g},v={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=QK(((t,e,n)=>{let r=qU.runKernel("FusedDepthwiseConv2D",w,v);return n([e,t,r]),d&&(r=TH(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}}));return t(p,h)}{const t=QK(((t,e,n,r)=>{let s=qU.runKernel("FusedDepthwiseConv2D",w,v);return r([e,t,s,n]),d&&(s=TH(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:b}}));return t(p,h,y)}}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hY=Qj({fusedMatMul_:function({a:t,b:e,transposeA:n=!1,transposeB:r=!1,bias:s,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a}){if(!1===aY(qU.state.gradientDepth,o)){let u=aq(t,e,n,r);return null!=s&&(u=Zq(u,s)),iY(u,o,i,a)}let u=Yj(t,"a","fused matMul"),c=Yj(e,"b","fused matMul");[u,c]=LU(u,c);const l=n?u.shape[u.rank-2]:u.shape[u.rank-1],f=r?c.shape[c.rank-1]:c.shape[c.rank-2],h=n?u.shape[u.rank-1]:u.shape[u.rank-2],p=r?c.shape[c.rank-2]:c.shape[c.rank-1],d=u.shape.slice(0,-2),m=c.shape.slice(0,-2),y=yz(d),g=yz(m);hz(l===f,(()=>`Error in fused matMul: inner shapes (${l}) and (${f}) of Tensors with shapes ${u.shape} and ${c.shape} and transposeA=${n} and transposeB=${r} must match.`));const b=vq(u.shape.slice(0,-2),c.shape.slice(0,-2)).concat([h,p]),w=TH(u,n?[y,l,h]:[y,h,l]),v=TH(c,r?[g,p,f]:[g,f,p]);let x,N;null!=s&&(x=Yj(s,"bias","fused matMul"),[x]=LU(x,u),vq(b,x.shape)),null!=i&&(N=Yj(i,"prelu weights","fused matMul"));const $=(t,e)=>{const[i,a,u,c]=e,l=sY(TH(t,u.shape),u,o);let f,h;if(n||r?!n&&r?(f=aq(l,a,!1,!1),h=aq(l,i,!0,!1)):n&&!r?(f=aq(a,l,!1,!0),h=aq(i,l,!1,!1)):(f=aq(a,l,!0,!0),h=aq(l,i,!0,!0)):(f=aq(l,a,!1,!0),h=aq(i,l,!0,!1)),null!=s){return[f,h,oY(c,l)]}return[f,h]},E={a:w,b:v,bias:x,preluActivationWeights:N},S={transposeA:n,transposeB:r,activation:o,leakyreluAlpha:a};if(null==s){const t=QK(((t,e,n)=>{const r=qU.runKernel("_FusedMatMul",E,S);return n([t,e,r]),{value:TH(r,b),gradFunc:$}}));return t(w,v)}{const t=QK(((t,e,n,r)=>{const s=qU.runKernel("_FusedMatMul",E,S);return r([t,e,s,n]),{value:TH(s,b),gradFunc:$}}));return t(w,v,x)}}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var pY=Object.freeze({__proto__:null,conv2d:uY,depthwiseConv2d:fY,matMul:hY});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dY=Qj({hammingWindow_:function(t){return eY(t,.54,.46)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mY=Qj({hannWindow_:function(t){return eY(t,.5,.5)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yY=Qj({frame_:function(t,e,n,r=!1,s=0){let o=0;const i=[];for(;o+e<=t.size;)i.push(IH(t,o,e)),o+=n;if(r)for(;o<t.size;){const r=o+e-t.size,a=CH([IH(t,o,e-r),LK([r],s)]);i.push(a),o+=n}return 0===i.length?BJ([],[0,e]):TH(CH(i),[i.length,e])}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gY=Qj({stft_:function(t,e,n,r,s=mY){null==r&&(r=tY(e));const o=yY(t,e,n),i=eH(o,s(e));return OJ(i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bY=Qj({cropAndResize_:function(t,e,n,r,s="bilinear",o=0){const i=Yj(t,"image","cropAndResize"),a=Yj(e,"boxes","cropAndResize","float32"),u=Yj(n,"boxInd","cropAndResize","int32"),c=a.shape[0];hz(4===i.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`)),hz(2===a.rank&&4===a.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`)),hz(1===u.rank&&u.shape[0]===c,(()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`)),hz(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),hz(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),hz("bilinear"===s||"nearest"===s,(()=>`method must be bilinear or nearest, but was ${s}`));const l={image:i,boxes:a,boxInd:u},f={method:s,extrapolationValue:o,cropSize:r};return qU.runKernel("CropAndResize",l,f)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wY=Qj({flipLeftRight_:function(t){const e=Yj(t,"image","flipLeftRight","float32");hz(4===e.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`));const n={image:e};return qU.runKernel("FlipLeftRight",n,{})}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vY=Qj({grayscaleToRGB_:function(t){const e=Yj(t,"image","grayscaleToRGB"),n=e.rank-1,r=e.shape[n];hz(e.rank>=2,(()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`)),hz(1===r,(()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`));const s=new Array(e.rank);return s.fill(1,0,n),s[n]=3,DK(e,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xY=Qj({rotateWithOffset_:function(t,e,n=0,r=.5){const s=Yj(t,"image","rotateWithOffset","float32");hz(4===s.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${s.rank}.`));const o={image:s},i={radians:e,fillValue:n,center:r};return qU.runKernel("RotateWithOffset",o,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NY(t,e,n,r,s,o){null==r&&(r=.5),null==s&&(s=Number.NEGATIVE_INFINITY),null==o&&(o=0);const i=t.shape[0];return n=Math.min(n,i),hz(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),hz(2===t.rank,(()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`)),hz(4===t.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`)),hz(1===e.rank,(()=>"scores must be a 1D tensor")),hz(e.shape[0]===i,(()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`)),hz(0<=o&&o<=1,(()=>`softNmsSigma must be in [0, 1], but was '${o}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:s,softNmsSigma:o}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Y=Qj({nonMaxSuppression_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const o=Yj(t,"boxes","nonMaxSuppression","float32"),i=Yj(e,"scores","nonMaxSuppression","float32"),a=NY(o,i,n,r,s),u={maxOutputSize:n=a.maxOutputSize,iouThreshold:r=a.iouThreshold,scoreThreshold:s=a.scoreThreshold};return qU.runKernel("NonMaxSuppressionV3",{boxes:o,scores:i},u)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EY(t,e,n){const r=function(t,e,n){return function(t,e,n){let r=0,s=t.length,o=0,i=!1;for(;r<s;){o=r+(s-r>>>1);const a=n(e,t[o]);a>0?r=o+1:(s=o,i=!a)}return i?r:-r-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e,n||SY)}(t,e,n),s=r<0?-(r+1):r;t.splice(s,0,e)}function SY(t,e){return t>e?1:t<e?-1:0}function _Y(t,e,n,r,s){return AY(t,e,n,r,s,0)}function TY(t,e,n,r,s,o){return AY(t,e,n,r,s,0,!1,o,!0)}function kY(t,e,n,r,s,o){return AY(t,e,n,r,s,o,!0)}function AY(t,e,n,r,s,o,i=!1,a=!1,u=!1){const c=[];for(let t=0;t<e.length;t++)e[t]>s&&c.push({score:e[t],boxIndex:t,suppressBeginIndex:0});c.sort(IY);const l=o>0?-.5/o:0,f=[],h=[];for(;f.length<n&&c.length>0;){const e=c.pop(),{score:n,boxIndex:o,suppressBeginIndex:i}=e;if(n<s)break;let a=!1;for(let n=f.length-1;n>=i;--n){const i=CY(t,o,f[n]);if(i>=r){a=!0;break}if(e.score=e.score*OY(r,l,i),e.score<=s)break}e.suppressBeginIndex=f.length,a||(e.score===n?(f.push(o),h.push(e.score)):e.score>s&&EY(c,e,IY))}const p=f.length,d=n-p;a&&d>0&&(f.push(...new Array(d).fill(0)),h.push(...new Array(d).fill(0)));const m={selectedIndices:f};return i&&(m.selectedScores=h),u&&(m.validOutputs=p),m}function CY(t,e,n){const r=t.subarray(4*e,4*e+4),s=t.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(s[0],s[2]),l=Math.min(s[1],s[3]),f=Math.max(s[0],s[2]),h=Math.max(s[1],s[3]),p=(a-o)*(u-i),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;const m=Math.max(o,c),y=Math.max(i,l),g=Math.min(a,f),b=Math.min(u,h),w=Math.max(g-m,0)*Math.max(b-y,0);return w/(p+d-w)}function OY(t,e,n){const r=Math.exp(e*n*n);return n<=t?r:0}function IY(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MY=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const o=Yj(t,"boxes","nonMaxSuppressionAsync"),i=Yj(e,"scores","nonMaxSuppressionAsync"),a=NY(o,i,n,r,s);n=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;const u=await Promise.all([o.data(),i.data()]),c=u[0],l=u[1],{selectedIndices:f}=_Y(c,l,n,r,s);return o!==t&&o.dispose(),i!==e&&i.dispose(),PJ(f,"int32")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RY=Qj({nonMaxSuppressionWithScore_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=Yj(t,"boxes","nonMaxSuppression"),a=Yj(e,"scores","nonMaxSuppression"),u=NY(i,a,n,r,s,o),c={boxes:i,scores:a},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:s=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},f=qU.runKernel("NonMaxSuppressionV5",c,l);return{selectedIndices:f[0],selectedScores:f[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DY=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=Yj(t,"boxes","nonMaxSuppressionAsync"),a=Yj(e,"scores","nonMaxSuppressionAsync"),u=NY(i,a,n,r,s,o);n=u.maxOutputSize,r=u.iouThreshold,s=u.scoreThreshold,o=u.softNmsSigma;const c=await Promise.all([i.data(),a.data()]),l=c[0],f=c[1],{selectedIndices:h,selectedScores:p}=kY(l,f,n,r,s,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:PJ(h,"int32"),selectedScores:PJ(p)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FY=Qj({nonMaxSuppressionPadded_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=Yj(t,"boxes","nonMaxSuppression"),a=Yj(e,"scores","nonMaxSuppression"),u=NY(i,a,n,r,s,null),c={boxes:i,scores:a},l={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:o},f=qU.runKernel("NonMaxSuppressionV4",c,l);return{selectedIndices:f[0],validOutputs:f[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LY=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=Yj(t,"boxes","nonMaxSuppressionAsync"),a=Yj(e,"scores","nonMaxSuppressionAsync"),u=NY(i,a,n,r,s,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[h,p]=await Promise.all([i.data(),a.data()]),{selectedIndices:d,validOutputs:m}=TY(h,p,c,l,f,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:PJ(d,"int32"),validOutputs:SK(m,"int32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PY=Qj({resizeBilinear_:function(t,e,n=!1,r=!1){const s=Yj(t,"images","resizeBilinear");hz(3===s.rank||4===s.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${s.rank}.`)),hz(2===e.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`)),hz(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=TH(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=qU.runKernel("ResizeBilinear",a,u);return i?TH(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BY=Qj({resizeNearestNeighbor_:function(t,e,n=!1,r=!1){const s=Yj(t,"images","resizeNearestNeighbor");hz(3===s.rank||4===s.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${s.rank}.`)),hz(2===e.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`)),hz("float32"===s.dtype||"int32"===s.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),hz(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=TH(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=qU.runKernel("ResizeNearestNeighbor",a,u);return i?TH(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VY=Qj({threshold_:function(t,e="binary",n=!1,r=.5){const s=Yj(t,"image","threshold"),o=s.shape[0]*s.shape[1];let i,a,u,c,l=eH(PJ([r]),255);if(hz(3===s.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${s.rank}.`)),hz(3===s.shape[2]||1===s.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${s.shape[2]}.`)),hz("int32"===s.dtype||"float32"===s.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${s.dtype}.`)),hz("otsu"===e||"binary"===e,(()=>`Method must be binary or otsu, but was ${e}`)),3===s.shape[2]){[i,a,u]=CJ(s,[1,1,1],-1);const t=eH(i,.2989),e=eH(a,.587),n=eH(u,.114);c=Zq(Zq(t,e),n)}else c=t;if("otsu"===e){l=function(t,e){let n,r,s,o,i,a,u=PJ([-1]),c=PJ([0]),l=PJ([0]);for(let f=0;f<t.size-1;f++){n=IH(t,0,f+1),r=IH(t,f+1),i=tH(kK(n),e),a=tH(kK(r),e);const h=kK(eH(n,oJ(0,n.size)));s=tH(h,kK(n));const p=LK(r.shape,n.size),d=Zq(oJ(0,r.size),p),m=eH(r,d);o=tH(kK(m),kK(r));const y=rX(s,o),g=rX(s,o),b=eH(i,a);l=eH(eH(b,y),g);const w=VK(l,c);c=hK(w,l,c),u=hK(w,PJ([f]),u)}return u}(VH(WG(dJ(c),"int32"),nG([]),256),o)}const f=n?HK(c,l):VK(c,l);return WG(eH(f,255),"int32")}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zY=Qj({transform_:function(t,e,n="nearest",r="constant",s=0,o){const i=Yj(t,"image","transform","float32"),a=Yj(e,"transforms","transform","float32");hz(4===i.rank,(()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`)),hz(2===a.rank&&(a.shape[0]===i.shape[0]||1===a.shape[0])&&8===a.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),hz(null==o||2===o.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`));const u={image:i,transforms:a},c={interpolation:n,fillMode:r,fillValue:s,outputShape:o};return qU.runKernel("Transform",u,c)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WY=Qj({bandPart_:function(t,e,n){hz(e%1==0,(()=>`bandPart(): numLower must be an integer, got ${e}.`)),hz(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`));const r=Yj(t,"a","bandPart");hz(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));const s=r.shape,[o,i]=r.shape.slice(-2);if(!(e<=o))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`);if(!(n<=i))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${i}).`);e<0&&(e=o),n<0&&(n=i);const a=TH(oJ(0,o,1,"int32"),[-1,1]),u=oJ(0,i,1,"int32"),c=rX(a,u),l=iX(HK(c,SK(+e,"int32")),zK(c,SK(-n,"int32"))),f=gX([o,i],r.dtype);return TH(RJ(jJ(TH(r,[-1,o,i])).map((t=>hK(l,t,f)))),s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UY=Qj({gramSchmidt_:function(t){let e;if(Array.isArray(t)){e=!1,hz(null!=t&&t.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=t[0].shape[0];for(let e=1;e<t.length;++e)hz(t[e].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[e].shape[0]} vs. ${n})`))}else e=!0,t=CJ(t,t.shape[0],0).map((t=>MJ(t,[0])));hz(t.length<=t[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`));const n=[],r=t;for(let e=0;e<t.length;++e)n.push(qU.tidy((()=>{let t=r[e];if(e>0)for(let r=0;r<e;++r){const e=eH(kK(eH(n[r],t)),n[r]);t=rX(t,e)}return tH(t,CK(t,"euclidean"))})));return e?RJ(n,0):n}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jY(t,e=!1){return qU.tidy((()=>{hz(2===t.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`));const n=t.shape[0],r=t.shape[1];let s=FK(n),o=UG(t);const i=BJ([[1]],[1,1]);let a=UG(i);const u=n>=r?r:n;for(let t=0;t<u;++t){const e=o,u=a,c=s;[a,o,s]=qU.tidy((()=>{const e=IH(o,[t,t],[n-t,1]),u=CK(e),c=IH(o,[t,t],[1,1]),l=hK(VK(c,0),BJ([[-1]]),BJ([[1]])),f=rX(c,eH(l,u)),h=tH(e,f);a=1===h.shape[0]?UG(i):CH([i,IH(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);const p=pq(tH(aq(l,f),u)),d=IH(o,[t,0],[n-t,r]),m=eH(p,a),y=mq(a);if(0===t)o=rX(d,aq(m,aq(y,d)));else{const e=rX(d,aq(m,aq(y,d)));o=CH([IH(o,[0,0],[t,r]),e],0)}const g=mq(m),b=IH(s,[0,t],[n,s.shape[1]-t]);if(0===t)s=rX(b,aq(aq(b,a),g));else{const e=rX(b,aq(aq(b,a),g));s=CH([IH(s,[0,0],[n,t]),e],1)}return[a,o,s]})),lq([e,u,c])}return!e&&n>r&&(s=IH(s,[0,0],[n,r]),o=IH(o,[0,0],[r,r])),[s,o]}))}const GY=Qj({qr_:function(t,e=!1){if(hz(t.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`)),2===t.rank)return jY(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce(((t,e)=>t*e)),r=jJ(TH(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),s=[],o=[];r.forEach((t=>{const[n,r]=jY(t,e);s.push(n),o.push(r)}));return[TH(RJ(s,0),t.shape),TH(RJ(o,0),t.shape)]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var qY;!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(qY||(qY={}));const HY=Qj({computeWeightedLoss_:function(t,e,n=qY.SUM_BY_NONZERO_WEIGHTS){const r=Yj(t,"losses","computeWeightedLoss");let s=null;null!=e&&(s=Yj(e,"weights","computeWeightedLoss"));const o=null==s?r:eH(r,s);if(n===qY.NONE)return o;if(n===qY.SUM)return kK(o);if(n===qY.MEAN){if(null==s)return yX(o);{const t=r.size/s.size,e=tH(kK(o),kK(s));return t>1?tH(e,SK(t)):e}}if(n===qY.SUM_BY_NONZERO_WEIGHTS){if(null==s)return tH(kK(o),SK(r.size));{const t=eH(s,bX(r.shape)),e=WG(kK(SX(t,SK(0))),"float32");return tH(kK(o),e)}}throw Error(`Unknown reduction: ${n}`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KY=Qj({absoluteDifference_:function(t,e,n,r=qY.SUM_BY_NONZERO_WEIGHTS){const s=Yj(t,"labels","absoluteDifference"),o=Yj(e,"predictions","absoluteDifference");let i=null;null!=n&&(i=Yj(n,"weights","absoluteDifference")),pz(s.shape,o.shape,"Error in absoluteDifference: ");const a=nH(rX(s,o));return HY(a,i,r)}});const XY=Qj({cosineDistance_:function(t,e,n,r,s=qY.SUM_BY_NONZERO_WEIGHTS){const o=Yj(t,"labels","cosineDistance"),i=Yj(e,"predictions","cosineDistance");let a=null;null!=r&&(a=Yj(r,"weights","cosineDistance")),pz(o.shape,i.shape,"Error in cosineDistance: ");const u=SK(1),c=rX(u,kK(eH(o,i),n,!0));return HY(c,a,s)}});const JY=Qj({hingeLoss_:function(t,e,n,r=qY.SUM_BY_NONZERO_WEIGHTS){let s=Yj(t,"labels","hingeLoss");const o=Yj(e,"predictions","hingeLoss");let i=null;null!=n&&(i=Yj(n,"weights","hingeLoss")),pz(s.shape,o.shape,"Error in hingeLoss: ");const a=SK(1);s=rX(eH(SK(2),s),a);const u=aJ(rX(a,eH(s,o)));return HY(u,i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YY=Qj({huberLoss_:function(t,e,n,r=1,s=qY.SUM_BY_NONZERO_WEIGHTS){const o=Yj(t,"labels","huberLoss"),i=Yj(e,"predictions","huberLoss");let a=null;null!=n&&(a=Yj(n,"weights","huberLoss")),pz(o.shape,i.shape,"Error in huberLoss: ");const u=SK(r),c=nH(rX(i,o)),l=wX(c,u),f=rX(c,l),h=Zq(eH(SK(.5),TK(l)),eH(u,f));return HY(h,a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZY=Qj({logLoss_:function(t,e,n,r=1e-7,s=qY.SUM_BY_NONZERO_WEIGHTS){const o=Yj(t,"labels","logLoss"),i=Yj(e,"predictions","logLoss");let a=null;null!=n&&(a=Yj(n,"weights","logLoss")),pz(o.shape,i.shape,"Error in logLoss: ");const u=SK(1),c=SK(r),l=pq(eH(o,JK(Zq(i,c)))),f=eH(rX(u,o),JK(Zq(rX(u,i),c))),h=rX(l,f);return HY(h,a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QY=Qj({meanSquaredError_:function(t,e,n,r=qY.SUM_BY_NONZERO_WEIGHTS){const s=Yj(t,"labels","meanSquaredError"),o=Yj(e,"predictions","meanSquaredError");let i=null;null!=n&&(i=Yj(n,"weights","meanSquaredError")),pz(s.shape,o.shape,"Error in meanSquaredError: ");const a=IJ(s,o);return HY(a,i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tZ=Qj({sigmoidCrossEntropy_:function(t,e,n,r=0,s=qY.SUM_BY_NONZERO_WEIGHTS){let o=Yj(t,"multiClassLabels","sigmoidCrossEntropy");const i=Yj(e,"logits","sigmoidCrossEntropy");let a=null;if(null!=n&&(a=Yj(n,"weights","sigmoidCrossEntropy")),pz(o.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){const t=SK(r),e=SK(1),n=SK(.5);o=Zq(eH(o,rX(e,t)),eH(n,t))}const u=function(t,e){const n=Yj(t,"labels","sigmoidCrossEntropyWithLogits"),r=Yj(e,"logits","sigmoidCrossEntropyWithLogits");pz(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const s=aJ(r),o=eH(r,n),i=YK(IK(pq(nH(r))));return Zq(rX(s,o),i)}(o,i);return HY(u,a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eZ=Qj({softmaxCrossEntropy_:function(t,e,n,r=0,s=qY.SUM_BY_NONZERO_WEIGHTS){let o=Yj(t,"onehotLabels","softmaxCrossEntropy");const i=Yj(e,"logits","softmaxCrossEntropy");let a=null;if(null!=n&&(a=Yj(n,"weights","softmaxCrossEntropy")),pz(o.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){const t=SK(r),e=SK(1),n=SK(o.shape[1]);o=Zq(eH(o,rX(e,t)),tH(t,n))}const u=function(t,e,n=-1){if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);const r=QK(((t,e,r)=>{const s=oX(e,[n],!0),o=rX(WG(e,"float32"),s);r([t,o]);const i=pq(eH(o,t));return{value:kK(i,[n]),gradFunc:(t,e)=>{const[r,s]=e,o=xK(t.shape,[n]);return[eH(TH(t,o),rX(WG(r,"float32"),IK(s))),eH(TH(t,o),rX(IK(s),WG(r,"float32")))]}}}));return r(t,e)}(o,i);return HY(u,a,s)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nZ=Qj({sparseFillEmptyRows_:function(t,e,n,r){const s=Yj(t,"indices","sparseFillEmptyRows","int32"),o=Yj(e,"values","sparseFillEmptyRows"),i=Yj(n,"denseShape","sparseFillEmptyRows","int32"),a=Yj(r,"defaultValue","sparseFillEmptyRows",o.dtype);if(2!==s.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${s.shape}`);if(1!==o.rank)throw new Error(`Values should be Tensor1D but received shape ${o.shape}`);if(1!==i.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${i.shape}`);if(0!==a.rank)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const u={indices:s,values:o,denseShape:i,defaultValue:a},c=qU.runKernel("SparseFillEmptyRows",u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rZ=Qj({sparseReshape_:function(t,e,n){const r=Yj(t,"inputIndices","sparseReshape","int32"),s=Yj(e,"inputShape","sparseReshape","int32"),o=Yj(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==s.rank)throw new Error(`Input shape should be Tensor1D but received shape ${s.shape}`);if(1!==o.rank)throw new Error(`New shape should be Tensor1D but received shape ${o.shape}`);const i={inputIndices:r,inputShape:s,newShape:o},a=qU.runKernel("SparseReshape",i);return{outputIndices:a[0],outputShape:a[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sZ=Qj({sparseSegmentMean_:function(t,e,n){const r=Yj(t,"data","sparseSegmentMean"),s=Yj(e,"indices","sparseSegmentMean","int32"),o=Yj(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return qU.runKernel("SparseSegmentMean",i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oZ=Qj({sparseSegmentSum_:function(t,e,n){const r=Yj(t,"data","sparseSegmentSum"),s=Yj(e,"indices","sparseSegmentSum","int32"),o=Yj(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return qU.runKernel("SparseSegmentSum",i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iZ=Qj({stringNGrams_:function(t,e,n,r,s,o,i,a){const u=Yj(t,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error(`Data must be a vector, saw: ${u.shape}`);const c=Yj(e,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");const l={separator:n,nGramWidths:r,leftPad:s,rightPad:o,padWidth:i,preserveShortSequences:a},f={data:u,dataSplits:c},h=qU.runKernel("StringNGrams",f,l);return{nGrams:h[0],nGramsSplits:h[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aZ=Qj({stringSplit_:function(t,e,n=!0){const r=Yj(t,"input","stringSplit","string"),s=Yj(e,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(0!==s.rank)throw new Error(`Delimiter should be a scalar but received shape ${s.shape}`);const o={skipEmpty:n},i={input:r,delimiter:s},a=qU.runKernel("StringSplit",i,o);return{indices:a[0],values:a[1],shape:a[2]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uZ=Qj({stringToHashBucketFast_:function(t,e){const n=Yj(t,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const s={input:n};return qU.runKernel("StringToHashBucketFast",s,r)}}),cZ={fft:TJ,ifft:kJ,rfft:OJ,irfft:AJ},lZ={hammingWindow:dY,hannWindow:mY,frame:yY,stft:gY},fZ={flipLeftRight:wY,grayscaleToRGB:vY,resizeNearestNeighbor:BY,resizeBilinear:PY,rotateWithOffset:xY,cropAndResize:bY,nonMaxSuppression:$Y,nonMaxSuppressionAsync:MY,nonMaxSuppressionWithScore:RY,nonMaxSuppressionWithScoreAsync:DY,nonMaxSuppressionPadded:FY,nonMaxSuppressionPaddedAsync:LY,threshold:VY,transform:zY},hZ={bandPart:WY,gramSchmidt:UY,qr:GY},pZ={absoluteDifference:KY,computeWeightedLoss:HY,cosineDistance:XY,hingeLoss:JY,huberLoss:YY,logLoss:ZY,meanSquaredError:QY,sigmoidCrossEntropy:tZ,softmaxCrossEntropy:eZ},dZ={sparseFillEmptyRows:nZ,sparseReshape:rZ,sparseSegmentMean:sZ,sparseSegmentSum:oZ},mZ={stringNGrams:iZ,stringSplit:aZ,stringToHashBucketFast:uZ};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class yZ extends jq{minimize(t,e=!1,n){const{value:r,grads:s}=this.computeGradients(t,n);if(null!=n){const t=n.map((t=>({name:t.name,tensor:s[t.name]})));this.applyGradients(t)}else this.applyGradients(s);return lq(s),e?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return ZK(t,e)}dispose(){null!=this.iterations_&&lq(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:SK(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(yZ,Symbol.hasInstance,{value:t=>null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class gZ extends yZ{constructor(t,e,n=null){super(),this.learningRate=t,this.rho=e,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=qU.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=qU.registeredVariables[e];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${e}/accum_grad`,variable:cq((()=>pK(r).variable(false)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${e}/accum_var`,variable:cq((()=>pK(r).variable(false)))});const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const o=this.accumulatedGrads[n].variable,i=this.accumulatedUpdates[n].variable;cq((()=>{const t=Zq(eH(o,this.rho),eH(TK(s),1-this.rho)),e=eH(tH(_K(Zq(i,this.epsilon)),_K(Zq(o,this.epsilon))),s),n=Zq(eH(i,this.rho),eH(TK(e),1-this.rho));o.assign(t),i.assign(n);const a=Zq(eH(e,-this.learningRate),r);r.assign(a)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(lq(this.accumulatedGrads.map((t=>t.variable))),lq(this.accumulatedUpdates.map((t=>t.variable))))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){const e=(t=await this.extractIterations(t)).length/2;this.accumulatedGrads=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedUpdates=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}gZ.className="Adadelta",qq(gZ);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class bZ extends yZ{constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=qU.registeredVariables[e];if(null==this.accumulatedGrads[n]){const t=!1;this.accumulatedGrads[n]={originalName:`${e}/accumulator`,variable:cq((()=>LK(r.shape,this.initialAccumulatorValue).variable(t)))}}const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const o=this.accumulatedGrads[n].variable;cq((()=>{const t=Zq(o,TK(s));o.assign(t);const e=Zq(eH(tH(s,_K(Zq(t,qU.backend.epsilon()))),-this.learningRate),r);r.assign(e)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&lq(this.accumulatedGrads.map((t=>t.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulatedGrads=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}bZ.className="Adagrad",qq(bZ);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class wZ extends yZ{constructor(t,e,n,r=null){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],cq((()=>{this.accBeta1=SK(e).variable(),this.accBeta2=SK(n).variable()})),null==r&&(this.epsilon=qU.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);cq((()=>{const n=rX(1,this.accBeta1),r=rX(1,this.accBeta2);e.forEach(((e,s)=>{const o=qU.registeredVariables[e];null==this.accumulatedFirstMoment[s]&&(this.accumulatedFirstMoment[s]={originalName:`${e}/m`,variable:cq((()=>pK(o).variable(false)))}),null==this.accumulatedSecondMoment[s]&&(this.accumulatedSecondMoment[s]={originalName:`${e}/v`,variable:cq((()=>pK(o).variable(false)))});const i=Array.isArray(t)?t[s].tensor:t[e];if(null==i)return;const a=this.accumulatedFirstMoment[s].variable,u=this.accumulatedSecondMoment[s].variable,c=Zq(eH(a,this.beta1),eH(i,1-this.beta1)),l=Zq(eH(u,this.beta2),eH(TK(i),1-this.beta2)),f=tH(c,n),h=tH(l,r);a.assign(c),u.assign(l);const p=Zq(eH(tH(f,Zq(_K(h),this.epsilon)),-this.learningRate),o);o.assign(p)})),this.accBeta1.assign(eH(this.accBeta1,this.beta1)),this.accBeta2.assign(eH(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&lq(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedSecondMoment&&lq(this.accumulatedSecondMoment.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t),cq((()=>{this.accBeta1.assign(EK(this.beta1,this.iterations_+1)),this.accBeta2.assign(EK(this.beta2,this.iterations_+1))}));const e=t.length/2;this.accumulatedFirstMoment=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedSecondMoment=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}wZ.className="Adam",qq(wZ);
/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/
class vZ extends yZ{constructor(t,e,n,r=null,s=0){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],cq((()=>{this.iteration=SK(0).variable(),this.accBeta1=SK(e).variable()})),null==r&&(this.epsilon=qU.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);cq((()=>{const n=rX(1,this.accBeta1),r=tH(-this.learningRate,Zq(eH(this.iteration,this.decay),1));e.forEach(((e,s)=>{const o=qU.registeredVariables[e];null==this.accumulatedFirstMoment[s]&&(this.accumulatedFirstMoment[s]={originalName:`${e}/m`,variable:pK(o).variable(false)}),null==this.accumulatedWeightedInfNorm[s]&&(this.accumulatedWeightedInfNorm[s]={originalName:`${e}/v`,variable:pK(o).variable(false)});const i=Array.isArray(t)?t[s].tensor:t[e];if(null==i)return;const a=this.accumulatedFirstMoment[s].variable,u=this.accumulatedWeightedInfNorm[s].variable,c=Zq(eH(a,this.beta1),eH(i,1-this.beta1)),l=eH(u,this.beta2),f=nH(i),h=mX(l,f);a.assign(c),u.assign(h);const p=Zq(eH(tH(r,n),tH(c,Zq(h,this.epsilon))),o);o.assign(p)})),this.iteration.assign(Zq(this.iteration,1)),this.accBeta1.assign(eH(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&lq(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedWeightedInfNorm&&lq(this.accumulatedWeightedInfNorm.map((t=>t.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}vZ.className="Adamax",qq(vZ);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class xZ extends yZ{constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);e.forEach(((e,n)=>{const r=Array.isArray(t)?t[n].tensor:t[e];if(null==r)return;const s=qU.registeredVariables[e];cq((()=>{const t=Zq(eH(this.c,r),s);s.assign(t)}))})),this.incrementIterations()}setLearningRate(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=fq(SK(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(0!==(t=await this.extractIterations(t)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}xZ.className="SGD",qq(xZ);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class NZ extends xZ{constructor(t,e,n=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=n,this.accumulations=[],this.m=SK(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=qU.registeredVariables[e];if(null==this.accumulations[n]){const t=!1;this.accumulations[n]={originalName:`${e}/momentum`,variable:cq((()=>pK(r).variable(t)))}}const s=this.accumulations[n].variable,o=Array.isArray(t)?t[n].tensor:t[e];null!=o&&cq((()=>{let t;const e=Zq(eH(this.m,s),o);t=this.useNesterov?Zq(eH(this.c,Zq(o,eH(e,this.m))),r):Zq(eH(this.c,e),r),s.assign(e),r.assign(t)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&lq(this.accumulations.map((t=>t.variable)))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulations=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}NZ.className="Momentum",qq(NZ);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class $Z extends yZ{constructor(t,e=.9,n=0,r=null,s=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,null==r&&(this.epsilon=qU.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=qU.registeredVariables[e],s=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${e}/rms`,variable:cq((()=>pK(r).variable(s)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${e}/momentum`,variable:cq((()=>pK(r).variable(s)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${e}/mg`,variable:cq((()=>pK(r).variable(s)))});const o=Array.isArray(t)?t[n].tensor:t[e];if(null==o)return;const i=this.accumulatedMeanSquares[n].variable,a=this.accumulatedMoments[n].variable;cq((()=>{const t=Zq(eH(i,this.decay),eH(TK(o),1-this.decay));if(this.centered){const e=this.accumulatedMeanGrads[n].variable,s=Zq(eH(e,this.decay),eH(o,1-this.decay)),u=tH(eH(o,this.learningRate),_K(rX(t,Zq(TK(s),this.epsilon)))),c=Zq(eH(a,this.momentum),u);i.assign(t),e.assign(s),a.assign(c);const l=rX(r,c);r.assign(l)}else{const t=Zq(eH(i,this.decay),eH(TK(o),1-this.decay)),e=Zq(eH(a,this.momentum),tH(eH(o,this.learningRate),_K(Zq(t,this.epsilon))));i.assign(t),a.assign(e);const n=rX(r,e);r.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&lq(this.accumulatedMeanSquares.map((t=>t.variable))),null!=this.accumulatedMeanGrads&&this.centered&&lq(this.accumulatedMeanGrads.map((t=>t.variable))),null!=this.accumulatedMoments&&lq(this.accumulatedMoments.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,n=!1;this.accumulatedMeanSquares=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.accumulatedMoments=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}$Z.className="RMSProp",qq($Z);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class EZ{static sgd(t){return new xZ(t)}static momentum(t,e,n=!1){return new NZ(t,e,n)}static rmsprop(t,e=.9,n=0,r=null,s=!1){return new $Z(t,e,n,r,s)}static adam(t=.001,e=.9,n=.999,r=null){return new wZ(t,e,n,r)}static adadelta(t=.001,e=.95,n=null){return new gZ(t,e,n)}static adamax(t=.002,e=.9,n=.999,r=null,s=0){return new vZ(t,e,n,r,s)}static adagrad(t,e=.1){return new bZ(t,e)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SZ={sgd:EZ.sgd,momentum:EZ.momentum,adadelta:EZ.adadelta,adagrad:EZ.adagrad,rmsprop:EZ.rmsprop,adamax:EZ.adamax,adam:EZ.adam},_Z="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:t=>t();
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const TZ=/->/g;function kZ(t,e){const n=[];for(let r=0;r<t.length;++r)0!==t[r].length&&-1===t[r].indexOf(e)&&-1!==e||n.push(r);return n}var AZ=Object.freeze({__proto__:null,segOpComputeOptimalWindowSize:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n,r=!1;for(t<=30?(n=t,r=!0):n=Rz(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=Rz(t,n+1);return n},computeOutShape:function(t,e,n){const r=[],s=t.length;for(let o=0;o<s;o++)o!==e?r.push(t[o]):r.push(n);return r},collectGatherOpShapeInfo:function(t,e,n,r){const s=e.shape.length,o=t.shape.length;if(0!==r&&(r<-s||r>s))throw new Error(`Expect batchDims in the range of [-${s}, ${s}], but got ${r}`);if(r<0&&(r+=s),r>o)throw new Error(`batchDims (${r}) must be less than rank(x) (\n    ${o}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let n=0;n<r;++n)if(t.shape[n]!==e.shape[n])throw new Error(`x.shape[${n}]: ${t.shape[n]} should be equal to indices.shape[${n}]: ${e.shape[n]}.`);const i=t.shape[n],a=[];let u=1,c=1,l=1;for(let e=0;e<r;++e)a.push(t.shape[e]),u*=t.shape[e];for(let e=r;e<n;e++)a.push(t.shape[e]),c*=t.shape[e];for(let t=r;t<s;t++)a.push(e.shape[t]);for(let e=n+1;e<o;e++)a.push(t.shape[e]),l*=t.shape[e];return{batchSize:u,sliceSize:l,outerSize:c,dimSize:i,outputShape:a}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var CZ=Object.freeze({__proto__:null,slice_util:Uq,segment_util:AZ,fromUint8ToStringArray:function(t){try{return t.map((t=>mU(t)))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}},fromStringArrayToUint8:function(t){return t.map((t=>dU(t)))},upcastType:FU,axesAreInnerMostDims:wK,combineLocations:vK,computeOutAndReduceShapes:function(t,e){const n=[],r=t.length;for(let s=0;s<r;s++)-1===e.indexOf(s)&&n.push(t[s]);return[n,e.map((e=>t[e]))]},expandShapeToKeepDim:xK,assertAxesAreInnerMostDims:function(t,e,n){hz(wK(e,n),(()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`))},getAxesPermutation:function(t,e){if(wK(t,e))return null;const n=[];for(let r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach((t=>n.push(t))),n},getUndoAxesPermutation:function(t){return t.map(((t,e)=>[e,t])).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]))},getInnerMostAxes:function(t,e){const n=[];for(let r=e-t;r<e;++r)n.push(r);return n},getBroadcastDims:bq,getReductionAxes:wq,assertAndGetBroadcastShape:vq,assertParamsConsistent:
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=t[0].length;t.forEach(((t,e)=>{hz(t.length===n,(()=>`Error in concat${n}D: rank of tensors[${e}] must be the same as the rank of the rest (${n})`))})),hz(e>=0&&e<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));const r=t[0];t.forEach(((t,s)=>{for(let o=0;o<n;o++)hz(o===e||t[o]===r[o],(()=>`Error in concat${n}D: Shape of tensors[${s}] (${t}) does not match the shape of the rest (${r}) along the non-concatenated axis ${s}.`))}))},computeOutShape:function(t,e){const n=t[0].slice();for(let r=1;r<t.length;r++)n[e]+=t[r][e];return n}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,computeDilation2DInfo:function(t,e,n,r,s="NHWC",o){return yH(t,[...e,t[3]],n,o,r,null,null,SH(s))},computePool2DInfo:mH,computePool3DInfo:function(t,e,n,r,s,o,i="NDHWC"){const[a,u,c]=vH(e);let l,f;if("NDHWC"===i)f="channelsLast",l=[a,u,c,t[4],t[4]];else{if("NCDHW"!==i)throw new Error(`Unknown dataFormat ${i}`);f="channelsFirst",l=[a,u,c,t[1],t[1]]}return gH(t,l,n,r,s,!1,f,o)},computeConv2DInfo:yH,computeConv3DInfo:gH,computeDefaultPad:bH,tupleValuesAreOne:$H,eitherStridesOrDilationsAreOne:EH,convertConv2DDataFormat:SH,checkPadOnDimRoundingMode:_H,getFusedDyActivation:sY,getFusedBiasGradient:oY,applyActivation:iY,shouldFuse:aY,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:function(t){return t<=30?t:Rz(t,Math.floor(Math.sqrt(t)))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getImageCenter:function(t,e,n){return[n*("number"==typeof t?t:t[0]),e*("number"==typeof t?t:t[1])]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getReshaped:function(t,e,n,r=!0){let s=[];if(r)s=s.concat(e.slice(0)),s.push(t[0]/n),s=s.concat(t.slice(1));else{s=s.concat(t[0]);const n=e.length;for(let r=0;r<n;++r)s=s.concat([t[r+1]/e[r],e[r]]);s=s.concat(t.slice(n+1))}return s},getPermuted:function(t,e,n=!0){const r=[];if(n){r.push(e);for(let n=e+1;n<t;++n)n<=2*e?(r.push(n),r.push(n-(e+1))):r.push(n)}else{const n=[],s=[];for(let r=1;r<t;++r)r>=2*e+1||r%2==1?s.push(r):n.push(r);r.push(...n),r.push(0),r.push(...s)}return r},getReshapedPermuted:function(t,e,n,r=!0){const s=[];r?s.push(t[0]/n):s.push(t[0]*n);for(let n=1;n<t.length;++n)n<=e.length?r?s.push(e[n-1]*t[n]):s.push(t[n]/e[n-1]):s.push(t[n]);return s},getSliceBeginCoords:function(t,e){const n=[0];for(let r=0;r<e;++r)n.push(t[r][0]);return n},getSliceSize:function(t,e,n){const r=t.slice(0,1);for(let s=0;s<n;++s)r.push(t[s+1]-e[s][0]-e[s][1]);return r}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,prepareAndValidate:kq,validateUpdateShape:Cq,validateInput:Oq,calculateShapes:Iq,SELU_SCALEALPHA:1.7580993408473768,SELU_SCALE:1.0507009873554805,ERF_P:.3275911,ERF_A1:.254829592,ERF_A2:-.284496736,ERF_A3:1.421413741,ERF_A4:-1.453152027,ERF_A5:1.061405429,warn:xW,log:function(...t){jz().getBool("IS_TEST")||jz().getBool("PROD")||console.log(...t)},mergeRealAndImagArrays:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(2*t.length);for(let r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n},splitRealAndImagArrays:function(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}},complexWithEvenIndex:function(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=0;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}},complexWithOddIndex:function(t){const e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=2;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}},getComplexWithIndex:function(t,e){return{real:t[2*e],imag:t[2*e+1]}},assignToTypedArray:function(t,e,n,r){t[2*r]=e,t[2*r+1]=n},exponents:function(t,e){const n=new Float32Array(t/2),r=new Float32Array(t/2);for(let s=0;s<Math.ceil(t/2);s++){const o=(e?2:-2)*Math.PI*(s/t);n[s]=Math.cos(o),r[s]=Math.sin(o)}return{real:n,imag:r}},exponent:function(t,e,n){const r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}},decodeEinsumEquation:function(t,e){const n=((t=t.replace(/\s/g,"")).length-t.replace(TZ,"").length)/"->".length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("->").');const[r,s]=t.split("->");hz(-1===r.indexOf("..."),(()=>'The ellipsis notation ("...") is not supported yet.'));const o=r.split(","),i=o.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let t=0;t<s.length;++t){const e=s[t];if(!o.some((t=>-1!==t.indexOf(e))))throw new Error(`Output subscripts contain the label ${e} not present in the input subscripts.`);-1===a.indexOf(e)&&a.push(e)}for(let t=0;t<r.length;++t){const e=r[t];-1===a.indexOf(e)&&","!==e&&a.push(e)}const u=new Array(o.length);for(let t=0;t<i;++t){if(new Set(o[t].split("")).size!==o[t].length)throw new Error(`Found duplicate axes in input component ${o[t]}. Support for duplicate axes in input is not implemented yet.`);u[t]=[];for(let e=0;e<o[t].length;++e)u[t].push(a.indexOf(o[t][e]))}const c=a.length,l=[];for(let t=s.length;t<c;++t)l.push(t);return{allDims:a,summedDims:l,idDims:u}},getEinsumPermutation:function(t,e){let n=new Array(t);n.fill(-1);for(let t=0;t<e.length;++t)n[e[t]]=t;const r=[];for(let e=0;e<t;++e)-1===n[e]&&r.push(e);return n=n.filter((t=>-1!==t)),{permutationIndices:n,expandDims:r}},checkEinsumDimSizes:function(t,e,n){const r=new Array(t);for(let t=0;t<n.length;++t){const s=n[t].shape;for(let n=0;n<e[t].length;++n)void 0===r[e[t][n]]?r[e[t][n]]=s[n]:hz(r[e[t][n]]===s[n],(()=>`Expected dimension ${r[e[t][n]]} at axis ${n} of input shaped ${JSON.stringify(s)}, but got dimension ${s[n]}`))}},getEinsumComputePath:function(t,e){const n=t,r=[];let s=0;0===t.length&&n.push(-1),s=t.length+1;for(let t=0;t<s;++t)r.push([]);const o=[];for(let t=0;t<n.length;++t){const s=kZ(e,n[t]);for(const e of s)-1===o.indexOf(e)&&(r[t].push(e),o.push(e))}return{path:n,steps:r}},isIdentityPermutation:function(t){return t.every(((t,e)=>t===e))},prepareSplitSize:function(t,e,n=0){let r=[];if("number"==typeof e)hz(t.shape[n]%e==0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(e).fill(t.shape[n]/e);else{hz(e.reduce(((t,e)=>(-1===e&&(t+=1),t)),0)<=1,(()=>"There should be only one negative value in split array."));const s=e.indexOf(-1);if(-1!==s){const r=e.reduce(((t,e)=>e>0?t+e:t));e[s]=t.shape[n]-r}hz(t.shape[n]===e.reduce(((t,e)=>t+e)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=e}return r}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getSparseFillEmptyRowsIndicesDenseShapeMismatch:function(t){return`Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ${t}`},getSparseFillEmptyRowsNegativeIndexErrorMessage:function(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`},getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:function(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:function(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`},getSparseReshapeNegativeOutputDimErrorMessage:function(t,e){return`size ${t} must be non-negative, not ${e}`},getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:function(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"},getSparseReshapeInputOutputMultipleErrorMessage:function(t,e){return`Input to reshape is a SparseTensor with ${yz(t)}\n  dense values, but the requested shape requires a multiple of ${yz(e)}. inputShape=${t} outputShape= ${e}`},getSparseReshapeInputOutputMismatchErrorMessage:function(t,e){return`Input to reshape is a tensor with ${yz(t)} dense values, but the requested shape has ${yz(e)}. inputShape=${t} outputShape=${e}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:function(){return"segment ids must be >= 0"},getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:function(){return"segment ids are not increasing"},getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:function(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`},getSparseSegmentReductionIndicesOutOfRangeErrorMessage:function(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}}),OZ=Object.freeze({__proto__:null,nonMaxSuppressionV3Impl:_Y,nonMaxSuppressionV4Impl:TY,nonMaxSuppressionV5Impl:kY,whereImpl:qJ}),IZ=Object.freeze({__proto__:null,AdadeltaOptimizer:gZ,AdagradOptimizer:bZ,AdamOptimizer:wZ,AdamaxOptimizer:vZ,MomentumOptimizer:NZ,Optimizer:yZ,OptimizerConstructors:EZ,RMSPropOptimizer:$Z,SGDOptimizer:xZ,Tensor:kU,TensorBuffer:SU,Variable:AU,get Rank(){return CU},sumOutType:function(t){return FU(t,"int32")},upcastType:FU,get Reduction(){return qY},customGrad:QK,grad:function(t){return hz(Mz(t),(()=>"The f passed in grad(f) must be a function")),(e,n)=>{const r=Yj(e,"x","tf.grad","string_or_numeric"),s=null!=n?Yj(n,"dy","tf.grad"):null;return qU.tidy((()=>{const{value:e,grads:n}=qU.gradients((()=>t(r)),[r],s);return null!=s&&pz(e.shape,s.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),tX(n),n[0]}))}},grads:function(t){return hz(Mz(t),(()=>"The f passed in grads(f) must be a function")),(e,n)=>{hz(Array.isArray(e),(()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"));const r=Zj(e,"args","tf.grads","string_or_numeric"),s=null!=n?Yj(n,"dy","tf.grads"):null;return qU.tidy((()=>{const{value:e,grads:n}=qU.gradients((()=>t(...r)),r,s);return null!=s&&pz(e.shape,s.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),tX(n),n}))}},valueAndGrad:function(t){return hz(Mz(t),(()=>"The f passed in valueAndGrad(f) must be a function")),(e,n)=>{hz(e instanceof kU,(()=>"The x passed in valueAndGrad(f)(x) must be a tensor")),hz(null==n||n instanceof kU,(()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"));const{grads:r,value:s}=qU.gradients((()=>t(e)),[e],n);return tX(r),{grad:r[0],value:s}}},valueAndGrads:function(t){return hz(Mz(t),(()=>"The f passed in valueAndGrads(f) must be a function")),(e,n)=>{hz(Array.isArray(e)&&e.every((t=>t instanceof kU)),(()=>"The args passed in valueAndGrads(f)(args) must be array of tensors")),hz(null==n||n instanceof kU,(()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"));const r=qU.gradients((()=>t(...e)),e,n);return null!=n&&pz(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),tX(r.grads),r}},variableGrads:ZK,Environment:Wz,env:jz,get ENV(){return Gz},nextFrame:function(){return new Promise((t=>_Z((()=>t()))))},KernelBackend:az,DataStorage:class{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}},abs:nH,acos:rH,acosh:sH,add:Zq,addN:oH,all:iH,any:aH,argMax:uH,argMin:cH,asin:lH,asinh:fH,atan:hH,atan2:pH,atanh:dH,avgPool:kH,avgPool3d:AH,basicLSTMCell:RH,batchToSpaceND:DH,batchNorm:FH,batchNorm2d:LH,batchNorm3d:PH,batchNorm4d:BH,bincount:VH,broadcastArgs:zH,broadcastTo:WH,buffer:zG,cast:WG,ceil:UH,clipByValue:jH,clone:UG,complex:tG,concat:CH,concat1d:GH,concat2d:qH,concat3d:HH,concat4d:KH,conv1d:JH,conv2d:XH,conv2dTranspose:ZH,conv3d:QH,conv3dTranspose:eK,cos:nK,cosh:rK,cumprod:sK,cumsum:oK,denseBincount:iK,depthToSpace:aK,depthwiseConv2d:uK,diag:cK,dilation2d:lK,div:tH,divNoNan:dK,dot:mK,einsum:yK,elu:gK,equal:fK,erf:bK,euclideanNorm:OK,exp:IK,expandDims:MK,expm1:RK,eye:FK,fill:LK,floor:PK,floorDiv:Qq,gather:BK,greater:VK,greaterEqual:zK,imag:hq,isFinite:WK,isInf:UK,isNaN:jK,leakyRelu:GK,less:qK,lessEqual:HK,linspace:KK,localResponseNormalization:XK,log:JK,log1p:YK,logSigmoid:nX,logSoftmax:sX,logSumExp:oX,logicalAnd:iX,logicalNot:aX,logicalOr:uX,logicalXor:cX,lowerBound:fX,matMul:aq,max:NK,maxPool:hX,maxPool3d:pX,maxPoolWithArgmax:dX,maximum:mX,mean:yX,meshgrid:function(t,e,{indexing:n="xy"}={}){if("xy"!==n&&"ij"!==n)throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(void 0===t)return[];let r=Yj(t,"x","meshgrid",t instanceof kU?t.dtype:"float32");if(void 0===e)return[r];let s=Yj(e,"y","meshgrid",e instanceof kU?e.dtype:"float32");const o=yz(r.shape),i=yz(s.shape);return"xy"===n?(r=TH(r,[1,-1]),s=TH(s,[-1,1]),[aq(bX([i,1],r.dtype),r),aq(s,bX([1,o],s.dtype))]):(r=TH(r,[-1,1]),s=TH(s,[1,-1]),[aq(r,bX([1,i],r.dtype)),aq(bX([o,1],s.dtype),s)])},min:$K,minimum:wX,mirrorPad:vX,mod:xX,moments:NX,mul:eH,multiRNNCell:$X,multinomial:EX,neg:pq,notEqual:SX,oneHot:uq,ones:bX,onesLike:_X,outerProduct:TX,pad:kX,pad1d:AX,pad2d:CX,pad3d:OX,pad4d:IX,pool:RX,pow:EK,prelu:DX,print:jG,prod:FX,rand:LX,randomGamma:nJ,randomNormal:rJ,randomUniform:sJ,range:oJ,real:dq,reciprocal:iJ,relu:aJ,relu6:uJ,reshape:TH,reverse:cJ,reverse1d:lJ,reverse2d:fJ,reverse3d:hJ,reverse4d:pJ,round:dJ,rsqrt:mJ,scalar:SK,selu:yJ,separableConv2d:gJ,setdiff1dAsync:bJ,sigmoid:OH,sign:wJ,sin:vJ,sinh:xJ,slice:IH,slice1d:NJ,slice2d:$J,slice3d:EJ,slice4d:SJ,softmax:_J,softplus:eX,spaceToBatchND:MX,fft:TJ,ifft:kJ,irfft:AJ,rfft:OJ,split:CJ,sqrt:_K,square:TK,squaredDifference:IJ,squeeze:MJ,stack:RJ,step:DJ,stridedSlice:FJ,sub:rX,sum:kK,tan:LJ,tanh:MH,tensor:nG,tensor1d:PJ,tensor2d:BJ,tensor3d:Nq,tensor4d:function(t,e,n){if(dz(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");const r=Kj(t,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return eG(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,tensor5d:function(t,e,n){if(dz(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");const r=Kj(t,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return eG(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,tensor6d:function(t,e,n){if(dz(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");const r=Kj(t,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return eG(t,e=e||r,r,n)},tile:DK,topk:VJ,truncatedNormal:zJ,unique:WJ,unsortedSegmentSum:UJ,unstack:jJ,upperBound:GJ,variable:function(t,e=!0,n,r){return qU.makeVariable(t,e,n,r)},where:hK,whereAsync:HJ,zeros:gX,zerosLike:pK,op:Qj,OP_SCOPE_SUFFIX:"__op",booleanMaskAsync:KJ,transpose:mq,norm:CK,movingAverage:XJ,scatterND:JJ,searchSorted:lX,sparseToDense:YJ,gatherND:ZJ,dropout:QJ,enclosingPowerOfTwo:tY,cosineWindow:eY,inTopKAsync:nY,image:fZ,linalg:hZ,losses:pZ,spectral:cZ,fused:pY,signal:lZ,sparse:dZ,string:mZ,train:SZ,enableProdMode:function(){jz().set("PROD",!0)},enableDebugMode:function(){jz().set("DEBUG",!0)},disableDeprecationWarnings:function(){jz().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},deprecationWarn:function(t){jz().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")},disposeVariables:function(){qU.disposeVariables()},engine:function(){return qU},memory:function(){return qU.memory()},profile:function(t){return qU.profile(t)},tidy:cq,dispose:lq,keep:fq,time:function(t){return qU.time(t)},setBackend:function(t){return qU.setBackend(t)},ready:function(){return qU.ready()},getBackend:function(){return qU.backendName},removeBackend:function(t){qU.removeBackend(t)},findBackend:function(t){return qU.findBackend(t)},findBackendFactory:function(t){return qU.findBackendFactory(t)},registerBackend:function(t,e,n=1){return qU.registerBackend(t,e,n)},backend:function(){return qU.backend},setPlatform:function(t,e){jz().setPlatform(t,e)},getKernel:EW,getGradient:SW,getKernelsForBackend:_W,registerKernel:TW,registerGradient:function(t){const{kernelName:e}=t;$W.has(e)&&jz().getBool("DEBUG")&&xW(`Overriding the gradient for '${e}'`),$W.set(e,t)},unregisterKernel:function(t,e){const n=kW(t,e);if(!NW.has(n))throw new Error(`The kernel '${t}' for backend '${e}' is not registered`);NW.delete(n)},unregisterGradient:function(t){if(!$W.has(t))throw new Error(`The gradient '${t}' for backend is not registered`);$W.delete(t)},copyRegisteredKernels:function(t,e){_W(t).forEach((t=>{TW(Object.assign({},t,{backendName:e}))}))},Abs:"Abs",Acos:"Acos",Acosh:"Acosh",Add:"Add",AddN:"AddN",All:"All",Any:"Any",ArgMax:"ArgMax",ArgMin:"ArgMin",Asin:"Asin",Asinh:"Asinh",Atan:"Atan",Atanh:"Atanh",Atan2:"Atan2",AvgPool:"AvgPool",AvgPoolGrad:"AvgPoolGrad",AvgPool3D:"AvgPool3D",AvgPool3DGrad:"AvgPool3DGrad",BatchMatMul:"BatchMatMul",BatchToSpaceND:"BatchToSpaceND",Bincount:"Bincount",BroadcastTo:"BroadcastTo",BroadcastArgs:"BroadcastArgs",Cast:"Cast",Ceil:"Ceil",ClipByValue:"ClipByValue",Complex:"Complex",ComplexAbs:"ComplexAbs",Concat:"Concat",Conv2D:"Conv2D",Conv2DBackpropFilter:"Conv2DBackpropFilter",Conv2DBackpropInput:"Conv2DBackpropInput",Conv3D:"Conv3D",Conv3DBackpropFilterV2:"Conv3DBackpropFilterV2",Conv3DBackpropInputV2:"Conv3DBackpropInputV2",Cos:"Cos",Cosh:"Cosh",Cumprod:"Cumprod",Cumsum:"Cumsum",CropAndResize:"CropAndResize",DenseBincount:"DenseBincount",DepthToSpace:"DepthToSpace",DepthwiseConv2dNative:"DepthwiseConv2dNative",DepthwiseConv2dNativeBackpropFilter:"DepthwiseConv2dNativeBackpropFilter",DepthwiseConv2dNativeBackpropInput:"DepthwiseConv2dNativeBackpropInput",Diag:"Diag",Dilation2D:"Dilation2D",Dilation2DBackpropInput:"Dilation2DBackpropInput",Dilation2DBackpropFilter:"Dilation2DBackpropFilter",RealDiv:"RealDiv",Einsum:"Einsum",Elu:"Elu",EluGrad:"EluGrad",Erf:"Erf",Equal:"Equal",Exp:"Exp",ExpandDims:"ExpandDims",Expm1:"Expm1",FFT:"FFT",Fill:"Fill",FlipLeftRight:"FlipLeftRight",Floor:"Floor",FloorDiv:"FloorDiv",FusedBatchNorm:"FusedBatchNorm",GatherV2:"GatherV2",GatherNd:"GatherNd",Greater:"Greater",GreaterEqual:"GreaterEqual",Identity:"Identity",IFFT:"IFFT",Imag:"Imag",IsFinite:"IsFinite",IsInf:"IsInf",IsNan:"IsNan",LeakyRelu:"LeakyRelu",Less:"Less",LessEqual:"LessEqual",LinSpace:"LinSpace",Log:"Log",Log1p:"Log1p",LogicalAnd:"LogicalAnd",LogicalNot:"LogicalNot",LogicalOr:"LogicalOr",LogSoftmax:"LogSoftmax",LowerBound:"LowerBound",LRN:"LRN",LRNGrad:"LRNGrad",Max:"Max",Maximum:"Maximum",MaxPool:"MaxPool",MaxPoolGrad:"MaxPoolGrad",MaxPool3D:"MaxPool3D",MaxPool3DGrad:"MaxPool3DGrad",MaxPoolWithArgmax:"MaxPoolWithArgmax",Mean:"Mean",Min:"Min",Minimum:"Minimum",MirrorPad:"MirrorPad",Mod:"Mod",Multinomial:"Multinomial",Multiply:"Multiply",Neg:"Neg",NotEqual:"NotEqual",NonMaxSuppressionV3:"NonMaxSuppressionV3",NonMaxSuppressionV4:"NonMaxSuppressionV4",NonMaxSuppressionV5:"NonMaxSuppressionV5",OnesLike:"OnesLike",OneHot:"OneHot",Pack:"Pack",PadV2:"PadV2",Pool:"Pool",Pow:"Pow",Prelu:"Prelu",Prod:"Prod",Range:"Range",Real:"Real",Reciprocal:"Reciprocal",Relu:"Relu",Reshape:"Reshape",ResizeNearestNeighbor:"ResizeNearestNeighbor",ResizeNearestNeighborGrad:"ResizeNearestNeighborGrad",ResizeBilinear:"ResizeBilinear",ResizeBilinearGrad:"ResizeBilinearGrad",Relu6:"Relu6",Reverse:"Reverse",Round:"Round",Rsqrt:"Rsqrt",ScatterNd:"ScatterNd",SearchSorted:"SearchSorted",Select:"Select",Selu:"Selu",Slice:"Slice",Sin:"Sin",Sinh:"Sinh",Sign:"Sign",Sigmoid:"Sigmoid",Softplus:"Softplus",Sqrt:"Sqrt",Sum:"Sum",SpaceToBatchND:"SpaceToBatchND",SplitV:"SplitV",Softmax:"Softmax",SparseFillEmptyRows:"SparseFillEmptyRows",SparseReshape:"SparseReshape",SparseSegmentMean:"SparseSegmentMean",SparseSegmentSum:"SparseSegmentSum",SparseToDense:"SparseToDense",SquaredDifference:"SquaredDifference",Square:"Square",StridedSlice:"StridedSlice",StringNGrams:"StringNGrams",StringSplit:"StringSplit",StringToHashBucketFast:"StringToHashBucketFast",Sub:"Sub",Tan:"Tan",Tanh:"Tanh",Tile:"Tile",TopK:"TopK",Transform:"Transform",Transpose:"Transpose",Unique:"Unique",Unpack:"Unpack",UnsortedSegmentSum:"UnsortedSegmentSum",UpperBound:"UpperBound",ZerosLike:"ZerosLike",Step:"Step",FromPixels:"FromPixels",RotateWithOffset:"RotateWithOffset",_FusedMatMul:"_FusedMatMul",FusedConv2D:"FusedConv2D",FusedDepthwiseConv2D:"FusedDepthwiseConv2D",version_core:"3.18.0",browser:Tq,io:iq,math:gq,serialization:Hq,test_util:Yq,util:yU,backend_util:CZ,broadcast_util:xq,tensor_util:zU,slice_util:Uq,gather_util:Aq,scatter_util:Mq,device_util:JU,kernel_impls:OZ});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
var MZ,RZ;jz().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"}(MZ||(MZ={})),function(t){var e;(e=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(RZ||(RZ={}));
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const DZ={};function FZ(t){return DZ[t]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function LZ(t,e,n,r,s){const o=e.inputParams[t];if(o&&void 0!==o.inputIndexStart){const t=o.inputIndexStart,i=0===o.inputIndexEnd?void 0:void 0===o.inputIndexEnd?t+1:o.inputIndexEnd;if("tensor"===o.type)return PZ(e.inputNames[o.inputIndexStart],n,r,s);if("tensors"===o.type){return e.inputNames.slice(t,i).map((t=>PZ(t,n,r,s)))}const a=PZ(e.inputNames.slice(t)[0],n,r,s),u=a.dataSync();return"number"===o.type?u[0]:Lz(a.shape,u)}const i=e.attrParams[t];return i&&i.value}function PZ(t,e,n,r){const[s,o]=zZ(t);if(null!=r){const t=r.getHashTableHandleByName(s);if(null!=t)return t}const i=n.currentContextIds.find((t=>!!e[VZ(s,t)]));return void 0!==i?e[VZ(s,i)][o]:void 0}function BZ(t,e){const[n,r,s]=zZ(t);return[VZ(n,e&&e.currentContextId),r,s]}function VZ(t,e){return e?`${t}-${e}`:t}function zZ(t){const e=t.split(":");if(1===e.length)return[t,0,void 0];const n=e[0],r=3===e.length?e[1]:void 0;return[n,Number(e[e.length-1]),r]}function WZ(t,e,n){let r=LZ("pad",t,e,n);if("explicit"===r){r=LZ("explicitPaddings",t,e,n);const s=[[0,0],[0,0],[0,0],[0,0]];for(let t=0;t<4;t++)s[t][0]=r[2*t],s[t][1]=r[2*t+1];return s}return r}function UZ(t){return t.kept?t:UG(t)}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var jZ=Object.freeze({__proto__:null,json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var GZ=Object.freeze({__proto__:null,json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var qZ=Object.freeze({__proto__:null,json:[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var HZ=Object.freeze({__proto__:null,json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var KZ=Object.freeze({__proto__:null,json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var XZ=Object.freeze({__proto__:null,json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var JZ=Object.freeze({__proto__:null,json:[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var YZ=Object.freeze({__proto__:null,json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ZZ=Object.freeze({__proto__:null,json:[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var QZ=Object.freeze({__proto__:null,json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var tQ=Object.freeze({__proto__:null,json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var eQ=Object.freeze({__proto__:null,json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var nQ=Object.freeze({__proto__:null,json:[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var rQ=Object.freeze({__proto__:null,json:[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var sQ=Object.freeze({__proto__:null,json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var oQ=Object.freeze({__proto__:null,json:[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var iQ=Object.freeze({__proto__:null,json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var aQ=Object.freeze({__proto__:null,json:[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var uQ=Object.freeze({__proto__:null,json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}]});class cQ{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const t=[].concat(...[jZ,GZ,qZ,HZ,KZ,XZ,JZ,YZ,ZZ,QZ,tQ,eQ,nQ,rQ,sQ,oQ,iQ,aQ,uQ].map((t=>t.json)));this.opMappers=t.reduce(((t,e)=>(t[e.tfOpName]=e,t)),{})}transformGraph(t,e={}){const n=t.node,r=[],s=[],o=[],i=n.reduce(((t,e)=>(t[e.name]=this.mapNode(e),e.op.startsWith("Placeholder")?r.push(t[e.name]):"Const"===e.op?s.push(t[e.name]):null!=e.input&&0!==e.input.length||o.push(t[e.name]),t)),{});let a=[];const u=[];let c={},l={};null!=e&&(c=this.mapSignatureEntries(e.inputs),l=this.mapSignatureEntries(e.outputs));const f=Object.keys(i);f.forEach((t=>{const e=i[t];e.inputNames.forEach(((t,n)=>{const[r,,s]=BZ(t),o=i[r];if(null!=o.outputs){const t=o.outputs.indexOf(s);if(-1!==t){const s=`${r}:${t}`;e.inputNames[n]=s}}e.inputs.push(o),o.children.push(e)}))})),0===Object.keys(l).length?f.forEach((t=>{const e=i[t];0===e.children.length&&u.push(e)})):Object.keys(l).forEach((t=>{const[e]=BZ(t),n=i[e];null!=n&&(n.signatureKey=l[t],u.push(n))})),Object.keys(c).length>0?Object.keys(c).forEach((t=>{const[e]=BZ(t),n=i[e];n&&(n.signatureKey=c[t],a.push(n))})):a=r;let h={};null!=t.library&&null!=t.library.function&&(h=t.library.function.reduce(((t,e)=>(t[e.signature.name]=this.mapFunction(e),t)),{}));const p={nodes:i,inputs:a,outputs:u,weights:s,placeholders:r,signature:e,functions:h};return o.length>0&&(p.initNodes=o),p}mapSignatureEntries(t){return Object.keys(t||{}).reduce(((e,n)=>(e[t[n].name]=n,e)),{})}mapNode(t){const e=FZ(t.op)||this.opMappers[t.op]||{};null==t.attr&&(t.attr={});const n={name:t.name,op:t.op,category:e.category,inputNames:(t.input||[]).map((t=>t.startsWith("^")?t.slice(1):t)),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr,outputs:e.outputs};return null!=e.inputs&&(n.inputParams=e.inputs.reduce(((t,e)=>(t[e.name]={type:e.type,inputIndexStart:e.start,inputIndexEnd:e.end},t)),{})),null!=e.attrs&&(n.attrParams=e.attrs.reduce(((e,n)=>{const r=n.type;let s;switch(n.type){case"string":s=fQ(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=fQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":s=xQ(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=xQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":s=pQ(t.attr,n.tfName,n.defaultValue||0),void 0===s&&n.tfDeprecatedName&&(s=pQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":s=vQ(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=vQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":s=hQ(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=hQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":s=$Q(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=$Q(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":s=wQ(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=wQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":s=NQ(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=NQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":s=yQ(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=yQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":s=gQ(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=gQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":s=mQ(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=mQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${n.type} for op: ${t.op}`)}return e[n.name]={value:s,type:r},e}),{})),n}mapFunction(t){const e=t.nodeDef,n=[];let r={};null!=e&&(r=e.reduce(((t,e)=>(t[e.name]=this.mapNode(e),"Const"===e.op&&n.push(t[e.name]),t)),{}));const s=[],o=[];t.signature.inputArg.forEach((t=>{const[e]=BZ(t.name),n={name:e,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:dQ(t.type),type:"dtype"}},children:[]};n.signatureKey=t.name,s.push(n),r[e]=n}));Object.keys(r).forEach((t=>{const e=r[t];e.inputNames.forEach(((t,n)=>{const[s,,o]=BZ(t),i=r[s];if(null!=i.outputs){const t=i.outputs.indexOf(o);if(-1!==t){const r=`${s}:${t}`;e.inputNames[n]=r}}e.inputs.push(i),i.children.push(e)}))}));const i=t.ret;t.signature.outputArg.forEach((t=>{const[e,n]=BZ(i[t.name]),s=r[e];null!=s&&(s.defaultOutput=n,o.push(s))}));const a=this.mapArgsToSignature(t);return{nodes:r,inputs:s,outputs:o,weights:n,placeholders:[],signature:a}}mapArgsToSignature(t){return{methodName:t.signature.name,inputs:t.signature.inputArg.reduce(((t,e)=>(t[e.name]=this.mapArgToTensorInfo(e),t)),{}),outputs:t.signature.outputArg.reduce(((e,n)=>(e[n.name]=this.mapArgToTensorInfo(n,t.ret),e)),{})}}mapArgToTensorInfo(t,e){let n=t.name;return null!=e&&(n=e[n]),{name:n,dtype:t.type}}}function lQ(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):function(t){const e=jz().global;return void 0!==e.atob?e.atob(t):new fj(t,"base64").toString()}(t);return e?n:n.toLowerCase()}function fQ(t,e,n,r=!1){const s=t[e];return null!=s?lQ(s.s,r):n}function hQ(t,e,n){const r=t[e];return r?r.b:n}function pQ(t,e,n){const r=t[e]||{},s=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof s?s:parseInt(s,10)}function dQ(t){switch("string"==typeof t&&(t=MZ[t]),t){case MZ.DT_FLOAT:case MZ.DT_HALF:return"float32";case MZ.DT_INT32:case MZ.DT_INT64:case MZ.DT_INT8:case MZ.DT_UINT8:return"int32";case MZ.DT_BOOL:return"bool";case MZ.DT_DOUBLE:return"float32";case MZ.DT_STRING:return"string";default:return null}}function mQ(t,e,n){const r=t[e];return r&&r.func?r.func.name:n}function yQ(t,e,n){const r=t[e];return r&&r.type?dQ(r.type):n}function gQ(t,e,n){const r=t[e];return r&&r.list&&r.list.type?r.list.type.map((t=>dQ(t))):n}function bQ(t){if(!t.unknownRank)return null!=t.dim?t.dim.map((t=>"number"==typeof t.size?t.size:parseInt(t.size,10))):[]}function wQ(t,e,n){const r=t[e];return r&&r.shape?bQ(r.shape):n}function vQ(t,e,n){const r=t[e];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((t=>"number"==typeof t?t:parseInt(t,10))):n}function xQ(t,e,n,r=!1){const s=t[e];return s&&s.list&&s.list.s?s.list.s.map((t=>lQ(t,r))):n}function NQ(t,e,n){const r=t[e];return r&&r.list&&r.list.shape?r.list.shape.map((t=>bQ(t))):n}function $Q(t,e,n){const r=t[e];return r&&r.list&&r.list.b?r.list.b:n}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EQ{constructor(t,e,n){this.node=t,this.tensorMap=e,this.context=n,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((t=>this.getInput(t))),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce(((t,e)=>(t[e]=this.getAttr(e),t)),{}))}getInput(t){return PZ(t,this.tensorMap,this.context)}getAttr(t,e){const n=this.node.rawAttrs[t];if(null!=n.tensor)return PZ(t,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return pQ(this.node.rawAttrs,t,e);if(null!=n.s)return fQ(this.node.rawAttrs,t,e);if(null!=n.b)return hQ(this.node.rawAttrs,t,e);if(null!=n.shape)return wQ(this.node.rawAttrs,t,e);if(null!=n.type)return yQ(this.node.rawAttrs,t,e);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return vQ(this.node.rawAttrs,t,e);if(null!=n.list.s)return xQ(this.node.rawAttrs,t,e);if(null!=n.list.shape)return NQ(this.node.rawAttrs,t,e);if(null!=n.list.b)return $Q(this.node.rawAttrs,t,e);if(null!=n.list.type)return gQ(this.node.rawAttrs,t,e)}return e}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function SQ(t,e,n=""){if("number"!=typeof t&&"number"!=typeof e){hz(t.length===e.length,(()=>n+` Shapes ${t} and ${e} must match`));for(let r=0;r<t.length;r++){const s=t[r],o=e[r];hz(s<0||o<0||s===o,(()=>n+` Shapes ${t} and ${e} must match`))}}}function _Q(t){return"number"!=typeof t&&!t.some((t=>t<0))}function TQ(t,e,n){let r=kQ(t,n);const s=!_Q(r);if(s&&0===e.length)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(s&&e.forEach((t=>{r=kQ(t.shape,r)})),!_Q(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function kQ(t,e){if("number"==typeof t)return e;if("number"==typeof e)return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let r=0;r<t.length;++r){const s=t[r],o=e[r];if(s>=0&&o>=0&&s!==o)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[r]=s>=0?s:o}return n}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AQ{constructor(t,e,n,r,s,o,i){this.name=t,this.dtype=e,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=s,this.dynamicSize=o,this.clearAfterRead=i,this.tensors=[],this.closed_=!1,this.idTensor=SK(0),fq(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.tensor.id)||e.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||t>=this.size())throw new Error(`Tried to read from index ${t}, but array size is: ${this.size()}`);const e=this.tensors[t];if(e.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${t} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor}readMany(t){return t.map((t=>this.read(t)))}write(t,e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error(`Tried to write to index ${t}, but array is not resizeable and size is: ${this.maxSize}`);const n=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t},\n          because the value dtype is ${e.dtype}, but TensorArray dtype is ${this.dtype}.`);if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=e.shape),SQ(this.elementShape,e.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${t}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been written.`);n.tensor=e,fq(e),n.written=!0,this.tensors[t]=n}writeMany(t,e){if(t.length!==e.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${t.length} is not the same as tensors size: ${e.length}.`);t.forEach(((t,n)=>this.write(t,e[n])))}gather(t,e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${e}`);if(t)t=t.slice(0,this.size());else{t=[];for(let e=0;e<this.size();e++)t.push(e)}if(0===t.length)return nG([],[0].concat(this.elementShape));const n=this.readMany(t);return SQ(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),RJ(n,0)}concat(t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${t}`);if(0===this.size())return nG([],[0].concat(this.elementShape));const e=[];for(let t=0;t<this.size();t++)e.push(t);const n=this.readMany(e);return SQ(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),CH(n,0)}scatter(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);const n=Math.max(...t);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(t,jJ(e,0))}split(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);let n=0;const r=t.map((t=>(n+=t,n)));if(n!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${n}, and tensor's shape is: ${e.shape}`);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${t.length}), and the TensorArray is not marked as dynamically resizeable`);const s=0===n?0:e.size/n,o=[];cq((()=>{e=TH(e,[1,n,s]);for(let n=0;n<t.length;++n){const i=[0,0===n?0:r[n-1],0],a=[1,t[n],s];o[n]=TH(IH(e,i,a),this.elementShape)}return o}));const i=[];for(let e=0;e<t.length;e++)i[e]=e;this.writeMany(i,o)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CQ{constructor(t,e,n,r=-1){this.tensors=t,this.elementShape=e,this.elementDtype=n,null!=t&&t.forEach((t=>{if(n!==t.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${t.dtype}`);SQ(e,t.shape,"TensorList shape mismatch: "),fq(t)})),this.idTensor=SK(0),this.maxNumElements=r,fq(this.idTensor)}get id(){return this.idTensor.id}copy(){return new CQ([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.id)||e.dispose()})),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,e,n=-1){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(-1!==n&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);SQ(t,this.elementShape,"TensorList shape mismatch: ");const r=TQ(this.elementShape,this.tensors,t);return cq((()=>{const t=this.tensors.map((t=>TH(t,r)));return RJ(t,0)}))}popBack(t,e){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=TQ(this.elementShape,this.tensors,t),r=this.tensors.pop();return SQ(r.shape,t,"TensorList shape mismatch: "),TH(r,n)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(SQ(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");fq(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);const e=new CQ([],this.elementShape,this.elementDtype,this.maxNumElements);e.tensors.length=t;for(let n=0;n<Math.min(this.tensors.length,t);++n)e.tensors[n]=this.tensors[n];return e}getItem(t,e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(null==this.tensors[t])throw new Error(`element at index ${t} is null.`);SQ(this.tensors[t].shape,e,"TensorList shape mismatch: ");const r=TQ(this.elementShape,this.tensors,e);return TH(this.tensors[t],r)}setItem(t,e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(t<0||-1!==this.maxNumElements&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);SQ(this.elementShape,e.shape,"TensorList shape mismatch: "),fq(e),this.tensors[t]=e}gather(t,e,n){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);SQ(this.elementShape,n,"TensorList shape mismatch: "),t=t.slice(0,this.size());const r=TQ(this.elementShape,this.tensors,n);return 0===t.length?nG([],[0].concat(r)):cq((()=>{const e=t.map((t=>TH(this.tensors[t],r)));return RJ(e,0)}))}concat(t,e){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);SQ(this.elementShape,e,"TensorList shape mismatch: ");const n=TQ(this.elementShape,this.tensors,e);return 0===this.size()?nG([],[0].concat(n)):cq((()=>{const t=this.tensors.map((t=>TH(t,n)));return CH(t,0)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const OQ=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const r=LZ("thenBranch",t,e,n),s=LZ("elseBranch",t,e,n),o=LZ("cond",t,e,n),i=LZ("args",t,e,n);return(await o.data())[0]?n.functionMap[r].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap):n.functionMap[s].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=LZ("body",t,e,n),s=LZ("cond",t,e,n),o=LZ("args",t,e,n),i=await n.functionMap[s].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap),a=o.map((t=>t.id));let u=await i[0].data();i.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||t.dispose()}));let c=o;for(;u[0];){const t=c;c=await n.functionMap[r].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);const e=c.map((t=>t.id));t.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}));const o=await n.functionMap[s].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);u=await o[0].data(),o.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}))}return c}case"LoopCond":return[UZ(LZ("pred",t,e,n))];case"Switch":{const r=LZ("pred",t,e,n);let s=LZ("data",t,e,n);return s.kept||(s=UZ(s)),(await r.data())[0]?[void 0,s]:[s,void 0]}case"Merge":{const r=t.inputNames.find((t=>void 0!==PZ(t,e,n)));if(r){return[UZ(PZ(r,e,n))]}return}case"Enter":{const r=LZ("frameName",t,e,n),s=LZ("tensor",t,e,n);return n.enterFrame(r),[UZ(s)]}case"Exit":{const r=LZ("tensor",t,e,n);return n.exitFrame(),[UZ(r)]}case"NextIteration":{const r=LZ("tensor",t,e,n);return n.nextIteration(),[UZ(r)]}case"TensorArrayV3":{const r=LZ("size",t,e,n),s=LZ("dtype",t,e,n),o=LZ("elementShape",t,e,n),i=LZ("dynamicSize",t,e,n),a=LZ("clearAfterRead",t,e,n),u=LZ("identicalElementShapes",t,e,n),c=LZ("name",t,e,n),l=new AQ(c,s,r,o,u,i,a);return n.addTensorArray(l),[l.idTensor,SK(1)]}case"TensorArrayWriteV3":{const r=LZ("tensorArrayId",t,e,n),s=LZ("index",t,e,n),o=LZ("tensor",t,e,n),i=n.getTensorArray(r.id);return i.write(s,o),[i.idTensor]}case"TensorArrayReadV3":{const r=LZ("tensorArrayId",t,e,n),s=LZ("index",t,e,n);return[n.getTensorArray(r.id).read(s)]}case"TensorArrayGatherV3":{const r=LZ("tensorArrayId",t,e,n),s=LZ("indices",t,e,n),o=LZ("dtype",t,e,n);return[n.getTensorArray(r.id).gather(s,o)]}case"TensorArrayScatterV3":{const r=LZ("tensorArrayId",t,e,n),s=LZ("indices",t,e,n),o=LZ("tensor",t,e,n),i=n.getTensorArray(r.id);return i.scatter(s,o),[i.idTensor]}case"TensorArrayConcatV3":{const r=LZ("tensorArrayId",t,e,n),s=n.getTensorArray(r.id),o=LZ("dtype",t,e,n);return[s.concat(o)]}case"TensorArraySplitV3":{const r=LZ("tensorArrayId",t,e,n),s=LZ("tensor",t,e,n),o=LZ("lengths",t,e,n),i=n.getTensorArray(r.id);return i.split(o,s),[i.idTensor]}case"TensorArraySizeV3":{const r=LZ("tensorArrayId",t,e,n);return[SK(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{const r=LZ("tensorArrayId",t,e,n),s=n.getTensorArray(r.id);return s.clearAndClose(),[s.idTensor]}case"TensorListSetItem":{const r=LZ("tensorListId",t,e,n),s=LZ("index",t,e,n),o=LZ("tensor",t,e,n),i=n.getTensorList(r.id);return i.setItem(s,o),[i.idTensor]}case"TensorListGetItem":{const r=LZ("tensorListId",t,e,n),s=LZ("index",t,e,n),o=LZ("elementShape",t,e,n),i=LZ("elementDType",t,e,n);return[n.getTensorList(r.id).getItem(s,o,i)]}case"TensorListScatterV2":case"TensorListScatter":{const r=LZ("indices",t,e,n),s=function(t,e,n,r){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const s=Math.max(...e);if(null!=r&&-1!==r&&s>=r)throw new Error(`Max index must be < array size (${s}  vs. ${r})`);const o=new CQ([],n,t.dtype,r),i=jJ(t,0);return e.forEach(((t,e)=>{o.setItem(t,i[e])})),o}(LZ("tensor",t,e,n),r,LZ("elementShape",t,e,n),LZ("numElements",t,e,n));return n.addTensorList(s),[s.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=LZ("elementShape",t,e,n),s=LZ("elementDType",t,e,n);let o;o="TensorListReserve"===t.op?"numElements":"maxNumElements";const i=function(t,e,n){return new CQ([],t,e,n)}(r,s,LZ(o,t,e,n));return n.addTensorList(i),[i.idTensor]}case"TensorListGather":{const r=LZ("tensorListId",t,e,n),s=LZ("indices",t,e,n),o=LZ("elementShape",t,e,n),i=LZ("elementDType",t,e,n);return[n.getTensorList(r.id).gather(s,i,o)]}case"TensorListStack":{const r=LZ("tensorListId",t,e,n),s=LZ("elementShape",t,e,n),o=LZ("elementDType",t,e,n),i=LZ("numElements",t,e,n);return[n.getTensorList(r.id).stack(s,o,i)]}case"TensorListFromTensor":{const r=function(t,e,n){const r=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);SQ(t.shape.slice(1),e,"TensorList shape mismatch: ");const s=jJ(t);return new CQ(s,e,r)}(LZ("tensor",t,e,n),LZ("elementShape",t,e,n),LZ("elementDType",t,e,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const r=LZ("tensorListId",t,e,n),s=n.getTensorList(r.id),o=LZ("dtype",t,e,n),i=LZ("elementShape",t,e,n);return[s.concat(o,i)]}case"TensorListPushBack":{const r=LZ("tensorListId",t,e,n),s=LZ("tensor",t,e,n),o=n.getTensorList(r.id);return o.pushBack(s),[o.idTensor]}case"TensorListPopBack":{const r=LZ("tensorListId",t,e,n),s=LZ("elementShape",t,e,n),o=LZ("elementDType",t,e,n);return[n.getTensorList(r.id).popBack(s,o)]}case"TensorListSplit":{const r=LZ("tensor",t,e,n),s=LZ("elementShape",t,e,n),o=function(t,e,n){let r=0;const s=e.map((t=>(r+=t,r)));if(r!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${r}, and tensor's shape is: ${t.shape}`);const o=kQ(t.shape.slice(1),n),i=0===r?0:t.size/r,a=cq((()=>{const n=[];t=TH(t,[1,r,i]);for(let r=0;r<e.length;++r){const a=[0,0===r?0:s[r-1],0],u=[1,e[r],i];n[r]=TH(IH(t,a,u),o)}return t.dispose(),n})),u=new CQ([],n,t.dtype,e.length);for(let t=0;t<a.length;t++)u.setItem(t,a[t]);return u}(r,LZ("lengths",t,e,n),s);return n.addTensorList(o),[o.idTensor]}case"TensorListLength":{const r=LZ("tensorListId",t,e,n);return[SK(n.getTensorList(r.id).size(),"int32")]}case"TensorListResize":{const r=LZ("tensorListId",t,e,n),s=LZ("size",t,e,n),o=n.getTensorList(r.id).resize(s);return n.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IQ(t,e,n){const[r,s]=LZ("fusedOps",t,e,n),o="biasadd"===r,i=!o,a="prelu"===s,u="fusedbatchnorm"===r,c=LZ("numArgs",t,e,n);if(o){if(a&&2!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&o&&1!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(u)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const l=LZ("strides",t,e,n),f=WZ(t,e,n),h=LZ("dataFormat",t,e,n).toUpperCase(),p=LZ("dilations",t,e,n);let[d,m]=LZ("args",t,e,n);i&&(m=d,d=void 0);return{stride:l,pad:f,dataFormat:h,dilations:p,biasArg:d,preluArg:m,activationFunc:s,leakyreluAlpha:LZ("leakyreluAlpha",t,e,n)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function MQ(t,e,n){return{boxes:LZ("boxes",t,e,n),scores:LZ("scores",t,e,n),maxOutputSize:LZ("maxOutputSize",t,e,n),iouThreshold:LZ("iouThreshold",t,e,n),scoreThreshold:LZ("scoreThreshold",t,e,n),softNmsSigma:LZ("softNmsSigma",t,e,n)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class RQ{constructor(t,e){this.keyDType=t,this.valueDType=e,this.handle=SK(0),this.tensorMap=new Map,fq(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return SK(this.size(),"int32")}async import(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),cq((()=>{const t=jJ(e),r=n.length,s=t.length;hz(r===s,(()=>`The number of elements doesn't match, keys has ${r} elements, the values has ${s} elements.`));for(let e=0;e<r;e++){const r=n[e],s=t[e];fq(s),this.tensorMap.set(r,s)}return this.handle}))}async find(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return cq((()=>{const t=[];for(let r=0;r<n.length;r++){const s=n[r],o=this.findWithDefault(s,e);t.push(o)}return RJ(t)}))}findWithDefault(t,e){const n=this.tensorMap.get(t);return null!=n?n:e}checkKeyAndValueTensor(t,e){if(t.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${t.dtype}`);if(e.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${e.dtype}`)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function DQ(t,e,n,r){const s=((t,e,n)=>{switch(t.category){case"arithmetic":return cq((()=>((t,e,n)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[Zq(LZ("a",t,e,n),LZ("b",t,e,n))];case"AddN":return[oH(LZ("tensors",t,e,n))];case"FloorMod":case"Mod":return[xX(LZ("a",t,e,n),LZ("b",t,e,n))];case"Mul":return[eH(LZ("a",t,e,n),LZ("b",t,e,n))];case"RealDiv":case"Div":return[tH(LZ("a",t,e,n),LZ("b",t,e,n))];case"DivNoNan":return[dK(LZ("a",t,e,n),LZ("b",t,e,n))];case"FloorDiv":return[Qq(LZ("a",t,e,n),LZ("b",t,e,n))];case"Sub":return[rX(LZ("a",t,e,n),LZ("b",t,e,n))];case"Minimum":return[wX(LZ("a",t,e,n),LZ("b",t,e,n))];case"Maximum":return[mX(LZ("a",t,e,n),LZ("b",t,e,n))];case"Pow":return[EK(LZ("a",t,e,n),LZ("b",t,e,n))];case"SquaredDifference":return[IJ(LZ("a",t,e,n),LZ("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"basic_math":return cq((()=>((t,e,n)=>{switch(t.op){case"Abs":case"ComplexAbs":return[nH(LZ("x",t,e,n))];case"Acos":return[rH(LZ("x",t,e,n))];case"Acosh":return[sH(LZ("x",t,e,n))];case"Asin":return[lH(LZ("x",t,e,n))];case"Asinh":return[fH(LZ("x",t,e,n))];case"Atan":return[hH(LZ("x",t,e,n))];case"Atan2":return[pH(LZ("x",t,e,n),LZ("y",t,e,n))];case"Atanh":return[dH(LZ("x",t,e,n))];case"Ceil":return[UH(LZ("x",t,e,n))];case"Complex":return[tG(LZ("real",t,e,n),LZ("imag",t,e,n))];case"Cos":return[nK(LZ("x",t,e,n))];case"Cosh":return[rK(LZ("x",t,e,n))];case"Elu":return[gK(LZ("x",t,e,n))];case"Erf":return[bK(LZ("x",t,e,n))];case"Exp":return[IK(LZ("x",t,e,n))];case"Expm1":return[RK(LZ("x",t,e,n))];case"Floor":return[PK(LZ("x",t,e,n))];case"Log":return[JK(LZ("x",t,e,n))];case"Log1p":return[YK(LZ("x",t,e,n))];case"Imag":return[hq(LZ("x",t,e,n))];case"Neg":return[pq(LZ("x",t,e,n))];case"Reciprocal":return[iJ(LZ("x",t,e,n))];case"Real":return[dq(LZ("x",t,e,n))];case"Relu":return[aJ(LZ("x",t,e,n))];case"Round":return[dJ(LZ("x",t,e,n))];case"Selu":return[yJ(LZ("x",t,e,n))];case"Sigmoid":return[OH(LZ("x",t,e,n))];case"Sin":return[vJ(LZ("x",t,e,n))];case"Sign":return[wJ(LZ("x",t,e,n))];case"Sinh":return[xJ(LZ("x",t,e,n))];case"Softplus":return[eX(LZ("x",t,e,n))];case"Sqrt":return[_K(LZ("x",t,e,n))];case"Square":return[TK(LZ("x",t,e,n))];case"Tanh":return[MH(LZ("x",t,e,n))];case"Tan":return[LJ(LZ("x",t,e,n))];case"ClipByValue":return[jH(LZ("x",t,e,n),LZ("clipValueMin",t,e,n),LZ("clipValueMax",t,e,n))];case"Relu6":return[uJ(LZ("x",t,e,n))];case"Rsqrt":return[mJ(PZ(t.inputNames[0],e,n))];case"Prod":return[FX(LZ("x",t,e,n),LZ("axes",t,e,n))];case"LeakyRelu":return[GK(LZ("x",t,e,n),LZ("alpha",t,e,n))];case"Prelu":return[DX(LZ("x",t,e,n),LZ("alpha",t,e,n))];case"IsNan":return[jK(PZ(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"control":return OQ(t,e,n);case"convolution":return cq((()=>((t,e,n)=>{switch(t.op){case"Conv1D":{const r=LZ("stride",t,e,n),s=LZ("pad",t,e,n),o=LZ("dataFormat",t,e,n).toUpperCase(),i=LZ("dilation",t,e,n);return[JH(LZ("x",t,e,n),LZ("filter",t,e,n),r,s,o,i)]}case"Conv2D":{const r=LZ("strides",t,e,n),s=WZ(t,e,n),o=LZ("dataFormat",t,e,n).toUpperCase(),i=LZ("dilations",t,e,n);return[XH(LZ("x",t,e,n),LZ("filter",t,e,n),[r[1],r[2]],s,o,[i[1],i[2]])]}case"_FusedConv2D":{const{stride:r,pad:s,dataFormat:o,dilations:i,biasArg:a,preluArg:u,activationFunc:c,leakyreluAlpha:l}=IQ(t,e,n);return[uY({x:LZ("x",t,e,n),filter:LZ("filter",t,e,n),strides:[r[1],r[2]],pad:s,dataFormat:o,dilations:[i[1],i[2]],bias:a,activation:c,preluActivationWeights:u,leakyreluAlpha:l})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:s,dataFormat:o,dilations:i,biasArg:a,preluArg:u,activationFunc:c,leakyreluAlpha:l}=IQ(t,e,n);return[fY({x:LZ("x",t,e,n),filter:LZ("filter",t,e,n),strides:[r[1],r[2]],pad:s,dataFormat:o,dilations:[i[1],i[2]],bias:a,activation:c,preluActivationWeights:u,leakyreluAlpha:l})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=LZ("outputShape",t,e,n),s=LZ("strides",t,e,n),o=WZ(t,e,n);return[ZH(LZ("x",t,e,n),LZ("filter",t,e,n),r,[s[1],s[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=LZ("strides",t,e,n),s=WZ(t,e,n),o=LZ("dilations",t,e,n),i=LZ("dataFormat",t,e,n).toUpperCase();return[uK(LZ("input",t,e,n),LZ("filter",t,e,n),[r[1],r[2]],s,i,[o[1],o[2]])]}case"Conv3D":{const r=LZ("strides",t,e,n),s=LZ("pad",t,e,n),o=LZ("dataFormat",t,e,n).toUpperCase(),i=LZ("dilations",t,e,n);return[QH(LZ("x",t,e,n),LZ("filter",t,e,n),[r[1],r[2],r[3]],s,o,[i[1],i[2],i[3]])]}case"AvgPool":{const r=LZ("strides",t,e,n),s=LZ("pad",t,e,n),o=LZ("kernelSize",t,e,n);return[kH(LZ("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s)]}case"MaxPool":{const r=LZ("strides",t,e,n),s=LZ("pad",t,e,n),o=LZ("kernelSize",t,e,n);return[hX(LZ("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s)]}case"MaxPoolWithArgmax":{const r=LZ("strides",t,e,n),s=LZ("pad",t,e,n),o=LZ("kernelSize",t,e,n),i=LZ("includeBatchInIndex",t,e,n),{result:a,indexes:u}=dX(LZ("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s,i);return[a,u]}case"AvgPool3D":{const r=LZ("strides",t,e,n),s=LZ("pad",t,e,n),o=LZ("kernelSize",t,e,n);return[AH(LZ("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],s)]}case"MaxPool3D":{const r=LZ("strides",t,e,n),s=LZ("pad",t,e,n),o=LZ("kernelSize",t,e,n);return[pX(LZ("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],s)]}case"Dilation2D":{const r=LZ("strides",t,e,n),s=LZ("pad",t,e,n),o=LZ("dilations",t,e,n),i=r[1],a=r[2],u=o[1],c=o[2];return[lK(LZ("x",t,e,n),LZ("filter",t,e,n),[i,a],s,[u,c],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"creation":return cq((()=>((t,e,n)=>{switch(t.op){case"Fill":{const r=LZ("shape",t,e,n),s=LZ("dtype",t,e,n);return[LK(r,LZ("value",t,e,n),s)]}case"LinSpace":return[KK(LZ("start",t,e,n),LZ("stop",t,e,n),LZ("num",t,e,n))];case"Multinomial":{const r=LZ("logits",t,e,n),s=LZ("numSamples",t,e,n),o=LZ("seed",t,e,n);return[EX(r,s,o)]}case"OneHot":{const r=LZ("indices",t,e,n),s=LZ("depth",t,e,n),o=LZ("onValue",t,e,n),i=LZ("offValue",t,e,n);return[uq(r,s,o,i)]}case"Ones":return[bX(LZ("shape",t,e,n),LZ("dtype",t,e,n))];case"OnesLike":return[_X(LZ("x",t,e,n))];case"RandomUniform":return[sJ(LZ("shape",t,e,n),LZ("minval",t,e,n),LZ("maxval",t,e,n),LZ("dtype",t,e,n))];case"Range":return[oJ(LZ("start",t,e,n),LZ("stop",t,e,n),LZ("step",t,e,n),LZ("dtype",t,e,n))];case"TruncatedNormal":{const r=LZ("shape",t,e,n),s=LZ("mean",t,e,n),o=LZ("stdDev",t,e,n),i=LZ("seed",t,e,n);return[zJ(r,s,o,LZ("dtype",t,e,n),i)]}case"Zeros":return[gX(LZ("shape",t,e,n),LZ("dtype",t,e,n))];case"ZerosLike":return[pK(LZ("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"dynamic":return(async(t,e,n)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a,softNmsSigma:u}=MQ(t,e,n),c=await fZ.nonMaxSuppressionWithScoreAsync(r,s,o,i,a,u);return[c.selectedIndices,c.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a}=MQ(t,e,n),u=LZ("padToMaxOutputSize",t,e,n),c=await fZ.nonMaxSuppressionPaddedAsync(r,s,o,i,a,u);return[c.selectedIndices,c.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a}=MQ(t,e,n);return[await fZ.nonMaxSuppressionAsync(r,s,o,i,a)]}case"Where":{const r=WG(LZ("condition",t,e,n),"bool"),s=[await HJ(r)];return r.dispose(),s}case"ListDiff":return bJ(LZ("x",t,e,n),LZ("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n);case"evaluation":return cq((()=>((t,e,n)=>{switch(t.op){case"LowerBound":return[fX(LZ("sortedSequence",t,e,n),LZ("values",t,e,n))];case"TopKV2":{const r=LZ("x",t,e,n),s=LZ("k",t,e,n),o=LZ("sorted",t,e,n),i=VJ(r,s,o);return[i.values,i.indices]}case"UpperBound":return[GJ(LZ("sortedSequence",t,e,n),LZ("values",t,e,n))];case"Unique":{const r=LZ("x",t,e,n),s=WJ(r);return[s.values,s.indices]}case"UniqueV2":{const r=LZ("x",t,e,n),s=LZ("axis",t,e,n),o=WJ(r,s);return[o.values,o.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"image":return cq((()=>((t,e,n)=>{switch(t.op){case"ResizeBilinear":{const r=LZ("images",t,e,n),s=LZ("size",t,e,n),o=LZ("alignCorners",t,e,n),i=LZ("halfPixelCenters",t,e,n);return[fZ.resizeBilinear(r,[s[0],s[1]],o,i)]}case"ResizeNearestNeighbor":{const r=LZ("images",t,e,n),s=LZ("size",t,e,n),o=LZ("alignCorners",t,e,n),i=LZ("halfPixelCenters",t,e,n);return[fZ.resizeNearestNeighbor(r,[s[0],s[1]],o,i)]}case"CropAndResize":{const r=LZ("image",t,e,n),s=LZ("boxes",t,e,n),o=LZ("boxInd",t,e,n),i=LZ("cropSize",t,e,n),a=LZ("method",t,e,n),u=LZ("extrapolationValue",t,e,n);return[fZ.cropAndResize(r,s,o,i,a,u)]}case"ImageProjectiveTransformV3":{const r=LZ("images",t,e,n),s=LZ("transforms",t,e,n),o=LZ("outputShape",t,e,n),i=LZ("fillValue",t,e,n),a=LZ("interpolation",t,e,n),u=LZ("fillMode",t,e,n);return[fZ.transform(r,s,a.toLowerCase(),u.toLowerCase(),i,o)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"graph":return cq((()=>((t,e,n)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const r=LZ("default",t,e,n);return[PZ(t.name,e,n)||r];case"Placeholder":return[PZ(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[UZ(LZ("x",t,e,n))];case"IdentityN":return LZ("x",t,e,n).map((t=>UZ(t)));case"Shape":return[PJ(LZ("x",t,e,n).shape,"int32")];case"ShapeN":return LZ("x",t,e,n).map((t=>PJ(t.shape)));case"Size":return[SK(LZ("x",t,e,n).size,"int32")];case"Rank":return[SK(LZ("x",t,e,n).rank,"int32")];case"NoOp":return[SK(1)];case"Print":const s=LZ("x",t,e,n),o=LZ("data",t,e,n),i=LZ("message",t,e,n),a=LZ("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(i);for(let t=0;t<o.length;t++)console.log(Array.prototype.slice.call(o[t].dataSync()).slice(0,a));return[s];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"logical":return cq((()=>((t,e,n)=>{switch(t.op){case"Equal":return[fK(LZ("a",t,e,n),LZ("b",t,e,n))];case"NotEqual":return[SX(LZ("a",t,e,n),LZ("b",t,e,n))];case"Greater":return[VK(LZ("a",t,e,n),LZ("b",t,e,n))];case"GreaterEqual":return[zK(LZ("a",t,e,n),LZ("b",t,e,n))];case"Less":return[qK(LZ("a",t,e,n),LZ("b",t,e,n))];case"LessEqual":return[HK(LZ("a",t,e,n),LZ("b",t,e,n))];case"LogicalAnd":return[iX(LZ("a",t,e,n),LZ("b",t,e,n))];case"LogicalNot":return[aX(LZ("a",t,e,n))];case"LogicalOr":return[uX(LZ("a",t,e,n),LZ("b",t,e,n))];case"Select":case"SelectV2":return[hK(LZ("condition",t,e,n),LZ("a",t,e,n),LZ("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"matrices":return cq((()=>((t,e,n)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[aq(LZ("a",t,e,n),LZ("b",t,e,n),LZ("transposeA",t,e,n),LZ("transposeB",t,e,n))];case"Einsum":return[yK(LZ("equation",t,e,n),...LZ("tensors",t,e,n))];case"Transpose":return[mq(LZ("x",t,e,n),LZ("perm",t,e,n))];case"_FusedMatMul":const[r,s]=LZ("fusedOps",t,e,n),o="biasadd"===r,i="prelu"===s,a=LZ("numArgs",t,e,n),u=LZ("leakyreluAlpha",t,e,n);if(o){if(i&&2!==a)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!i&&1!==a)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[c,l]=LZ("args",t,e,n);return[hY({a:LZ("a",t,e,n),b:LZ("b",t,e,n),transposeA:LZ("transposeA",t,e,n),transposeB:LZ("transposeB",t,e,n),bias:c,activation:s,preluActivationWeights:l,leakyreluAlpha:u})];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"normalization":return cq((()=>((t,e,n)=>{switch(t.op){case"EuclideanNorm":return[OK(LZ("x",t,e,n),LZ("axis",t,e,n),LZ("keepDims",t,e,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[FH(LZ("x",t,e,n),LZ("mean",t,e,n),LZ("variance",t,e,n),LZ("offset",t,e,n),LZ("scale",t,e,n),LZ("epsilon",t,e,n))];case"LRN":return[XK(LZ("x",t,e,n),LZ("radius",t,e,n),LZ("bias",t,e,n),LZ("alpha",t,e,n),LZ("beta",t,e,n))];case"Softmax":return[_J(LZ("x",t,e,n))];case"LogSoftmax":return[sX(LZ("x",t,e,n))];case"SparseToDense":return[YJ(LZ("sparseIndices",t,e,n),LZ("outputShape",t,e,n),LZ("sparseValues",t,e,n),LZ("defaultValue",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"reduction":return cq((()=>((t,e,n)=>{switch(t.op){case"Max":{const r=LZ("axis",t,e,n),s=LZ("keepDims",t,e,n);return[NK(LZ("x",t,e,n),r,s)]}case"Mean":{const r=LZ("axis",t,e,n),s=LZ("keepDims",t,e,n);return[yX(LZ("x",t,e,n),r,s)]}case"Min":{const r=LZ("axis",t,e,n),s=LZ("keepDims",t,e,n);return[$K(LZ("x",t,e,n),r,s)]}case"Sum":{const r=LZ("axis",t,e,n),s=LZ("keepDims",t,e,n);return[kK(LZ("x",t,e,n),r,s)]}case"All":{const r=LZ("axis",t,e,n),s=LZ("keepDims",t,e,n);return[iH(LZ("x",t,e,n),r,s)]}case"Any":{const r=LZ("axis",t,e,n),s=LZ("keepDims",t,e,n);return[aH(LZ("x",t,e,n),r,s)]}case"ArgMax":{const r=LZ("axis",t,e,n);return[uH(LZ("x",t,e,n),r)]}case"ArgMin":{const r=LZ("axis",t,e,n);return[cH(LZ("x",t,e,n),r)]}case"Prod":{const r=LZ("axis",t,e,n),s=LZ("keepDims",t,e,n);return[FX(LZ("x",t,e,n),r,s)]}case"Cumprod":{const r=LZ("axis",t,e,n),s=LZ("exclusive",t,e,n),o=LZ("reverse",t,e,n);return[sK(LZ("x",t,e,n),r,s,o)]}case"Cumsum":{const r=LZ("axis",t,e,n),s=LZ("exclusive",t,e,n),o=LZ("reverse",t,e,n);return[oK(LZ("x",t,e,n),r,s,o)]}case"Bincount":const r=LZ("x",t,e,n),s=LZ("weights",t,e,n),o=LZ("size",t,e,n);return[VH(r,s,o)];case"DenseBincount":{const r=LZ("x",t,e,n),s=LZ("weights",t,e,n),o=LZ("size",t,e,n),i=LZ("binaryOutput",t,e,n);return[iK(r,s,o,i)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"slice_join":return cq((()=>((t,e,n)=>{switch(t.op){case"ConcatV2":case"Concat":{const r=LZ("n",t,e,n),s=LZ("axis",t,e,n);let o=LZ("tensors",t,e,n);return o=o.slice(0,r),[CH(o,s)]}case"Gather":{const r=LZ("x",t,e,n),s=LZ("indices",t,e,n);return[BK(r,WG(s,"int32"),0)]}case"GatherV2":{const r=LZ("axis",t,e,n),s=LZ("batchDims",t,e,n),o=LZ("x",t,e,n),i=LZ("indices",t,e,n);return[BK(o,WG(i,"int32"),r,s)]}case"Reverse":{const r=LZ("dims",t,e,n),s=[];for(let t=0;t<r.length;t++)r[t]&&s.push(t);const o=LZ("x",t,e,n);return[cJ(o,s)]}case"ReverseV2":{const r=LZ("axis",t,e,n),s=LZ("x",t,e,n);return[cJ(s,r)]}case"Slice":{const r=LZ("begin",t,e,n),s=LZ("size",t,e,n);return[IH(LZ("x",t,e,n),r,s)]}case"StridedSlice":{const r=LZ("begin",t,e,n),s=LZ("end",t,e,n),o=LZ("strides",t,e,n),i=LZ("beginMask",t,e,n),a=LZ("endMask",t,e,n),u=LZ("ellipsisMask",t,e,n),c=LZ("newAxisMask",t,e,n),l=LZ("shrinkAxisMask",t,e,n),f=LZ("x",t,e,n);return[FJ(f,r,s,o,i,a,u,c,l)]}case"Pack":return cq((()=>{const r=LZ("axis",t,e,n),s=LZ("tensors",t,e,n),o=s[0].shape,i=MJ(s[0]).shape,a=s.map((t=>{const e=gz(t.shape,o);if(!e&&!gz(MJ(t).shape,i))throw new Error("the input tensors shape does not match");return e?t:TH(t,o)}));return[RJ(a,r)]}));case"Unpack":{const r=LZ("axis",t,e,n),s=LZ("tensor",t,e,n);return jJ(s,r)}case"Tile":{const r=LZ("reps",t,e,n);return[DK(LZ("x",t,e,n),r)]}case"Split":case"SplitV":{const r=LZ("axis",t,e,n),s=LZ("numOrSizeSplits",t,e,n),o=LZ("x",t,e,n);return CJ(o,s,r)}case"ScatterNd":{const r=LZ("indices",t,e,n),s=LZ("values",t,e,n),o=LZ("shape",t,e,n);return[JJ(r,s,o)]}case"GatherNd":{const r=LZ("x",t,e,n),s=LZ("indices",t,e,n);return[ZJ(r,s)]}case"SparseToDense":{const r=LZ("sparseIndices",t,e,n),s=LZ("outputShape",t,e,n),o=LZ("sparseValues",t,e,n),i=LZ("defaultValue",t,e,n);return[YJ(r,o,s,o.dtype===i.dtype?i:WG(i,o.dtype))]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"sparse":return cq((()=>((t,e,n)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:s,emptyRowIndicator:o,reverseIndexMap:i}=dZ.sparseFillEmptyRows(LZ("indices",t,e,n),LZ("values",t,e,n),LZ("denseShape",t,e,n),LZ("defaultValue",t,e,n));return[r,s,o,i]}case"SparseReshape":{const{outputIndices:r,outputShape:s}=dZ.sparseReshape(LZ("inputIndices",t,e,n),LZ("inputShape",t,e,n),LZ("newShape",t,e,n));return[r,s]}case"SparseSegmentMean":return[dZ.sparseSegmentMean(LZ("data",t,e,n),LZ("indices",t,e,n),LZ("segmentIds",t,e,n))];case"SparseSegmentSum":return[dZ.sparseSegmentSum(LZ("data",t,e,n),LZ("indices",t,e,n),LZ("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"spectral":return cq((()=>((t,e,n)=>{switch(t.op){case"FFT":return[TJ(LZ("x",t,e,n))];case"IFFT":return[kJ(LZ("x",t,e,n))];case"RFFT":return[OJ(LZ("x",t,e,n))];case"IRFFT":return[AJ(LZ("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"string":return cq((()=>((t,e,n)=>{switch(t.op){case"StringNGrams":{const{nGrams:r,nGramsSplits:s}=mZ.stringNGrams(LZ("data",t,e,n),LZ("dataSplits",t,e,n),LZ("separator",t,e,n),LZ("nGramWidths",t,e,n),LZ("leftPad",t,e,n),LZ("rightPad",t,e,n),LZ("padWidth",t,e,n),LZ("preserveShortSequences",t,e,n));return[r,s]}case"StringSplit":{const{indices:r,values:s,shape:o}=mZ.stringSplit(LZ("input",t,e,n),LZ("delimiter",t,e,n),LZ("skipEmpty",t,e,n));return[r,s,o]}case"StringToHashBucketFast":return[mZ.stringToHashBucketFast(LZ("input",t,e,n),LZ("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"transformation":return cq((()=>((t,e,n)=>{switch(t.op){case"Cast":return[WG(LZ("x",t,e,n),LZ("dtype",t,e,n))];case"ExpandDims":{const r=LZ("axis",t,e,n);return[MK(LZ("x",t,e,n),r)]}case"Squeeze":{const r=LZ("axis",t,e,n);return[MJ(LZ("x",t,e,n),r)]}case"Reshape":return[TH(LZ("x",t,e,n),LZ("shape",t,e,n))];case"MirrorPad":return[vX(LZ("x",t,e,n),LZ("padding",t,e,n),LZ("mode",t,e,n))];case"PadV2":case"Pad":return[kX(LZ("x",t,e,n),LZ("padding",t,e,n),LZ("constantValue",t,e,n))];case"SpaceToBatchND":{const r=LZ("blockShape",t,e,n),s=LZ("paddings",t,e,n);return[MX(LZ("x",t,e,n),r,s)]}case"BatchToSpaceND":{const r=LZ("blockShape",t,e,n),s=LZ("crops",t,e,n);return[DH(LZ("x",t,e,n),r,s)]}case"DepthToSpace":{const r=LZ("blockSize",t,e,n),s=LZ("dataFormat",t,e,n).toUpperCase();return[aK(LZ("x",t,e,n),r,s)]}case"BroadcastTo":return[WH(LZ("x",t,e,n),LZ("shape",t,e,n))];case"BroadcastArgs":return[zH(LZ("s0",t,e,n),LZ("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"hash_table":return(async(t,e,n,r)=>{switch(t.op){case"HashTable":case"HashTableV2":{const s=LZ("keyDType",t,e,n),o=LZ("valueDType",t,e,n),i=new RQ(s,o);return r.addHashTable(t.name,i),[i.handle]}case"LookupTableImport":case"LookupTableImportV2":{const s=LZ("tableHandle",t,e,n,r),o=LZ("keys",t,e,n),i=LZ("values",t,e,n),a=r.getHashTableById(s.id);return[await a.import(o,i)]}case"LookupTableFind":case"LookupTableFindV2":{const s=LZ("tableHandle",t,e,n,r),o=LZ("keys",t,e,n),i=LZ("defaultValue",t,e,n),a=r.getHashTableById(s.id);return[await a.find(o,i)]}case"LookupTableSize":case"LookupTableSizeV2":{const s=LZ("tableHandle",t,e,n,r);return[r.getHashTableById(s.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n,r);case"custom":const s=FZ(t.op);if(s&&s.customExecutor)return s.customExecutor(new EQ(t,e,n));throw TypeError(`Custom op ${t.op} is not registered.`);default:throw TypeError(`Unknown op '${t.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return zz(s)?s.then((t=>[].concat(t))):[].concat(s)}class FQ{constructor(t={},e={},n={},r={}){this.weightMap=t,this.tensorArrayMap=e,this.tensorListMap=n,this.functionMap=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(t,e){return{id:t,frameName:e,iterationId:0}}set currentContext(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const t=[];for(let e=0;e<this.contexts.length-1;e++){const n=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(n))}t.push(""),this._currentContextIds=t}contextIdforContexts(t){return t?t.map((t=>0===t.id&&0===t.iterationId?"":`${t.frameName}-${t.iterationId}`)).join("/"):""}enterFrame(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(t){return this.weightMap[t]}addTensorArray(t){this.tensorArrayMap[t.id]=t}getTensorArray(t){return this.tensorArrayMap[t]}addTensorList(t){this.tensorListMap[t.id]=t}getTensorList(t){return this.tensorListMap[t]}dispose(t){for(const e in this.tensorArrayMap)this.tensorArrayMap[e].clearAndClose(t);for(const e in this.tensorListMap)this.tensorListMap[e].clearAndClose(t)}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LQ(t,e,n,r){const s=new Set,o=[];let i=null,a=null;const u=new Set,c=Object.keys(t).map((t=>zZ(t)[0]));let l=[];null!=r&&(l=r.map((t=>zZ(t.name)[0])));const f=[...e];for(;f.length>0;){const t=f.pop();(zQ(t)||WQ(t)||UQ(t))&&null==i&&(i=t,a=i.children.map((t=>t.name)).filter((t=>s.has(t)))),s.add(t.name),null==n[t.name]&&(-1===c.indexOf(t.name)&&-1===l.indexOf(t.name)&&(0!==t.inputs.length?t.inputs.forEach((t=>{u.has(t.name)||(u.add(t.name),f.push(t))})):o.push(t.name)))}return{inputs:t,outputs:e,usedNodes:s,missingInputs:o,dynamicNode:i,syncInputs:a}}const PQ=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],BQ=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],VQ=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function zQ(t){return PQ.indexOf(t.op)>=0}function WQ(t){return BQ.indexOf(t.op)>=0}function UQ(t){return VQ.indexOf(t.op)>=0}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jQ{constructor(t,e){this.graph=t,this.parent=e,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((e=>{this._functionExecutorMap[e]=new jQ(t.functions[e],this)}))}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){const e=Object.keys(t).map((e=>t[e].map((t=>t.id))));this._weightIds=[].concat(...e),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get outputs(){return this._outputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get inputNodes(){return this._inputs.map((t=>t.signatureKey||t.name))}get outputNodes(){return this._outputs.map((t=>{const e=t.signatureKey||t.name;return t.defaultOutput?`${e}:${t.defaultOutput}`:e}))}get functions(){return Object.keys(this._functions).reduce(((t,e)=>(t[e]=this._functions[e].signature,t)),{})}getCompilationKey(t,e){const n=t.map((t=>t.name)).sort(),r=e.map((t=>t.name)).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}compile(t,e){const n=LQ(t,e,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:s,syncInputs:o}=n;if(null!=s)throw new Error(`This execution contains the node '${s.name}', which has the dynamic op '${s.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(r.length>0){const n=e.map((t=>t.name)),s=Object.keys(t);throw new Error(`Cannot compute the outputs [${n}] from the provided inputs [${s}]. Missing the following inputs: [${r}]`)}return function(t,e,n){const{usedNodes:r,inputs:s}=n,o=[],i=Object.keys(s).map((t=>zZ(t)[0])).map((e=>t.nodes[e])),a=t.initNodes;i.forEach((t=>{r.has(t.name)&&o.push(t)})),t.weights.forEach((t=>{r.has(t.name)&&o.push(t)})),null!=a&&a.forEach((t=>{r.has(t.name)&&o.push(t)}));const u=new Set,c=[];for(;o.length>0;){const t=o.pop();u.add(t.name),e[t.name]||c.push(t),t.children.forEach((t=>{!u.has(t.name)&&r.has(t.name)&&t.inputs.every((t=>u.has(t.name)))&&o.push(t)}))}return c}(this.graph,this.weightMap,n)}execute(t,e){t=this.mapInputs(t);const n=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e);const r=n.map((t=>this.graph.nodes[zZ(t)[0]])),s=e.map((t=>zZ(t)[0]));let o=s.map((t=>this.graph.nodes[t]));this.resetIntermediateTensors(),0===o.length&&(o=this._outputs);const i=this.getCompilationKey(r,o);let a=this.compiledMap.get(i);null==a&&(a=this.compile(t,o),this.compiledMap.set(i,a));const u={},c={};return cq((()=>{const n=new FQ(this.weightMap,u,c,this.functionExecutorMap),r=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,s]=zZ(e),o=[];o[s]=t[e],r[n]=o}));const o=this.getFrozenTensorIds(r),i={};for(let t=0;t<a.length;t++){const e=a[t];if(!r[e.name]){const t=DQ(e,r,n,this._resourceManager);if(zz(t))throw new Error(`The execution of the op '${e.op}' returned a promise. Please use model.executeAsync() instead.`);r[e.name]=t,this.checkTensorForDisposal(e.name,e,r,n,o,s,i)}}return null==this.parent&&n.dispose(o),e.map((t=>PZ(t,r,n)))}))}getFrozenTensorIds(t){const e=[].concat.apply([],Object.keys(t).map((e=>t[e])).map((t=>t.map((t=>t.id)))));return new Set(e)}checkTensorForDisposal(t,e,n,r,s,o,i){"control"!==e.category&&-1===o.indexOf(t)&&(n[t].forEach((t=>{null!=t&&(i[t.id]=(i[t.id]||0)+e.children.length)})),e.inputs.forEach((t=>{if("control"!==t.category){const o=function(t,e,n){return e[VZ(t,n.currentContextId)]}(t.name,n,r);null!=o&&o.forEach((t=>{if(t&&!t.kept&&!s.has(t.id)){const n=i[t.id];if(1===n){if(this.keepTensorForDebug){const[n,s]=BZ(e.name,r);this.intermediateTensors[n]||(this.intermediateTensors[n]=[]),this.intermediateTensors[n][s]=t}else t.dispose();delete i[t.id]}else null!=n&&i[t.id]--}}))}})))}async executeAsync(t,e){return this._executeAsync(t,e)}disposeIntermediateTensors(){this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach((t=>this.intermediateTensors[t].forEach((t=>t.dispose())))),this.disposeTensorsMap())}disposeTensorsMap(){this.tensorsMap&&Object.keys(this.tensorsMap).forEach((t=>{this.tensorsMap[t].forEach((t=>{!t||t.kept||t.isDisposed||this.keepIds.has(t.id)||t.dispose()}))}))}getIntermediateTensors(){return this.tensorsMap}resetIntermediateTensors(){for(const t in this.intermediateTensors)this.intermediateTensors[t].forEach((t=>t.dispose())),delete this.intermediateTensors[t]}async _executeAsync(t,e,n=!1,r={},s={}){n||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e));try{this.keepTensorForDebug=jz().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(t){console.warn(t.message)}this.resetIntermediateTensors();const o=new FQ(this.weightMap,r,s,this.functionExecutorMap);this.tensorsMap=await this.executeWithControlFlow(t,o,e,n);const i=e.map((t=>PZ(t,this.tensorsMap,o))),a=i.map((t=>t.id)),u=Object.keys(t).map((e=>t[e].id));return this.keepIds=new Set([...a,...u,...this.weightIds]),this.keepTensorForDebug||this.disposeTensorsMap(),null==this.parent&&o.dispose(this.keepIds),i}async executeFunctionAsync(t,e,n){const r=t.reduce(((t,e,n)=>(t[this.inputs[n].name]=e,t)),{});return this._executeAsync(r,this.outputNodes,!0,e,n)}async executeWithControlFlow(t,e,n,r){const s=Object.keys(t),o=s.map((t=>this.graph.nodes[zZ(t)[0]])),i=n.map((t=>zZ(t)[0]));let a=i.map((t=>this.graph.nodes[t]));0===a.length&&(a=this._outputs);const{usedNodes:u,missingInputs:c,dynamicNode:l,syncInputs:f}=LQ(t,a,this.weightMap,this._initNodes),h=[...o,...this.graph.weights,...this._initNodes||[]].map((t=>({node:t,contexts:e.currentContext}))),p=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,r]=zZ(e),s=[];s[r]=t[e],p[n]=s}));const d={},m=this.getFrozenTensorIds(p),y={};for(;h.length>0;){const t=this.processStack(o,h,e,p,y,m,i,d,u);await Promise.all(t)}null!=l||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const g=a.filter((t=>!zQ(t)&&!PZ(t.name,p,e))).map((t=>t.name));if(g.length>0){let t="";throw null!=l&&(t=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${f}]`),new Error(`Cannot compute the outputs [${g}] from the provided inputs [${s}]. Consider providing the following inputs: [${c}]. ${t}`)}return p}processStack(t,e,n,r,s,o,i,a,u){const c=[];for(;e.length>0;){const t=e.pop();n.currentContext=t.contexts;let l="";if("Enter"===t.node.op&&LZ("isConstant",t.node,r,n)&&([l]=BZ(t.node.name,n)),null==r[t.node.name]){const f=DQ(t.node,r,n,this._resourceManager);l||([l]=BZ(t.node.name,n));const h=n.currentContext;zz(f)?c.push(f.then((c=>(r[l]=c,n.currentContext=h,this.checkTensorForDisposal(l,t.node,r,n,o,i,a),this.processChildNodes(t.node,e,n,r,s,u),c)))):(r[l]=f,this.checkTensorForDisposal(l,t.node,r,n,o,i,a),this.processChildNodes(t.node,e,n,r,s,u))}else this.processChildNodes(t.node,e,n,r,s,u)}return c}processChildNodes(t,e,n,r,s,o){t.children.forEach((t=>{const[i]=BZ(t.name,n);!s[i]&&o.has(t.name)&&("Merge"===t.op?t.inputNames.some((t=>!!PZ(t,r,n)))&&(s[i]=!0,e.push({contexts:n.currentContext,node:t})):t.inputNames.every((t=>!!PZ(t,r,n)))&&(s[i]=!0,e.push({contexts:n.currentContext,node:t})))}))}dispose(){Object.keys(this.weightMap).forEach((t=>this.weightMap[t].forEach((t=>t.dispose()))))}checkInputShapeAndType(t){Object.keys(t).forEach((e=>{const n=t[e],[r]=zZ(e),s=this.graph.nodes[r];if(s.attrParams.shape&&s.attrParams.shape.value){const t=s.attrParams.shape.value,e=t.length===n.shape.length&&n.shape.every(((e,n)=>-1===t[n]||t[n]===e));hz(e,(()=>`The shape of dict['${s.name}'] provided in model.execute(dict) must be [${t}], but was [${n.shape}]`))}s.attrParams.dtype&&s.attrParams.dtype.value&&hz(n.dtype===s.attrParams.dtype.value,(()=>`The dtype of dict['${s.name}'] provided in model.execute(dict) must be ${s.attrParams.dtype.value}, but was ${n.dtype}`))}))}mapInputs(t){const e={};for(const n in t)if(null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]){e[this._signature.inputs[n].name]=t[n]}else e[n]=t[n];return e}checkInputs(t){const e=Object.keys(t).filter((t=>{const[e]=zZ(t);return null==this.graph.nodes[e]}));if(e.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${e}] that are not part of graph`)}mapOutputs(t){return t.map((t=>{if(null!=this._signature&&null!=this._signature.outputs&&null!=this._signature.outputs[t]){return this._signature.outputs[t].name}return t}),{})}checkOutputs(t){t.forEach((t=>{const[e]=zZ(t);if(!this.graph.nodes[e])throw new Error(`The output '${t}' is not found in the graph`)}))}}class GQ{constructor(t={},e={}){this.hashTableNameToHandle=t,this.hashTableMap=e}addHashTable(t,e){this.hashTableNameToHandle[t]=e.handle,this.hashTableMap[e.id]=e}getHashTableHandleByName(t){return this.hashTableNameToHandle[t]}getHashTableById(t){return this.hashTableMap[t]}dispose(){for(const t in this.hashTableMap)this.hashTableMap[t].clearAndClose(),delete this.hashTableMap[t];for(const t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qQ{constructor(t,e={}){this.modelUrl=t,this.loadOptions=e,this.version="n/a",null==e&&(this.loadOptions={}),this.resourceManager=new GQ}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}findIOHandler(){const t=this.modelUrl;if(null!=t.load)this.handler=t;else if(null!=this.loadOptions.requestInit)this.handler=eq(t,this.loadOptions);else{const e=yG(t,this.loadOptions);if(0===e.length)e.push(eq(t,this.loadOptions));else if(e.length>1)throw new Error(`Found more than one (${e.length}) load handlers for URL '${[t]}'`);this.handler=e[0]}}load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const t=this.handler.load();return zz(t)?t.then((t=>this.loadSync(t))):this.loadSync(t)}loadSync(t){this.artifacts=t;const e=this.artifacts.modelTopology;let n;n=null!=this.artifacts.userDefinedMetadata&&null!=this.artifacts.userDefinedMetadata.signature?this.artifacts.userDefinedMetadata.signature:this.artifacts.signature,this.signature=n,this.version=`${e.versions.producer}.${e.versions.minConsumer}`;const r=sG(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new jQ(cQ.Instance.transformGraph(e,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=t.modelInitializer&&null!=t.modelInitializer.node){const e=cQ.Instance.transformGraph(t.modelInitializer);this.initializer=new jQ(e),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(t,e){if("string"==typeof t){const e=mG(t);if(0===e.length)throw new Error(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new Error(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}if(null==t.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return t.save(this.artifacts)}predict(t,e){return this.execute(t,this.outputNodes)}normalizeInputs(t){if(!(t instanceof kU||Array.isArray(t)))return t;if((t=Array.isArray(t)?t:[t]).length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${t.length} input tensors.`);return this.inputNodes.reduce(((e,n,r)=>(e[n]=t[r],e)),{})}normalizeOutputs(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]}execute(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=this.executor.execute(t,e);return n.length>1?n:n[0]}async executeAsync(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=await this.executor.executeAsync(t,e);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(t){return Object.keys(t).reduce(((e,n)=>(e[n]=[t[n]],e)),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var HQ=Object.freeze({__proto__:null,GraphModel:qQ,loadGraphModel:async function(t,e={}){if(null==t)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==e&&(e={}),e.fromTFHub&&"string"==typeof t&&(t=function(t){t.endsWith("/")||(t+="/");return`${t}model.json?tfjs-format=file`}
/** @license See the LICENSE file. */(t));const n=new qQ(t,e);return await n.load(),n},loadGraphModelSync:function(t){if(null==t)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide a url or an IOHandler that loads the model");if(!t.load)throw new Error(`modelUrl IO Handler ${t} has no load function`);const e=new qQ(t);return e.load(),e},deregisterOp:function(t){delete DZ[t]},registerOp:function(t,e){const n={tfOpName:t,category:"custom",inputs:[],attrs:[],customExecutor:e};DZ[t]=n},version_converter:"3.18.0"});!function(t,e,n,r){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},s(t,e)};function o(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var i=function(){return i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},i.apply(this,arguments)};function a(t,e,n,r){function s(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?n(t.value):s(t.value).then(i,a)}u((r=r.apply(t,e||[])).next())}))}function u(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(t){return function(e){return u([t,e])}}function u(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((s=(s=i.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var c=["nose","left_eye","right_eye","left_ear","right_ear","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle"],l=["nose","left_eye_inner","left_eye","left_eye_outer","right_eye_inner","right_eye","right_eye_outer","left_ear","right_ear","mouth_left","mouth_right","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_pinky","right_pinky","left_index","right_index","left_thumb","right_thumb","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle","left_heel","right_heel","left_foot_index","right_foot_index"],f={left:[1,2,3,7,9,11,13,15,17,19,21,23,25,27,29,31],right:[4,5,6,8,10,12,14,16,18,20,22,24,26,28,30,32],middle:[0]},h={left:[1,3,5,7,9,11,13,15],right:[2,4,6,8,10,12,14,16],middle:[0]},p=[[0,1],[0,2],[1,3],[2,4],[5,6],[5,7],[5,11],[6,8],[6,12],[7,9],[8,10],[11,12],[11,13],[12,14],[13,15],[14,16]],d=[[0,1],[0,4],[1,2],[2,3],[3,7],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[11,23],[12,14],[14,16],[12,24],[13,15],[15,17],[16,18],[16,20],[15,17],[15,19],[15,21],[16,22],[17,19],[18,20],[23,25],[23,24],[24,26],[25,27],[26,28],[27,29],[28,30],[27,31],[28,32],[29,31],[30,32]],m={runtime:"mediapipe",enableSmoothing:!0,modelType:"full"};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function y(t){if(null==t)return i({},m);var e=i({},t);return e.runtime="mediapipe",null==e.enableSmoothing&&(e.enableSmoothing=m.enableSmoothing),null==e.modelType&&(e.modelType=m.modelType),e}var g=function(){function t(t){var e,n=this;switch(this.width=0,this.height=0,this.selfieMode=!1,this.poseSolution=new window.Pose({locateFile:function(e,n){return t.solutionPath?t.solutionPath.replace(/\/+$/,"")+"/"+e:n+"/"+e}}),t.modelType){case"lite":e=0;break;case"heavy":e=2;break;default:e=1}this.poseSolution.setOptions({modelComplexity:e,smoothLandmarks:t.enableSmoothing||!0,selfieMode:this.selfieMode}),this.poseSolution.onResults((function(t){n.height=t.image.height,n.width=t.image.width,null==t.poseLandmarks?n.poses=[]:n.poses=[n.translateOutput(t.poseLandmarks,t.poseWorldLandmarks)]}))}return t.prototype.translateOutput=function(t,e){var n=this,r={keypoints:t.map((function(t,e){return{x:t.x*n.width,y:t.y*n.height,z:t.z,score:t.visibility,name:l[e]}}))};return null!=e&&(r.keypoints3D=e.map((function(t,e){return{x:t.x,y:t.y,z:t.z,score:t.visibility,name:l[e]}}))),r},t.prototype.estimatePoses=function(t,e,n){return a(this,void 0,void 0,(function(){return u(this,(function(r){switch(r.label){case 0:return e&&e.flipHorizontal&&e.flipHorizontal!==this.selfieMode&&(this.selfieMode=e.flipHorizontal,this.poseSolution.setOptions({selfieMode:this.selfieMode})),[4,this.poseSolution.send({image:t},n)];case 1:return r.sent(),[2,this.poses]}}))}))},t.prototype.dispose=function(){this.poseSolution.close()},t.prototype.reset=function(){this.poseSolution.reset()},t.prototype.initialize=function(){return this.poseSolution.initialize()},t}();function b(t){return a(this,void 0,void 0,(function(){var e,n;return u(this,(function(r){switch(r.label){case 0:return e=y(t),[4,(n=new g(e)).initialize()];case 1:return r.sent(),[2,n]}}))}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var w=1e-6,v=1e6,x=1e3;
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function N(t){return t instanceof r.Tensor?{height:t.shape[0],width:t.shape[1]}:{height:t.height,width:t.width}}function $(t){return t-2*Math.PI*Math.floor((t+Math.PI)/(2*Math.PI))}function E(t,e,n,r){var s=e-t,o=r-n;if(0===s)throw new Error("Original min and max are both "+t+", range cannot be 0.");var i=o/s;return{scale:i,offset:n-t*i}}function S(t){return t instanceof r.Tensor?t:r.browser.fromPixels(t)}function _(t,e,n){if(void 0===n&&(n=!1),!n)return{top:0,left:0,right:0,bottom:0};var r=e.height,s=e.width;A(e,"targetSize"),A(t,"roi");var o,i,a=r/s,u=t.height/t.width,c=0,l=0;return a>u?(o=t.width,i=t.width*a,l=(1-u/a)/2):(o=t.height/a,i=t.height,c=(1-a/u)/2),t.width=o,t.height=i,{top:l,left:c,right:c,bottom:l}}function T(t,e){return e?{xCenter:e.xCenter*t.width,yCenter:e.yCenter*t.height,width:e.width*t.width,height:e.height*t.height,rotation:e.rotation}:{xCenter:.5*t.width,yCenter:.5*t.height,width:t.width,height:t.height,rotation:0}}function k(t,e,n,r){A(r,"inputResolution");var s=1/e.width,o=1/e.height,i=t.xCenter,a=t.yCenter,u=Math.cos(t.rotation),c=Math.sin(t.rotation),l=n?-1:1,f=t.width,h=t.height;return[1/r.width*f*u*l*s*e.width,1/r.height*-h*c*s*e.width,(-.5*f*u*l+.5*h*c+i)*s*e.width,1/r.width*f*c*l*o*e.height,1/r.height*h*u*o*e.height,(-.5*h*u-.5*f*c*l+a)*o*e.height,0,0]}function A(t,e){r.util.assert(0!==t.width,(function(){return e+" width cannot be 0."})),r.util.assert(0!==t.height,(function(){return e+" height cannot be 0."}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function C(t,e,n){var s=e.inputResolution,o=e.keepAspectRatio,i=N(t),a=T(i,n),u=_(a,s,o);return{imageTensor:r.tidy((function(){var e=S(t),n=r.tensor2d(k(a,i,!1,s),[1,8]);return r.image.transform(r.expandDims(r.cast(e,"float32")),n,"bilinear","nearest",0,[s.height,s.width])})),padding:u}}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function O(t){return null!=t&&null!=t.currentTime}function I(t,e){return(t.width*e.width+t.height*e.height)/2}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var M=function(){function t(t){this.alpha=t,this.initialized=!1}return t.prototype.apply=function(t,e){var n;return this.initialized?n=null==e?this.storedValue+this.alpha*(t-this.storedValue):this.storedValue+this.alpha*e*Math.asinh((t-this.storedValue)/e):(n=t,this.initialized=!0),this.rawValue=t,this.storedValue=n,n},t.prototype.applyWithAlpha=function(t,e,n){return this.alpha=e,this.apply(t,n)},t.prototype.hasLastRawValue=function(){return this.initialized},t.prototype.lastRawValue=function(){return this.rawValue},t.prototype.reset=function(){this.initialized=!1},t}(),R=function(){function t(t){this.frequency=t.frequency,this.minCutOff=t.minCutOff,this.beta=t.beta,this.thresholdCutOff=t.thresholdCutOff,this.thresholdBeta=t.thresholdBeta,this.derivateCutOff=t.derivateCutOff,this.x=new M(this.getAlpha(this.minCutOff)),this.dx=new M(this.getAlpha(this.derivateCutOff)),this.lastTimestamp=0}return t.prototype.apply=function(t,e,n){if(null==t)return t;var r=Math.trunc(e);if(this.lastTimestamp>=r)return t;0!==this.lastTimestamp&&0!==r&&(this.frequency=1/((r-this.lastTimestamp)*w)),this.lastTimestamp=r;var s=this.x.hasLastRawValue()?(t-this.x.lastRawValue())*n*this.frequency:0,o=this.dx.applyWithAlpha(s,this.getAlpha(this.derivateCutOff)),i=this.minCutOff+this.beta*Math.abs(o),a=null!=this.thresholdCutOff?this.thresholdCutOff+this.thresholdBeta*Math.abs(o):null;return this.x.applyWithAlpha(t,this.getAlpha(i),a)},t.prototype.getAlpha=function(t){return 1/(1+this.frequency/(2*Math.PI*t))},t}(),D=function(){function t(t){this.config=t}return t.prototype.apply=function(t,e,n){var r=this;if(null==t)return this.reset(),null;this.initializeFiltersIfEmpty(t);var s=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return t.slice();s=1/n}return t.map((function(t,n){var o=i({},t,{x:r.xFilters[n].apply(t.x,e,s),y:r.yFilters[n].apply(t.y,e,s)});return null!=t.z&&(o.z=r.zFilters[n].apply(t.z,e,s)),o}))},t.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},t.prototype.initializeFiltersIfEmpty=function(t){var e=this;null!=this.xFilters&&this.xFilters.length===t.length||(this.xFilters=t.map((function(t){return new R(e.config)})),this.yFilters=t.map((function(t){return new R(e.config)})),this.zFilters=t.map((function(t){return new R(e.config)})))},t}();
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function F(t,e){return t.map((function(t){var n=i({},t,{x:t.x/e.width,y:t.y/e.height});return null!=t.z&&(t.z=t.z/e.width),n}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var L=function(){function t(t){this.config=t,this.window=[],this.lowPassFilter=new M(1),this.lastValue=0,this.lastValueScale=1,this.lastTimestamp=-1}return t.prototype.apply=function(t,e,n){if(null==t)return t;var r,s=Math.trunc(e);if(this.lastTimestamp>=s)return t;if(-1===this.lastTimestamp)r=1;else{for(var o=t*n-this.lastValue*this.lastValueScale,i=s-this.lastTimestamp,a=o,u=i,c=v/30,l=(1+this.window.length)*c,f=0,h=this.window;f<h.length;f++){var p=h[f];if(u+p.duration>l)break;a+=p.distance,u+=p.duration}var d=a/(u*w);r=1-1/(1+this.config.velocityScale*Math.abs(d)),this.window.unshift({distance:o,duration:i}),this.window.length>this.config.windowSize&&this.window.pop()}return this.lastValue=t,this.lastValueScale=n,this.lastTimestamp=s,this.lowPassFilter.applyWithAlpha(t,r)},t}(),P=function(){function t(t){this.config=t}return t.prototype.apply=function(t,e,n){var r=this;if(null==t)return this.reset(),null;var s=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return t.slice();s=1/n}return this.initializeFiltersIfEmpty(t),t.map((function(t,n){var o=i({},t,{x:r.xFilters[n].apply(t.x,e,s),y:r.yFilters[n].apply(t.y,e,s)});return null!=t.z&&(o.z=r.zFilters[n].apply(t.z,e,s)),o}))},t.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},t.prototype.initializeFiltersIfEmpty=function(t){var e=this;null!=this.xFilters&&this.xFilters.length===t.length||(this.xFilters=t.map((function(t){return new L(e.config)})),this.yFilters=t.map((function(t){return new L(e.config)})),this.zFilters=t.map((function(t){return new L(e.config)})))},t}();function B(t,e){return t.map((function(t){var n=i({},t,{x:t.x*e.width,y:t.y*e.height});return null!=t.z&&(n.z=t.z*e.width),n}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var V=function(){function t(t){if(null!=t.velocityFilter)this.keypointsFilter=new P(t.velocityFilter);else{if(null==t.oneEuroFilter)throw new Error("Either configure velocityFilter or oneEuroFilter, but got "+t+".");this.keypointsFilter=new D(t.oneEuroFilter)}}return t.prototype.apply=function(t,e,n,r,s){if(void 0===r&&(r=!1),null==t)return this.keypointsFilter.reset(),null;var o=null!=s?I(s,n):1,i=r?B(t,n):t,a=this.keypointsFilter.apply(i,e,o);return r?F(a,n):a},t}();
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function z(t,e){var n=E(0,255,e[0],e[1]);return r.tidy((function(){return r.add(r.mul(t,n.scale),n.offset)}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function W(t,e,n){var r,s=t.locationData,o=n.rotationVectorStartKeypointIndex,i=n.rotationVectorEndKeypointIndex;r=n.rotationVectorTargetAngle?n.rotationVectorTargetAngle:Math.PI*n.rotationVectorTargetAngleDegree/180;var a=s.relativeKeypoints[o].x*e.width,u=s.relativeKeypoints[o].y*e.height,c=s.relativeKeypoints[i].x*e.width,l=s.relativeKeypoints[i].y*e.height;return $(r-Math.atan2(-(l-u),c-a))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function U(t,e,n){var r=n.rotationVectorStartKeypointIndex,s=n.rotationVectorEndKeypointIndex,o=t.locationData,i=o.relativeKeypoints[r].x*e.width,a=o.relativeKeypoints[r].y*e.height,u=o.relativeKeypoints[s].x*e.width,c=o.relativeKeypoints[s].y*e.height,l=2*Math.sqrt((u-i)*(u-i)+(c-a)*(c-a)),f=W(t,e,n);return{xCenter:i/e.width,yCenter:a/e.height,width:l/e.width,height:l/e.height,rotation:f}}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function j(t,e,n){void 0===n&&(n={ignoreRotation:!1});for(var r=[],s=0,o=t;s<o.length;s++){var a=o[s],u=a.x-.5,c=a.y-.5,l=n.ignoreRotation?0:e.rotation,f=Math.cos(l)*u-Math.sin(l)*c,h=Math.sin(l)*u+Math.cos(l)*c;f=f*e.width+e.xCenter,h=h*e.height+e.yCenter;var p=a.z*e.width,d=i({},a);d.x=f,d.y=h,d.z=p,r.push(d)}return r}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function G(t,e,n){void 0===n&&(n=!0);for(var r=[],s=0;s<t.length;s++){var o=i({},e[s]);n&&(o.score=t[s].score),r.push(o)}return r}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function q(t,e){for(var n=[],r=0,s=t;r<s.length;r++){var o=s[r],a=o.x,u=o.y,c=e.rotation,l=Math.cos(c)*a-Math.sin(c)*u,f=Math.sin(c)*a+Math.cos(c)*u,h=i({},o);h.x=l,h.y=f,n.push(h)}return n}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function H(t){for(var e=[],n=0;n<t.numLayers;){for(var r=[],s=[],o=[],i=[],a=n;a<t.strides.length&&t.strides[a]===t.strides[n];){var u=K(t.minScale,t.maxScale,a,t.strides.length);if(0===a&&t.reduceBoxesInLowestLayer)o.push(1),o.push(2),o.push(.5),i.push(.1),i.push(u),i.push(u);else{for(var c=0;c<t.aspectRatios.length;++c)o.push(t.aspectRatios[c]),i.push(u);if(t.interpolatedScaleAspectRatio>0){var l=a===t.strides.length-1?1:K(t.minScale,t.maxScale,a+1,t.strides.length);i.push(Math.sqrt(u*l)),o.push(t.interpolatedScaleAspectRatio)}}a++}for(var f=0;f<o.length;++f){var h=Math.sqrt(o[f]);r.push(i[f]/h),s.push(i[f]*h)}var p=0,d=0;if(t.featureMapHeight.length>0)p=t.featureMapHeight[n],d=t.featureMapWidth[n];else{var m=t.strides[n];p=Math.ceil(t.inputSizeHeight/m),d=Math.ceil(t.inputSizeWidth/m)}for(var y=0;y<p;++y)for(var g=0;g<d;++g)for(var b=0;b<r.length;++b){var w={xCenter:(g+t.anchorOffsetX)/d,yCenter:(y+t.anchorOffsetY)/p,width:0,height:0};t.fixedAnchorSize?(w.width=1,w.height=1):(w.width=s[b],w.height=r[b]),e.push(w)}n=a}return e}function K(t,e,n,r){return 1===r?.5*(t+e):t+(e-t)*n/(r-1)}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function X(t){return r.tidy((function(){var e=r.slice(t,[0,0,0],[1,-1,1]);return[r.sigmoid(e),r.slice(t,[0,0,1],[1,-1,-1])]}))}function J(t,e){return r.tidy((function(){var n=X(e.predict(t)),s=n[0],o=n[1];return{boxes:r.squeeze(o),scores:r.squeeze(s)}}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Y(t){for(var e={locationData:{relativeKeypoints:[]}},n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,i=0;i<t.length;++i){var a=t[i];n=Math.min(n,a.x),r=Math.max(r,a.x),s=Math.min(s,a.y),o=Math.max(o,a.y),e.locationData.relativeKeypoints.push({x:a.x,y:a.y})}return e.locationData.relativeBoundingBox={xMin:n,yMin:s,xMax:r,yMax:o,width:r-n,height:o-s},e}function Z(t,e,n,s){return a(this,void 0,void 0,(function(){var o,i,a,c,l;return u(this,(function(u){switch(u.label){case 0:return o=r.tensor2d(t.map((function(t){return[t.locationData.relativeBoundingBox.yMin,t.locationData.relativeBoundingBox.xMin,t.locationData.relativeBoundingBox.yMax,t.locationData.relativeBoundingBox.xMax]}))),i=r.tensor1d(t.map((function(t){return t.score[0]}))),[4,r.image.nonMaxSuppressionAsync(o,i,e,n,s)];case 1:return[4,(a=u.sent()).array()];case 2:return c=u.sent(),l=t.filter((function(t,e){return c.indexOf(e)>-1})),r.dispose([o,i,a]),[2,l]}}))}))}function Q(t,e,n){return a(this,void 0,void 0,(function(){var s,o,a,c,l,f,h,p,d,m,y,g,b,w,v,x,N,$,E,S,_,T,k,A;return u(this,(function(u){switch(u.label){case 0:if(s=r.squeeze(e,[0]),o=s.shape,a=o[0],c=o[1],l=o[2],t.length!==l)throw new Error("Expected heatmap to have same number of channels as the number of landmarks. But got landmarks length: "+t.length+", heatmap length: "+l);return f=[],[4,s.buffer()];case 1:for(h=u.sent(),p=0;p<t.length;p++)if(d=t[p],m=i({},d),f.push(m),y=Math.trunc(m.x*c),g=Math.trunc(m.y*a),!(y<0||y>=c||g<0||y>=a)){for(b=Math.trunc((n.kernelSize-1)/2),w=Math.max(0,y-b),v=Math.min(c,y+b+1),x=Math.max(0,g-b),N=Math.min(a,g+b+1),$=0,E=0,S=0,_=0,T=x;T<N;++T)for(k=w;k<v;++k)A=h.get(T,k,p),$+=A,_=Math.max(_,A),E+=k*A,S+=T*A;_>=n.minConfidenceToRefine&&$>0&&(m.x=E/c/$,m.y=S/a/$)}return s.dispose(),[2,f]}}))}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function tt(t,e){void 0===t&&(t=[]);for(var n=e.left,r=e.top,s=e.left+e.right,o=e.top+e.bottom,i=0;i<t.length;i++){var a=t[i],u=a.locationData.relativeBoundingBox,c=(u.xMin-n)/(1-s),l=(u.yMin-r)/(1-o),f=u.width/(1-s),h=u.height/(1-o);u.xMin=c,u.yMin=l,u.width=f,u.height=h;for(var p=0;p<a.locationData.relativeKeypoints.length;++p){var d=a.locationData.relativeKeypoints[p],m=(d.x-n)/(1-s),y=(d.y-r)/(1-o);d.x=m,d.y=y}}return t}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function et(t,e){var n=e.left,r=e.top,s=e.left+e.right,o=e.top+e.bottom;return t.map((function(t){return i({},t,{x:(t.x-n)/(1-s),y:(t.y-r)/(1-o),z:t.z/(1-s)})}))}function nt(t,e,n){return a(this,void 0,void 0,(function(){var s,o,i,a,c;return u(this,(function(u){switch(u.label){case 0:return s=t[0],o=t[1],i=ot(o,e,n),a=r.tidy((function(){var t=s;return n.sigmoidScore?(null!=n.scoreClippingThresh&&(t=r.clipByValue(s,-n.scoreClippingThresh,n.scoreClippingThresh)),t=r.sigmoid(t)):t})),[4,rt(i,a,n)];case 1:return c=u.sent(),r.dispose([i,a]),[2,c]}}))}))}function rt(t,e,n){return a(this,void 0,void 0,(function(){var r,s,o,i,a,c,l,f,h,p,d,m;return u(this,(function(u){switch(u.label){case 0:return r=[],[4,t.data()];case 1:return s=u.sent(),[4,e.data()];case 2:for(o=u.sent(),i=0;i<n.numBoxes;++i)if(!(null!=n.minScoreThresh&&o[i]<n.minScoreThresh||(a=i*n.numCoords,c=st(s[a+0],s[a+1],s[a+2],s[a+3],o[i],n.flipVertically,i),(l=c.locationData.relativeBoundingBox).width<0||l.height<0))){if(n.numKeypoints>0)for((f=c.locationData).relativeKeypoints=[],h=n.numKeypoints*n.numValuesPerKeypoint,p=0;p<h;p+=n.numValuesPerKeypoint)d=a+n.keypointCoordOffset+p,m={x:s[d+0],y:n.flipVertically?1-s[d+1]:s[d+1]},f.relativeKeypoints.push(m);r.push(c)}return[2,r]}}))}))}function st(t,e,n,r,s,o,i){return{score:[s],ind:i,locationData:{relativeBoundingBox:{xMin:e,yMin:o?1-n:t,xMax:r,yMax:o?1-t:n,width:r-e,height:n-t}}}}function ot(t,e,n){return r.tidy((function(){var s,o,i,a;n.reverseOutputOrder?(o=r.squeeze(r.slice(t,[0,n.boxCoordOffset+0],[-1,1])),s=r.squeeze(r.slice(t,[0,n.boxCoordOffset+1],[-1,1])),a=r.squeeze(r.slice(t,[0,n.boxCoordOffset+2],[-1,1])),i=r.squeeze(r.slice(t,[0,n.boxCoordOffset+3],[-1,1]))):(s=r.squeeze(r.slice(t,[0,n.boxCoordOffset+0],[-1,1])),o=r.squeeze(r.slice(t,[0,n.boxCoordOffset+1],[-1,1])),i=r.squeeze(r.slice(t,[0,n.boxCoordOffset+2],[-1,1])),a=r.squeeze(r.slice(t,[0,n.boxCoordOffset+3],[-1,1]))),o=r.add(r.mul(r.div(o,n.xScale),e.w),e.x),s=r.add(r.mul(r.div(s,n.yScale),e.h),e.y),n.applyExponentialOnBoxSize?(i=r.mul(r.exp(r.div(i,n.hScale)),e.h),a=r.mul(r.exp(r.div(a,n.wScale)),e.w)):(i=r.mul(r.div(i,n.hScale),e.h),a=r.mul(r.div(a,n.wScale),e.h));var u=r.sub(s,r.div(i,2)),c=r.sub(o,r.div(a,2)),l=r.add(s,r.div(i,2)),f=r.add(o,r.div(a,2)),h=r.concat([r.reshape(u,[n.numBoxes,1]),r.reshape(c,[n.numBoxes,1]),r.reshape(l,[n.numBoxes,1]),r.reshape(f,[n.numBoxes,1])],1);if(n.numKeypoints)for(var p=0;p<n.numKeypoints;++p){var d=n.keypointCoordOffset+p*n.numValuesPerKeypoint,m=void 0,y=void 0;n.reverseOutputOrder?(m=r.squeeze(r.slice(t,[0,d],[-1,1])),y=r.squeeze(r.slice(t,[0,d+1],[-1,1]))):(y=r.squeeze(r.slice(t,[0,d],[-1,1])),m=r.squeeze(r.slice(t,[0,d+1],[-1,1])));var g=r.add(r.mul(r.div(m,n.xScale),e.w),e.x),b=r.add(r.mul(r.div(y,n.yScale),e.h),e.y);h=r.concat([h,r.reshape(g,[n.numBoxes,1]),r.reshape(b,[n.numBoxes,1])],1)}return h}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function it(t){return 1/(1+Math.exp(-t))}function at(t,e,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!1),a(this,void 0,void 0,(function(){var s,o,i,a,c,l,f,h;return u(this,(function(u){switch(u.label){case 0:return s=t.size,o=s/e.numLandmarks,[4,t.data()];case 1:for(i=u.sent(),a=[],c=0;c<e.numLandmarks;++c)l=c*o,(h={x:0,y:0}).x=n?e.inputImageWidth-i[l]:i[l],o>1&&(h.y=r?e.inputImageHeight-i[l+1]:i[l+1]),o>2&&(h.z=i[l+2]),o>3&&(h.score=it(i[l+3])),a.push(h);for(f=0;f<a.length;++f)(h=a[f]).x=h.x/e.inputImageWidth,h.y=h.y/e.inputImageHeight,h.z=h.z/e.inputImageWidth/(e.normalizeZ||1);return[2,a]}}))}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function ut(t,e,n){var r=t.width,s=t.height,o=t.rotation;if(null==n.rotation&&null==n.rotationDegree||(o=ct(o,n)),0===o)t.xCenter=t.xCenter+r*n.shiftX,t.yCenter=t.yCenter+s*n.shiftY;else{var i=(e.width*r*n.shiftX*Math.cos(o)-e.height*s*n.shiftY*Math.sin(o))/e.width,a=(e.width*r*n.shiftX*Math.sin(o)+e.height*s*n.shiftY*Math.cos(o))/e.height;t.xCenter=t.xCenter+i,t.yCenter=t.yCenter+a}if(n.squareLong){var u=Math.max(r*e.width,s*e.height);r=u/e.width,s=u/e.height}else if(n.squareShort){var c=Math.min(r*e.width,s*e.height);r=c/e.width,s=c/e.height}return t.width=r*n.scaleX,t.height=s*n.scaleY,t}function ct(t,e){return null!=e.rotation?t+=e.rotation:null!=e.rotationDegree&&(t+=Math.PI*e.rotationDegree/180),$(t)}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var lt=function(){function t(t){this.alpha=t.alpha}return t.prototype.apply=function(t){var e=this;if(null==t)return this.visibilityFilters=null,null;null!=this.visibilityFilters&&this.visibilityFilters.length===t.length||(this.visibilityFilters=t.map((function(t){return new M(e.alpha)})));for(var n=[],r=0;r<t.length;++r){var s=t[r],o=i({},s);o.score=this.visibilityFilters[r].apply(s.score),n.push(o)}return n},t}(),ft="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/1",ht="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/lite/1",pt="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/heavy/1",dt={reduceBoxesInLowestlayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:5,minScale:.1484375,maxScale:.75,inputSizeHeight:224,inputSizeWidth:224,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,32,32,32],aspectRatios:[1],fixedAnchorSize:!0},mt={runtime:"tfjs",modelType:"full",enableSmoothing:!0,detectorModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/detector/1",landmarkModelUrl:ft},yt={maxPoses:1,flipHorizontal:!1},gt={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2254,numCoords:12,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:4,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:224,yScale:224,hScale:224,wScale:224,minScoreThresh:.5},bt={minScoreThreshold:-1,minSuppressionThreshold:.3},wt={shiftX:0,shiftY:0,scaleX:1.25,scaleY:1.25,squareLong:!0},vt={inputResolution:{width:224,height:224},keepAspectRatio:!0},xt={inputResolution:{width:256,height:256},keepAspectRatio:!0},Nt=.5,$t={numLandmarks:39,inputImageWidth:256,inputImageHeight:256},Et={numLandmarks:39,inputImageWidth:1,inputImageHeight:1},St={kernelSize:7,minConfidenceToRefine:.5},_t=33,Tt=35,kt={alpha:.1},At={oneEuroFilter:{frequency:30,minCutOff:.05,beta:80,derivateCutOff:1,minAllowedObjectScale:1e-6}},Ct={oneEuroFilter:{frequency:30,minCutOff:.01,beta:10,derivateCutOff:1,minAllowedObjectScale:1e-6}},Ot={oneEuroFilter:{frequency:30,minCutOff:.1,beta:40,derivateCutOff:1,minAllowedObjectScale:1e-6,disableValueScaling:!0}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function It(t){var e=i({},null==t?mt:t);if(null==e.enableSmoothing&&(e.enableSmoothing=mt.enableSmoothing),null==e.modelType&&(e.modelType=mt.modelType),null==e.detectorModelUrl&&(e.detectorModelUrl=mt.detectorModelUrl),null==e.landmarkModelUrl)switch(e.modelType){case"lite":e.landmarkModelUrl=ht;break;case"heavy":e.landmarkModelUrl=pt;break;default:e.landmarkModelUrl=ft}return e}function Mt(t){var e;if(null==(e=null==t?yt:i({},t)).maxPoses&&(e.maxPoses=1),e.maxPoses<=0)throw new Error("Invalid maxPoses "+e.maxPoses+". Should be > 0.");if(e.maxPoses>1)throw new Error("Multi-pose detection is not implemented yet. Please set maxPoses to 1.");return e}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var Rt=function(){function t(t,e,n,s){this.detectorModel=t,this.landmarkModel=e,this.enableSmoothing=n,this.modelType=s,this.regionOfInterest=null,this.anchors=H(dt);var o=r.tensor1d(this.anchors.map((function(t){return t.width}))),i=r.tensor1d(this.anchors.map((function(t){return t.height}))),a=r.tensor1d(this.anchors.map((function(t){return t.xCenter}))),u=r.tensor1d(this.anchors.map((function(t){return t.yCenter})));this.anchorTensor={x:a,y:u,w:o,h:i}}return t.prototype.estimatePoses=function(t,e,n){return a(this,void 0,void 0,(function(){var s,o,i,a,c,f,h,p,d,m,y,g,b,w,$,E,_,T;return u(this,(function(u){switch(u.label){case 0:return s=Mt(e),null==t?(this.reset(),[2,[]]):(this.maxPoses=s.maxPoses,this.timestamp=null!=n?n*x:O(t)?t.currentTime*v:null,o=N(t),i=r.tidy((function(){return r.cast(S(t),"float32")})),null!=(a=this.regionOfInterest)?[3,2]:[4,this.detectPose(i)]);case 1:if(0===(c=u.sent()).length)return this.reset(),i.dispose(),[2,[]];f=c[0],a=this.poseDetectionToRoi(f,o),u.label=2;case 2:return[4,this.poseLandmarksByRoi(a,i)];case 3:return h=u.sent(),i.dispose(),null==h?(this.reset(),[2,[]]):(p=h.actualLandmarks,d=h.auxiliaryLandmarks,m=h.poseScore,y=h.actualWorldLandmarks,g=this.poseLandmarkFiltering(p,d,y,o),b=g.actualLandmarksFiltered,w=g.auxiliaryLandmarksFiltered,$=g.actualWorldLandmarksFiltered,E=this.poseLandmarksToRoi(w,o),this.regionOfInterest=E,null!=(_=null!=b?B(b,o):null)&&_.forEach((function(t,e){t.name=l[e]})),null!=(T=$)&&T.forEach((function(t,e){t.name=l[e]})),[2,[{score:m,keypoints:_,keypoints3D:T}]])}}))}))},t.prototype.dispose=function(){this.detectorModel.dispose(),this.landmarkModel.dispose(),r.dispose([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h])},t.prototype.reset=function(){this.regionOfInterest=null,this.visibilitySmoothingFilterActual=null,this.visibilitySmoothingFilterAuxiliary=null,this.landmarksSmoothingFilterActual=null,this.landmarksSmoothingFilterAuxiliary=null},t.prototype.detectPose=function(t){return a(this,void 0,void 0,(function(){var e,n,s,o,i,a,c,l,f;return u(this,(function(u){switch(u.label){case 0:return e=C(t,vt),n=e.imageTensor,s=e.padding,o=z(n,[-1,1]),i=J(o,this.detectorModel),a=i.boxes,[4,nt([c=i.scores,a],this.anchorTensor,gt)];case 1:return[4,Z(u.sent(),this.maxPoses,bt.minSuppressionThreshold,bt.minScoreThreshold)];case 2:return l=u.sent(),f=tt(l,s),r.dispose([n,o,c,a]),[2,f]}}))}))},t.prototype.poseDetectionToRoi=function(t,e){return ut(U(t,e,{rotationVectorEndKeypointIndex:1,rotationVectorStartKeypointIndex:0,rotationVectorTargetAngleDegree:90}),e,wt)},t.prototype.poseLandmarksByRoi=function(t,e){return a(this,void 0,void 0,(function(){var n,s,o,i,a,c,l,f,h,p,d,m,y,g,b,w,v,x,N,$;return u(this,(function(u){switch(u.label){case 0:if(n=C(e,xt,t),s=n.imageTensor,o=n.padding,i=z(s,[0,1]),"lite"!==this.modelType&&"full"!==this.modelType&&"heavy"!==this.modelType)throw new Error("Model type must be one of lite, full or heavy,but got "+this.modelType);return a=this.landmarkModel.execute(i,["ld_3d","output_poseflag","activation_heatmap","world_3d"]),c=a[0],l=a[1],f=a[2],h=a[3],[4,l.data()];case 1:return(p=u.sent()[0])<Nt?(r.dispose(a),r.dispose([s,i]),[2,null]):[4,at(c,$t)];case 2:return[4,Q(d=u.sent(),f,St)];case 3:return m=u.sent(),y=et(m,o),g=j(y,t),b=g.slice(0,_t),w=g.slice(_t,Tt),[4,at(h,Et)];case 4:return v=u.sent(),x=G(d,v,!0),N=q(x,t),$=N.slice(0,_t),r.dispose(a),r.dispose([s,i]),[2,{actualLandmarks:b,auxiliaryLandmarks:w,poseScore:p,actualWorldLandmarks:$}]}}))}))},t.prototype.poseLandmarksToRoi=function(t,e){return ut(U(Y(t),e,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:1,rotationVectorTargetAngleDegree:90}),e,wt)},t.prototype.poseLandmarkFiltering=function(t,e,n,r){var s,o,i;if(null!=this.timestamp&&this.enableSmoothing){var a=U(Y(e),r,{rotationVectorEndKeypointIndex:0,rotationVectorStartKeypointIndex:1,rotationVectorTargetAngleDegree:90});null==this.visibilitySmoothingFilterActual&&(this.visibilitySmoothingFilterActual=new lt(kt)),s=this.visibilitySmoothingFilterActual.apply(t),null==this.visibilitySmoothingFilterAuxiliary&&(this.visibilitySmoothingFilterAuxiliary=new lt(kt)),o=this.visibilitySmoothingFilterAuxiliary.apply(e),i=this.visibilitySmoothingFilterActual.apply(n),null==this.landmarksSmoothingFilterActual&&(this.landmarksSmoothingFilterActual=new V(At)),s=this.landmarksSmoothingFilterActual.apply(s,this.timestamp,r,!0,a),null==this.landmarksSmoothingFilterAuxiliary&&(this.landmarksSmoothingFilterAuxiliary=new V(Ct)),o=this.landmarksSmoothingFilterAuxiliary.apply(o,this.timestamp,r,!0,a),null==this.worldLandmarksSmoothingFilterActual&&(this.worldLandmarksSmoothingFilterActual=new V(Ot)),i=this.worldLandmarksSmoothingFilterActual.apply(n,this.timestamp)}else s=t,o=e,i=n;return{actualLandmarksFiltered:s,auxiliaryLandmarksFiltered:o,actualWorldLandmarksFiltered:i}},t}();function Dt(t){return a(this,void 0,void 0,(function(){var e,r,s,o,i,a;return u(this,(function(u){switch(u.label){case 0:return e=It(t),r=e.detectorModelUrl.indexOf("https://tfhub.dev")>-1,s=e.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,Promise.all([n.loadGraphModel(e.detectorModelUrl,{fromTFHub:r}),n.loadGraphModel(e.landmarkModelUrl,{fromTFHub:s})])];case 1:return o=u.sent(),i=o[0],a=o[1],[2,new Rt(i,a,e.enableSmoothing,e.modelType)]}}))}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Ft(t){if(t.maxTracks<1)throw new Error("Must specify 'maxTracks' to be at least 1, but encountered "+t.maxTracks);if(t.maxAge<=0)throw new Error("Must specify 'maxAge' to be positive, but encountered "+t.maxAge);if(void 0!==t.keypointTrackerParams){if(t.keypointTrackerParams.keypointConfidenceThreshold<0||t.keypointTrackerParams.keypointConfidenceThreshold>1)throw new Error("Must specify 'keypointConfidenceThreshold' to be in the range [0, 1], but encountered "+t.keypointTrackerParams.keypointConfidenceThreshold);if(t.keypointTrackerParams.minNumberOfKeypoints<1)throw new Error("Must specify 'minNumberOfKeypoints' to be at least 1, but encountered "+t.keypointTrackerParams.minNumberOfKeypoints);for(var e=0,n=t.keypointTrackerParams.keypointFalloff;e<n.length;e++){var r=n[e];if(r<=0)throw new Error("Must specify each keypoint falloff parameterto be positive but encountered "+r)}}}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var Lt,Pt,Bt=function(){function t(t){Ft(t),this.tracks=[],this.maxTracks=t.maxTracks,this.maxAge=1e3*t.maxAge,this.minSimilarity=t.minSimilarity,this.nextID=1}return t.prototype.apply=function(t,e){this.filterOldTracks(e);var n=this.computeSimilarity(t);return this.assignTracks(t,n,e),this.updateTracks(e),t},t.prototype.getTracks=function(){return this.tracks.slice()},t.prototype.getTrackIDs=function(){return new Set(this.tracks.map((function(t){return t.id})))},t.prototype.filterOldTracks=function(t){var e=this;this.tracks=this.tracks.filter((function(n){return t-n.lastTimestamp<=e.maxAge}))},t.prototype.assignTracks=function(t,e,n){for(var r=Array.from(Array(e[0].length).keys()),s=[],o=0,i=Array.from(Array(t.length).keys());o<i.length;o++){var a=i[o];if(0!==r.length){for(var u=-1,c=-1,l=0,f=r;l<f.length;l++){var h=f[l],p=e[a][h];p>=this.minSimilarity&&p>c&&(u=h,c=p)}if(u>=0){var d=this.tracks[u];d=Object.assign(d,this.createTrack(t[a],n,d.id)),t[a].id=d.id;var m=r.indexOf(u);r.splice(m,1)}else s.push(a)}else s.push(a)}for(var y=0,g=s;y<g.length;y++){a=g[y];var b=this.createTrack(t[a],n);this.tracks.push(b),t[a].id=b.id}},t.prototype.updateTracks=function(t){this.tracks.sort((function(t,e){return e.lastTimestamp-t.lastTimestamp})),this.tracks=this.tracks.slice(0,this.maxTracks)},t.prototype.createTrack=function(t,e,n){var r={id:n||this.nextTrackID(),lastTimestamp:e,keypoints:t.keypoints.slice().map((function(t){return i({},t)}))};return void 0!==t.box&&(r.box=i({},t.box)),r},t.prototype.nextTrackID=function(){var t=this.nextID;return this.nextID+=1,t},t.prototype.remove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.tracks=this.tracks.filter((function(e){return!t.includes(e.id)}))},t.prototype.reset=function(){this.tracks=[]},t}(),Vt=function(t){function e(e){return t.call(this,e)||this}return o(e,t),e.prototype.computeSimilarity=function(t){var e=this;if(0===t.length||0===this.tracks.length)return[[]];var n=t.map((function(t){return e.tracks.map((function(n){return e.iou(t,n)}))}));return n},e.prototype.iou=function(t,e){var n=Math.max(t.box.xMin,e.box.xMin),r=Math.max(t.box.yMin,e.box.yMin),s=Math.min(t.box.xMax,e.box.xMax),o=Math.min(t.box.yMax,e.box.yMax);if(n>=s||r>=o)return 0;var i=(s-n)*(o-r);return i/(t.box.width*t.box.height+e.box.width*e.box.height-i)},e}(Bt),zt=function(t){function e(e){var n=t.call(this,e)||this;return n.keypointThreshold=e.keypointTrackerParams.keypointConfidenceThreshold,n.keypointFalloff=e.keypointTrackerParams.keypointFalloff,n.minNumKeyoints=e.keypointTrackerParams.minNumberOfKeypoints,n}return o(e,t),e.prototype.computeSimilarity=function(t){if(0===t.length||0===this.tracks.length)return[[]];for(var e=[],n=0,r=t;n<r.length;n++){for(var s=r[n],o=[],i=0,a=this.tracks;i<a.length;i++){var u=a[i];o.push(this.oks(s,u))}e.push(o)}return e},e.prototype.oks=function(t,e){for(var n=this.area(e.keypoints)+1e-6,r=0,s=0,o=0;o<t.keypoints.length;++o){var i=t.keypoints[o],a=e.keypoints[o];if(!(i.score<this.keypointThreshold||a.score<this.keypointThreshold)){s+=1;var u=Math.pow(i.x-a.x,2)+Math.pow(i.y-a.y,2),c=2*this.keypointFalloff[o];r+=Math.exp(-1*u/(2*n*Math.pow(c,2)))}}return s<this.minNumKeyoints?0:r/s},e.prototype.area=function(t){var e=this,n=t.filter((function(t){return t.score>e.keypointThreshold})),r=Math.min.apply(Math,[1].concat(n.map((function(t){return t.x})))),s=Math.max.apply(Math,[0].concat(n.map((function(t){return t.x})))),o=Math.min.apply(Math,[1].concat(n.map((function(t){return t.y}))));return(s-r)*(Math.max.apply(Math,[0].concat(n.map((function(t){return t.y}))))-o)},e}(Bt);
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function Wt(e){switch(e){case t.SupportedModels.BlazePose:return f;case t.SupportedModels.PoseNet:case t.SupportedModels.MoveNet:return h;default:throw new Error("Model "+e+" is not supported.")}}function Ut(e){switch(e){case t.SupportedModels.BlazePose:return d;case t.SupportedModels.PoseNet:case t.SupportedModels.MoveNet:return p;default:throw new Error("Model "+e+" is not supported.")}}function jt(e){switch(e){case t.SupportedModels.BlazePose:return l.reduce((function(t,e,n){return t[e]=n,t}),{});case t.SupportedModels.PoseNet:case t.SupportedModels.MoveNet:return c.reduce((function(t,e,n){return t[e]=n,t}),{});default:throw new Error("Model "+e+" is not supported.")}}(
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
Pt=t.TrackerType||(t.TrackerType={})).Keypoint="keypoint",Pt.BoundingBox="boundingBox",(Lt=t.SupportedModels||(t.SupportedModels={})).MoveNet="MoveNet",Lt.BlazePose="BlazePose",Lt.PoseNet="PoseNet";var Gt=Object.freeze({__proto__:null,getKeypointIndexBySide:Wt,getAdjacentPairs:Ut,getKeypointIndexByName:jt}),qt="SinglePose.Lightning",Ht="SinglePose.Thunder",Kt="MultiPose.Lightning",Xt=[qt,Ht,Kt],Jt="https://tfhub.dev/google/tfjs-model/movenet/singlepose/lightning/4",Yt="https://tfhub.dev/google/tfjs-model/movenet/singlepose/thunder/4",Zt="https://tfhub.dev/google/tfjs-model/movenet/multipose/lightning/1",Qt=192,te=256,ee=256,ne={modelType:qt,enableSmoothing:!0},re={},se={frequency:30,minCutOff:2.5,beta:300,derivateCutOff:2.5,thresholdCutOff:.5,thresholdBeta:5,disableValueScaling:!0},oe=.9,ie=.2,ae=.25,ue=17,ce=3,le=ue*ce,fe=le+4,he=ue*ce+5,pe={maxTracks:18,maxAge:1e3,minSimilarity:.2,keypointTrackerParams:{keypointConfidenceThreshold:.3,keypointFalloff:[.026,.025,.025,.035,.035,.079,.079,.072,.072,.062,.062,.107,.107,.087,.087,.089,.089],minNumberOfKeypoints:4}},de={maxTracks:18,maxAge:1e3,minSimilarity:.15,trackerParams:{}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function me(t,e){return(t[e.left_hip].score>ie||t[e.right_hip].score>ie)&&(t[e.left_shoulder].score>ie||t[e.right_shoulder].score>ie)}function ye(t,e,n,r,s){for(var o=["left_shoulder","right_shoulder","left_hip","right_hip"],i=0,a=0,u=0;u<o.length;u++)(p=Math.abs(r-n[o[u]][0]))>i&&(i=p),(d=Math.abs(s-n[o[u]][1]))>a&&(a=d);for(var c=0,l=0,f=0,h=Object.keys(n);f<h.length;f++){var p,d,m=h[f];t[e[m]].score<ie||((p=Math.abs(r-n[m][0]))>c&&(c=p),(d=Math.abs(s-n[m][1]))>l&&(l=d))}return[i,a,c,l]}function ge(t,e,n,r){for(var s={},o=0,i=c;o<i.length;o++){var a=i[o];s[a]=[e[n[a]].y*r.height,e[n[a]].x*r.width]}if(me(e,n)){var u=(s.left_hip[0]+s.right_hip[0])/2,l=(s.left_hip[1]+s.right_hip[1])/2,f=ye(e,n,s,u,l),h=f[0],p=f[1],d=f[2],m=f[3],y=Math.max(1.9*p,1.9*h,1.2*d,1.2*m),g=[u-(y=Math.min(y,Math.max(l,r.width-l,u,r.height-u))),l-y];if(y>Math.max(r.width,r.height)/2)return be(null==t,r);var b=2*y;return{yMin:g[0]/r.height,xMin:g[1]/r.width,yMax:(g[0]+b)/r.height,xMax:(g[1]+b)/r.width,height:(g[0]+b)/r.height-g[0]/r.height,width:(g[1]+b)/r.width-g[1]/r.width}}return be(null==t,r)}function be(t,e){var n,r,s,o;return t?e.width>e.height?(n=1,r=e.height/e.width,s=0,o=(e.width/2-e.height/2)/e.width):(n=e.width/e.height,r=1,s=(e.height/2-e.width/2)/e.height,o=0):e.width>e.height?(n=e.width/e.height,r=1,s=(e.height/2-e.width/2)/e.height,o=0):(n=1,r=e.height/e.width,s=0,o=(e.width/2-e.height/2)/e.width),{yMin:s,xMin:o,yMax:s+n,xMax:o+r,height:n,width:r}}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function we(e){var n=null==e?ne:i({},e);if(null==n.modelType)n.modelType="SinglePose.Lightning";else if(Xt.indexOf(n.modelType)<0)throw new Error("Invalid architecture "+n.modelType+". Should be one of "+Xt);if(null==n.enableSmoothing&&(n.enableSmoothing=!0),null!=n.minPoseScore&&(n.minPoseScore<0||n.minPoseScore>1))throw new Error("minPoseScore should be between 0.0 and 1.0");if(null!=n.multiPoseMaxDimension&&(n.multiPoseMaxDimension%32!=0||n.multiPoseMaxDimension<128||n.multiPoseMaxDimension>512))throw new Error("multiPoseResolution must be a multiple of 32 and between 128 and 512");if(n.modelType===Kt&&null==n.enableTracking&&(n.enableTracking=!0),n.modelType===Kt&&!0===n.enableTracking)if(null==n.trackerType&&(n.trackerType=t.TrackerType.BoundingBox),n.trackerType===t.TrackerType.Keypoint)null!=n.trackerConfig?n.trackerConfig=Ne(n.trackerConfig):n.trackerConfig=pe;else{if(n.trackerType!==t.TrackerType.BoundingBox)throw new Error("Tracker type not supported by MoveNet");null!=n.trackerConfig?n.trackerConfig=$e(n.trackerConfig):n.trackerConfig=de}return n}function ve(t){return null==t?re:i({},t)}function xe(t,e){var n={maxTracks:t.maxTracks,maxAge:t.maxAge,minSimilarity:t.minSimilarity};return null!=e.maxTracks&&(n.maxTracks=e.maxTracks),null!=e.maxAge&&(n.maxAge=e.maxAge),null!=e.minSimilarity&&(n.minSimilarity=e.minSimilarity),n}function Ne(t){var e=xe(pe,t);return e.keypointTrackerParams=i({},pe.keypointTrackerParams),null!=t.keypointTrackerParams&&(null!=t.keypointTrackerParams.keypointConfidenceThreshold&&(e.keypointTrackerParams.keypointConfidenceThreshold=t.keypointTrackerParams.keypointConfidenceThreshold),null!=t.keypointTrackerParams.keypointFalloff&&(e.keypointTrackerParams.keypointFalloff=t.keypointTrackerParams.keypointFalloff),null!=t.keypointTrackerParams.minNumberOfKeypoints&&(e.keypointTrackerParams.minNumberOfKeypoints=t.keypointTrackerParams.minNumberOfKeypoints)),e}function $e(t){return xe(de,t)}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var Ee=function(){function e(e,n){this.moveNetModel=e,this.modelInputResolution={height:0,width:0},this.keypointIndexByName=jt(t.SupportedModels.MoveNet),n.modelType===qt?(this.modelInputResolution.width=Qt,this.modelInputResolution.height=Qt):n.modelType===Ht&&(this.modelInputResolution.width=te,this.modelInputResolution.height=te),this.multiPoseModel=n.modelType===Kt,this.multiPoseModel||(this.keypointFilter=new D(se),this.cropRegionFilterYMin=new M(oe),this.cropRegionFilterXMin=new M(oe),this.cropRegionFilterYMax=new M(oe),this.cropRegionFilterXMax=new M(oe)),this.enableSmoothing=n.enableSmoothing,n.minPoseScore?this.minPoseScore=n.minPoseScore:this.minPoseScore=ae,n.multiPoseMaxDimension?this.multiPoseMaxDimension=n.multiPoseMaxDimension:this.multiPoseMaxDimension=ee,this.enableTracking=n.enableTracking,this.multiPoseModel&&this.enableTracking&&(n.trackerType===t.TrackerType.Keypoint?this.tracker=new zt(n.trackerConfig):n.trackerType===t.TrackerType.BoundingBox&&(this.tracker=new Vt(n.trackerConfig)),this.enableSmoothing&&(this.keypointFilterMap=new Map))}return e.prototype.runSinglePersonPoseModel=function(t){return a(this,void 0,void 0,(function(){var e,n,s,o,i;return u(this,(function(a){switch(a.label){case 0:if(4!==(e=this.moveNetModel.execute(t)).shape.length||1!==e.shape[0]||1!==e.shape[1]||e.shape[2]!==ue||e.shape[3]!==ce)throw e.dispose(),new Error("Unexpected output shape from model: ["+e.shape+"]");return"webgpu"===r.getBackend()?[3,1]:(n=e.dataSync(),[3,3]);case 1:return[4,e.data()];case 2:n=a.sent(),a.label=3;case 3:for(e.dispose(),s={keypoints:[],score:0},o=0,i=0;i<ue;++i)s.keypoints[i]={y:n[i*ce],x:n[i*ce+1],score:n[i*ce+2]},s.keypoints[i].score>ie&&(++o,s.score+=s.keypoints[i].score);return o>0&&(s.score/=o),[2,s]}}))}))},e.prototype.runMultiPersonPoseModel=function(t){return a(this,void 0,void 0,(function(){var e,n,s,o,i,a,c,l;return u(this,(function(u){switch(u.label){case 0:if(3!==(e=this.moveNetModel.execute(t)).shape.length||1!==e.shape[0]||e.shape[2]!==he)throw e.dispose(),new Error("Unexpected output shape from model: ["+e.shape+"]");return"webgpu"===r.getBackend()?[3,1]:(n=e.dataSync(),[3,3]);case 1:return[4,e.data()];case 2:n=u.sent(),u.label=3;case 3:for(e.dispose(),s=[],o=n.length/he,i=0;i<o;++i)for(s[i]={keypoints:[]},a=i*he+le,s[i].box={yMin:n[a],xMin:n[a+1],yMax:n[a+2],xMax:n[a+3],width:n[a+3]-n[a+1],height:n[a+2]-n[a]},c=i*he+fe,s[i].score=n[c],s[i].keypoints=[],l=0;l<ue;++l)s[i].keypoints[l]={y:n[i*he+l*ce],x:n[i*he+l*ce+1],score:n[i*he+l*ce+2]};return[2,s]}}))}))},e.prototype.estimatePoses=function(t,e,n){return void 0===e&&(e=re),a(this,void 0,void 0,(function(){var s,o,i,a,l,f;return u(this,(function(u){switch(u.label){case 0:return e=ve(e),null==t?(this.reset(),[2,[]]):(null==n?O(t)&&(n=t.currentTime*v):n*=x,s=S(t),o=N(s),i=r.expandDims(s,0),t instanceof r.Tensor||s.dispose(),a=[],this.multiPoseModel?[3,2]:[4,this.estimateSinglePose(i,o,n)]);case 1:return a=u.sent(),[3,4];case 2:return[4,this.estimateMultiplePoses(i,o,n)];case 3:a=u.sent(),u.label=4;case 4:for(l=0;l<a.length;++l)for(f=0;f<a[l].keypoints.length;++f)a[l].keypoints[f].name=c[f],a[l].keypoints[f].y*=o.height,a[l].keypoints[f].x*=o.width;return[2,a]}}))}))},e.prototype.estimateSinglePose=function(t,e,n){return a(this,void 0,void 0,(function(){var s,o,i,a,c=this;return u(this,(function(u){switch(u.label){case 0:return this.cropRegion||(this.cropRegion=be(null==this.cropRegion,e)),s=r.tidy((function(){var e=r.tensor2d([[c.cropRegion.yMin,c.cropRegion.xMin,c.cropRegion.yMax,c.cropRegion.xMax]]),n=r.zeros([1],"int32"),s=[c.modelInputResolution.height,c.modelInputResolution.width];return r.cast(r.image.cropAndResize(t,e,n,s,"bilinear",0),"int32")})),t.dispose(),[4,this.runSinglePersonPoseModel(s)];case 1:if(o=u.sent(),s.dispose(),o.score<this.minPoseScore)return this.reset(),[2,[]];for(i=0;i<o.keypoints.length;++i)o.keypoints[i].y=this.cropRegion.yMin+o.keypoints[i].y*this.cropRegion.height,o.keypoints[i].x=this.cropRegion.xMin+o.keypoints[i].x*this.cropRegion.width;return null!=n&&this.enableSmoothing&&(o.keypoints=this.keypointFilter.apply(o.keypoints,n,1)),a=ge(this.cropRegion,o.keypoints,this.keypointIndexByName,e),this.cropRegion=this.filterCropRegion(a),[2,[o]]}}))}))},e.prototype.estimateMultiplePoses=function(t,e,n){return a(this,void 0,void 0,(function(){var s,o,i,a,c,l,f,h,p,d,m,y,g=this;return u(this,(function(u){switch(u.label){case 0:return f=32,e.width>e.height?(o=this.multiPoseMaxDimension,i=Math.round(this.multiPoseMaxDimension*e.height/e.width),s=r.image.resizeBilinear(t,[i,o]),c=o,l=Math.ceil(i/f)*f,a=r.pad(s,[[0,0],[0,l-i],[0,0],[0,0]])):(o=Math.round(this.multiPoseMaxDimension*e.width/e.height),i=this.multiPoseMaxDimension,s=r.image.resizeBilinear(t,[i,o]),c=Math.ceil(o/f)*f,l=i,a=r.pad(s,[[0,0],[0,0],[0,c-o],[0,0]])),s.dispose(),t.dispose(),h=r.cast(a,"int32"),a.dispose(),[4,this.runMultiPersonPoseModel(h)];case 1:for(p=u.sent(),h.dispose(),p=p.filter((function(t){return t.score>=g.minPoseScore})),m=0;m<p.length;++m)for(d=0;d<p[m].keypoints.length;++d)p[m].keypoints[d].y*=l/i,p[m].keypoints[d].x*=c/o;if(this.enableTracking&&(this.tracker.apply(p,n),this.enableSmoothing)){for(m=0;m<p.length;++m)this.keypointFilterMap.has(p[m].id)||this.keypointFilterMap.set(p[m].id,new D(se)),p[m].keypoints=this.keypointFilterMap.get(p[m].id).apply(p[m].keypoints,n,1);y=this.tracker.getTrackIDs(),this.keypointFilterMap.forEach((function(t,e){y.has(e)||g.keypointFilterMap.delete(e)}))}return[2,p]}}))}))},e.prototype.filterCropRegion=function(t){if(t){var e=this.cropRegionFilterYMin.apply(t.yMin),n=this.cropRegionFilterXMin.apply(t.xMin),r=this.cropRegionFilterYMax.apply(t.yMax),s=this.cropRegionFilterXMax.apply(t.xMax);return{yMin:e,xMin:n,yMax:r,xMax:s,height:r-e,width:s-n}}return this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset(),null},e.prototype.dispose=function(){this.moveNetModel.dispose()},e.prototype.reset=function(){this.cropRegion=null,this.resetFilters()},e.prototype.resetFilters=function(){this.keypointFilter.reset(),this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset()},e}();function Se(t){return void 0===t&&(t=ne),a(this,void 0,void 0,(function(){var e,s,o,i;return u(this,(function(a){switch(a.label){case 0:return e=we(t),o=!0,e.modelUrl?(o=e.modelUrl.indexOf("https://tfhub.dev")>-1,[4,n.loadGraphModel(e.modelUrl,{fromTFHub:o})]):[3,2];case 1:return s=a.sent(),[3,4];case 2:return i=void 0,e.modelType===qt?i=Jt:e.modelType===Ht?i=Yt:e.modelType===Kt&&(i=Zt),[4,n.loadGraphModel(i,{fromTFHub:o})];case 3:s=a.sent(),a.label=4;case 4:return"webgl"===r.getBackend()&&r.env().set("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",0),[2,new Ee(s,e)]}}))}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var _e={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:{height:257,width:257}},Te=["MobileNetV1","ResNet50"],ke={MobileNetV1:[8,16],ResNet50:[16]},Ae=[8,16,32],Ce={MobileNetV1:[.5,.75,1],ResNet50:[1]},Oe=[1,2,4],Ie={maxPoses:1,flipHorizontal:!1},Me={maxPoses:5,flipHorizontal:!1,scoreThreshold:.5,nmsRadius:20},Re=[-123.15,-115.9,-103.06],De=1,Fe=17,Le=[["nose","left_eye"],["left_eye","left_ear"],["nose","right_eye"],["right_eye","right_ear"],["nose","left_shoulder"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["left_shoulder","left_hip"],["left_hip","left_knee"],["left_knee","left_ankle"],["nose","right_shoulder"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["right_shoulder","right_hip"],["right_hip","right_knee"],["right_knee","right_ankle"]];
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function Pe(t){return Math.floor(t/2)}var Be=function(){function t(t,e){this.priorityQueue=new Array(t),this.numberOfElements=-1,this.getElementValue=e}return t.prototype.enqueue=function(t){this.priorityQueue[++this.numberOfElements]=t,this.swim(this.numberOfElements)},t.prototype.dequeue=function(){var t=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,t},t.prototype.empty=function(){return-1===this.numberOfElements},t.prototype.size=function(){return this.numberOfElements+1},t.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},t.prototype.max=function(){return this.priorityQueue[0]},t.prototype.swim=function(t){for(;t>0&&this.less(Pe(t),t);)this.exchange(t,Pe(t)),t=Pe(t)},t.prototype.sink=function(t){for(;2*t<=this.numberOfElements;){var e=2*t;if(e<this.numberOfElements&&this.less(e,e+1)&&e++,!this.less(t,e))break;this.exchange(t,e),t=e}},t.prototype.getValueAt=function(t){return this.getElementValue(this.priorityQueue[t])},t.prototype.less=function(t,e){return this.getValueAt(t)<this.getValueAt(e)},t.prototype.exchange=function(t,e){var n=this.priorityQueue[t];this.priorityQueue[t]=this.priorityQueue[e],this.priorityQueue[e]=n},t}();function Ve(t,e,n,r,s,o){for(var i=o.shape,a=i[0],u=i[1],c=!0,l=Math.max(n-s,0),f=Math.min(n+s+1,a),h=l;h<f;++h){for(var p=Math.max(r-s,0),d=Math.min(r+s+1,u),m=p;m<d;++m)if(o.get(h,m,t)>e){c=!1;break}if(!c)break}return c}function ze(t,e,n){for(var r=n.shape,s=r[0],o=r[1],i=r[2],a=new Be(s*o*i,(function(t){return t.score})),u=0;u<s;++u)for(var c=0;c<o;++c)for(var l=0;l<i;++l){var f=n.get(u,c,l);f<t||Ve(l,f,u,c,e,n)&&a.enqueue({score:f,part:{heatmapY:u,heatmapX:c,id:l}})}return a}function We(t){return a(this,void 0,void 0,(function(){return u(this,(function(e){return[2,Promise.all(t.map((function(t){return t.buffer()})))]}))}))}function Ue(t,e,n,r){return{y:r.get(t,e,n),x:r.get(t,e,n+Fe)}}function je(t,e,n){var r=Ue(t.heatmapY,t.heatmapX,t.id,n),s=r.y,o=r.x;return{x:t.heatmapX*e+o,y:t.heatmapY*e+s}}function Ge(t,e,n,r){var s=n-t,o=r-e;return s*s+o*o}function qe(t,e,n,r){var s=n.x,o=n.y;return t.some((function(t){var n=t.keypoints;return Ge(o,s,n[r].y,n[r].x)<=e}))}var He=c.reduce((function(t,e,n){return t[e]=n,t}),{}),Ke=Le.map((function(t){var e=t[0],n=t[1];return[He[e],He[n]]})),Xe=Ke.map((function(t){return t[1]})),Je=Ke.map((function(t){return t[0]}));function Ye(t,e,n){return t<e?e:t>n?n:t}function Ze(t,e,n,r){return{y:Ye(Math.round(t.y/e),0,n-1),x:Ye(Math.round(t.x/e),0,r-1)}}function Qe(t,e,n){var r=n.shape[2]/2;return{y:n.get(e.y,e.x,t),x:n.get(e.y,e.x,r+t)}}function tn(t,e){return{x:t.x+e.x,y:t.y+e.y}}function en(t,e,n,r,s,o,i,a){void 0===a&&(a=2);for(var u=r.shape,l=u[0],f=u[1],h={y:e.y,x:e.x},p=tn(h,Qe(t,Ze(h,o,l,f),i)),d=0;d<a;d++){var m=Ze(p,o,l,f),y=Ue(m.y,m.x,n,s);p=tn({x:m.x*o,y:m.y*o},{x:y.x,y:y.y})}var g=Ze(p,o,l,f),b=r.get(g.y,g.x,n);return{y:p.y,x:p.x,name:c[n],score:b}}function nn(t,e,n,r,s,o){var i=e.shape[2],a=Xe.length,u=new Array(i),l=t.part,f=t.score,h=je(l,r,n);u[l.id]={score:f,name:c[l.id],y:h.y,x:h.x};for(var p=a-1;p>=0;--p){var d=Xe[p],m=Je[p];u[d]&&!u[m]&&(u[m]=en(p,u[d],m,e,n,r,o))}for(p=0;p<a;++p)d=Je[p],m=Xe[p],u[d]&&!u[m]&&(u[m]=en(p,u[d],m,e,n,r,s));return u}function rn(t,e,n){var r=n.reduce((function(n,r,s){var o=r.y,i=r.x,a=r.score;return qe(t,e,{y:o,x:i},s)||(n+=a),n}),0);return r/n.length}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sn(t,e,n,r,s,o,i,c){return void 0===i&&(i=.5),void 0===c&&(c=20),a(this,void 0,void 0,(function(){var a,l,f,h,p,d,m,y,g,b,w,v;return u(this,(function(u){switch(u.label){case 0:return[4,We([t,e,n,r])];case 1:for(a=u.sent(),l=a[0],f=a[1],h=a[2],p=a[3],d=[],m=ze(i,De,l),y=c*c;d.length<o&&!m.empty();)g=m.dequeue(),b=je(g.part,s,f),qe(d,y,b,g.part.id)||(w=nn(g,l,f,s,h,p),v=rn(d,y,w),d.push({keypoints:w,score:v}));return[2,d]}}))}))}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function on(t,e){return r.tidy((function(){var n=r.div(t,r.scalar(e,"int32"));return r.sub(t,r.mul(n,r.scalar(e,"int32")))}))}function an(t){var e=t.shape,n=e[0],s=e[1],o=e[2];return r.tidy((function(){var e=r.reshape(t,[n*s,o]),i=r.argMax(e,0),a=r.expandDims(r.div(i,r.scalar(s,"int32")),1),u=r.expandDims(on(i,s),1);return r.concat([a,u],1)}))}function un(t,e){for(var n=e.shape[0],r=new Float32Array(n),s=0;s<n;s++){var o=e.get(s,0),i=e.get(s,1);r[s]=t.get(o,i,s)}return r}function cn(t,e,n){return r.tidy((function(){var s=ln(t,n);return r.add(r.cast(r.mul(t.toTensor(),r.scalar(e,"int32")),"float32"),s)}))}function ln(t,e){for(var n=[],s=0;s<c.length;s++){var o=fn(t.get(s,0).valueOf(),t.get(s,1).valueOf(),s,e),i=o.x,a=o.y;n.push(a),n.push(i)}return r.tensor2d(n,[c.length,2])}function fn(t,e,n,r){return{y:r.get(t,e,n),x:r.get(t,e,n+c.length)}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function hn(t,e,n){return a(this,void 0,void 0,(function(){var r,s,o,i,a,l,f,h,p,d;return u(this,(function(u){switch(u.label){case 0:return r=0,s=an(t),[4,Promise.all([t.buffer(),e.buffer(),s.buffer()])];case 1:return o=u.sent(),i=o[0],a=o[1],l=o[2],[4,(f=cn(l,n,a)).buffer()];case 2:return h=u.sent(),p=Array.from(un(i,l)),d=p.map((function(t,e){return r+=t,{y:h.get(e,0),x:h.get(e,1),score:t,name:c[e]}})),s.dispose(),f.dispose(),[2,{keypoints:d,score:r/d.length}]}}))}))}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function pn(t,e){for(var n=0,r=t;n<r.length;n++)for(var s=0,o=r[n].keypoints;s<o.length;s++){var i=o[s];i.x=e.width-1-i.x}return t}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function dn(t,e,n,r){var s=e.height,o=e.width,i=s/(n.height*(1-r.top-r.bottom)),a=o/(n.width*(1-r.left-r.right)),u=-r.top*n.height,c=-r.left*n.width;if(1===a&&1===i&&0===u&&0===c)return t;for(var l=0,f=t;l<f.length;l++)for(var h=0,p=f[l].keypoints;h<p.length;h++){var d=p[h];d.x=(d.x+c)*a,d.y=(d.y+u)*i}return t}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function mn(t){var e=t||_e;if(null==e.architecture&&(e.architecture="MobileNetV1"),Te.indexOf(e.architecture)<0)throw new Error("Invalid architecture "+e.architecture+". Should be one of "+Te);if(null==e.inputResolution&&(e.inputResolution={height:257,width:257}),null==e.outputStride&&(e.outputStride=16),ke[e.architecture].indexOf(e.outputStride)<0)throw new Error("Invalid outputStride "+e.outputStride+". Should be one of "+ke[e.architecture]+" for architecture "+e.architecture+".");if(null==e.multiplier&&(e.multiplier=1),Ce[e.architecture].indexOf(e.multiplier)<0)throw new Error("Invalid multiplier "+e.multiplier+". Should be one of "+Ce[e.architecture]+" for architecture "+e.architecture+".");if(null==e.quantBytes&&(e.quantBytes=4),Oe.indexOf(e.quantBytes)<0)throw new Error("Invalid quantBytes "+e.quantBytes+". Should be one of "+Oe+" for architecture "+e.architecture+".");if("MobileNetV1"===e.architecture&&32===e.outputStride&&1!==e.multiplier)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return e}function yn(t){r.util.assert(Ae.indexOf(t)>=0,(function(){return"outputStride of "+t+" is invalid. It must be either 8 or 16."}))}function gn(t,e){return(t-1)%e==0}function bn(t,e){r.util.assert(gn(t.height,e),(function(){return"height of "+t.height+" is invalid for output stride "+e+"."})),r.util.assert(gn(t.width,e),(function(){return"width of "+t.width+" is invalid for output stride "+e+"."}))}function wn(t){var e=t;if(null==e.maxPoses&&(e.maxPoses=1),e.maxPoses<=0)throw new Error("Invalid maxPoses "+e.maxPoses+". Should be > 0.");if(e.maxPoses>1){if((e=i({},Me,e)).scoreThreshold<0||e.scoreThreshold>1)throw new Error("Invalid scoreThreshold "+e.scoreThreshold+". Should be in range [0.0, 1.0]");if(e.nmsRadius<=0)throw new Error("Invalid nmsRadius "+e.nmsRadius+".")}return e}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var vn="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",xn="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/";function Nn(t,e){var n="model-stride"+t+".json";return 4===e?xn+"float/"+n:xn+"quant"+e+"/"+n}function $n(t,e,n){var r={1:"100",.75:"075",.5:"050"},s="model-stride"+t+".json";return 4===n?vn+"float/"+r[e]+"/"+s:vn+"quant"+n+"/"+r[e]+"/"+s}function En(t,e){return{height:Sn(t.height,e),width:Sn(t.width,e)}}function Sn(t,e){return _n(t,e)?t:Math.floor(t/e)*e+1}function _n(t,e){return(t-1)%e==0}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var Tn=function(){function t(t,e){this.posenetModel=t;var n=this.posenetModel.inputs[0].shape;r.util.assert(-1===n[1]&&-1===n[2],(function(){return"Input shape ["+n[1]+", "+n[2]+"] must both be equal to or -1"}));var s=En(e.inputResolution,e.outputStride);yn(e.outputStride),bn(s,e.outputStride),this.inputResolution=s,this.outputStride=e.outputStride,this.architecture=e.architecture}return t.prototype.estimatePoses=function(t,e){return void 0===e&&(e=Ie),a(this,void 0,void 0,(function(){var n,s,o,i,a,c,l,f,h,p,d,m,y,g,b;return u(this,(function(u){switch(u.label){case 0:return n=wn(e),null==t?[2,[]]:(this.maxPoses=n.maxPoses,s=C(t,{inputResolution:this.inputResolution,keepAspectRatio:!0}),o=s.imageTensor,i=s.padding,a="ResNet50"===this.architecture?r.add(o,Re):z(o,[-1,1]),c=this.posenetModel.predict(a),"ResNet50"===this.architecture?(l=r.squeeze(c[2],[0]),f=r.squeeze(c[3],[0]),h=r.squeeze(c[0],[0]),p=r.squeeze(c[1],[0])):(l=r.squeeze(c[0],[0]),f=r.squeeze(c[1],[0]),h=r.squeeze(c[2],[0]),p=r.squeeze(c[3],[0])),d=r.sigmoid(f),1!==this.maxPoses?[3,2]:[4,hn(d,l,this.outputStride)]);case 1:return y=u.sent(),m=[y],[3,4];case 2:return[4,sn(d,l,h,p,this.outputStride,this.maxPoses,n.scoreThreshold,n.nmsRadius)];case 3:m=u.sent(),u.label=4;case 4:return g=N(t),b=dn(m,g,this.inputResolution,i),n.flipHorizontal&&(b=pn(b,g)),o.dispose(),a.dispose(),r.dispose(c),l.dispose(),f.dispose(),h.dispose(),p.dispose(),d.dispose(),[2,b]}}))}))},t.prototype.dispose=function(){this.posenetModel.dispose()},t.prototype.reset=function(){},t}();function kn(t){return void 0===t&&(t=_e),a(this,void 0,void 0,(function(){var e,r,s,o,i;return u(this,(function(a){switch(a.label){case 0:return"ResNet50"!==(e=mn(t)).architecture?[3,2]:(r=Nn(e.outputStride,e.quantBytes),[4,n.loadGraphModel(e.modelUrl||r)]);case 1:return s=a.sent(),[2,new Tn(s,e)];case 2:return o=$n(e.outputStride,e.multiplier,e.quantBytes),[4,n.loadGraphModel(e.modelUrl||o)];case 3:return i=a.sent(),[2,new Tn(i,e)]}}))}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function An(e,n){return a(this,void 0,void 0,(function(){var r,s;return u(this,(function(o){switch(e){case t.SupportedModels.PoseNet:return[2,kn(n)];case t.SupportedModels.BlazePose:if(s=void 0,null!=(r=n)){if("tfjs"===r.runtime)return[2,Dt(n)];if("mediapipe"===r.runtime)return[2,b(n)];s=r.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+s);case t.SupportedModels.MoveNet:return[2,Se(n)];default:throw new Error(e+" is not a supported model name.")}}))}))}var Cn={keypointsToNormalizedKeypoints:F},On={modelType:{SINGLEPOSE_LIGHTNING:qt,SINGLEPOSE_THUNDER:Ht,MULTIPOSE_LIGHTNING:Kt}};t.calculators=Cn,t.createDetector=An,t.movenet=On,t.util=Gt,Object.defineProperty(t,"q",{value:!0})}(oz.exports,0,sz(HQ),sz(IZ));var KQ=nz({__proto__:null,default:rz(oz.exports)},[oz.exports]);let XQ;class JQ extends d{get poseType(){return"posedetection"}get parts(){return["nose","left_eye_inner","left_eye","left_eye_outer","right_eye_inner","right_eye","right_eye_outer","left_ear","right_ear","mouth_left","mouth_right","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_pinky","right_pinky","left_index","right_index","left_thumb","right_thumb","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle","left_heel","right_heel","left_foot_index","right_foot_index"]}async onMetadata(){super.onMetadata(),await async function(){const t=KQ.SupportedModels.BlazePose;XQ=await KQ.createDetector(t,{runtime:"mediapipe",modelType:"BlazePose",solutionPath:"https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.4.1630009814"})}(),this.poseDetectionFrame()}async poseDetectionFrame(){if((this.isPlaying||this.forceOneTimePoseProcess)&&this.videoEl.readyState>1){const t=await(async(t,e=0,n=0)=>{const r=[];if(XQ){const s=await XQ.estimatePoses(t.videoElement);s&&s.forEach(((s,o)=>{var i;const a={time:Date.now()-e,score:s.score,pose:o,points:[],aspectRatio:t.aspectRatio};null===(i=s.keypoints)||void 0===i||i.forEach((e=>{e.score&&e.score>=n&&a.points.push({name:e.name,score:e.score,position:[e.x/t.naturalSize.width,e.y/t.naturalSize.height,e.z]})})),a.points.length>0&&r.push(a)}))}return r})(this,this.recordingStartTime,this.minConfidence/100);this.onPoseFrame(t),this.forceOneTimePoseProcess=!1}requestAnimationFrame((()=>this.poseDetectionFrame()))}}function YQ(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(n){if("default"!==n&&!(n in t)){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}))})),Object.freeze(t)}customElements.define("posedetection-video",JQ);var ZQ="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function QQ(t){return t&&t.q&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function t0(t){if(t.q)return t;var e=Object.defineProperty({},"q",{value:!0});return Object.keys(t).forEach((function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})})),e}var e0={},n0={},r0={},s0="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};(function(){var t;function e(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}var n="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t};var r=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof s0&&s0];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function s(t,e){if(e)t:{var s=r;t=t.split(".");for(var o=0;o<t.length-1;o++){var i=t[o];if(!(i in s))break t;s=s[i]}(e=e(o=s[t=t[t.length-1]]))!=o&&null!=e&&n(s,t,{configurable:!0,writable:!0,value:e})}}function o(t){return(t={next:t})[Symbol.iterator]=function(){return this},t}function i(t){var n="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return n?n.call(t):{next:e(t)}}function a(t){if(!(t instanceof Array)){t=i(t);for(var e,n=[];!(e=t.next()).done;)n.push(e.value);t=n}return t}s("Symbol",(function(t){function e(t,e){this.g=t,n(this,"description",{configurable:!0,writable:!0,value:e})}if(t)return t;e.prototype.toString=function(){return this.g};var r="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",s=0;return function t(n){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new e(r+(n||"")+"_"+s++,n)}})),s("Symbol.iterator",(function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var s="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),i=0;i<s.length;i++){var a=r[s[i]];"function"==typeof a&&"function"!=typeof a.prototype[t]&&n(a.prototype,t,{configurable:!0,writable:!0,value:function(){return o(e(this))}})}return t}));var u,c="function"==typeof Object.create?Object.create:function(t){function e(){}return e.prototype=t,new e};if("function"==typeof Object.setPrototypeOf)u=Object.setPrototypeOf;else{var l;t:{var f={};try{f.__proto__={a:!0},l=f.a;break t}catch(t){}l=!1}u=l?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var h=u;function p(t,e){if(t.prototype=c(e.prototype),t.prototype.constructor=t,h)h(t,e);else for(var n in e)if("prototype"!=n)if(Object.defineProperties){var r=Object.getOwnPropertyDescriptor(e,n);r&&Object.defineProperty(t,n,r)}else t[n]=e[n];t.ra=e.prototype}function d(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.u=this.o=0,this.j=null}function m(t){if(t.l)throw new TypeError("Generator is already running");t.l=!0}function y(t,e){t.j={fa:e,ga:!0},t.g=t.o||t.u}function g(t,e,n){return t.g=n,{value:e}}function b(t){this.g=new d,this.h=t}function w(t,e,n,r){try{var s=e.call(t.g.i,n);if(!(s instanceof Object))throw new TypeError("Iterator result "+s+" is not an object");if(!s.done)return t.g.l=!1,s;var o=s.value}catch(e){return t.g.i=null,y(t.g,e),v(t)}return t.g.i=null,r.call(t.g,o),v(t)}function v(t){for(;t.g.g;)try{var e=t.h(t.g);if(e)return t.g.l=!1,{value:e.value,done:!1}}catch(e){t.g.h=void 0,y(t.g,e)}if(t.g.l=!1,t.g.j){if(e=t.g.j,t.g.j=null,e.ga)throw e.fa;return{value:e.return,done:!0}}return{value:void 0,done:!0}}function x(t){this.next=function(e){return m(t.g),t.g.i?e=w(t,t.g.i.next,e,t.g.s):(t.g.s(e),e=v(t)),e},this.throw=function(e){return m(t.g),t.g.i?e=w(t,t.g.i.throw,e,t.g.s):(y(t.g,e),e=v(t)),e},this.return=function(e){return function(t,e){m(t.g);var n=t.g.i;return n?w(t,"return"in n?n.return:function(t){return{value:t,done:!0}},e,t.g.return):(t.g.return(e),v(t))}(t,e)},this[Symbol.iterator]=function(){return this}}function N(t){return function(t){function e(e){return t.next(e)}function n(e){return t.throw(e)}return new Promise((function(r,s){!function t(o){o.done?r(o.value):Promise.resolve(o.value).then(e,n).then(t,s)}(t.next())}))}(new x(new b(t)))}d.prototype.s=function(t){this.h=t},d.prototype.return=function(t){this.j={return:t},this.g=this.u},s("Promise",(function(t){function e(t){this.h=0,this.i=void 0,this.g=[],this.s=!1;var e=this.j();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function n(){this.g=null}function s(t){return t instanceof e?t:new e((function(e){e(t)}))}if(t)return t;n.prototype.h=function(t){if(null==this.g){this.g=[];var e=this;this.i((function(){e.l()}))}this.g.push(t)};var o=r.setTimeout;n.prototype.i=function(t){o(t,0)},n.prototype.l=function(){for(;this.g&&this.g.length;){var t=this.g;this.g=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.j(t)}}}this.g=null},n.prototype.j=function(t){this.i((function(){throw t}))},e.prototype.j=function(){function t(t){return function(r){n||(n=!0,t.call(e,r))}}var e=this,n=!1;return{resolve:t(this.D),reject:t(this.l)}},e.prototype.D=function(t){if(t===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.H(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.A(t):this.o(t)}},e.prototype.A=function(t){var e=void 0;try{e=t.then}catch(t){return void this.l(t)}"function"==typeof e?this.I(e,t):this.o(t)},e.prototype.l=function(t){this.u(2,t)},e.prototype.o=function(t){this.u(1,t)},e.prototype.u=function(t,e){if(0!=this.h)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.h);this.h=t,this.i=e,2===this.h&&this.G(),this.B()},e.prototype.G=function(){var t=this;o((function(){if(t.C()){var e=r.console;void 0!==e&&e.error(t.i)}}),1)},e.prototype.C=function(){if(this.s)return!1;var t=r.CustomEvent,e=r.Event,n=r.dispatchEvent;return void 0===n||("function"==typeof t?t=new t("unhandledrejection",{cancelable:!0}):"function"==typeof e?t=new e("unhandledrejection",{cancelable:!0}):(t=r.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,t),t.promise=this,t.reason=this.i,n(t))},e.prototype.B=function(){if(null!=this.g){for(var t=0;t<this.g.length;++t)a.h(this.g[t]);this.g=null}};var a=new n;return e.prototype.H=function(t){var e=this.j();t.M(e.resolve,e.reject)},e.prototype.I=function(t,e){var n=this.j();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},e.prototype.then=function(t,n){function r(t,e){return"function"==typeof t?function(e){try{s(t(e))}catch(t){o(t)}}:e}var s,o,i=new e((function(t,e){s=t,o=e}));return this.M(r(t,s),r(n,o)),i},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.M=function(t,e){function n(){switch(r.h){case 1:t(r.i);break;case 2:e(r.i);break;default:throw Error("Unexpected state: "+r.h)}}var r=this;null==this.g?a.h(n):this.g.push(n),this.s=!0},e.resolve=s,e.reject=function(t){return new e((function(e,n){n(t)}))},e.race=function(t){return new e((function(e,n){for(var r=i(t),o=r.next();!o.done;o=r.next())s(o.value).M(e,n)}))},e.all=function(t){var n=i(t),r=n.next();return r.done?s([]):new e((function(t,e){function o(e){return function(n){i[e]=n,0==--a&&t(i)}}var i=[],a=0;do{i.push(void 0),a++,s(r.value).M(o(i.length-1),e),r=n.next()}while(!r.done)}))},e}));var $="function"==typeof Object.assign?Object.assign:function(t,e){for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r)for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t};s("Object.assign",(function(t){return t||$})),s("Object.is",(function(t){return t||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}})),s("Array.prototype.includes",(function(t){return t||function(t,e){var n=this;n instanceof String&&(n=String(n));var r=n.length;for(0>(e=e||0)&&(e=Math.max(e+r,0));e<r;e++){var s=n[e];if(s===t||Object.is(s,t))return!0}return!1}})),s("String.prototype.includes",(function(t){return t||function(t,e){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==this.indexOf(t,e||0)}})),s("Array.prototype.keys",(function(t){return t||function(){return function(t,e){t instanceof String&&(t+="");var n=0,r=!1,s={next:function(){if(!r&&n<t.length){var s=n++;return{value:e(s,t[s]),done:!1}}return r=!0,{done:!0,value:void 0}}};return s[Symbol.iterator]=function(){return s},s}(this,(function(t){return t}))}}));var E=this||self;function S(t,e){t=t.split(".");var n,r=E;t[0]in r||void 0===r.execScript||r.execScript("var "+t[0]);for(;t.length&&(n=t.shift());)t.length||void 0===e?r=r[n]&&r[n]!==Object.prototype[n]?r[n]:r[n]={}:r[n]=e}function _(){throw Error("Invalid UTF8")}function T(t,e){return e=String.fromCharCode.apply(null,e),null==t?e:t+e}var k,A,C="undefined"!=typeof TextDecoder,O="undefined"!=typeof TextEncoder,I={},M=null;function R(t){var e;void 0===e&&(e=0),F(),e=I[e];for(var n=Array(Math.floor(t.length/3)),r=e[64]||"",s=0,o=0;s<t.length-2;s+=3){var i=t[s],a=t[s+1],u=t[s+2],c=e[i>>2];i=e[(3&i)<<4|a>>4],a=e[(15&a)<<2|u>>6],u=e[63&u],n[o++]=c+i+a+u}switch(c=0,u=r,t.length-s){case 2:u=e[(15&(c=t[s+1]))<<2]||r;case 1:t=t[s],n[o]=e[t>>2]+e[(3&t)<<4|c>>4]+u+r}return n.join("")}function D(t){var e=t.length,n=3*e/4;n%3?n=Math.floor(n):-1!="=.".indexOf(t[e-1])&&(n=-1!="=.".indexOf(t[e-2])?n-2:n-1);var r=new Uint8Array(n),s=0;return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),s=M[n];if(null!=s)return s;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}F();for(var r=0;;){var s=n(-1),o=n(0),i=n(64),a=n(64);if(64===a&&-1===s)break;e(s<<2|o>>4),64!=i&&(e(o<<4&240|i>>2),64!=a&&e(i<<6&192|a))}}(t,(function(t){r[s++]=t})),s!==n?r.subarray(0,s):r}function F(){if(!M){M={};for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++){var r=t.concat(e[n].split(""));I[n]=r;for(var s=0;s<r.length;s++){var o=r[s];void 0===M[o]&&(M[o]=s)}}}}var L,P="function"==typeof Uint8Array;function B(t){return P&&null!=t&&t instanceof Uint8Array}function V(t){if(this.L=t,null!==t&&0===t.length)throw Error("ByteString should be constructed with non-empty values")}var z="function"==typeof Uint8Array.prototype.slice,W=0;function U(t,e){return Error("Invalid wire type: "+t+" (at position "+e+")")}function j(){return Error("Failed to read varint, encoding is invalid.")}function G(t,e){e=void 0!==(e=void 0===e?{}:e).v&&e.v,this.h=null,this.g=this.i=this.j=0,this.v=e,t&&q(this,t)}function q(t,e){t.h=function(t,e){if(t.constructor===Uint8Array)return t;if(t.constructor===ArrayBuffer)return new Uint8Array(t);if(t.constructor===Array)return new Uint8Array(t);if(t.constructor===String)return D(t);if(t.constructor===V)return!e&&(e=t.L)&&e.constructor===Uint8Array?e:(e=null==(e=t.L)||B(e)?e:"string"==typeof e?D(e):null,(t=t.L=e)?new Uint8Array(t):L||(L=new Uint8Array(0)));if(t instanceof Uint8Array)return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, or Array of numbers")}(e,t.v),t.j=0,t.i=t.h.length,t.g=t.j}function H(t){if(t.g>t.i)throw Error("Tried to read past the end of the data "+t.g+" > "+t.i)}function K(t){var e=t.h,n=e[t.g],r=127&n;if(128>n)return t.g+=1,H(t),r;if(r|=(127&(n=e[t.g+1]))<<7,128>n)return t.g+=2,H(t),r;if(r|=(127&(n=e[t.g+2]))<<14,128>n)return t.g+=3,H(t),r;if(r|=(127&(n=e[t.g+3]))<<21,128>n)return t.g+=4,H(t),r;if(n=e[t.g+4],t.g+=5,r|=(15&n)<<28,128>n)return H(t),r;if(128<=e[t.g++]&&128<=e[t.g++]&&128<=e[t.g++]&&128<=e[t.g++]&&128<=e[t.g++])throw j();return H(t),r}G.prototype.reset=function(){this.g=this.j};var X=[];function J(){this.g=[]}function Y(t,e){for(;127<e;)t.g.push(127&e|128),e>>>=7;t.g.push(e)}function Z(t){var e={},n=void 0!==e.W&&e.W;this.l={v:void 0!==e.v&&e.v},this.W=n,e=this.l,X.length?(n=X.pop(),e&&(n.v=e.v),t&&q(n,t),t=n):t=new G(t,e),this.g=t,this.j=this.g.g,this.h=this.i=-1}function Q(t){var e=t.g;if(e.g==e.i)return!1;t.j=t.g.g;var n=K(t.g)>>>0;if(e=n>>>3,!(0<=(n&=7)&&5>=n))throw U(n,t.j);if(1>e)throw Error("Invalid field number: "+e+" (at position "+t.j+")");return t.i=e,t.h=n,!0}function tt(t){switch(t.h){case 0:if(0!=t.h)tt(t);else t:{for(var e=(t=t.g).g,n=e+10;e<n;)if(0==(128&t.h[e++])){t.g=e,H(t);break t}throw j()}break;case 1:(t=t.g).g+=8,H(t);break;case 2:2!=t.h?tt(t):(e=K(t.g)>>>0,(t=t.g).g+=e,H(t));break;case 5:(t=t.g).g+=4,H(t);break;case 3:for(e=t.i;;){if(!Q(t))throw Error("Unmatched start-group tag: stream EOF");if(4==t.h){if(t.i!=e)throw Error("Unmatched end-group tag");break}tt(t)}break;default:throw U(t.h,t.j)}}J.prototype.length=function(){return this.g.length},J.prototype.end=function(){var t=this.g;return this.g=[],t},Z.prototype.reset=function(){this.g.reset(),this.j=this.g.g,this.h=this.i=-1};var et=[];function nt(){this.i=[],this.h=0,this.g=new J}function rt(t,e){0!==e.length&&(t.i.push(e),t.h+=e.length)}var st="function"==typeof Symbol&&"symbol"==typeof Symbol()?Symbol(void 0):void 0;function ot(t,e){Object.isFrozen(t)||(st?t[st]|=e:void 0!==t.N?t.N|=e:Object.defineProperties(t,{N:{value:e,configurable:!0,writable:!0,enumerable:!1}}))}function it(t){var e;return null==(e=st?t[st]:t.N)?0:e}function at(t){return ot(t,1),t}function ut(t){return!!Array.isArray(t)&&!!(2&it(t))}function ct(t){if(!Array.isArray(t))throw Error("cannot mark non-array as immutable");ot(t,2)}function lt(t){return null!==t&&"object"==typeof t&&!Array.isArray(t)&&t.constructor===Object}var ft=Object.freeze(at([]));function ht(t){if(ut(t.m))throw Error("Cannot mutate an immutable Message")}var pt,dt="undefined"!=typeof Symbol&&void 0!==Symbol.hasInstance;function mt(t){return{value:t,configurable:!1,writable:!1,enumerable:!1}}function yt(t,e,n){return-1===e?null:e>=t.i?t.g?t.g[e]:void 0:void 0!==n&&n&&t.g&&null!=(n=t.g[e])?n:t.m[e+t.h]}function gt(t,e,n,r){r=void 0!==r&&r,ht(t),e<t.i&&!r?t.m[e+t.h]=n:(t.g||(t.g=t.m[t.i+t.h]={}))[e]=n}function bt(t,e,n,r){n=void 0===n||n;var s=yt(t,e,r=void 0!==r&&r);return null==s&&(s=ft),ut(t.m)?n&&(ct(s),Object.freeze(s)):(s===ft||ut(s))&&gt(t,e,s=at(s.slice()),r),s}function wt(t,e,n){return null==(t=null==(t=yt(t,e))?t:+t)?void 0===n?0:n:t}function vt(t,e,n,r){t.j||(t.j={});var s=ut(t.m),o=t.j[n];if(!o){r=bt(t,n,!0,void 0!==r&&r),o=[],s=s||ut(r);for(var i=0;i<r.length;i++)o[i]=new e(r[i]),s&&ct(o[i].m);s&&(ct(o),Object.freeze(o)),t.j[n]=o}return o}function xt(t,e,n,r,s){var o=void 0!==o&&o;return ht(t),o=vt(t,n,e,o),n=r||new n,t=bt(t,e),null!=s?(o.splice(s,0,n),t.splice(s,0,n.m)):(o.push(n),t.push(n.m)),n}function Nt(t,e){return null==(t=yt(t,e))?0:t}function $t(t,e){return null==(t=yt(t,e))?"":t}function Et(t){var e=Tt;return _t(t,e=void 0===e?kt:e)}function St(t,e){if(null!=t){if(Array.isArray(t))t=_t(t,e);else if(lt(t)){var n,r={};for(n in t)r[n]=St(t[n],e);t=r}else t=e(t);return t}}function _t(t,e){for(var n=t.slice(),r=0;r<n.length;r++)n[r]=St(n[r],e);return Array.isArray(t)&&1&it(t)&&at(n),n}function Tt(t){return t&&"object"==typeof t&&t.toJSON?t.toJSON():(t=function(t){switch(typeof t){case"number":return isFinite(t)?t:String(t);case"object":if(t&&!Array.isArray(t)){if(B(t))return R(t);if(t instanceof V){var e=t.L;return e=null==e||"string"==typeof e?e:P&&e instanceof Uint8Array?R(e):null,(t.L=e)||""}}}return t}(t),Array.isArray(t)?Et(t):t)}function kt(t){return B(t)?new Uint8Array(t):t}function At(t,e,n){t||(t=pt),pt=null;var r=this.constructor.h;if(t||(t=r?[r]:[]),this.h=(r?0:-1)-(this.constructor.g||0),this.j=void 0,this.m=t,t=(r=this.m.length)-1,r&&lt(r=this.m[t])?(this.i=t-this.h,this.g=r):void 0!==e&&-1<e?(this.i=Math.max(e,t+1-this.h),this.g=void 0):this.i=Number.MAX_VALUE,n)for(e=0;e<n.length;e++)if((t=n[e])<this.i)t+=this.h,(r=this.m[t])?Array.isArray(r)&&at(r):this.m[t]=ft;else{var s=(r=this.g||(this.g=this.m[this.i+this.h]={}))[t];s?Array.isArray(s)&&at(s):r[t]=ft}}function Ct(){At.apply(this,arguments)}if(At.prototype.toJSON=function(){return Et(this.m)},At.prototype.toString=function(){return this.m.toString()},p(Ct,At),dt){var Ot={};Object.defineProperties(Ct,(Ot[Symbol.hasInstance]=mt((function(){throw Error("Cannot perform instanceof checks for MutableMessage")})),Ot))}function It(t,e,n){if(n){var r,s={};for(r in n){var o=n[r],i=o.ja;i||(s.F=o.pa||o.ha.P,o.ba?(s.U=Bt(o.ba),i=function(t){return function(e,n,r){return t.F(e,n,r,t.U)}}(s)):o.da?(s.T=Vt(o.X.g,o.da),i=function(t){return function(e,n,r){return t.F(e,n,r,t.T)}}(s)):i=s.F,o.ja=i),i(e,t,o.X),s={F:s.F,U:s.U,T:s.T}}}!function(t,e){if(e=e.ca){rt(t,t.g.end());for(var n=0;n<e.length;n++)rt(t,e[n])}}(e,t)}var Mt=Symbol();function Rt(t,e,n){return t[Mt]||(t[Mt]=function(t,r){return e(t,r,n)})}function Dt(t){var e=t[Mt];if(!e){var n=Zt(t);e=function(t,e){return Qt(t,e,n)},t[Mt]=e}return e}function Ft(t){var e=function(t){var e=t.ba;return e?Dt(e):(e=t.oa)?Rt(t.X.g,e,t.da):void 0}(t),n=t.X,r=t.ha.O;return e?function(t,s){return r(t,s,n,e)}:function(t,e){return r(t,e,n)}}function Lt(t,e,n,r,s,o){var i=0;for((t=t()).length&&"number"!=typeof t[0]&&(n(e,t[0]),i++);i<t.length;){n=t[i++];for(var a=i+1;a<t.length&&"number"!=typeof t[a];)a++;var u=t[i++];switch(a-=i){case 0:r(e,n,u);break;case 1:r(e,n,u,t[i++]);break;case 2:s(e,n,u,t[i++],t[i++]);break;case 3:a=t[i++];var c=t[i++],l=t[i++];Array.isArray(l)?s(e,n,u,a,c,l):o(e,n,u,a,c,l);break;case 4:o(e,n,u,t[i++],t[i++],t[i++],t[i++]);break;default:throw Error("unexpected number of binary field arguments: "+a)}}return e}var Pt=Symbol();function Bt(t){var e=t[Pt];if(!e){var n=qt(t);e=function(t,e){return ee(t,e,n)},t[Pt]=e}return e}function Vt(t,e){var n=t[Pt];return n||(n=function(t,n){return It(t,n,e)},t[Pt]=n),n}var zt=Symbol();function Wt(t,e){t.push(e)}function Ut(t,e,n){t.push(e,n.P)}function jt(t,e,n,r,s){var o=Bt(s),i=n.P;t.push(e,(function(t,e,n){return i(t,e,n,r,o)}))}function Gt(t,e,n,r,s,o){var i=Vt(r,o),a=n.P;t.push(e,(function(t,e,n){return a(t,e,n,r,i)}))}function qt(t){var e=t[zt];return e||Lt(t,t[zt]=[],Wt,Ut,jt,Gt)}var Ht=Symbol();function Kt(t,e){t[0]=e}function Xt(t,e,n,r){var s=n.O;t[e]=r?function(t,e,n){return s(t,e,n,r)}:s}function Jt(t,e,n,r,s,o){var i=n.O,a=Dt(s);t[e]=function(t,e,n){return i(t,e,n,r,a,o)}}function Yt(t,e,n,r,s,o,i){var a=n.O,u=Rt(r,s,o);t[e]=function(t,e,n){return a(t,e,n,r,u,i)}}function Zt(t){var e=t[Ht];return e||Lt(t,t[Ht]={},Kt,Xt,Jt,Yt)}function Qt(t,e,n){for(;Q(e)&&4!=e.h;){var r=e.i,s=n[r];if(!s){var o=n[0];o&&(o=o[r])&&(s=n[r]=Ft(o))}if(!(s&&s(e,t,r)||(s=e,r=t,o=s.j,tt(s),s.W))){var i=s.g.h;s=o===(s=s.g.g)?L||(L=new Uint8Array(0)):z?i.slice(o,s):new Uint8Array(i.subarray(o,s)),(o=r.ca)?o.push(s):r.ca=[s]}}return t}function te(t,e,n){if(et.length){var r=et.pop();t&&(q(r.g,t),r.i=-1,r.h=-1),t=r}else t=new Z(t);try{return Qt(new e,t,Zt(n))}finally{(e=t.g).h=null,e.j=0,e.i=0,e.g=0,e.v=!1,t.i=-1,t.h=-1,100>et.length&&et.push(t)}}function ee(t,e,n){for(var r=n.length,s=1==r%2,o=s?1:0;o<r;o+=2)(0,n[o+1])(e,t,n[o]);It(t,e,s?n[0]:void 0)}function ne(t,e){var n=new nt;ee(t,n,qt(e)),rt(n,n.g.end()),t=new Uint8Array(n.h);for(var r=(e=n.i).length,s=0,o=0;o<r;o++){var i=e[o];t.set(i,s),s+=i.length}return n.i=[t],t}function re(t,e){return{O:t,P:e}}var se=re((function(t,e,n){if(5!==t.h)return!1;var r=(t=t.g).h[t.g],s=t.h[t.g+1],o=t.h[t.g+2],i=t.h[t.g+3];return t.g+=4,H(t),t=2*((s=(r<<0|s<<8|o<<16|i<<24)>>>0)>>31)+1,r=s>>>23&255,s&=8388607,gt(e,n,255==r?s?NaN:1/0*t:0==r?t*Math.pow(2,-149)*s:t*Math.pow(2,r-150)*(s+Math.pow(2,23))),!0}),(function(t,e,n){if(null!=(e=yt(e,n))){Y(t.g,8*n+5),t=t.g;var r=e;0===(r=(n=0>r?1:0)?-r:r)?0<1/r?W=0:(0,W=2147483648):isNaN(r)?(0,W=2147483647):34028234663852886e22<r?(0,W=(n<<31|2139095040)>>>0):11754943508222875e-54>r?(r=Math.round(r/Math.pow(2,-149)),0,W=(n<<31|r)>>>0):(e=Math.floor(Math.log(r)/Math.LN2),r*=Math.pow(2,-e),16777216<=(r=Math.round(8388608*r))&&++e,0,W=(n<<31|e+127<<23|8388607&r)>>>0),n=W,t.g.push(n>>>0&255),t.g.push(n>>>8&255),t.g.push(n>>>16&255),t.g.push(n>>>24&255)}})),oe=re((function(t,e,n){if(0!==t.h)return!1;for(var r=t.g,s=128,o=0,i=t=0;4>i&&128<=s;i++)s=r.h[r.g++],H(r),o|=(127&s)<<7*i;if(128<=s&&(s=r.h[r.g++],H(r),o|=(127&s)<<28,t|=(127&s)>>4),128<=s)for(i=0;5>i&&128<=s;i++)s=r.h[r.g++],H(r),t|=(127&s)<<7*i+3;if(!(128>s))throw j();return r=o>>>0,(t=2147483648&(s=t>>>0))&&(s=~s>>>0,0==(r=1+~r>>>0)&&(s=s+1>>>0)),r=4294967296*s+(r>>>0),gt(e,n,t?-r:r),!0}),(function(t,e,n){if(null!=(e=yt(e,n))&&null!=e){Y(t.g,8*n),t=t.g;var r=e;for(n=0>r,e=(r=Math.abs(r))>>>0,r=Math.floor((r-e)/4294967296),r>>>=0,n&&(r=~r>>>0,4294967295<(e=1+(~e>>>0))&&(e=0,4294967295<++r&&(r=0))),n=W=e,e=r;0<e||127<n;)t.g.push(127&n|128),n=(n>>>7|e<<25)>>>0,e>>>=7;t.g.push(n)}})),ie=re((function(t,e,n){return 0===t.h&&(gt(e,n,K(t.g)),!0)}),(function(t,e,n){if(null!=(e=yt(e,n))&&null!=e)if(Y(t.g,8*n),t=t.g,0<=(n=e))Y(t,n);else{for(e=0;9>e;e++)t.g.push(127&n|128),n>>=7;t.g.push(1)}})),ae=re((function(t,e,n){if(2!==t.h)return!1;var r,s=K(t.g)>>>0,o=(t=t.g).g;if(t.g+=s,H(t),t=t.h,C)(r=k)||(r=k=new TextDecoder("utf-8",{fatal:!0})),r=r.decode(t.subarray(o,o+s));else{s=o+s;for(var i,a,u,c=[],l=null;o<s;)128>(i=t[o++])?c.push(i):224>i?o>=s?_():(a=t[o++],194>i||128!=(192&a)?(o--,_()):c.push((31&i)<<6|63&a)):240>i?o>=s-1?_():128!=(192&(a=t[o++]))||224===i&&160>a||237===i&&160<=a||128!=(192&(r=t[o++]))?(o--,_()):c.push((15&i)<<12|(63&a)<<6|63&r):244>=i?o>=s-2?_():128!=(192&(a=t[o++]))||0!=a-144+(i<<28)>>30||128!=(192&(r=t[o++]))||128!=(192&(u=t[o++]))?(o--,_()):(i=(7&i)<<18|(63&a)<<12|(63&r)<<6|63&u,i-=65536,c.push(55296+(i>>10&1023),56320+(1023&i))):_(),8192<=c.length&&(l=T(l,c),c.length=0);r=T(l,c)}return gt(e,n,r),!0}),(function(t,e,n){if(null!=(e=yt(e,n))){var r=!1;if(r=void 0!==r&&r,O){if(r&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(e))throw Error("Found an unpaired surrogate");e=(A||(A=new TextEncoder)).encode(e)}else{for(var s=0,o=new Uint8Array(3*e.length),i=0;i<e.length;i++){var a=e.charCodeAt(i);if(128>a)o[s++]=a;else{if(2048>a)o[s++]=a>>6|192;else{if(55296<=a&&57343>=a){if(56319>=a&&i<e.length){var u=e.charCodeAt(++i);if(56320<=u&&57343>=u){a=1024*(a-55296)+u-56320+65536,o[s++]=a>>18|240,o[s++]=a>>12&63|128,o[s++]=a>>6&63|128,o[s++]=63&a|128;continue}i--}if(r)throw Error("Found an unpaired surrogate");a=65533}o[s++]=a>>12|224,o[s++]=a>>6&63|128}o[s++]=63&a|128}}e=o.subarray(0,s)}Y(t.g,8*n+2),Y(t.g,e.length),rt(t,t.g.end()),rt(t,e)}})),ue=re((function(t,e,n,r,s){if(2!==t.h)return!1;e=xt(e,n,r),n=t.g.i,r=K(t.g)>>>0;var o=t.g.g+r,i=o-n;if(0>=i&&(t.g.i=o,s(e,t),i=o-t.g.g),i)throw Error("Message parsing ended unexpectedly. Expected to read "+r+" bytes, instead read "+(r-i)+" bytes, either the data ended unexpectedly or the message misreported its own length");return t.g.g=o,t.g.i=n,!0}),(function(t,e,n,r,s){if(null!=(e=vt(e,r,n)))for(r=0;r<e.length;r++){var o=t;Y(o.g,8*n+2);var i=o.g.end();rt(o,i),i.push(o.h),o=i,s(e[r],t),i=t;var a=o.pop();for(a=i.h+i.g.length()-a;127<a;)o.push(127&a|128),a>>>=7,i.h++;o.push(a),i.h++}}));function ce(){Ct.apply(this,arguments)}if(p(ce,Ct),dt){var le={};Object.defineProperties(ce,(le[Symbol.hasInstance]=mt(Object[Symbol.hasInstance]),le))}function fe(t){ce.call(this,t)}function he(){return[1,ie,2,se,3,ae,4,ae]}function pe(t){ce.call(this,t,-1,me)}function de(){return[1,ue,fe,he]}p(fe,ce),p(pe,ce),pe.prototype.addClassification=function(t,e){return xt(this,1,fe,t,e),this};var me=[1];function ye(t){ce.call(this,t)}function ge(){return[1,se,2,se,3,se,4,se,5,se]}function be(t){ce.call(this,t,-1,ve)}function we(){return[1,ue,ye,ge]}p(ye,ce),p(be,ce);var ve=[1];function xe(t){ce.call(this,t)}function Ne(){return[1,se,2,se,3,se,4,se,5,se,6,oe]}function $e(t,e,n){if(n=t.createShader(0===n?t.VERTEX_SHADER:t.FRAGMENT_SHADER),t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw Error("Could not compile WebGL shader.\n\n"+t.getShaderInfoLog(n));return n}function Ee(t){return vt(t,fe,1).map((function(t){return{index:Nt(t,1),score:wt(t,2),label:null!=yt(t,3)?$t(t,3):void 0,displayName:null!=yt(t,4)?$t(t,4):void 0}}))}function Se(t){return{x:wt(t,1),y:wt(t,2),z:wt(t,3),visibility:null!=yt(t,4)?wt(t,4):void 0}}function _e(t){return t.map((function(t){return vt(te(t,be,we),ye,1).map(Se)}))}function Te(t,e){this.h=t,this.g=e,this.l=0}function ke(t,e,n){return function(t,e){var n=t.g;if(void 0===t.o){var r=$e(n,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",0),s=$e(n,"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D sampler0;\n  void main(){\n    gl_FragColor = texture2D(sampler0, vTex);\n  }",1),o=n.createProgram();if(n.attachShader(o,r),n.attachShader(o,s),n.linkProgram(o),!n.getProgramParameter(o,n.LINK_STATUS))throw Error("Could not compile WebGL program.\n\n"+n.getProgramInfoLog(o));r=t.o=o,n.useProgram(r),s=n.getUniformLocation(r,"sampler0"),t.j={K:n.getAttribLocation(r,"aVertex"),J:n.getAttribLocation(r,"aTex"),qa:s},t.u=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,t.u),n.enableVertexAttribArray(t.j.K),n.vertexAttribPointer(t.j.K,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),t.s=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,t.s),n.enableVertexAttribArray(t.j.J),n.vertexAttribPointer(t.j.J,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.uniform1i(s,0)}r=t.j,n.useProgram(t.o),n.canvas.width=e.width,n.canvas.height=e.height,n.viewport(0,0,e.width,e.height),n.activeTexture(n.TEXTURE0),t.h.bindTexture2d(e.glName),n.enableVertexAttribArray(r.K),n.bindBuffer(n.ARRAY_BUFFER,t.u),n.vertexAttribPointer(r.K,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.J),n.bindBuffer(n.ARRAY_BUFFER,t.s),n.vertexAttribPointer(r.J,2,n.FLOAT,!1,0,0),n.bindFramebuffer(n.DRAW_FRAMEBUFFER?n.DRAW_FRAMEBUFFER:n.FRAMEBUFFER,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.colorMask(!0,!0,!0,!0),n.drawArrays(n.TRIANGLE_FAN,0,4),n.disableVertexAttribArray(r.K),n.disableVertexAttribArray(r.J),n.bindBuffer(n.ARRAY_BUFFER,null),t.h.bindTexture2d(0)}(t,e),"function"==typeof t.g.canvas.transferToImageBitmap?Promise.resolve(t.g.canvas.transferToImageBitmap()):n?Promise.resolve(t.g.canvas):"function"==typeof createImageBitmap?createImageBitmap(t.g.canvas):(void 0===t.i&&(t.i=document.createElement("canvas")),new Promise((function(e){t.i.height=t.g.canvas.height,t.i.width=t.g.canvas.width,t.i.getContext("2d",{}).drawImage(t.g.canvas,0,0,t.g.canvas.width,t.g.canvas.height),e(t.i)})))}function Ae(t){this.g=t}p(xe,ce);var Ce=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Oe(t,e){return e+t}function Ie(t,e){window[t]=e}function Me(t){if(this.g=t,this.listeners={},this.j={},this.H={},this.o={},this.u={},this.I=this.s=this.$=!0,this.D=Promise.resolve(),this.Z="",this.C={},this.locateFile=t&&t.locateFile||Oe,"object"==typeof window)var e=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else{if("undefined"==typeof location)throw Error("solutions can only be loaded on a web page or in a web worker");e=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"}if(this.aa=e,t.options)for(var n=(e=i(Object.keys(t.options))).next();!n.done;n=e.next()){n=n.value;var r=t.options[n].default;void 0!==r&&(this.j[n]="function"==typeof r?r():r)}}function Re(t){var e,n,r,s,o,i,u,c,l,f,h;return N((function(p){switch(p.g){case 1:return t.$?(e=void 0===t.g.files?[]:"function"==typeof t.g.files?t.g.files(t.j):t.g.files,g(p,N((function(t){switch(t.g){case 1:return t.o=2,g(t,WebAssembly.instantiate(Ce),4);case 4:t.g=3,t.o=0;break;case 2:return t.o=0,t.j=null,t.return(!1);case 3:return t.return(!0)}})),2)):p.return();case 2:if(n=p.h,"object"==typeof window)return Ie("createMediapipeSolutionsWasm",{locateFile:t.locateFile}),Ie("createMediapipeSolutionsPackedAssets",{locateFile:t.locateFile}),i=e.filter((function(t){return void 0!==t.data})),u=e.filter((function(t){return void 0===t.data})),c=Promise.all(i.map((function(e){var n=De(t,e.url);if(void 0!==e.path){var r=e.path;n=n.then((function(e){return t.overrideFile(r,e),Promise.resolve(e)}))}return n}))),l=Promise.all(u.map((function(e){return void 0===e.simd||e.simd&&n||!e.simd&&!n?function(t){var e=document.createElement("script");return e.setAttribute("src",t),e.setAttribute("crossorigin","anonymous"),new Promise((function(t){e.addEventListener("load",(function(){t()}),!1),e.addEventListener("error",(function(){t()}),!1),document.body.appendChild(e)}))}(t.locateFile(e.url,t.aa)):Promise.resolve()}))).then((function(){var e,n,r;return N((function(s){if(1==s.g)return e=window.createMediapipeSolutionsWasm,n=window.createMediapipeSolutionsPackedAssets,r=t,g(s,e(n),2);r.h=s.h,s.g=0}))})),f=N((function(e){return t.g.graph&&t.g.graph.url?e=g(e,De(t,t.g.graph.url),0):(e.g=0,e=void 0),e})),g(p,Promise.all([l,c,f]),7);if("function"!=typeof importScripts)throw Error("solutions can only be loaded on a web page or in a web worker");return r=e.filter((function(t){return void 0===t.simd||t.simd&&n||!t.simd&&!n})).map((function(e){return t.locateFile(e.url,t.aa)})),importScripts.apply(null,a(r)),s=t,g(p,createMediapipeSolutionsWasm(Module),6);case 6:s.h=p.h,t.l=new OffscreenCanvas(1,1),t.h.canvas=t.l,o=t.h.GL.createContext(t.l,{antialias:!1,alpha:!1,na:"undefined"!=typeof WebGL2RenderingContext?2:1}),t.h.GL.makeContextCurrent(o),p.g=4;break;case 7:if(t.l=document.createElement("canvas"),!(h=t.l.getContext("webgl2",{}))&&!(h=t.l.getContext("webgl",{})))return alert("Failed to create WebGL canvas context when passing video frame."),p.return();t.G=h,t.h.canvas=t.l,t.h.createContext(t.l,!0,!0,{});case 4:t.i=new t.h.SolutionWasm,t.$=!1,p.g=0}}))}function De(t,e){var n,r;return N((function(s){return e in t.H?s.return(t.H[e]):(n=t.locateFile(e,""),r=fetch(n).then((function(t){return t.arrayBuffer()})),t.H[e]=r,s.return(r))}))}function Fe(t,e,n){var r,s,o,a,u,c,l,f,h,p,d,m,y,b;return N((function(w){switch(w.g){case 1:if(!n)return w.return(e);for(r={},s=0,o=i(Object.keys(n)),a=o.next();!a.done;a=o.next())u=a.value,"string"!=typeof(c=n[u])&&"texture"===c.type&&void 0!==e[c.stream]&&++s;1<s&&(t.I=!1),l=i(Object.keys(n)),a=l.next();case 2:if(a.done){w.g=4;break}if(f=a.value,"string"==typeof(h=n[f]))return y=r,b=f,g(w,function(t,e,n){var r;return N((function(s){return"number"==typeof n||n instanceof Uint8Array||n instanceof t.h.Uint8BlobList?s.return(n):n instanceof t.h.Texture2dDataOut?((r=t.u[e])||(r=new Te(t.h,t.G),t.u[e]=r),s.return(ke(r,n,t.I))):s.return(void 0)}))}(t,f,e[h]),14);if(p=e[h.stream],"detection_list"===h.type){if(p){for(var v=p.getRectList(),x=p.getLandmarksList(),$=p.getClassificationsList(),E=[],S=0;S<v.size();++S){var _=te(v.get(S),xe,Ne);_={ea:{ka:wt(_,1),la:wt(_,2),height:wt(_,3),width:wt(_,4),rotation:wt(_,5,0),ia:Nt(_,6)},Y:vt(te(x.get(S),be,we),ye,1).map(Se),V:Ee(te($.get(S),pe,de))},E.push(_)}v=E}else v=[];r[f]=v,w.g=7;break}if("proto_list"===h.type){if(p){for(v=Array(p.size()),x=0;x<p.size();x++)v[x]=p.get(x);p.delete()}else v=[];r[f]=v,w.g=7;break}if(void 0===p){w.g=3;break}if("float_list"===h.type){r[f]=p,w.g=7;break}if("proto"===h.type){r[f]=p,w.g=7;break}if("texture"!==h.type)throw Error("Unknown output config type: '"+h.type+"'");return(d=t.u[f])||(d=new Te(t.h,t.G),t.u[f]=d),g(w,ke(d,p,t.I),13);case 13:m=w.h,r[f]=m;case 7:h.transform&&r[f]&&(r[f]=h.transform(r[f])),w.g=3;break;case 14:y[b]=w.h;case 3:a=l.next(),w.g=2;break;case 4:return w.return(r)}}))}function Le(t,e){for(var n=e.name||"$",r=[].concat(a(e.wants)),s=new t.h.StringList,o=i(e.wants),u=o.next();!u.done;u=o.next())s.push_back(u.value);o=t.h.PacketListener.implement({onResults:function(s){for(var o={},i=0;i<e.wants.length;++i)o[r[i]]=s.get(i);var a=t.listeners[n];a&&(t.D=Fe(t,o,e.outs).then((function(n){n=a(n);for(var s=0;s<e.wants.length;++s){var i=o[r[s]];"object"==typeof i&&i.hasOwnProperty&&i.hasOwnProperty("delete")&&i.delete()}n&&(t.D=n)})))}}),t.i.attachMultiListener(s,o),s.delete()}function Pe(t){return void 0===t&&(t=0),1===t?"hand_landmark_full.tflite":"hand_landmark_lite.tflite"}function Be(t){var e=this;t=t||{},this.g=new Me({locateFile:t.locateFile,files:function(t){return[{url:"hands_solution_packed_assets_loader.js"},{simd:!1,url:"hands_solution_wasm_bin.js"},{simd:!0,url:"hands_solution_simd_wasm_bin.js"},{data:!0,url:Pe(t.modelComplexity)}]},graph:{url:"hands.binarypb"},inputs:{image:{type:"video",stream:"input_frames_gpu"}},listeners:[{wants:["multi_hand_landmarks","multi_hand_world_landmarks","image_transformed","multi_handedness"],outs:{image:"image_transformed",multiHandLandmarks:{type:"proto_list",stream:"multi_hand_landmarks",transform:_e},multiHandWorldLandmarks:{type:"proto_list",stream:"multi_hand_world_landmarks",transform:_e},multiHandedness:{type:"proto_list",stream:"multi_handedness",transform:function(t){return t.map((function(t){return Ee(te(t,pe,de))[0]}))}}}}],options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"object"==typeof window&&void 0!==window.navigator&&("iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document)},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},maxNumHands:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculator",fieldName:"int_value"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(t){var n,r,s;return N((function(o){return 1==o.g?(n=Pe(t),r="third_party/mediapipe/modules/hand_landmark/"+n,g(o,De(e.g,n),2)):(s=o.h,e.g.overrideFile(r,s),o.return(!0))}))}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"handlandmarktrackinggpu__palmdetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"handlandmarktrackinggpu__handlandmarkgpu__ThresholdingCalculator",fieldName:"threshold"}}}})}(t=Me.prototype).close=function(){return this.i&&this.i.delete(),Promise.resolve()},t.reset=function(){var t=this;return N((function(e){t.i&&(t.i.reset(),t.o={},t.u={}),e.g=0}))},t.setOptions=function(t,e){var n=this;if(e=e||this.g.options){for(var r=[],s=[],o={},a=i(Object.keys(t)),u=a.next();!u.done;o={R:o.R,S:o.S},u=a.next()){var c=u.value;c in this.j&&this.j[c]===t[c]||(this.j[c]=t[c],void 0!==(u=e[c])&&(u.onChange&&(o.R=u.onChange,o.S=t[c],r.push(function(t){return function(){return N((function(e){if(1==e.g)return g(e,t.R(t.S),2);!0===e.h&&(n.s=!0),e.g=0}))}}(o))),u.graphOptionXref&&(c={valueNumber:1===u.type?t[c]:0,valueBoolean:0===u.type&&t[c],valueString:2===u.type?t[c]:""},u=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),u.graphOptionXref),c),s.push(u))))}0===r.length&&0===s.length||(this.s=!0,this.B=(void 0===this.B?[]:this.B).concat(s),this.A=(void 0===this.A?[]:this.A).concat(r))}},t.initialize=function(){var t=this;return N((function(e){return 1==e.g?g(e,Re(t),2):3!=e.g?g(e,function(t){var e,n,r,s,o,a,u,c;return N((function(l){if(1==l.g)return t.g.graph&&t.g.graph.url&&t.Z===t.g.graph.url?l.return():(t.s=!0,t.g.graph&&t.g.graph.url?(t.Z=t.g.graph.url,g(l,De(t,t.g.graph.url),3)):void(l.g=2));for(2!=l.g&&(e=l.h,t.i.loadGraph(e)),n=i(Object.keys(t.C)),r=n.next();!r.done;r=n.next())s=r.value,t.i.overrideFile(s,t.C[s]);if(t.C={},t.g.listeners)for(o=i(t.g.listeners),a=o.next();!a.done;a=o.next())u=a.value,Le(t,u);c=t.j,t.j={},t.setOptions(c),l.g=0}))}(t),3):g(e,function(t){var e,n,r,s,o,a;return N((function(u){switch(u.g){case 1:if(!t.s)return u.return();if(!t.A){u.g=2;break}e=i(t.A),n=e.next();case 3:if(n.done){u.g=5;break}return g(u,(0,n.value)(),4);case 4:n=e.next(),u.g=3;break;case 5:t.A=void 0;case 2:if(t.B){for(r=new t.h.GraphOptionChangeRequestList,s=i(t.B),o=s.next();!o.done;o=s.next())a=o.value,r.push_back(a);t.i.changeOptions(r),r.delete(),t.B=void 0}t.s=!1,u.g=0}}))}(t),0)}))},t.overrideFile=function(t,e){this.i?this.i.overrideFile(t,e):this.C[t]=e},t.clearOverriddenFiles=function(){this.C={},this.i&&this.i.clearOverriddenFiles()},t.send=function(t,e){var n,r,s,o,a,u,c,l,f,h=this;return N((function(p){switch(p.g){case 1:return h.g.inputs?(n=1e3*(null==e?performance.now():e),g(p,h.D,2)):p.return();case 2:return g(p,h.initialize(),3);case 3:for(r=new h.h.PacketDataList,s=i(Object.keys(t)),o=s.next();!o.done;o=s.next())if(a=o.value,u=h.g.inputs[a]){t:{var d=t[a];switch(u.type){case"video":var m=h.o[u.stream];if(m||(m=new Te(h.h,h.G),h.o[u.stream]=m),0===m.l&&(m.l=m.h.createTexture()),"undefined"!=typeof HTMLVideoElement&&d instanceof HTMLVideoElement)var y=d.videoWidth,b=d.videoHeight;else"undefined"!=typeof HTMLImageElement&&d instanceof HTMLImageElement?(y=d.naturalWidth,b=d.naturalHeight):(y=d.width,b=d.height);b={glName:m.l,width:y,height:b},(y=m.g).canvas.width=b.width,y.canvas.height=b.height,y.activeTexture(y.TEXTURE0),m.h.bindTexture2d(m.l),y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,d),m.h.bindTexture2d(0),m=b;break t;case"detections":for((m=h.o[u.stream])||(m=new Ae(h.h),h.o[u.stream]=m),m.data||(m.data=new m.g.DetectionListData),m.data.reset(d.length),b=0;b<d.length;++b){y=d[b];var w=m.data,v=w.setBoundingBox,x=b,N=y.ea,$=new xe;if(gt($,1,N.ka),gt($,2,N.la),gt($,3,N.height),gt($,4,N.width),gt($,5,N.rotation),gt($,6,N.ia),N=ne($,Ne),v.call(w,x,N),y.Y)for(w=0;w<y.Y.length;++w){var E=!!($=y.Y[w]).visibility;x=(v=m.data).addNormalizedLandmark,N=b,$=Object.assign(Object.assign({},$),{visibility:E?$.visibility:0}),gt(E=new ye,1,$.x),gt(E,2,$.y),gt(E,3,$.z),$.visibility&&gt(E,4,$.visibility),$=ne(E,ge),x.call(v,N,$)}if(y.V)for(w=0;w<y.V.length;++w)x=(v=m.data).addClassification,N=b,$=y.V[w],gt(E=new fe,2,$.score),$.index&&gt(E,1,$.index),$.label&&gt(E,3,$.label),$.displayName&&gt(E,4,$.displayName),$=ne(E,he),x.call(v,N,$)}m=m.data;break t;default:m={}}}switch(c=m,l=u.stream,u.type){case"video":r.pushTexture2d(Object.assign(Object.assign({},c),{stream:l,timestamp:n}));break;case"detections":(f=c).stream=l,f.timestamp=n,r.pushDetectionList(f);break;default:throw Error("Unknown input config type: '"+u.type+"'")}}return h.i.send(r),g(p,h.D,4);case 4:r.delete(),p.g=0}}))},t.onResults=function(t,e){this.listeners[e||"$"]=t},S("Solution",Me),S("OptionType",{BOOL:0,NUMBER:1,ma:2,0:"BOOL",1:"NUMBER",2:"STRING"}),(t=Be.prototype).close=function(){return this.g.close(),Promise.resolve()},t.onResults=function(t){this.g.onResults(t)},t.initialize=function(){var t=this;return N((function(e){return g(e,t.g.initialize(),0)}))},t.reset=function(){this.g.reset()},t.send=function(t){var e=this;return N((function(n){return g(n,e.g.send(t),0)}))},t.setOptions=function(t){this.g.setOptions(t)},S("Hands",Be),S("HAND_CONNECTIONS",[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]]),S("VERSION","0.4.1646424915")}).call(void 0);var o0=t0(Object.freeze({__proto__:null})),i0={};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Object.defineProperty(i0,"q",{value:!0});var a0=YQ({__proto__:null,MEDIAPIPE_KEYPOINTS:i0.MEDIAPIPE_KEYPOINTS=["wrist","thumb_cmc","thumb_mcp","thumb_ip","thumb_tip","index_finger_mcp","index_finger_pip","index_finger_dip","index_finger_tip","middle_finger_mcp","middle_finger_pip","middle_finger_dip","middle_finger_tip","ring_finger_mcp","ring_finger_pip","ring_finger_dip","ring_finger_tip","pinky_finger_mcp","pinky_finger_pip","pinky_finger_dip","pinky_finger_tip"],default:i0},[i0]),u0={},c0={};Object.defineProperty(c0,"q",{value:!0}),c0.DEFAULT_MPHANDS_MODEL_CONFIG={runtime:"mediapipe",maxHands:2,modelType:"full"},c0.DEFAULT_MPHANDS_ESTIMATION_CONFIG={flipHorizontal:!1,staticImageMode:!1};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var l0=ZQ&&ZQ.tt||function(){return l0=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},l0.apply(this,arguments)};Object.defineProperty(u0,"q",{value:!0});var f0=c0;u0.validateModelConfig=function(t){if(null==t)return l0({},f0.DEFAULT_MPHANDS_MODEL_CONFIG);var e=l0({},t);return e.runtime="mediapipe",null==e.maxHands&&(e.maxHands=f0.DEFAULT_MPHANDS_MODEL_CONFIG.maxHands),null==e.modelType&&(e.modelType=f0.DEFAULT_MPHANDS_MODEL_CONFIG.modelType),e},u0.validateEstimationConfig=function(t){if(null==t)return l0({},f0.DEFAULT_MPHANDS_ESTIMATION_CONFIG);var e=l0({},t);return null==e.flipHorizontal&&(e.flipHorizontal=f0.DEFAULT_MPHANDS_ESTIMATION_CONFIG.flipHorizontal),null==e.staticImageMode&&(e.staticImageMode=f0.DEFAULT_MPHANDS_ESTIMATION_CONFIG.staticImageMode),e};var h0=ZQ&&ZQ.tt||function(){return h0=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},h0.apply(this,arguments)},p0=ZQ&&ZQ.et||function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?s(t.value):new n((function(e){e(t.value)})).then(i,a)}u((r=r.apply(t,e||[])).next())}))},d0=ZQ&&ZQ.nt||function(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=i.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(r0,"q",{value:!0});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var m0=o0,y0=i0,g0=u0,b0=function(){function t(t){var e,n=this;if(this.width=0,this.height=0,this.selfieMode=!1,this.handsSolution=new m0.Hands({locateFile:function(e,n){return t.solutionPath?t.solutionPath.replace(/\/+$/,"")+"/"+e:n+"/"+e}}),"lite"===t.modelType)e=0;else e=1;this.handsSolution.setOptions({modelComplexity:e,selfieMode:this.selfieMode,maxNumHands:t.maxHands}),this.handsSolution.onResults((function(t){if(n.height=t.image.height,n.width=t.image.width,n.hands=[],null!==t.multiHandLandmarks)for(var e=t.multiHandedness,r=t.multiHandLandmarks,s=t.multiHandWorldLandmarks,o=0;o<e.length;o++)n.hands.push(h0({},n.translateOutput(r[o],s[o]),{score:e[o].score,handedness:e[o].label}))}))}return t.prototype.translateOutput=function(t,e){var n=this,r=t.map((function(t,e){return{x:t.x*n.width,y:t.y*n.height,score:t.visibility,name:y0.MEDIAPIPE_KEYPOINTS[e]}})),s=e.map((function(t,e){return{x:t.x,y:t.y,z:t.z,score:t.visibility,name:y0.MEDIAPIPE_KEYPOINTS[e]}}));return{keypoints:r,keypoints3D:s}},t.prototype.estimateHands=function(t,e){return p0(this,void 0,void 0,(function(){return d0(this,(function(n){switch(n.label){case 0:return e&&e.flipHorizontal&&e.flipHorizontal!==this.selfieMode&&(this.selfieMode=e.flipHorizontal,this.handsSolution.setOptions({selfieMode:this.selfieMode})),[4,this.handsSolution.send({image:t})];case 1:return n.sent(),[2,this.hands]}}))}))},t.prototype.dispose=function(){this.handsSolution.close()},t.prototype.reset=function(){this.handsSolution.reset(),this.width=0,this.height=0,this.hands=null,this.selfieMode=!1},t.prototype.initialize=function(){return this.handsSolution.initialize()},t}();r0.load=function(t){return p0(this,void 0,void 0,(function(){var e,n;return d0(this,(function(r){switch(r.label){case 0:return e=g0.validateModelConfig(t),[4,(n=new b0(e)).initialize()];case 1:return r.sent(),[2,n]}}))}))};var w0={};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class v0{refCount(t){return x0("refCount")}incRef(t){return x0("incRef")}timerAvailable(){return!0}time(t){return x0("time")}read(t){return x0("read")}readSync(t){return x0("readSync")}readToGPU(t,e){return x0("readToGPU")}numDataIds(){return x0("numDataIds")}disposeData(t,e){return x0("disposeData")}write(t,e,n){return x0("write")}move(t,e,n,r,s){return x0("move")}memory(){return x0("memory")}floatPrecision(){return x0("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return x0("dispose")}}function x0(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N0(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,E0(t,e,n)}function $0(t,e,n){return Math.max(t,Math.min(e,n))}function E0(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function S0(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function _0(t,e,n=""){S0(C0(t,e),(()=>n+` Shapes ${t} and ${e} must match`))}function T0(t){S0(null!=t,(()=>"The input to the tensor constructor must be a non-null value."))}function k0(t,e=[],n=!1){if(null==e&&(e=[]),Array.isArray(t)||B0(t)&&!n)for(let r=0;r<t.length;++r)k0(t[r],e,n);else e.push(t);return e}function A0(t){if(0===t.length)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function C0(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function O0(t){return t%1==0}function I0(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function M0(t,e){const n=e.length;return t=null==t?e.map(((t,e)=>e)):[].concat(t),S0(t.every((t=>t>=-n&&t<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`)),S0(t.every((t=>O0(t))),(()=>`All values in axis param must be integers but got axis ${t}`)),t.map((t=>t<0?n+t:t))}function R0(t,e){const n=[],r=[],s=null!=e&&Array.isArray(e)&&0===e.length,o=null==e||s?null:M0(e,t).sort();let i=0;for(let e=0;e<t.length;++e){if(null!=o){if(o[i]===e&&1!==t[e])throw new Error(`Can't squeeze axis ${e} since its dim '${t[e]}' is not 1`);(null==o[i]||o[i]>e)&&1===t[e]&&(n.push(t[e]),r.push(e)),o[i]<=e&&i++}1!==t[e]&&(n.push(t[e]),r.push(e))}return{newShape:n,keptDims:r}}function D0(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error(`Unknown data type ${t}`);n=new Uint8Array(e)}return n}function F0(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error(`Unknown data type ${t}`);n=new Array(e)}return n}function L0(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function P0(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function B0(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function V0(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error(`Unknown dtype ${t}`)}function z0(t){if(null==t)return 0;let e=0;return t.forEach((t=>e+=t.length)),e}function W0(t){return"string"==typeof t||t instanceof String}function U0(t){return"boolean"==typeof t}function j0(t){return"number"==typeof t}function G0(t){return Array.isArray(t)?G0(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":j0(t)?"float32":W0(t)?"string":U0(t)?"bool":"float32"}function q0(t){return!!(t&&t.constructor&&t.call&&t.apply)}function H0(t,e){for(let n=e;n<t;++n)if(t%n==0)return n;return t}function K0(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function X0(t,e,n,r=!1){const s=new Array;if(1===e.length){const o=e[0]*(r?2:1);for(let e=0;e<o;e++)s[e]=n[t+e]}else{const o=e[0],i=e.slice(1),a=i.reduce(((t,e)=>t*e))*(r?2:1);for(let e=0;e<o;e++)s[e]=X0(t+e*a,i,n,r)}return s}function J0(t,e,n=!1){if(0===t.length)return e[0];const r=t.reduce(((t,e)=>t*e))*(n?2:1);if(0===r)return[];if(r!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return X0(0,t,e,n)}function Y0(t,e){const n=Z0(t,e);for(let t=0;t<n.length;t++)n[t]=1;return n}function Z0(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function Q0(t){t.forEach((e=>{S0(Number.isInteger(e)&&e>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`))}))}function t1(t){return t&&t.then&&"function"==typeof t.then}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e1{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=n1,this.populateURLFlags()}setPlatform(t,e){null!=this.platform&&(r1().getBool("IS_TEST")||r1().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=e}registerFlag(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){const e=this.urlFlags[t];r1().getBool("IS_TEST")||r1().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${e}.`),this.set(t,e)}}async getAsync(t){return t in this.flags||(this.flags[t]=await this.evaluateFlag(t)),this.flags[t]}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(t1(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(null==this.flagRegistry[t])throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(null==this.flagRegistry[t])throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const t=this.getQueryParams(this.global.location.search);if("tfjsflags"in t){t.tfjsflags.split(",").forEach((t=>{const[e,n]=t.split(":");this.urlFlags[e]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}(e,n)}))}}}function n1(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((t,...n)=>(function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")))),e}function r1(){return s1}let s1=null;function o1(){throw new Error("setTimeout has not been defined")}function i1(){throw new Error("clearTimeout has not been defined")}var a1=o1,u1=i1;function c1(t){if(a1===setTimeout)return setTimeout(t,0);if((a1===o1||!a1)&&setTimeout)return a1=setTimeout,setTimeout(t,0);try{return a1(t,0)}catch(e){try{return a1.call(null,t,0)}catch(e){return a1.call(this,t,0)}}}"function"==typeof s0.setTimeout&&(a1=setTimeout),"function"==typeof s0.clearTimeout&&(u1=clearTimeout);var l1,f1=[],h1=!1,p1=-1;function d1(){h1&&l1&&(h1=!1,l1.length?f1=l1.concat(f1):p1=-1,f1.length&&m1())}function m1(){if(!h1){var t=c1(d1);h1=!0;for(var e=f1.length;e;){for(l1=f1,f1=[];++p1<e;)l1&&l1[p1].run();p1=-1,e=f1.length}l1=null,h1=!1,function(t){if(u1===clearTimeout)return clearTimeout(t);if((u1===i1||!u1)&&clearTimeout)return u1=clearTimeout,clearTimeout(t);try{u1(t)}catch(e){try{return u1.call(null,t)}catch(e){return u1.call(this,t)}}}(t)}}function y1(t,e){this.fun=t,this.array=e}y1.prototype.run=function(){this.fun.apply(null,this.array)};function g1(){}var b1=g1,w1=g1,v1=g1,x1=g1,N1=g1,$1=g1,E1=g1;var S1=s0.performance||{},_1=S1.now||S1.mozNow||S1.msNow||S1.oNow||S1.webkitNow||function(){return(new Date).getTime()};var T1=new Date;var k1={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];f1.push(new y1(t,e)),1!==f1.length||h1||c1(m1)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:b1,addListener:w1,once:v1,off:x1,removeListener:N1,removeAllListeners:$1,emit:E1,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*_1.call(S1),n=Math.floor(e),r=Math.floor(e%1*1e9);return t&&(n-=t[0],(r-=t[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-T1)/1e3}},A1=k1;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
let C1;function O1(){if(null==C1){let t;if("undefined"!=typeof window)t=window;else if(void 0!==s0)t=s0;else if(void 0!==A1)t=A1;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}C1=t}return C1}function I1(t,e){const n=function(){const t=O1();return null==t._tfGlobals&&(t._tfGlobals=new Map),t._tfGlobals}();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function M1(...t){r1().getBool("IS_TEST")||r1().getBool("PROD")||console.warn(...t)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const R1=I1("kernelRegistry",(()=>new Map)),D1=I1("gradRegistry",(()=>new Map));function F1(t,e){const n=V1(t,e);return R1.get(n)}function L1(t){return D1.get(t)}function P1(t){const e=R1.entries(),n=[];for(;;){const{done:r,value:s}=e.next();if(r)break;const[o,i]=s,[a]=o.split("_");a===t&&n.push(i)}return n}function B1(t){const{kernelName:e,backendName:n}=t,r=V1(e,n);R1.has(r)&&M1(`The kernel '${e}' for backend '${n}' is already registered`),R1.set(r,t)}function V1(t,e){return`${e}_${t}`}var z1=U1,W1=null;try{W1=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(Yot){}function U1(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function j1(t){return!0===(t&&t._)}U1.prototype._,Object.defineProperty(U1.prototype,"_",{value:!0}),U1.isLong=j1;var G1={},q1={};function H1(t,e){var n,r,s;return e?(s=0<=(t>>>=0)&&t<256)&&(r=q1[t])?r:(n=X1(t,(0|t)<0?-1:0,!0),s&&(q1[t]=n),n):(s=-128<=(t|=0)&&t<128)&&(r=G1[t])?r:(n=X1(t,t<0?-1:0,!1),s&&(G1[t]=n),n)}function K1(t,e){if(isNaN(t))return e?s2:r2;if(e){if(t<0)return s2;if(t>=t2)return c2}else{if(t<=-e2)return l2;if(t+1>=e2)return u2}return t<0?K1(-t,e).neg():X1(t%Q1|0,t/Q1|0,e)}function X1(t,e,n){return new U1(t,e,n)}U1.fromInt=H1,U1.fromNumber=K1,U1.fromBits=X1;var J1=Math.pow;function Y1(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return r2;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return Y1(t.substring(1),e,n).neg();for(var s=K1(J1(n,8)),o=r2,i=0;i<t.length;i+=8){var a=Math.min(8,t.length-i),u=parseInt(t.substring(i,i+a),n);if(a<8){var c=K1(J1(n,a));o=o.mul(c).add(K1(u))}else o=(o=o.mul(s)).add(K1(u))}return o.unsigned=e,o}function Z1(t,e){return"number"==typeof t?K1(t,e):"string"==typeof t?Y1(t,e):X1(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}U1.fromString=Y1,U1.fromValue=Z1;var Q1=4294967296,t2=Q1*Q1,e2=t2/2,n2=H1(1<<24),r2=H1(0);U1.ZERO=r2;var s2=H1(0,!0);U1.UZERO=s2;var o2=H1(1);U1.ONE=o2;var i2=H1(1,!0);U1.UONE=i2;var a2=H1(-1);U1.NEG_ONE=a2;var u2=X1(-1,2147483647,!1);U1.MAX_VALUE=u2;var c2=X1(-1,-1,!0);U1.MAX_UNSIGNED_VALUE=c2;var l2=X1(0,-2147483648,!1);U1.MIN_VALUE=l2;var f2=U1.prototype;f2.toInt=function(){return this.unsigned?this.low>>>0:this.low},f2.toNumber=function(){return this.unsigned?(this.high>>>0)*Q1+(this.low>>>0):this.high*Q1+(this.low>>>0)},f2.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(l2)){var e=K1(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var s=K1(J1(t,6),this.unsigned),o=this,i="";;){var a=o.div(s),u=(o.sub(a.mul(s)).toInt()>>>0).toString(t);if((o=a).isZero())return u+i;for(;u.length<6;)u="0"+u;i=""+u+i}},f2.getHighBits=function(){return this.high},f2.getHighBitsUnsigned=function(){return this.high>>>0},f2.getLowBits=function(){return this.low},f2.getLowBitsUnsigned=function(){return this.low>>>0},f2.getNumBitsAbs=function(){if(this.isNegative())return this.eq(l2)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},f2.isZero=function(){return 0===this.high&&0===this.low},f2.eqz=f2.isZero,f2.isNegative=function(){return!this.unsigned&&this.high<0},f2.isPositive=function(){return this.unsigned||this.high>=0},f2.isOdd=function(){return 1==(1&this.low)},f2.isEven=function(){return 0==(1&this.low)},f2.equals=function(t){return j1(t)||(t=Z1(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},f2.eq=f2.equals,f2.notEquals=function(t){return!this.eq(t)},f2.neq=f2.notEquals,f2.ne=f2.notEquals,f2.lessThan=function(t){return this.comp(t)<0},f2.lt=f2.lessThan,f2.lessThanOrEqual=function(t){return this.comp(t)<=0},f2.lte=f2.lessThanOrEqual,f2.le=f2.lessThanOrEqual,f2.greaterThan=function(t){return this.comp(t)>0},f2.gt=f2.greaterThan,f2.greaterThanOrEqual=function(t){return this.comp(t)>=0},f2.gte=f2.greaterThanOrEqual,f2.ge=f2.greaterThanOrEqual,f2.compare=function(t){if(j1(t)||(t=Z1(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},f2.comp=f2.compare,f2.negate=function(){return!this.unsigned&&this.eq(l2)?l2:this.not().add(o2)},f2.neg=f2.negate,f2.add=function(t){j1(t)||(t=Z1(t));var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,o=t.high>>>16,i=65535&t.high,a=t.low>>>16,u=0,c=0,l=0,f=0;return l+=(f+=s+(65535&t.low))>>>16,c+=(l+=r+a)>>>16,u+=(c+=n+i)>>>16,u+=e+o,X1((l&=65535)<<16|(f&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},f2.subtract=function(t){return j1(t)||(t=Z1(t)),this.add(t.neg())},f2.sub=f2.subtract,f2.multiply=function(t){if(this.isZero())return r2;if(j1(t)||(t=Z1(t)),W1)return X1(W1.mul(this.low,this.high,t.low,t.high),W1.get_high(),this.unsigned);if(t.isZero())return r2;if(this.eq(l2))return t.isOdd()?l2:r2;if(t.eq(l2))return this.isOdd()?l2:r2;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(n2)&&t.lt(n2))return K1(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,o=t.high>>>16,i=65535&t.high,a=t.low>>>16,u=65535&t.low,c=0,l=0,f=0,h=0;return f+=(h+=s*u)>>>16,l+=(f+=r*u)>>>16,f&=65535,l+=(f+=s*a)>>>16,c+=(l+=n*u)>>>16,l&=65535,c+=(l+=r*a)>>>16,l&=65535,c+=(l+=s*i)>>>16,c+=e*u+n*a+r*i+s*o,X1((f&=65535)<<16|(h&=65535),(c&=65535)<<16|(l&=65535),this.unsigned)},f2.mul=f2.multiply,f2.divide=function(t){if(j1(t)||(t=Z1(t)),t.isZero())throw Error("division by zero");var e,n,r;if(W1)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?X1((this.unsigned?W1.div_u:W1.div_s)(this.low,this.high,t.low,t.high),W1.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?s2:r2;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return s2;if(t.gt(this.shru(1)))return i2;r=s2}else{if(this.eq(l2))return t.eq(o2)||t.eq(a2)?l2:t.eq(l2)?o2:(e=this.shr(1).div(t).shl(1)).eq(r2)?t.isNegative()?o2:a2:(n=this.sub(t.mul(e)),r=e.add(n.div(t)));if(t.eq(l2))return this.unsigned?s2:r2;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=r2}for(n=this;n.gte(t);){e=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(e)/Math.LN2),o=s<=48?1:J1(2,s-48),i=K1(e),a=i.mul(t);a.isNegative()||a.gt(n);)a=(i=K1(e-=o,this.unsigned)).mul(t);i.isZero()&&(i=o2),r=r.add(i),n=n.sub(a)}return r},f2.div=f2.divide,f2.modulo=function(t){return j1(t)||(t=Z1(t)),W1?X1((this.unsigned?W1.rem_u:W1.rem_s)(this.low,this.high,t.low,t.high),W1.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},f2.mod=f2.modulo,f2.rem=f2.modulo,f2.not=function(){return X1(~this.low,~this.high,this.unsigned)},f2.and=function(t){return j1(t)||(t=Z1(t)),X1(this.low&t.low,this.high&t.high,this.unsigned)},f2.or=function(t){return j1(t)||(t=Z1(t)),X1(this.low|t.low,this.high|t.high,this.unsigned)},f2.xor=function(t){return j1(t)||(t=Z1(t)),X1(this.low^t.low,this.high^t.high,this.unsigned)},f2.shiftLeft=function(t){return j1(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?X1(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):X1(0,this.low<<t-32,this.unsigned)},f2.shl=f2.shiftLeft,f2.shiftRight=function(t){return j1(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?X1(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):X1(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},f2.shr=f2.shiftRight,f2.shiftRightUnsigned=function(t){if(j1(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?X1(this.low>>>t|e<<32-t,e>>>t,this.unsigned):X1(32===t?e:e>>>t-32,0,this.unsigned)},f2.shru=f2.shiftRightUnsigned,f2.shr_u=f2.shiftRightUnsigned,f2.toSigned=function(){return this.unsigned?X1(this.low,this.high,!1):this},f2.toUnsigned=function(){return this.unsigned?this:X1(this.low,this.high,!0)},f2.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},f2.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},f2.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},U1.fromBytes=function(t,e,n){return n?U1.fromBytesLE(t,e):U1.fromBytesBE(t,e)},U1.fromBytesLE=function(t,e){return new U1(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},U1.fromBytesBE=function(t,e){return new U1(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const h2=z1||YQ({__proto__:null,default:z1},[z1]);function p2(t){return h2.fromString(t,!0,16)}const d2=p2("c3a5c85c97cb3127"),m2=p2("b492b66fbe98f273"),y2=p2("9ae16a3b2f90404f");function g2(t){return t.xor(t.shru(47))}function b2(t,e,n){const r=t.slice(e,e+n);return h2.fromBytes(Array.from(r),!0,!0)}function w2(t,e){return b2(t,e,8)}function v2(t,e){return b2(t,e,4)}function x2(t,e){return 0===e?t:t.shru(e).or(t.shl(64-e))}function N2(t,e,n=p2("9ddfea08eb382d69")){let r=t.xor(e).mul(n);r=r.xor(r.shru(47));let s=e.xor(r).mul(n);return s=s.xor(s.shru(47)),s=s.mul(n),s}function $2(t,e,n,r){return function(t,e,n,r,s,o){s=s.add(t),o=x2(o.add(s).add(r),21);const i=s;return s=(s=s.add(e)).add(n),o=o.add(x2(s,44)),[s.add(r),o.add(i)]}(w2(t,e),w2(t,e+8),w2(t,e+16),w2(t,e+24),n,r)}function E2(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=k0(t)),r1().getBool("DEBUG")&&L0(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){const e=new Uint8Array(t.length);for(let n=0;n<e.length;++n)0!==Math.round(t[n])&&(e[n]=1);return e}throw new Error(`Unknown data type ${e}`)}function S2(){return r1().platform.now()}function _2(t,e="utf-8"){return e=e||"utf-8",r1().platform.encode(t,e)}function T2(t,e="utf-8"){return e=e||"utf-8",r1().platform.decode(t,e)}var k2=Object.freeze({__proto__:null,createScalarValue:
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){return"string"===e?_2(t):E2([t],e)},toTypedArray:E2,now:S2,fetch:function(t,e){return r1().platform.fetch(t,e)},encodeString:_2,decodeString:T2,shuffle:N0,shuffleCombo:function(t,e){if(t.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${e.length}`);let n=t.length,r=0;for(;n>0;)r=Math.random()*n|0,n--,E0(t,n,r),E0(e,n,r)},clamp:$0,nearestLargerEven:function(t){return t%2==0?t:t+1},swap:E0,sum:function(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e},randUniform:function(t,e){const n=Math.random();return e*n+(1-n)*t},distSquared:function(t,e){let n=0;for(let r=0;r<t.length;r++){const s=Number(t[r])-Number(e[r]);n+=s*s}return n},assert:S0,assertShapesMatch:_0,assertNonNull:T0,flatten:k0,sizeFromShape:A0,isScalarShape:function(t){return 0===t.length},arraysEqual:C0,isInt:O0,tanh:function(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{const e=Math.exp(2*t);return(e-1)/(e+1)}},sizeToSquarishShape:function(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]},createShuffledIndices:function(t){const e=new Uint32Array(t);for(let n=0;n<t;++n)e[n]=n;return N0(e),e},rightPad:I0,repeatedTry:function(t,e=(t=>0),n){return new Promise(((r,s)=>{let o=0;const i=()=>{if(t())return void r();o++;const a=e(o);null!=n&&o>=n?s():setTimeout(i,a)};i()}))},inferFromImplicitShape:function(t,e){let n=1,r=-1;for(let e=0;e<t.length;++e)if(t[e]>=0)n*=t[e];else if(-1===t[e]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${e}`);r=e}else if(t[e]<0)throw Error(`Shapes can not be < 0. Found ${t[e]} at dim ${e}`);if(-1===r){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(0===n)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const s=t.slice();return s[r]=e/n,s},parseAxisParam:M0,squeezeShape:R0,getTypedArrayFromDType:D0,getArrayFromDType:F0,checkConversionForErrors:L0,isValidDtype:P0,hasEncodingLoss:function(t,e){return"complex64"!==e&&(("float32"!==e||"complex64"===t)&&(("int32"!==e||"float32"===t||"complex64"===t)&&("bool"!==e||"bool"!==t)))},isTypedArray:B0,bytesPerElement:V0,bytesFromStringArray:z0,isString:W0,isBoolean:U0,isNumber:j0,inferDtype:G0,isFunction:q0,nearestDivisor:H0,computeStrides:K0,toNestedArray:J0,makeOnesTypedArray:Y0,makeZerosTypedArray:Z0,makeZerosNestedTypedArray:function(t,e){const n=t.reduce(((t,e)=>t*e),1);if(null==e||"float32"===e)return J0(t,new Float32Array(n));if("int32"===e)return J0(t,new Int32Array(n));if("bool"===e)return J0(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)},assertNonNegativeIntegerDimensions:Q0,locToIndex:function(t,e,n){if(0===e)return 0;if(1===e)return t[0];let r=t[t.length-1];for(let e=0;e<t.length-1;++e)r+=n[e]*t[e];return r},indexToLoc:function(t,e,n){if(0===e)return[];if(1===e)return[t];const r=new Array(e);for(let e=0;e<r.length-1;++e)r[e]=Math.floor(t/n[e]),t-=r[e]*n[e];return r[r.length-1]=t,r},isPromise:t1,hexToLong:p2,fingerPrint64:function(t,e=t.length){const n=h2.fromNumber(81,!0);if(e<=32)return e<=16?function(t,e=t.length){if(e>=8){const n=y2.add(2*e),r=w2(t,0).add(y2),s=w2(t,e-8);return N2(x2(s,37).mul(n).add(r),x2(r,25).add(s).mul(n),n)}if(e>=4){const n=y2.add(2*e);return N2(v2(t,0).shl(3).add(e),v2(t,e-4),n)}if(e>0){const n=t[0]+(t[e>>1]<<8),r=e+(t[e-1]<<2);return g2(y2.mul(n).xor(d2.mul(r))).mul(y2)}return y2}(t,e):function(t,e=t.length){const n=y2.add(2*e),r=w2(t,0).mul(m2),s=w2(t,8),o=w2(t,e-8).mul(n),i=w2(t,e-16).mul(y2);return N2(x2(r.add(s),43).add(x2(o,30)).add(i),r.add(x2(s.add(y2),18)).add(o),n)}(t,e);if(e<=64)return function(t,e=t.length){const n=y2.add(2*e),r=w2(t,0).mul(y2),s=w2(t,8),o=w2(t,e-8).mul(n),i=w2(t,e-16).mul(y2),a=x2(r.add(s),43).add(x2(o,30)).add(i),u=N2(a,r.add(x2(s.add(y2),18)).add(o),n),c=w2(t,16).mul(n),l=w2(t,24),f=a.add(w2(t,e-32)).mul(n),h=u.add(w2(t,e-24)).mul(n);return N2(x2(c.add(l),43).add(x2(f,30)).add(h),c.add(x2(l.add(r),18)).add(f),n)}(t,e);let r=n,s=n.mul(m2).add(113),o=g2(s.mul(y2).add(113)).mul(y2),i=[h2.UZERO,h2.UZERO],a=[h2.UZERO,h2.UZERO];r=r.mul(y2).add(w2(t,0));let u=0;const c=64*(e-1>>6),l=c+(e-1&63)-63;do{r=x2(r.add(s).add(i[0]).add(w2(t,u+8)),37).mul(m2),s=x2(s.add(i[1]).add(w2(t,u+48)),42).mul(m2),r=r.xor(a[1]),s=s.add(i[0]).add(w2(t,u+40)),o=x2(o.add(a[0]),33).mul(m2),i=$2(t,u,i[1].mul(m2),r.add(a[0])),a=$2(t,u+32,o.add(a[1]),s.add(w2(t,u+16))),[o,r]=[r,o],u+=64}while(u!==c);const f=m2.add(o.and(255).shl(1));return u=l,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),r=x2(r.add(s).add(i[0]).add(w2(t,u+8)),37).mul(f),s=x2(s.add(i[1]).add(w2(t,u+48)),42).mul(f),r=r.xor(a[1].mul(9)),s=s.add(i[0].mul(9).add(w2(t,u+40))),o=x2(o.add(a[0]),33).mul(f),i=$2(t,u,i[1].mul(f),r.add(a[0])),a=$2(t,u+32,o.add(a[1]),s.add(w2(t,u+16))),[o,r]=[r,o],N2(N2(i[0],a[0],f).add(g2(s).mul(d2)).add(o),N2(i[1],a[1],f).add(r),f)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A2{constructor(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new O2)}profileKernel(t,e,n){let r;const s=()=>{r=n()};let o;const i=S2();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(s);else{s();for(const t of r)t.dataSync();o=Promise.resolve({kernelMs:S2()-i})}if(r1().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let e=0;e<r.length;e++){const n=r[e];n.data().then((e=>{C2(e,n.dtype,t)}))}return{kernelName:t,outputs:r,inputs:e,timeMs:o.then((t=>t.kernelMs)),extraInfo:o.then((t=>null!=t.getExtraProfileInfo?t.getExtraProfileInfo():""))}}logKernelProfile(t){const{kernelName:e,outputs:n,timeMs:r,inputs:s,extraInfo:o}=t;n.forEach((t=>{Promise.all([t.data(),r,o]).then((n=>{this.logger.logKernelProfile(e,t,n[0],n[1],s,n[2])}))}))}}function C2(t,e,n){if("float32"!==e)return!1;for(let e=0;e<t.length;e++){const r=t[e];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class O2{logKernelProfile(t,e,n,r,s,o){const i="number"==typeof r?I0(`${r}ms`,9):r.error,a=I0(t,25),u=e.rank,c=e.size,l=I0(e.shape.toString(),14);let f="";for(const t in s){const n=s[t];if(null!=n){const r=n.shape||e.shape,s=r.length;f+=`${t}: ${s}D ${s>0?r:""} `}}console.log(`%c${a}\t%c${i}\t%c${u}D ${l}\t%c${c}\t%c${f}\t%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I2(t,e,n,r){const s=K0(e),o=function(t,e,n,r){const s=A0(e),o=r[r.length-1],i=new Array(o).fill(0),a=e.length,u="complex64"===n?F2(t):t;if(a>1)for(let t=0;t<s/o;t++){const e=t*o;for(let t=0;t<o;t++)i[t]=Math.max(i[t],M2(u[e+t],0,n).length)}return i}(t,e,n,s),i=e.length,a=D2(t,e,n,s,o),u=["Tensor"];return r&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${i}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(a.map((t=>"    "+t)).join("\n")),u.join("\n")}function M2(t,e,n){let r;return r=Array.isArray(t)?`${parseFloat(t[0].toFixed(7))} + ${parseFloat(t[1].toFixed(7))}j`:W0(t)?`'${t}'`:"bool"===n?R2(t):parseFloat(t.toFixed(7)).toString(),I0(r,e)}function R2(t){return 0===t?"false":"true"}function D2(t,e,n,r,s,o=!0){const i="complex64"===n?2:1,a=e[0],u=e.length;if(0===u){if("complex64"===n){return[M2(F2(t)[0],0,n)]}return"bool"===n?[R2(t[0])]:[t[0].toString()]}if(1===u){if(a>20){const e=3*i;let r=Array.from(t.slice(0,e)),o=Array.from(t.slice((a-3)*i,a*i));return"complex64"===n&&(r=F2(r),o=F2(o)),["["+r.map(((t,e)=>M2(t,s[e],n))).join(", ")+", ..., "+o.map(((t,e)=>M2(t,s[a-3+e],n))).join(", ")+"]"]}return["["+("complex64"===n?F2(t):Array.from(t)).map(((t,e)=>M2(t,s[e],n))).join(", ")+"]"]}const c=e.slice(1),l=r.slice(1),f=r[0]*i,h=[];if(a>20){for(let e=0;e<3;e++){const r=e*f,o=r+f;h.push(...D2(t.slice(r,o),c,n,l,s,!1))}h.push("...");for(let e=a-3;e<a;e++){const r=e*f,o=r+f;h.push(...D2(t.slice(r,o),c,n,l,s,e===a-1))}}else for(let e=0;e<a;e++){const r=e*f,o=r+f;h.push(...D2(t.slice(r,o),c,n,l,s,e===a-1))}const p=2===u?",":"";h[0]="["+h[0]+p;for(let t=1;t<h.length-1;t++)h[t]=" "+h[t]+p;let d=",\n";for(let t=2;t<u;t++)d+="\n";return h[h.length-1]=" "+h[h.length-1]+"]"+(o?"":d),h}function F2(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L2{constructor(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=A0(t),null!=n){const t=n.length;S0(t===this.size,(()=>`Length of values '${t}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||F0(e,this.size),this.strides=K0(t)}set(t,...e){0===e.length&&(e=[0]),S0(e.length===this.rank,(()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`));const n=this.locToIndex(e);this.values[n]=t}get(...t){0===t.length&&(t=[0]);let e=0;for(const n of t){if(n<0||n>=this.shape[e]){const e=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(e)}e++}let n=t[t.length-1];for(let e=0;e<t.length-1;++e)n+=this.strides[e]*t[e];return this.values[n]}locToIndex(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];let e=t[t.length-1];for(let n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e}indexToLoc(t){if(0===this.rank)return[];if(1===this.rank)return[t];const e=new Array(this.shape.length);for(let n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return P2().makeTensor(this.values,this.shape,this.dtype)}}let P2=null,B2=null;class V2{constructor(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=A0(t),this.strides=K0(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return B2.buffer(this.shape,this.dtype,t)}bufferSync(){return B2.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return J0(this.shape,t,"complex64"===this.dtype)}arraySync(){return J0(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const t=P2().read(this.dataId);if("string"===this.dtype){const e=await t;try{return e.map((t=>T2(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),P2().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=P2().readSync(this.dataId);if("string"===this.dtype)try{return t.map((t=>T2(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await P2().read(this.dataId);return"string"===this.dtype?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(P2().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return B2.print(this,t)}clone(){return this.throwIfDisposed(),B2.clone(this)}toString(t=!1){return I2(this.dataSync(),this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),B2.cast(this,t)}variable(t=!0,e,n){return this.throwIfDisposed(),P2().makeVariable(this,t,e,n)}}Object.defineProperty(V2,Symbol.hasInstance,{value:t=>!!t&&null!=t.data&&null!=t.dataSync&&null!=t.throwIfDisposed}),I1("Tensor",(()=>V2));class z2 extends V2{constructor(t,e,n,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=e,this.name=n}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!C0(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);P2().disposeTensor(this),this.dataId=t.dataId,P2().incRef(this,null)}dispose(){P2().disposeVariable(this),this.isDisposedInternal=!0}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var W2,U2,j2,G2,q2;Object.defineProperty(z2,Symbol.hasInstance,{value:t=>t instanceof V2&&null!=t.assign&&t.assign instanceof Function}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(W2||(W2={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(U2||(U2={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(j2||(j2={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(G2||(G2={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(q2||(q2={}));const H2={float32:G2,int32:U2,bool:j2,complex64:q2};function K2(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return H2[t][e]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function X2(t,e){if(t.dtype===e.dtype)return[t,e];const n=K2(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function J2(t,e){S0(t.dtype===e.dtype,(()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`))}function Y2(t){const e=[];return Z2(t,e,new Set),e}function Z2(t,e,n){if(null==t)return;if(t instanceof V2)return void e.push(t);if(r=t,!Array.isArray(r)&&"object"!=typeof r)return;var r;const s=t;for(const t in s){const r=s[t];n.has(r)||(n.add(r),Z2(r,e,n))}}var Q2=Object.freeze({__proto__:null,makeTypesMatch:X2,assertTypesMatch:J2,isTensorInList:function(t,e){return e.some((e=>e.id===t.id))},getTensorsInContainer:Y2});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t3(t){return null!=t.kernelName}class e3{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((t=>t.name))))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class n3{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new e3}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;{const{asyncInit:e}=this.initializeBackend(t);if(e)return null}}return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,n=1){return t in this.registryFactory?(M1(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:n},!0)}async setBackend(t){if(null==this.registryFactory[t])throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,null==this.registry[t]){this.backendInstance=null;const{success:e,asyncInit:n}=this.initializeBackend(t);if(!(n?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new A2(this.backendInstance),!0}setupRegisteredKernels(){P1(this.backendName).forEach((t=>{null!=t.setupFunc&&t.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(t){P1(t).forEach((e=>{null!=e.disposeFunc&&e.disposeFunc(this.registry[t])}))}initializeBackend(t){const e=this.registryFactory[t];if(null==e)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const n=e.factory();if(!n||n instanceof v0||"function"!=typeof n.then)return this.registry[t]=n,{success:!0,asyncInit:!1};{const e=++this.pendingBackendInitId,r=n.then((n=>!(e<this.pendingBackendInitId)&&(this.registry[t]=n,this.pendingBackendInit=null,!0))).catch((n=>(e<this.pendingBackendInitId||(this.pendingBackendInit=null,M1(`Initialization of backend ${t} failed`),M1(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(e){return M1(`Initialization of backend ${t} failed`),M1(e.stack||e.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority))}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e],{success:r,asyncInit:s}=this.initializeBackend(n);if(s||r)return{name:n,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const n=this.state.tensorInfo.get(e),r=n.backend,s=this.readSync(e),o=r.refCount(e);r.disposeData(e,!0),n.backend=t,t.move(e,s,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let n,r=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=e(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(t,e,n){t();try{const t=n();return e(),t}catch(t){throw e(),t}}nextTensorId(){return n3.nextTensorId++}nextVariableId(){return n3.nextVariableId++}clone(t){const e=s3.runKernel("Identity",{x:t}),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(t=>({x:()=>{const e={x:t},n={dtype:"float32"};return s3.runKernel("Cast",e,n)}})),[],{}),e}runKernel(t,e,n){null==this.backendName&&this.backend;if(!(null!=F1(t,this.backendName)))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,n){const r=this.backend.numDataIds();let s=0;n.forEach((t=>{s+="complex64"===t.dtype?3:1}));const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=r-e-s-o;if(i>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${i} data ids) after running '${t}'`)}runKernelFunc(t){let e,n=[];const r=this.isTapeOn(),s=this.state.numBytes,o=this.state.numTensors;let i,a;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const u=t3(t)?t.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(t3(t)){const{kernelName:e,inputs:s,attrs:o}=t;null==this.backendName&&this.backend;const u=F1(e,this.backendName);S0(null!=u,(()=>`Cannot find registered kernel '${e}' for backend '${this.backendName}'`)),i=()=>{const t=this.backend.numDataIds();a=u.kernelFunc({inputs:s,attrs:o,backend:this.backend});const i=Array.isArray(a)?a:[a];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(e,t,i);const c=i.map((t=>null!=t.rank?t:this.makeTensorFromTensorInfo(t)));if(r){const t=this.getTensorsForGradient(e,s,c);n=this.saveTensorsForBackwardMode(t)}return c}}else{const{forwardFunc:e}=t,s=t=>{r&&(n=t.map((t=>this.keep(this.clone(t)))))};i=()=>{const t=this.backend.numDataIds();a=this.tidy((()=>e(this.backend,s)));const n=Array.isArray(a)?a:[a];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,t,n),n}}const{inputs:c,attrs:l}=t,f=t3(t)?null:t.backwardsFunc;let h;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(h=this.profiler.profileKernel(u,c,(()=>i())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(h),e=h.outputs):e=i()})),r&&this.addTapeNode(u,c,e,f,n,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map((t=>null!=c[t]?c[t].shape:null)),outputShapes:e.map((t=>t.shape)),kernelTimeMs:h.timeMs,extraInfo:h.extraInfo}),Array.isArray(a)?e:e[0]}saveTensorsForBackwardMode(t){const e=t.map((t=>this.keep(this.clone(t))));return e}getTensorsForGradient(t,e,n){const r=L1(t);if(null!=r){const t=r.inputsToSave||[],s=r.outputsToSave||[];let o;r.saveAllInputs?(S0(Array.isArray(e),(()=>"saveAllInputs is true, expected inputs to be an array.")),o=Object.keys(e).map((t=>e[t]))):o=t.map((t=>e[t]));const i=n.filter(((t,e)=>s[e]));return o.concat(i)}return[]}makeTensor(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let s=t;"string"===n&&W0(t[0])&&(s=t.map((t=>_2(t))));const o=r.write(s,e,n),i=new V2(e,n,o,this.nextTensorId());if(this.trackTensor(i,r),"string"===n){const t=this.state.tensorInfo.get(o),e=z0(s);this.state.numBytes+=e-t.bytes,t.bytes=e}return i}makeTensorFromDataId(t,e,n,r){const s={dataId:t,shape:e,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(s,r)}makeTensorFromTensorInfo(t,e){const{dataId:n,shape:r,dtype:s}=t,o=new V2(r,s,n,this.nextTensorId());return this.trackTensor(o,e),o}makeVariable(t,e=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.cast(r));const s=new z2(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[s.name])throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(t,e){this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*V0(t.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n})),t instanceof z2||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,"string"===t.dtype&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),"complex64"!==t.dtype&&"string"!==t.dtype){const e=t.size*V0(t.dtype);this.state.numBytes-=e}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((t=>t.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const t of this.state.activeProfile.kernels)t.kernelTimeMs=await t.kernelTimeMs,t.extraInfo=await t.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(t,e,n,r,s,o){const i={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:s},a=L1(t);null!=a&&(r=a.gradFunc),null!=r&&(i.gradient=t=>(t=t.map(((t,e)=>{if(null==t){const t=n[e],r=Z0(t.size,t.dtype);return this.makeTensor(r,t.shape,t.dtype)}return t})),r(t.length>1?t:t[0],s,o))),this.state.activeTape.push(i)}keep(t){return t.kept=!0,t}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=Y2(t),n=new Set(e.map((t=>t.id)));for(let t=0;t<this.state.activeScope.track.length;t++){const e=this.state.activeScope.track[t];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach((t=>{t.kept||t.scopeId!==r.id||this.track(t)}))}gradients(t,e,n,r=!1){if(S0(e.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const s=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",t)));S0(s instanceof V2,(()=>"The result y returned by f() must be a tensor."));const o=function(t,e,n){const r={},s={};for(let t=0;t<e.length;t++)r[e[t].id]=!0;for(let n=0;n<t.length;n++){const o=t[n],i=o.inputs;for(const t in i){const n=i[t];let a=!1;for(let t=0;t<e.length;t++)if(r[n.id]){o.outputs.forEach((t=>r[t.id]=!0)),a=!0,s[o.id]=!0;break}if(a)break}}const o={};o[n.id]=!0;const i={};for(let e=t.length-1;e>=0;e--){const n=t[e],r=n.inputs;for(let t=0;t<n.outputs.length;t++)if(o[n.outputs[t].id]){for(const t in r)o[r[t].id]=!0,i[n.id]=!0;break}}const a=[];for(let e=0;e<t.length;e++){const n=t[e];if(s[n.id]&&i[n.id]){const t={};for(const e in n.inputs){const s=n.inputs[e];r[s.id]&&(t[e]=s)}const e=Object.assign({},n);e.inputs=t,e.outputs=n.outputs,a.push(e)}}return a}(this.state.activeTape,e,s);if(!r&&0===o.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const t={};t[s.id]=null==n?function(t){const e=Y0(A0(t),"float32");return s3.makeTensor(e,t,"float32")}(s.shape):n,function(t,e,n,r){for(let s=e.length-1;s>=0;s--){const o=e[s],i=[];if(o.outputs.forEach((e=>{const n=t[e.id];null!=n?i.push(n):i.push(null)})),null==o.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const e in o.inputs){if(!(e in a))throw new Error(`Cannot backprop through input ${e}. Available gradients found: ${Object.keys(a)}.`);const s=n((()=>a[e]()));if("float32"!==s.dtype)throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${e} must have 'float32' dtype, but has '${s.dtype}'`);const i=o.inputs[e];if(!C0(s.shape,i.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${e}' has shape '${s.shape}', which does not match the shape of the input '${i.shape}'`);if(null==t[i.id])t[i.id]=s;else{const e=t[i.id];t[i.id]=r(e,s),e.dispose()}}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,o,(t=>this.tidy(t)),o3);const r=e.map((e=>t[e.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((t=>{for(const e of t.saved)e.dispose()})),this.state.activeTape=null),{value:s,grads:r}}))}customGrad(t){return S0(q0(t),(()=>"The f passed in customGrad(f) must be a function.")),(...e)=>{let n;S0(e.every((t=>t instanceof V2)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};e.forEach(((t,e)=>{r[e]=t}));return this.runKernelFunc({forwardFunc:(r,s)=>(n=t(...e,s),S0(n.value instanceof V2,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),S0(q0(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(t,r)=>{const s=n.gradFunc(t,r),o=Array.isArray(s)?s:[s];S0(o.length===e.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),S0(o.every((t=>t instanceof V2)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const i={};return o.forEach(((t,e)=>{i[e]=()=>t})),i},inputs:r})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)}async time(t){const e=S2(),n=await this.backend.time(t);return n.wallMs=S2()-e,n}track(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new e3;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function r3(){const t=O1();if(null==t._tfengine){const e=new e1(t);t._tfengine=new n3(e)}var e;return e=t._tfengine.ENV,s1=e,P2=()=>t._tfengine,t._tfengine}n3.nextTensorId=0,n3.nextVariableId=0;const s3=r3();function o3(t,e){const n={a:t,b:e};return s3.runKernel("Add",n)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let i3;function a3(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var u3=Object.freeze({__proto__:null,mockIsMobile:function(t){i3=t},isMobile:function(t){if(void 0!==i3)return i3;if(t||"undefined"!=typeof navigator&&null!=navigator){if(t||(t=navigator),"ReactNative"===t.product)return!0;const e=t.userAgent||t.vendor||("undefined"!=typeof window?window.opera:"");if(!e){const e=t;return e.userAgentData&&e.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1},isBrowser:a3});const c3=r1();c3.registerFlag("DEBUG",(()=>!1),(t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),c3.registerFlag("IS_BROWSER",(()=>a3())),c3.registerFlag("IS_NODE",(()=>void 0!==A1&&void 0!==A1.versions&&void 0!==A1.versions.node)),c3.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),c3.registerFlag("PROD",(()=>!1)),c3.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>c3.getBool("DEBUG"))),c3.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),c3.registerFlag("IS_TEST",(()=>!1)),c3.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>!0)),c3.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),c3.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));var l3=[],f3=[],h3="undefined"!=typeof Uint8Array?Uint8Array:Array,p3=!1;function d3(){p3=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,n=t.length;e<n;++e)l3[e]=t[e],f3[t.charCodeAt(e)]=e;f3["-".charCodeAt(0)]=62,f3["_".charCodeAt(0)]=63}function m3(t,e,n){for(var r,s,o=[],i=e;i<n;i+=3)r=(t[i]<<16)+(t[i+1]<<8)+t[i+2],o.push(l3[(s=r)>>18&63]+l3[s>>12&63]+l3[s>>6&63]+l3[63&s]);return o.join("")}function y3(t){var e;p3||d3();for(var n=t.length,r=n%3,s="",o=[],i=16383,a=0,u=n-r;a<u;a+=i)o.push(m3(t,a,a+i>u?u:a+i));return 1===r?(e=t[n-1],s+=l3[e>>2],s+=l3[e<<4&63],s+="=="):2===r&&(e=(t[n-2]<<8)+t[n-1],s+=l3[e>>10],s+=l3[e>>4&63],s+=l3[e<<2&63],s+="="),o.push(s),o.join("")}function g3(t,e,n,r,s){var o,i,a=8*s-r-1,u=(1<<a)-1,c=u>>1,l=-7,f=n?s-1:0,h=n?-1:1,p=t[e+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+t[e+f],f+=h,l-=8);for(i=o&(1<<-l)-1,o>>=-l,l+=r;l>0;i=256*i+t[e+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return i?NaN:1/0*(p?-1:1);i+=Math.pow(2,r),o-=c}return(p?-1:1)*i*Math.pow(2,o-r)}function b3(t,e,n,r,s,o){var i,a,u,c=8*o-s-1,l=(1<<c)-1,f=l>>1,h=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,i=l):(i=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-i))<1&&(i--,u*=2),(e+=i+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(i++,u/=2),i+f>=l?(a=0,i=l):i+f>=1?(a=(e*u-1)*Math.pow(2,s),i+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,s),i=0));s>=8;t[n+p]=255&a,p+=d,a/=256,s-=8);for(i=i<<s|a,c+=s;c>0;t[n+p]=255&i,p+=d,i/=256,c-=8);t[n+p-d]|=128*m}var w3={}.toString,v3=Array.isArray||function(t){return"[object Array]"==w3.call(t)};function x3(){return $3.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function N3(t,e){if(x3()<e)throw new RangeError("Invalid typed array length");return $3.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=$3.prototype:(null===t&&(t=new $3(e)),t.length=e),t}function $3(t,e,n){if(!($3.TYPED_ARRAY_SUPPORT||this instanceof $3))return new $3(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return _3(this,t)}return E3(this,t,e,n)}function E3(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);$3.TYPED_ARRAY_SUPPORT?(t=e).__proto__=$3.prototype:t=T3(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!$3.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|C3(e,n),s=(t=N3(t,r)).write(e,n);s!==r&&(t=t.slice(0,s));return t}(t,e,n):function(t,e){if(A3(e)){var n=0|k3(e.length);return 0===(t=N3(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?N3(t,0):T3(t,e);if("Buffer"===e.type&&v3(e.data))return T3(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function S3(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function _3(t,e){if(S3(e),t=N3(t,e<0?0:0|k3(e)),!$3.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function T3(t,e){var n=e.length<0?0:0|k3(e.length);t=N3(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function k3(t){if(t>=x3())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+x3().toString(16)+" bytes");return 0|t}function A3(t){return!(null==t||!t._isBuffer)}function C3(t,e){if(A3(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return n4(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return r4(t).length;default:if(r)return n4(t).length;e=(""+e).toLowerCase(),r=!0}}function O3(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return G3(this,e,n);case"utf8":case"utf-8":return W3(this,e,n);case"ascii":return U3(this,e,n);case"latin1":case"binary":return j3(this,e,n);case"base64":return z3(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return q3(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function I3(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function M3(t,e,n,r,s){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=s?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(s)return-1;n=t.length-1}else if(n<0){if(!s)return-1;n=0}if("string"==typeof e&&(e=$3.from(e,r)),A3(e))return 0===e.length?-1:R3(t,e,n,r,s);if("number"==typeof e)return e&=255,$3.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):R3(t,[e],n,r,s);throw new TypeError("val must be string, number or Buffer")}function R3(t,e,n,r,s){var o,i=1,a=t.length,u=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;i=2,a/=2,u/=2,n/=2}function c(t,e){return 1===i?t[e]:t.readUInt16BE(e*i)}if(s){var l=-1;for(o=n;o<a;o++)if(c(t,o)===c(e,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*i}else-1!==l&&(o-=o-l),l=-1}else for(n+u>a&&(n=a-u),o=n;o>=0;o--){for(var f=!0,h=0;h<u;h++)if(c(t,o+h)!==c(e,h)){f=!1;break}if(f)return o}return-1}function D3(t,e,n,r){n=Number(n)||0;var s=t.length-n;r?(r=Number(r))>s&&(r=s):r=s;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var i=0;i<r;++i){var a=parseInt(e.substr(2*i,2),16);if(isNaN(a))return i;t[n+i]=a}return i}function F3(t,e,n,r){return s4(n4(e,t.length-n),t,n,r)}function L3(t,e,n,r){return s4(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function P3(t,e,n,r){return L3(t,e,n,r)}function B3(t,e,n,r){return s4(r4(e),t,n,r)}function V3(t,e,n,r){return s4(function(t,e){for(var n,r,s,o=[],i=0;i<t.length&&!((e-=2)<0);++i)r=(n=t.charCodeAt(i))>>8,s=n%256,o.push(s),o.push(r);return o}(e,t.length-n),t,n,r)}function z3(t,e,n){return 0===e&&n===t.length?y3(t):y3(t.slice(e,n))}function W3(t,e,n){n=Math.min(t.length,n);for(var r=[],s=e;s<n;){var o,i,a,u,c=t[s],l=null,f=c>239?4:c>223?3:c>191?2:1;if(s+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=t[s+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=t[s+1],i=t[s+2],128==(192&o)&&128==(192&i)&&(u=(15&c)<<12|(63&o)<<6|63&i)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=t[s+1],i=t[s+2],a=t[s+3],128==(192&o)&&128==(192&i)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&i)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),s+=f}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=4096));return n}(r)}$3.TYPED_ARRAY_SUPPORT=void 0===s0.TYPED_ARRAY_SUPPORT||s0.TYPED_ARRAY_SUPPORT,x3(),$3.poolSize=8192,$3._augment=function(t){return t.__proto__=$3.prototype,t},$3.from=function(t,e,n){return E3(null,t,e,n)},$3.TYPED_ARRAY_SUPPORT&&($3.prototype.__proto__=Uint8Array.prototype,$3.__proto__=Uint8Array),$3.alloc=function(t,e,n){return function(t,e,n,r){return S3(e),e<=0?N3(t,e):void 0!==n?"string"==typeof r?N3(t,e).fill(n,r):N3(t,e).fill(n):N3(t,e)}(null,t,e,n)},$3.allocUnsafe=function(t){return _3(null,t)},$3.allocUnsafeSlow=function(t){return _3(null,t)},$3.isBuffer=function(t){return null!=t&&(!!t._isBuffer||o4(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&o4(t.slice(0,0))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t))},$3.compare=function(t,e){if(!A3(t)||!A3(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,s=0,o=Math.min(n,r);s<o;++s)if(t[s]!==e[s]){n=t[s],r=e[s];break}return n<r?-1:r<n?1:0},$3.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},$3.concat=function(t,e){if(!v3(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return $3.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=$3.allocUnsafe(e),s=0;for(n=0;n<t.length;++n){var o=t[n];if(!A3(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,s),s+=o.length}return r},$3.byteLength=C3,$3.prototype._isBuffer=!0,$3.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)I3(this,e,e+1);return this},$3.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)I3(this,e,e+3),I3(this,e+1,e+2);return this},$3.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)I3(this,e,e+7),I3(this,e+1,e+6),I3(this,e+2,e+5),I3(this,e+3,e+4);return this},$3.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?W3(this,0,t):O3.apply(this,arguments)},$3.prototype.equals=function(t){if(!A3(t))throw new TypeError("Argument must be a Buffer");return this===t||0===$3.compare(this,t)},$3.prototype.inspect=function(){var t="";return this.length>0&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(t+=" ... ")),"<Buffer "+t+">"},$3.prototype.compare=function(t,e,n,r,s){if(!A3(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===s&&(s=this.length),e<0||n>t.length||r<0||s>this.length)throw new RangeError("out of range index");if(r>=s&&e>=n)return 0;if(r>=s)return-1;if(e>=n)return 1;if(this===t)return 0;for(var o=(s>>>=0)-(r>>>=0),i=(n>>>=0)-(e>>>=0),a=Math.min(o,i),u=this.slice(r,s),c=t.slice(e,n),l=0;l<a;++l)if(u[l]!==c[l]){o=u[l],i=c[l];break}return o<i?-1:i<o?1:0},$3.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},$3.prototype.indexOf=function(t,e,n){return M3(this,t,e,n,!0)},$3.prototype.lastIndexOf=function(t,e,n){return M3(this,t,e,n,!1)},$3.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var s=this.length-e;if((void 0===n||n>s)&&(n=s),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return D3(this,t,e,n);case"utf8":case"utf-8":return F3(this,t,e,n);case"ascii":return L3(this,t,e,n);case"latin1":case"binary":return P3(this,t,e,n);case"base64":return B3(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V3(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},$3.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function U3(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(127&t[s]);return r}function j3(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(t[s]);return r}function G3(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var s="",o=e;o<n;++o)s+=e4(t[o]);return s}function q3(t,e,n){for(var r=t.slice(e,n),s="",o=0;o<r.length;o+=2)s+=String.fromCharCode(r[o]+256*r[o+1]);return s}function H3(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function K3(t,e,n,r,s,o){if(!A3(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function X3(t,e,n,r){e<0&&(e=65535+e+1);for(var s=0,o=Math.min(t.length-n,2);s<o;++s)t[n+s]=(e&255<<8*(r?s:1-s))>>>8*(r?s:1-s)}function J3(t,e,n,r){e<0&&(e=4294967295+e+1);for(var s=0,o=Math.min(t.length-n,4);s<o;++s)t[n+s]=e>>>8*(r?s:3-s)&255}function Y3(t,e,n,r,s,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function Z3(t,e,n,r,s){return s||Y3(t,0,n,4),b3(t,e,n,r,23,4),n+4}function Q3(t,e,n,r,s){return s||Y3(t,0,n,8),b3(t,e,n,r,52,8),n+8}$3.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),$3.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=$3.prototype;else{var s=e-t;n=new $3(s,void 0);for(var o=0;o<s;++o)n[o]=this[o+t]}return n},$3.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||H3(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r},$3.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||H3(t,e,this.length);for(var r=this[t+--e],s=1;e>0&&(s*=256);)r+=this[t+--e]*s;return r},$3.prototype.readUInt8=function(t,e){return e||H3(t,1,this.length),this[t]},$3.prototype.readUInt16LE=function(t,e){return e||H3(t,2,this.length),this[t]|this[t+1]<<8},$3.prototype.readUInt16BE=function(t,e){return e||H3(t,2,this.length),this[t]<<8|this[t+1]},$3.prototype.readUInt32LE=function(t,e){return e||H3(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},$3.prototype.readUInt32BE=function(t,e){return e||H3(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},$3.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||H3(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r>=(s*=128)&&(r-=Math.pow(2,8*e)),r},$3.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||H3(t,e,this.length);for(var r=e,s=1,o=this[t+--r];r>0&&(s*=256);)o+=this[t+--r]*s;return o>=(s*=128)&&(o-=Math.pow(2,8*e)),o},$3.prototype.readInt8=function(t,e){return e||H3(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},$3.prototype.readInt16LE=function(t,e){e||H3(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},$3.prototype.readInt16BE=function(t,e){e||H3(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},$3.prototype.readInt32LE=function(t,e){return e||H3(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},$3.prototype.readInt32BE=function(t,e){return e||H3(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},$3.prototype.readFloatLE=function(t,e){return e||H3(t,4,this.length),g3(this,t,!0,23,4)},$3.prototype.readFloatBE=function(t,e){return e||H3(t,4,this.length),g3(this,t,!1,23,4)},$3.prototype.readDoubleLE=function(t,e){return e||H3(t,8,this.length),g3(this,t,!0,52,8)},$3.prototype.readDoubleBE=function(t,e){return e||H3(t,8,this.length),g3(this,t,!1,52,8)},$3.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||K3(this,t,e,n,Math.pow(2,8*n)-1,0);var s=1,o=0;for(this[e]=255&t;++o<n&&(s*=256);)this[e+o]=t/s&255;return e+n},$3.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||K3(this,t,e,n,Math.pow(2,8*n)-1,0);var s=n-1,o=1;for(this[e+s]=255&t;--s>=0&&(o*=256);)this[e+s]=t/o&255;return e+n},$3.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||K3(this,t,e,1,255,0),$3.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},$3.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||K3(this,t,e,2,65535,0),$3.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):X3(this,t,e,!0),e+2},$3.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||K3(this,t,e,2,65535,0),$3.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):X3(this,t,e,!1),e+2},$3.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||K3(this,t,e,4,4294967295,0),$3.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):J3(this,t,e,!0),e+4},$3.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||K3(this,t,e,4,4294967295,0),$3.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):J3(this,t,e,!1),e+4},$3.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);K3(this,t,e,n,s-1,-s)}var o=0,i=1,a=0;for(this[e]=255&t;++o<n&&(i*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},$3.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);K3(this,t,e,n,s-1,-s)}var o=n-1,i=1,a=0;for(this[e+o]=255&t;--o>=0&&(i*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},$3.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||K3(this,t,e,1,127,-128),$3.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},$3.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||K3(this,t,e,2,32767,-32768),$3.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):X3(this,t,e,!0),e+2},$3.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||K3(this,t,e,2,32767,-32768),$3.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):X3(this,t,e,!1),e+2},$3.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||K3(this,t,e,4,2147483647,-2147483648),$3.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):J3(this,t,e,!0),e+4},$3.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||K3(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),$3.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):J3(this,t,e,!1),e+4},$3.prototype.writeFloatLE=function(t,e,n){return Z3(this,t,e,!0,n)},$3.prototype.writeFloatBE=function(t,e,n){return Z3(this,t,e,!1,n)},$3.prototype.writeDoubleLE=function(t,e,n){return Q3(this,t,e,!0,n)},$3.prototype.writeDoubleBE=function(t,e,n){return Q3(this,t,e,!1,n)},$3.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var s,o=r-n;if(this===t&&n<e&&e<r)for(s=o-1;s>=0;--s)t[s+e]=this[s+n];else if(o<1e3||!$3.TYPED_ARRAY_SUPPORT)for(s=0;s<o;++s)t[s+e]=this[s+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},$3.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var s=t.charCodeAt(0);s<256&&(t=s)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!$3.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var i=A3(t)?t:n4(new $3(t,r).toString()),a=i.length;for(o=0;o<n-e;++o)this[o+e]=i[o%a]}return this};var t4=/[^+\/0-9A-Za-z-_]/g;function e4(t){return t<16?"0"+t.toString(16):t.toString(16)}function n4(t,e){var n;e=e||1/0;for(var r=t.length,s=null,o=[],i=0;i<r;++i){if((n=t.charCodeAt(i))>55295&&n<57344){if(!s){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(i+1===r){(e-=3)>-1&&o.push(239,191,189);continue}s=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),s=n;continue}n=65536+(s-55296<<10|n-56320)}else s&&(e-=3)>-1&&o.push(239,191,189);if(s=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function r4(t){return function(t){var e,n,r,s,o,i;p3||d3();var a=t.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===t[a-2]?2:"="===t[a-1]?1:0,i=new h3(3*a/4-o),r=o>0?a-4:a;var u=0;for(e=0,n=0;e<r;e+=4,n+=3)s=f3[t.charCodeAt(e)]<<18|f3[t.charCodeAt(e+1)]<<12|f3[t.charCodeAt(e+2)]<<6|f3[t.charCodeAt(e+3)],i[u++]=s>>16&255,i[u++]=s>>8&255,i[u++]=255&s;return 2===o?(s=f3[t.charCodeAt(e)]<<2|f3[t.charCodeAt(e+1)]>>4,i[u++]=255&s):1===o&&(s=f3[t.charCodeAt(e)]<<10|f3[t.charCodeAt(e+1)]<<4|f3[t.charCodeAt(e+2)]>>2,i[u++]=s>>8&255,i[u++]=255&s),i}(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(t4,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function s4(t,e,n,r){for(var s=0;s<r&&!(s+n>=e.length||s>=t.length);++s)e[s+n]=t[s];return s}function o4(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function i4(t,e){let n=t;if(B0(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||B0(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&r1().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&a4(t,r,[]),r}function a4(t,e,n){if(n=n||[],!Array.isArray(t)&&!B0(t))return void S0(0===e.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`));S0(e.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`)),S0(t.length===e[0],(()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`));const r=e.slice(1);for(let e=0;e<t.length;++e)a4(t[e],r,n.concat(e))}function u4(t,e,n,r){if("string_or_numeric"!==t){if(null==t)throw new Error("Expected dtype cannot be null.");if("numeric"!==t&&t!==e||"numeric"===t&&"string"===e)throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}}function c4(t,e,n,r="numeric"){if(t instanceof V2)return u4(r,t.dtype,e,n),t;let s=G0(t);if("string"!==s&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),u4(r,s,e,n),null==t||!B0(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){const r=null==t?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const o=i4(t,s);B0(t)||Array.isArray(t)||(t=[t]);const i="string"!==s?E2(t,s):k0(t,[],!0);return s3.makeTensor(i,o,s)}function l4(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map(((t,s)=>c4(t,`${e}[${s}]`,n,r)))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f4(t){const e=Object.keys(t);if(1!==e.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const s=(...t)=>{s3.startScope(n);try{const e=r(...t);return t1(e)&&console.error("Cannot return a Promise inside of tidy."),s3.endScope(e),e}catch(t){throw s3.endScope(null),t}};return Object.defineProperty(s,"name",{value:n,configurable:!0}),s}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h4=f4({complex_:function(t,e){const n=c4(t,"real","complex"),r=c4(e,"imag","complex");_0(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const s={real:n,imag:r};return s3.runKernel("Complex",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p4(t,e,n,r){if(null==r&&(r=G0(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!B0(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){Q0(e);const t=A0(e),r=A0(n);S0(t===r,(()=>`Based on the provided shape, [${e}], the tensor should have ${t} values but has ${r}`));for(let t=0;t<n.length;++t){const r=n[t],s=t!==n.length-1||r!==A0(e.slice(t));S0(n[t]===e[t]||!s,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `))}}return B0(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?E2(t,r):k0(t,[],!0),s3.makeTensor(t,e,r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d4(t,e,n){return p4(t,e,i4(t,n),n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m4={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};function y4(t,e){const n={};let r,s=0;for(const o of e){const e=o.name,i=o.dtype,a=o.shape,u=A0(a);let c;if("quantization"in o){const n=o.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error(`Weight ${o.name} with quantization ${n.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==n.dtype)throw new Error(`Weight ${o.name} has unknown quantization dtype ${n.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==i)throw new Error(`Weight ${o.name} is quantized with ${n.dtype} which only supports weights of type float32 not ${i}.`)}const a=m4[n.dtype],l=t.slice(s,s+u*a),f="uint8"===n.dtype?new Uint8Array(l):new Uint16Array(l);if("float32"===i)if("uint8"===n.dtype||"uint16"===n.dtype){c=new Float32Array(f.length);for(let t=0;t<f.length;t++){const e=f[t];c[t]=e*n.scale+n.min}}else{if("float16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type float32.`);void 0===r&&(r=S4()),c=r(f)}else{if("int32"!==i)throw new Error(`Unsupported dtype in weight '${e}': ${i}`);if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type int32.`);c=new Int32Array(f.length);for(let t=0;t<f.length;t++){const e=f[t];c[t]=Math.round(e*n.scale+n.min)}}s+=u*a}else if("string"===i){const e=A0(o.shape);c=[];for(let n=0;n<e;n++){const e=new Uint32Array(t.slice(s,s+4))[0];s+=4;const n=new Uint8Array(t.slice(s,s+e));c.push(n),s+=e}}else{const r=m4[i],o=t.slice(s,s+u*r);if("float32"===i)c=new Float32Array(o);else if("int32"===i)c=new Int32Array(o);else if("bool"===i)c=new Uint8Array(o);else{if("complex64"!==i)throw new Error(`Unsupported dtype in weight '${e}': ${i}`);{c=new Float32Array(o);const t=new Float32Array(c.length/2),r=new Float32Array(c.length/2);for(let e=0;e<t.length;e++)t[e]=c[2*e],r[e]=c[2*e+1];const s=d4(t,a,"float32"),i=d4(r,a,"float32");n[e]=h4(s,i),s.dispose(),i.dispose()}}s+=u*r}"complex64"!==i&&(n[e]=d4(c,a,i))}return n}function g4(t){if(null===t)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach((t=>{if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${t.constructor.name}`)}));const r=new Uint8Array(e);let s=0;return n.forEach((t=>{r.set(new Uint8Array(t.buffer),s),s+=t.byteLength})),r.buffer}const b4="undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa;function w4(t){return b4?$3.byteLength(t):new Blob([t]).size}function v4(t){if(1===t.length)return t[0];let e=0;t.forEach((t=>{e+=t.byteLength}));const n=new Uint8Array(e);let r=0;return t.forEach((t=>{n.set(new Uint8Array(t),r),r+=t.byteLength})),n.buffer}function x4(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);const e=t.split("/");return e[e.length-1]}function N4(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),n}async function $4(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),null!=t.weightsManifest){const[r,s]=await e(t.weightsManifest);n.weightSpecs=r,n.weightData=s}return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),n}function E4(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:w4(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:w4(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}function S4(){const t=function(){const t=t=>{let e=t<<13,n=0;for(;0==(8388608&e);)n-=8388608,e<<=1;return e&=-8388609,n+=947912704,e|n},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}(),e=function(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}(),n=function(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}();return r=>{const s=new ArrayBuffer(4*r.length),o=new Uint32Array(s);for(let s=0;s<r.length;s++){const i=r[s],a=t[n[i>>10]+(1023&i)]+e[i>>10];o[s]=a}return new Float32Array(s)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _4{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==_4.instance&&(_4.instance=new _4),_4.instance}static registerSaveRouter(t){_4.getInstance().saveRouters.push(t)}static registerLoadRouter(t){_4.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return _4.getHandlers(t,"save")}static getLoadHandlers(t,e){return _4.getHandlers(t,"load",e)}static getHandlers(t,e,n){const r=[];return("load"===e?_4.getInstance().loadRouters:_4.getInstance().saveRouters).forEach((e=>{const s=e(t,n);null!==s&&r.push(s)})),r}}const T4=t=>_4.getSaveHandlers(t),k4=(t,e)=>_4.getLoadHandlers(t,e)
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */;function A4(){if(!r1().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t="undefined"==typeof window?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function C4(t){const e=t.result;e.createObjectStore("models_store",{keyPath:"modelPath"}),e.createObjectStore("model_info_store",{keyPath:"modelPath"})}class O4{constructor(t){if(this.indexedDB=A4(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise(((t,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>C4(r),r.onsuccess=()=>{const s=r.result;if(null==e){const e=s.transaction("models_store","readonly"),r=e.objectStore("models_store").get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return s.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));t(r.result.modelArtifacts)},r.onerror=t=>(s.close(),n(r.error)),e.oncomplete=()=>s.close()}else{const r=E4(e),o=s.transaction("model_info_store","readwrite");let i=o.objectStore("model_info_store");const a=i.put({modelPath:this.modelPath,modelArtifactsInfo:r});let u;a.onsuccess=()=>{u=s.transaction("models_store","readwrite");const a=u.objectStore("models_store").put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:r});a.onsuccess=()=>t({modelArtifactsInfo:r}),a.onerror=t=>{i=o.objectStore("model_info_store");const e=i.delete(this.modelPath);e.onsuccess=()=>(s.close(),n(a.error)),e.onerror=t=>(s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}}},r.onerror=t=>n(r.error)}))}}O4.URL_SCHEME="indexeddb://";const I4=t=>{return r1().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(O4.URL_SCHEME)?(e=t.slice(O4.URL_SCHEME.length),new O4(e)):null;var e};_4.registerSaveRouter(I4),_4.registerLoadRouter(I4);class M4{constructor(){this.indexedDB=A4()}async listModels(){return new Promise(((t,e)=>{const n=this.indexedDB.open("tensorflowjs",1);n.onupgradeneeded=()=>C4(n),n.onsuccess=()=>{const r=n.result,s=r.transaction("model_info_store","readonly"),o=s.objectStore("model_info_store").getAll();o.onsuccess=()=>{const e={};for(const t of o.result)e[t.modelPath]=t.modelArtifactsInfo;t(e)},o.onerror=t=>(r.close(),e(o.error)),s.oncomplete=()=>r.close()},n.onerror=t=>e(n.error)}))}async removeModel(t){var e;return t=(e=t).startsWith(O4.URL_SCHEME)?e.slice(O4.URL_SCHEME.length):e,new Promise(((e,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>C4(r),r.onsuccess=()=>{const s=r.result,o=s.transaction("model_info_store","readwrite"),i=o.objectStore("model_info_store"),a=i.get(t);let u;a.onsuccess=()=>{if(null==a.result)return s.close(),n(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const r=i.delete(t),o=()=>{u=s.transaction("models_store","readwrite");const r=u.objectStore("models_store").delete(t);r.onsuccess=()=>e(a.result.modelArtifactsInfo),r.onerror=t=>n(a.error)};r.onsuccess=o,r.onerror=t=>(o(),s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}},r.onerror=t=>n(r.error)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R4="tensorflowjs_models",D4="info",F4="model_topology",L4="weight_specs",P4="weight_data",B4="model_metadata";function V4(t){return{info:[R4,t,D4].join("/"),topology:[R4,t,F4].join("/"),weightSpecs:[R4,t,L4].join("/"),weightData:[R4,t,P4].join("/"),modelMetadata:[R4,t,B4].join("/")}}function z4(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function W4(t){const e=t.split("/");if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join("/")}class U4{constructor(t){if(!r1().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=V4(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=E4(t);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(b4)return $3.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let t=0,r=e.length;t<r;t++)n+=String.fromCharCode(e[t]);return btoa(n)}(t.weightData));const s={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:r}}catch(t){throw z4(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(null==t)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=r;const s=this.LS.getItem(this.keys.modelMetadata);if(null!=s){const t=JSON.parse(s);e.format=t.format,e.generatedBy=t.generatedBy,e.convertedBy=t.convertedBy,null!=t.signature&&(e.signature=t.signature),null!=t.userDefinedMetadata&&(e.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(e.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(e.trainingConfig=t.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(null==o)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=function(t){if(b4){const e=$3.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;++t)n.set([e.charCodeAt(t)],t);return n.buffer}(o),e}}U4.URL_SCHEME="localstorage://";const j4=t=>{return r1().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(U4.URL_SCHEME)?(e=t.slice(U4.URL_SCHEME.length),new U4(e)):null;var e};_4.registerSaveRouter(j4),_4.registerLoadRouter(j4);class G4{constructor(){S0(r1().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),S0("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const t={},e=R4+"/",n="/"+D4;for(let r=0;r<this.LS.length;++r){const s=this.LS.key(r);if(s.startsWith(e)&&s.endsWith(n)){t[W4(s)]=JSON.parse(this.LS.getItem(s))}}return t}async removeModel(t){var e;const n=V4(t=(e=t).startsWith(U4.URL_SCHEME)?e.slice(U4.URL_SCHEME.length):e);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(n.info));return z4(n),r}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class q4{constructor(){this.managers={}}static getInstance(){return null==q4.instance&&(q4.instance=new q4),q4.instance}static registerManager(t,e){S0(null!=t,(()=>"scheme must not be undefined or null.")),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),S0(t.length>0,(()=>"scheme must not be an empty string."));const n=q4.getInstance();S0(null==n.managers[t],(()=>`A model store manager is already registered for scheme '${t}'.`)),n.managers[t]=e}static getManager(t){const e=this.getInstance().managers[t];if(null==e)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}}function H4(t){if(-1===t.indexOf("://"))throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${q4.getSchemes().join(",")}`);return{scheme:t.split("://")[0],path:t.split("://")[1]}}async function K4(t,e,n=!1){S0(t!==e,(()=>`Old path and new path are the same: '${t}'`));const r=_4.getLoadHandlers(t);S0(r.length>0,(()=>`Copying failed because no load handler is found for source URL ${t}.`)),S0(r.length<2,(()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${t}.`));const s=r[0],o=_4.getSaveHandlers(e);S0(o.length>0,(()=>`Copying failed because no save handler is found for destination URL ${e}.`)),S0(o.length<2,(()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${e}.`));const i=o[0],a=H4(t).scheme,u=H4(t).path,c=a===H4(t).scheme,l=await s.load();n&&c&&await q4.getManager(a).removeModel(u);const f=await i.save(l);return n&&!c&&await q4.getManager(a).removeModel(u),f.modelArtifactsInfo}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class X4{fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}}if(r1().get("IS_BROWSER")){r1().setPlatform("browser",new X4);try{q4.registerManager(U4.URL_SCHEME,new G4)}catch(t){}try{q4.registerManager(O4.URL_SCHEME,new M4)}catch(t){}}const J4=()=>require("node-fetch");let Y4;class Z4{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return null!=r1().global.fetch?r1().global.fetch(t,e):(null==Y4&&(Y4=J4()),Y4(t,e))}now(){const t=A1.hrtime();return 1e3*t[0]+t[1]/1e6}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)}}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Q4(t,e="float32",n){return e=e||"float32",Q0(t),new L2(t,e,n)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */r1().get("IS_NODE")&&!r1().get("IS_BROWSER")&&r1().setPlatform("node",new Z4);const t6=f4({cast_:function(t,e){const n=c4(t,"x","cast");if(!P0(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},s={dtype:e};return s3.runKernel("Cast",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e6=f4({clone_:function(t){const e={x:c4(t,"x","clone","string_or_numeric")};return s3.runKernel("Identity",e)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n6(t,e=!1){console.log(t.toString(e))}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */r3();!function(t){B2=t}({buffer:Q4,cast:t6,clone:e6,print:n6});function r6(t){return new Promise((t=>setTimeout(t))).then(t)}class s6{constructor(t){if(!r1().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(s6.URL_SCHEME)&&(t=t.slice(s6.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}async save(t){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n=N4(t,[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]),r=window.URL.createObjectURL(new Blob([JSON.stringify(n)],{type:"application/json"})),s=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(s.download=this.modelJsonFileName,s.href=r,await r6((()=>s.dispatchEvent(new MouseEvent("click")))),null!=t.weightData){const t=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;t.download=this.weightDataFileName,t.href=e,await r6((()=>t.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:E4(t)}}}}s6.URL_SCHEME="downloads://";class o6{constructor(t){if(null==t||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.jsonFile=t[0],this.weightsFiles=t.slice(1)}async load(){return new Promise(((t,e)=>{const n=new FileReader;n.onload=n=>{const r=JSON.parse(n.target.result),s=r.modelTopology;if(null==s)return void e(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));if(null==r.weightsManifest)return void e(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));if(0===this.weightsFiles.length)return void t({modelTopology:s});const o=$4(r,(t=>this.loadWeights(t)));t(o)},n.onerror=t=>e(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),n.readAsText(this.jsonFile)}))}loadWeights(t){const e=[],n=[];for(const r of t)e.push(...r.weights),n.push(...r.paths);const r=this.checkManifestAndWeightFiles(t),s=n.map((t=>this.loadWeightsFile(t,r[t])));return Promise.all(s).then((t=>[e,v4(t)]))}loadWeightsFile(t,e){return new Promise(((n,r)=>{const s=new FileReader;s.onload=t=>{const e=t.target.result;n(e)},s.onerror=e=>r(`Failed to weights data from file of path '${t}'.`),s.readAsArrayBuffer(e)}))}checkManifestAndWeightFiles(t){const e=[],n=this.weightsFiles.map((t=>x4(t.name))),r={};for(const s of t)s.paths.forEach((t=>{const s=x4(t);if(-1!==e.indexOf(s))throw new Error(`Duplicate file basename found in weights manifest: '${s}'`);if(e.push(s),-1===n.indexOf(s))throw new Error(`Weight file with basename '${s}' is not provided.`);r[t]=this.weightsFiles[n.indexOf(s)]}));if(e.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${e.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function i6(t,e,n,r){!function(t){S0(null!=t&&Array.isArray(t)&&t.length>0,(()=>"promises must be a none empty array"))}(t),function(t,e){S0(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${t}`)),S0(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${e}`)),S0(e>=t,(()=>`startFraction must be no more than endFraction, but got startFraction ${t} and endFraction ${e}`))}(n=null==n?0:n,r=null==r?1:r);let s=0;return Promise.all(t.map((o=>(o.then((o=>{const i=n+ ++s/t.length*(r-n);return e(i),o})),o))))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function a6(t,e){null==e&&(e={});const n=null==e.fetchFunc?r1().platform.fetch:e.fetchFunc,r=t.map((t=>n(t,e.requestInit,{isBinary:!0}))),s=(null==e.onProgress?await Promise.all(r):await i6(r,e.onProgress,0,.5)).map((t=>t.arrayBuffer()));return null==e.onProgress?await Promise.all(s):await i6(s,e.onProgress,.5,1)}function u6(t){return async(e,n="",r)=>{const s=e.map((()=>!1)),o={},i=null!=r?r.map((()=>!1)):[],a=[];if(e.forEach(((t,e)=>{let n=0;t.weights.forEach((t=>{const u="quantization"in t?t.quantization.dtype:t.dtype,c=m4[u]*A0(t.shape),l=()=>{s[e]=!0,null==o[e]&&(o[e]=[]),o[e].push({manifestEntry:t,groupOffset:n,sizeBytes:c})};null!=r?r.forEach(((e,n)=>{e===t.name&&(l(),i[n]=!0)})):l(),a.push(t.name),n+=c}))})),!i.every((t=>t))){const t=r.filter(((t,e)=>!i[e]));throw new Error(`Could not find weights in manifest with names: ${t.join(", ")}. \nManifest JSON has weights with names: ${a.join(", ")}.`)}const u=s.reduce(((t,e,n)=>(e&&t.push(n),t)),[]),c=[];u.forEach((t=>{e[t].paths.forEach((t=>{const e=n+(n.endsWith("/")?"":"/")+t;c.push(e)}))}));const l=await t(c),f={};let h=0;return u.forEach((t=>{const n=e[t].paths.length;let r=0;for(let t=0;t<n;t++)r+=l[h+t].byteLength;const s=new ArrayBuffer(r),i=new Uint8Array(s);let a=0;for(let t=0;t<n;t++){const e=new Uint8Array(l[h+t]);i.set(e,a),a+=e.byteLength}o[t].forEach((t=>{const e=y4(s.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(const t in e)f[t]=e[t]})),h+=n})),f}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_4.registerSaveRouter((t=>r1().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(s6.URL_SCHEME)?function(t="model"){return new s6(t)}(t.slice(s6.URL_SCHEME.length)):null));class c6{constructor(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,this.weightUrlConverter=e.weightUrlConverter,null!=e.fetchFunc?(S0("function"==typeof e.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=e.fetchFunc):this.fetch=r1().platform.fetch,S0(null!=t&&t.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(t)&&S0(2===t.length,(()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`)),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData;const n=N4(t,[{paths:["./model.weights.bin"],weights:t.weightSpecs}]);e.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin");const r=await this.fetch(this.path,e);if(r.ok)return{modelArtifactsInfo:E4(t),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let e;try{e=await t.json()}catch(t){let e=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=e.modelTopology,r=e.weightsManifest;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return $4(e,(t=>this.loadWeights(t)))}async loadWeights(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),r=t.substring(0,e),s=n>e?t.substring(n):"";return[r+"/",s]}(e),s=this.weightPathPrefix||n,o=[];for(const e of t)o.push(...e.weights);const i=[],a=[];for(const e of t)for(const t of e.paths)null!=this.weightUrlConverter?a.push(this.weightUrlConverter(t)):i.push(s+t+r);this.weightUrlConverter&&i.push(...await Promise.all(a));return[o,v4(await a6(i,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress}))]}}function l6(t){return null!=t.match(c6.URL_SCHEME_REGEX)}c6.URL_SCHEME_REGEX=/^https?:\/\//;const f6=(t,e)=>{if("undefined"==typeof fetch&&(null==e||null==e.fetchFunc))return null;{let n=!0;if(n=Array.isArray(t)?t.every((t=>l6(t))):l6(t),n)return h6(t,e)}return null};function h6(t,e){return new c6(t,e)}function p6(t,e){return h6(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_4.registerSaveRouter(f6),_4.registerLoadRouter(f6);class d6{constructor(t){this.modelArtifacts=t}load(){return this.modelArtifacts}}class m6{constructor(t){this.saveHandler=t}save(t){return this.saveHandler(t)}}class y6{constructor(t){t.load&&(this.load=()=>Promise.resolve(t.load())),t.save&&(this.save=e=>Promise.resolve(t.save(e)))}}function g6(t,e,n,r){if(1===arguments.length){return null!=t.modelTopology||null!=t.weightSpecs?new d6(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new d6({modelTopology:t}))}return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new d6({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r})}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var b6=Object.freeze({__proto__:null,browserFiles:function(t){return new o6(t)},browserHTTPRequest:p6,concatenateArrayBuffers:v4,decodeWeights:y4,encodeWeights:async function(t,e){const n=[],r=[],s=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);for(let o=0;o<s.length;++o){const i=s[o],a=Array.isArray(t)?t[o].tensor:t[i];if("float32"!==a.dtype&&"int32"!==a.dtype&&"bool"!==a.dtype&&"string"!==a.dtype&&"complex64"!==a.dtype)throw new Error(`Unsupported dtype in weight '${i}': ${a.dtype}`);const u={name:i,shape:a.shape,dtype:a.dtype};if("string"===a.dtype){const t=new Promise((async t=>{const e=await a.bytes(),n=e.reduce(((t,e)=>t+e.length),0)+4*e.length,r=new Uint8Array(n);let s=0;for(let t=0;t<e.length;t++){const n=e[t],o=new Uint8Array(new Uint32Array([n.length]).buffer);r.set(o,s),s+=4,r.set(n,s),s+=n.length}t(r)}));r.push(t)}else r.push(a.data());null!=e&&(u.group=e),n.push(u)}return{data:g4(await Promise.all(r)),specs:n}},fromMemory:function(t,e,n,r){const s=arguments;return new y6(g6(...s))},fromMemorySync:g6,getLoadHandlers:k4,getModelArtifactsForJSON:$4,getModelArtifactsInfoForJSON:E4,getSaveHandlers:T4,http:h6,isHTTPScheme:l6,loadWeights:async function(t,e="",n,r){return u6((t=>a6(t,{requestInit:r})))(t,e,n)},registerLoadRouter:t=>_4.registerLoadRouter(t),registerSaveRouter:t=>_4.registerSaveRouter(t),weightsLoaderFactory:u6,withSaveHandler:function(t){return new m6(t)},withSaveHandlerSync:function(t){return new m6(t)},copyModel:async function(t,e){return K4(t,e,!1)},listModels:async function(){const t=q4.getSchemes(),e={};for(const n of t){const t=await q4.getManager(n).listModels();for(const r in t){e[n+"://"+r]=t[r]}}return e},moveModel:async function(t,e){return K4(t,e,!0)},removeModel:async function(t){const e=H4(t);return q4.getManager(e.scheme).removeModel(e.path)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w6=f4({matMul_:function(t,e,n=!1,r=!1){let s=c4(t,"a","matMul"),o=c4(e,"b","matMul");[s,o]=X2(s,o);const i={a:s,b:o},a={transposeA:n,transposeB:r};return s3.runKernel("BatchMatMul",i,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v6=f4({oneHot_:function(t,e,n=1,r=0){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const s={indices:c4(t,"indices","oneHot","int32")},o={depth:e,onValue:n,offValue:r};return s3.runKernel("OneHot",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x6(t,e){return s3.tidy(t,e)}function N6(t){Y2(t).forEach((t=>t.dispose()))}function $6(t){return s3.keep(t)}const E6=f4({imag_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={input:c4(t,"input","imag")};return s3.runKernel("Imag",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S6=f4({neg_:function(t){const e={x:c4(t,"x","neg")};return s3.runKernel("Neg",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _6=f4({real_:function(t){const e={input:c4(t,"input","real")};return s3.runKernel("Real",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T6=f4({transpose_:function(t,e,n){const r=c4(t,"x","transpose");if(null==e&&(e=r.shape.map(((t,e)=>e)).reverse()),S0(r.rank===e.length,(()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`)),e.forEach((t=>{S0(t>=0&&t<r.rank,(()=>"All entries in 'perm' must be between 0 and "+(r.rank-1)+` but got ${e}`))})),r.rank<=1)return r.clone();const s={x:r},o={perm:e};return"complex64"===r.dtype?x6((()=>{let t=_6(r),e=E6(r);return t=s3.runKernel("Transpose",{x:t},o),e=s3.runKernel("Transpose",{x:e},o),n&&(e=S6(e)),h4(t,e)})):s3.runKernel("Transpose",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k6=f4({confusionMatrix_:function(t,e,n){const r=c4(t,"labels","confusionMatrix"),s=c4(e,"predictions","confusionMatrix");S0(null==n||n>0&&Number.isInteger(n),(()=>`If provided, numClasses must be a positive integer, but got ${n}`)),S0(1===r.rank,(()=>`Expected the rank of labels to be 1, but got ${r.rank}`)),S0(1===s.rank,(()=>`Expected the rank of predictions to be 1, but got ${s.rank}`)),S0(r.shape[0]===s.shape[0],(()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${s.shape[0]}. Labels and predictions should have the same number of elements.`)),S0(n>0&&Number.isInteger(n),(()=>`numClasses is required to be a positive integer, but got ${n}`));const o=v6(t6(r,"int32"),n),i=v6(t6(s,"int32"),n),a=T6(o),u=w6(a,i);return t6(u,"int32")}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var A6=Object.freeze({__proto__:null,confusionMatrix:k6});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C6(t,e){const n=t.length,r=[];for(let s=0;s<n;s++){const o=n-1-s,i=t[o]||1;(e[e.length-1-s]||1)>1&&1===i&&r.unshift(o)}return r}function O6(t,e){const n=[];for(let r=0;r<e.length;r++){const s=t[t.length-r-1],o=e.length-r-1,i=e[o];(null==s||1===s&&i>1)&&n.unshift(o)}return n}function I6(t,e){const n=[],r=Math.max(t.length,e.length);for(let s=0;s<r;s++){let r=t[t.length-s-1];null==r&&(r=1);let o=e[e.length-s-1];if(null==o&&(o=1),1===r)n.unshift(o);else if(1===o)n.unshift(r);else{if(r!==o){throw Error(`Operands could not be broadcast together with shapes ${t} and ${e}.`)}n.unshift(r)}}return n}var M6=Object.freeze({__proto__:null,getBroadcastDims:C6,getReductionAxes:O6,assertAndGetBroadcastShape:I6});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R6(t,e,n){if(T0(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");const r=i4(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return p4(t,e,r,n)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let D6;function F6(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,s=!1,o=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)s=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)o=!0;else if(null!=t.getContext)i=!0;else{if(!("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);a=!0}if(s){const e=2;if(s&&t.readyState<e)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=F1("FromPixels",s3.backendName)){const n={pixels:t},r={numChannels:e};return s3.runKernel("FromPixels",n,r)}const[u,c]=s?[t.videoWidth,t.videoHeight]:[t.width,t.height];let l,f;if(i)l=t.getContext("2d").getImageData(0,0,u,c).data;else if(r||n)l=t.data;else if(o||s||a){if(null==D6)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");D6=new OffscreenCanvas(1,1).getContext("2d")}else D6=document.createElement("canvas").getContext("2d");D6.canvas.width=u,D6.canvas.height=c,D6.drawImage(t,0,0,u,c),l=D6.getImageData(0,0,u,c).data}if(4===e)f=new Int32Array(l);else{const t=u*c;f=new Int32Array(t*e);for(let n=0;n<t;n++)for(let t=0;t<e;++t)f[n*e+t]=l[4*n+t]}return R6(f,[c,u,e],"int32")}function L6(t){return"undefined"!=typeof window&&"undefined"!=typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(t instanceof ImageBitmap)&&function(t){return null!=t&&0!==t.width&&0!==t.height}(t)&&!function(t){return null!=t&&t.data instanceof Uint8Array}(t)}const P6=f4({fromPixels_:F6});var B6=Object.freeze({__proto__:null,fromPixelsAsync:async function(t,e=3){let n=null;if(r1().getBool("WRAP_TO_IMAGEBITMAP")&&L6(t)){let e;try{e=await createImageBitmap(t,{premultiplyAlpha:"none"})}catch(t){e=null}n=null!=e&&e.width===t.width&&e.height===t.height?e:t}else n=t;return F6(n,e)},toPixels:async function(t,e){let n=c4(t,"img","toPixels");if(!(t instanceof V2)){const t=n;n=t6(t,"int32"),t.dispose()}if(2!==n.rank&&3!==n.rank)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const[r,s]=n.shape.slice(0,2),o=2===n.rank?1:n.shape[2];if(o>4||2===o)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${o}`);if("float32"!==n.dtype&&"int32"!==n.dtype)throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`);const i=await n.data(),a="float32"===n.dtype?255:1,u=new Uint8ClampedArray(s*r*4);for(let t=0;t<r*s;++t){const e=[0,0,0,255];for(let r=0;r<o;r++){const s=i[t*o+r];if("float32"===n.dtype){if(s<0||s>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${s}.`)}else if("int32"===n.dtype&&(s<0||s>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${s}.`);1===o?(e[0]=s*a,e[1]=s*a,e[2]=s*a):e[r]=s*a}const r=4*t;u[r+0]=Math.round(e[0]),u[r+1]=Math.round(e[1]),u[r+2]=Math.round(e[2]),u[r+3]=Math.round(e[3])}if(null!=e){e.width=s,e.height=r;const t=e.getContext("2d"),n=new ImageData(u,s,r);t.putImageData(n,0,0)}return n!==t&&n.dispose(),u},fromPixels:P6});function V6(t,e){const n=t.shape.length,r=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==e.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${n}`);if(0===A0(t.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const s=e.shape,o=s[s.length-1];let i=1;for(let t=0;t<s.length-1;++t)i*=s[t];const a=t.shape,u=s.slice();u.pop();let c=1;for(let t=o;t<n;++t)c*=a[t],u.push(a[t]);const l=[...K0(t.shape).map((t=>t/c)),1].slice(0,o);return[u,i,c,l]}var z6=Object.freeze({__proto__:null,prepareAndValidate:V6});function W6(t,e,n){const r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${s}.`;if(n.rank<s)throw new Error(o+` update.rank < ${s}. `);if(t.length<r+(n.rank-s))throw new Error(o+` Output shape length < ${r+(n.rank-s)}`);if(n.rank!==s+t.length-r)throw new Error(o+" update.rank != "+(s+t.length-r));for(let t=0;t<s;++t)if(n.shape[t]!==e.shape[t])throw new Error(o+` updates.shape[${t}] (${n.shape[t]}) != indices.shape[${t}] (${e.shape[t]}).`);for(let e=0;e<n.rank-s;++e)if(n.shape[e+s]!==t[e+r])throw new Error(o+` updates.shape[${e+s}] (${n.shape[e+s]}) != shape[${e+s}] (${t[e+s]})`)}function U6(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if("int32"!==e.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===e.size)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(0===t.size)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}W6(n,e,t)}function j6(t,e,n){const r=e.shape.length,s=r>1?e.shape[r-1]:1,o=n.length;let i=1;for(let t=s;t<o;++t)i*=n[t];const a=s<1?1:s;return{sliceRank:s,numUpdates:A0(e.shape)/a,sliceSize:i,strides:[...K0(n.slice(0,s)),1],outputSize:A0(n)}}var G6=Object.freeze({__proto__:null,validateUpdateShape:W6,validateInput:U6,calculateShapes:j6});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q6(t,e,n,r){const s=[...t];for(let t=s.length;t<r.length;t++)s.push(1);for(let t=0;t<n;t++)0===t?s[e]=1:(s.splice(e,0,1),s.pop());return s}function H6(t,e,n){return n<=t?n:n-(e-1)}function K6(t,e){const n=[];for(let r=0;r<t;r++)n.push(e+r);return n}function X6(t,e,n,r,s){const o=[...s],i=K6(n,e);for(let s=0;s<o.length;s++)if(i.indexOf(s)>-1)o[s]=0;else{const i=H6(e,n,s);let a=r[i];t&1<<i&&(a=0),o[s]=a}return o}function J6(t,e,n,r,s){const o=[...s],i=K6(n,e);for(let s=0;s<o.length;s++)if(i.indexOf(s)>-1)o[s]=Number.MAX_SAFE_INTEGER;else{const i=H6(e,n,s);let a=r[i];t&1<<i&&(a=Number.MAX_SAFE_INTEGER),o[s]=a}for(let t=0;t<o.length;t++){const e=s[t];o[t]<0&&(o[t]+=e),o[t]=$0(0,o[t],s[t])}return o}function Y6(t,e,n){let r=t[e];return(n&1<<e||null==r)&&(r=1),r}function Z6(t,e,n,r,s,o){let i=e[s];const a=n[s]||1;(t&1<<s||o&1<<s||null==i)&&(i=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const u=r[s];return i<0&&(i+=u),i=$0(0,i,u-1),i}function Q6(t,e,n,r,s,o){let i=e[s];const a=n[s]||1;(t&1<<s||o&1<<s||null==i)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const u=r[s];return i<0&&(i+=u),i=a>0?$0(0,i,u):$0(-1,i,u-1),i}function t5(t,e,n,r,s,o){if(s[e])return n>0?o[e]:o[e+1&1];{const e=t<0?r+t:t;return e<o[0]?o[0]:e>o[1]?o[1]:e}}var e5=Object.freeze({__proto__:null,assertParamsValid:function(t,e,n){const r=t.shape.length;S0(r===e.length,(()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`)),S0(r===n.length,(()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`));for(let s=0;s<r;++s)S0(e[s]+n[s]<=t.shape[s],(()=>`Error in slice${r}D: begin[${s}] + size[${s}] (${e[s]+n[s]}) would overflow input.shape[${s}] (${t.shape[s]})`))},maskToAxes:function(t){const e=[];let n=0;for(;t>0;)1&t&&e.push(n),t/=2,n++;return e},computeOutShape:function(t,e,n){const r=[];for(let s=0;s<t.length;s++)r[s]=Math.ceil((e[s]-t[s])/n[s]);return r},stridesWithElidedDims:q6,getNormalizedAxes:function(t,e,n,r,s,o,i,a,u){const c=t.length;let l=new Array(c),f=new Array(c),h=new Array(c);if(e.length&&n>0){const u=e[0],c=n+1;l=X6(i,u,c,r,t),f=J6(a,u,c,s,t),h=q6(o,u,c,t)}else for(let e=0;e<c;e++)l[e]=Z6(i,r,o,t,e,u),f[e]=Q6(a,s,o,t,e,u),h[e]=Y6(o,e,u);return{begin:l,end:f,strides:h}},startIndicesWithElidedDims:X6,stopIndicesWithElidedDims:J6,stridesForAxis:Y6,startForAxis:Z6,stopForAxis:Q6,isSliceContinous:function(t,e,n){let r=n.length;for(let t=0;t<n.length;t++)if(n[t]>1){r=t;break}for(let s=r+1;s<n.length;s++)if(e[s]>0||n[s]!==t[s])return!1;return!0},computeFlatOffset:function(t,e){let n=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)n+=t[r]*e[r];return n},parseSliceParams:function(t,e,n){let r;const s=t.shape.length;let o;return r="number"==typeof e?[e,...new Array(s-1).fill(0)]:e.length<s?e.concat(new Array(s-e.length).fill(0)):e.slice(),r.forEach((t=>{S0(-1!==t,(()=>"slice() does not support negative begin indexing."))})),o=null==n?new Array(s).fill(-1):"number"==typeof n?[n,...new Array(s-1).fill(-1)]:n.length<s?n.concat(new Array(s-n.length).fill(-1)):n,o=o.map(((e,n)=>e>=0?e:(S0(-1===e,(()=>`Negative size values should be exactly -1 but got ${e} for the slice() size at index ${n}.`)),t.shape[n]-r[n]))),[r,o]},sliceInfo:function(t,e,n,r,s,o,i,a,u){let c;if(null==r?(c=new Array(e.length),c.fill(1)):c=r,null!=i&&0!=(i&i-1))throw new Error("Multiple ellipses in slice is not allowed.");let l=!1;const f={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};for(let t=0;t<f.dims;t++)l&&0!=(1<<t&a)&&f.numAddAxisAfterEllipsis++,1<<t&i&&(l=!0);l||(f.ellipsisMask|=1<<f.dims,f.dims++);const h={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=null!=t.begin,e.endValid=null!=t.end,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<t.dims;r++)if(1<<r&t.ellipsisMask){const s=Math.min(e.dims-(t.dims-r)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<s;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&t.newAxisMask)e.finalShapeGatherIndices.push(-2),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);null!=t.begin&&(e.begin[n]=t.begin[r]),null!=t.end&&(e.end[n]=t.end[r]),e.strides[n]=t.strides[r],t.beginMask&1<<r&&(e.beginMask|=1<<n),t.endMask&1<<r&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(-1),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[n]=r,n++}}(f,h);let p=!0,d=!0,m=!0;const y=[],g=[];for(let e=0;e<t.length;++e){if(0===h.strides[e])throw Error(`strides[${e}] must be non-zero`);const n=!!(h.shrinkAxisMask&1<<e),r=t[e];if(-1===r){y.push(n?1:-1);continue}const s=[h.beginMask&1<<e,h.endMask&1<<e],o=[h.strides[e]>0?0:-1,h.strides[e]>0?r:r-1];if(n&&h.strides[e]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===h.strides[e];const i=!!(h.beginMask&1<<e&&h.endMask&1<<e);if(h.beginValid&&h.endValid){if(n){const t=h.begin[e]<0?r+h.begin[e]:h.begin[e];if(h.begin[e]=t,h.end[e]=h.begin[e]+1,t<0||t>=r)throw Error(`slice index ${h.begin[e]} of dimension ${e} out of bounds.`)}else h.begin[e]=t5(h.begin[e],0,h.strides[e],r,s,o),h.end[e]=t5(h.end[e],1,h.strides[e],r,s,o);const t=1===h.strides[e]&&0===h.begin[e]&&h.end[e]===r;p=p&&t,d=d&&(0===e&&1===h.strides[e]||t)}else p=p&&1===h.strides[e]&&i,d=d&&(0===e&&1===h.strides[e]||i);let a,u=!1;if(h.beginValid&&h.endValid?(a=h.end[e]-h.begin[e],u=!0):n?(a=1,u=!0):i&&r>=0&&(a=h.strides[e]<0?-r:r,u=!0),u){let t;t=0===a||a<0!=h.strides[e]<0?0:Math.trunc(a/h.strides[e])+(a%h.strides[e]!=0?1:0),y.push(t)}else y.push(-1)}for(let t=0;t<h.finalShapeGatherIndices.length;++t){const e=h.finalShapeGatherIndices[t];e>=0?g.push(y[e]):-2===e&&g.push(1)}const b=g.filter(((t,e)=>-2!==h.finalShapeGatherIndices[e]));return{finalShapeSparse:b,finalShape:g,isIdentity:p,sliceDim0:d,isSimpleSlice:m,begin:h.begin,end:h.end,strides:h.strides}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n5{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}class r5{constructor(){this.classNameMap={}}static getMap(){return null==r5.instance&&(r5.instance=new r5),r5.instance}static register(t){r5.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function s5(t){S0(null!=t.className,(()=>"Class being registered does not have the static className property defined.")),S0("string"==typeof t.className,(()=>"className is required to be a string, but got type "+typeof t.className)),S0(t.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),r5.register(t)}var o5=Object.freeze({__proto__:null,Serializable:n5,SerializationMap:r5,registerClass:s5});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i5(){return 32===s3.backend.floatPrecision()?.001:.1}function a5(t,e,n){let r=!0;if((B0(t)||B0(e))&&(r=!1),B0(t)&&B0(e)&&(r=!0),r){const n=t.constructor.name,r=e.constructor.name;if(n!==r)throw new Error(`Arrays are of different type. Actual: ${n}. Expected: ${r}`)}if(Array.isArray(t)&&Array.isArray(e)){const n=i4(t),r=i4(e);if(!C0(n,r))throw new Error(`Arrays have different shapes. Actual: [${n}]. Expected: [${r}]`)}const s=B0(t)?t:k0(t),o=B0(e)?e:k0(e);if(s.length!==o.length)throw new Error(`Arrays have different lengths actual: ${s.length} vs expected: ${o.length}.\nActual:   ${s}.\nExpected: ${o}.`);for(let t=0;t<o.length;++t){const e=s[t],r=o[t];if(!n(e,r))throw new Error(`Arrays differ: actual[${t}] = ${e}, expected[${t}] = ${r}.\nActual:   ${s}.\nExpected: ${o}.`)}}function u5(t,e,n){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}var c5=Object.freeze({__proto__:null,TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(t,e,n){return null==n&&(n=i5()),a5(t,e,((t,e)=>u5(t,e,n)))},testEpsilon:i5,expectPromiseToFail:function(t,e){t().then((()=>e.fail()),(()=>e()))},expectArraysEqual:function(t,e){const n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return W0(t)||W0(t[0])||W0(e)||W0(e[0])?a5(t,n,((t,e)=>t==e)):a5(t,e,((t,e)=>u5(t,e,0)))},expectNumbersClose:function(t,e,n){if(null==n&&(n=i5()),!u5(t,e,n))throw new Error(`Numbers differ: actual === ${t}, expected === ${e}`)},expectValuesInRange:function(t,e,n){for(let r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error(`Value out of range:${t[r]} low: ${e}, high: ${n}`)},expectArrayBuffersEqual:function(t,e){const n=new Float32Array(t),r=new Float32Array(e);if(n.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${n.length}`);for(let t=0;t<r.length;t++)if(n[t]!==r[t])throw new Error(`Expected ArrayBuffer value at ${t} to be ${r[t]} but got ${n[t]} instead`)},encodeStrings:function t(e){for(let n=0;n<e.length;n++){const r=e[n];Array.isArray(r)?t(r):e[n]=_2(r)}return e}});
/** @license See the LICENSE file. */const l5=f4({add_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=c4(t,"a","add"),r=c4(e,"b","add");[n,r]=X2(n,r);const s={a:n,b:r};return s3.runKernel("Add",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f5=f4({floorDiv_:function(t,e){let n=c4(t,"a","floorDiv"),r=c4(e,"b","floorDiv");[n,r]=X2(n,r);const s={a:n,b:r};return s3.runKernel("FloorDiv",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h5=f4({div_:function(t,e){let n=c4(t,"a","div"),r=c4(e,"b","div");if([n,r]=X2(n,r),"int32"===n.dtype&&"int32"===r.dtype)return f5(n,r);const s={a:n,b:r};return s3.runKernel("RealDiv",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p5=f4({mul_:function(t,e){let n=c4(t,"a","mul"),r=c4(e,"b","mul");[n,r]=X2(n,r);const s={a:n,b:r};return s3.runKernel("Multiply",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d5=f4({abs_:function(t){const e=c4(t,"x","abs");if("complex64"===e.dtype){const t={x:e};return s3.runKernel("ComplexAbs",t)}{const t={x:e};return s3.runKernel("Abs",t)}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m5=f4({acos_:function(t){const e={x:c4(t,"x","acos")};return s3.runKernel("Acos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y5=f4({acosh_:function(t){const e={x:c4(t,"x","acosh")};return s3.runKernel("Acosh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g5=f4({addN_:function(t){S0(Array.isArray(t),(()=>"The argument passed to tf.addN() must be a list of tensors")),S0(t.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`));const e=t.map(((t,e)=>c4(t,`tensors${e}`,"addN"))),n=e[0];e.forEach((t=>{if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((t=>{if(!C0(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const r=e;return s3.runKernel("AddN",r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b5=f4({all_:function(t,e=null,n=!1){const r={x:c4(t,"x","all","bool")},s={axis:e,keepDims:n};return s3.runKernel("All",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w5=f4({any_:function(t,e=null,n=!1){const r={x:c4(t,"x","any","bool")},s={axis:e,keepDims:n};return s3.runKernel("Any",r,s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v5=f4({argMax_:function(t,e=0){const n={x:c4(t,"x","argMax")},r={axis:e};return s3.runKernel("ArgMax",n,r)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x5=f4({argMin_:function(t,e=0){const n={x:c4(t,"x","argMin")},r={axis:e};return s3.runKernel("ArgMin",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N5=f4({asin_:function(t){const e={x:c4(t,"x","asin")};return s3.runKernel("Asin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $5=f4({asinh_:function(t){const e={x:c4(t,"x","asinh")};return s3.runKernel("Asinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E5=f4({atan_:function(t){const e={x:c4(t,"x","atan")};return s3.runKernel("Atan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S5=f4({atan2_:function(t,e){let n=c4(t,"a","atan2"),r=c4(e,"b","atan2");[n,r]=X2(n,r);const s={a:n,b:r};return s3.runKernel("Atan2",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _5=f4({atanh_:function(t){const e={x:c4(t,"x","atanh")};return s3.runKernel("Atanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T5(t,e,n,r,s,o,i="channelsLast"){const[a,u]=O5(e);let c;if("channelsLast"===i)c=[a,u,t[3],t[3]];else{if("channelsFirst"!==i)throw new Error(`Unknown dataFormat ${i}`);c=[a,u,t[1],t[1]]}return k5(t,c,n,r,s,o,!1,i)}function k5(t,e,n,r,s,o,i=!1,a="channelsLast"){let[u,c,l,f]=[-1,-1,-1,-1];if("channelsLast"===a)[u,c,l,f]=t;else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);[u,f,c,l]=t}const[h,p,,d]=e,[m,y]=O5(n),[g,b]=O5(r),w=M5(h,g),v=M5(p,b),{padInfo:x,outHeight:N,outWidth:$}=function(t,e,n,r,s,o,i,a,u){let c,l,f;if("number"==typeof t){c={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};const s=function(t,e,n,r,s){null==r&&(r=C5(t,e,n));const o=t[0],i=t[1],a=R5((o-e+2*r)/n+1,s),u=R5((i-e+2*r)/n+1,s);return[a,u]}([e,n],o,r,t,a);l=s[0],f=s[1]}else if("same"===t){l=Math.ceil(e/r),f=Math.ceil(n/s);const t=Math.max(0,(l-1)*r+o-e),a=Math.max(0,(f-1)*s+i-n),u=Math.floor(t/2),h=t-u,p=Math.floor(a/2);c={top:u,bottom:h,left:p,right:a-p,type:"SAME"}}else if("valid"===t)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-o+1)/r),f=Math.ceil((n-i+1)/s);else{if("object"!=typeof t)throw Error(`Unknown padding parameter: ${t}`);{const h="channelsLast"===u?t[1][0]:t[2][0],p="channelsLast"===u?t[1][1]:t[2][1],d="channelsLast"===u?t[2][0]:t[3][0],m="channelsLast"===u?t[2][1]:t[3][1];c={top:h,bottom:p,left:d,right:m,type:0===h&&0===p&&0===d&&0===m?"VALID":"EXPLICIT"},l=R5((e-o+h+p)/r+1,a),f=R5((n-i+d+m)/s+1,a)}}return{padInfo:c,outHeight:l,outWidth:f}}(s,c,l,m,y,w,v,o,a),E=i?d*f:d;let S;return"channelsFirst"===a?S=[u,E,N,$]:"channelsLast"===a&&(S=[u,N,$,E]),{batchSize:u,dataFormat:a,inHeight:c,inWidth:l,inChannels:f,outHeight:N,outWidth:$,outChannels:E,padInfo:x,strideHeight:m,strideWidth:y,filterHeight:h,filterWidth:p,effectiveFilterHeight:w,effectiveFilterWidth:v,dilationHeight:g,dilationWidth:b,inShape:t,outShape:S,filterShape:e}}function A5(t,e,n,r,s,o=!1,i="channelsLast",a){let[u,c,l,f,h]=[-1,-1,-1,-1,-1];if("channelsLast"===i)[u,c,l,f,h]=t;else{if("channelsFirst"!==i)throw new Error(`Unknown dataFormat ${i}`);[u,h,c,l,f]=t}const[p,d,m,,y]=e,[g,b,w]=I5(n),[v,x,N]=I5(r),$=M5(p,v),E=M5(d,x),S=M5(m,N),{padInfo:_,outDepth:T,outHeight:k,outWidth:A}=function(t,e,n,r,s,o,i,a,u,c,l){let f,h,p,d;if("number"==typeof t){f={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};const o=function(t,e,n,r,s,o){null==s&&(s=C5(t,e,r));const i=t[0],a=t[1],u=t[2],c=R5((i-e+2*s)/r+1,o),l=R5((a-e+2*s)/r+1,o),f=R5((u-e+2*s)/r+1,o);return[c,l,f,n]}([e,n,r,1],a,1,s,t,l);h=o[0],p=o[1],d=o[2]}else if("same"===t){h=Math.ceil(e/s),p=Math.ceil(n/o),d=Math.ceil(r/i);const t=(h-1)*s+a-e,l=(p-1)*o+u-n,m=(d-1)*i+c-r,y=Math.floor(t/2),g=t-y,b=Math.floor(l/2),w=l-b,v=Math.floor(m/2);f={top:b,bottom:w,left:v,right:m-v,front:y,back:g,type:"SAME"}}else{if("valid"!==t)throw Error(`Unknown padding parameter: ${t}`);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((e-a+1)/s),p=Math.ceil((n-u+1)/o),d=Math.ceil((r-c+1)/i)}return{padInfo:f,outDepth:h,outHeight:p,outWidth:d}}(s,c,l,f,g,b,w,$,E,S,a),C=o?y*h:y;let O;return"channelsFirst"===i?O=[u,C,T,k,A]:"channelsLast"===i&&(O=[u,T,k,A,C]),{batchSize:u,dataFormat:i,inDepth:c,inHeight:l,inWidth:f,inChannels:h,outDepth:T,outHeight:k,outWidth:A,outChannels:C,padInfo:_,strideDepth:g,strideHeight:b,strideWidth:w,filterDepth:p,filterHeight:d,filterWidth:m,effectiveFilterDepth:$,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationDepth:v,dilationHeight:x,dilationWidth:N,inShape:t,outShape:O,filterShape:e}}function C5(t,e,n,r=1){const s=M5(e,r);return Math.floor((t[0]*(n-1)-n+s)/2)}function O5(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function I5(t){return"number"==typeof t?[t,t,t]:t}function M5(t,e){return e<=1?t:t+(t-1)*(e-1)}function R5(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function D5(t){const[e,n,r]=O5(t);return 1===e&&1===n&&1===r}function F5(t,e){return D5(t)||D5(e)}function L5(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function P5(t,e,n){if(null!=n){if("string"==typeof e)throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if("number"==typeof e)S0(O0(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`));else{if("object"!=typeof e)throw Error(`Error in ${t}: Unknown padding parameter: ${e}`);e.forEach((e=>{e.forEach((e=>{S0(O0(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`))}))}))}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B5=f4({reshape_:function(t,e){const n={x:c4(t,"x","reshape","string_or_numeric")},r={shape:e};return s3.runKernel("Reshape",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V5=f4({avgPool_:function(t,e,n,r,s){const o=c4(t,"x","avgPool","float32");S0(F5(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let i=o,a=!1;3===o.rank&&(a=!0,i=B5(o,[1,o.shape[0],o.shape[1],o.shape[2]])),S0(4===i.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${i.rank}.`)),P5("avgPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s};let l=s3.runKernel("AvgPool",u,c);return l=t6(l,o.dtype),a?B5(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z5=f4({avgPool3d_:function(t,e,n,r,s,o="NDHWC"){const i=c4(t,"x","avgPool3d","float32");let a=i,u=!1;4===i.rank&&(u=!0,a=B5(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),S0(5===a.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`)),S0("NDHWC"===o,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),P5("avgPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o};let f=s3.runKernel("AvgPool3D",c,l);return f=t6(f,a.dtype),u?B5(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W5=f4({concat_:function(t,e=0){S0(t.length>=1,(()=>"Pass at least one tensor to concat"));const n=l4(t,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((t=>{if("complex64"!==t.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${t.dtype}. `)})),1===n.length)return e6(n[0]);const r=n,s={axis:e};return s3.runKernel("Concat",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U5=f4({sigmoid_:function(t){const e={x:c4(t,"x","sigmoid","float32")};return s3.runKernel("Sigmoid",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j5=f4({slice_:function(t,e,n){const r=c4(t,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const s={x:r},o={begin:e,size:n};return s3.runKernel("Slice",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G5=f4({tanh_:function(t){const e={x:c4(t,"x","tanh","float32")};return s3.runKernel("Tanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q5=f4({basicLSTMCell_:function(t,e,n,r,s,o){const i=c4(t,"forgetBias","basicLSTMCell"),a=c4(e,"lstmKernel","basicLSTMCell"),u=c4(n,"lstmBias","basicLSTMCell"),c=c4(r,"data","basicLSTMCell"),l=c4(s,"c","basicLSTMCell"),f=c4(o,"h","basicLSTMCell"),h=W5([c,f],1),p=w6(h,a),d=l5(p,u),m=d.shape[0],y=d.shape[1]/4,g=[m,y],b=j5(d,[0,0],g),w=j5(d,[0,y],g),v=j5(d,[0,2*y],g),x=j5(d,[0,3*y],g),N=l5(p5(U5(b),G5(w)),p5(l,U5(l5(i,v))));return[N,p5(G5(N),U5(x))]}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H5=f4({batchToSpaceND_:function(t,e,n){const r=c4(t,"x","batchToSpaceND"),s=e.reduce(((t,e)=>t*e));S0(r.rank>=1+e.length,(()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`)),S0(n.length===e.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`)),S0(r.shape[0]%s==0,(()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${s}`));const o={x:r},i={blockShape:e,crops:n};return s3.runKernel("BatchToSpaceND",o,i)}});const K5=f4({batchNorm_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s,o){null==o&&(o=.001);const i=c4(t,"x","batchNorm"),a=c4(e,"mean","batchNorm"),u=c4(n,"variance","batchNorm");let c,l;null!=s&&(c=c4(s,"scale","batchNorm")),null!=r&&(l=c4(r,"offset","batchNorm")),S0(a.rank===u.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),S0(null==l||a.rank===l.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),S0(null==c||a.rank===c.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const f=function(t){let e;return e=0===t.rank||1===t.rank?B5(t,[1,1,1,t.size]):2===t.rank?B5(t,[1,1,t.shape[0],t.shape[1]]):3===t.rank?B5(t,[1,t.shape[0],t.shape[1],t.shape[2]]):t,e}(i),h={x:f,scale:c,offset:l,mean:a,variance:u},p={varianceEpsilon:o},d=s3.runKernel("FusedBatchNorm",h,p);return B5(d,i.shape)}});const X5=f4({batchNorm2d_:function(t,e,n,r,s,o){const i=c4(t,"x","batchNorm"),a=c4(e,"mean","batchNorm"),u=c4(n,"variance","batchNorm");let c,l;return null!=s&&(c=c4(s,"scale","batchNorm")),null!=r&&(l=c4(r,"offset","batchNorm")),S0(2===i.rank,(()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`)),S0(2===a.rank||1===a.rank,(()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`)),S0(2===u.rank||1===u.rank,(()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`)),null!=c&&S0(2===c.rank||1===c.rank,(()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`)),null!=l&&S0(2===l.rank||1===l.rank,(()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${l.rank}.`)),K5(i,a,u,l,c,o)}});const J5=f4({batchNorm3d_:function(t,e,n,r,s,o){const i=c4(t,"x","batchNorm"),a=c4(e,"mean","batchNorm"),u=c4(n,"variance","batchNorm");let c,l;return null!=s&&(c=c4(s,"scale","batchNorm")),null!=r&&(l=c4(r,"offset","batchNorm")),S0(3===i.rank,(()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`)),S0(3===a.rank||1===a.rank,(()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`)),S0(3===u.rank||1===u.rank,(()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`)),null!=c&&S0(3===c.rank||1===c.rank,(()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`)),null!=l&&S0(3===l.rank||1===l.rank,(()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${l.rank}.`)),K5(i,a,u,l,c,o)}});const Y5=f4({batchNorm4d_:function(t,e,n,r,s,o){const i=c4(t,"x","batchNorm"),a=c4(e,"mean","batchNorm"),u=c4(n,"variance","batchNorm");let c,l;return null!=s&&(c=c4(s,"scale","batchNorm")),null!=r&&(l=c4(r,"offset","batchNorm")),S0(4===i.rank,(()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`)),S0(4===a.rank||1===a.rank,(()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`)),S0(4===u.rank||1===u.rank,(()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`)),null!=c&&S0(4===c.rank||1===c.rank,(()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`)),null!=l&&S0(4===l.rank||1===l.rank,(()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${l.rank}.`)),K5(i,a,u,l,c,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z5=f4({bincount_:function(t,e,n){const r=c4(t,"x","bincount"),s=c4(e,"weights","bincount");S0("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),S0(n>=0,(()=>`size must be non-negative, but got ${n}.`)),S0(s.size===r.size||0===s.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${s.shape}.`));const o={x:r,weights:s},i={size:n};return s3.runKernel("Bincount",o,i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q5=f4({broadcastArgs_:function(t,e){const n=c4(t,"s0","broadcastArgs","int32"),r=c4(e,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(1!==r.rank)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const s={s0:n,s1:r};return s3.runKernel("BroadcastArgs",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t8=f4({broadcastTo_:function(t,e){let n=c4(t,"broadcastTo","x");const r=n.shape;if(e.some((t=>!(t>0)||t%1!=0)))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const t=n.shape.slice();for(;t.length<e.length;)t.unshift(1);n=B5(n,t)}const s=n.shape,o=Array.from(e);for(let t=e.length-1;t>=0;t--)if(s[t]===e[t])o[t]=1;else if(1!==n.shape[t])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);const i=o.map(((t,e)=>t>1?e:-1)).filter((t=>t>=0));if(0===i.length)return e6(n);const a={x:n},u={reps:o};return s3.runKernel("Tile",a,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e8=f4({ceil_:function(t){const e={x:c4(t,"x","ceil","float32")};return s3.runKernel("Ceil",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n8=f4({clipByValue_:function(t,e,n){const r=c4(t,"x","clipByValue");S0(e<=n,(()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`));const s={x:r},o={clipValueMin:e,clipValueMax:n};return s3.runKernel("ClipByValue",s,o)}});const r8=f4({concat1d_:function(t){return W5(t,0)}});const s8=f4({concat2d_:function(t,e){return W5(t,e)}});const o8=f4({concat3d_:function(t,e){return W5(t,e)}});const i8=f4({concat4d_:function(t,e){return W5(t,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a8=f4({conv2d_:function(t,e,n,r,s="NHWC",o=[1,1],i){const a=c4(t,"x","conv2d","float32"),u=c4(e,"filter","conv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=B5(a,[1,a.shape[0],a.shape[1],a.shape[2]])),S0(4===c.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`)),S0(4===u.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`)),P5("conv2d",r,i);const f="NHWC"===s?c.shape[3]:c.shape[1];S0(f===u.shape[2],(()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`)),S0(F5(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const h={x:c,filter:u},p={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},d=s3.runKernel("Conv2D",h,p);return l?B5(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});const u8=f4({conv1d_:function(t,e,n,r,s="NWC",o=1,i){const a=c4(t,"x","conv1d"),u=c4(e,"filter","conv1d");let c=a,l=!1;2===a.rank&&(l=!0,c=B5(a,[1,a.shape[0],a.shape[1]])),S0(3===c.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`)),S0(3===u.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`)),P5("conv1d",r,i),S0(c.shape[2]===u.shape[1],(()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`)),S0(F5(n,o),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${o}'`)),S0("NWC"===s,(()=>`Error in conv1d: got dataFormat of ${s} but only NWC is currently supported.`));const f=B5(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=B5(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=a8(h,f,[1,n],r,"NHWC",[1,o],i);return B5(p,l?[p.shape[2],p.shape[3]]:[p.shape[0],p.shape[2],p.shape[3]])}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c8=f4({conv2DBackpropInput_:function(t,e,n,r,s,o="NHWC",i){S0(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let a=t,u=e,c=!1;3===e.rank&&(c=!0,u=B5(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),S0(4===a.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`)),S0(4===u.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`)),S0(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const l="NHWC"===o?a[3]:a[1],f="NHWC"===o?u.shape[3]:u.shape[1];S0(l===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[2]}.`)),S0(f===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${n.shape[3]}.`)),P5("conv2dDerInput",s,i);const h={dy:u,filter:n},p={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,inputShape:a},d=s3.runKernel("Conv2DBackpropInput",h,p);return c?B5(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});const l8=f4({conv2dTranspose_:function(t,e,n,r,s,o){const i=c4(t,"x","conv2dTranspose"),a=c4(e,"filter","conv2dTranspose");return c8(n,i,a,r,s,"NHWC",o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f8=f4({conv3d_:function(t,e,n,r,s="NDHWC",o=[1,1,1]){const i=c4(t,"x","conv3d"),a=c4(e,"filter","conv3d");let u=i,c=!1;4===i.rank&&(c=!0,u=B5(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),S0(5===u.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`)),S0(5===a.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`)),S0(u.shape[4]===a.shape[3],(()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${a.shape[3]}.`)),S0(F5(n,o),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),S0("NDHWC"===s,(()=>`Error in conv3d: got dataFormat of ${s} but only NDHWC is currently supported.`));const l={x:u,filter:a},f={strides:n,pad:r,dataFormat:s,dilations:o},h=s3.runKernel("Conv3D",l,f);return c?B5(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h8=f4({conv3DBackpropInput_:function(t,e,n,r,s){S0(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let o=t,i=e,a=!1;4===e.rank&&(a=!0,i=B5(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,t[0],t[1],t[2],t[3]]);const u=o[4],c=i.shape[4];S0(5===o.length,(()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`)),S0(5===i.rank,(()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`)),S0(5===n.rank,(()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`)),S0(u===n.shape[3],(()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[3]}.`)),S0(c===n.shape[4],(()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`));const l={dy:i,filter:n},f={pad:s,strides:r,inputShape:o},h=s3.runKernel("Conv3DBackpropInputV2",l,f);return a?B5(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});const p8=f4({conv3dTranspose_:function(t,e,n,r,s){const o=c4(t,"x","conv3dTranspose"),i=c4(e,"filter","conv3dTranspose");return h8(n,o,i,r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d8=f4({cos_:function(t){const e={x:c4(t,"x","cos","float32")};return s3.runKernel("Cos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m8=f4({cosh_:function(t){const e={x:c4(t,"x","cosh","float32")};return s3.runKernel("Cosh",e)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y8=f4({cumprod_:function(t,e=0,n=!1,r=!1){const s={x:c4(t,"x","cumprod")},o={axis:e,exclusive:n,reverse:r};return s3.runKernel("Cumprod",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g8=f4({cumsum_:function(t,e=0,n=!1,r=!1){const s={x:c4(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:r};return s3.runKernel("Cumsum",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b8=f4({denseBincount_:function(t,e,n,r=!1){const s=c4(t,"x","denseBincount"),o=c4(e,"weights","denseBincount");S0("int32"===s.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${s.dtype}`)),S0(s.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${s.rank}.`)),S0(n>=0,(()=>`size must be non-negative, but got ${n}.`)),S0(o.size===s.size||0===o.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${s.shape}, weights shape: ${o.shape}.`));const i={x:s,weights:o},a={size:n,binaryOutput:r};return s3.runKernel("DenseBincount",i,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w8=f4({depthToSpace_:function(t,e,n="NHWC"){const r=c4(t,"x","depthToSpace","float32"),s="NHWC"===n?r.shape[1]:r.shape[2],o="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];S0(e>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`)),S0(s*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${s} and ${e}  for depthToSpace with input shape\n    ${r.shape}`)),S0(o*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${o} and ${e} for depthToSpace with input shape\n        ${r.shape}`)),S0(i%(e*e)==0,(()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${r.shape}`));const a={x:r},u={blockSize:e,dataFormat:n};return s3.runKernel("DepthToSpace",a,u)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v8=f4({depthwiseConv2d_:function(t,e,n,r,s="NHWC",o=[1,1],i){const a=c4(t,"x","depthwiseConv2d","float32"),u=c4(e,"filter","depthwiseConv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=B5(a,[1,a.shape[0],a.shape[1],a.shape[2]])),S0(4===c.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`)),S0(4===u.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`)),S0(c.shape[3]===u.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`)),P5("depthwiseConv2d",r,i);const f={x:c,filter:u},h={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},p=s3.runKernel("DepthwiseConv2dNative",f,h);return l?B5(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x8=f4({diag_:function(t){const e={x:c4(t,"x","diag")};return s3.runKernel("Diag",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N8=f4({dilation2d_:function(t,e,n,r,s=[1,1],o="NHWC"){const i=c4(t,"x","dilation2d"),a=c4(e,"filter","dilation2d");S0(3===i.rank||4===i.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`)),S0(3===a.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`)),S0("NHWC"===o,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`));let u=i,c=!1;3===i.rank&&(u=B5(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=!0);const l={x:u,filter:a},f={strides:n,pad:r,dilations:s},h=s3.runKernel("Dilation2D",l,f);return c?B5(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $8=f4({equal_:function(t,e){let n=c4(t,"a","equal","string_or_numeric"),r=c4(e,"b","equal","string_or_numeric");[n,r]=X2(n,r),I6(n.shape,r.shape);const s={a:n,b:r};return s3.runKernel("Equal",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E8=f4({where_:function(t,e,n){const r=c4(e,"a","where"),s=c4(n,"b","where"),o=c4(t,"condition","where","bool"),i=I6(I6(o.shape,r.shape),s.shape),a={condition:t8(o,i),t:t8(r,i),e:t8(s,i)};return s3.runKernel("Select",a)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S8=f4({zerosLike_:function(t){const e={x:c4(t,"x","zerosLike")};return s3.runKernel("ZerosLike",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _8=f4({divNoNan_:function(t,e){let n=c4(t,"a","div"),r=c4(e,"b","div");[n,r]=X2(n,r);const s=h5(n,r),o=S8(s),i=$8(r,o);return E8(i,o,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T8=f4({dot_:function(t,e){const n=c4(t,"t1","dot"),r=c4(e,"t2","dot");S0(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`));const s=1===n.rank?n.size:n.shape[1],o=1===r.rank?r.size:r.shape[0];if(S0(s===o,(()=>`Error in dot: inner dimensions of inputs must match, but got ${s} and ${o}.`)),1===n.rank&&1===r.rank){const t=B5(n,[1,-1]),e=B5(r,[-1,1]),s=w6(t,e);return B5(s,[])}if(1===n.rank&&2===r.rank){const t=B5(n,[1,-1]),e=B5(r,[r.shape[0],r.shape[1]]),s=w6(t,e);return B5(s,[s.size])}if(2===n.rank&&1===r.rank){const t=B5(r,[-1,1]),e=w6(n,t);return B5(e,[e.size])}{const t=B5(r,[r.shape[0],r.shape[1]]);return w6(n,t)}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k8=f4({einsum_:function(t,...e){const n=e.map(((t,e)=>c4(t,`tensors${e}`,"einsum"))),r={equation:t};return s3.runKernel("Einsum",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A8=f4({elu_:function(t){const e={x:c4(t,"x","elu","float32")};return s3.runKernel("Elu",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C8=f4({erf_:function(t){let e=c4(t,"x","erf");S0("int32"===e.dtype||"float32"===e.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===e.dtype&&(e=t6(e,"float32"));const n={x:e};return s3.runKernel("Erf",n)}});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O8(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function I8(t,e,n){const r=t.length+e.length,s=[];let o=0,i=0;for(let a=0;a<r;a++)-1===n.indexOf(a)?s.push(t[o++]):s.push(e[i++]);return s}function M8(t,e){return I8(t,e.map((t=>1)),e)}const R8=f4({max_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=null,n=!1){const r={x:c4(t,"x","max")},s={reductionIndices:e,keepDims:n};return s3.runKernel("Max",r,s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D8=f4({min_:function(t,e=null,n=!1){const r={x:c4(t,"x","min")},s={axis:e,keepDims:n};return s3.runKernel("Min",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F8=f4({pow_:function(t,e){let n=c4(t,"base","pow"),r=c4(e,"exp","pow");[n,r]=X2(n,r);const s={a:n,b:r};return s3.runKernel("Pow",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L8(t,e){if((B0(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&B0(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return p4(t,[],[],e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P8=f4({sqrt_:function(t){const e={x:c4(t,"x","sqrt","float32")};return s3.runKernel("Sqrt",e)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B8=f4({square_:function(t){const e=c4(t,"x","square");return s3.runKernel("Square",{x:e},{})}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V8=f4({sum_:function(t,e=null,n=!1){let r=c4(t,"x","sum");"bool"===r.dtype&&(r=t6(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return s3.runKernel("Sum",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z8(t,e,n=null){if(0===t.rank)return d5(t);if(1!==t.rank&&null===n)return z8(B5(t,[-1]),e,n);if(1===t.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===e)return V8(d5(t),n);if(e===1/0)return R8(d5(t),n);if(e===-1/0)return D8(d5(t),n);if("euclidean"===e||2===e)return P8(V8(F8(d5(t),L8(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&2===n.length){if(1===e)return R8(V8(d5(t),n[0]),n[1]-1);if(e===1/0)return R8(V8(d5(t),n[1]),n[0]);if(e===-1/0)return D8(V8(d5(t),n[1]),n[0]);if("fro"===e||"euclidean"===e)return P8(V8(B8(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const W8=f4({norm_:function(t,e="euclidean",n=null,r=!1){const s=z8(t=c4(t,"x","norm"),e,n);let o=s.shape;if(r){const e=M0(n,t.shape);o=M8(s.shape,e)}return B5(s,o)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U8=f4({euclideanNorm_:function(t,e=null,n=!1){return W8(t,"euclidean",e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j8=f4({exp_:function(t){const e={x:c4(t,"x","exp")};return s3.runKernel("Exp",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G8=f4({expandDims_:function(t,e=0){const n=c4(t,"x","expandDims","string_or_numeric");S0(e<=n.rank,(()=>"Axis must be <= rank of the tensor"));const r={input:n},s={dim:e};return s3.runKernel("ExpandDims",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q8=f4({expm1_:function(t){const e={x:c4(t,"x","expm1")};return s3.runKernel("Expm1",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H8=f4({tile_:function(t,e){const n=c4(t,"x","tile","string_or_numeric");S0(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`));const r={x:n},s={reps:e};return s3.runKernel("Tile",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K8=f4({eye_:function(t,e,n,r="float32"){null==e&&(e=t);const s=Q4([t,e],r),o=t<=e?t:e;for(let t=0;t<o;++t)s.set(1,t,t);const i=B5(s.toTensor(),[t,e]);if(null==n)return i;if(1===n.length)return H8(G8(i,0),[n[0],1,1]);if(2===n.length)return H8(G8(G8(i,0),0),[n[0],n[1],1,1]);if(3===n.length)return H8(G8(G8(G8(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X8(t,e,n){const r={shape:t,value:e,dtype:n};return s3.runKernel("Fill",{},r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J8=f4({floor_:function(t){const e={x:c4(t,"x","floor","float32")};return s3.runKernel("Floor",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y8=f4({gather_:function(t,e,n=0,r=0){const s={x:c4(t,"x","gather"),indices:c4(e,"indices","gather","int32")},o={axis:n,batchDims:r};return s3.runKernel("GatherV2",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z8=f4({greater_:function(t,e){let n=c4(t,"a","greater","string_or_numeric"),r=c4(e,"b","greater","string_or_numeric");[n,r]=X2(n,r),I6(n.shape,r.shape);const s={a:n,b:r};return s3.runKernel("Greater",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q8=f4({greaterEqual_:function(t,e){let n=c4(t,"a","greaterEqual","string_or_numeric"),r=c4(e,"b","greaterEqual","string_or_numeric");[n,r]=X2(n,r),I6(n.shape,r.shape);const s={a:n,b:r};return s3.runKernel("GreaterEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t9=f4({isFinite_:function(t){const e={x:c4(t,"x","isFinite")};return s3.runKernel("IsFinite",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e9=f4({isInf_:function(t){const e={x:c4(t,"x","isInf")};return s3.runKernel("IsInf",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n9=f4({isNaN_:function(t){const e={x:c4(t,"x","isNaN")};return s3.runKernel("IsNan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r9=f4({leakyRelu_:function(t,e=.2){const n={x:c4(t,"x","leakyRelu")},r={alpha:e};return s3.runKernel("LeakyRelu",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s9=f4({less_:function(t,e){let n=c4(t,"a","less","string_or_numeric"),r=c4(e,"b","less","string_or_numeric");[n,r]=X2(n,r),I6(n.shape,r.shape);const s={a:n,b:r};return s3.runKernel("Less",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o9=f4({lessEqual_:function(t,e){let n=c4(t,"a","lessEqual","string_or_numeric"),r=c4(e,"b","lessEqual","string_or_numeric");[n,r]=X2(n,r),I6(n.shape,r.shape);const s={a:n,b:r};return s3.runKernel("LessEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i9(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:t,stop:e,num:n};return s3.runKernel("LinSpace",{},r)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a9=f4({localResponseNormalization_:function(t,e=5,n=1,r=1,s=.5){const o=c4(t,"x","localResponseNormalization");S0(4===o.rank||3===o.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${o.rank}.`)),S0(O0(e),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`));let i=o,a=!1;3===o.rank&&(a=!0,i=B5(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const u={x:i},c={depthRadius:e,bias:n,alpha:r,beta:s},l=s3.runKernel("LRN",u,c);return a?B5(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u9=f4({log_:function(t){const e={x:c4(t,"x","log","float32")};return s3.runKernel("Log",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c9=f4({log1p_:function(t){const e={x:c4(t,"x","log1p")};return s3.runKernel("Log1p",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l9(t,e){S0(q0(t),(()=>"The f passed in variableGrads(f) must be a function")),S0(null==e||Array.isArray(e)&&e.every((t=>t instanceof z2)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=e;if(!n){e=[];for(const t in s3.registeredVariables)e.push(s3.registeredVariables[t])}const r=n?e.filter((t=>!t.trainable)):null,s=e.length;e=e.filter((t=>t.trainable)),S0(e.length>0,(()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${s} variables is trainable.`));const{value:o,grads:i}=s3.gradients(t,e,null,!0);S0(i.some((t=>null!=t)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),S0(0===o.rank,(()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`));const a={};return e.forEach(((t,e)=>{null!=i[e]&&(a[t.name]=i[e])})),null!=r&&r.forEach((t=>a[t.name]=null)),{value:o,grads:a}}function f9(t){return s3.customGrad(t)}function h9(t){const e=t.filter((t=>null==t)).length;if(e>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p9=f4({softplus_:function(t){const e={x:c4(t,"x","softplus")};return s3.runKernel("Softplus",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d9=f4({logSigmoid_:function(t){const e=c4(t,"x","logSigmoid"),n=f9((t=>({value:S6(p9(S6(t))),gradFunc:e=>p5(e,U5(S6(t)))})));return n(e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m9=f4({sub_:function(t,e){let n=c4(t,"a","sub"),r=c4(e,"b","sub");[n,r]=X2(n,r);const s={a:n,b:r};return s3.runKernel("Sub",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y9=f4({logSoftmax_:function(t,e=-1){const n=c4(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);const r=f9(((t,n)=>{const r=R8(t,e,!0),s=m9(t,r),o=m9(t6(s,"float32"),u9(V8(j8(s),e,!0)));n([o]);return{value:o,gradFunc:(t,n)=>{const[r]=n,s=j8(r);return m9(t,p5(V8(t,e,!0),s))}}}));return r(n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g9=f4({logSumExp_:function(t,e=null,n=!1){const r=c4(t,"x","logSumExp"),s=M0(e,r.shape),o=R8(r,s,!0),i=m9(r,o),a=j8(i),u=V8(a,s),c=u9(u),l=l5(B5(o,c.shape),c);if(n){const t=M8(l.shape,s);return B5(l,t)}return l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b9=f4({logicalAnd_:function(t,e){const n=c4(t,"a","logicalAnd","bool"),r=c4(e,"b","logicalAnd","bool");I6(n.shape,r.shape);const s={a:n,b:r};return s3.runKernel("LogicalAnd",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w9=f4({logicalNot_:function(t){const e={x:c4(t,"x","logicalNot","bool")};return s3.runKernel("LogicalNot",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v9=f4({logicalOr_:function(t,e){const n=c4(t,"a","logicalOr","bool"),r=c4(e,"b","logicalOr","bool");I6(n.shape,r.shape);const s={a:n,b:r};return s3.runKernel("LogicalOr",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x9=f4({logicalXor_:function(t,e){const n=c4(t,"a","logicalXor","bool"),r=c4(e,"b","logicalXor","bool");return I6(n.shape,r.shape),b9(v9(t,e),w9(b9(t,e)))}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N9=f4({searchSorted_:function(t,e,n="left"){const r=c4(t,"sortedSequence","searchSorted"),s=c4(e,"values","searchSorted"),o=r.shape[r.shape.length-1],i=s.shape[s.shape.length-1],a=B5(r,[-1,o]),u=B5(s,[-1,i]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(A0(u.shape)>=2147483648)throw new Error("values tensor size must less than 2147483648");if(a.shape[1]>=2147483648)throw new Error(`trailing dim_size must less than 2147483648 for int32 output type, was ${a.shape[1]}`);const c={sortedSequence:a,values:u},l={side:n};return s3.runKernel("SearchSorted",c,l)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $9(t,e){return N9(t,e,"left")}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E9=f4({maxPool_:function(t,e,n,r,s){const o=c4(t,"x","maxPool");let i=o,a=!1;3===o.rank&&(a=!0,i=B5(o,[1,o.shape[0],o.shape[1],o.shape[2]])),S0(4===i.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${i.rank}.`)),S0(F5(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),P5("maxPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s},l=s3.runKernel("MaxPool",u,c);return a?B5(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S9=f4({maxPool3d_:function(t,e=[1,1,1],n,r,s,o="NDHWC"){const i=c4(t,"x","maxPool3d");let a=i,u=!1;4===i.rank&&(u=!0,a=B5(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),S0(5===a.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`)),S0("NDHWC"===o,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),P5("maxPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o},f=s3.runKernel("MaxPool3D",c,l);return u?B5(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _9=f4({maxPoolWithArgmax_:function(t,e,n,r,s=!1){const o={x:c4(t,"x","maxPoolWithArgmax")},i={filterSize:e,strides:n,pad:r,includeBatchInIndex:s},a=s3.runKernel("MaxPoolWithArgmax",o,i);return{result:a[0],indexes:a[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T9=f4({maximum_:function(t,e){let n=c4(t,"a","maximum"),r=c4(e,"b","maximum");[n,r]=X2(n,r),"bool"===n.dtype&&(n=t6(n,"int32"),r=t6(r,"int32")),I6(n.shape,r.shape);const s={a:n,b:r};return s3.runKernel("Maximum",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k9=f4({mean_:function(t,e=null,n=!1){const r={x:c4(t,"x","mean")},s={axis:e,keepDims:n};return s3.runKernel("Mean",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A9(t,e="float32"){if("complex64"===e){const e=A9(t,"float32"),n=A9(t,"float32");return h4(e,n)}const n=Z0(A0(t),e);return s3.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C9(t,e="float32"){if("complex64"===e){const e=C9(t,"float32"),n=A9(t,"float32");return h4(e,n)}const n=Y0(A0(t),e);return s3.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O9=f4({minimum_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=c4(t,"a","minimum"),r=c4(e,"b","minimum");[n,r]=X2(n,r),"bool"===n.dtype&&(n=t6(n,"int32"),r=t6(r,"int32")),I6(n.shape,r.shape);const s={a:n,b:r};return s3.runKernel("Minimum",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I9=f4({mirrorPad_:function(t,e,n){S0("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const r=c4(t,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");S0(e.length===r.rank,(()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`));const s="reflect"===n?1:0;for(let t=0;t<r.rank;t++)S0(2===e[t].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),S0(e[t][0]>=0&&e[t][0]<=r.shape[t]-s&&e[t][1]>=0&&e[t][1]<=r.shape[t]-s,(()=>`Padding in dimension ${t} cannot be greater than or equal to ${r.shape[t]-s} or less than 0 for input of shape ${r.shape}`));const o={paddings:e,mode:n},i={x:r};return s3.runKernel("MirrorPad",i,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M9=f4({mod_:function(t,e){let n=c4(t,"a","mod"),r=c4(e,"b","mod");[n,r]=X2(n,r);const s={a:n,b:r};return s3.runKernel("Mod",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R9=f4({moments_:function(t,e=null,n=!1){const r=M0(e,(t=c4(t,"x","moments")).shape),s=k9(t,r,n);let o=s.shape;n||(o=M8(s.shape,r));const i=B8(m9(t6(t,"float32"),B5(s,o)));return{mean:s,variance:k9(i,r,n)}}});const D9=f4({multiRNNCell_:function(t,e,n,r){const s=c4(e,"data","multiRNNCell"),o=l4(n,"c","multiRNNCell"),i=l4(r,"h","multiRNNCell");let a=s;const u=[];for(let e=0;e<t.length;e++){const n=t[e](a,o[e],i[e]);u.push(n[0]),u.push(n[1]),a=n[1]}const c=[],l=[];for(let t=0;t<u.length;t+=2)c.push(u[t]),l.push(u[t+1]);return[c,l]}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F9=f4({multinomial_:function(t,e,n,r=!1){const s=c4(t,"logits","multinomial"),o=s.size,i=s.rank;if(o<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${o}.`);if(i>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${i}`);n=n||Math.random();const a={logits:1===i?B5(s,[1,-1]):s},u={numSamples:e,seed:n,normalized:r},c=s3.runKernel("Multinomial",a,u);return 1===i?B5(c,[c.size]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L9=f4({notEqual_:function(t,e){let n=c4(t,"a","notEqual","string_or_numeric"),r=c4(e,"b","notEqual","string_or_numeric");[n,r]=X2(n,r),I6(n.shape,r.shape);const s={a:n,b:r};return s3.runKernel("NotEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P9=f4({onesLike_:function(t){const e={x:c4(t,"x","onesLike")};return s3.runKernel("OnesLike",e)}});const B9=f4({outerProduct_:function(t,e){const n=c4(t,"v1","outerProduct"),r=c4(e,"v2","outerProduct");S0(1===n.rank&&1===r.rank,(()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`));const s=B5(n,[-1,1]),o=B5(r,[1,-1]);return w6(s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V9=f4({pad_:function(t,e,n=0){const r=c4(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:n},o={x:r};return s3.runKernel("PadV2",o,s)}});const z9=f4({pad1d_:function(t,e,n=0){return S0(2===e.length,(()=>"Invalid number of paddings. Must be length of 2.")),V9(t,[e],n)}});const W9=f4({pad2d_:function(t,e,n=0){return S0(2===e.length&&2===e[0].length&&2===e[1].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),V9(t,e,n)}});const U9=f4({pad3d_:function(t,e,n=0){return S0(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),V9(t,e,n)}});const j9=f4({pad4d_:function(t,e,n=0){return S0(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),V9(t,e,n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G9=f4({spaceToBatchND_:function(t,e,n){const r=c4(t,"x","spaceToBatchND");S0(r.rank>=1+e.length,(()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`)),S0(n.length===e.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`)),S0(r.shape.reduce(((t,r,s)=>s>0&&s<=e.length?t&&(r+n[s-1][0]+n[s-1][1])%e[s-1]==0:t),!0),(()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`));const s={x:r},o={blockShape:e,paddings:n};return s3.runKernel("SpaceToBatchND",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q9=f4({pool_:function(t,e,n,r,s,o,i){null==s&&(s=[1,1]),null==o&&(o=1),0===r&&(r="valid");const a=c4(t,"x","maxPool");let u=a,c=!1;3===a.rank&&(c=!0,u=B5(a,[1,a.shape[0],a.shape[1],a.shape[2]])),S0(F5(o,s),(()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${s}'`));const l=T5(u.shape,e,o,s,r),f=[l.dilationHeight,l.dilationWidth];let h;h="same"===r?function(t,e){const n=t.map(((t,n)=>t+(t-1)*(e[n]-1))),r=n.map((t=>t-1)),s=r.map((t=>Math.floor(t/2))),o=r.map(((t,e)=>t-s[e]));return r.map(((t,e)=>[s[e],o[e]]))}([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];const p=1===f[0]&&1===f[1],[d,m]=function(t,e,n){const r=n.map((t=>t[0])),s=n.map((t=>t[1])),o=t.concat(r,s),i=e.map(((t,e)=>(t-o[e]%t)%t)),a=s.map(((t,e)=>t+i[e])),u=e.map(((t,e)=>[r[e],a[e]])),c=e.map(((t,e)=>[0,i[e]]));return[u,c]}([l.inHeight,l.inWidth],f,h),y=p?r:"valid",g=p?u:G9(u,f,d),b=("avg"===n?()=>V5(g,e,o,y,i):()=>E9(g,e,o,y,i))(),w=p?b:H5(b,f,m);return c?B5(w,[w.shape[1],w.shape[2],w.shape[3]]):w}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H9=f4({prelu_:function(t,e){const n={x:c4(t,"x","prelu"),alpha:c4(e,"alpha","prelu")};return s3.runKernel("Prelu",n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K9=f4({prod_:function(t,e=null,n=!1){let r=c4(t,"x","prod");"bool"===r.dtype&&(r=t6(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return s3.runKernel("Prod",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X9=f4({rand_:function(t,e,n){const r=A0(t);let s=null;if(null==n||"float32"===n)s=new Float32Array(r);else if("int32"===n)s=new Int32Array(r);else{if("bool"!==n)throw new Error(`Unknown data type ${n}`);s=new Uint8Array(r)}for(let t=0;t<r;t++)s[t]=e();return s3.makeTensor(s,t,n)}});var J9={exports:{}};!function(t,e,n){function r(t){var e=this,n=function(){var t=4022871197,e=function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)};return e}();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}function s(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var n=new r(t),o=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.alea=o}(0,J9,!1);var Y9={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor128=o}(0,Y9,!1);var Z9={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorwow=o}(0,Z9,!1);var Q9={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,s=e.i;return t=r[s],n=(t^=t>>>7)^t<<24,n^=(t=r[s+1&7])^t>>>10,n^=(t=r[s+3&7])^t>>>3,n^=(t=r[s+4&7])^t<<7,t=r[s+7&7],n^=(t^=t<<13)^t<<9,r[s]=n,e.i=s+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function s(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.x&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorshift7=o}(0,Q9,!1);var t7={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,s=e.X,o=e.i;return e.w=r=r+1640531527|0,n=s[o+34&127],t=s[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=s[o]=n^t,e.i=o,n+(r^r>>>16)|0},function(t,e){var n,r,s,o,i,a=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),s=0,o=-32;o<u;++o)e&&(r^=e.charCodeAt((o+32)%e.length)),0===o&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(i=i+1640531527|0,s=0==(n=a[127&o]^=r+i)?s+1:0);for(s>=128&&(a[127&(e&&e.length||0)]=-1),s=127,o=512;o>0;--o)r=a[s+34&127],n=a[s=s+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,a[s]=r^n;t.w=i,t.X=a,t.i=s}(e,t)}function s(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.X&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor4096=o}(0,t7,!1);var e7={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,s=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^s,s=s-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^s,e.a=s-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.tychei=o}(0,e7,!1);var n7={exports:{}};!function(t){!function(e,n){var r,s=this,o=256,i=n.pow(o,6),a=n.pow(2,52),u=2*a,c=255;function l(t,c,l){var y=[],g=d(p((c=1==c?{entropy:!0}:c||{}).entropy?[t,m(e)]:null==t?function(){try{var t;return r&&(t=r.randomBytes)?t=t(o):(t=new Uint8Array(o),(s.crypto||s.msCrypto).getRandomValues(t)),m(t)}catch(t){var n=s.navigator,i=n&&n.plugins;return[+new Date,s,i,s.screen,m(e)]}}():t,3),y),b=new f(y),w=function(){for(var t=b.g(6),e=i,n=0;t<a;)t=(t+n)*o,e*=o,n=b.g(1);for(;t>=u;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,d(m(b.S),e),(c.pass||l||function(t,e,r,s){return s&&(s.S&&h(s,b),t.state=function(){return h(b,{})}),r?(n.random=t,e):t})(w,g,"global"in c?c.global:this==n,c.state)}function f(t){var e,n=t.length,r=this,s=0,i=r.i=r.j=0,a=r.S=[];for(n||(t=[n++]);s<o;)a[s]=s++;for(s=0;s<o;s++)a[s]=a[i=c&i+t[s%n]+(e=a[s])],a[i]=e;(r.g=function(t){for(var e,n=0,s=r.i,i=r.j,a=r.S;t--;)e=a[s=c&s+1],n=n*o+a[c&(a[s]=a[i=c&i+e])+(a[i]=e)];return r.i=s,r.j=i,n})(o)}function h(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function p(t,e){var n,r=[],s=typeof t;if(e&&"object"==s)for(n in t)try{r.push(p(t[n],e-1))}catch(t){}return r.length?r:"string"==s?t:t+"\0"}function d(t,e){for(var n,r=t+"",s=0;s<r.length;)e[c&s]=c&(n^=19*e[c&s])+r.charCodeAt(s++);return m(e)}function m(t){return String.fromCharCode.apply(0,t)}if(n.seedrandom=l,d(n.random(),e),t.exports){t.exports=l;try{r=require("crypto")}catch(t){}}}([],Math)}(n7);var r7=J9.exports,s7=Y9.exports,o7=Z9.exports,i7=Q9.exports,a7=t7.exports,u7=e7.exports,c7=n7.exports;c7.alea=r7,c7.xor128=s7,c7.xorwow=o7,c7.xorshift7=i7,c7.xor4096=a7,c7.tychei=u7;var l7=c7;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f7{constructor(t,e,n,r,s){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const o=s||Math.random();this.random=l7.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const t=this.nextVal;return this.nextVal=NaN,t}let t,e,n=!1;for(;!n;){let r,s,o;do{r=2*this.random()-1,s=2*this.random()-1,o=r*r+s*s}while(o>=1||0===o);const i=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*r*i,e=this.mean+this.stdDev*s*i,this.truncated&&!this.isValidTruncated(t)||(n=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class h7{constructor(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;const s=r||Math.random();this.randu=l7.alea(s.toString()),this.randn=new f7(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,e,n,r,s,o;for(;;){do{r=this.randn.nextValue(),o=1+this.c*r}while(o<=0);if(o*=o*o,t=r*r,e=1-.331*t*t,n=.5*t+this.d*(1-o+Math.log(o)),s=this.randu(),s<e||Math.log(s)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(t){return"float32"===this.dtype?t:Math.round(t)}}class p7{constructor(t=0,e=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=l7.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d7=f4({randomGamma_:function(t,e,n=1,r="float32",s){if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error(`Unsupported data type ${r}`);const o=new h7(e,n,r,s),i=Q4(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m7=f4({randomNormal_:function(t,e=0,n=1,r,s){if(null!=r&&"bool"===r)throw new Error(`Unsupported data type ${r}`);const o=new f7(e,n,r,!1,s),i=Q4(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y7=f4({randomUniform_:function(t,e=0,n=1,r="float32",s){const o=Q4(t,r),i=new p7(e,n,null,s);for(let t=0;t<o.values.length;t++)o.values[t]=i.nextValue();return o.toTensor()}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g7(t,e,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");const s={start:t,stop:e,step:n,dtype:r};return s3.runKernel("Range",{},s)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b7=f4({reciprocal_:function(t){const e={x:c4(t,"x","reciprocal")};return s3.runKernel("Reciprocal",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w7=f4({relu_:function(t){const e={x:c4(t,"x","relu")};return s3.runKernel("Relu",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v7=f4({relu6_:function(t){const e={x:c4(t,"x","relu6")};return s3.runKernel("Relu6",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x7=f4({reverse_:function(t,e){const n={x:c4(t,"x","reverse")},r={dims:e};return s3.runKernel("Reverse",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N7=f4({reverse1d_:function(t){const e=c4(t,"x","reverse");return S0(1===e.rank,(()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`)),x7(e,0)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $7=f4({reverse2d_:function(t,e){const n=c4(t,"x","reverse");return S0(2===n.rank,(()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`)),x7(n,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E7=f4({reverse3d_:function(t,e){const n=c4(t,"x","reverse");return S0(3===n.rank,(()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`)),x7(n,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S7=f4({reverse4d_:function(t,e){const n=c4(t,"x","reverse");return S0(4===n.rank,(()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`)),x7(n,e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _7=f4({round_:function(t){const e={x:c4(t,"x","round")};return s3.runKernel("Round",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T7=f4({rsqrt_:function(t){const e={x:c4(t,"x","rsqrt","float32")};return s3.runKernel("Rsqrt",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k7=f4({selu_:function(t){const e={x:c4(t,"x","selu")};return s3.runKernel("Selu",e)}});const A7=f4({separableConv2d_:function(t,e,n,r,s,o=[1,1],i="NHWC"){const a=c4(t,"x","separableConv2d"),u=c4(e,"depthwiseFilter","separableConv2d"),c=c4(n,"pointwiseFilter","separableConv2d");let l=a,f=!1;if(3===a.rank&&(f=!0,l=B5(a,[1,a.shape[0],a.shape[1],a.shape[2]])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");S0(4===l.rank,(()=>`Error in separableConv2d: input must be rank 4, but got rank ${l.rank}.`)),S0(4===u.rank,(()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`)),S0(4===c.rank,(()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`)),S0(1===c.shape[0],(()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`)),S0(1===c.shape[1],(()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`));const h=u.shape[2],p=u.shape[3];S0(c.shape[2]===h*p,(()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*p}, but got ${c.shape[2]}.`));const d=v8(l,u,r,s,i,o),m=a8(d,c,1,"valid",i);return f?B5(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C7=async function(t,e){const n=c4(t,"x","setdiff1d"),r=c4(e,"y","setdiff1d");S0(n.dtype===r.dtype,(()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`)),S0(1===n.rank,(()=>`x should be 1D tensor, but got x (${n.shape}).`)),S0(1===r.rank,(()=>`y should be 1D tensor, but got y (${r.shape}).`));const s=await n.data(),o=await r.data(),i=new Set(o);let a=0;for(let t=0;t<s.length;t++)i.has(s[t])||a++;const u=new L2([a],n.dtype),c=new L2([a],"int32");for(let t=0,e=0;t<s.length;t++)i.has(s[t])||(u.values[e]=s[t],c.values[e]=t,e++);return[u.toTensor(),c.toTensor()]};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O7=f4({sign_:function(t){const e={x:c4(t,"x","sign")};return s3.runKernel("Sign",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I7=f4({sin_:function(t){const e={x:c4(t,"x","sin","float32")};return s3.runKernel("Sin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M7=f4({sinh_:function(t){const e={x:c4(t,"x","sinh")};return s3.runKernel("Sinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R7=f4({slice1d_:function(t,e,n){const r=c4(t,"x","slice1d");return S0(1===r.rank,(()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`)),j5(r,[e],[n])}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D7=f4({slice2d_:function(t,e,n){const r=c4(t,"x","slice2d");return S0(2===r.rank,(()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`)),j5(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F7=f4({slice3d_:function(t,e,n){const r=c4(t,"x","slice3d");return S0(3===r.rank,(()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`)),j5(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L7=f4({slice4d_:function(t,e,n){const r=c4(t,"x","slice4d");return S0(4===r.rank,(()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`)),j5(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P7=f4({softmax_:function(t,e=-1){const n=c4(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const r={logits:n},s={dim:e};return s3.runKernel("Softmax",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B7=f4({fft_:function(t){S0("complex64"===t.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`));const e={input:t};return s3.runKernel("FFT",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V7=f4({ifft_:function(t){S0("complex64"===t.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`));const e={input:t};return s3.runKernel("IFFT",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z7=f4({irfft_:function(t){const e=t.shape[t.shape.length-1],n=t.size/e;let r;if(e<=2){const s=B5(t,[n,e]);r=V7(s)}else{const s=[n,2*(e-1)],o=B5(_6(t),[n,e]),i=B5(E6(t),[n,e]),a=x7(j5(o,[0,1],[n,e-2]),1),u=p5(x7(j5(i,[0,1],[n,e-2]),1),L8(-1)),c=W5([o,a],1),l=W5([i,u],1),f=B5(h4(c,l),[s[0],s[1]]);r=V7(f)}if(r=_6(r),3===t.rank&&0!==t.shape[0]){const e=r,n=t.shape[0];r=B5(r,[n,r.shape[0]/n,r.shape[1]]),e.dispose()}return r}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W7=f4({split_:function(t,e,n=0){const r={x:c4(t,"x","split")},s={numOrSizeSplits:e,axis:n};return s3.runKernel("SplitV",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U7=f4({rfft_:function(t,e){S0("float32"===t.dtype,(()=>`The dtype for rfft() must be real value but got ${t.dtype}`));let n=t.shape[t.shape.length-1];const r=t.size/n;let s;if(null!=e&&e<n){const r=t.shape.map((t=>0)),o=t.shape.map((t=>t));o[t.shape.length-1]=e,s=j5(t,r,o),n=e}else if(null!=e&&e>n){const r=t.shape.map((t=>t));r[t.shape.length-1]=e-n,s=W5([t,A9(r)],t.shape.length-1),n=e}else s=t;const o=S8(s),i=B5(h4(s,o),[r,n]),a=B7(i),u=Math.floor(n/2)+1,c=_6(a),l=E6(a),f=W7(c,[u,n-u],c.shape.length-1),h=W7(l,[u,n-u],l.shape.length-1),p=s.shape.slice();return p[s.shape.length-1]=u,B5(h4(f[0],h[0]),p)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j7=f4({squaredDifference_:function(t,e){let n=c4(t,"a","squaredDifference"),r=c4(e,"b","squaredDifference");[n,r]=X2(n,r),I6(n.shape,r.shape);const s={a:n,b:r};return s3.runKernel("SquaredDifference",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G7=f4({squeeze_:function(t,e){const n=c4(t,"x","squeeze");return B5(n,R0(n.shape,e).newShape)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q7=f4({stack_:function(t,e=0){const n=l4(t,"tensors","stack","string_or_numeric");S0(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&S0(e<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const r=n,s={axis:e};return s3.runKernel("Pack",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H7=f4({step_:function(t,e=0){const n={x:c4(t,"x","step")},r={alpha:e};return s3.runKernel("Step",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K7=f4({stridedSlice_:function(t,e,n,r,s=0,o=0,i=0,a=0,u=0){const c={x:c4(t,"x","stridedSlice","string_or_numeric")},l={begin:e,end:n,strides:r,beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};return s3.runKernel("StridedSlice",c,l)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X7=f4({tan_:function(t){const e={x:c4(t,"x","tan","float32")};return s3.runKernel("Tan",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J7(t,e){T0(t);const n=i4(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return p4(t,null,n,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y7(t,e,n){if(T0(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");const r=i4(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return p4(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z7=f4({topk_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=1,n=!0){const r=c4(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const s=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const o={x:r},i={k:e,sorted:n},[a,u]=s3.runKernel("TopK",o,i);return{values:a,indices:u}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q7=f4({truncatedNormal_:function(t,e=0,n=1,r,s){if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const o=new f7(e,n,r,!0,s),i=Q4(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ttt=f4({unique_:function(t,e=0){const n=c4(t,"x","unique","string_or_numeric");S0(n.rank>0,(()=>"The input tensor must be at least 1D"));const r={x:n},s={axis:e},[o,i]=s3.runKernel("Unique",r,s);return{values:o,indices:i}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ett=f4({unsortedSegmentSum_:function(t,e,n){const r=c4(t,"x","unsortedSegmentSum"),s=c4(e,"segmentIds","unsortedSegmentSum","int32");S0(O0(n),(()=>"numSegments must be of dtype int"));const o={x:r,segmentIds:s},i={numSegments:n};return s3.runKernel("UnsortedSegmentSum",o,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ntt=f4({unstack_:function(t,e=0){const n=c4(t,"x","unstack","string_or_numeric");S0(e>=-n.shape.length&&e<n.shape.length,(()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`));const r={value:n},s={axis:e};return s3.runKernel("Unpack",r,s)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rtt(t,e){return N9(t,e,"right")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function stt(t,e){const n=[];for(let t=0;t<e.length;t++)e[t]&&n.push(t);const r=Q4(t,"int32"),s=Q4([n.length,t.length],"int32");for(let e=0;e<n.length;e++){const o=r.indexToLoc(n[e]),i=e*t.length;s.values.set(o,i)}return s.toTensor()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ott=async function(t){const e=c4(t,"condition","whereAsync","bool"),n=await e.data(),r=stt(e.shape,n);return t!==e&&e.dispose(),r};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const itt=async function(t,e,n){const r=c4(t,"tensor","boolMask"),s=c4(e,"mask","boolMask","bool"),o=null==n?0:n,i=s.rank,a=r.shape;S0(i>0,(()=>"mask cannot be scalar")),_0(a.slice(o,o+i),s.shape,"mask's shape must match the first K dimensions of tensor's shape,");let u=1;for(let t=o;t<o+i;t++)u*=a[t];const c=a.slice(0,o).concat([u],a.slice(o+i)),l=B5(r,c),f=B5(s,[-1]),h=await ott(f),p=G7(h,[1]),d=Y8(l,p,o);return t!==r&&r.dispose(),e!==s&&s.dispose(),p.dispose(),l.dispose(),f.dispose(),h.dispose(),d};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const att=f4({movingAverage_:function(t,e,n,r,s=!0){const o=c4(t,"v","movingAverage"),i=c4(e,"x","movingAverage"),a=c4(n,"decay","movingAverage");J2(o,i),S0(C0(o.shape,i.shape),(()=>"Shape mismatch in v and x"));const u=L8(1),c=m9(u,a);let l=p5(m9(i,o),c);if(s){S0(null!=r,(()=>"When using zeroDebias: true, step is required."));const t=c4(r,"step","movingAverage");l=h5(l,m9(u,F8(a,t)))}return l5(o,l)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const utt=f4({scatterND_:function(t,e,n){const r=c4(t,"indices","scatterND","int32"),s=c4(e,"updates","scatterND");U6(s,r,n);const o={indices:r,updates:s},i={shape:n};return s3.runKernel("ScatterNd",o,i)}});const ctt=f4({sparseToDense_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=0){const s=c4(t,"sparseIndices","sparseToDense","int32"),o=c4(e,"sparseValues","sparseToDense","string_or_numeric"),i=c4(r,"defaultValue","sparseToDense",o.dtype);!function(t,e,n,r){if("int32"!==t.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const s=t.rank>0?t.shape[0]:1,o=t.rank>1?t.shape[1]:1;if(n.length!==o)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${o}.`);const i=e.size;if(0!==e.rank&&(1!==e.rank||i!==s))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${s}]`);if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(s,o,n,i);const a={sparseIndices:s,sparseValues:o,defaultValue:i},u={outputShape:n};return s3.runKernel("SparseToDense",a,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ltt=f4({gatherND_:function(t,e){const n=c4(e,"indices","gatherND","int32"),r={params:c4(t,"x","gatherND","string_or_numeric"),indices:n};return s3.runKernel("GatherNd",r)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ftt=f4({dropout_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const s=c4(t,"x","dropout");if(S0("float32"===s.dtype,(()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${s.dtype} tensor instead.`)),S0(e>=0&&e<1,(()=>`rate must be a float in the range [0, 1), but got ${e}.`)),0===e)return t instanceof V2?s.clone():s;const o=function(t,e){if(null==e)return t.shape.slice();if(C0(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let r=0;r<t.shape.length;r++)null==e[r]&&null!=t.shape[r]?n.push(t.shape[r]):n.push(e[r]);return n}return e}(s,n),i=1-e,a=h5(J8(l5(y7(o,0,1,"float32",r),i)),i);return p5(s,a)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function htt(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function ptt(t,e,n){const r=1-t%2,s=new Float32Array(t);for(let o=0;o<t;++o){const i=2*Math.PI*o/(t+r-1);s[o]=e-n*Math.cos(i)}return J7(s,"float32")}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dtt=async function(t,e,n=1){const r=c4(t,"predictions","inTopK"),s=c4(e,"targets","inTopK");S0(r.rank>1,(()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`)),S0(r.rank-1===s.rank,(()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${s.rank}`)),_0(r.shape.slice(0,r.shape.length-1),s.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const o=r.shape[r.shape.length-1];S0(n>0&&n<=o,(()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${o}), but got ${n}`));const i=await r.data(),a=await s.data(),[u,c]=[i.length/o,o],l=D0("bool",u);for(let t=0;t<u;t++){const e=t*c,r=i.subarray(e,e+c),s=[];for(let t=0;t<r.length;t++)s.push({value:r[t],index:t});s.sort(((t,e)=>e.value-t.value)),l[t]=0;for(let e=0;e<n;e++)if(s[e].index===a[t]){l[t]=1;break}}return t!==r&&r.dispose(),e!==s&&s.dispose(),d4(l,s.shape,"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mtt=f4({conv2DBackpropFilter_:function(t,e,n,r,s,o="NHWC",i){let a=t;3===t.rank&&(a=B5(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=B5(e,[1,e.shape[0],e.shape[1],e.shape[2]])),S0(4===a.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`)),S0(4===u.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`)),S0(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const c="NHWC"===o?a.shape[3]:a.shape[1],l="NHWC"===o?u.shape[3]:u.shape[1];S0(c===n[2],(()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`)),S0(l===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${l}) must match output depth for filter (${n[3]}).`)),P5("conv2dDerFilter",s,i);const f={x:a,dy:u},h={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,filterShape:n};return s3.runKernel("Conv2DBackpropFilter",f,h)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ytt(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return p5(t,H7(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function gtt(t,e){let n=e;const r=O6(t.shape,e.shape);return r.length>0&&(n=V8(n,r)),B5(n,t.shape)}function btt(t,e,n,r){if("linear"===e)return t;if("relu"===e)return w7(t);if("elu"===e)return A8(t);if("relu6"===e)return v7(t);if("prelu"===e)return H9(t,n);if("leakyrelu"===e)return r9(t,r);if("sigmoid"===e)return U5(t);throw new Error(`Unknown fused activation ${e}.`)}const wtt=(t,e)=>!(t>0)||"linear"===e;
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vtt=f4({fusedConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(u=u||"linear",!1===wtt(s3.state.gradientDepth,u)){S0("NHWC"===s,(()=>`Error in fused conv2d: got dataFormat of ${s} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`));let f=a8(t,e,n,r,s,o,i);return null!=a&&(f=l5(f,a)),btt(f,u,c,l)}const f=c4(t,"x","conv2d","float32"),h=c4(e,"filter","conv2d","float32");let p=f,d=!1;3===f.rank&&(d=!0,p=B5(f,[1,f.shape[0],f.shape[1],f.shape[2]])),S0(4===p.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`)),S0(4===h.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`)),P5("fused conv2d",r,i);const m="NHWC"===s?p.shape[3]:p.shape[1];S0(h.shape[2]===m,(()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${h.shape[2]}.`)),S0(F5(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const y=k5(p.shape,h.shape,n,o,r,i);let g,b;if(null!=a&&(g=c4(a,"bias","fused conv2d"),[g]=X2(g,f),"NHWC"===s?I6(y.outShape,g.shape):(S0(g.shape.length<=1,(()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${g.shape.length}.`)),S0(0===g.shape.length||g.shape[0]===y.outChannels||1===g.shape[0],(()=>`Error in fused conv2d: bias shape (${g.shape}) is not compatible with the number of output channels (${y.outChannels})`)))),null!=c){const t=c.shape;if(S0(t.length<=1||3===t.length,(()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${t.length}.`)),1===t.length)S0(1===t[0]||t[0]===y.outChannels,(()=>`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the number of output channels (${y.outChannels}).`));else if(3===t.length)try{I6(t,y.outShape)}catch(e){const n=`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the output shape of the conv2d (${y.outShape}).`;throw Error(n)}b=c4(c,"prelu weights","fused conv2d")}const w=(t,e)=>{S0("NHWC"===s,(()=>`Error in gradient of fused conv2D: got dataFormat of ${s} but only NHWC is currently supported.`));const[i,a,c,l]=e,f=ytt(t,c,u);S0(D5(o),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`));const h=[c8(a.shape,f,i,n,r),mtt(a,f,i.shape,n,r)];if(null!=l){const t=gtt(l,f);h.push(t)}return h},v={x:p,filter:h,bias:g,preluActivationWeights:b},x={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=f9(((t,e,n)=>{let r=s3.runKernel("FusedConv2D",v,x);return n([e,t,r]),d&&(r=B5(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:w}}));return t(p,h)}{const t=f9(((t,e,n,r)=>{let s=s3.runKernel("FusedConv2D",v,x);return r([e,t,s,n]),d&&(s=B5(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:w}}));return t(p,h,g)}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xtt=f4({depthwiseConv2dNativeBackpropFilter_:function(t,e,n,r,s,o=[1,1],i){let a=t;3===t.rank&&(a=B5(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=B5(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:u},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,filterShape:n};return s3.runKernel("DepthwiseConv2dNativeBackpropFilter",c,l)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ntt=f4({depthwiseConv2dNativeBackpropInput_:function(t,e,n,r,s,o=[1,1],i){let a=e,u=!1;3===e.rank&&(u=!0,a=B5(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,inputShape:t},f=s3.runKernel("DepthwiseConv2dNativeBackpropInput",c,l);return u?B5(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $tt=f4({fusedDepthwiseConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(!1===wtt(s3.state.gradientDepth,u)){let f=v8(t,e,n,r,s,o,i);return null!=a&&(f=l5(f,a)),btt(f,u,c,l)}const f=c4(t,"x","depthwiseConv2d","float32"),h=c4(e,"filter","depthwiseConv2d","float32");let p=f,d=!1;3===f.rank&&(d=!0,p=B5(f,[1,f.shape[0],f.shape[1],f.shape[2]])),S0(4===p.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`)),S0(4===h.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`)),S0(p.shape[3]===h.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${p.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`)),null==o&&(o=[1,1]),S0(F5(n,o),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),P5("fused depthwiseConv2d",r,i);const m=k5(p.shape,h.shape,n,o,r,i,!0);let y,g;null!=a&&(y=c4(a,"bias","fused conv2d"),[y]=X2(y,f),I6(m.outShape,y.shape)),null!=c&&(g=c4(c,"prelu weights","fused depthwiseConv2d"));const b=(t,e)=>{S0(D5(o),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`));const[s,a,c,l]=e,f=ytt(t,c,u),h=Ntt(a.shape,f,s,n,r,o,i),p=xtt(a,f,s.shape,n,r,o,i);if(null!=l){return[h,p,gtt(y,f)]}return[h,p]},w={x:p,filter:h,bias:y,preluActivationWeights:g},v={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=f9(((t,e,n)=>{let r=s3.runKernel("FusedDepthwiseConv2D",w,v);return n([e,t,r]),d&&(r=B5(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}}));return t(p,h)}{const t=f9(((t,e,n,r)=>{let s=s3.runKernel("FusedDepthwiseConv2D",w,v);return r([e,t,s,n]),d&&(s=B5(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:b}}));return t(p,h,y)}}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ett=f4({fusedMatMul_:function({a:t,b:e,transposeA:n=!1,transposeB:r=!1,bias:s,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a}){if(!1===wtt(s3.state.gradientDepth,o)){let u=w6(t,e,n,r);return null!=s&&(u=l5(u,s)),btt(u,o,i,a)}let u=c4(t,"a","fused matMul"),c=c4(e,"b","fused matMul");[u,c]=X2(u,c);const l=n?u.shape[u.rank-2]:u.shape[u.rank-1],f=r?c.shape[c.rank-1]:c.shape[c.rank-2],h=n?u.shape[u.rank-1]:u.shape[u.rank-2],p=r?c.shape[c.rank-2]:c.shape[c.rank-1],d=u.shape.slice(0,-2),m=c.shape.slice(0,-2),y=A0(d),g=A0(m);S0(l===f,(()=>`Error in fused matMul: inner shapes (${l}) and (${f}) of Tensors with shapes ${u.shape} and ${c.shape} and transposeA=${n} and transposeB=${r} must match.`));const b=I6(u.shape.slice(0,-2),c.shape.slice(0,-2)).concat([h,p]),w=B5(u,n?[y,l,h]:[y,h,l]),v=B5(c,r?[g,p,f]:[g,f,p]);let x,N;null!=s&&(x=c4(s,"bias","fused matMul"),[x]=X2(x,u),I6(b,x.shape)),null!=i&&(N=c4(i,"prelu weights","fused matMul"));const $=(t,e)=>{const[i,a,u,c]=e,l=ytt(B5(t,u.shape),u,o);let f,h;if(n||r?!n&&r?(f=w6(l,a,!1,!1),h=w6(l,i,!0,!1)):n&&!r?(f=w6(a,l,!1,!0),h=w6(i,l,!1,!1)):(f=w6(a,l,!0,!0),h=w6(l,i,!0,!0)):(f=w6(l,a,!1,!0),h=w6(i,l,!0,!1)),null!=s){return[f,h,gtt(c,l)]}return[f,h]},E={a:w,b:v,bias:x,preluActivationWeights:N},S={transposeA:n,transposeB:r,activation:o,leakyreluAlpha:a};if(null==s){const t=f9(((t,e,n)=>{const r=s3.runKernel("_FusedMatMul",E,S);return n([t,e,r]),{value:B5(r,b),gradFunc:$}}));return t(w,v)}{const t=f9(((t,e,n,r)=>{const s=s3.runKernel("_FusedMatMul",E,S);return r([t,e,s,n]),{value:B5(s,b),gradFunc:$}}));return t(w,v,x)}}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Stt=Object.freeze({__proto__:null,conv2d:vtt,depthwiseConv2d:$tt,matMul:Ett});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _tt=f4({hammingWindow_:function(t){return ptt(t,.54,.46)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ttt=f4({hannWindow_:function(t){return ptt(t,.5,.5)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ktt=f4({frame_:function(t,e,n,r=!1,s=0){let o=0;const i=[];for(;o+e<=t.size;)i.push(j5(t,o,e)),o+=n;if(r)for(;o<t.size;){const r=o+e-t.size,a=W5([j5(t,o,e-r),X8([r],s)]);i.push(a),o+=n}return 0===i.length?Y7([],[0,e]):B5(W5(i),[i.length,e])}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Att=f4({stft_:function(t,e,n,r,s=Ttt){null==r&&(r=htt(e));const o=ktt(t,e,n),i=p5(o,s(e));return U7(i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ctt=f4({cropAndResize_:function(t,e,n,r,s="bilinear",o=0){const i=c4(t,"image","cropAndResize"),a=c4(e,"boxes","cropAndResize","float32"),u=c4(n,"boxInd","cropAndResize","int32"),c=a.shape[0];S0(4===i.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`)),S0(2===a.rank&&4===a.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`)),S0(1===u.rank&&u.shape[0]===c,(()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`)),S0(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),S0(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),S0("bilinear"===s||"nearest"===s,(()=>`method must be bilinear or nearest, but was ${s}`));const l={image:i,boxes:a,boxInd:u},f={method:s,extrapolationValue:o,cropSize:r};return s3.runKernel("CropAndResize",l,f)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ott=f4({flipLeftRight_:function(t){const e=c4(t,"image","flipLeftRight","float32");S0(4===e.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`));const n={image:e};return s3.runKernel("FlipLeftRight",n,{})}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Itt=f4({grayscaleToRGB_:function(t){const e=c4(t,"image","grayscaleToRGB"),n=e.rank-1,r=e.shape[n];S0(e.rank>=2,(()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`)),S0(1===r,(()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`));const s=new Array(e.rank);return s.fill(1,0,n),s[n]=3,H8(e,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mtt=f4({rotateWithOffset_:function(t,e,n=0,r=.5){const s=c4(t,"image","rotateWithOffset","float32");S0(4===s.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${s.rank}.`));const o={image:s},i={radians:e,fillValue:n,center:r};return s3.runKernel("RotateWithOffset",o,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rtt(t,e,n,r,s,o){null==r&&(r=.5),null==s&&(s=Number.NEGATIVE_INFINITY),null==o&&(o=0);const i=t.shape[0];return n=Math.min(n,i),S0(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),S0(2===t.rank,(()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`)),S0(4===t.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`)),S0(1===e.rank,(()=>"scores must be a 1D tensor")),S0(e.shape[0]===i,(()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`)),S0(0<=o&&o<=1,(()=>`softNmsSigma must be in [0, 1], but was '${o}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:s,softNmsSigma:o}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dtt=f4({nonMaxSuppression_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const o=c4(t,"boxes","nonMaxSuppression","float32"),i=c4(e,"scores","nonMaxSuppression","float32"),a=Rtt(o,i,n,r,s),u={maxOutputSize:n=a.maxOutputSize,iouThreshold:r=a.iouThreshold,scoreThreshold:s=a.scoreThreshold};return s3.runKernel("NonMaxSuppressionV3",{boxes:o,scores:i},u)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ftt(t,e,n){const r=function(t,e,n){return function(t,e,n){let r=0,s=t.length,o=0,i=!1;for(;r<s;){o=r+(s-r>>>1);const a=n(e,t[o]);a>0?r=o+1:(s=o,i=!a)}return i?r:-r-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e,n||Ltt)}(t,e,n),s=r<0?-(r+1):r;t.splice(s,0,e)}function Ltt(t,e){return t>e?1:t<e?-1:0}function Ptt(t,e,n,r,s){return ztt(t,e,n,r,s,0)}function Btt(t,e,n,r,s,o){return ztt(t,e,n,r,s,0,!1,o,!0)}function Vtt(t,e,n,r,s,o){return ztt(t,e,n,r,s,o,!0)}function ztt(t,e,n,r,s,o,i=!1,a=!1,u=!1){const c=[];for(let t=0;t<e.length;t++)e[t]>s&&c.push({score:e[t],boxIndex:t,suppressBeginIndex:0});c.sort(jtt);const l=o>0?-.5/o:0,f=[],h=[];for(;f.length<n&&c.length>0;){const e=c.pop(),{score:n,boxIndex:o,suppressBeginIndex:i}=e;if(n<s)break;let a=!1;for(let n=f.length-1;n>=i;--n){const i=Wtt(t,o,f[n]);if(i>=r){a=!0;break}if(e.score=e.score*Utt(r,l,i),e.score<=s)break}e.suppressBeginIndex=f.length,a||(e.score===n?(f.push(o),h.push(e.score)):e.score>s&&Ftt(c,e,jtt))}const p=f.length,d=n-p;a&&d>0&&(f.push(...new Array(d).fill(0)),h.push(...new Array(d).fill(0)));const m={selectedIndices:f};return i&&(m.selectedScores=h),u&&(m.validOutputs=p),m}function Wtt(t,e,n){const r=t.subarray(4*e,4*e+4),s=t.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(s[0],s[2]),l=Math.min(s[1],s[3]),f=Math.max(s[0],s[2]),h=Math.max(s[1],s[3]),p=(a-o)*(u-i),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;const m=Math.max(o,c),y=Math.max(i,l),g=Math.min(a,f),b=Math.min(u,h),w=Math.max(g-m,0)*Math.max(b-y,0);return w/(p+d-w)}function Utt(t,e,n){const r=Math.exp(e*n*n);return n<=t?r:0}function jtt(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gtt=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const o=c4(t,"boxes","nonMaxSuppressionAsync"),i=c4(e,"scores","nonMaxSuppressionAsync"),a=Rtt(o,i,n,r,s);n=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;const u=await Promise.all([o.data(),i.data()]),c=u[0],l=u[1],{selectedIndices:f}=Ptt(c,l,n,r,s);return o!==t&&o.dispose(),i!==e&&i.dispose(),J7(f,"int32")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qtt=f4({nonMaxSuppressionWithScore_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=c4(t,"boxes","nonMaxSuppression"),a=c4(e,"scores","nonMaxSuppression"),u=Rtt(i,a,n,r,s,o),c={boxes:i,scores:a},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:s=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},f=s3.runKernel("NonMaxSuppressionV5",c,l);return{selectedIndices:f[0],selectedScores:f[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Htt=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=c4(t,"boxes","nonMaxSuppressionAsync"),a=c4(e,"scores","nonMaxSuppressionAsync"),u=Rtt(i,a,n,r,s,o);n=u.maxOutputSize,r=u.iouThreshold,s=u.scoreThreshold,o=u.softNmsSigma;const c=await Promise.all([i.data(),a.data()]),l=c[0],f=c[1],{selectedIndices:h,selectedScores:p}=Vtt(l,f,n,r,s,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:J7(h,"int32"),selectedScores:J7(p)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ktt=f4({nonMaxSuppressionPadded_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=c4(t,"boxes","nonMaxSuppression"),a=c4(e,"scores","nonMaxSuppression"),u=Rtt(i,a,n,r,s,null),c={boxes:i,scores:a},l={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:o},f=s3.runKernel("NonMaxSuppressionV4",c,l);return{selectedIndices:f[0],validOutputs:f[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xtt=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=c4(t,"boxes","nonMaxSuppressionAsync"),a=c4(e,"scores","nonMaxSuppressionAsync"),u=Rtt(i,a,n,r,s,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[h,p]=await Promise.all([i.data(),a.data()]),{selectedIndices:d,validOutputs:m}=Btt(h,p,c,l,f,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:J7(d,"int32"),validOutputs:L8(m,"int32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jtt=f4({resizeBilinear_:function(t,e,n=!1,r=!1){const s=c4(t,"images","resizeBilinear");S0(3===s.rank||4===s.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${s.rank}.`)),S0(2===e.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`)),S0(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=B5(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=s3.runKernel("ResizeBilinear",a,u);return i?B5(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ytt=f4({resizeNearestNeighbor_:function(t,e,n=!1,r=!1){const s=c4(t,"images","resizeNearestNeighbor");S0(3===s.rank||4===s.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${s.rank}.`)),S0(2===e.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`)),S0("float32"===s.dtype||"int32"===s.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),S0(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=B5(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=s3.runKernel("ResizeNearestNeighbor",a,u);return i?B5(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ztt=f4({threshold_:function(t,e="binary",n=!1,r=.5){const s=c4(t,"image","threshold"),o=s.shape[0]*s.shape[1];let i,a,u,c,l=p5(J7([r]),255);if(S0(3===s.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${s.rank}.`)),S0(3===s.shape[2]||1===s.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${s.shape[2]}.`)),S0("int32"===s.dtype||"float32"===s.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${s.dtype}.`)),S0("otsu"===e||"binary"===e,(()=>`Method must be binary or otsu, but was ${e}`)),3===s.shape[2]){[i,a,u]=W7(s,[1,1,1],-1);const t=p5(i,.2989),e=p5(a,.587),n=p5(u,.114);c=l5(l5(t,e),n)}else c=t;if("otsu"===e){l=function(t,e){let n,r,s,o,i,a,u=J7([-1]),c=J7([0]),l=J7([0]);for(let f=0;f<t.size-1;f++){n=j5(t,0,f+1),r=j5(t,f+1),i=h5(V8(n),e),a=h5(V8(r),e);const h=V8(p5(n,g7(0,n.size)));s=h5(h,V8(n));const p=X8(r.shape,n.size),d=l5(g7(0,r.size),p),m=p5(r,d);o=h5(V8(m),V8(r));const y=m9(s,o),g=m9(s,o),b=p5(i,a);l=p5(p5(b,y),g);const w=Z8(l,c);c=E8(w,l,c),u=E8(w,J7([f]),u)}return u}(Z5(t6(_7(c),"int32"),d4([]),256),o)}const f=n?o9(c,l):Z8(c,l);return t6(p5(f,255),"int32")}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qtt=f4({transform_:function(t,e,n="nearest",r="constant",s=0,o){const i=c4(t,"image","transform","float32"),a=c4(e,"transforms","transform","float32");S0(4===i.rank,(()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`)),S0(2===a.rank&&(a.shape[0]===i.shape[0]||1===a.shape[0])&&8===a.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),S0(null==o||2===o.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`));const u={image:i,transforms:a},c={interpolation:n,fillMode:r,fillValue:s,outputShape:o};return s3.runKernel("Transform",u,c)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tet=f4({bandPart_:function(t,e,n){S0(e%1==0,(()=>`bandPart(): numLower must be an integer, got ${e}.`)),S0(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`));const r=c4(t,"a","bandPart");S0(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));const s=r.shape,[o,i]=r.shape.slice(-2);if(!(e<=o))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`);if(!(n<=i))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${i}).`);e<0&&(e=o),n<0&&(n=i);const a=B5(g7(0,o,1,"int32"),[-1,1]),u=g7(0,i,1,"int32"),c=m9(a,u),l=b9(o9(c,L8(+e,"int32")),Q8(c,L8(-n,"int32"))),f=A9([o,i],r.dtype);return B5(q7(ntt(B5(r,[-1,o,i])).map((t=>E8(l,t,f)))),s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eet=f4({gramSchmidt_:function(t){let e;if(Array.isArray(t)){e=!1,S0(null!=t&&t.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=t[0].shape[0];for(let e=1;e<t.length;++e)S0(t[e].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[e].shape[0]} vs. ${n})`))}else e=!0,t=W7(t,t.shape[0],0).map((t=>G7(t,[0])));S0(t.length<=t[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`));const n=[],r=t;for(let e=0;e<t.length;++e)n.push(s3.tidy((()=>{let t=r[e];if(e>0)for(let r=0;r<e;++r){const e=p5(V8(p5(n[r],t)),n[r]);t=m9(t,e)}return h5(t,W8(t,"euclidean"))})));return e?q7(n,0):n}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function net(t,e=!1){return s3.tidy((()=>{S0(2===t.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`));const n=t.shape[0],r=t.shape[1];let s=K8(n),o=e6(t);const i=Y7([[1]],[1,1]);let a=e6(i);const u=n>=r?r:n;for(let t=0;t<u;++t){const e=o,u=a,c=s;[a,o,s]=s3.tidy((()=>{const e=j5(o,[t,t],[n-t,1]),u=W8(e),c=j5(o,[t,t],[1,1]),l=E8(Z8(c,0),Y7([[-1]]),Y7([[1]])),f=m9(c,p5(l,u)),h=h5(e,f);a=1===h.shape[0]?e6(i):W5([i,j5(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);const p=S6(h5(w6(l,f),u)),d=j5(o,[t,0],[n-t,r]),m=p5(p,a),y=T6(a);if(0===t)o=m9(d,w6(m,w6(y,d)));else{const e=m9(d,w6(m,w6(y,d)));o=W5([j5(o,[0,0],[t,r]),e],0)}const g=T6(m),b=j5(s,[0,t],[n,s.shape[1]-t]);if(0===t)s=m9(b,w6(w6(b,a),g));else{const e=m9(b,w6(w6(b,a),g));s=W5([j5(s,[0,0],[n,t]),e],1)}return[a,o,s]})),N6([e,u,c])}return!e&&n>r&&(s=j5(s,[0,0],[n,r]),o=j5(o,[0,0],[r,r])),[s,o]}))}const ret=f4({qr_:function(t,e=!1){if(S0(t.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`)),2===t.rank)return net(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce(((t,e)=>t*e)),r=ntt(B5(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),s=[],o=[];r.forEach((t=>{const[n,r]=net(t,e);s.push(n),o.push(r)}));return[B5(q7(s,0),t.shape),B5(q7(o,0),t.shape)]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var set;!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(set||(set={}));const oet=f4({computeWeightedLoss_:function(t,e,n=set.SUM_BY_NONZERO_WEIGHTS){const r=c4(t,"losses","computeWeightedLoss");let s=null;null!=e&&(s=c4(e,"weights","computeWeightedLoss"));const o=null==s?r:p5(r,s);if(n===set.NONE)return o;if(n===set.SUM)return V8(o);if(n===set.MEAN){if(null==s)return k9(o);{const t=r.size/s.size,e=h5(V8(o),V8(s));return t>1?h5(e,L8(t)):e}}if(n===set.SUM_BY_NONZERO_WEIGHTS){if(null==s)return h5(V8(o),L8(r.size));{const t=p5(s,C9(r.shape)),e=t6(V8(L9(t,L8(0))),"float32");return h5(V8(o),e)}}throw Error(`Unknown reduction: ${n}`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iet=f4({absoluteDifference_:function(t,e,n,r=set.SUM_BY_NONZERO_WEIGHTS){const s=c4(t,"labels","absoluteDifference"),o=c4(e,"predictions","absoluteDifference");let i=null;null!=n&&(i=c4(n,"weights","absoluteDifference")),_0(s.shape,o.shape,"Error in absoluteDifference: ");const a=d5(m9(s,o));return oet(a,i,r)}});const aet=f4({cosineDistance_:function(t,e,n,r,s=set.SUM_BY_NONZERO_WEIGHTS){const o=c4(t,"labels","cosineDistance"),i=c4(e,"predictions","cosineDistance");let a=null;null!=r&&(a=c4(r,"weights","cosineDistance")),_0(o.shape,i.shape,"Error in cosineDistance: ");const u=L8(1),c=m9(u,V8(p5(o,i),n,!0));return oet(c,a,s)}});const uet=f4({hingeLoss_:function(t,e,n,r=set.SUM_BY_NONZERO_WEIGHTS){let s=c4(t,"labels","hingeLoss");const o=c4(e,"predictions","hingeLoss");let i=null;null!=n&&(i=c4(n,"weights","hingeLoss")),_0(s.shape,o.shape,"Error in hingeLoss: ");const a=L8(1);s=m9(p5(L8(2),s),a);const u=w7(m9(a,p5(s,o)));return oet(u,i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cet=f4({huberLoss_:function(t,e,n,r=1,s=set.SUM_BY_NONZERO_WEIGHTS){const o=c4(t,"labels","huberLoss"),i=c4(e,"predictions","huberLoss");let a=null;null!=n&&(a=c4(n,"weights","huberLoss")),_0(o.shape,i.shape,"Error in huberLoss: ");const u=L8(r),c=d5(m9(i,o)),l=O9(c,u),f=m9(c,l),h=l5(p5(L8(.5),B8(l)),p5(u,f));return oet(h,a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fet=f4({logLoss_:function(t,e,n,r=1e-7,s=set.SUM_BY_NONZERO_WEIGHTS){const o=c4(t,"labels","logLoss"),i=c4(e,"predictions","logLoss");let a=null;null!=n&&(a=c4(n,"weights","logLoss")),_0(o.shape,i.shape,"Error in logLoss: ");const u=L8(1),c=L8(r),l=S6(p5(o,u9(l5(i,c)))),f=p5(m9(u,o),u9(l5(m9(u,i),c))),h=m9(l,f);return oet(h,a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const het=f4({meanSquaredError_:function(t,e,n,r=set.SUM_BY_NONZERO_WEIGHTS){const s=c4(t,"labels","meanSquaredError"),o=c4(e,"predictions","meanSquaredError");let i=null;null!=n&&(i=c4(n,"weights","meanSquaredError")),_0(s.shape,o.shape,"Error in meanSquaredError: ");const a=j7(s,o);return oet(a,i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pet=f4({sigmoidCrossEntropy_:function(t,e,n,r=0,s=set.SUM_BY_NONZERO_WEIGHTS){let o=c4(t,"multiClassLabels","sigmoidCrossEntropy");const i=c4(e,"logits","sigmoidCrossEntropy");let a=null;if(null!=n&&(a=c4(n,"weights","sigmoidCrossEntropy")),_0(o.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){const t=L8(r),e=L8(1),n=L8(.5);o=l5(p5(o,m9(e,t)),p5(n,t))}const u=function(t,e){const n=c4(t,"labels","sigmoidCrossEntropyWithLogits"),r=c4(e,"logits","sigmoidCrossEntropyWithLogits");_0(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const s=w7(r),o=p5(r,n),i=c9(j8(S6(d5(r))));return l5(m9(s,o),i)}(o,i);return oet(u,a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const det=f4({softmaxCrossEntropy_:function(t,e,n,r=0,s=set.SUM_BY_NONZERO_WEIGHTS){let o=c4(t,"onehotLabels","softmaxCrossEntropy");const i=c4(e,"logits","softmaxCrossEntropy");let a=null;if(null!=n&&(a=c4(n,"weights","softmaxCrossEntropy")),_0(o.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){const t=L8(r),e=L8(1),n=L8(o.shape[1]);o=l5(p5(o,m9(e,t)),h5(t,n))}const u=function(t,e,n=-1){if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);const r=f9(((t,e,r)=>{const s=g9(e,[n],!0),o=m9(t6(e,"float32"),s);r([t,o]);const i=S6(p5(o,t));return{value:V8(i,[n]),gradFunc:(t,e)=>{const[r,s]=e,o=M8(t.shape,[n]);return[p5(B5(t,o),m9(t6(r,"float32"),j8(s))),p5(B5(t,o),m9(j8(s),t6(r,"float32")))]}}}));return r(t,e)}(o,i);return oet(u,a,s)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const met=f4({sparseFillEmptyRows_:function(t,e,n,r){const s=c4(t,"indices","sparseFillEmptyRows","int32"),o=c4(e,"values","sparseFillEmptyRows"),i=c4(n,"denseShape","sparseFillEmptyRows","int32"),a=c4(r,"defaultValue","sparseFillEmptyRows",o.dtype);if(2!==s.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${s.shape}`);if(1!==o.rank)throw new Error(`Values should be Tensor1D but received shape ${o.shape}`);if(1!==i.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${i.shape}`);if(0!==a.rank)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const u={indices:s,values:o,denseShape:i,defaultValue:a},c=s3.runKernel("SparseFillEmptyRows",u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yet=f4({sparseReshape_:function(t,e,n){const r=c4(t,"inputIndices","sparseReshape","int32"),s=c4(e,"inputShape","sparseReshape","int32"),o=c4(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==s.rank)throw new Error(`Input shape should be Tensor1D but received shape ${s.shape}`);if(1!==o.rank)throw new Error(`New shape should be Tensor1D but received shape ${o.shape}`);const i={inputIndices:r,inputShape:s,newShape:o},a=s3.runKernel("SparseReshape",i);return{outputIndices:a[0],outputShape:a[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const get=f4({sparseSegmentMean_:function(t,e,n){const r=c4(t,"data","sparseSegmentMean"),s=c4(e,"indices","sparseSegmentMean","int32"),o=c4(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return s3.runKernel("SparseSegmentMean",i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bet=f4({sparseSegmentSum_:function(t,e,n){const r=c4(t,"data","sparseSegmentSum"),s=c4(e,"indices","sparseSegmentSum","int32"),o=c4(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return s3.runKernel("SparseSegmentSum",i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wet=f4({stringNGrams_:function(t,e,n,r,s,o,i,a){const u=c4(t,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error(`Data must be a vector, saw: ${u.shape}`);const c=c4(e,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");const l={separator:n,nGramWidths:r,leftPad:s,rightPad:o,padWidth:i,preserveShortSequences:a},f={data:u,dataSplits:c},h=s3.runKernel("StringNGrams",f,l);return{nGrams:h[0],nGramsSplits:h[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vet=f4({stringSplit_:function(t,e,n=!0){const r=c4(t,"input","stringSplit","string"),s=c4(e,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(0!==s.rank)throw new Error(`Delimiter should be a scalar but received shape ${s.shape}`);const o={skipEmpty:n},i={input:r,delimiter:s},a=s3.runKernel("StringSplit",i,o);return{indices:a[0],values:a[1],shape:a[2]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xet=f4({stringToHashBucketFast_:function(t,e){const n=c4(t,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const s={input:n};return s3.runKernel("StringToHashBucketFast",s,r)}}),Net={fft:B7,ifft:V7,rfft:U7,irfft:z7},$et={hammingWindow:_tt,hannWindow:Ttt,frame:ktt,stft:Att},Eet={flipLeftRight:Ott,grayscaleToRGB:Itt,resizeNearestNeighbor:Ytt,resizeBilinear:Jtt,rotateWithOffset:Mtt,cropAndResize:Ctt,nonMaxSuppression:Dtt,nonMaxSuppressionAsync:Gtt,nonMaxSuppressionWithScore:qtt,nonMaxSuppressionWithScoreAsync:Htt,nonMaxSuppressionPadded:Ktt,nonMaxSuppressionPaddedAsync:Xtt,threshold:Ztt,transform:Qtt},_et={bandPart:tet,gramSchmidt:eet,qr:ret},Tet={absoluteDifference:iet,computeWeightedLoss:oet,cosineDistance:aet,hingeLoss:uet,huberLoss:cet,logLoss:fet,meanSquaredError:het,sigmoidCrossEntropy:pet,softmaxCrossEntropy:det},ket={sparseFillEmptyRows:met,sparseReshape:yet,sparseSegmentMean:get,sparseSegmentSum:bet},Aet={stringNGrams:wet,stringSplit:vet,stringToHashBucketFast:xet};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Cet extends n5{minimize(t,e=!1,n){const{value:r,grads:s}=this.computeGradients(t,n);if(null!=n){const t=n.map((t=>({name:t.name,tensor:s[t.name]})));this.applyGradients(t)}else this.applyGradients(s);return N6(s),e?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return l9(t,e)}dispose(){null!=this.iterations_&&N6(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:L8(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(Cet,Symbol.hasInstance,{value:t=>null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Oet extends Cet{constructor(t,e,n=null){super(),this.learningRate=t,this.rho=e,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=s3.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=s3.registeredVariables[e];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${e}/accum_grad`,variable:x6((()=>S8(r).variable(false)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${e}/accum_var`,variable:x6((()=>S8(r).variable(false)))});const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const o=this.accumulatedGrads[n].variable,i=this.accumulatedUpdates[n].variable;x6((()=>{const t=l5(p5(o,this.rho),p5(B8(s),1-this.rho)),e=p5(h5(P8(l5(i,this.epsilon)),P8(l5(o,this.epsilon))),s),n=l5(p5(i,this.rho),p5(B8(e),1-this.rho));o.assign(t),i.assign(n);const a=l5(p5(e,-this.learningRate),r);r.assign(a)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(N6(this.accumulatedGrads.map((t=>t.variable))),N6(this.accumulatedUpdates.map((t=>t.variable))))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){const e=(t=await this.extractIterations(t)).length/2;this.accumulatedGrads=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedUpdates=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}Oet.className="Adadelta",s5(Oet);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Iet extends Cet{constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=s3.registeredVariables[e];if(null==this.accumulatedGrads[n]){const t=!1;this.accumulatedGrads[n]={originalName:`${e}/accumulator`,variable:x6((()=>X8(r.shape,this.initialAccumulatorValue).variable(t)))}}const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const o=this.accumulatedGrads[n].variable;x6((()=>{const t=l5(o,B8(s));o.assign(t);const e=l5(p5(h5(s,P8(l5(t,s3.backend.epsilon()))),-this.learningRate),r);r.assign(e)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&N6(this.accumulatedGrads.map((t=>t.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulatedGrads=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}Iet.className="Adagrad",s5(Iet);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Met extends Cet{constructor(t,e,n,r=null){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],x6((()=>{this.accBeta1=L8(e).variable(),this.accBeta2=L8(n).variable()})),null==r&&(this.epsilon=s3.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);x6((()=>{const n=m9(1,this.accBeta1),r=m9(1,this.accBeta2);e.forEach(((e,s)=>{const o=s3.registeredVariables[e];null==this.accumulatedFirstMoment[s]&&(this.accumulatedFirstMoment[s]={originalName:`${e}/m`,variable:x6((()=>S8(o).variable(false)))}),null==this.accumulatedSecondMoment[s]&&(this.accumulatedSecondMoment[s]={originalName:`${e}/v`,variable:x6((()=>S8(o).variable(false)))});const i=Array.isArray(t)?t[s].tensor:t[e];if(null==i)return;const a=this.accumulatedFirstMoment[s].variable,u=this.accumulatedSecondMoment[s].variable,c=l5(p5(a,this.beta1),p5(i,1-this.beta1)),l=l5(p5(u,this.beta2),p5(B8(i),1-this.beta2)),f=h5(c,n),h=h5(l,r);a.assign(c),u.assign(l);const p=l5(p5(h5(f,l5(P8(h),this.epsilon)),-this.learningRate),o);o.assign(p)})),this.accBeta1.assign(p5(this.accBeta1,this.beta1)),this.accBeta2.assign(p5(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&N6(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedSecondMoment&&N6(this.accumulatedSecondMoment.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t),x6((()=>{this.accBeta1.assign(F8(this.beta1,this.iterations_+1)),this.accBeta2.assign(F8(this.beta2,this.iterations_+1))}));const e=t.length/2;this.accumulatedFirstMoment=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedSecondMoment=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}Met.className="Adam",s5(Met);
/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/
class Ret extends Cet{constructor(t,e,n,r=null,s=0){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],x6((()=>{this.iteration=L8(0).variable(),this.accBeta1=L8(e).variable()})),null==r&&(this.epsilon=s3.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);x6((()=>{const n=m9(1,this.accBeta1),r=h5(-this.learningRate,l5(p5(this.iteration,this.decay),1));e.forEach(((e,s)=>{const o=s3.registeredVariables[e];null==this.accumulatedFirstMoment[s]&&(this.accumulatedFirstMoment[s]={originalName:`${e}/m`,variable:S8(o).variable(false)}),null==this.accumulatedWeightedInfNorm[s]&&(this.accumulatedWeightedInfNorm[s]={originalName:`${e}/v`,variable:S8(o).variable(false)});const i=Array.isArray(t)?t[s].tensor:t[e];if(null==i)return;const a=this.accumulatedFirstMoment[s].variable,u=this.accumulatedWeightedInfNorm[s].variable,c=l5(p5(a,this.beta1),p5(i,1-this.beta1)),l=p5(u,this.beta2),f=d5(i),h=T9(l,f);a.assign(c),u.assign(h);const p=l5(p5(h5(r,n),h5(c,l5(h,this.epsilon))),o);o.assign(p)})),this.iteration.assign(l5(this.iteration,1)),this.accBeta1.assign(p5(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&N6(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedWeightedInfNorm&&N6(this.accumulatedWeightedInfNorm.map((t=>t.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}Ret.className="Adamax",s5(Ret);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Det extends Cet{constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);e.forEach(((e,n)=>{const r=Array.isArray(t)?t[n].tensor:t[e];if(null==r)return;const s=s3.registeredVariables[e];x6((()=>{const t=l5(p5(this.c,r),s);s.assign(t)}))})),this.incrementIterations()}setLearningRate(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=$6(L8(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(0!==(t=await this.extractIterations(t)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}Det.className="SGD",s5(Det);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Fet extends Det{constructor(t,e,n=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=n,this.accumulations=[],this.m=L8(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=s3.registeredVariables[e];if(null==this.accumulations[n]){const t=!1;this.accumulations[n]={originalName:`${e}/momentum`,variable:x6((()=>S8(r).variable(t)))}}const s=this.accumulations[n].variable,o=Array.isArray(t)?t[n].tensor:t[e];null!=o&&x6((()=>{let t;const e=l5(p5(this.m,s),o);t=this.useNesterov?l5(p5(this.c,l5(o,p5(e,this.m))),r):l5(p5(this.c,e),r),s.assign(e),r.assign(t)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&N6(this.accumulations.map((t=>t.variable)))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulations=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}Fet.className="Momentum",s5(Fet);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Let extends Cet{constructor(t,e=.9,n=0,r=null,s=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,null==r&&(this.epsilon=s3.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=s3.registeredVariables[e],s=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${e}/rms`,variable:x6((()=>S8(r).variable(s)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${e}/momentum`,variable:x6((()=>S8(r).variable(s)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${e}/mg`,variable:x6((()=>S8(r).variable(s)))});const o=Array.isArray(t)?t[n].tensor:t[e];if(null==o)return;const i=this.accumulatedMeanSquares[n].variable,a=this.accumulatedMoments[n].variable;x6((()=>{const t=l5(p5(i,this.decay),p5(B8(o),1-this.decay));if(this.centered){const e=this.accumulatedMeanGrads[n].variable,s=l5(p5(e,this.decay),p5(o,1-this.decay)),u=h5(p5(o,this.learningRate),P8(m9(t,l5(B8(s),this.epsilon)))),c=l5(p5(a,this.momentum),u);i.assign(t),e.assign(s),a.assign(c);const l=m9(r,c);r.assign(l)}else{const t=l5(p5(i,this.decay),p5(B8(o),1-this.decay)),e=l5(p5(a,this.momentum),h5(p5(o,this.learningRate),P8(l5(t,this.epsilon))));i.assign(t),a.assign(e);const n=m9(r,e);r.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&N6(this.accumulatedMeanSquares.map((t=>t.variable))),null!=this.accumulatedMeanGrads&&this.centered&&N6(this.accumulatedMeanGrads.map((t=>t.variable))),null!=this.accumulatedMoments&&N6(this.accumulatedMoments.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,n=!1;this.accumulatedMeanSquares=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.accumulatedMoments=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}Let.className="RMSProp",s5(Let);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Pet{static sgd(t){return new Det(t)}static momentum(t,e,n=!1){return new Fet(t,e,n)}static rmsprop(t,e=.9,n=0,r=null,s=!1){return new Let(t,e,n,r,s)}static adam(t=.001,e=.9,n=.999,r=null){return new Met(t,e,n,r)}static adadelta(t=.001,e=.95,n=null){return new Oet(t,e,n)}static adamax(t=.002,e=.9,n=.999,r=null,s=0){return new Ret(t,e,n,r,s)}static adagrad(t,e=.1){return new Iet(t,e)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bet={sgd:Pet.sgd,momentum:Pet.momentum,adadelta:Pet.adadelta,adagrad:Pet.adagrad,rmsprop:Pet.rmsprop,adamax:Pet.adamax,adam:Pet.adam},Vet="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:t=>t();
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const zet=/->/g;function Wet(t,e){const n=[];for(let r=0;r<t.length;++r)0!==t[r].length&&-1===t[r].indexOf(e)&&-1!==e||n.push(r);return n}var Uet=Object.freeze({__proto__:null,segOpComputeOptimalWindowSize:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n,r=!1;for(t<=30?(n=t,r=!0):n=H0(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=H0(t,n+1);return n},computeOutShape:function(t,e,n){const r=[],s=t.length;for(let o=0;o<s;o++)o!==e?r.push(t[o]):r.push(n);return r},collectGatherOpShapeInfo:function(t,e,n,r){const s=e.shape.length,o=t.shape.length;if(0!==r&&(r<-s||r>s))throw new Error(`Expect batchDims in the range of [-${s}, ${s}], but got ${r}`);if(r<0&&(r+=s),r>o)throw new Error(`batchDims (${r}) must be less than rank(x) (\n    ${o}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let n=0;n<r;++n)if(t.shape[n]!==e.shape[n])throw new Error(`x.shape[${n}]: ${t.shape[n]} should be equal to indices.shape[${n}]: ${e.shape[n]}.`);const i=t.shape[n],a=[];let u=1,c=1,l=1;for(let e=0;e<r;++e)a.push(t.shape[e]),u*=t.shape[e];for(let e=r;e<n;e++)a.push(t.shape[e]),c*=t.shape[e];for(let t=r;t<s;t++)a.push(e.shape[t]);for(let e=n+1;e<o;e++)a.push(t.shape[e]),l*=t.shape[e];return{batchSize:u,sliceSize:l,outerSize:c,dimSize:i,outputShape:a}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var jet=Object.freeze({__proto__:null,slice_util:e5,segment_util:Uet,fromUint8ToStringArray:function(t){try{return t.map((t=>T2(t)))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}},fromStringArrayToUint8:function(t){return t.map((t=>_2(t)))},upcastType:K2,axesAreInnerMostDims:O8,combineLocations:I8,computeOutAndReduceShapes:function(t,e){const n=[],r=t.length;for(let s=0;s<r;s++)-1===e.indexOf(s)&&n.push(t[s]);return[n,e.map((e=>t[e]))]},expandShapeToKeepDim:M8,assertAxesAreInnerMostDims:function(t,e,n){S0(O8(e,n),(()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`))},getAxesPermutation:function(t,e){if(O8(t,e))return null;const n=[];for(let r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach((t=>n.push(t))),n},getUndoAxesPermutation:function(t){return t.map(((t,e)=>[e,t])).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]))},getInnerMostAxes:function(t,e){const n=[];for(let r=e-t;r<e;++r)n.push(r);return n},getBroadcastDims:C6,getReductionAxes:O6,assertAndGetBroadcastShape:I6,assertParamsConsistent:
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=t[0].length;t.forEach(((t,e)=>{S0(t.length===n,(()=>`Error in concat${n}D: rank of tensors[${e}] must be the same as the rank of the rest (${n})`))})),S0(e>=0&&e<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));const r=t[0];t.forEach(((t,s)=>{for(let o=0;o<n;o++)S0(o===e||t[o]===r[o],(()=>`Error in concat${n}D: Shape of tensors[${s}] (${t}) does not match the shape of the rest (${r}) along the non-concatenated axis ${s}.`))}))},computeOutShape:function(t,e){const n=t[0].slice();for(let r=1;r<t.length;r++)n[e]+=t[r][e];return n}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,computeDilation2DInfo:function(t,e,n,r,s="NHWC",o){return k5(t,[...e,t[3]],n,o,r,null,null,L5(s))},computePool2DInfo:T5,computePool3DInfo:function(t,e,n,r,s,o,i="NDHWC"){const[a,u,c]=I5(e);let l,f;if("NDHWC"===i)f="channelsLast",l=[a,u,c,t[4],t[4]];else{if("NCDHW"!==i)throw new Error(`Unknown dataFormat ${i}`);f="channelsFirst",l=[a,u,c,t[1],t[1]]}return A5(t,l,n,r,s,!1,f,o)},computeConv2DInfo:k5,computeConv3DInfo:A5,computeDefaultPad:C5,tupleValuesAreOne:D5,eitherStridesOrDilationsAreOne:F5,convertConv2DDataFormat:L5,checkPadOnDimRoundingMode:P5,getFusedDyActivation:ytt,getFusedBiasGradient:gtt,applyActivation:btt,shouldFuse:wtt,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:function(t){return t<=30?t:H0(t,Math.floor(Math.sqrt(t)))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getImageCenter:function(t,e,n){return[n*("number"==typeof t?t:t[0]),e*("number"==typeof t?t:t[1])]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getReshaped:function(t,e,n,r=!0){let s=[];if(r)s=s.concat(e.slice(0)),s.push(t[0]/n),s=s.concat(t.slice(1));else{s=s.concat(t[0]);const n=e.length;for(let r=0;r<n;++r)s=s.concat([t[r+1]/e[r],e[r]]);s=s.concat(t.slice(n+1))}return s},getPermuted:function(t,e,n=!0){const r=[];if(n){r.push(e);for(let n=e+1;n<t;++n)n<=2*e?(r.push(n),r.push(n-(e+1))):r.push(n)}else{const n=[],s=[];for(let r=1;r<t;++r)r>=2*e+1||r%2==1?s.push(r):n.push(r);r.push(...n),r.push(0),r.push(...s)}return r},getReshapedPermuted:function(t,e,n,r=!0){const s=[];r?s.push(t[0]/n):s.push(t[0]*n);for(let n=1;n<t.length;++n)n<=e.length?r?s.push(e[n-1]*t[n]):s.push(t[n]/e[n-1]):s.push(t[n]);return s},getSliceBeginCoords:function(t,e){const n=[0];for(let r=0;r<e;++r)n.push(t[r][0]);return n},getSliceSize:function(t,e,n){const r=t.slice(0,1);for(let s=0;s<n;++s)r.push(t[s+1]-e[s][0]-e[s][1]);return r}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,prepareAndValidate:V6,validateUpdateShape:W6,validateInput:U6,calculateShapes:j6,SELU_SCALEALPHA:1.7580993408473768,SELU_SCALE:1.0507009873554805,ERF_P:.3275911,ERF_A1:.254829592,ERF_A2:-.284496736,ERF_A3:1.421413741,ERF_A4:-1.453152027,ERF_A5:1.061405429,warn:M1,log:function(...t){r1().getBool("IS_TEST")||r1().getBool("PROD")||console.log(...t)},mergeRealAndImagArrays:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(2*t.length);for(let r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n},splitRealAndImagArrays:function(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}},complexWithEvenIndex:function(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=0;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}},complexWithOddIndex:function(t){const e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=2;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}},getComplexWithIndex:function(t,e){return{real:t[2*e],imag:t[2*e+1]}},assignToTypedArray:function(t,e,n,r){t[2*r]=e,t[2*r+1]=n},exponents:function(t,e){const n=new Float32Array(t/2),r=new Float32Array(t/2);for(let s=0;s<Math.ceil(t/2);s++){const o=(e?2:-2)*Math.PI*(s/t);n[s]=Math.cos(o),r[s]=Math.sin(o)}return{real:n,imag:r}},exponent:function(t,e,n){const r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}},decodeEinsumEquation:function(t,e){const n=((t=t.replace(/\s/g,"")).length-t.replace(zet,"").length)/"->".length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("->").');const[r,s]=t.split("->");S0(-1===r.indexOf("..."),(()=>'The ellipsis notation ("...") is not supported yet.'));const o=r.split(","),i=o.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let t=0;t<s.length;++t){const e=s[t];if(!o.some((t=>-1!==t.indexOf(e))))throw new Error(`Output subscripts contain the label ${e} not present in the input subscripts.`);-1===a.indexOf(e)&&a.push(e)}for(let t=0;t<r.length;++t){const e=r[t];-1===a.indexOf(e)&&","!==e&&a.push(e)}const u=new Array(o.length);for(let t=0;t<i;++t){if(new Set(o[t].split("")).size!==o[t].length)throw new Error(`Found duplicate axes in input component ${o[t]}. Support for duplicate axes in input is not implemented yet.`);u[t]=[];for(let e=0;e<o[t].length;++e)u[t].push(a.indexOf(o[t][e]))}const c=a.length,l=[];for(let t=s.length;t<c;++t)l.push(t);return{allDims:a,summedDims:l,idDims:u}},getEinsumPermutation:function(t,e){let n=new Array(t);n.fill(-1);for(let t=0;t<e.length;++t)n[e[t]]=t;const r=[];for(let e=0;e<t;++e)-1===n[e]&&r.push(e);return n=n.filter((t=>-1!==t)),{permutationIndices:n,expandDims:r}},checkEinsumDimSizes:function(t,e,n){const r=new Array(t);for(let t=0;t<n.length;++t){const s=n[t].shape;for(let n=0;n<e[t].length;++n)void 0===r[e[t][n]]?r[e[t][n]]=s[n]:S0(r[e[t][n]]===s[n],(()=>`Expected dimension ${r[e[t][n]]} at axis ${n} of input shaped ${JSON.stringify(s)}, but got dimension ${s[n]}`))}},getEinsumComputePath:function(t,e){const n=t,r=[];let s=0;0===t.length&&n.push(-1),s=t.length+1;for(let t=0;t<s;++t)r.push([]);const o=[];for(let t=0;t<n.length;++t){const s=Wet(e,n[t]);for(const e of s)-1===o.indexOf(e)&&(r[t].push(e),o.push(e))}return{path:n,steps:r}},isIdentityPermutation:function(t){return t.every(((t,e)=>t===e))},prepareSplitSize:function(t,e,n=0){let r=[];if("number"==typeof e)S0(t.shape[n]%e==0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(e).fill(t.shape[n]/e);else{S0(e.reduce(((t,e)=>(-1===e&&(t+=1),t)),0)<=1,(()=>"There should be only one negative value in split array."));const s=e.indexOf(-1);if(-1!==s){const r=e.reduce(((t,e)=>e>0?t+e:t));e[s]=t.shape[n]-r}S0(t.shape[n]===e.reduce(((t,e)=>t+e)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=e}return r}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getSparseFillEmptyRowsIndicesDenseShapeMismatch:function(t){return`Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ${t}`},getSparseFillEmptyRowsNegativeIndexErrorMessage:function(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`},getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:function(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:function(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`},getSparseReshapeNegativeOutputDimErrorMessage:function(t,e){return`size ${t} must be non-negative, not ${e}`},getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:function(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"},getSparseReshapeInputOutputMultipleErrorMessage:function(t,e){return`Input to reshape is a SparseTensor with ${A0(t)}\n  dense values, but the requested shape requires a multiple of ${A0(e)}. inputShape=${t} outputShape= ${e}`},getSparseReshapeInputOutputMismatchErrorMessage:function(t,e){return`Input to reshape is a tensor with ${A0(t)} dense values, but the requested shape has ${A0(e)}. inputShape=${t} outputShape=${e}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:function(){return"segment ids must be >= 0"},getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:function(){return"segment ids are not increasing"},getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:function(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`},getSparseSegmentReductionIndicesOutOfRangeErrorMessage:function(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}}),Get=Object.freeze({__proto__:null,nonMaxSuppressionV3Impl:Ptt,nonMaxSuppressionV4Impl:Btt,nonMaxSuppressionV5Impl:Vtt,whereImpl:stt}),qet=Object.freeze({__proto__:null,AdadeltaOptimizer:Oet,AdagradOptimizer:Iet,AdamOptimizer:Met,AdamaxOptimizer:Ret,MomentumOptimizer:Fet,Optimizer:Cet,OptimizerConstructors:Pet,RMSPropOptimizer:Let,SGDOptimizer:Det,Tensor:V2,TensorBuffer:L2,Variable:z2,get Rank(){return W2},sumOutType:function(t){return K2(t,"int32")},upcastType:K2,get Reduction(){return set},customGrad:f9,grad:function(t){return S0(q0(t),(()=>"The f passed in grad(f) must be a function")),(e,n)=>{const r=c4(e,"x","tf.grad","string_or_numeric"),s=null!=n?c4(n,"dy","tf.grad"):null;return s3.tidy((()=>{const{value:e,grads:n}=s3.gradients((()=>t(r)),[r],s);return null!=s&&_0(e.shape,s.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),h9(n),n[0]}))}},grads:function(t){return S0(q0(t),(()=>"The f passed in grads(f) must be a function")),(e,n)=>{S0(Array.isArray(e),(()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"));const r=l4(e,"args","tf.grads","string_or_numeric"),s=null!=n?c4(n,"dy","tf.grads"):null;return s3.tidy((()=>{const{value:e,grads:n}=s3.gradients((()=>t(...r)),r,s);return null!=s&&_0(e.shape,s.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),h9(n),n}))}},valueAndGrad:function(t){return S0(q0(t),(()=>"The f passed in valueAndGrad(f) must be a function")),(e,n)=>{S0(e instanceof V2,(()=>"The x passed in valueAndGrad(f)(x) must be a tensor")),S0(null==n||n instanceof V2,(()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"));const{grads:r,value:s}=s3.gradients((()=>t(e)),[e],n);return h9(r),{grad:r[0],value:s}}},valueAndGrads:function(t){return S0(q0(t),(()=>"The f passed in valueAndGrads(f) must be a function")),(e,n)=>{S0(Array.isArray(e)&&e.every((t=>t instanceof V2)),(()=>"The args passed in valueAndGrads(f)(args) must be array of tensors")),S0(null==n||n instanceof V2,(()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"));const r=s3.gradients((()=>t(...e)),e,n);return null!=n&&_0(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),h9(r.grads),r}},variableGrads:l9,Environment:e1,env:r1,get ENV(){return s1},nextFrame:function(){return new Promise((t=>Vet((()=>t()))))},KernelBackend:v0,DataStorage:class{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}},abs:d5,acos:m5,acosh:y5,add:l5,addN:g5,all:b5,any:w5,argMax:v5,argMin:x5,asin:N5,asinh:$5,atan:E5,atan2:S5,atanh:_5,avgPool:V5,avgPool3d:z5,basicLSTMCell:q5,batchToSpaceND:H5,batchNorm:K5,batchNorm2d:X5,batchNorm3d:J5,batchNorm4d:Y5,bincount:Z5,broadcastArgs:Q5,broadcastTo:t8,buffer:Q4,cast:t6,ceil:e8,clipByValue:n8,clone:e6,complex:h4,concat:W5,concat1d:r8,concat2d:s8,concat3d:o8,concat4d:i8,conv1d:u8,conv2d:a8,conv2dTranspose:l8,conv3d:f8,conv3dTranspose:p8,cos:d8,cosh:m8,cumprod:y8,cumsum:g8,denseBincount:b8,depthToSpace:w8,depthwiseConv2d:v8,diag:x8,dilation2d:N8,div:h5,divNoNan:_8,dot:T8,einsum:k8,elu:A8,equal:$8,erf:C8,euclideanNorm:U8,exp:j8,expandDims:G8,expm1:q8,eye:K8,fill:X8,floor:J8,floorDiv:f5,gather:Y8,greater:Z8,greaterEqual:Q8,imag:E6,isFinite:t9,isInf:e9,isNaN:n9,leakyRelu:r9,less:s9,lessEqual:o9,linspace:i9,localResponseNormalization:a9,log:u9,log1p:c9,logSigmoid:d9,logSoftmax:y9,logSumExp:g9,logicalAnd:b9,logicalNot:w9,logicalOr:v9,logicalXor:x9,lowerBound:$9,matMul:w6,max:R8,maxPool:E9,maxPool3d:S9,maxPoolWithArgmax:_9,maximum:T9,mean:k9,meshgrid:function(t,e,{indexing:n="xy"}={}){if("xy"!==n&&"ij"!==n)throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(void 0===t)return[];let r=c4(t,"x","meshgrid",t instanceof V2?t.dtype:"float32");if(void 0===e)return[r];let s=c4(e,"y","meshgrid",e instanceof V2?e.dtype:"float32");const o=A0(r.shape),i=A0(s.shape);return"xy"===n?(r=B5(r,[1,-1]),s=B5(s,[-1,1]),[w6(C9([i,1],r.dtype),r),w6(s,C9([1,o],s.dtype))]):(r=B5(r,[-1,1]),s=B5(s,[1,-1]),[w6(r,C9([1,i],r.dtype)),w6(C9([o,1],s.dtype),s)])},min:D8,minimum:O9,mirrorPad:I9,mod:M9,moments:R9,mul:p5,multiRNNCell:D9,multinomial:F9,neg:S6,notEqual:L9,oneHot:v6,ones:C9,onesLike:P9,outerProduct:B9,pad:V9,pad1d:z9,pad2d:W9,pad3d:U9,pad4d:j9,pool:q9,pow:F8,prelu:H9,print:n6,prod:K9,rand:X9,randomGamma:d7,randomNormal:m7,randomUniform:y7,range:g7,real:_6,reciprocal:b7,relu:w7,relu6:v7,reshape:B5,reverse:x7,reverse1d:N7,reverse2d:$7,reverse3d:E7,reverse4d:S7,round:_7,rsqrt:T7,scalar:L8,selu:k7,separableConv2d:A7,setdiff1dAsync:C7,sigmoid:U5,sign:O7,sin:I7,sinh:M7,slice:j5,slice1d:R7,slice2d:D7,slice3d:F7,slice4d:L7,softmax:P7,softplus:p9,spaceToBatchND:G9,fft:B7,ifft:V7,irfft:z7,rfft:U7,split:W7,sqrt:P8,square:B8,squaredDifference:j7,squeeze:G7,stack:q7,step:H7,stridedSlice:K7,sub:m9,sum:V8,tan:X7,tanh:G5,tensor:d4,tensor1d:J7,tensor2d:Y7,tensor3d:R6,tensor4d:function(t,e,n){if(T0(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");const r=i4(t,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return p4(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,tensor5d:function(t,e,n){if(T0(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");const r=i4(t,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return p4(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,tensor6d:function(t,e,n){if(T0(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");const r=i4(t,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return p4(t,e=e||r,r,n)},tile:H8,topk:Z7,truncatedNormal:Q7,unique:ttt,unsortedSegmentSum:ett,unstack:ntt,upperBound:rtt,variable:function(t,e=!0,n,r){return s3.makeVariable(t,e,n,r)},where:E8,whereAsync:ott,zeros:A9,zerosLike:S8,op:f4,OP_SCOPE_SUFFIX:"__op",booleanMaskAsync:itt,transpose:T6,norm:W8,movingAverage:att,scatterND:utt,searchSorted:N9,sparseToDense:ctt,gatherND:ltt,dropout:ftt,enclosingPowerOfTwo:htt,cosineWindow:ptt,inTopKAsync:dtt,image:Eet,linalg:_et,losses:Tet,spectral:Net,fused:Stt,signal:$et,sparse:ket,string:Aet,train:Bet,enableProdMode:function(){r1().set("PROD",!0)},enableDebugMode:function(){r1().set("DEBUG",!0)},disableDeprecationWarnings:function(){r1().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},deprecationWarn:function(t){r1().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")},disposeVariables:function(){s3.disposeVariables()},engine:function(){return s3},memory:function(){return s3.memory()},profile:function(t){return s3.profile(t)},tidy:x6,dispose:N6,keep:$6,time:function(t){return s3.time(t)},setBackend:function(t){return s3.setBackend(t)},ready:function(){return s3.ready()},getBackend:function(){return s3.backendName},removeBackend:function(t){s3.removeBackend(t)},findBackend:function(t){return s3.findBackend(t)},findBackendFactory:function(t){return s3.findBackendFactory(t)},registerBackend:function(t,e,n=1){return s3.registerBackend(t,e,n)},backend:function(){return s3.backend},setPlatform:function(t,e){r1().setPlatform(t,e)},getKernel:F1,getGradient:L1,getKernelsForBackend:P1,registerKernel:B1,registerGradient:function(t){const{kernelName:e}=t;D1.has(e)&&r1().getBool("DEBUG")&&M1(`Overriding the gradient for '${e}'`),D1.set(e,t)},unregisterKernel:function(t,e){const n=V1(t,e);if(!R1.has(n))throw new Error(`The kernel '${t}' for backend '${e}' is not registered`);R1.delete(n)},unregisterGradient:function(t){if(!D1.has(t))throw new Error(`The gradient '${t}' for backend is not registered`);D1.delete(t)},copyRegisteredKernels:function(t,e){P1(t).forEach((t=>{B1(Object.assign({},t,{backendName:e}))}))},Abs:"Abs",Acos:"Acos",Acosh:"Acosh",Add:"Add",AddN:"AddN",All:"All",Any:"Any",ArgMax:"ArgMax",ArgMin:"ArgMin",Asin:"Asin",Asinh:"Asinh",Atan:"Atan",Atanh:"Atanh",Atan2:"Atan2",AvgPool:"AvgPool",AvgPoolGrad:"AvgPoolGrad",AvgPool3D:"AvgPool3D",AvgPool3DGrad:"AvgPool3DGrad",BatchMatMul:"BatchMatMul",BatchToSpaceND:"BatchToSpaceND",Bincount:"Bincount",BroadcastTo:"BroadcastTo",BroadcastArgs:"BroadcastArgs",Cast:"Cast",Ceil:"Ceil",ClipByValue:"ClipByValue",Complex:"Complex",ComplexAbs:"ComplexAbs",Concat:"Concat",Conv2D:"Conv2D",Conv2DBackpropFilter:"Conv2DBackpropFilter",Conv2DBackpropInput:"Conv2DBackpropInput",Conv3D:"Conv3D",Conv3DBackpropFilterV2:"Conv3DBackpropFilterV2",Conv3DBackpropInputV2:"Conv3DBackpropInputV2",Cos:"Cos",Cosh:"Cosh",Cumprod:"Cumprod",Cumsum:"Cumsum",CropAndResize:"CropAndResize",DenseBincount:"DenseBincount",DepthToSpace:"DepthToSpace",DepthwiseConv2dNative:"DepthwiseConv2dNative",DepthwiseConv2dNativeBackpropFilter:"DepthwiseConv2dNativeBackpropFilter",DepthwiseConv2dNativeBackpropInput:"DepthwiseConv2dNativeBackpropInput",Diag:"Diag",Dilation2D:"Dilation2D",Dilation2DBackpropInput:"Dilation2DBackpropInput",Dilation2DBackpropFilter:"Dilation2DBackpropFilter",RealDiv:"RealDiv",Einsum:"Einsum",Elu:"Elu",EluGrad:"EluGrad",Erf:"Erf",Equal:"Equal",Exp:"Exp",ExpandDims:"ExpandDims",Expm1:"Expm1",FFT:"FFT",Fill:"Fill",FlipLeftRight:"FlipLeftRight",Floor:"Floor",FloorDiv:"FloorDiv",FusedBatchNorm:"FusedBatchNorm",GatherV2:"GatherV2",GatherNd:"GatherNd",Greater:"Greater",GreaterEqual:"GreaterEqual",Identity:"Identity",IFFT:"IFFT",Imag:"Imag",IsFinite:"IsFinite",IsInf:"IsInf",IsNan:"IsNan",LeakyRelu:"LeakyRelu",Less:"Less",LessEqual:"LessEqual",LinSpace:"LinSpace",Log:"Log",Log1p:"Log1p",LogicalAnd:"LogicalAnd",LogicalNot:"LogicalNot",LogicalOr:"LogicalOr",LogSoftmax:"LogSoftmax",LowerBound:"LowerBound",LRN:"LRN",LRNGrad:"LRNGrad",Max:"Max",Maximum:"Maximum",MaxPool:"MaxPool",MaxPoolGrad:"MaxPoolGrad",MaxPool3D:"MaxPool3D",MaxPool3DGrad:"MaxPool3DGrad",MaxPoolWithArgmax:"MaxPoolWithArgmax",Mean:"Mean",Min:"Min",Minimum:"Minimum",MirrorPad:"MirrorPad",Mod:"Mod",Multinomial:"Multinomial",Multiply:"Multiply",Neg:"Neg",NotEqual:"NotEqual",NonMaxSuppressionV3:"NonMaxSuppressionV3",NonMaxSuppressionV4:"NonMaxSuppressionV4",NonMaxSuppressionV5:"NonMaxSuppressionV5",OnesLike:"OnesLike",OneHot:"OneHot",Pack:"Pack",PadV2:"PadV2",Pool:"Pool",Pow:"Pow",Prelu:"Prelu",Prod:"Prod",Range:"Range",Real:"Real",Reciprocal:"Reciprocal",Relu:"Relu",Reshape:"Reshape",ResizeNearestNeighbor:"ResizeNearestNeighbor",ResizeNearestNeighborGrad:"ResizeNearestNeighborGrad",ResizeBilinear:"ResizeBilinear",ResizeBilinearGrad:"ResizeBilinearGrad",Relu6:"Relu6",Reverse:"Reverse",Round:"Round",Rsqrt:"Rsqrt",ScatterNd:"ScatterNd",SearchSorted:"SearchSorted",Select:"Select",Selu:"Selu",Slice:"Slice",Sin:"Sin",Sinh:"Sinh",Sign:"Sign",Sigmoid:"Sigmoid",Softplus:"Softplus",Sqrt:"Sqrt",Sum:"Sum",SpaceToBatchND:"SpaceToBatchND",SplitV:"SplitV",Softmax:"Softmax",SparseFillEmptyRows:"SparseFillEmptyRows",SparseReshape:"SparseReshape",SparseSegmentMean:"SparseSegmentMean",SparseSegmentSum:"SparseSegmentSum",SparseToDense:"SparseToDense",SquaredDifference:"SquaredDifference",Square:"Square",StridedSlice:"StridedSlice",StringNGrams:"StringNGrams",StringSplit:"StringSplit",StringToHashBucketFast:"StringToHashBucketFast",Sub:"Sub",Tan:"Tan",Tanh:"Tanh",Tile:"Tile",TopK:"TopK",Transform:"Transform",Transpose:"Transpose",Unique:"Unique",Unpack:"Unpack",UnsortedSegmentSum:"UnsortedSegmentSum",UpperBound:"UpperBound",ZerosLike:"ZerosLike",Step:"Step",FromPixels:"FromPixels",RotateWithOffset:"RotateWithOffset",_FusedMatMul:"_FusedMatMul",FusedConv2D:"FusedConv2D",FusedDepthwiseConv2D:"FusedDepthwiseConv2D",version_core:"3.18.0",browser:B6,io:b6,math:A6,serialization:o5,test_util:c5,util:k2,backend_util:jet,broadcast_util:M6,tensor_util:Q2,slice_util:e5,gather_util:z6,scatter_util:G6,device_util:u3,kernel_impls:Get});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
var Het,Ket;r1().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"}(Het||(Het={})),function(t){var e;(e=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(Ket||(Ket={}));
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Xet={};function Jet(t){return Xet[t]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Yet(t,e,n,r,s){const o=e.inputParams[t];if(o&&void 0!==o.inputIndexStart){const t=o.inputIndexStart,i=0===o.inputIndexEnd?void 0:void 0===o.inputIndexEnd?t+1:o.inputIndexEnd;if("tensor"===o.type)return Zet(e.inputNames[o.inputIndexStart],n,r,s);if("tensors"===o.type){return e.inputNames.slice(t,i).map((t=>Zet(t,n,r,s)))}const a=Zet(e.inputNames.slice(t)[0],n,r,s),u=a.dataSync();return"number"===o.type?u[0]:J0(a.shape,u)}const i=e.attrParams[t];return i&&i.value}function Zet(t,e,n,r){const[s,o]=ent(t);if(null!=r){const t=r.getHashTableHandleByName(s);if(null!=t)return t}const i=n.currentContextIds.find((t=>!!e[tnt(s,t)]));return void 0!==i?e[tnt(s,i)][o]:void 0}function Qet(t,e){const[n,r,s]=ent(t);return[tnt(n,e&&e.currentContextId),r,s]}function tnt(t,e){return e?`${t}-${e}`:t}function ent(t){const e=t.split(":");if(1===e.length)return[t,0,void 0];const n=e[0],r=3===e.length?e[1]:void 0;return[n,Number(e[e.length-1]),r]}function nnt(t,e,n){let r=Yet("pad",t,e,n);if("explicit"===r){r=Yet("explicitPaddings",t,e,n);const s=[[0,0],[0,0],[0,0],[0,0]];for(let t=0;t<4;t++)s[t][0]=r[2*t],s[t][1]=r[2*t+1];return s}return r}function rnt(t){return t.kept?t:e6(t)}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var snt=Object.freeze({__proto__:null,json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ont=Object.freeze({__proto__:null,json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var int=Object.freeze({__proto__:null,json:[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ant=Object.freeze({__proto__:null,json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var unt=Object.freeze({__proto__:null,json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var cnt=Object.freeze({__proto__:null,json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var lnt=Object.freeze({__proto__:null,json:[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var fnt=Object.freeze({__proto__:null,json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var hnt=Object.freeze({__proto__:null,json:[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var pnt=Object.freeze({__proto__:null,json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var dnt=Object.freeze({__proto__:null,json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var mnt=Object.freeze({__proto__:null,json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ynt=Object.freeze({__proto__:null,json:[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var gnt=Object.freeze({__proto__:null,json:[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var bnt=Object.freeze({__proto__:null,json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var wnt=Object.freeze({__proto__:null,json:[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var vnt=Object.freeze({__proto__:null,json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var xnt=Object.freeze({__proto__:null,json:[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Nnt=Object.freeze({__proto__:null,json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}]});class $nt{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const t=[].concat(...[snt,ont,int,ant,unt,cnt,lnt,fnt,hnt,pnt,dnt,mnt,ynt,gnt,bnt,wnt,vnt,xnt,Nnt].map((t=>t.json)));this.opMappers=t.reduce(((t,e)=>(t[e.tfOpName]=e,t)),{})}transformGraph(t,e={}){const n=t.node,r=[],s=[],o=[],i=n.reduce(((t,e)=>(t[e.name]=this.mapNode(e),e.op.startsWith("Placeholder")?r.push(t[e.name]):"Const"===e.op?s.push(t[e.name]):null!=e.input&&0!==e.input.length||o.push(t[e.name]),t)),{});let a=[];const u=[];let c={},l={};null!=e&&(c=this.mapSignatureEntries(e.inputs),l=this.mapSignatureEntries(e.outputs));const f=Object.keys(i);f.forEach((t=>{const e=i[t];e.inputNames.forEach(((t,n)=>{const[r,,s]=Qet(t),o=i[r];if(null!=o.outputs){const t=o.outputs.indexOf(s);if(-1!==t){const s=`${r}:${t}`;e.inputNames[n]=s}}e.inputs.push(o),o.children.push(e)}))})),0===Object.keys(l).length?f.forEach((t=>{const e=i[t];0===e.children.length&&u.push(e)})):Object.keys(l).forEach((t=>{const[e]=Qet(t),n=i[e];null!=n&&(n.signatureKey=l[t],u.push(n))})),Object.keys(c).length>0?Object.keys(c).forEach((t=>{const[e]=Qet(t),n=i[e];n&&(n.signatureKey=c[t],a.push(n))})):a=r;let h={};null!=t.library&&null!=t.library.function&&(h=t.library.function.reduce(((t,e)=>(t[e.signature.name]=this.mapFunction(e),t)),{}));const p={nodes:i,inputs:a,outputs:u,weights:s,placeholders:r,signature:e,functions:h};return o.length>0&&(p.initNodes=o),p}mapSignatureEntries(t){return Object.keys(t||{}).reduce(((e,n)=>(e[t[n].name]=n,e)),{})}mapNode(t){const e=Jet(t.op)||this.opMappers[t.op]||{};null==t.attr&&(t.attr={});const n={name:t.name,op:t.op,category:e.category,inputNames:(t.input||[]).map((t=>t.startsWith("^")?t.slice(1):t)),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr,outputs:e.outputs};return null!=e.inputs&&(n.inputParams=e.inputs.reduce(((t,e)=>(t[e.name]={type:e.type,inputIndexStart:e.start,inputIndexEnd:e.end},t)),{})),null!=e.attrs&&(n.attrParams=e.attrs.reduce(((e,n)=>{const r=n.type;let s;switch(n.type){case"string":s=Snt(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Snt(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":s=Dnt(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Dnt(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":s=Tnt(t.attr,n.tfName,n.defaultValue||0),void 0===s&&n.tfDeprecatedName&&(s=Tnt(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":s=Rnt(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Rnt(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":s=_nt(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=_nt(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":s=Lnt(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Lnt(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":s=Mnt(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Mnt(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":s=Fnt(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Fnt(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":s=Cnt(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Cnt(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":s=Ont(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Ont(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":s=Ant(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Ant(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${n.type} for op: ${t.op}`)}return e[n.name]={value:s,type:r},e}),{})),n}mapFunction(t){const e=t.nodeDef,n=[];let r={};null!=e&&(r=e.reduce(((t,e)=>(t[e.name]=this.mapNode(e),"Const"===e.op&&n.push(t[e.name]),t)),{}));const s=[],o=[];t.signature.inputArg.forEach((t=>{const[e]=Qet(t.name),n={name:e,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:knt(t.type),type:"dtype"}},children:[]};n.signatureKey=t.name,s.push(n),r[e]=n}));Object.keys(r).forEach((t=>{const e=r[t];e.inputNames.forEach(((t,n)=>{const[s,,o]=Qet(t),i=r[s];if(null!=i.outputs){const t=i.outputs.indexOf(o);if(-1!==t){const r=`${s}:${t}`;e.inputNames[n]=r}}e.inputs.push(i),i.children.push(e)}))}));const i=t.ret;t.signature.outputArg.forEach((t=>{const[e,n]=Qet(i[t.name]),s=r[e];null!=s&&(s.defaultOutput=n,o.push(s))}));const a=this.mapArgsToSignature(t);return{nodes:r,inputs:s,outputs:o,weights:n,placeholders:[],signature:a}}mapArgsToSignature(t){return{methodName:t.signature.name,inputs:t.signature.inputArg.reduce(((t,e)=>(t[e.name]=this.mapArgToTensorInfo(e),t)),{}),outputs:t.signature.outputArg.reduce(((e,n)=>(e[n.name]=this.mapArgToTensorInfo(n,t.ret),e)),{})}}mapArgToTensorInfo(t,e){let n=t.name;return null!=e&&(n=e[n]),{name:n,dtype:t.type}}}function Ent(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):function(t){const e=r1().global;return void 0!==e.atob?e.atob(t):new $3(t,"base64").toString()}(t);return e?n:n.toLowerCase()}function Snt(t,e,n,r=!1){const s=t[e];return null!=s?Ent(s.s,r):n}function _nt(t,e,n){const r=t[e];return r?r.b:n}function Tnt(t,e,n){const r=t[e]||{},s=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof s?s:parseInt(s,10)}function knt(t){switch("string"==typeof t&&(t=Het[t]),t){case Het.DT_FLOAT:case Het.DT_HALF:return"float32";case Het.DT_INT32:case Het.DT_INT64:case Het.DT_INT8:case Het.DT_UINT8:return"int32";case Het.DT_BOOL:return"bool";case Het.DT_DOUBLE:return"float32";case Het.DT_STRING:return"string";default:return null}}function Ant(t,e,n){const r=t[e];return r&&r.func?r.func.name:n}function Cnt(t,e,n){const r=t[e];return r&&r.type?knt(r.type):n}function Ont(t,e,n){const r=t[e];return r&&r.list&&r.list.type?r.list.type.map((t=>knt(t))):n}function Int(t){if(!t.unknownRank)return null!=t.dim?t.dim.map((t=>"number"==typeof t.size?t.size:parseInt(t.size,10))):[]}function Mnt(t,e,n){const r=t[e];return r&&r.shape?Int(r.shape):n}function Rnt(t,e,n){const r=t[e];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((t=>"number"==typeof t?t:parseInt(t,10))):n}function Dnt(t,e,n,r=!1){const s=t[e];return s&&s.list&&s.list.s?s.list.s.map((t=>Ent(t,r))):n}function Fnt(t,e,n){const r=t[e];return r&&r.list&&r.list.shape?r.list.shape.map((t=>Int(t))):n}function Lnt(t,e,n){const r=t[e];return r&&r.list&&r.list.b?r.list.b:n}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pnt{constructor(t,e,n){this.node=t,this.tensorMap=e,this.context=n,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((t=>this.getInput(t))),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce(((t,e)=>(t[e]=this.getAttr(e),t)),{}))}getInput(t){return Zet(t,this.tensorMap,this.context)}getAttr(t,e){const n=this.node.rawAttrs[t];if(null!=n.tensor)return Zet(t,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return Tnt(this.node.rawAttrs,t,e);if(null!=n.s)return Snt(this.node.rawAttrs,t,e);if(null!=n.b)return _nt(this.node.rawAttrs,t,e);if(null!=n.shape)return Mnt(this.node.rawAttrs,t,e);if(null!=n.type)return Cnt(this.node.rawAttrs,t,e);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return Rnt(this.node.rawAttrs,t,e);if(null!=n.list.s)return Dnt(this.node.rawAttrs,t,e);if(null!=n.list.shape)return Fnt(this.node.rawAttrs,t,e);if(null!=n.list.b)return Lnt(this.node.rawAttrs,t,e);if(null!=n.list.type)return Ont(this.node.rawAttrs,t,e)}return e}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Bnt(t,e,n=""){if("number"!=typeof t&&"number"!=typeof e){S0(t.length===e.length,(()=>n+` Shapes ${t} and ${e} must match`));for(let r=0;r<t.length;r++){const s=t[r],o=e[r];S0(s<0||o<0||s===o,(()=>n+` Shapes ${t} and ${e} must match`))}}}function Vnt(t){return"number"!=typeof t&&!t.some((t=>t<0))}function znt(t,e,n){let r=Wnt(t,n);const s=!Vnt(r);if(s&&0===e.length)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(s&&e.forEach((t=>{r=Wnt(t.shape,r)})),!Vnt(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function Wnt(t,e){if("number"==typeof t)return e;if("number"==typeof e)return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let r=0;r<t.length;++r){const s=t[r],o=e[r];if(s>=0&&o>=0&&s!==o)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[r]=s>=0?s:o}return n}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Unt{constructor(t,e,n,r,s,o,i){this.name=t,this.dtype=e,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=s,this.dynamicSize=o,this.clearAfterRead=i,this.tensors=[],this.closed_=!1,this.idTensor=L8(0),$6(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.tensor.id)||e.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||t>=this.size())throw new Error(`Tried to read from index ${t}, but array size is: ${this.size()}`);const e=this.tensors[t];if(e.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${t} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor}readMany(t){return t.map((t=>this.read(t)))}write(t,e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error(`Tried to write to index ${t}, but array is not resizeable and size is: ${this.maxSize}`);const n=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t},\n          because the value dtype is ${e.dtype}, but TensorArray dtype is ${this.dtype}.`);if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=e.shape),Bnt(this.elementShape,e.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${t}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been written.`);n.tensor=e,$6(e),n.written=!0,this.tensors[t]=n}writeMany(t,e){if(t.length!==e.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${t.length} is not the same as tensors size: ${e.length}.`);t.forEach(((t,n)=>this.write(t,e[n])))}gather(t,e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${e}`);if(t)t=t.slice(0,this.size());else{t=[];for(let e=0;e<this.size();e++)t.push(e)}if(0===t.length)return d4([],[0].concat(this.elementShape));const n=this.readMany(t);return Bnt(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),q7(n,0)}concat(t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${t}`);if(0===this.size())return d4([],[0].concat(this.elementShape));const e=[];for(let t=0;t<this.size();t++)e.push(t);const n=this.readMany(e);return Bnt(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),W5(n,0)}scatter(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);const n=Math.max(...t);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(t,ntt(e,0))}split(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);let n=0;const r=t.map((t=>(n+=t,n)));if(n!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${n}, and tensor's shape is: ${e.shape}`);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${t.length}), and the TensorArray is not marked as dynamically resizeable`);const s=0===n?0:e.size/n,o=[];x6((()=>{e=B5(e,[1,n,s]);for(let n=0;n<t.length;++n){const i=[0,0===n?0:r[n-1],0],a=[1,t[n],s];o[n]=B5(j5(e,i,a),this.elementShape)}return o}));const i=[];for(let e=0;e<t.length;e++)i[e]=e;this.writeMany(i,o)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jnt{constructor(t,e,n,r=-1){this.tensors=t,this.elementShape=e,this.elementDtype=n,null!=t&&t.forEach((t=>{if(n!==t.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${t.dtype}`);Bnt(e,t.shape,"TensorList shape mismatch: "),$6(t)})),this.idTensor=L8(0),this.maxNumElements=r,$6(this.idTensor)}get id(){return this.idTensor.id}copy(){return new jnt([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.id)||e.dispose()})),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,e,n=-1){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(-1!==n&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);Bnt(t,this.elementShape,"TensorList shape mismatch: ");const r=znt(this.elementShape,this.tensors,t);return x6((()=>{const t=this.tensors.map((t=>B5(t,r)));return q7(t,0)}))}popBack(t,e){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=znt(this.elementShape,this.tensors,t),r=this.tensors.pop();return Bnt(r.shape,t,"TensorList shape mismatch: "),B5(r,n)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(Bnt(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");$6(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);const e=new jnt([],this.elementShape,this.elementDtype,this.maxNumElements);e.tensors.length=t;for(let n=0;n<Math.min(this.tensors.length,t);++n)e.tensors[n]=this.tensors[n];return e}getItem(t,e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(null==this.tensors[t])throw new Error(`element at index ${t} is null.`);Bnt(this.tensors[t].shape,e,"TensorList shape mismatch: ");const r=znt(this.elementShape,this.tensors,e);return B5(this.tensors[t],r)}setItem(t,e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(t<0||-1!==this.maxNumElements&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);Bnt(this.elementShape,e.shape,"TensorList shape mismatch: "),$6(e),this.tensors[t]=e}gather(t,e,n){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);Bnt(this.elementShape,n,"TensorList shape mismatch: "),t=t.slice(0,this.size());const r=znt(this.elementShape,this.tensors,n);return 0===t.length?d4([],[0].concat(r)):x6((()=>{const e=t.map((t=>B5(this.tensors[t],r)));return q7(e,0)}))}concat(t,e){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);Bnt(this.elementShape,e,"TensorList shape mismatch: ");const n=znt(this.elementShape,this.tensors,e);return 0===this.size()?d4([],[0].concat(n)):x6((()=>{const t=this.tensors.map((t=>B5(t,n)));return W5(t,0)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Gnt=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const r=Yet("thenBranch",t,e,n),s=Yet("elseBranch",t,e,n),o=Yet("cond",t,e,n),i=Yet("args",t,e,n);return(await o.data())[0]?n.functionMap[r].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap):n.functionMap[s].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=Yet("body",t,e,n),s=Yet("cond",t,e,n),o=Yet("args",t,e,n),i=await n.functionMap[s].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap),a=o.map((t=>t.id));let u=await i[0].data();i.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||t.dispose()}));let c=o;for(;u[0];){const t=c;c=await n.functionMap[r].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);const e=c.map((t=>t.id));t.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}));const o=await n.functionMap[s].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);u=await o[0].data(),o.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}))}return c}case"LoopCond":return[rnt(Yet("pred",t,e,n))];case"Switch":{const r=Yet("pred",t,e,n);let s=Yet("data",t,e,n);return s.kept||(s=rnt(s)),(await r.data())[0]?[void 0,s]:[s,void 0]}case"Merge":{const r=t.inputNames.find((t=>void 0!==Zet(t,e,n)));if(r){return[rnt(Zet(r,e,n))]}return}case"Enter":{const r=Yet("frameName",t,e,n),s=Yet("tensor",t,e,n);return n.enterFrame(r),[rnt(s)]}case"Exit":{const r=Yet("tensor",t,e,n);return n.exitFrame(),[rnt(r)]}case"NextIteration":{const r=Yet("tensor",t,e,n);return n.nextIteration(),[rnt(r)]}case"TensorArrayV3":{const r=Yet("size",t,e,n),s=Yet("dtype",t,e,n),o=Yet("elementShape",t,e,n),i=Yet("dynamicSize",t,e,n),a=Yet("clearAfterRead",t,e,n),u=Yet("identicalElementShapes",t,e,n),c=Yet("name",t,e,n),l=new Unt(c,s,r,o,u,i,a);return n.addTensorArray(l),[l.idTensor,L8(1)]}case"TensorArrayWriteV3":{const r=Yet("tensorArrayId",t,e,n),s=Yet("index",t,e,n),o=Yet("tensor",t,e,n),i=n.getTensorArray(r.id);return i.write(s,o),[i.idTensor]}case"TensorArrayReadV3":{const r=Yet("tensorArrayId",t,e,n),s=Yet("index",t,e,n);return[n.getTensorArray(r.id).read(s)]}case"TensorArrayGatherV3":{const r=Yet("tensorArrayId",t,e,n),s=Yet("indices",t,e,n),o=Yet("dtype",t,e,n);return[n.getTensorArray(r.id).gather(s,o)]}case"TensorArrayScatterV3":{const r=Yet("tensorArrayId",t,e,n),s=Yet("indices",t,e,n),o=Yet("tensor",t,e,n),i=n.getTensorArray(r.id);return i.scatter(s,o),[i.idTensor]}case"TensorArrayConcatV3":{const r=Yet("tensorArrayId",t,e,n),s=n.getTensorArray(r.id),o=Yet("dtype",t,e,n);return[s.concat(o)]}case"TensorArraySplitV3":{const r=Yet("tensorArrayId",t,e,n),s=Yet("tensor",t,e,n),o=Yet("lengths",t,e,n),i=n.getTensorArray(r.id);return i.split(o,s),[i.idTensor]}case"TensorArraySizeV3":{const r=Yet("tensorArrayId",t,e,n);return[L8(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{const r=Yet("tensorArrayId",t,e,n),s=n.getTensorArray(r.id);return s.clearAndClose(),[s.idTensor]}case"TensorListSetItem":{const r=Yet("tensorListId",t,e,n),s=Yet("index",t,e,n),o=Yet("tensor",t,e,n),i=n.getTensorList(r.id);return i.setItem(s,o),[i.idTensor]}case"TensorListGetItem":{const r=Yet("tensorListId",t,e,n),s=Yet("index",t,e,n),o=Yet("elementShape",t,e,n),i=Yet("elementDType",t,e,n);return[n.getTensorList(r.id).getItem(s,o,i)]}case"TensorListScatterV2":case"TensorListScatter":{const r=Yet("indices",t,e,n),s=function(t,e,n,r){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const s=Math.max(...e);if(null!=r&&-1!==r&&s>=r)throw new Error(`Max index must be < array size (${s}  vs. ${r})`);const o=new jnt([],n,t.dtype,r),i=ntt(t,0);return e.forEach(((t,e)=>{o.setItem(t,i[e])})),o}(Yet("tensor",t,e,n),r,Yet("elementShape",t,e,n),Yet("numElements",t,e,n));return n.addTensorList(s),[s.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=Yet("elementShape",t,e,n),s=Yet("elementDType",t,e,n);let o;o="TensorListReserve"===t.op?"numElements":"maxNumElements";const i=function(t,e,n){return new jnt([],t,e,n)}(r,s,Yet(o,t,e,n));return n.addTensorList(i),[i.idTensor]}case"TensorListGather":{const r=Yet("tensorListId",t,e,n),s=Yet("indices",t,e,n),o=Yet("elementShape",t,e,n),i=Yet("elementDType",t,e,n);return[n.getTensorList(r.id).gather(s,i,o)]}case"TensorListStack":{const r=Yet("tensorListId",t,e,n),s=Yet("elementShape",t,e,n),o=Yet("elementDType",t,e,n),i=Yet("numElements",t,e,n);return[n.getTensorList(r.id).stack(s,o,i)]}case"TensorListFromTensor":{const r=function(t,e,n){const r=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);Bnt(t.shape.slice(1),e,"TensorList shape mismatch: ");const s=ntt(t);return new jnt(s,e,r)}(Yet("tensor",t,e,n),Yet("elementShape",t,e,n),Yet("elementDType",t,e,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const r=Yet("tensorListId",t,e,n),s=n.getTensorList(r.id),o=Yet("dtype",t,e,n),i=Yet("elementShape",t,e,n);return[s.concat(o,i)]}case"TensorListPushBack":{const r=Yet("tensorListId",t,e,n),s=Yet("tensor",t,e,n),o=n.getTensorList(r.id);return o.pushBack(s),[o.idTensor]}case"TensorListPopBack":{const r=Yet("tensorListId",t,e,n),s=Yet("elementShape",t,e,n),o=Yet("elementDType",t,e,n);return[n.getTensorList(r.id).popBack(s,o)]}case"TensorListSplit":{const r=Yet("tensor",t,e,n),s=Yet("elementShape",t,e,n),o=function(t,e,n){let r=0;const s=e.map((t=>(r+=t,r)));if(r!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${r}, and tensor's shape is: ${t.shape}`);const o=Wnt(t.shape.slice(1),n),i=0===r?0:t.size/r,a=x6((()=>{const n=[];t=B5(t,[1,r,i]);for(let r=0;r<e.length;++r){const a=[0,0===r?0:s[r-1],0],u=[1,e[r],i];n[r]=B5(j5(t,a,u),o)}return t.dispose(),n})),u=new jnt([],n,t.dtype,e.length);for(let t=0;t<a.length;t++)u.setItem(t,a[t]);return u}(r,Yet("lengths",t,e,n),s);return n.addTensorList(o),[o.idTensor]}case"TensorListLength":{const r=Yet("tensorListId",t,e,n);return[L8(n.getTensorList(r.id).size(),"int32")]}case"TensorListResize":{const r=Yet("tensorListId",t,e,n),s=Yet("size",t,e,n),o=n.getTensorList(r.id).resize(s);return n.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qnt(t,e,n){const[r,s]=Yet("fusedOps",t,e,n),o="biasadd"===r,i=!o,a="prelu"===s,u="fusedbatchnorm"===r,c=Yet("numArgs",t,e,n);if(o){if(a&&2!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&o&&1!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(u)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const l=Yet("strides",t,e,n),f=nnt(t,e,n),h=Yet("dataFormat",t,e,n).toUpperCase(),p=Yet("dilations",t,e,n);let[d,m]=Yet("args",t,e,n);i&&(m=d,d=void 0);return{stride:l,pad:f,dataFormat:h,dilations:p,biasArg:d,preluArg:m,activationFunc:s,leakyreluAlpha:Yet("leakyreluAlpha",t,e,n)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Hnt(t,e,n){return{boxes:Yet("boxes",t,e,n),scores:Yet("scores",t,e,n),maxOutputSize:Yet("maxOutputSize",t,e,n),iouThreshold:Yet("iouThreshold",t,e,n),scoreThreshold:Yet("scoreThreshold",t,e,n),softNmsSigma:Yet("softNmsSigma",t,e,n)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Knt{constructor(t,e){this.keyDType=t,this.valueDType=e,this.handle=L8(0),this.tensorMap=new Map,$6(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return L8(this.size(),"int32")}async import(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),x6((()=>{const t=ntt(e),r=n.length,s=t.length;S0(r===s,(()=>`The number of elements doesn't match, keys has ${r} elements, the values has ${s} elements.`));for(let e=0;e<r;e++){const r=n[e],s=t[e];$6(s),this.tensorMap.set(r,s)}return this.handle}))}async find(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return x6((()=>{const t=[];for(let r=0;r<n.length;r++){const s=n[r],o=this.findWithDefault(s,e);t.push(o)}return q7(t)}))}findWithDefault(t,e){const n=this.tensorMap.get(t);return null!=n?n:e}checkKeyAndValueTensor(t,e){if(t.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${t.dtype}`);if(e.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${e.dtype}`)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Xnt(t,e,n,r){const s=((t,e,n)=>{switch(t.category){case"arithmetic":return x6((()=>((t,e,n)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[l5(Yet("a",t,e,n),Yet("b",t,e,n))];case"AddN":return[g5(Yet("tensors",t,e,n))];case"FloorMod":case"Mod":return[M9(Yet("a",t,e,n),Yet("b",t,e,n))];case"Mul":return[p5(Yet("a",t,e,n),Yet("b",t,e,n))];case"RealDiv":case"Div":return[h5(Yet("a",t,e,n),Yet("b",t,e,n))];case"DivNoNan":return[_8(Yet("a",t,e,n),Yet("b",t,e,n))];case"FloorDiv":return[f5(Yet("a",t,e,n),Yet("b",t,e,n))];case"Sub":return[m9(Yet("a",t,e,n),Yet("b",t,e,n))];case"Minimum":return[O9(Yet("a",t,e,n),Yet("b",t,e,n))];case"Maximum":return[T9(Yet("a",t,e,n),Yet("b",t,e,n))];case"Pow":return[F8(Yet("a",t,e,n),Yet("b",t,e,n))];case"SquaredDifference":return[j7(Yet("a",t,e,n),Yet("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"basic_math":return x6((()=>((t,e,n)=>{switch(t.op){case"Abs":case"ComplexAbs":return[d5(Yet("x",t,e,n))];case"Acos":return[m5(Yet("x",t,e,n))];case"Acosh":return[y5(Yet("x",t,e,n))];case"Asin":return[N5(Yet("x",t,e,n))];case"Asinh":return[$5(Yet("x",t,e,n))];case"Atan":return[E5(Yet("x",t,e,n))];case"Atan2":return[S5(Yet("x",t,e,n),Yet("y",t,e,n))];case"Atanh":return[_5(Yet("x",t,e,n))];case"Ceil":return[e8(Yet("x",t,e,n))];case"Complex":return[h4(Yet("real",t,e,n),Yet("imag",t,e,n))];case"Cos":return[d8(Yet("x",t,e,n))];case"Cosh":return[m8(Yet("x",t,e,n))];case"Elu":return[A8(Yet("x",t,e,n))];case"Erf":return[C8(Yet("x",t,e,n))];case"Exp":return[j8(Yet("x",t,e,n))];case"Expm1":return[q8(Yet("x",t,e,n))];case"Floor":return[J8(Yet("x",t,e,n))];case"Log":return[u9(Yet("x",t,e,n))];case"Log1p":return[c9(Yet("x",t,e,n))];case"Imag":return[E6(Yet("x",t,e,n))];case"Neg":return[S6(Yet("x",t,e,n))];case"Reciprocal":return[b7(Yet("x",t,e,n))];case"Real":return[_6(Yet("x",t,e,n))];case"Relu":return[w7(Yet("x",t,e,n))];case"Round":return[_7(Yet("x",t,e,n))];case"Selu":return[k7(Yet("x",t,e,n))];case"Sigmoid":return[U5(Yet("x",t,e,n))];case"Sin":return[I7(Yet("x",t,e,n))];case"Sign":return[O7(Yet("x",t,e,n))];case"Sinh":return[M7(Yet("x",t,e,n))];case"Softplus":return[p9(Yet("x",t,e,n))];case"Sqrt":return[P8(Yet("x",t,e,n))];case"Square":return[B8(Yet("x",t,e,n))];case"Tanh":return[G5(Yet("x",t,e,n))];case"Tan":return[X7(Yet("x",t,e,n))];case"ClipByValue":return[n8(Yet("x",t,e,n),Yet("clipValueMin",t,e,n),Yet("clipValueMax",t,e,n))];case"Relu6":return[v7(Yet("x",t,e,n))];case"Rsqrt":return[T7(Zet(t.inputNames[0],e,n))];case"Prod":return[K9(Yet("x",t,e,n),Yet("axes",t,e,n))];case"LeakyRelu":return[r9(Yet("x",t,e,n),Yet("alpha",t,e,n))];case"Prelu":return[H9(Yet("x",t,e,n),Yet("alpha",t,e,n))];case"IsNan":return[n9(Zet(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"control":return Gnt(t,e,n);case"convolution":return x6((()=>((t,e,n)=>{switch(t.op){case"Conv1D":{const r=Yet("stride",t,e,n),s=Yet("pad",t,e,n),o=Yet("dataFormat",t,e,n).toUpperCase(),i=Yet("dilation",t,e,n);return[u8(Yet("x",t,e,n),Yet("filter",t,e,n),r,s,o,i)]}case"Conv2D":{const r=Yet("strides",t,e,n),s=nnt(t,e,n),o=Yet("dataFormat",t,e,n).toUpperCase(),i=Yet("dilations",t,e,n);return[a8(Yet("x",t,e,n),Yet("filter",t,e,n),[r[1],r[2]],s,o,[i[1],i[2]])]}case"_FusedConv2D":{const{stride:r,pad:s,dataFormat:o,dilations:i,biasArg:a,preluArg:u,activationFunc:c,leakyreluAlpha:l}=qnt(t,e,n);return[vtt({x:Yet("x",t,e,n),filter:Yet("filter",t,e,n),strides:[r[1],r[2]],pad:s,dataFormat:o,dilations:[i[1],i[2]],bias:a,activation:c,preluActivationWeights:u,leakyreluAlpha:l})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:s,dataFormat:o,dilations:i,biasArg:a,preluArg:u,activationFunc:c,leakyreluAlpha:l}=qnt(t,e,n);return[$tt({x:Yet("x",t,e,n),filter:Yet("filter",t,e,n),strides:[r[1],r[2]],pad:s,dataFormat:o,dilations:[i[1],i[2]],bias:a,activation:c,preluActivationWeights:u,leakyreluAlpha:l})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=Yet("outputShape",t,e,n),s=Yet("strides",t,e,n),o=nnt(t,e,n);return[l8(Yet("x",t,e,n),Yet("filter",t,e,n),r,[s[1],s[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=Yet("strides",t,e,n),s=nnt(t,e,n),o=Yet("dilations",t,e,n),i=Yet("dataFormat",t,e,n).toUpperCase();return[v8(Yet("input",t,e,n),Yet("filter",t,e,n),[r[1],r[2]],s,i,[o[1],o[2]])]}case"Conv3D":{const r=Yet("strides",t,e,n),s=Yet("pad",t,e,n),o=Yet("dataFormat",t,e,n).toUpperCase(),i=Yet("dilations",t,e,n);return[f8(Yet("x",t,e,n),Yet("filter",t,e,n),[r[1],r[2],r[3]],s,o,[i[1],i[2],i[3]])]}case"AvgPool":{const r=Yet("strides",t,e,n),s=Yet("pad",t,e,n),o=Yet("kernelSize",t,e,n);return[V5(Yet("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s)]}case"MaxPool":{const r=Yet("strides",t,e,n),s=Yet("pad",t,e,n),o=Yet("kernelSize",t,e,n);return[E9(Yet("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s)]}case"MaxPoolWithArgmax":{const r=Yet("strides",t,e,n),s=Yet("pad",t,e,n),o=Yet("kernelSize",t,e,n),i=Yet("includeBatchInIndex",t,e,n),{result:a,indexes:u}=_9(Yet("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s,i);return[a,u]}case"AvgPool3D":{const r=Yet("strides",t,e,n),s=Yet("pad",t,e,n),o=Yet("kernelSize",t,e,n);return[z5(Yet("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],s)]}case"MaxPool3D":{const r=Yet("strides",t,e,n),s=Yet("pad",t,e,n),o=Yet("kernelSize",t,e,n);return[S9(Yet("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],s)]}case"Dilation2D":{const r=Yet("strides",t,e,n),s=Yet("pad",t,e,n),o=Yet("dilations",t,e,n),i=r[1],a=r[2],u=o[1],c=o[2];return[N8(Yet("x",t,e,n),Yet("filter",t,e,n),[i,a],s,[u,c],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"creation":return x6((()=>((t,e,n)=>{switch(t.op){case"Fill":{const r=Yet("shape",t,e,n),s=Yet("dtype",t,e,n);return[X8(r,Yet("value",t,e,n),s)]}case"LinSpace":return[i9(Yet("start",t,e,n),Yet("stop",t,e,n),Yet("num",t,e,n))];case"Multinomial":{const r=Yet("logits",t,e,n),s=Yet("numSamples",t,e,n),o=Yet("seed",t,e,n);return[F9(r,s,o)]}case"OneHot":{const r=Yet("indices",t,e,n),s=Yet("depth",t,e,n),o=Yet("onValue",t,e,n),i=Yet("offValue",t,e,n);return[v6(r,s,o,i)]}case"Ones":return[C9(Yet("shape",t,e,n),Yet("dtype",t,e,n))];case"OnesLike":return[P9(Yet("x",t,e,n))];case"RandomUniform":return[y7(Yet("shape",t,e,n),Yet("minval",t,e,n),Yet("maxval",t,e,n),Yet("dtype",t,e,n))];case"Range":return[g7(Yet("start",t,e,n),Yet("stop",t,e,n),Yet("step",t,e,n),Yet("dtype",t,e,n))];case"TruncatedNormal":{const r=Yet("shape",t,e,n),s=Yet("mean",t,e,n),o=Yet("stdDev",t,e,n),i=Yet("seed",t,e,n);return[Q7(r,s,o,Yet("dtype",t,e,n),i)]}case"Zeros":return[A9(Yet("shape",t,e,n),Yet("dtype",t,e,n))];case"ZerosLike":return[S8(Yet("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"dynamic":return(async(t,e,n)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a,softNmsSigma:u}=Hnt(t,e,n),c=await Eet.nonMaxSuppressionWithScoreAsync(r,s,o,i,a,u);return[c.selectedIndices,c.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a}=Hnt(t,e,n),u=Yet("padToMaxOutputSize",t,e,n),c=await Eet.nonMaxSuppressionPaddedAsync(r,s,o,i,a,u);return[c.selectedIndices,c.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a}=Hnt(t,e,n);return[await Eet.nonMaxSuppressionAsync(r,s,o,i,a)]}case"Where":{const r=t6(Yet("condition",t,e,n),"bool"),s=[await ott(r)];return r.dispose(),s}case"ListDiff":return C7(Yet("x",t,e,n),Yet("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n);case"evaluation":return x6((()=>((t,e,n)=>{switch(t.op){case"LowerBound":return[$9(Yet("sortedSequence",t,e,n),Yet("values",t,e,n))];case"TopKV2":{const r=Yet("x",t,e,n),s=Yet("k",t,e,n),o=Yet("sorted",t,e,n),i=Z7(r,s,o);return[i.values,i.indices]}case"UpperBound":return[rtt(Yet("sortedSequence",t,e,n),Yet("values",t,e,n))];case"Unique":{const r=Yet("x",t,e,n),s=ttt(r);return[s.values,s.indices]}case"UniqueV2":{const r=Yet("x",t,e,n),s=Yet("axis",t,e,n),o=ttt(r,s);return[o.values,o.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"image":return x6((()=>((t,e,n)=>{switch(t.op){case"ResizeBilinear":{const r=Yet("images",t,e,n),s=Yet("size",t,e,n),o=Yet("alignCorners",t,e,n),i=Yet("halfPixelCenters",t,e,n);return[Eet.resizeBilinear(r,[s[0],s[1]],o,i)]}case"ResizeNearestNeighbor":{const r=Yet("images",t,e,n),s=Yet("size",t,e,n),o=Yet("alignCorners",t,e,n),i=Yet("halfPixelCenters",t,e,n);return[Eet.resizeNearestNeighbor(r,[s[0],s[1]],o,i)]}case"CropAndResize":{const r=Yet("image",t,e,n),s=Yet("boxes",t,e,n),o=Yet("boxInd",t,e,n),i=Yet("cropSize",t,e,n),a=Yet("method",t,e,n),u=Yet("extrapolationValue",t,e,n);return[Eet.cropAndResize(r,s,o,i,a,u)]}case"ImageProjectiveTransformV3":{const r=Yet("images",t,e,n),s=Yet("transforms",t,e,n),o=Yet("outputShape",t,e,n),i=Yet("fillValue",t,e,n),a=Yet("interpolation",t,e,n),u=Yet("fillMode",t,e,n);return[Eet.transform(r,s,a.toLowerCase(),u.toLowerCase(),i,o)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"graph":return x6((()=>((t,e,n)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const r=Yet("default",t,e,n);return[Zet(t.name,e,n)||r];case"Placeholder":return[Zet(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[rnt(Yet("x",t,e,n))];case"IdentityN":return Yet("x",t,e,n).map((t=>rnt(t)));case"Shape":return[J7(Yet("x",t,e,n).shape,"int32")];case"ShapeN":return Yet("x",t,e,n).map((t=>J7(t.shape)));case"Size":return[L8(Yet("x",t,e,n).size,"int32")];case"Rank":return[L8(Yet("x",t,e,n).rank,"int32")];case"NoOp":return[L8(1)];case"Print":const s=Yet("x",t,e,n),o=Yet("data",t,e,n),i=Yet("message",t,e,n),a=Yet("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(i);for(let t=0;t<o.length;t++)console.log(Array.prototype.slice.call(o[t].dataSync()).slice(0,a));return[s];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"logical":return x6((()=>((t,e,n)=>{switch(t.op){case"Equal":return[$8(Yet("a",t,e,n),Yet("b",t,e,n))];case"NotEqual":return[L9(Yet("a",t,e,n),Yet("b",t,e,n))];case"Greater":return[Z8(Yet("a",t,e,n),Yet("b",t,e,n))];case"GreaterEqual":return[Q8(Yet("a",t,e,n),Yet("b",t,e,n))];case"Less":return[s9(Yet("a",t,e,n),Yet("b",t,e,n))];case"LessEqual":return[o9(Yet("a",t,e,n),Yet("b",t,e,n))];case"LogicalAnd":return[b9(Yet("a",t,e,n),Yet("b",t,e,n))];case"LogicalNot":return[w9(Yet("a",t,e,n))];case"LogicalOr":return[v9(Yet("a",t,e,n),Yet("b",t,e,n))];case"Select":case"SelectV2":return[E8(Yet("condition",t,e,n),Yet("a",t,e,n),Yet("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"matrices":return x6((()=>((t,e,n)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[w6(Yet("a",t,e,n),Yet("b",t,e,n),Yet("transposeA",t,e,n),Yet("transposeB",t,e,n))];case"Einsum":return[k8(Yet("equation",t,e,n),...Yet("tensors",t,e,n))];case"Transpose":return[T6(Yet("x",t,e,n),Yet("perm",t,e,n))];case"_FusedMatMul":const[r,s]=Yet("fusedOps",t,e,n),o="biasadd"===r,i="prelu"===s,a=Yet("numArgs",t,e,n),u=Yet("leakyreluAlpha",t,e,n);if(o){if(i&&2!==a)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!i&&1!==a)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[c,l]=Yet("args",t,e,n);return[Ett({a:Yet("a",t,e,n),b:Yet("b",t,e,n),transposeA:Yet("transposeA",t,e,n),transposeB:Yet("transposeB",t,e,n),bias:c,activation:s,preluActivationWeights:l,leakyreluAlpha:u})];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"normalization":return x6((()=>((t,e,n)=>{switch(t.op){case"EuclideanNorm":return[U8(Yet("x",t,e,n),Yet("axis",t,e,n),Yet("keepDims",t,e,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[K5(Yet("x",t,e,n),Yet("mean",t,e,n),Yet("variance",t,e,n),Yet("offset",t,e,n),Yet("scale",t,e,n),Yet("epsilon",t,e,n))];case"LRN":return[a9(Yet("x",t,e,n),Yet("radius",t,e,n),Yet("bias",t,e,n),Yet("alpha",t,e,n),Yet("beta",t,e,n))];case"Softmax":return[P7(Yet("x",t,e,n))];case"LogSoftmax":return[y9(Yet("x",t,e,n))];case"SparseToDense":return[ctt(Yet("sparseIndices",t,e,n),Yet("outputShape",t,e,n),Yet("sparseValues",t,e,n),Yet("defaultValue",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"reduction":return x6((()=>((t,e,n)=>{switch(t.op){case"Max":{const r=Yet("axis",t,e,n),s=Yet("keepDims",t,e,n);return[R8(Yet("x",t,e,n),r,s)]}case"Mean":{const r=Yet("axis",t,e,n),s=Yet("keepDims",t,e,n);return[k9(Yet("x",t,e,n),r,s)]}case"Min":{const r=Yet("axis",t,e,n),s=Yet("keepDims",t,e,n);return[D8(Yet("x",t,e,n),r,s)]}case"Sum":{const r=Yet("axis",t,e,n),s=Yet("keepDims",t,e,n);return[V8(Yet("x",t,e,n),r,s)]}case"All":{const r=Yet("axis",t,e,n),s=Yet("keepDims",t,e,n);return[b5(Yet("x",t,e,n),r,s)]}case"Any":{const r=Yet("axis",t,e,n),s=Yet("keepDims",t,e,n);return[w5(Yet("x",t,e,n),r,s)]}case"ArgMax":{const r=Yet("axis",t,e,n);return[v5(Yet("x",t,e,n),r)]}case"ArgMin":{const r=Yet("axis",t,e,n);return[x5(Yet("x",t,e,n),r)]}case"Prod":{const r=Yet("axis",t,e,n),s=Yet("keepDims",t,e,n);return[K9(Yet("x",t,e,n),r,s)]}case"Cumprod":{const r=Yet("axis",t,e,n),s=Yet("exclusive",t,e,n),o=Yet("reverse",t,e,n);return[y8(Yet("x",t,e,n),r,s,o)]}case"Cumsum":{const r=Yet("axis",t,e,n),s=Yet("exclusive",t,e,n),o=Yet("reverse",t,e,n);return[g8(Yet("x",t,e,n),r,s,o)]}case"Bincount":const r=Yet("x",t,e,n),s=Yet("weights",t,e,n),o=Yet("size",t,e,n);return[Z5(r,s,o)];case"DenseBincount":{const r=Yet("x",t,e,n),s=Yet("weights",t,e,n),o=Yet("size",t,e,n),i=Yet("binaryOutput",t,e,n);return[b8(r,s,o,i)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"slice_join":return x6((()=>((t,e,n)=>{switch(t.op){case"ConcatV2":case"Concat":{const r=Yet("n",t,e,n),s=Yet("axis",t,e,n);let o=Yet("tensors",t,e,n);return o=o.slice(0,r),[W5(o,s)]}case"Gather":{const r=Yet("x",t,e,n),s=Yet("indices",t,e,n);return[Y8(r,t6(s,"int32"),0)]}case"GatherV2":{const r=Yet("axis",t,e,n),s=Yet("batchDims",t,e,n),o=Yet("x",t,e,n),i=Yet("indices",t,e,n);return[Y8(o,t6(i,"int32"),r,s)]}case"Reverse":{const r=Yet("dims",t,e,n),s=[];for(let t=0;t<r.length;t++)r[t]&&s.push(t);const o=Yet("x",t,e,n);return[x7(o,s)]}case"ReverseV2":{const r=Yet("axis",t,e,n),s=Yet("x",t,e,n);return[x7(s,r)]}case"Slice":{const r=Yet("begin",t,e,n),s=Yet("size",t,e,n);return[j5(Yet("x",t,e,n),r,s)]}case"StridedSlice":{const r=Yet("begin",t,e,n),s=Yet("end",t,e,n),o=Yet("strides",t,e,n),i=Yet("beginMask",t,e,n),a=Yet("endMask",t,e,n),u=Yet("ellipsisMask",t,e,n),c=Yet("newAxisMask",t,e,n),l=Yet("shrinkAxisMask",t,e,n),f=Yet("x",t,e,n);return[K7(f,r,s,o,i,a,u,c,l)]}case"Pack":return x6((()=>{const r=Yet("axis",t,e,n),s=Yet("tensors",t,e,n),o=s[0].shape,i=G7(s[0]).shape,a=s.map((t=>{const e=C0(t.shape,o);if(!e&&!C0(G7(t).shape,i))throw new Error("the input tensors shape does not match");return e?t:B5(t,o)}));return[q7(a,r)]}));case"Unpack":{const r=Yet("axis",t,e,n),s=Yet("tensor",t,e,n);return ntt(s,r)}case"Tile":{const r=Yet("reps",t,e,n);return[H8(Yet("x",t,e,n),r)]}case"Split":case"SplitV":{const r=Yet("axis",t,e,n),s=Yet("numOrSizeSplits",t,e,n),o=Yet("x",t,e,n);return W7(o,s,r)}case"ScatterNd":{const r=Yet("indices",t,e,n),s=Yet("values",t,e,n),o=Yet("shape",t,e,n);return[utt(r,s,o)]}case"GatherNd":{const r=Yet("x",t,e,n),s=Yet("indices",t,e,n);return[ltt(r,s)]}case"SparseToDense":{const r=Yet("sparseIndices",t,e,n),s=Yet("outputShape",t,e,n),o=Yet("sparseValues",t,e,n),i=Yet("defaultValue",t,e,n);return[ctt(r,o,s,o.dtype===i.dtype?i:t6(i,o.dtype))]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"sparse":return x6((()=>((t,e,n)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:s,emptyRowIndicator:o,reverseIndexMap:i}=ket.sparseFillEmptyRows(Yet("indices",t,e,n),Yet("values",t,e,n),Yet("denseShape",t,e,n),Yet("defaultValue",t,e,n));return[r,s,o,i]}case"SparseReshape":{const{outputIndices:r,outputShape:s}=ket.sparseReshape(Yet("inputIndices",t,e,n),Yet("inputShape",t,e,n),Yet("newShape",t,e,n));return[r,s]}case"SparseSegmentMean":return[ket.sparseSegmentMean(Yet("data",t,e,n),Yet("indices",t,e,n),Yet("segmentIds",t,e,n))];case"SparseSegmentSum":return[ket.sparseSegmentSum(Yet("data",t,e,n),Yet("indices",t,e,n),Yet("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"spectral":return x6((()=>((t,e,n)=>{switch(t.op){case"FFT":return[B7(Yet("x",t,e,n))];case"IFFT":return[V7(Yet("x",t,e,n))];case"RFFT":return[U7(Yet("x",t,e,n))];case"IRFFT":return[z7(Yet("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"string":return x6((()=>((t,e,n)=>{switch(t.op){case"StringNGrams":{const{nGrams:r,nGramsSplits:s}=Aet.stringNGrams(Yet("data",t,e,n),Yet("dataSplits",t,e,n),Yet("separator",t,e,n),Yet("nGramWidths",t,e,n),Yet("leftPad",t,e,n),Yet("rightPad",t,e,n),Yet("padWidth",t,e,n),Yet("preserveShortSequences",t,e,n));return[r,s]}case"StringSplit":{const{indices:r,values:s,shape:o}=Aet.stringSplit(Yet("input",t,e,n),Yet("delimiter",t,e,n),Yet("skipEmpty",t,e,n));return[r,s,o]}case"StringToHashBucketFast":return[Aet.stringToHashBucketFast(Yet("input",t,e,n),Yet("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"transformation":return x6((()=>((t,e,n)=>{switch(t.op){case"Cast":return[t6(Yet("x",t,e,n),Yet("dtype",t,e,n))];case"ExpandDims":{const r=Yet("axis",t,e,n);return[G8(Yet("x",t,e,n),r)]}case"Squeeze":{const r=Yet("axis",t,e,n);return[G7(Yet("x",t,e,n),r)]}case"Reshape":return[B5(Yet("x",t,e,n),Yet("shape",t,e,n))];case"MirrorPad":return[I9(Yet("x",t,e,n),Yet("padding",t,e,n),Yet("mode",t,e,n))];case"PadV2":case"Pad":return[V9(Yet("x",t,e,n),Yet("padding",t,e,n),Yet("constantValue",t,e,n))];case"SpaceToBatchND":{const r=Yet("blockShape",t,e,n),s=Yet("paddings",t,e,n);return[G9(Yet("x",t,e,n),r,s)]}case"BatchToSpaceND":{const r=Yet("blockShape",t,e,n),s=Yet("crops",t,e,n);return[H5(Yet("x",t,e,n),r,s)]}case"DepthToSpace":{const r=Yet("blockSize",t,e,n),s=Yet("dataFormat",t,e,n).toUpperCase();return[w8(Yet("x",t,e,n),r,s)]}case"BroadcastTo":return[t8(Yet("x",t,e,n),Yet("shape",t,e,n))];case"BroadcastArgs":return[Q5(Yet("s0",t,e,n),Yet("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"hash_table":return(async(t,e,n,r)=>{switch(t.op){case"HashTable":case"HashTableV2":{const s=Yet("keyDType",t,e,n),o=Yet("valueDType",t,e,n),i=new Knt(s,o);return r.addHashTable(t.name,i),[i.handle]}case"LookupTableImport":case"LookupTableImportV2":{const s=Yet("tableHandle",t,e,n,r),o=Yet("keys",t,e,n),i=Yet("values",t,e,n),a=r.getHashTableById(s.id);return[await a.import(o,i)]}case"LookupTableFind":case"LookupTableFindV2":{const s=Yet("tableHandle",t,e,n,r),o=Yet("keys",t,e,n),i=Yet("defaultValue",t,e,n),a=r.getHashTableById(s.id);return[await a.find(o,i)]}case"LookupTableSize":case"LookupTableSizeV2":{const s=Yet("tableHandle",t,e,n,r);return[r.getHashTableById(s.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n,r);case"custom":const s=Jet(t.op);if(s&&s.customExecutor)return s.customExecutor(new Pnt(t,e,n));throw TypeError(`Custom op ${t.op} is not registered.`);default:throw TypeError(`Unknown op '${t.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return t1(s)?s.then((t=>[].concat(t))):[].concat(s)}class Jnt{constructor(t={},e={},n={},r={}){this.weightMap=t,this.tensorArrayMap=e,this.tensorListMap=n,this.functionMap=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(t,e){return{id:t,frameName:e,iterationId:0}}set currentContext(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const t=[];for(let e=0;e<this.contexts.length-1;e++){const n=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(n))}t.push(""),this._currentContextIds=t}contextIdforContexts(t){return t?t.map((t=>0===t.id&&0===t.iterationId?"":`${t.frameName}-${t.iterationId}`)).join("/"):""}enterFrame(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(t){return this.weightMap[t]}addTensorArray(t){this.tensorArrayMap[t.id]=t}getTensorArray(t){return this.tensorArrayMap[t]}addTensorList(t){this.tensorListMap[t.id]=t}getTensorList(t){return this.tensorListMap[t]}dispose(t){for(const e in this.tensorArrayMap)this.tensorArrayMap[e].clearAndClose(t);for(const e in this.tensorListMap)this.tensorListMap[e].clearAndClose(t)}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ynt(t,e,n,r){const s=new Set,o=[];let i=null,a=null;const u=new Set,c=Object.keys(t).map((t=>ent(t)[0]));let l=[];null!=r&&(l=r.map((t=>ent(t.name)[0])));const f=[...e];for(;f.length>0;){const t=f.pop();(ert(t)||nrt(t)||rrt(t))&&null==i&&(i=t,a=i.children.map((t=>t.name)).filter((t=>s.has(t)))),s.add(t.name),null==n[t.name]&&(-1===c.indexOf(t.name)&&-1===l.indexOf(t.name)&&(0!==t.inputs.length?t.inputs.forEach((t=>{u.has(t.name)||(u.add(t.name),f.push(t))})):o.push(t.name)))}return{inputs:t,outputs:e,usedNodes:s,missingInputs:o,dynamicNode:i,syncInputs:a}}const Znt=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],Qnt=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],trt=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function ert(t){return Znt.indexOf(t.op)>=0}function nrt(t){return Qnt.indexOf(t.op)>=0}function rrt(t){return trt.indexOf(t.op)>=0}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class srt{constructor(t,e){this.graph=t,this.parent=e,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((e=>{this._functionExecutorMap[e]=new srt(t.functions[e],this)}))}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){const e=Object.keys(t).map((e=>t[e].map((t=>t.id))));this._weightIds=[].concat(...e),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get outputs(){return this._outputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get inputNodes(){return this._inputs.map((t=>t.signatureKey||t.name))}get outputNodes(){return this._outputs.map((t=>{const e=t.signatureKey||t.name;return t.defaultOutput?`${e}:${t.defaultOutput}`:e}))}get functions(){return Object.keys(this._functions).reduce(((t,e)=>(t[e]=this._functions[e].signature,t)),{})}getCompilationKey(t,e){const n=t.map((t=>t.name)).sort(),r=e.map((t=>t.name)).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}compile(t,e){const n=Ynt(t,e,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:s,syncInputs:o}=n;if(null!=s)throw new Error(`This execution contains the node '${s.name}', which has the dynamic op '${s.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(r.length>0){const n=e.map((t=>t.name)),s=Object.keys(t);throw new Error(`Cannot compute the outputs [${n}] from the provided inputs [${s}]. Missing the following inputs: [${r}]`)}return function(t,e,n){const{usedNodes:r,inputs:s}=n,o=[],i=Object.keys(s).map((t=>ent(t)[0])).map((e=>t.nodes[e])),a=t.initNodes;i.forEach((t=>{r.has(t.name)&&o.push(t)})),t.weights.forEach((t=>{r.has(t.name)&&o.push(t)})),null!=a&&a.forEach((t=>{r.has(t.name)&&o.push(t)}));const u=new Set,c=[];for(;o.length>0;){const t=o.pop();u.add(t.name),e[t.name]||c.push(t),t.children.forEach((t=>{!u.has(t.name)&&r.has(t.name)&&t.inputs.every((t=>u.has(t.name)))&&o.push(t)}))}return c}(this.graph,this.weightMap,n)}execute(t,e){t=this.mapInputs(t);const n=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e);const r=n.map((t=>this.graph.nodes[ent(t)[0]])),s=e.map((t=>ent(t)[0]));let o=s.map((t=>this.graph.nodes[t]));this.resetIntermediateTensors(),0===o.length&&(o=this._outputs);const i=this.getCompilationKey(r,o);let a=this.compiledMap.get(i);null==a&&(a=this.compile(t,o),this.compiledMap.set(i,a));const u={},c={};return x6((()=>{const n=new Jnt(this.weightMap,u,c,this.functionExecutorMap),r=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,s]=ent(e),o=[];o[s]=t[e],r[n]=o}));const o=this.getFrozenTensorIds(r),i={};for(let t=0;t<a.length;t++){const e=a[t];if(!r[e.name]){const t=Xnt(e,r,n,this._resourceManager);if(t1(t))throw new Error(`The execution of the op '${e.op}' returned a promise. Please use model.executeAsync() instead.`);r[e.name]=t,this.checkTensorForDisposal(e.name,e,r,n,o,s,i)}}return null==this.parent&&n.dispose(o),e.map((t=>Zet(t,r,n)))}))}getFrozenTensorIds(t){const e=[].concat.apply([],Object.keys(t).map((e=>t[e])).map((t=>t.map((t=>t.id)))));return new Set(e)}checkTensorForDisposal(t,e,n,r,s,o,i){"control"!==e.category&&-1===o.indexOf(t)&&(n[t].forEach((t=>{null!=t&&(i[t.id]=(i[t.id]||0)+e.children.length)})),e.inputs.forEach((t=>{if("control"!==t.category){const o=function(t,e,n){return e[tnt(t,n.currentContextId)]}(t.name,n,r);null!=o&&o.forEach((t=>{if(t&&!t.kept&&!s.has(t.id)){const n=i[t.id];if(1===n){if(this.keepTensorForDebug){const[n,s]=Qet(e.name,r);this.intermediateTensors[n]||(this.intermediateTensors[n]=[]),this.intermediateTensors[n][s]=t}else t.dispose();delete i[t.id]}else null!=n&&i[t.id]--}}))}})))}async executeAsync(t,e){return this._executeAsync(t,e)}disposeIntermediateTensors(){this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach((t=>this.intermediateTensors[t].forEach((t=>t.dispose())))),this.disposeTensorsMap())}disposeTensorsMap(){this.tensorsMap&&Object.keys(this.tensorsMap).forEach((t=>{this.tensorsMap[t].forEach((t=>{!t||t.kept||t.isDisposed||this.keepIds.has(t.id)||t.dispose()}))}))}getIntermediateTensors(){return this.tensorsMap}resetIntermediateTensors(){for(const t in this.intermediateTensors)this.intermediateTensors[t].forEach((t=>t.dispose())),delete this.intermediateTensors[t]}async _executeAsync(t,e,n=!1,r={},s={}){n||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e));try{this.keepTensorForDebug=r1().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(t){console.warn(t.message)}this.resetIntermediateTensors();const o=new Jnt(this.weightMap,r,s,this.functionExecutorMap);this.tensorsMap=await this.executeWithControlFlow(t,o,e,n);const i=e.map((t=>Zet(t,this.tensorsMap,o))),a=i.map((t=>t.id)),u=Object.keys(t).map((e=>t[e].id));return this.keepIds=new Set([...a,...u,...this.weightIds]),this.keepTensorForDebug||this.disposeTensorsMap(),null==this.parent&&o.dispose(this.keepIds),i}async executeFunctionAsync(t,e,n){const r=t.reduce(((t,e,n)=>(t[this.inputs[n].name]=e,t)),{});return this._executeAsync(r,this.outputNodes,!0,e,n)}async executeWithControlFlow(t,e,n,r){const s=Object.keys(t),o=s.map((t=>this.graph.nodes[ent(t)[0]])),i=n.map((t=>ent(t)[0]));let a=i.map((t=>this.graph.nodes[t]));0===a.length&&(a=this._outputs);const{usedNodes:u,missingInputs:c,dynamicNode:l,syncInputs:f}=Ynt(t,a,this.weightMap,this._initNodes),h=[...o,...this.graph.weights,...this._initNodes||[]].map((t=>({node:t,contexts:e.currentContext}))),p=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,r]=ent(e),s=[];s[r]=t[e],p[n]=s}));const d={},m=this.getFrozenTensorIds(p),y={};for(;h.length>0;){const t=this.processStack(o,h,e,p,y,m,i,d,u);await Promise.all(t)}null!=l||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const g=a.filter((t=>!ert(t)&&!Zet(t.name,p,e))).map((t=>t.name));if(g.length>0){let t="";throw null!=l&&(t=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${f}]`),new Error(`Cannot compute the outputs [${g}] from the provided inputs [${s}]. Consider providing the following inputs: [${c}]. ${t}`)}return p}processStack(t,e,n,r,s,o,i,a,u){const c=[];for(;e.length>0;){const t=e.pop();n.currentContext=t.contexts;let l="";if("Enter"===t.node.op&&Yet("isConstant",t.node,r,n)&&([l]=Qet(t.node.name,n)),null==r[t.node.name]){const f=Xnt(t.node,r,n,this._resourceManager);l||([l]=Qet(t.node.name,n));const h=n.currentContext;t1(f)?c.push(f.then((c=>(r[l]=c,n.currentContext=h,this.checkTensorForDisposal(l,t.node,r,n,o,i,a),this.processChildNodes(t.node,e,n,r,s,u),c)))):(r[l]=f,this.checkTensorForDisposal(l,t.node,r,n,o,i,a),this.processChildNodes(t.node,e,n,r,s,u))}else this.processChildNodes(t.node,e,n,r,s,u)}return c}processChildNodes(t,e,n,r,s,o){t.children.forEach((t=>{const[i]=Qet(t.name,n);!s[i]&&o.has(t.name)&&("Merge"===t.op?t.inputNames.some((t=>!!Zet(t,r,n)))&&(s[i]=!0,e.push({contexts:n.currentContext,node:t})):t.inputNames.every((t=>!!Zet(t,r,n)))&&(s[i]=!0,e.push({contexts:n.currentContext,node:t})))}))}dispose(){Object.keys(this.weightMap).forEach((t=>this.weightMap[t].forEach((t=>t.dispose()))))}checkInputShapeAndType(t){Object.keys(t).forEach((e=>{const n=t[e],[r]=ent(e),s=this.graph.nodes[r];if(s.attrParams.shape&&s.attrParams.shape.value){const t=s.attrParams.shape.value,e=t.length===n.shape.length&&n.shape.every(((e,n)=>-1===t[n]||t[n]===e));S0(e,(()=>`The shape of dict['${s.name}'] provided in model.execute(dict) must be [${t}], but was [${n.shape}]`))}s.attrParams.dtype&&s.attrParams.dtype.value&&S0(n.dtype===s.attrParams.dtype.value,(()=>`The dtype of dict['${s.name}'] provided in model.execute(dict) must be ${s.attrParams.dtype.value}, but was ${n.dtype}`))}))}mapInputs(t){const e={};for(const n in t)if(null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]){e[this._signature.inputs[n].name]=t[n]}else e[n]=t[n];return e}checkInputs(t){const e=Object.keys(t).filter((t=>{const[e]=ent(t);return null==this.graph.nodes[e]}));if(e.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${e}] that are not part of graph`)}mapOutputs(t){return t.map((t=>{if(null!=this._signature&&null!=this._signature.outputs&&null!=this._signature.outputs[t]){return this._signature.outputs[t].name}return t}),{})}checkOutputs(t){t.forEach((t=>{const[e]=ent(t);if(!this.graph.nodes[e])throw new Error(`The output '${t}' is not found in the graph`)}))}}class ort{constructor(t={},e={}){this.hashTableNameToHandle=t,this.hashTableMap=e}addHashTable(t,e){this.hashTableNameToHandle[t]=e.handle,this.hashTableMap[e.id]=e}getHashTableHandleByName(t){return this.hashTableNameToHandle[t]}getHashTableById(t){return this.hashTableMap[t]}dispose(){for(const t in this.hashTableMap)this.hashTableMap[t].clearAndClose(),delete this.hashTableMap[t];for(const t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class irt{constructor(t,e={}){this.modelUrl=t,this.loadOptions=e,this.version="n/a",null==e&&(this.loadOptions={}),this.resourceManager=new ort}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}findIOHandler(){const t=this.modelUrl;if(null!=t.load)this.handler=t;else if(null!=this.loadOptions.requestInit)this.handler=p6(t,this.loadOptions);else{const e=k4(t,this.loadOptions);if(0===e.length)e.push(p6(t,this.loadOptions));else if(e.length>1)throw new Error(`Found more than one (${e.length}) load handlers for URL '${[t]}'`);this.handler=e[0]}}load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const t=this.handler.load();return t1(t)?t.then((t=>this.loadSync(t))):this.loadSync(t)}loadSync(t){this.artifacts=t;const e=this.artifacts.modelTopology;let n;n=null!=this.artifacts.userDefinedMetadata&&null!=this.artifacts.userDefinedMetadata.signature?this.artifacts.userDefinedMetadata.signature:this.artifacts.signature,this.signature=n,this.version=`${e.versions.producer}.${e.versions.minConsumer}`;const r=y4(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new srt($nt.Instance.transformGraph(e,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=t.modelInitializer&&null!=t.modelInitializer.node){const e=$nt.Instance.transformGraph(t.modelInitializer);this.initializer=new srt(e),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(t,e){if("string"==typeof t){const e=T4(t);if(0===e.length)throw new Error(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new Error(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}if(null==t.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return t.save(this.artifacts)}predict(t,e){return this.execute(t,this.outputNodes)}normalizeInputs(t){if(!(t instanceof V2||Array.isArray(t)))return t;if((t=Array.isArray(t)?t:[t]).length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${t.length} input tensors.`);return this.inputNodes.reduce(((e,n,r)=>(e[n]=t[r],e)),{})}normalizeOutputs(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]}execute(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=this.executor.execute(t,e);return n.length>1?n:n[0]}async executeAsync(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=await this.executor.executeAsync(t,e);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(t){return Object.keys(t).reduce(((e,n)=>(e[n]=[t[n]],e)),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var art=Object.freeze({__proto__:null,GraphModel:irt,loadGraphModel:async function(t,e={}){if(null==t)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==e&&(e={}),e.fromTFHub&&"string"==typeof t&&(t=function(t){t.endsWith("/")||(t+="/");return`${t}model.json?tfjs-format=file`}
/** @license See the LICENSE file. */(t));const n=new irt(t,e);return await n.load(),n},loadGraphModelSync:function(t){if(null==t)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide a url or an IOHandler that loads the model");if(!t.load)throw new Error(`modelUrl IO Handler ${t} has no load function`);const e=new irt(t);return e.load(),e},deregisterOp:function(t){delete Xet[t]},registerOp:function(t,e){const n={tfOpName:t,category:"custom",inputs:[],attrs:[],customExecutor:e};Xet[t]=n},version_converter:"3.18.0"}),urt=t0(art),crt=t0(qet),lrt={};function frt(t){return t.width*t.height}function hrt(t){var e=t.xCenter-t.width/2,n=e+t.width,r=t.yCenter-t.height/2;return{xMin:e,xMax:n,yMin:r,yMax:r+t.height,width:t.width,height:t.height}}function prt(t,e){var n=hrt(t),r=hrt(e);if(!function(t,e){return!(t.xMax<e.xMin||e.xMax<t.xMin||t.yMax<e.yMin||e.yMax<t.yMin)}(n,r))return 0;var s=frt(function(t,e){var n=Math.max(t.xMin,e.xMin),r=Math.min(t.xMax,e.xMax),s=Math.max(t.yMin,e.yMin),o=Math.min(t.yMax,e.yMax);return{xMin:n,xMax:r,yMin:s,yMax:o,width:Math.max(r-n,0),height:Math.max(o-s,0)}}(n,r)),o=frt(n)+frt(r)-s;return o>0?s/o:0}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Object.defineProperty(lrt,"q",{value:!0}),lrt.calculateAssociationNormRect=function(t,e){var n=[];return t.forEach((function(t){return t.forEach((function(t){(n=n.filter((function(n){return prt(t,n)<=e}))).push(t)}))})),n};var drt={},mrt=ZQ&&ZQ.tt||function(){return mrt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},mrt.apply(this,arguments)};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(drt,"q",{value:!0}),drt.calculateLandmarkProjection=function(t,e,n){void 0===n&&(n={ignoreRotation:!1});for(var r=[],s=0,o=t;s<o.length;s++){var i=o[s],a=i.x-.5,u=i.y-.5,c=n.ignoreRotation?0:e.rotation,l=Math.cos(c)*a-Math.sin(c)*u,f=Math.sin(c)*a+Math.cos(c)*u;l=l*e.width+e.xCenter,f=f*e.height+e.yCenter;var h=i.z*e.width,p=mrt({},i);p.x=l,p.y=f,p.z=h,r.push(p)}return r};var yrt={},grt=ZQ&&ZQ.tt||function(){return grt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},grt.apply(this,arguments)};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(yrt,"q",{value:!0}),yrt.calculateWorldLandmarkProjection=function(t,e){for(var n=[],r=0,s=t;r<s.length;r++){var o=s[r],i=o.x,a=o.y,u=e.rotation,c=Math.cos(u)*i-Math.sin(u)*a,l=Math.sin(u)*i+Math.cos(u)*a,f=grt({},o);f.x=c,f.y=l,n.push(f)}return n};var brt={},wrt={};Object.defineProperty(wrt,"q",{value:!0});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var vrt=crt;function xrt(t,e){vrt.util.assert(0!==t.width,(function(){return e+" width cannot be 0."})),vrt.util.assert(0!==t.height,(function(){return e+" height cannot be 0."}))}wrt.getImageSize=function(t){return t instanceof vrt.Tensor?{height:t.shape[0],width:t.shape[1]}:{height:t.height,width:t.width}},wrt.normalizeRadians=function(t){return t-2*Math.PI*Math.floor((t+Math.PI)/(2*Math.PI))},wrt.transformValueRange=function(t,e,n,r){var s=e-t,o=r-n;if(0===s)throw new Error("Original min and max are both "+t+", range cannot be 0.");var i=o/s;return{scale:i,offset:n-t*i}},wrt.toImageTensor=function(t){return t instanceof vrt.Tensor?t:vrt.browser.fromPixels(t)},wrt.padRoi=function(t,e,n){if(void 0===n&&(n=!1),!n)return{top:0,left:0,right:0,bottom:0};var r=e.height,s=e.width;xrt(e,"targetSize"),xrt(t,"roi");var o,i,a=r/s,u=t.height/t.width,c=0,l=0;return a>u?(o=t.width,i=t.width*a,l=(1-u/a)/2):(o=t.height/a,i=t.height,c=(1-a/u)/2),t.width=o,t.height=i,{top:l,left:c,right:c,bottom:l}},wrt.getRoi=function(t,e){return e?{xCenter:e.xCenter*t.width,yCenter:e.yCenter*t.height,width:e.width*t.width,height:e.height*t.height,rotation:e.rotation}:{xCenter:.5*t.width,yCenter:.5*t.height,width:t.width,height:t.height,rotation:0}},wrt.getProjectiveTransformMatrix=function(t,e,n,r){xrt(r,"inputResolution");var s=1/e.width,o=1/e.height,i=t.xCenter,a=t.yCenter,u=Math.cos(t.rotation),c=Math.sin(t.rotation),l=n?-1:1,f=t.width,h=t.height;return[1/r.width*f*u*l*s*e.width,1/r.height*-h*c*s*e.width,(-.5*f*u*l+.5*h*c+i)*s*e.width,1/r.width*f*c*l*o*e.height,1/r.height*h*u*o*e.height,(-.5*h*u-.5*f*c*l+a)*o*e.height,0,0]},Object.defineProperty(brt,"q",{value:!0});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var Nrt=crt,$rt=wrt;brt.convertImageToTensor=function(t,e,n){var r=e.inputResolution,s=e.keepAspectRatio,o=$rt.getImageSize(t),i=$rt.getRoi(o,n),a=$rt.padRoi(i,r,s);return{imageTensor:Nrt.tidy((function(){var e=$rt.toImageTensor(t),n=Nrt.tensor2d($rt.getProjectiveTransformMatrix(i,o,!1,r),[1,8]);return Nrt.image.transform(Nrt.expandDims(Nrt.cast(e,"float32")),n,"bilinear","nearest",0,[r.height,r.width])})),padding:a}};var Ert={};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Srt(t,e,n,r){return 1===r?.5*(t+e):t+(e-t)*n/(r-1)}Object.defineProperty(Ert,"q",{value:!0}),Ert.createSsdAnchors=function(t){for(var e=[],n=0;n<t.numLayers;){for(var r=[],s=[],o=[],i=[],a=n;a<t.strides.length&&t.strides[a]===t.strides[n];){var u=Srt(t.minScale,t.maxScale,a,t.strides.length);if(0===a&&t.reduceBoxesInLowestLayer)o.push(1),o.push(2),o.push(.5),i.push(.1),i.push(u),i.push(u);else{for(var c=0;c<t.aspectRatios.length;++c)o.push(t.aspectRatios[c]),i.push(u);if(t.interpolatedScaleAspectRatio>0){var l=a===t.strides.length-1?1:Srt(t.minScale,t.maxScale,a+1,t.strides.length);i.push(Math.sqrt(u*l)),o.push(t.interpolatedScaleAspectRatio)}}a++}for(var f=0;f<o.length;++f){var h=Math.sqrt(o[f]);r.push(i[f]/h),s.push(i[f]*h)}var p=0,d=0;if(t.featureMapHeight.length>0)p=t.featureMapHeight[n],d=t.featureMapWidth[n];else{var m=t.strides[n];p=Math.ceil(t.inputSizeHeight/m),d=Math.ceil(t.inputSizeWidth/m)}for(var y=0;y<p;++y)for(var g=0;g<d;++g)for(var b=0;b<r.length;++b){var w={xCenter:(g+t.anchorOffsetX)/d,yCenter:(y+t.anchorOffsetY)/p,width:0,height:0};t.fixedAnchorSize?(w.width=1,w.height=1):(w.width=s[b],w.height=r[b]),e.push(w)}n=a}return e};var _rt={};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(_rt,"q",{value:!0});var Trt=wrt;function krt(t,e,n){var r,s=t.locationData,o=n.rotationVectorStartKeypointIndex,i=n.rotationVectorEndKeypointIndex;r=n.rotationVectorTargetAngle?n.rotationVectorTargetAngle:Math.PI*n.rotationVectorTargetAngleDegree/180;var a=s.relativeKeypoints[o].x*e.width,u=s.relativeKeypoints[o].y*e.height,c=s.relativeKeypoints[i].x*e.width,l=s.relativeKeypoints[i].y*e.height;return Trt.normalizeRadians(r-Math.atan2(-(l-u),c-a))}_rt.computeRotation=krt,_rt.calculateDetectionsToRects=function(t,e,n){var r=t.locationData.relativeBoundingBox,s=krt(t,e,n);return{xCenter:r.xMin+r.width/2,yCenter:r.yMin+r.height/2,width:r.width,height:r.height,rotation:s}};var Art={},Crt={};Object.defineProperty(Crt,"q",{value:!0});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var Ort=crt;Crt.splitDetectionResult=function(t){return Ort.tidy((function(){return[Ort.slice(t,[0,0,0],[1,-1,1]),Ort.slice(t,[0,0,1],[1,-1,-1])]}))},Object.defineProperty(Art,"q",{value:!0});var Irt=crt,Mrt=Crt;Art.detectorInference=function(t,e){return Irt.tidy((function(){var n=e.predict(t),r=Mrt.splitDetectionResult(n),s=r[0],o=r[1];return{boxes:Irt.squeeze(o),logits:Irt.squeeze(s)}}))};var Rrt={},Drt=ZQ&&ZQ.et||function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?s(t.value):new n((function(e){e(t.value)})).then(i,a)}u((r=r.apply(t,e||[])).next())}))},Frt=ZQ&&ZQ.nt||function(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=i.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(Rrt,"q",{value:!0});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var Lrt=crt;Rrt.nonMaxSuppression=function(t,e,n,r){return Drt(this,void 0,void 0,(function(){var s,o,i,a,u;return Frt(this,(function(c){switch(c.label){case 0:return t.sort((function(t,e){return Math.max.apply(Math,e.score)-Math.max.apply(Math,t.score)})),s=Lrt.tensor2d(t.map((function(t){return[t.locationData.relativeBoundingBox.yMin,t.locationData.relativeBoundingBox.xMin,t.locationData.relativeBoundingBox.yMax,t.locationData.relativeBoundingBox.xMax]}))),o=Lrt.tensor1d(t.map((function(t){return t.score[0]}))),[4,Lrt.image.nonMaxSuppressionAsync(s,o,e,n,r)];case 1:return[4,(i=c.sent()).array()];case 2:return a=c.sent(),u=t.filter((function(t,e){return a.indexOf(e)>-1})),Lrt.dispose([s,o,i]),[2,u]}}))}))};var Prt={},Brt=ZQ&&ZQ.tt||function(){return Brt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},Brt.apply(this,arguments)};Object.defineProperty(Prt,"q",{value:!0}),Prt.normalizedKeypointsToKeypoints=function(t,e){return t.map((function(t){var n=Brt({},t,{x:t.x*e.width,y:t.y*e.height});return null!=t.z&&(n.z=t.z*e.width),n}))};var Vrt={};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(Vrt,"q",{value:!0}),Vrt.removeDetectionLetterbox=function(t,e){void 0===t&&(t=[]);for(var n=e.left,r=e.top,s=e.left+e.right,o=e.top+e.bottom,i=0;i<t.length;i++){var a=t[i],u=a.locationData.relativeBoundingBox,c=(u.xMin-n)/(1-s),l=(u.yMin-r)/(1-o),f=u.width/(1-s),h=u.height/(1-o);u.xMin=c,u.yMin=l,u.width=f,u.height=h;for(var p=0;p<a.locationData.relativeKeypoints.length;++p){var d=a.locationData.relativeKeypoints[p],m=(d.x-n)/(1-s),y=(d.y-r)/(1-o);d.x=m,d.y=y}}return t};var zrt={},Wrt=ZQ&&ZQ.tt||function(){return Wrt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},Wrt.apply(this,arguments)};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(zrt,"q",{value:!0}),zrt.removeLandmarkLetterbox=function(t,e){var n=e.left,r=e.top,s=e.left+e.right,o=e.top+e.bottom;return t.map((function(t){return Wrt({},t,{x:(t.x-n)/(1-s),y:(t.y-r)/(1-o),z:t.z/(1-s)})}))};var Urt={};Object.defineProperty(Urt,"q",{value:!0});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var jrt=crt,Grt=wrt;Urt.shiftImageValue=function(t,e){var n=Grt.transformValueRange(0,255,e[0],e[1]);return jrt.tidy((function(){return jrt.add(jrt.mul(t,n.scale),n.offset)}))};var qrt={},Hrt=ZQ&&ZQ.et||function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?s(t.value):new n((function(e){e(t.value)})).then(i,a)}u((r=r.apply(t,e||[])).next())}))},Krt=ZQ&&ZQ.nt||function(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=i.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(qrt,"q",{value:!0});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var Xrt=crt;function Jrt(t,e,n){return Hrt(this,void 0,void 0,(function(){var r,s,o,i,a,u,c,l,f,h,p,d;return Krt(this,(function(m){switch(m.label){case 0:return r=[],[4,t.data()];case 1:return s=m.sent(),[4,e.data()];case 2:for(o=m.sent(),i=0;i<n.numBoxes;++i)if(!(null!=n.minScoreThresh&&o[i]<n.minScoreThresh||(a=i*n.numCoords,u=Yrt(s[a+0],s[a+1],s[a+2],s[a+3],o[i],n.flipVertically,i),(c=u.locationData.relativeBoundingBox).width<0||c.height<0))){if(n.numKeypoints>0)for((l=u.locationData).relativeKeypoints=[],f=n.numKeypoints*n.numValuesPerKeypoint,h=0;h<f;h+=n.numValuesPerKeypoint)p=a+n.keypointCoordOffset+h,d={x:s[p+0],y:n.flipVertically?1-s[p+1]:s[p+1]},l.relativeKeypoints.push(d);r.push(u)}return[2,r]}}))}))}function Yrt(t,e,n,r,s,o,i){return{score:[s],ind:i,locationData:{relativeBoundingBox:{xMin:e,yMin:o?1-n:t,xMax:r,yMax:o?1-t:n,width:r-e,height:n-t}}}}qrt.tensorsToDetections=function(t,e,n){return Hrt(this,void 0,void 0,(function(){var r,s,o,i,a;return Krt(this,(function(u){switch(u.label){case 0:return r=t[0],s=t[1],o=function(t,e,n){return Xrt.tidy((function(){var r,s,o,i;n.reverseOutputOrder?(s=Xrt.squeeze(Xrt.slice(t,[0,n.boxCoordOffset+0],[-1,1])),r=Xrt.squeeze(Xrt.slice(t,[0,n.boxCoordOffset+1],[-1,1])),i=Xrt.squeeze(Xrt.slice(t,[0,n.boxCoordOffset+2],[-1,1])),o=Xrt.squeeze(Xrt.slice(t,[0,n.boxCoordOffset+3],[-1,1]))):(r=Xrt.squeeze(Xrt.slice(t,[0,n.boxCoordOffset+0],[-1,1])),s=Xrt.squeeze(Xrt.slice(t,[0,n.boxCoordOffset+1],[-1,1])),o=Xrt.squeeze(Xrt.slice(t,[0,n.boxCoordOffset+2],[-1,1])),i=Xrt.squeeze(Xrt.slice(t,[0,n.boxCoordOffset+3],[-1,1]))),s=Xrt.add(Xrt.mul(Xrt.div(s,n.xScale),e.w),e.x),r=Xrt.add(Xrt.mul(Xrt.div(r,n.yScale),e.h),e.y),n.applyExponentialOnBoxSize?(o=Xrt.mul(Xrt.exp(Xrt.div(o,n.hScale)),e.h),i=Xrt.mul(Xrt.exp(Xrt.div(i,n.wScale)),e.w)):(o=Xrt.mul(Xrt.div(o,n.hScale),e.h),i=Xrt.mul(Xrt.div(i,n.wScale),e.h));var a=Xrt.sub(r,Xrt.div(o,2)),u=Xrt.sub(s,Xrt.div(i,2)),c=Xrt.add(r,Xrt.div(o,2)),l=Xrt.add(s,Xrt.div(i,2)),f=Xrt.concat([Xrt.reshape(a,[n.numBoxes,1]),Xrt.reshape(u,[n.numBoxes,1]),Xrt.reshape(c,[n.numBoxes,1]),Xrt.reshape(l,[n.numBoxes,1])],1);if(n.numKeypoints)for(var h=0;h<n.numKeypoints;++h){var p=n.keypointCoordOffset+h*n.numValuesPerKeypoint,d=void 0,m=void 0;n.reverseOutputOrder?(d=Xrt.squeeze(Xrt.slice(t,[0,p],[-1,1])),m=Xrt.squeeze(Xrt.slice(t,[0,p+1],[-1,1]))):(m=Xrt.squeeze(Xrt.slice(t,[0,p],[-1,1])),d=Xrt.squeeze(Xrt.slice(t,[0,p+1],[-1,1])));var y=Xrt.add(Xrt.mul(Xrt.div(d,n.xScale),e.w),e.x),g=Xrt.add(Xrt.mul(Xrt.div(m,n.yScale),e.h),e.y);f=Xrt.concat([f,Xrt.reshape(y,[n.numBoxes,1]),Xrt.reshape(g,[n.numBoxes,1])],1)}return f}))}(s,e,n),i=Xrt.tidy((function(){var t=r;return n.sigmoidScore?(null!=n.scoreClippingThresh&&(t=Xrt.clipByValue(r,-n.scoreClippingThresh,n.scoreClippingThresh)),t=Xrt.sigmoid(t)):t})),[4,Jrt(o,i,n)];case 1:return a=u.sent(),Xrt.dispose([o,i]),[2,a]}}))}))},qrt.convertToDetections=Jrt;var Zrt={},Qrt={};Object.defineProperty(Qrt,"q",{value:!0}),Qrt.sigmoid=
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){return 1/(1+Math.exp(-t))};var tst=ZQ&&ZQ.et||function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?s(t.value):new n((function(e){e(t.value)})).then(i,a)}u((r=r.apply(t,e||[])).next())}))},est=ZQ&&ZQ.nt||function(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=i.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(Zrt,"q",{value:!0});var nst=Qrt;Zrt.tensorsToLandmarks=function(t,e,n,r){return tst(this,void 0,void 0,(function(){var s,o,i,a,u,c,l,f;return est(this,(function(h){switch(h.label){case 0:return n=n||e.flipHorizontally||!1,r=r||e.flipVertically||!1,s=t.size,o=s/e.numLandmarks,[4,t.data()];case 1:for(i=h.sent(),a=[],u=0;u<e.numLandmarks;++u)c=u*o,(f={x:0,y:0}).x=n?e.inputImageWidth-i[c]:i[c],o>1&&(f.y=r?e.inputImageHeight-i[c+1]:i[c+1]),o>2&&(f.z=i[c+2]),o>3&&(f.score=(p=e.visibilityActivation,d=i[c+3],"none"===p?d:nst.sigmoid(d))),a.push(f);for(l=0;l<a.length;++l)(f=a[l]).x=f.x/e.inputImageWidth,f.y=f.y/e.inputImageHeight,f.z=f.z/e.inputImageWidth/(e.normalizeZ||1);return[2,a]}var p,d}))}))};var rst={};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(rst,"q",{value:!0});var sst=wrt;function ost(t,e){return null!=e.rotation?t+=e.rotation:null!=e.rotationDegree&&(t+=Math.PI*e.rotationDegree/180),sst.normalizeRadians(t)}rst.transformNormalizedRect=function(t,e,n){var r=t.width,s=t.height,o=t.rotation;if(null==n.rotation&&null==n.rotationDegree||(o=ost(o,n)),0===o)t.xCenter=t.xCenter+r*n.shiftX,t.yCenter=t.yCenter+s*n.shiftY;else{var i=(e.width*r*n.shiftX*Math.cos(o)-e.height*s*n.shiftY*Math.sin(o))/e.width,a=(e.width*r*n.shiftX*Math.sin(o)+e.height*s*n.shiftY*Math.cos(o))/e.height;t.xCenter=t.xCenter+i,t.yCenter=t.yCenter+a}if(n.squareLong){var u=Math.max(r*e.width,s*e.height);r=u/e.width,s=u/e.height}else if(n.squareShort){var c=Math.min(r*e.width,s*e.height);r=c/e.width,s=c/e.height}return t.width=r*n.scaleX,t.height=s*n.scaleY,t},rst.computeNewRotation=ost;var ist={};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(ist,"q",{value:!0});var ast=wrt;ist.handLandmarksToRect=function(t,e){for(var n=function(t,e){var n=t[0].x*e.width,r=t[0].y*e.height,s=(t[4].x+t[8].x)/2,o=(t[4].y+t[8].y)/2;return s=(s+t[6].x)/2*e.width,o=(o+t[6].y)/2*e.height,ast.normalizeRadians(Math.PI/2-Math.atan2(-(o-r),s-n))}(t,e),r=ast.normalizeRadians(-n),s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,u=0,c=t;u<c.length;u++){var l=(y=c[u]).x,f=y.y;s=Math.min(s,l),o=Math.max(o,l),i=Math.min(i,f),a=Math.max(a,f)}var h=(o+s)/2,p=(a+i)/2;s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(var d=0,m=t;d<m.length;d++){var y,g=((y=m[d]).x-h)*e.width,b=(y.y-p)*e.height,w=g*Math.cos(r)-b*Math.sin(r),v=g*Math.sin(r)+b*Math.cos(r);s=Math.min(s,w),o=Math.max(o,w),i=Math.min(i,v),a=Math.max(a,v)}var x=(o+s)/2,N=(a+i)/2,$=x*Math.cos(n)-N*Math.sin(n)+e.width*h,E=x*Math.sin(n)+N*Math.cos(n)+e.height*p,S=(o-s)/e.width,_=(a-i)/e.height;return{xCenter:$/e.width,yCenter:E/e.height,width:S,height:_,rotation:n}};var ust,cst={};ust=cst,
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Object.defineProperty(ust,"q",{value:!0}),ust.DEFAULT_MPHANDS_DETECTOR_MODEL_URL_LITE="https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/detector/lite/1",ust.DEFAULT_MPHANDS_DETECTOR_MODEL_URL_FULL="https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/detector/full/1",ust.DEFAULT_MPHANDS_LANDMARK_MODEL_URL_LITE="https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/landmark/lite/1",ust.DEFAULT_MPHANDS_LANDMARK_MODEL_URL_FULL="https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/landmark/full/1",ust.MPHANDS_DETECTOR_ANCHOR_CONFIGURATION={reduceBoxesInLowestLayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:4,minScale:.1484375,maxScale:.75,inputSizeHeight:192,inputSizeWidth:192,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,16,16],aspectRatios:[1],fixedAnchorSize:!0},ust.DEFAULT_MPHANDS_MODEL_CONFIG={runtime:"tfjs",modelType:"full",maxHands:2,detectorModelUrl:ust.DEFAULT_MPHANDS_DETECTOR_MODEL_URL_FULL,landmarkModelUrl:ust.DEFAULT_MPHANDS_LANDMARK_MODEL_URL_FULL},ust.DEFAULT_MPHANDS_ESTIMATION_CONFIG={flipHorizontal:!1,staticImageMode:!1},ust.MPHANDS_TENSORS_TO_DETECTION_CONFIGURATION={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2016,numCoords:18,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:7,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:192,yScale:192,hScale:192,wScale:192,minScoreThresh:.5},ust.MPHANDS_DETECTOR_NON_MAX_SUPPRESSION_CONFIGURATION={minScoreThreshold:-1,minSuppressionThreshold:.3},ust.MPHANDS_DETECTOR_RECT_TRANSFORMATION_CONFIG={shiftX:0,shiftY:-.5,scaleX:2.6,scaleY:2.6,squareLong:!0},ust.MPHANDS_LANDMARK_RECT_TRANSFORMATION_CONFIG={shiftX:0,shiftY:-.1,scaleX:2,scaleY:2,squareLong:!0},ust.MPHANDS_DETECTOR_IMAGE_TO_TENSOR_CONFIG={inputResolution:{width:192,height:192},keepAspectRatio:!0},ust.MPHANDS_LANDMARK_IMAGE_TO_TENSOR_CONFIG={inputResolution:{width:224,height:224},keepAspectRatio:!0},ust.MPHANDS_HAND_PRESENCE_SCORE=.5,ust.MPHANDS_MIN_SIMILARITY_THRESHOLD=.5,ust.MPHANDS_TENSORS_TO_LANDMARKS_CONFIG={numLandmarks:21,inputImageWidth:224,inputImageHeight:224,normalizeZ:.4,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1},ust.MPHANDS_TENSORS_TO_WORLD_LANDMARKS_CONFIG={numLandmarks:21,inputImageWidth:1,inputImageHeight:1,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1};var lst={},fst=ZQ&&ZQ.tt||function(){return fst=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},fst.apply(this,arguments)};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(lst,"q",{value:!0});var hst=cst;lst.validateModelConfig=function(t){if(null==t)return fst({},hst.DEFAULT_MPHANDS_MODEL_CONFIG);var e=fst({},t);if(e.runtime="tfjs",null==e.maxHands&&(e.maxHands=hst.DEFAULT_MPHANDS_MODEL_CONFIG.maxHands),null==e.modelType&&(e.modelType=hst.DEFAULT_MPHANDS_MODEL_CONFIG.modelType),"lite"!==e.modelType&&"full"!==e.modelType)throw new Error("Model type must be one of lite or full, but got "+e.modelType);if(null==e.detectorModelUrl)if("lite"===e.modelType)e.detectorModelUrl=hst.DEFAULT_MPHANDS_DETECTOR_MODEL_URL_LITE;else e.detectorModelUrl=hst.DEFAULT_MPHANDS_DETECTOR_MODEL_URL_FULL;if(null==e.landmarkModelUrl)if("lite"===e.modelType)e.landmarkModelUrl=hst.DEFAULT_MPHANDS_LANDMARK_MODEL_URL_LITE;else e.landmarkModelUrl=hst.DEFAULT_MPHANDS_LANDMARK_MODEL_URL_FULL;return e},lst.validateEstimationConfig=function(t){if(null==t)return fst({},hst.DEFAULT_MPHANDS_ESTIMATION_CONFIG);var e=fst({},t);return null==e.flipHorizontal&&(e.flipHorizontal=hst.DEFAULT_MPHANDS_ESTIMATION_CONFIG.flipHorizontal),null==e.staticImageMode&&(e.staticImageMode=hst.DEFAULT_MPHANDS_ESTIMATION_CONFIG.staticImageMode),e};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var pst=ZQ&&ZQ.et||function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?s(t.value):new n((function(e){e(t.value)})).then(i,a)}u((r=r.apply(t,e||[])).next())}))},dst=ZQ&&ZQ.nt||function(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=i.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(w0,"q",{value:!0});var mst=urt,yst=crt,gst=i0,bst=lrt,wst=drt,vst=yrt,xst=brt,Nst=Ert,$st=_rt,Est=Art,Sst=wrt,_st=Rrt,Tst=Prt,kst=Vrt,Ast=zrt,Cst=Urt,Ost=qrt,Ist=Zrt,Mst=rst,Rst=ist,Dst=cst,Fst=lst,Lst=function(){function t(t,e,n){this.detectorModel=t,this.landmarkModel=e,this.maxHands=n,this.prevHandRectsFromLandmarks=null,this.anchors=Nst.createSsdAnchors(Dst.MPHANDS_DETECTOR_ANCHOR_CONFIGURATION);var r=yst.tensor1d(this.anchors.map((function(t){return t.width}))),s=yst.tensor1d(this.anchors.map((function(t){return t.height}))),o=yst.tensor1d(this.anchors.map((function(t){return t.xCenter}))),i=yst.tensor1d(this.anchors.map((function(t){return t.yCenter})));this.anchorTensor={x:o,y:i,w:r,h:s}}return t.prototype.estimateHands=function(t,e){return pst(this,void 0,void 0,(function(){var n,r,s,o,i,a,u,c,l,f,h,p,d,m,y,g,b,w,v=this;return dst(this,(function(x){switch(x.label){case 0:return n=Fst.validateEstimationConfig(e),null==t?(this.reset(),[2,[]]):(r=Sst.getImageSize(t),s=yst.tidy((function(){var e=yst.cast(Sst.toImageTensor(t),"float32");if(n.flipHorizontal){e=yst.squeeze(yst.image.flipLeftRight(yst.expandDims(e,0)),[0])}return e})),o=this.prevHandRectsFromLandmarks,n.staticImageMode||null==o||o.length<this.maxHands?[4,this.detectPalm(s)]:[3,2]);case 1:return 0===(a=x.sent()).length?(this.reset(),s.dispose(),[2,[]]):(u=a.map((function(t){return v.palmDetectionToRoi(t,r)})),i=u,[3,3]);case 2:i=o,x.label=3;case 3:return i=bst.calculateAssociationNormRect([i],Dst.MPHANDS_MIN_SIMILARITY_THRESHOLD),[4,Promise.all(i.map((function(t){return v.handLandmarks(t,s)})))];case 4:for(c=x.sent(),l=[],this.prevHandRectsFromLandmarks=[],f=0,h=c;f<h.length;f++)null!=(p=h[f])&&(d=p.landmarks,m=p.worldLandmarks,y=p.handScore,g=p.handedness,this.prevHandRectsFromLandmarks.push(this.handLandmarksToRoi(d,r)),null!=(b=Tst.normalizedKeypointsToKeypoints(d,r))&&b.forEach((function(t,e){delete t.z,t.name=gst.MEDIAPIPE_KEYPOINTS[e]})),null!=(w=m)&&w.forEach((function(t,e){t.name=gst.MEDIAPIPE_KEYPOINTS[e]})),l.push({keypoints:b,keypoints3D:w,handedness:g,score:y}));return s.dispose(),[2,l]}}))}))},t.prototype.dispose=function(){this.detectorModel.dispose(),this.landmarkModel.dispose(),yst.dispose([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h])},t.prototype.reset=function(){this.prevHandRectsFromLandmarks=null},t.prototype.detectPalm=function(t){return pst(this,void 0,void 0,(function(){var e,n,r,s,o,i,a,u,c,l;return dst(this,(function(f){switch(f.label){case 0:return e=xst.convertImageToTensor(t,Dst.MPHANDS_DETECTOR_IMAGE_TO_TENSOR_CONFIG),n=e.imageTensor,r=e.padding,s=Cst.shiftImageValue(n,[0,1]),o=Est.detectorInference(s,this.detectorModel),i=o.boxes,a=o.logits,[4,Ost.tensorsToDetections([a,i],this.anchorTensor,Dst.MPHANDS_TENSORS_TO_DETECTION_CONFIGURATION)];case 1:return 0===(u=f.sent()).length?(yst.dispose([n,s,a,i]),[2,u]):[4,_st.nonMaxSuppression(u,this.maxHands,Dst.MPHANDS_DETECTOR_NON_MAX_SUPPRESSION_CONFIGURATION.minSuppressionThreshold,Dst.MPHANDS_DETECTOR_NON_MAX_SUPPRESSION_CONFIGURATION.minScoreThreshold)];case 2:return c=f.sent(),l=kst.removeDetectionLetterbox(c,r),yst.dispose([n,s,a,i]),[2,l]}}))}))},t.prototype.palmDetectionToRoi=function(t,e){var n=$st.calculateDetectionsToRects(t,e,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:2,rotationVectorTargetAngleDegree:90});return Mst.transformNormalizedRect(n,e,Dst.MPHANDS_DETECTOR_RECT_TRANSFORMATION_CONFIG)},t.prototype.handLandmarks=function(t,e){return pst(this,void 0,void 0,(function(){var n,r,s,o,i,a,u,c,l,f,h,p,d,m,y,g,b;return dst(this,(function(w){switch(w.label){case 0:return n=xst.convertImageToTensor(e,Dst.MPHANDS_LANDMARK_IMAGE_TO_TENSOR_CONFIG,t),r=n.imageTensor,s=n.padding,o=Cst.shiftImageValue(r,[0,1]),i=this.landmarkModel.execute(o,["Identity_2:0","Identity_1:0","Identity:0","Identity_3:0"]),a=i[0],u=i[1],c=i[2],l=i[3],[4,u.data()];case 1:return(f=w.sent()[0])<Dst.MPHANDS_HAND_PRESENCE_SCORE?(yst.dispose(i),yst.dispose([r,o]),[2,null]):[4,c.data()];case 2:return h=w.sent()[0],p=h>=.5?"Left":"Right",[4,Ist.tensorsToLandmarks(a,Dst.MPHANDS_TENSORS_TO_LANDMARKS_CONFIG)];case 3:return d=w.sent(),[4,Ist.tensorsToLandmarks(l,Dst.MPHANDS_TENSORS_TO_WORLD_LANDMARKS_CONFIG)];case 4:return m=w.sent(),y=Ast.removeLandmarkLetterbox(d,s),g=wst.calculateLandmarkProjection(y,t),b=vst.calculateWorldLandmarkProjection(m,t),yst.dispose(i),yst.dispose([r,o]),[2,{landmarks:g,worldLandmarks:b,handScore:f,handedness:p}]}}))}))},t.prototype.handLandmarksToRoi=function(t,e){var n=[].concat(t.slice(0,4),t.slice(5,7),t.slice(9,11),t.slice(13,15),t.slice(17,19)),r=Rst.handLandmarksToRect(n,e);return Mst.transformNormalizedRect(r,e,Dst.MPHANDS_LANDMARK_RECT_TRANSFORMATION_CONFIG)},t}();w0.load=function(t){return pst(this,void 0,void 0,(function(){var e,n,r,s,o,i;return dst(this,(function(a){switch(a.label){case 0:return e=Fst.validateModelConfig(t),n=e.detectorModelUrl.indexOf("https://tfhub.dev")>-1,r=e.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,Promise.all([mst.loadGraphModel(e.detectorModelUrl,{fromTFHub:n}),mst.loadGraphModel(e.landmarkModelUrl,{fromTFHub:r})])];case 1:return s=a.sent(),o=s[0],i=s[1],[2,new Lst(o,i,e.maxHands)]}}))}))};var Pst={};!function(t){Object.defineProperty(t,"q",{value:!0}),(t.SupportedModels||(t.SupportedModels={})).MediaPipeHands="MediaPipeHands"}(Pst);
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var Bst=ZQ&&ZQ.et||function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?s(t.value):new n((function(e){e(t.value)})).then(i,a)}u((r=r.apply(t,e||[])).next())}))},Vst=ZQ&&ZQ.nt||function(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=i.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(n0,"q",{value:!0});var zst=r0,Wst=w0,Ust=Pst;n0.createDetector=function(t,e){return Bst(this,void 0,void 0,(function(){var n,r;return Vst(this,(function(s){if(t===Ust.SupportedModels.MediaPipeHands){if(r=void 0,null!=(n=e)){if("tfjs"===n.runtime)return[2,Wst.load(n)];if("mediapipe"===n.runtime)return[2,zst.load(n)];r=n.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+r)}throw new Error(t+" is not a supported model name.")}))}))},function(t){Object.defineProperty(t,"q",{value:!0});var e=n0;t.createDetector=e.createDetector,
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(Pst)}(e0);const jst=YQ({__proto__:null,default:QQ(e0)},[e0]),Gst=a0.MEDIAPIPE_KEYPOINTS;let qst;class Hst extends d{get poseType(){return"handpose"}get parts(){return Gst}async onMetadata(){super.onMetadata(),await async function(){const t=jst.SupportedModels.MediaPipeHands;qst=await jst.createDetector(t,{runtime:"tfjs",modelType:"full"})}(),this.poseDetectionFrame()}async poseDetectionFrame(){if((this.isPlaying||this.forceOneTimePoseProcess)&&this.videoEl.readyState>1){const t=await(async(t,e,n=0)=>{const r=[];qst&&(await qst.estimateHands(t.videoElement)).forEach(((s,o)=>{var i;if(s.score>n){const n={time:Date.now()-e?e:0,score:s.score,pose:o,points:[],aspectRatio:t.aspectRatio};null===(i=s.keypoints)||void 0===i||i.forEach((e=>{n.points.push({name:e.name,position:[e.x/t.videoElement.width,e.y/t.videoElement.height]})})),r.push(n)}}));return r})(this,this.recordingStartTime,this.minConfidence/100);this.onPoseFrame(t)}requestAnimationFrame((()=>this.poseDetectionFrame())),this.forceOneTimePoseProcess=!1}}customElements.define("handpose-video",Hst);class Kst extends f{constructor(){super(),this.playStartTime=0,this.currentKeyframe=0,this.keyframes=[],this._currentTime=0,this.attachShadow({mode:"open"}),this.shadowRoot&&(this.shadowRoot.innerHTML="\n            <style>\n                :host {\n                    display: inline-block;\n                    overflow: hidden;\n                    position: relative;\n                    background-color: black;\n                }\n                \n                ::slotted(*) {\n                    position: absolute;\n                    width: 100%;\n                }\n            </style>\n            <slot></slot>")}static get observedAttributes(){return["islooping","src"]}set recording(t){this.currentKeyframe=0,this._currentTime=0,this.playStartTime=Date.now(),this._isPlaying=!1,this.keyframes=t.keyframes;const e=t.keyframes[0].time;this.keyframes.forEach((t=>{t.time-=e})),this.audio&&(this.audio.pause(),this.audio=void 0),t.audio&&(this.audio=new Audio(t.audio)),this._duration=this.keyframes[this.keyframes.length-1].time,this.updateControls(),this.hasAttribute("autoplay")?this.play():this.renderPose()}loadPoseData(t){fetch(t).then((t=>t.json())).then((t=>{this.recording=t})).catch((function(){console.warn(`Error, ${t} cannot be found`)}))}connectedCallback(){super.connectedCallback(),this.hasAttribute("posedata")&&this.loadPoseData(this.getAttribute("posedata"))}togglePlayback(){this.isPlaying?this.pause():this.play()}step(t){this.currentKeyframe+=t,this.currentKeyframe<0&&(this.currentKeyframe=0),this.currentKeyframe>this.keyframes.length-1&&(this.currentKeyframe=this.keyframes.length-1),this.renderPose()}pause(){var t;null===(t=this.audio)||void 0===t||t.pause(),this._isPlaying=!1}play(){var t;this._isPlaying=!0,this.playStartTime=Date.now(),null===(t=this.audio)||void 0===t||t.play(),this.audio&&(this.audio.loop=this.isLooping),this.renderFrame()}renderFrame(){if(0===this.keyframes.length)return;if(this.currentKeyframe>=this.keyframes.length-1){if(!this.isLooping)return void(this._isPlaying=!1);this.currentKeyframe=0,this.playStartTime=Date.now(),this.renderPose()}this._currentTime=(Date.now()-this.playStartTime)*this._playbackRate;const t=this.keyframes[this.currentKeyframe+1];this.currentTime>t.time&&(this.currentKeyframe++,this.renderPose()),this.updateControls(),this.isPlaying&&requestAnimationFrame((()=>{this.renderFrame()}))}renderPose(){var t;const e=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector("slot");e&&e.assignedElements().forEach((t=>{if(t.draw){t.draw([this.keyframes[this.currentKeyframe]],this.getBoundingClientRect())}}))}get currentTime(){return this._currentTime}set currentTime(t){this.playStartTime=Date.now()-t,this._currentTime=t,this.audio&&(this.audio.currentTime=t/1e3),this.keyframes.length>0&&(this.currentKeyframe=this.findNearestKeyframe(this._currentTime,this.keyframes),this.renderPose())}findNearestKeyframe(t,e,n){if(1===e.length)return 0;const r=n?[n[0],n[1]]:[0,e.length-1];if(r[1]-r[0]<=1)return e[r[1]].time-t<t-e[r[0]].time?r[1]:r[0];const s=r[0],o=r[0]+Math.floor((r[1]-r[0])/2),i=r[1];return t>e[s].time&&t<e[o].time?this.findNearestKeyframe(t,e,[s,o]):this.findNearestKeyframe(t,e,[o,i])}onEnded(){clearInterval(this.timer),this.dispatchEvent(new Event(t,{bubbles:!0,composed:!0}))}attributeChangedCallback(t,e,n){switch(t){case"islooping":this._isLooping=this.hasAttribute("islooping"),this.audio&&(this.audio.loop=this.isLooping);break;case"src":this.loadPoseData(n)}}disconnectedCallback(){clearInterval(this.timer)}}customElements.define("pose-player",Kst);
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const Xst=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Jst=Symbol(),Yst=new Map;class Zst{constructor(t,e){if(this._$cssResult$=!0,e!==Jst)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t}get styleSheet(){let t=Yst.get(this.cssText);return Xst&&void 0===t&&(Yst.set(this.cssText,t=new CSSStyleSheet),t.replaceSync(this.cssText)),t}toString(){return this.cssText}}const Qst=(t,...e)=>{const n=1===t.length?t[0]:e.reduce(((e,n,r)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if("number"==typeof t)return t;throw Error("Value passed to 'css' function must be a 'css' function result: "+t+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+t[r+1]),t[0]);return new Zst(n,Jst)},tot=Xst?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const n of t.cssRules)e+=n.cssText;return(t=>new Zst("string"==typeof t?t:t+"",Jst))(e)})(t):t
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;var eot;const not=window.trustedTypes,rot=not?not.emptyScript:"",sot=window.reactiveElementPolyfillSupport,oot={toAttribute(t,e){switch(e){case Boolean:t=t?rot:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let n=t;switch(e){case Boolean:n=null!==t;break;case Number:n=null===t?null:Number(t);break;case Object:case Array:try{n=JSON.parse(t)}catch(t){n=null}}return n}},iot=(t,e)=>e!==t&&(e==e||t==t),aot={attribute:!0,type:String,converter:oot,reflect:!1,hasChanged:iot};class uot extends HTMLElement{constructor(){super(),this._$Et=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Ei=null,this.o()}static addInitializer(t){var e;null!==(e=this.l)&&void 0!==e||(this.l=[]),this.l.push(t)}static get observedAttributes(){this.finalize();const t=[];return this.elementProperties.forEach(((e,n)=>{const r=this._$Eh(n,e);void 0!==r&&(this._$Eu.set(r,n),t.push(r))})),t}static createProperty(t,e=aot){if(e.state&&(e.attribute=!1),this.finalize(),this.elementProperties.set(t,e),!e.noAccessor&&!this.prototype.hasOwnProperty(t)){const n="symbol"==typeof t?Symbol():"__"+t,r=this.getPropertyDescriptor(t,n,e);void 0!==r&&Object.defineProperty(this.prototype,t,r)}}static getPropertyDescriptor(t,e,n){return{get(){return this[e]},set(r){const s=this[t];this[e]=r,this.requestUpdate(t,s,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)||aot}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const t=Object.getPrototypeOf(this);if(t.finalize(),this.elementProperties=new Map(t.elementProperties),this._$Eu=new Map,this.hasOwnProperty("properties")){const t=this.properties,e=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(const n of e)this.createProperty(n,t[n])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const n=new Set(t.flat(1/0).reverse());for(const t of n)e.unshift(tot(t))}else void 0!==t&&e.push(tot(t));return e}static _$Eh(t,e){const n=e.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof t?t.toLowerCase():void 0}o(){var t;this._$Ep=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$Em(),this.requestUpdate(),null===(t=this.constructor.l)||void 0===t||t.forEach((t=>t(this)))}addController(t){var e,n;(null!==(e=this._$Eg)&&void 0!==e?e:this._$Eg=[]).push(t),void 0!==this.renderRoot&&this.isConnected&&(null===(n=t.hostConnected)||void 0===n||n.call(t))}removeController(t){var e;null===(e=this._$Eg)||void 0===e||e.splice(this._$Eg.indexOf(t)>>>0,1)}_$Em(){this.constructor.elementProperties.forEach(((t,e)=>{this.hasOwnProperty(e)&&(this._$Et.set(e,this[e]),delete this[e])}))}createRenderRoot(){var t;const e=null!==(t=this.shadowRoot)&&void 0!==t?t:this.attachShadow(this.constructor.shadowRootOptions);return((t,e)=>{Xst?t.adoptedStyleSheets=e.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet)):e.forEach((e=>{const n=document.createElement("style"),r=window.litNonce;void 0!==r&&n.setAttribute("nonce",r),n.textContent=e.cssText,t.appendChild(n)}))})(e,this.constructor.elementStyles),e}connectedCallback(){var t;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(t=this._$Eg)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostConnected)||void 0===e?void 0:e.call(t)}))}enableUpdating(t){}disconnectedCallback(){var t;null===(t=this._$Eg)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostDisconnected)||void 0===e?void 0:e.call(t)}))}attributeChangedCallback(t,e,n){this._$AK(t,n)}_$ES(t,e,n=aot){var r,s;const o=this.constructor._$Eh(t,n);if(void 0!==o&&!0===n.reflect){const i=(null!==(s=null===(r=n.converter)||void 0===r?void 0:r.toAttribute)&&void 0!==s?s:oot.toAttribute)(e,n.type);this._$Ei=t,null==i?this.removeAttribute(o):this.setAttribute(o,i),this._$Ei=null}}_$AK(t,e){var n,r,s;const o=this.constructor,i=o._$Eu.get(t);if(void 0!==i&&this._$Ei!==i){const t=o.getPropertyOptions(i),a=t.converter,u=null!==(s=null!==(r=null===(n=a)||void 0===n?void 0:n.fromAttribute)&&void 0!==r?r:"function"==typeof a?a:null)&&void 0!==s?s:oot.fromAttribute;this._$Ei=i,this[i]=u(e,t.type),this._$Ei=null}}requestUpdate(t,e,n){let r=!0;void 0!==t&&(((n=n||this.constructor.getPropertyOptions(t)).hasChanged||iot)(this[t],e)?(this._$AL.has(t)||this._$AL.set(t,e),!0===n.reflect&&this._$Ei!==t&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(t,n))):r=!1),!this.isUpdatePending&&r&&(this._$Ep=this._$E_())}async _$E_(){this.isUpdatePending=!0;try{await this._$Ep}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;this.hasUpdated,this._$Et&&(this._$Et.forEach(((t,e)=>this[e]=t)),this._$Et=void 0);let e=!1;const n=this._$AL;try{e=this.shouldUpdate(n),e?(this.willUpdate(n),null===(t=this._$Eg)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostUpdate)||void 0===e?void 0:e.call(t)})),this.update(n)):this._$EU()}catch(t){throw e=!1,this._$EU(),t}e&&this._$AE(n)}willUpdate(t){}_$AE(t){var e;null===(e=this._$Eg)||void 0===e||e.forEach((t=>{var e;return null===(e=t.hostUpdated)||void 0===e?void 0:e.call(t)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Ep}shouldUpdate(t){return!0}update(t){void 0!==this._$EC&&(this._$EC.forEach(((t,e)=>this._$ES(e,this[e],t))),this._$EC=void 0),this._$EU()}updated(t){}firstUpdated(t){}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var cot;uot.finalized=!0,uot.elementProperties=new Map,uot.elementStyles=[],uot.shadowRootOptions={mode:"open"},null==sot||sot({ReactiveElement:uot}),(null!==(eot=globalThis.reactiveElementVersions)&&void 0!==eot?eot:globalThis.reactiveElementVersions=[]).push("1.3.2");const lot=globalThis.trustedTypes,fot=lot?lot.createPolicy("lit-html",{createHTML:t=>t}):void 0,hot=`lit$${(Math.random()+"").slice(9)}$`,pot="?"+hot,dot=`<${pot}>`,mot=document,yot=(t="")=>mot.createComment(t),got=t=>null===t||"object"!=typeof t&&"function"!=typeof t,bot=Array.isArray,wot=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,vot=/-->/g,xot=/>/g,Not=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,$ot=/'/g,Eot=/"/g,Sot=/^(?:script|style|textarea|title)$/i,_ot=t=>(e,...n)=>({_$litType$:t,strings:e,values:n}),Tot=_ot(1),kot=_ot(2),Aot=Symbol.for("lit-noChange"),Cot=Symbol.for("lit-nothing"),Oot=new WeakMap,Iot=mot.createTreeWalker(mot,129,null,!1),Mot=(t,e)=>{const n=t.length-1,r=[];let s,o=2===e?"<svg>":"",i=wot;for(let e=0;e<n;e++){const n=t[e];let a,u,c=-1,l=0;for(;l<n.length&&(i.lastIndex=l,u=i.exec(n),null!==u);)l=i.lastIndex,i===wot?"!--"===u[1]?i=vot:void 0!==u[1]?i=xot:void 0!==u[2]?(Sot.test(u[2])&&(s=RegExp("</"+u[2],"g")),i=Not):void 0!==u[3]&&(i=Not):i===Not?">"===u[0]?(i=null!=s?s:wot,c=-1):void 0===u[1]?c=-2:(c=i.lastIndex-u[2].length,a=u[1],i=void 0===u[3]?Not:'"'===u[3]?Eot:$ot):i===Eot||i===$ot?i=Not:i===vot||i===xot?i=wot:(i=Not,s=void 0);const f=i===Not&&t[e+1].startsWith("/>")?" ":"";o+=i===wot?n+dot:c>=0?(r.push(a),n.slice(0,c)+"$lit$"+n.slice(c)+hot+f):n+hot+(-2===c?(r.push(void 0),e):f)}const a=o+(t[n]||"<?>")+(2===e?"</svg>":"");if(!Array.isArray(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return[void 0!==fot?fot.createHTML(a):a,r]};class Rot{constructor({strings:t,_$litType$:e},n){let r;this.parts=[];let s=0,o=0;const i=t.length-1,a=this.parts,[u,c]=Mot(t,e);if(this.el=Rot.createElement(u,n),Iot.currentNode=this.el.content,2===e){const t=this.el.content,e=t.firstChild;e.remove(),t.append(...e.childNodes)}for(;null!==(r=Iot.nextNode())&&a.length<i;){if(1===r.nodeType){if(r.hasAttributes()){const t=[];for(const e of r.getAttributeNames())if(e.endsWith("$lit$")||e.startsWith(hot)){const n=c[o++];if(t.push(e),void 0!==n){const t=r.getAttribute(n.toLowerCase()+"$lit$").split(hot),e=/([.?@])?(.*)/.exec(n);a.push({type:1,index:s,name:e[2],strings:t,ctor:"."===e[1]?Bot:"?"===e[1]?zot:"@"===e[1]?Wot:Pot})}else a.push({type:6,index:s})}for(const e of t)r.removeAttribute(e)}if(Sot.test(r.tagName)){const t=r.textContent.split(hot),e=t.length-1;if(e>0){r.textContent=lot?lot.emptyScript:"";for(let n=0;n<e;n++)r.append(t[n],yot()),Iot.nextNode(),a.push({type:2,index:++s});r.append(t[e],yot())}}}else if(8===r.nodeType)if(r.data===pot)a.push({type:2,index:s});else{let t=-1;for(;-1!==(t=r.data.indexOf(hot,t+1));)a.push({type:7,index:s}),t+=hot.length-1}s++}}static createElement(t,e){const n=mot.createElement("template");return n.innerHTML=t,n}}function Dot(t,e,n=t,r){var s,o,i,a;if(e===Aot)return e;let u=void 0!==r?null===(s=n._$Cl)||void 0===s?void 0:s[r]:n._$Cu;const c=got(e)?void 0:e._$litDirective$;return(null==u?void 0:u.constructor)!==c&&(null===(o=null==u?void 0:u._$AO)||void 0===o||o.call(u,!1),void 0===c?u=void 0:(u=new c(t),u._$AT(t,n,r)),void 0!==r?(null!==(i=(a=n)._$Cl)&&void 0!==i?i:a._$Cl=[])[r]=u:n._$Cu=u),void 0!==u&&(e=Dot(t,u._$AS(t,e.values),u,r)),e}class Fot{constructor(t,e){this.v=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}p(t){var e;const{el:{content:n},parts:r}=this._$AD,s=(null!==(e=null==t?void 0:t.creationScope)&&void 0!==e?e:mot).importNode(n,!0);Iot.currentNode=s;let o=Iot.nextNode(),i=0,a=0,u=r[0];for(;void 0!==u;){if(i===u.index){let e;2===u.type?e=new Lot(o,o.nextSibling,this,t):1===u.type?e=new u.ctor(o,u.name,u.strings,this,t):6===u.type&&(e=new Uot(o,this,t)),this.v.push(e),u=r[++a]}i!==(null==u?void 0:u.index)&&(o=Iot.nextNode(),i++)}return s}m(t){let e=0;for(const n of this.v)void 0!==n&&(void 0!==n.strings?(n._$AI(t,n,e),e+=n.strings.length-2):n._$AI(t[e])),e++}}class Lot{constructor(t,e,n,r){var s;this.type=2,this._$AH=Cot,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=n,this.options=r,this._$Cg=null===(s=null==r?void 0:r.isConnected)||void 0===s||s}get _$AU(){var t,e;return null!==(e=null===(t=this._$AM)||void 0===t?void 0:t._$AU)&&void 0!==e?e:this._$Cg}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===t.nodeType&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=Dot(this,t,e),got(t)?t===Cot||null==t||""===t?(this._$AH!==Cot&&this._$AR(),this._$AH=Cot):t!==this._$AH&&t!==Aot&&this.$(t):void 0!==t._$litType$?this.T(t):void 0!==t.nodeType?this.k(t):(t=>{var e;return bot(t)||"function"==typeof(null===(e=t)||void 0===e?void 0:e[Symbol.iterator])})(t)?this.S(t):this.$(t)}M(t,e=this._$AB){return this._$AA.parentNode.insertBefore(t,e)}k(t){this._$AH!==t&&(this._$AR(),this._$AH=this.M(t))}$(t){this._$AH!==Cot&&got(this._$AH)?this._$AA.nextSibling.data=t:this.k(mot.createTextNode(t)),this._$AH=t}T(t){var e;const{values:n,_$litType$:r}=t,s="number"==typeof r?this._$AC(t):(void 0===r.el&&(r.el=Rot.createElement(r.h,this.options)),r);if((null===(e=this._$AH)||void 0===e?void 0:e._$AD)===s)this._$AH.m(n);else{const t=new Fot(s,this),e=t.p(this.options);t.m(n),this.k(e),this._$AH=t}}_$AC(t){let e=Oot.get(t.strings);return void 0===e&&Oot.set(t.strings,e=new Rot(t)),e}S(t){bot(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let n,r=0;for(const s of t)r===e.length?e.push(n=new Lot(this.M(yot()),this.M(yot()),this,this.options)):n=e[r],n._$AI(s),r++;r<e.length&&(this._$AR(n&&n._$AB.nextSibling,r),e.length=r)}_$AR(t=this._$AA.nextSibling,e){var n;for(null===(n=this._$AP)||void 0===n||n.call(this,!1,!0,e);t&&t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){var e;void 0===this._$AM&&(this._$Cg=t,null===(e=this._$AP)||void 0===e||e.call(this,t))}}class Pot{constructor(t,e,n,r,s){this.type=1,this._$AH=Cot,this._$AN=void 0,this.element=t,this.name=e,this._$AM=r,this.options=s,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=Cot}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,e=this,n,r){const s=this.strings;let o=!1;if(void 0===s)t=Dot(this,t,e,0),o=!got(t)||t!==this._$AH&&t!==Aot,o&&(this._$AH=t);else{const r=t;let i,a;for(t=s[0],i=0;i<s.length-1;i++)a=Dot(this,r[n+i],e,i),a===Aot&&(a=this._$AH[i]),o||(o=!got(a)||a!==this._$AH[i]),a===Cot?t=Cot:t!==Cot&&(t+=(null!=a?a:"")+s[i+1]),this._$AH[i]=a}o&&!r&&this.C(t)}C(t){t===Cot?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=t?t:"")}}class Bot extends Pot{constructor(){super(...arguments),this.type=3}C(t){this.element[this.name]=t===Cot?void 0:t}}const Vot=lot?lot.emptyScript:"";class zot extends Pot{constructor(){super(...arguments),this.type=4}C(t){t&&t!==Cot?this.element.setAttribute(this.name,Vot):this.element.removeAttribute(this.name)}}class Wot extends Pot{constructor(t,e,n,r,s){super(t,e,n,r,s),this.type=5}_$AI(t,e=this){var n;if((t=null!==(n=Dot(this,t,e,0))&&void 0!==n?n:Cot)===Aot)return;const r=this._$AH,s=t===Cot&&r!==Cot||t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive,o=t!==Cot&&(r===Cot||s);s&&this.element.removeEventListener(this.name,this,r),o&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,n;"function"==typeof this._$AH?this._$AH.call(null!==(n=null===(e=this.options)||void 0===e?void 0:e.host)&&void 0!==n?n:this.element,t):this._$AH.handleEvent(t)}}class Uot{constructor(t,e,n){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(t){Dot(this,t)}}const jot=window.litHtmlPolyfillSupport;
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var Got,qot;null==jot||jot(Rot,Lot),(null!==(cot=globalThis.litHtmlVersions)&&void 0!==cot?cot:globalThis.litHtmlVersions=[]).push("2.2.6");class Hot extends uot{constructor(){super(...arguments),this.renderOptions={host:this},this._$Dt=void 0}createRenderRoot(){var t,e;const n=super.createRenderRoot();return null!==(t=(e=this.renderOptions).renderBefore)&&void 0!==t||(e.renderBefore=n.firstChild),n}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Dt=((t,e,n)=>{var r,s;const o=null!==(r=null==n?void 0:n.renderBefore)&&void 0!==r?r:e;let i=o._$litPart$;if(void 0===i){const t=null!==(s=null==n?void 0:n.renderBefore)&&void 0!==s?s:null;o._$litPart$=i=new Lot(e.insertBefore(yot(),t),t,void 0,null!=n?n:{})}return i._$AI(t),i})(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),null===(t=this._$Dt)||void 0===t||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),null===(t=this._$Dt)||void 0===t||t.setConnected(!1)}render(){return Aot}}Hot.finalized=!0,Hot._$litElement$=!0,null===(Got=globalThis.litElementHydrateSupport)||void 0===Got||Got.call(globalThis,{LitElement:Hot});const Kot=globalThis.litElementPolyfillSupport;null==Kot||Kot({LitElement:Hot}),(null!==(qot=globalThis.litElementVersions)&&void 0!==qot?qot:globalThis.litElementVersions=[]).push("3.2.0");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const Xot=t=>e=>"function"==typeof e?((t,e)=>(window.customElements.define(t,e),e))(t,e):((t,e)=>{const{kind:n,elements:r}=e;return{kind:n,elements:r,finisher(e){window.customElements.define(t,e)}}})(t,e)
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */,Jot=(t,e)=>"method"===e.kind&&e.descriptor&&!("value"in e.descriptor)?{...e,finisher(n){n.createProperty(e.key,t)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:e.key,initializer(){"function"==typeof e.initializer&&(this[e.key]=e.initializer.call(this))},finisher(n){n.createProperty(e.key,t)}};function Yot(t){return(e,n)=>void 0!==n?((t,e,n)=>{e.constructor.createProperty(n,t)})(t,e,n):Jot(t,e)
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */}var Zot;null===(Zot=window.HTMLSlotElement)||void 0===Zot||Zot.prototype.assignedElements;const Qot=kot`<svg width="700pt" height="700pt" version="1.1" viewBox="0 0 700 700" xmlns="http://www.w3.org/2000/svg">
<path d="m541.52 244.16-334.88-222.88c-28.559-19.039-67.199 1.6797-67.199 35.84v445.2c0 34.719 38.641 54.879 67.199 35.84l334.88-222.88c25.199-16.242 25.199-54.32 0-71.121z"/>
</svg>`,tit=kot`<svg width="700pt" height="700pt" version="1.1" viewBox="0 0 700 700" xmlns="http://www.w3.org/2000/svg">
  <path d="m210 0c-18.566 0-36.367 7.375-49.496 20.504s-20.504 30.93-20.504 49.496v420c0 25.008 13.344 48.117 35 60.621s48.344 12.504 70 0 35-35.613 35-60.621v-420c0-18.566-7.375-36.367-20.504-49.496s-30.93-20.504-49.496-20.504z"/>
  <path d="m490 0c-18.566 0-36.367 7.375-49.496 20.504s-20.504 30.93-20.504 49.496v420c0 25.008 13.344 48.117 35 60.621s48.344 12.504 70 0 35-35.613 35-60.621v-420c0-18.566-7.375-36.367-20.504-49.496s-30.93-20.504-49.496-20.504z"/>
</svg>`,eit=kot`<svg width="700pt" height="700pt" version="1.1" viewBox="0 0 700 700" xmlns="http://www.w3.org/2000/svg">
  <path d="m163.52 297.92c17.359 0 31.359-14 31.359-31.359v-99.121h264.88l-36.398 36.398c-12.32 12.32-12.32 32.48 0 44.801 6.1602 6.1602 14 9.5195 22.398 9.5195 7.8398 0 16.238-3.3594 22.398-9.5195l90.16-90.16c6.1602-6.1602 9.5195-14 9.5195-22.398 0-8.3984-3.3594-16.238-9.5195-22.398l-90.156-90.164c-12.32-12.32-32.48-12.32-44.801 0-12.32 12.32-12.32 32.48 0 44.801l36.398 36.398h-296.24c-17.359 0-31.359 14-31.359 31.359v130.48c0 17.363 14 31.363 31.359 31.363z"/>
  <path d="m536.48 262.08c-17.359 0-31.359 14-31.359 31.359v99.121h-265.44l36.398-36.398c12.32-12.32 12.32-32.48 0-44.801s-32.48-12.32-44.801 0l-89.598 90.719c-6.1602 6.1602-9.5195 14-9.5195 22.398 0 8.3984 3.3594 16.238 8.9609 22.398l90.16 90.16c6.1602 6.1602 14 9.5195 22.398 9.5195 7.8398 0 16.238-3.3594 22.398-9.5195 12.32-12.32 12.32-32.48 0-44.801l-36.398-36.398h296.24c17.359 0 31.359-14 31.359-31.359l0.003906-131.04c0.55859-17.363-13.441-31.363-30.801-31.363z"/>
</svg>`,nit=kot`<svg width="700pt" height="700pt" version="1.1" viewBox="0 0 700 700" xmlns="http://www.w3.org/2000/svg">
  <path transform="matrix(5.6566 0 0 5.6566 95.455 28.283)" d="m75 45c0 16.569-13.431 30-30 30s-30-13.431-30-30 13.431-30 30-30 30 13.431 30 30"/>
</svg>`,rit=kot`<svg width="700pt" height="700pt" version="1.1" viewBox="0 0 700 700" xmlns="http://www.w3.org/2000/svg">
    <path d="m350 70c-19.695 0.36328-36.191 7.1992-49.488 20.512-13.301 13.309-20.137 29.809-20.512 49.488v140c0.36328 19.695 7.1992 36.191 20.512 49.488 13.309 13.301 29.809 20.137 49.488 20.512 19.695-0.36328 36.191-7.1992 49.488-20.512 13.301-13.309 20.137-29.809 20.512-49.488v-140c-0.36328-19.695-7.1992-36.191-20.512-49.488-13.309-13.301-29.809-20.137-49.488-20.512zm0-35c29.902 0.73438 54.695 10.945 74.375 30.625s29.891 44.473 30.625 74.375v140c-0.73438 29.902-10.945 54.695-30.625 74.375s-44.473 29.891-74.375 30.625c-29.902-0.73438-54.695-10.945-74.375-30.625s-29.891-44.473-30.625-74.375v-140c0.73438-29.902 10.945-54.695 30.625-74.375s44.473-29.891 74.375-30.625zm-17.5 455v-35c-44.484-1.0938-81.578-16.504-111.28-46.219s-45.109-66.809-46.219-111.28v-17.5c0-5.1094 1.6406-9.3047 4.918-12.582 3.2773-3.2773 7.4727-4.918 12.582-4.918s9.3047 1.6406 12.582 4.918c3.2773 3.2773 4.918 7.4727 4.918 12.582v17.5c0.73438 34.637 12.676 63.531 35.824 86.676 23.145 23.148 52.039 35.09 86.676 35.824h35c34.637-0.73438 63.531-12.676 86.676-35.824 23.148-23.145 35.09-52.039 35.824-86.676v-17.5c0-5.1094 1.6367-9.3047 4.918-12.582 3.2773-3.2773 7.4727-4.918 12.582-4.918s9.3047 1.6406 12.582 4.918c3.2812 3.2773 4.918 7.4727 4.918 12.582v17.5c-1.0938 44.484-16.504 81.578-46.219 111.28-29.715 29.707-66.809 45.109-111.28 46.219v35h35c5.1094 0 9.3047 1.6367 12.582 4.918 3.2773 3.2773 4.918 7.4727 4.918 12.582s-1.6406 9.3047-4.918 12.582c-3.2773 3.2812-7.4727 4.918-12.582 4.918h-105c-5.1094 0-9.3047-1.6367-12.582-4.918-3.2773-3.2773-4.918-7.4727-4.918-12.582s1.6406-9.3047 4.918-12.582c3.2773-3.2812 7.4727-4.918 12.582-4.918z"/>
</svg>`,sit=kot`<svg transform="translate(0, 2)" width="700pt" height="700pt" version="1.1" viewBox="0 0 700 700" xmlns="http://www.w3.org/2000/svg">
    <path d="m227.05 87.426v385.03c-0.011719 13.48 14.574 21.914 26.25 15.176l333.41-192.51c11.672-6.7344 11.672-23.582 0-30.32l-333.41-192.51c-10.891-6.2891-26.246 0.94141-26.246 15.141z"/>
    <path d="m122.05 70h35c9.6953 0 17.5 7.8047 17.5 17.5v385c0 9.6953-7.8047 17.5-17.5 17.5h-35c-9.6953 0-17.5-7.8047-17.5-17.5v-385c0-9.6953 7.8047-17.5 17.5-17.5z"/>
 </svg>`,oit=kot`<svg transform="scale(-1, 1) translate(0, 2)" width="700pt" height="700pt" version="1.1" viewBox="0 0 700 700" xmlns="http://www.w3.org/2000/svg">
    <path d="m227.05 87.426v385.03c-0.011719 13.48 14.574 21.914 26.25 15.176l333.41-192.51c11.672-6.7344 11.672-23.582 0-30.32l-333.41-192.51c-10.891-6.2891-26.246 0.94141-26.246 15.141z"/>
    <path d="m122.05 70h35c9.6953 0 17.5 7.8047 17.5 17.5v385c0 9.6953-7.8047 17.5-17.5 17.5h-35c-9.6953 0-17.5-7.8047-17.5-17.5v-385c0-9.6953 7.8047-17.5 17.5-17.5z"/>
 </svg>`;var iit=function(t,e,n,r){for(var s,o=arguments.length,i=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r,a=t.length-1;a>=0;a--)(s=t[a])&&(i=(o<3?s(i):o>3?s(e,n,i):s(e,n))||i);return o>3&&i&&Object.defineProperty(e,n,i),i};let ait=class extends Hot{constructor(){super(...arguments),this.disabled=!1}render(){return Tot`<button><slot></slot></button>`}};ait.styles=[Qst`
      :host {
        display: inline-block;
        padding-left: 3px;
        padding-right: 3px;
      }
      
      :host([disabled]) {
        pointer-events: none;
      }

      :host([disabled]) button {
        opacity: .25;
      }

      button {
        display: inline-block;
        background-color: transparent;
        border: none;
        color: white;
        padding: 5px;
        height: 100%;
      }

      button:hover {
        background-color: rgba(0, 0, 0, 0.1);
      }

      button svg,
      button ::slotted(svg) {
        width: 18px;
        height: 18px;
        fill: white;
        vertical-align: middle;
        filter: drop-shadow(1px 3px .5px rgb(50, 55, 58));
      }

      button:hover svg,
      button:hover ::slotted(svg) {
        margin-top: 1px;
        filter: drop-shadow(1px 1px .5px rgb(44, 39, 39));
      }
    `],iit([Yot({type:Boolean,reflect:!0})],ait.prototype,"disabled",void 0),ait=iit([Xot("pose-button")],ait);var uit=function(t,e,n,r){for(var s,o=arguments.length,i=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r,a=t.length-1;a>=0;a--)(s=t[a])&&(i=(o<3?s(i):o>3?s(e,n,i):s(e,n))||i);return o>3&&i&&Object.defineProperty(e,n,i),i};let cit=class extends ait{constructor(){super(...arguments),this.playing=!1}render(){return Tot`<button>${this.playing?tit:Qot}</button>`}};cit.styles=[...ait.styles],uit([Yot({type:Boolean,reflect:!0})],cit.prototype,"playing",void 0),cit=uit([Xot("pose-play-button")],cit);var lit=function(t,e,n,r){for(var s,o=arguments.length,i=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r,a=t.length-1;a>=0;a--)(s=t[a])&&(i=(o<3?s(i):o>3?s(e,n,i):s(e,n))||i);return o>3&&i&&Object.defineProperty(e,n,i),i};let fit=class extends ait{constructor(){super(...arguments),this.active=!1}render(){return Tot`<button><slot></slot></button>`}};fit.styles=[...ait.styles,Qst`
      :host([active]) button {
        background-color: rgba(0, 0, 0, 0.25);
      }
      
      :host([active]) button ::slotted(svg) {
        margin-top: 1px;
        filter: drop-shadow(1px 1px 1px rgb(50, 55, 58));
      }
    `],lit([Yot({type:Boolean,reflect:!0})],fit.prototype,"active",void 0),fit=lit([Xot("pose-toggle-button")],fit);var hit=function(t,e,n,r){for(var s,o=arguments.length,i=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r,a=t.length-1;a>=0;a--)(s=t[a])&&(i=(o<3?s(i):o>3?s(e,n,i):s(e,n))||i);return o>3&&i&&Object.defineProperty(e,n,i),i};let pit=class extends Hot{constructor(){super(...arguments),this.progress=0,this.scrubProgress=-1,this.handlePointerMove=t=>{this.calculateScrubPos(t.clientX),this.requestUpdate()},this.handlePointerUp=()=>{document.removeEventListener("pointermove",this.handlePointerMove),document.removeEventListener("pointerup",this.handlePointerUp),this.scrubProgress=-1,this.requestUpdate()}}handlePointerDown(t){document.addEventListener("pointermove",this.handlePointerMove),document.addEventListener("pointerup",this.handlePointerUp),this.calculateScrubPos(t.clientX),this.requestUpdate()}calculateScrubPos(t){const e=t-this.getBoundingClientRect().x;this.scrubProgress=Math.min(Math.max(e/this.getBoundingClientRect().width*100,0),100);const n=new Event("scrub",{bubbles:!0});this.dispatchEvent(n)}render(){return Tot`<div id="container" @pointerdown=${this.handlePointerDown}>
            <div id="progress" style="width: ${this.scrubProgress>=0?this.scrubProgress:this.progress}%">
            </div>
        </div>`}};pit.styles=Qst`
      :host {
        position: relative;
        display: inline-block;
      }

      #container {
        background-color: #5f6773;
        width: 100%;
        height: 100%;
        position: absolute;
      }

      #progress {
        position: absolute;
        height: 100%;
        background-color: #66b2ea;
      }
    `,hit([Yot({type:Number,reflect:!0})],pit.prototype,"progress",void 0),hit([Yot({type:Number,reflect:!0})],pit.prototype,"scrubProgress",void 0),pit=hit([Xot("pose-timeline")],pit);var dit=function(t,e,n,r){for(var s,o=arguments.length,i=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r,a=t.length-1;a>=0;a--)(s=t[a])&&(i=(o<3?s(i):o>3?s(e,n,i):s(e,n))||i);return o>3&&i&&Object.defineProperty(e,n,i),i};let mit=class extends Hot{constructor(){super(...arguments),this.currentTime=0,this.duration=0,this.isPlaying=!1,this.isLooping=!1,this.isRecording=!1,this.isAudioRecording=!1,this.recordingDuration=-1,this.playbackRate=1,this.canRecord=!1}doAction(t){const e=new l(t,this,{bubbles:!0,composed:!0});this.dispatchEvent(e)}render(){return this.duration===1/0||0===this.duration?this.renderLiveMode():this.renderNonLiveMode()}renderNonLiveMode(){return Tot`<pose-play-button 
                        class="control" 
                        ?disabled=${this.isRecording}
                        ?playing=${this.isPlaying}
                        @click=${()=>this.doAction(l.TOGGLE_PLAYBACK)}>
                    </pose-play-button>
                    <div class="divider"></div>
                    <pose-button ?disabled=${this.isRecording} @click=${()=>this.doAction(l.STEP_FORWARD)}>${sit}</pose-button>
                    <div class="divider"></div>
                    <pose-button ?disabled=${this.isRecording} @click=${()=>this.doAction(l.STEP_BACKWARD)}>${oit}</pose-button>
                    <div class="divider"></div>
                    ${this.renderRecordingControls()}
                    
                    ${this.isRecording?void 0:Tot`
                    <pose-timeline 
                        class="control"
                        @scrub=${t=>{this.currentTime=t.target.scrubProgress/100*this.duration,this.doAction(l.TIMELINE_SCRUB)}}
                        progress=${this.currentTime/this.duration*100}>
                    </pose-timeline>
                    <div class="divider"></div>
                    <span class="time">${f.formatTime(this.currentTime)} / ${f.formatTime(this.duration)}</span>
                    <div class="divider"></div>
                    <pose-toggle-button 
                        class="control"
                        @click=${()=>this.doAction(l.LOOP)}
                        ?active=${this.isLooping}>
                        ${eit}
                    </pose-toggle-button>
                    <div class="divider"></div>
                    <pose-toggle-button
                            class="control"
                            @click=${()=>{1===this.playbackRate?this.playbackRate=.1:this.playbackRate=1,this.doAction(l.PLAYBACK_RATE_UPDATE)}}
                            ?active=${.1===this.playbackRate}>
                        .1x
                    </pose-toggle-button>`}`}renderLiveMode(){return this.renderRecordingControls()}renderRecordingControls(){if(this.canRecord)return Tot`<pose-toggle-button
                class="control record"
                ?disabled=${this.isAudioRecording}
                @click=${()=>this.doAction(l.TOGGLE_RECORD_POSE)}
                ?active=${this.isRecording&&!this.isAudioRecording}>
            ${nit}
        </pose-toggle-button>
        <div class="divider"></div>
        <pose-toggle-button
                class="control record"
                ?disabled=${this.isRecording&&!this.isAudioRecording}
                @click=${()=>this.doAction(l.TOGGLE_RECORD_POSE_AND_AUDIO)}
                ?active=${this.isAudioRecording}>
            ${nit}<span>+</span>${rit}
        </pose-toggle-button>
        <div class="divider"></div>
        
        ${this.isRecording&&this.recordingDuration>-1?Tot`
        <span class="recording-time">${f.formatTime(this.recordingDuration)}</span>
        <div class="divider"></div>`:void 0}`}};mit.styles=Qst`
      :host {
        background-color: #5f6773;
        height: 25px;
        display: flex;
        align-items: center;
        font-family: 'Open Sans', arial, sans-serif;
        color: white;
        font-size: small;
        bottom: 0;
      }

      span.time,
      span.recording-time {
        filter: drop-shadow(1px 3px .5px rgb(50, 55, 58));
        padding-left: 10px;
        padding-right: 10px;
      }

      .divider {
        height: 66%;
        width: 1px;
        background-color: #8292a2;
      }

      .control {
        height: 100%;
      }

      :host([isRecording]) span.recording-time {
        color: #ffc3c7;
      }

      .control.record[active] span,
      .control.record[active] svg {
        fill: #dd3344;
        color: #dd3344;
      }

      pose-timeline {
        flex: 1;
        height: 100%;
      }
    `,dit([Yot({type:Number,reflect:!0})],mit.prototype,"currentTime",void 0),dit([Yot({type:Number,reflect:!0})],mit.prototype,"duration",void 0),dit([Yot({type:Boolean,reflect:!0})],mit.prototype,"isPlaying",void 0),dit([Yot({type:Boolean,reflect:!0})],mit.prototype,"isLooping",void 0),dit([Yot({type:Boolean,reflect:!0})],mit.prototype,"isRecording",void 0),dit([Yot({type:Boolean,reflect:!0})],mit.prototype,"isAudioRecording",void 0),dit([Yot({type:Number,reflect:!0})],mit.prototype,"recordingDuration",void 0),dit([Yot({type:Number,reflect:!0})],mit.prototype,"playbackRate",void 0),dit([Yot({type:Boolean,reflect:!0})],mit.prototype,"canRecord",void 0),mit=dit([Xot("pose-playback-controls")],mit);class yit extends HTMLElement{constructor(){super(),this.dotSize=2,this.dotColor="#ff0000",this.offsetX=0,this.offsetY=0,this.offsetX=0,this.offsetY=0,this.attachShadow({mode:"open"}),this.shadowRoot&&(this.shadowRoot.innerHTML="\n            <style>\n                :host {\n                    display: inline-block;\n                }\n\n                canvas {\n                    position: relative;\n                }\n            </style>\n            <canvas></canvas>")}static get observedAttributes(){return["dotsize","dotcolor","dotbackcolor"]}clear(){this.canvas&&this.canvasContext&&this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height)}resize(){this.clear(),this.canvasContext=null}draw(t,e){var n;this.canvas&&this.canvasContext&&this.canvas.width===e.width&&this.canvas.height===e.height||(this.canvas=null===(n=this.shadowRoot)||void 0===n?void 0:n.querySelector("canvas"),this.canvas&&(this.canvas.style.left=`${e.x}px`,this.canvas.style.top=`${e.y}px`,this.canvas.width=e.width,this.canvas.height=e.height,this.offsetX=e.x,this.offsetY=e.y,this.canvasContext=this.canvas.getContext("2d"))),this.canvasContext&&this.canvas&&(this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvasContext.fillStyle=this.dotColor,t.forEach((t=>{t.points.forEach((t=>{t.position&&this.drawPoints(t.position),t.positions&&t.positions.forEach((t=>this.drawPoints(t)))}))})))}drawPoints(t){var e,n,r,s,o;const i=t[0]*((null===(e=this.canvas)||void 0===e?void 0:e.width)||0),a=t[1]*((null===(n=this.canvas)||void 0===n?void 0:n.height)||0);if(this.dotBackColor){const e=1,n=t[2]/e,r=yit.InterpolateColor(this.dotColor,this.dotBackColor,n);this.canvasContext&&(this.canvasContext.fillStyle=r)}null===(r=this.canvasContext)||void 0===r||r.beginPath(),null===(s=this.canvasContext)||void 0===s||s.arc(i,a,this.dotSize,0,2*Math.PI,!1),null===(o=this.canvasContext)||void 0===o||o.fill()}drawGrid(){if(this.canvasContext&&this.canvas){this.canvasContext.strokeStyle="#ffff00";for(let t=0;t<this.canvas.width;t+=10)this.canvasContext.beginPath(),this.canvasContext.moveTo(t,0),this.canvasContext.lineTo(t,this.canvas.height),this.canvasContext.stroke();for(let t=0;t<this.canvas.height;t+=10)this.canvasContext.beginPath(),this.canvasContext.moveTo(0,t),this.canvasContext.lineTo(this.canvas.width,t),this.canvasContext.stroke()}}async attributeChangedCallback(t,e,n){switch(t){case"dotsize":this.dotSize=n;break;case"dotcolor":this.dotColor=n;break;case"dotbackcolor":this.dotBackColor=n}}static AdjustColorBrightness(t,e){const n=parseInt(t,16);return((255&n)+e|(n>>8&255)+e<<8|(n>>16)+e<<16).toString(16)}static InterpolateColor(t,e,n){var r,s;const o=null===(r=t.substr(1,t.length).match(/.{1,2}/g))||void 0===r?void 0:r.map((t=>parseInt(t,16)*(1-n))),i=null===(s=e.substr(1,e.length).match(/.{1,2}/g))||void 0===s?void 0:s.map((t=>parseInt(t,16)*n));if(o&&i){const t=[0,1,2].map((t=>Math.min(Math.round(o[t]+i[t]),255)));return`#${t.reduce(((t,e)=>(t<<8)+e),0).toString(16).padStart(6,"0")}`}return"#000000"}}customElements.define("visualization-canvas",yit);export{hO as BodyPixVideo,ez as FaceLandmarkVideo,Hst as HandPoseVideo,p as KeyframeEvent,mit as PlaybackControls,JQ as PoseDetectionVideo,Kst as PosePlayer,yit as VisualizationCanvas};
