const t={VIDEO_END:"videoend",VIDEO_PAUSE:"videopause",VIDEO_PLAY:"videoplay",VIDEO_LOOP:"videoloop",VIDEO_SOURCE_CHANGED:"videosourcechanged",TIME_UPDATE:"videotimeupdate",METADATA:"videometadata",POSE_TRACKING_STARTED:"startposetracking",END_RECORDING:"endrecording",READY:"ready"};class e extends Event{constructor(t,n,r){super(e.Type,r),this.action=t,this.state=this.toMinimalState(n)}toMinimalState(t){return{currentTime:t.currentTime,duration:t.duration,isLooping:t.isLooping,isPlaying:t.isPlaying,isRecording:t.isRecording,isAudioRecording:t.isAudioRecording,recordingDuration:t.recordingDuration,playbackRate:t.playbackRate,canRecord:t.canRecord}}}e.Type="playcontrolsevent",e.TOGGLE_PLAYBACK="onTogglePlayback",e.PLAYBACK_TIME_UPDATE="onPlaybackTimeUpdate",e.PLAYBACK_RATE_UPDATE="onPlaybackRateUpdate",e.TIMELINE_SCRUB="onTimelineScrub",e.TOGGLE_RECORD_POSE="onRecordPose",e.TOGGLE_RECORD_POSE_AND_AUDIO="onRecordPoseAndAudio",e.STEP_FORWARD="onStepForward",e.STEP_BACKWARD="onStepBackward",e.LOOP="onLoopChange";class n extends HTMLElement{constructor(){super(),this._playbackRate=this.hasAttribute("playbackrate")?Number(this.getAttribute("playbackrate")):1,this._isLooping=this.hasAttribute("islooping"),this._src=this.hasAttribute("src")?this.getAttribute("src"):void 0,this._isPlaying=!1,this._isRecording=!1,this._isAudioRecording=!1,this._currentTime=0,this._duration=0,this._recordingDuration=-1,this.visibleMediaRect={x:0,y:0,width:0,height:0},this.addEventListener(e.Type,this.handleControlsEvent)}connectedCallback(){this.dispatchEvent(new Event(t.READY,{composed:!0,bubbles:!0}))}get canRecord(){return!1}get playbackRate(){return this._playbackRate}set playbackRate(t){t&&this.setAttribute("playbackrate",String(t)),this.changePlaybackRate(t)}get isLooping(){return this._isLooping}set isLooping(t){t?this.setAttribute("islooping",""):this.removeAttribute("islooping")}get src(){return this._src}set src(t){void 0===t?this.removeAttribute("src"):this.setAttribute("src",t)}get isPlaying(){return this._isPlaying}get isRecording(){return this._isRecording}get isAudioRecording(){return this._isAudioRecording}get currentTime(){return this._currentTime}set currentTime(t){this.seekTo(t)}get duration(){return this._duration}get recordingDuration(){return this._recordingDuration}get width(){return this.getBoundingClientRect().width}get height(){return this.getBoundingClientRect().height}get aspectRatio(){return this.visibleMediaRect.width/this.visibleMediaRect.height}get videoBounds(){return{x:this.visibleMediaRect.x,y:this.visibleMediaRect.y,width:this.visibleMediaRect.width,height:this.visibleMediaRect.height}}get naturalSize(){return{width:this.visibleMediaRect.width,height:this.visibleMediaRect.height}}pause(){}play(){}togglePlayback(){}step(t){}seekTo(t){}changePlaybackRate(t){}updateControls(){var t;const e=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector("slot");e&&e.assignedElements().forEach((t=>{const e=t;e&&(e.isLooping=this.isLooping,e.isPlaying=this.isPlaying,e.currentTime=this.currentTime,e.duration=this.duration,e.recordingDuration=this.recordingDuration,e.isRecording=this.isRecording,e.isAudioRecording=this.isAudioRecording,e.playbackRate=this.playbackRate,e.canRecord=this.canRecord)}))}handleControlsEvent(t){switch(t.action){case e.TOGGLE_PLAYBACK:this.isPlaying?this.pause():this.play(),this.updateControls();break;case e.LOOP:this.isLooping=!t.state.isLooping,this.updateControls();break;case e.STEP_FORWARD:this.pause(),this.step(1);break;case e.STEP_BACKWARD:this.pause(),this.step(-1);break;case e.TIMELINE_SCRUB:this.currentTime=t.state.currentTime;break;case e.PLAYBACK_RATE_UPDATE:this.playbackRate=t.state.playbackRate}}static formatTime(t){if(t){const e=Math.floor(t/1e3),n=Math.floor(e/60);return`${2===n.toString().length?n.toString():"0"+n.toString()}:${2===(e%60).toString().length?(e%60).toString():"0"+(e%60).toString()}`}return"00:00"}}class r extends n{constructor(){var e;super(),this.isComponentMounted=!1,this._useCamera=this.hasAttribute("usecamera"),this.attachShadow({mode:"open"}),this.shadowRoot&&(this.shadowRoot.innerHTML="\n            <style>\n                :host {\n                    display: inline-block;\n                    overflow: hidden;\n                    position: relative;\n                    background-color: black;\n                }\n                \n                :host(.connected) {\n                    display: inline-block;\n                }\n                \n                video, ::slotted(*) {\n                    position: absolute;\n                }\n                    \n                ::slotted(*) {\n                    width: 100%;\n                }\n            </style>\n            <video playsinline></video>\n            <slot></slot>"),this.videoEl=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector("video"),this._isLooping&&(this.videoEl.loop=!0),this._isPlaying=!1,this.videoEl.onloadedmetadata=()=>this.onMetadata(),this.videoEl.onloadeddata=()=>{(this.hasAttribute("autoplay")||this.hasAttribute("usecamera"))&&(this.hasAttribute("mute")&&(this.videoEl.muted=!0),this.play())},this.videoEl.onpause=()=>{this._isPlaying=!1,this.updateControls(),clearInterval(this.timer),this.dispatchEvent(new Event(t.VIDEO_PAUSE,{bubbles:!0,composed:!0}))},this.videoEl.onended=()=>this.onEnded(),this.videoEl.onplaying=()=>{this._isPlaying?this.dispatchEvent(new Event(t.VIDEO_LOOP,{bubbles:!0,composed:!0})):(this._isPlaying=!0,this.videoEl.playbackRate=this._playbackRate,clearInterval(this.timer),this.timer=window.setInterval((()=>{this.onTimerUpdate()}),100),this.dispatchEvent(new Event(t.VIDEO_PLAY,{bubbles:!0,composed:!0}))),this.updateControls()}}static get observedAttributes(){return["usecamera","src","islooping","playbackrate"]}get videoElement(){return this.videoEl}get canRecord(){return!0}get useCamera(){return this._useCamera}set useCamera(t){t?this.setAttribute("usecamera",""):this.removeAttribute("usecamera")}onTimerUpdate(){this._currentTime=1e3*this.videoEl.currentTime,this.updateControls(),this.dispatchEvent(new Event(t.TIME_UPDATE,{bubbles:!0,composed:!0}))}pause(){this.videoEl.pause()}play(){this.videoEl.play()}togglePlayback(){this.isPlaying?this.pause():this.play(),this.updateControls()}step(t){this.pause(),this.videoEl.currentTime+=.04166*t}seekTo(t){this.videoEl.currentTime=t/1e3}changePlaybackRate(t){this.videoEl.playbackRate=t}get naturalSize(){return{width:this.videoEl.videoWidth,height:this.videoEl.videoHeight}}get aspectRatio(){return this.naturalSize.width/this.naturalSize.height}onEnded(){clearInterval(this.timer),this.dispatchEvent(new Event(t.VIDEO_END,{bubbles:!0,composed:!0}))}onMetadata(){this.resize(),this.dispatchEvent(new Event(t.METADATA,{bubbles:!0,composed:!0})),this._duration=1e3*this.videoEl.duration,this.updateControls()}connectedCallback(){super.connectedCallback(),this.classList.toggle("connected",!0),this.isComponentMounted=!0,setTimeout((()=>this.loadCurrentSource()),1e3)}async loadCurrentSource(){let e=!1;this.hasAttribute("src")&&(this.videoEl.srcObject=null,this.videoEl.src=this.getAttribute("src")||"",this.stream&&(this.stream.getTracks()[0].stop(),this.stream=void 0),e=!0),this.hasAttribute("usecamera")?(this.stream=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0}),this.videoEl.srcObject=this.stream,this.videoEl.muted=!0,e=!0):!this.hasAttribute("usecamera")&&this.videoEl.srcObject&&(this.videoEl.srcObject=null,this.stream&&(this.stream.getTracks()[0].stop(),this.stream=void 0),e=!0),e&&this.dispatchEvent(new Event(t.VIDEO_SOURCE_CHANGED,{bubbles:!0,composed:!0}))}async attributeChangedCallback(t,e,n){switch(t){case"src":this._src=n,n!==e&&this.isComponentMounted&&this.loadCurrentSource();break;case"usecamera":this._useCamera=this.hasAttribute("usecamera"),this.isComponentMounted&&this.loadCurrentSource();break;case"islooping":this._isLooping=this.hasAttribute("islooping"),this.videoEl.loop=this._isLooping;break;case"playbackrate":this._playbackRate=Number(this.getAttribute("playbackRate")),this.videoEl.playbackRate=this.playbackRate}}resize(){const t=this.getBoundingClientRect();if(0===t.width||0===t.height)return;let e=t.width,n=t.height;const r=t.width/t.height;let s,o;r<this.aspectRatio?(n=t.width/this.aspectRatio,o=t.height/2-n/2,s=0):r>this.aspectRatio?(e=t.height*this.aspectRatio,s=t.width/2-e/2,o=0):(o=0,s=0),this.visibleMediaRect.x=s,this.visibleMediaRect.y=o,this.visibleMediaRect.width=e,this.visibleMediaRect.height=n,this.videoEl.setAttribute("width",String(e)),this.videoEl.setAttribute("height",String(n)),this.videoEl.style.left=`${s}px`,this.videoEl.style.top=`${o}px`}disconnectedCallback(){if(clearInterval(this.timer),this.isComponentMounted=!1,this.stream){this.stream.getTracks().forEach((t=>{t.stop()}))}}}customElements.define("video-element",r);class s extends Event{constructor(t,e,n){super(s.EventName,n),this.poseType=t,this.keyframes=e}getPartLocation(t,e=0){if(this.keyframes.length>e){const n=this.keyframes[e].points.filter((e=>t===e.name));if(n.length>0)return n[0]}}}s.EventName="poseKeyframe";class o extends r{constructor(){super(),this._keyframes=[],this._minConfidence=Number(this.getAttribute("minconfidence")),this.hasStarted=!1,this.forceOneTimePoseProcess=!1,this.addEventListener(e.Type,this.handleControlsEvent)}get poseType(){return"posebase"}get parts(){return[]}static get observedAttributes(){return[...r.observedAttributes,"minconfidence"]}get keyframes(){return this._keyframes.slice()}set minConfidence(t){this.setAttribute("minconfidence",String(t))}get minConfidence(){return this._minConfidence}get recording(){return{keyframes:this.keyframes,audio:this.audioData,duration:this.recordingDuration}}step(t){super.step(t),this.forceOneTimePoseProcess=!0}onPoseFrame(e){var n;this.hasStarted||(this.hasStarted=!0,this.dispatchEvent(new Event(t.POSE_TRACKING_STARTED,{bubbles:!0,composed:!0})));const r=null===(n=this.shadowRoot)||void 0===n?void 0:n.querySelector("slot");if(r&&r.assignedElements().forEach((t=>{if(t.draw){t.draw(e,this.videoBounds)}})),e.length>0){const t=new s(this.poseType,e,{bubbles:!0,composed:!0});this.dispatchEvent(t)}this.isRecording&&this._keyframes.push(...e)}onTimerUpdate(){this.isRecording&&this.recordingStartTime&&(this._recordingDuration=Date.now()-this.recordingStartTime),super.onTimerUpdate()}startRecording(e=!1){if(!this.isRecording&&(this.isPlaying||this.play(),this._isRecording=!0,this._isAudioRecording=e,this.recordingStartTime=Date.now(),this._keyframes=[],this.recordedAudio=void 0,this.audioData=void 0,this.updateControls(),e)){const e=this.videoEl.captureStream();if(e.getAudioTracks().length>0){const n=new MediaStream;n.addTrack(e.getAudioTracks()[0]);const r=[];this.audioRecorder=new MediaRecorder(n),this.audioRecorder.ondataavailable=t=>{r.push(t.data)},this.audioRecorder.onstop=()=>{this.recordedAudio=new Blob(r);const e=new FileReader;e.readAsDataURL(this.recordedAudio),new Promise((()=>{e.onloadend=()=>{this.audioData=e.result.replace("application/octet-stream","audio/webm"),this.dispatchEvent(new Event(t.END_RECORDING,{bubbles:!0,composed:!0}))}}))},this.audioRecorder.start(1e3)}}}stopRecording(){this._isRecording=!1,this._isAudioRecording=!1,this.recordingStartTime&&(this._recordingDuration=Date.now()-this.recordingStartTime),this.updateControls(),this.audioRecorder?(this.audioRecorder.stop(),this.audioRecorder=void 0):this.dispatchEvent(new Event(t.END_RECORDING,{bubbles:!0,composed:!0}))}onEnded(){super.onEnded(),this.stopRecording()}handleControlsEvent(t){switch(super.handleControlsEvent(t),t.action){case e.TOGGLE_RECORD_POSE:this._isRecording?this.stopRecording():this.startRecording(!1);break;case e.TOGGLE_RECORD_POSE_AND_AUDIO:this._isRecording?this.stopRecording():this.startRecording(!0)}}async attributeChangedCallback(t,e,n){if(await super.attributeChangedCallback(t,e,n),"minconfidence"===t)this._minConfidence=Number(this.getAttribute("minconfidence"))}}function i(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(n){if("default"!==n&&!(n in t)){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}))})),Object.freeze(t)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */customElements.define("videopose-element",o);class a{refCount(t){return u("refCount")}incRef(t){return u("incRef")}timerAvailable(){return!0}time(t){return u("time")}read(t){return u("read")}readSync(t){return u("readSync")}readToGPU(t,e){return u("readToGPU")}numDataIds(){return u("numDataIds")}disposeData(t,e){return u("disposeData")}write(t,e,n){return u("write")}move(t,e,n,r,s){return u("move")}memory(){return u("memory")}floatPrecision(){return u("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return u("dispose")}}function u(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,f(t,e,n)}function l(t,e,n){return Math.max(t,Math.min(e,n))}function f(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function h(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function p(t,e,n=""){h(g(t,e),(()=>n+` Shapes ${t} and ${e} must match`))}function d(t){h(null!=t,(()=>"The input to the tensor constructor must be a non-null value."))}function m(t,e=[],n=!1){if(null==e&&(e=[]),Array.isArray(t)||_(t)&&!n)for(let r=0;r<t.length;++r)m(t[r],e,n);else e.push(t);return e}function y(t){if(0===t.length)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function g(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function b(t){return t%1==0}function w(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function v(t,e){const n=e.length;return t=null==t?e.map(((t,e)=>e)):[].concat(t),h(t.every((t=>t>=-n&&t<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`)),h(t.every((t=>b(t))),(()=>`All values in axis param must be integers but got axis ${t}`)),t.map((t=>t<0?n+t:t))}function x(t,e){const n=[],r=[],s=null!=e&&Array.isArray(e)&&0===e.length,o=null==e||s?null:v(e,t).sort();let i=0;for(let e=0;e<t.length;++e){if(null!=o){if(o[i]===e&&1!==t[e])throw new Error(`Can't squeeze axis ${e} since its dim '${t[e]}' is not 1`);(null==o[i]||o[i]>e)&&1===t[e]&&(n.push(t[e]),r.push(e)),o[i]<=e&&i++}1!==t[e]&&(n.push(t[e]),r.push(e))}return{newShape:n,keptDims:r}}function N(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error(`Unknown data type ${t}`);n=new Uint8Array(e)}return n}function $(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error(`Unknown data type ${t}`);n=new Array(e)}return n}function E(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function S(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function _(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function T(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error(`Unknown dtype ${t}`)}function k(t){if(null==t)return 0;let e=0;return t.forEach((t=>e+=t.length)),e}function A(t){return"string"==typeof t||t instanceof String}function C(t){return"boolean"==typeof t}function O(t){return"number"==typeof t}function I(t){return Array.isArray(t)?I(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":O(t)?"float32":A(t)?"string":C(t)?"bool":"float32"}function M(t){return!!(t&&t.constructor&&t.call&&t.apply)}function R(t,e){for(let n=e;n<t;++n)if(t%n==0)return n;return t}function D(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function F(t,e,n,r=!1){const s=new Array;if(1===e.length){const o=e[0]*(r?2:1);for(let e=0;e<o;e++)s[e]=n[t+e]}else{const o=e[0],i=e.slice(1),a=i.reduce(((t,e)=>t*e))*(r?2:1);for(let e=0;e<o;e++)s[e]=F(t+e*a,i,n,r)}return s}function L(t,e,n=!1){if(0===t.length)return e[0];const r=t.reduce(((t,e)=>t*e))*(n?2:1);if(0===r)return[];if(r!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return F(0,t,e,n)}function P(t,e){const n=B(t,e);for(let t=0;t<n.length;t++)n[t]=1;return n}function B(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function V(t){t.forEach((e=>{h(Number.isInteger(e)&&e>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`))}))}function z(t){return t&&t.then&&"function"==typeof t.then}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=U,this.populateURLFlags()}setPlatform(t,e){null!=this.platform&&(j().getBool("IS_TEST")||j().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=e}registerFlag(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){const e=this.urlFlags[t];j().getBool("IS_TEST")||j().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${e}.`),this.set(t,e)}}async getAsync(t){return t in this.flags||(this.flags[t]=await this.evaluateFlag(t)),this.flags[t]}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(z(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(null==this.flagRegistry[t])throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(null==this.flagRegistry[t])throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const t=this.getQueryParams(this.global.location.search);if("tfjsflags"in t){t.tfjsflags.split(",").forEach((t=>{const[e,n]=t.split(":");this.urlFlags[e]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}(e,n)}))}}}function U(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((t,...n)=>(function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")))),e}function j(){return G}let G=null;var q="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function H(){throw new Error("setTimeout has not been defined")}function K(){throw new Error("clearTimeout has not been defined")}var X=H,J=K;function Y(t){if(X===setTimeout)return setTimeout(t,0);if((X===H||!X)&&setTimeout)return X=setTimeout,setTimeout(t,0);try{return X(t,0)}catch(e){try{return X.call(null,t,0)}catch(e){return X.call(this,t,0)}}}"function"==typeof q.setTimeout&&(X=setTimeout),"function"==typeof q.clearTimeout&&(J=clearTimeout);var Z,Q=[],tt=!1,et=-1;function nt(){tt&&Z&&(tt=!1,Z.length?Q=Z.concat(Q):et=-1,Q.length&&rt())}function rt(){if(!tt){var t=Y(nt);tt=!0;for(var e=Q.length;e;){for(Z=Q,Q=[];++et<e;)Z&&Z[et].run();et=-1,e=Q.length}Z=null,tt=!1,function(t){if(J===clearTimeout)return clearTimeout(t);if((J===K||!J)&&clearTimeout)return J=clearTimeout,clearTimeout(t);try{J(t)}catch(e){try{return J.call(null,t)}catch(e){return J.call(this,t)}}}(t)}}function st(t,e){this.fun=t,this.array=e}st.prototype.run=function(){this.fun.apply(null,this.array)};function ot(){}var it=ot,at=ot,ut=ot,ct=ot,lt=ot,ft=ot,ht=ot;var pt=q.performance||{},dt=pt.now||pt.mozNow||pt.msNow||pt.oNow||pt.webkitNow||function(){return(new Date).getTime()};var mt=new Date;var yt={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];Q.push(new st(t,e)),1!==Q.length||tt||Y(rt)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:it,addListener:at,once:ut,off:ct,removeListener:lt,removeAllListeners:ft,emit:ht,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*dt.call(pt),n=Math.floor(e),r=Math.floor(e%1*1e9);return t&&(n-=t[0],(r-=t[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-mt)/1e3}},gt=yt;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
let bt;function wt(){if(null==bt){let t;if("undefined"!=typeof window)t=window;else if(void 0!==q)t=q;else if(void 0!==gt)t=gt;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}bt=t}return bt}function vt(t,e){const n=function(){const t=wt();return null==t._tfGlobals&&(t._tfGlobals=new Map),t._tfGlobals}();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function xt(...t){j().getBool("IS_TEST")||j().getBool("PROD")||console.warn(...t)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Nt=vt("kernelRegistry",(()=>new Map)),$t=vt("gradRegistry",(()=>new Map));function Et(t,e){const n=kt(t,e);return Nt.get(n)}function St(t){return $t.get(t)}function _t(t){const e=Nt.entries(),n=[];for(;;){const{done:r,value:s}=e.next();if(r)break;const[o,i]=s,[a]=o.split("_");a===t&&n.push(i)}return n}function Tt(t){const{kernelName:e,backendName:n}=t,r=kt(e,n);Nt.has(r)&&xt(`The kernel '${e}' for backend '${n}' is already registered`),Nt.set(r,t)}function kt(t,e){return`${e}_${t}`}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var At=Ot,Ct=null;try{Ct=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(Wot){}function Ot(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function It(t){return!0===(t&&t._)}Ot.prototype._,Object.defineProperty(Ot.prototype,"_",{value:!0}),Ot.isLong=It;var Mt={},Rt={};function Dt(t,e){var n,r,s;return e?(s=0<=(t>>>=0)&&t<256)&&(r=Rt[t])?r:(n=Lt(t,(0|t)<0?-1:0,!0),s&&(Rt[t]=n),n):(s=-128<=(t|=0)&&t<128)&&(r=Mt[t])?r:(n=Lt(t,t<0?-1:0,!1),s&&(Mt[t]=n),n)}function Ft(t,e){if(isNaN(t))return e?qt:Gt;if(e){if(t<0)return qt;if(t>=Wt)return Yt}else{if(t<=-Ut)return Zt;if(t+1>=Ut)return Jt}return t<0?Ft(-t,e).neg():Lt(t%zt|0,t/zt|0,e)}function Lt(t,e,n){return new Ot(t,e,n)}Ot.fromInt=Dt,Ot.fromNumber=Ft,Ot.fromBits=Lt;var Pt=Math.pow;function Bt(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return Gt;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return Bt(t.substring(1),e,n).neg();for(var s=Ft(Pt(n,8)),o=Gt,i=0;i<t.length;i+=8){var a=Math.min(8,t.length-i),u=parseInt(t.substring(i,i+a),n);if(a<8){var c=Ft(Pt(n,a));o=o.mul(c).add(Ft(u))}else o=(o=o.mul(s)).add(Ft(u))}return o.unsigned=e,o}function Vt(t,e){return"number"==typeof t?Ft(t,e):"string"==typeof t?Bt(t,e):Lt(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}Ot.fromString=Bt,Ot.fromValue=Vt;var zt=4294967296,Wt=zt*zt,Ut=Wt/2,jt=Dt(1<<24),Gt=Dt(0);Ot.ZERO=Gt;var qt=Dt(0,!0);Ot.UZERO=qt;var Ht=Dt(1);Ot.ONE=Ht;var Kt=Dt(1,!0);Ot.UONE=Kt;var Xt=Dt(-1);Ot.NEG_ONE=Xt;var Jt=Lt(-1,2147483647,!1);Ot.MAX_VALUE=Jt;var Yt=Lt(-1,-1,!0);Ot.MAX_UNSIGNED_VALUE=Yt;var Zt=Lt(0,-2147483648,!1);Ot.MIN_VALUE=Zt;var Qt=Ot.prototype;Qt.toInt=function(){return this.unsigned?this.low>>>0:this.low},Qt.toNumber=function(){return this.unsigned?(this.high>>>0)*zt+(this.low>>>0):this.high*zt+(this.low>>>0)},Qt.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Zt)){var e=Ft(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var s=Ft(Pt(t,6),this.unsigned),o=this,i="";;){var a=o.div(s),u=(o.sub(a.mul(s)).toInt()>>>0).toString(t);if((o=a).isZero())return u+i;for(;u.length<6;)u="0"+u;i=""+u+i}},Qt.getHighBits=function(){return this.high},Qt.getHighBitsUnsigned=function(){return this.high>>>0},Qt.getLowBits=function(){return this.low},Qt.getLowBitsUnsigned=function(){return this.low>>>0},Qt.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Zt)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},Qt.isZero=function(){return 0===this.high&&0===this.low},Qt.eqz=Qt.isZero,Qt.isNegative=function(){return!this.unsigned&&this.high<0},Qt.isPositive=function(){return this.unsigned||this.high>=0},Qt.isOdd=function(){return 1==(1&this.low)},Qt.isEven=function(){return 0==(1&this.low)},Qt.equals=function(t){return It(t)||(t=Vt(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},Qt.eq=Qt.equals,Qt.notEquals=function(t){return!this.eq(t)},Qt.neq=Qt.notEquals,Qt.ne=Qt.notEquals,Qt.lessThan=function(t){return this.comp(t)<0},Qt.lt=Qt.lessThan,Qt.lessThanOrEqual=function(t){return this.comp(t)<=0},Qt.lte=Qt.lessThanOrEqual,Qt.le=Qt.lessThanOrEqual,Qt.greaterThan=function(t){return this.comp(t)>0},Qt.gt=Qt.greaterThan,Qt.greaterThanOrEqual=function(t){return this.comp(t)>=0},Qt.gte=Qt.greaterThanOrEqual,Qt.ge=Qt.greaterThanOrEqual,Qt.compare=function(t){if(It(t)||(t=Vt(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},Qt.comp=Qt.compare,Qt.negate=function(){return!this.unsigned&&this.eq(Zt)?Zt:this.not().add(Ht)},Qt.neg=Qt.negate,Qt.add=function(t){It(t)||(t=Vt(t));var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,o=t.high>>>16,i=65535&t.high,a=t.low>>>16,u=0,c=0,l=0,f=0;return l+=(f+=s+(65535&t.low))>>>16,c+=(l+=r+a)>>>16,u+=(c+=n+i)>>>16,u+=e+o,Lt((l&=65535)<<16|(f&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},Qt.subtract=function(t){return It(t)||(t=Vt(t)),this.add(t.neg())},Qt.sub=Qt.subtract,Qt.multiply=function(t){if(this.isZero())return Gt;if(It(t)||(t=Vt(t)),Ct)return Lt(Ct.mul(this.low,this.high,t.low,t.high),Ct.get_high(),this.unsigned);if(t.isZero())return Gt;if(this.eq(Zt))return t.isOdd()?Zt:Gt;if(t.eq(Zt))return this.isOdd()?Zt:Gt;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(jt)&&t.lt(jt))return Ft(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,o=t.high>>>16,i=65535&t.high,a=t.low>>>16,u=65535&t.low,c=0,l=0,f=0,h=0;return f+=(h+=s*u)>>>16,l+=(f+=r*u)>>>16,f&=65535,l+=(f+=s*a)>>>16,c+=(l+=n*u)>>>16,l&=65535,c+=(l+=r*a)>>>16,l&=65535,c+=(l+=s*i)>>>16,c+=e*u+n*a+r*i+s*o,Lt((f&=65535)<<16|(h&=65535),(c&=65535)<<16|(l&=65535),this.unsigned)},Qt.mul=Qt.multiply,Qt.divide=function(t){if(It(t)||(t=Vt(t)),t.isZero())throw Error("division by zero");var e,n,r;if(Ct)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?Lt((this.unsigned?Ct.div_u:Ct.div_s)(this.low,this.high,t.low,t.high),Ct.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?qt:Gt;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return qt;if(t.gt(this.shru(1)))return Kt;r=qt}else{if(this.eq(Zt))return t.eq(Ht)||t.eq(Xt)?Zt:t.eq(Zt)?Ht:(e=this.shr(1).div(t).shl(1)).eq(Gt)?t.isNegative()?Ht:Xt:(n=this.sub(t.mul(e)),r=e.add(n.div(t)));if(t.eq(Zt))return this.unsigned?qt:Gt;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=Gt}for(n=this;n.gte(t);){e=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(e)/Math.LN2),o=s<=48?1:Pt(2,s-48),i=Ft(e),a=i.mul(t);a.isNegative()||a.gt(n);)a=(i=Ft(e-=o,this.unsigned)).mul(t);i.isZero()&&(i=Ht),r=r.add(i),n=n.sub(a)}return r},Qt.div=Qt.divide,Qt.modulo=function(t){return It(t)||(t=Vt(t)),Ct?Lt((this.unsigned?Ct.rem_u:Ct.rem_s)(this.low,this.high,t.low,t.high),Ct.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},Qt.mod=Qt.modulo,Qt.rem=Qt.modulo,Qt.not=function(){return Lt(~this.low,~this.high,this.unsigned)},Qt.and=function(t){return It(t)||(t=Vt(t)),Lt(this.low&t.low,this.high&t.high,this.unsigned)},Qt.or=function(t){return It(t)||(t=Vt(t)),Lt(this.low|t.low,this.high|t.high,this.unsigned)},Qt.xor=function(t){return It(t)||(t=Vt(t)),Lt(this.low^t.low,this.high^t.high,this.unsigned)},Qt.shiftLeft=function(t){return It(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?Lt(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):Lt(0,this.low<<t-32,this.unsigned)},Qt.shl=Qt.shiftLeft,Qt.shiftRight=function(t){return It(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?Lt(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):Lt(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},Qt.shr=Qt.shiftRight,Qt.shiftRightUnsigned=function(t){if(It(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?Lt(this.low>>>t|e<<32-t,e>>>t,this.unsigned):Lt(32===t?e:e>>>t-32,0,this.unsigned)},Qt.shru=Qt.shiftRightUnsigned,Qt.shr_u=Qt.shiftRightUnsigned,Qt.toSigned=function(){return this.unsigned?Lt(this.low,this.high,!1):this},Qt.toUnsigned=function(){return this.unsigned?this:Lt(this.low,this.high,!0)},Qt.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},Qt.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},Qt.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},Ot.fromBytes=function(t,e,n){return n?Ot.fromBytesLE(t,e):Ot.fromBytesBE(t,e)},Ot.fromBytesLE=function(t,e){return new Ot(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},Ot.fromBytesBE=function(t,e){return new Ot(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const te=At||i({__proto__:null,default:At},[At]);function ee(t){return te.fromString(t,!0,16)}const ne=ee("c3a5c85c97cb3127"),re=ee("b492b66fbe98f273"),se=ee("9ae16a3b2f90404f");function oe(t){return t.xor(t.shru(47))}function ie(t,e,n){const r=t.slice(e,e+n);return te.fromBytes(Array.from(r),!0,!0)}function ae(t,e){return ie(t,e,8)}function ue(t,e){return ie(t,e,4)}function ce(t,e){return 0===e?t:t.shru(e).or(t.shl(64-e))}function le(t,e,n=ee("9ddfea08eb382d69")){let r=t.xor(e).mul(n);r=r.xor(r.shru(47));let s=e.xor(r).mul(n);return s=s.xor(s.shru(47)),s=s.mul(n),s}function fe(t,e,n,r){return function(t,e,n,r,s,o){s=s.add(t),o=ce(o.add(s).add(r),21);const i=s;return s=(s=s.add(e)).add(n),o=o.add(ce(s,44)),[s.add(r),o.add(i)]}(ae(t,e),ae(t,e+8),ae(t,e+16),ae(t,e+24),n,r)}function he(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=m(t)),j().getBool("DEBUG")&&E(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){const e=new Uint8Array(t.length);for(let n=0;n<e.length;++n)0!==Math.round(t[n])&&(e[n]=1);return e}throw new Error(`Unknown data type ${e}`)}function pe(){return j().platform.now()}function de(t,e="utf-8"){return e=e||"utf-8",j().platform.encode(t,e)}function me(t,e="utf-8"){return e=e||"utf-8",j().platform.decode(t,e)}var ye=Object.freeze({__proto__:null,createScalarValue:
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){return"string"===e?de(t):he([t],e)},toTypedArray:he,now:pe,fetch:function(t,e){return j().platform.fetch(t,e)},encodeString:de,decodeString:me,shuffle:c,shuffleCombo:function(t,e){if(t.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${e.length}`);let n=t.length,r=0;for(;n>0;)r=Math.random()*n|0,n--,f(t,n,r),f(e,n,r)},clamp:l,nearestLargerEven:function(t){return t%2==0?t:t+1},swap:f,sum:function(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e},randUniform:function(t,e){const n=Math.random();return e*n+(1-n)*t},distSquared:function(t,e){let n=0;for(let r=0;r<t.length;r++){const s=Number(t[r])-Number(e[r]);n+=s*s}return n},assert:h,assertShapesMatch:p,assertNonNull:d,flatten:m,sizeFromShape:y,isScalarShape:function(t){return 0===t.length},arraysEqual:g,isInt:b,tanh:function(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{const e=Math.exp(2*t);return(e-1)/(e+1)}},sizeToSquarishShape:function(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]},createShuffledIndices:function(t){const e=new Uint32Array(t);for(let n=0;n<t;++n)e[n]=n;return c(e),e},rightPad:w,repeatedTry:function(t,e=(t=>0),n){return new Promise(((r,s)=>{let o=0;const i=()=>{if(t())return void r();o++;const a=e(o);null!=n&&o>=n?s():setTimeout(i,a)};i()}))},inferFromImplicitShape:function(t,e){let n=1,r=-1;for(let e=0;e<t.length;++e)if(t[e]>=0)n*=t[e];else if(-1===t[e]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${e}`);r=e}else if(t[e]<0)throw Error(`Shapes can not be < 0. Found ${t[e]} at dim ${e}`);if(-1===r){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(0===n)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const s=t.slice();return s[r]=e/n,s},parseAxisParam:v,squeezeShape:x,getTypedArrayFromDType:N,getArrayFromDType:$,checkConversionForErrors:E,isValidDtype:S,hasEncodingLoss:function(t,e){return"complex64"!==e&&(("float32"!==e||"complex64"===t)&&(("int32"!==e||"float32"===t||"complex64"===t)&&("bool"!==e||"bool"!==t)))},isTypedArray:_,bytesPerElement:T,bytesFromStringArray:k,isString:A,isBoolean:C,isNumber:O,inferDtype:I,isFunction:M,nearestDivisor:R,computeStrides:D,toNestedArray:L,makeOnesTypedArray:P,makeZerosTypedArray:B,makeZerosNestedTypedArray:function(t,e){const n=t.reduce(((t,e)=>t*e),1);if(null==e||"float32"===e)return L(t,new Float32Array(n));if("int32"===e)return L(t,new Int32Array(n));if("bool"===e)return L(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)},assertNonNegativeIntegerDimensions:V,locToIndex:function(t,e,n){if(0===e)return 0;if(1===e)return t[0];let r=t[t.length-1];for(let e=0;e<t.length-1;++e)r+=n[e]*t[e];return r},indexToLoc:function(t,e,n){if(0===e)return[];if(1===e)return[t];const r=new Array(e);for(let e=0;e<r.length-1;++e)r[e]=Math.floor(t/n[e]),t-=r[e]*n[e];return r[r.length-1]=t,r},isPromise:z,hexToLong:ee,fingerPrint64:function(t,e=t.length){const n=te.fromNumber(81,!0);if(e<=32)return e<=16?function(t,e=t.length){if(e>=8){const n=se.add(2*e),r=ae(t,0).add(se),s=ae(t,e-8);return le(ce(s,37).mul(n).add(r),ce(r,25).add(s).mul(n),n)}if(e>=4){const n=se.add(2*e);return le(ue(t,0).shl(3).add(e),ue(t,e-4),n)}if(e>0){const n=t[0]+(t[e>>1]<<8),r=e+(t[e-1]<<2);return oe(se.mul(n).xor(ne.mul(r))).mul(se)}return se}(t,e):function(t,e=t.length){const n=se.add(2*e),r=ae(t,0).mul(re),s=ae(t,8),o=ae(t,e-8).mul(n),i=ae(t,e-16).mul(se);return le(ce(r.add(s),43).add(ce(o,30)).add(i),r.add(ce(s.add(se),18)).add(o),n)}(t,e);if(e<=64)return function(t,e=t.length){const n=se.add(2*e),r=ae(t,0).mul(se),s=ae(t,8),o=ae(t,e-8).mul(n),i=ae(t,e-16).mul(se),a=ce(r.add(s),43).add(ce(o,30)).add(i),u=le(a,r.add(ce(s.add(se),18)).add(o),n),c=ae(t,16).mul(n),l=ae(t,24),f=a.add(ae(t,e-32)).mul(n),h=u.add(ae(t,e-24)).mul(n);return le(ce(c.add(l),43).add(ce(f,30)).add(h),c.add(ce(l.add(r),18)).add(f),n)}(t,e);let r=n,s=n.mul(re).add(113),o=oe(s.mul(se).add(113)).mul(se),i=[te.UZERO,te.UZERO],a=[te.UZERO,te.UZERO];r=r.mul(se).add(ae(t,0));let u=0;const c=64*(e-1>>6),l=c+(e-1&63)-63;do{r=ce(r.add(s).add(i[0]).add(ae(t,u+8)),37).mul(re),s=ce(s.add(i[1]).add(ae(t,u+48)),42).mul(re),r=r.xor(a[1]),s=s.add(i[0]).add(ae(t,u+40)),o=ce(o.add(a[0]),33).mul(re),i=fe(t,u,i[1].mul(re),r.add(a[0])),a=fe(t,u+32,o.add(a[1]),s.add(ae(t,u+16))),[o,r]=[r,o],u+=64}while(u!==c);const f=re.add(o.and(255).shl(1));return u=l,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),r=ce(r.add(s).add(i[0]).add(ae(t,u+8)),37).mul(f),s=ce(s.add(i[1]).add(ae(t,u+48)),42).mul(f),r=r.xor(a[1].mul(9)),s=s.add(i[0].mul(9).add(ae(t,u+40))),o=ce(o.add(a[0]),33).mul(f),i=fe(t,u,i[1].mul(f),r.add(a[0])),a=fe(t,u+32,o.add(a[1]),s.add(ae(t,u+16))),[o,r]=[r,o],le(le(i[0],a[0],f).add(oe(s).mul(ne)).add(o),le(i[1],a[1],f).add(r),f)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ge{constructor(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new we)}profileKernel(t,e,n){let r;const s=()=>{r=n()};let o;const i=pe();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(s);else{s();for(const t of r)t.dataSync();o=Promise.resolve({kernelMs:pe()-i})}if(j().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let e=0;e<r.length;e++){const n=r[e];n.data().then((e=>{be(e,n.dtype,t)}))}return{kernelName:t,outputs:r,inputs:e,timeMs:o.then((t=>t.kernelMs)),extraInfo:o.then((t=>null!=t.getExtraProfileInfo?t.getExtraProfileInfo():""))}}logKernelProfile(t){const{kernelName:e,outputs:n,timeMs:r,inputs:s,extraInfo:o}=t;n.forEach((t=>{Promise.all([t.data(),r,o]).then((n=>{this.logger.logKernelProfile(e,t,n[0],n[1],s,n[2])}))}))}}function be(t,e,n){if("float32"!==e)return!1;for(let e=0;e<t.length;e++){const r=t[e];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class we{logKernelProfile(t,e,n,r,s,o){const i="number"==typeof r?w(`${r}ms`,9):r.error,a=w(t,25),u=e.rank,c=e.size,l=w(e.shape.toString(),14);let f="";for(const t in s){const n=s[t];if(null!=n){const r=n.shape||e.shape,s=r.length;f+=`${t}: ${s}D ${s>0?r:""} `}}console.log(`%c${a}\t%c${i}\t%c${u}D ${l}\t%c${c}\t%c${f}\t%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ve(t,e,n,r){const s=D(e),o=function(t,e,n,r){const s=y(e),o=r[r.length-1],i=new Array(o).fill(0),a=e.length,u="complex64"===n?Ee(t):t;if(a>1)for(let t=0;t<s/o;t++){const e=t*o;for(let t=0;t<o;t++)i[t]=Math.max(i[t],xe(u[e+t],0,n).length)}return i}(t,e,n,s),i=e.length,a=$e(t,e,n,s,o),u=["Tensor"];return r&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${i}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(a.map((t=>"    "+t)).join("\n")),u.join("\n")}function xe(t,e,n){let r;return r=Array.isArray(t)?`${parseFloat(t[0].toFixed(7))} + ${parseFloat(t[1].toFixed(7))}j`:A(t)?`'${t}'`:"bool"===n?Ne(t):parseFloat(t.toFixed(7)).toString(),w(r,e)}function Ne(t){return 0===t?"false":"true"}function $e(t,e,n,r,s,o=!0){const i="complex64"===n?2:1,a=e[0],u=e.length;if(0===u){if("complex64"===n){return[xe(Ee(t)[0],0,n)]}return"bool"===n?[Ne(t[0])]:[t[0].toString()]}if(1===u){if(a>20){const e=3*i;let r=Array.from(t.slice(0,e)),o=Array.from(t.slice((a-3)*i,a*i));return"complex64"===n&&(r=Ee(r),o=Ee(o)),["["+r.map(((t,e)=>xe(t,s[e],n))).join(", ")+", ..., "+o.map(((t,e)=>xe(t,s[a-3+e],n))).join(", ")+"]"]}return["["+("complex64"===n?Ee(t):Array.from(t)).map(((t,e)=>xe(t,s[e],n))).join(", ")+"]"]}const c=e.slice(1),l=r.slice(1),f=r[0]*i,h=[];if(a>20){for(let e=0;e<3;e++){const r=e*f,o=r+f;h.push(...$e(t.slice(r,o),c,n,l,s,!1))}h.push("...");for(let e=a-3;e<a;e++){const r=e*f,o=r+f;h.push(...$e(t.slice(r,o),c,n,l,s,e===a-1))}}else for(let e=0;e<a;e++){const r=e*f,o=r+f;h.push(...$e(t.slice(r,o),c,n,l,s,e===a-1))}const p=2===u?",":"";h[0]="["+h[0]+p;for(let t=1;t<h.length-1;t++)h[t]=" "+h[t]+p;let d=",\n";for(let t=2;t<u;t++)d+="\n";return h[h.length-1]=" "+h[h.length-1]+"]"+(o?"":d),h}function Ee(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Se{constructor(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=y(t),null!=n){const t=n.length;h(t===this.size,(()=>`Length of values '${t}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||$(e,this.size),this.strides=D(t)}set(t,...e){0===e.length&&(e=[0]),h(e.length===this.rank,(()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`));const n=this.locToIndex(e);this.values[n]=t}get(...t){0===t.length&&(t=[0]);let e=0;for(const n of t){if(n<0||n>=this.shape[e]){const e=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(e)}e++}let n=t[t.length-1];for(let e=0;e<t.length-1;++e)n+=this.strides[e]*t[e];return this.values[n]}locToIndex(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];let e=t[t.length-1];for(let n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e}indexToLoc(t){if(0===this.rank)return[];if(1===this.rank)return[t];const e=new Array(this.shape.length);for(let n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return _e().makeTensor(this.values,this.shape,this.dtype)}}let _e=null,Te=null;class ke{constructor(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=y(t),this.strides=D(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return Te.buffer(this.shape,this.dtype,t)}bufferSync(){return Te.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return L(this.shape,t,"complex64"===this.dtype)}arraySync(){return L(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const t=_e().read(this.dataId);if("string"===this.dtype){const e=await t;try{return e.map((t=>me(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),_e().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=_e().readSync(this.dataId);if("string"===this.dtype)try{return t.map((t=>me(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await _e().read(this.dataId);return"string"===this.dtype?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(_e().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return Te.print(this,t)}clone(){return this.throwIfDisposed(),Te.clone(this)}toString(t=!1){return ve(this.dataSync(),this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),Te.cast(this,t)}variable(t=!0,e,n){return this.throwIfDisposed(),_e().makeVariable(this,t,e,n)}}Object.defineProperty(ke,Symbol.hasInstance,{value:t=>!!t&&null!=t.data&&null!=t.dataSync&&null!=t.throwIfDisposed}),vt("Tensor",(()=>ke));class Ae extends ke{constructor(t,e,n,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=e,this.name=n}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!g(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);_e().disposeTensor(this),this.dataId=t.dataId,_e().incRef(this,null)}dispose(){_e().disposeVariable(this),this.isDisposedInternal=!0}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var Ce,Oe,Ie,Me,Re;Object.defineProperty(Ae,Symbol.hasInstance,{value:t=>t instanceof ke&&null!=t.assign&&t.assign instanceof Function}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(Ce||(Ce={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(Oe||(Oe={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(Ie||(Ie={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(Me||(Me={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(Re||(Re={}));const De={float32:Me,int32:Oe,bool:Ie,complex64:Re};function Fe(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return De[t][e]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Le(t,e){if(t.dtype===e.dtype)return[t,e];const n=Fe(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function Pe(t,e){h(t.dtype===e.dtype,(()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`))}function Be(t){const e=[];return Ve(t,e,new Set),e}function Ve(t,e,n){if(null==t)return;if(t instanceof ke)return void e.push(t);if(r=t,!Array.isArray(r)&&"object"!=typeof r)return;var r;const s=t;for(const t in s){const r=s[t];n.has(r)||(n.add(r),Ve(r,e,n))}}var ze=Object.freeze({__proto__:null,makeTypesMatch:Le,assertTypesMatch:Pe,isTensorInList:function(t,e){return e.some((e=>e.id===t.id))},getTensorsInContainer:Be});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function We(t){return null!=t.kernelName}class Ue{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((t=>t.name))))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class je{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Ue}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;{const{asyncInit:e}=this.initializeBackend(t);if(e)return null}}return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,n=1){return t in this.registryFactory?(xt(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:n},!0)}async setBackend(t){if(null==this.registryFactory[t])throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,null==this.registry[t]){this.backendInstance=null;const{success:e,asyncInit:n}=this.initializeBackend(t);if(!(n?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new ge(this.backendInstance),!0}setupRegisteredKernels(){_t(this.backendName).forEach((t=>{null!=t.setupFunc&&t.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(t){_t(t).forEach((e=>{null!=e.disposeFunc&&e.disposeFunc(this.registry[t])}))}initializeBackend(t){const e=this.registryFactory[t];if(null==e)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const n=e.factory();if(!n||n instanceof a||"function"!=typeof n.then)return this.registry[t]=n,{success:!0,asyncInit:!1};{const e=++this.pendingBackendInitId,r=n.then((n=>!(e<this.pendingBackendInitId)&&(this.registry[t]=n,this.pendingBackendInit=null,!0))).catch((n=>(e<this.pendingBackendInitId||(this.pendingBackendInit=null,xt(`Initialization of backend ${t} failed`),xt(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(e){return xt(`Initialization of backend ${t} failed`),xt(e.stack||e.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority))}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e],{success:r,asyncInit:s}=this.initializeBackend(n);if(s||r)return{name:n,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const n=this.state.tensorInfo.get(e),r=n.backend,s=this.readSync(e),o=r.refCount(e);r.disposeData(e,!0),n.backend=t,t.move(e,s,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let n,r=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=e(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(t,e,n){t();try{const t=n();return e(),t}catch(t){throw e(),t}}nextTensorId(){return je.nextTensorId++}nextVariableId(){return je.nextVariableId++}clone(t){const e=qe.runKernel("Identity",{x:t}),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(t=>({x:()=>{const e={x:t},n={dtype:"float32"};return qe.runKernel("Cast",e,n)}})),[],{}),e}runKernel(t,e,n){null==this.backendName&&this.backend;if(!(null!=Et(t,this.backendName)))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,n){const r=this.backend.numDataIds();let s=0;n.forEach((t=>{s+="complex64"===t.dtype?3:1}));const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=r-e-s-o;if(i>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${i} data ids) after running '${t}'`)}runKernelFunc(t){let e,n=[];const r=this.isTapeOn(),s=this.state.numBytes,o=this.state.numTensors;let i,a;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const u=We(t)?t.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(We(t)){const{kernelName:e,inputs:s,attrs:o}=t;null==this.backendName&&this.backend;const u=Et(e,this.backendName);h(null!=u,(()=>`Cannot find registered kernel '${e}' for backend '${this.backendName}'`)),i=()=>{const t=this.backend.numDataIds();a=u.kernelFunc({inputs:s,attrs:o,backend:this.backend});const i=Array.isArray(a)?a:[a];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(e,t,i);const c=i.map((t=>null!=t.rank?t:this.makeTensorFromTensorInfo(t)));if(r){const t=this.getTensorsForGradient(e,s,c);n=this.saveTensorsForBackwardMode(t)}return c}}else{const{forwardFunc:e}=t,s=t=>{r&&(n=t.map((t=>this.keep(this.clone(t)))))};i=()=>{const t=this.backend.numDataIds();a=this.tidy((()=>e(this.backend,s)));const n=Array.isArray(a)?a:[a];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,t,n),n}}const{inputs:c,attrs:l}=t,f=We(t)?null:t.backwardsFunc;let p;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(p=this.profiler.profileKernel(u,c,(()=>i())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),e=p.outputs):e=i()})),r&&this.addTapeNode(u,c,e,f,n,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map((t=>null!=c[t]?c[t].shape:null)),outputShapes:e.map((t=>t.shape)),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(a)?e:e[0]}saveTensorsForBackwardMode(t){const e=t.map((t=>this.keep(this.clone(t))));return e}getTensorsForGradient(t,e,n){const r=St(t);if(null!=r){const t=r.inputsToSave||[],s=r.outputsToSave||[];let o;r.saveAllInputs?(h(Array.isArray(e),(()=>"saveAllInputs is true, expected inputs to be an array.")),o=Object.keys(e).map((t=>e[t]))):o=t.map((t=>e[t]));const i=n.filter(((t,e)=>s[e]));return o.concat(i)}return[]}makeTensor(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let s=t;"string"===n&&A(t[0])&&(s=t.map((t=>de(t))));const o=r.write(s,e,n),i=new ke(e,n,o,this.nextTensorId());if(this.trackTensor(i,r),"string"===n){const t=this.state.tensorInfo.get(o),e=k(s);this.state.numBytes+=e-t.bytes,t.bytes=e}return i}makeTensorFromDataId(t,e,n,r){const s={dataId:t,shape:e,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(s,r)}makeTensorFromTensorInfo(t,e){const{dataId:n,shape:r,dtype:s}=t,o=new ke(r,s,n,this.nextTensorId());return this.trackTensor(o,e),o}makeVariable(t,e=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.cast(r));const s=new Ae(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[s.name])throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(t,e){this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*T(t.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n})),t instanceof Ae||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,"string"===t.dtype&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),"complex64"!==t.dtype&&"string"!==t.dtype){const e=t.size*T(t.dtype);this.state.numBytes-=e}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((t=>t.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const t of this.state.activeProfile.kernels)t.kernelTimeMs=await t.kernelTimeMs,t.extraInfo=await t.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(t,e,n,r,s,o){const i={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:s},a=St(t);null!=a&&(r=a.gradFunc),null!=r&&(i.gradient=t=>(t=t.map(((t,e)=>{if(null==t){const t=n[e],r=B(t.size,t.dtype);return this.makeTensor(r,t.shape,t.dtype)}return t})),r(t.length>1?t:t[0],s,o))),this.state.activeTape.push(i)}keep(t){return t.kept=!0,t}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=Be(t),n=new Set(e.map((t=>t.id)));for(let t=0;t<this.state.activeScope.track.length;t++){const e=this.state.activeScope.track[t];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach((t=>{t.kept||t.scopeId!==r.id||this.track(t)}))}gradients(t,e,n,r=!1){if(h(e.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const s=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",t)));h(s instanceof ke,(()=>"The result y returned by f() must be a tensor."));const o=function(t,e,n){const r={},s={};for(let t=0;t<e.length;t++)r[e[t].id]=!0;for(let n=0;n<t.length;n++){const o=t[n],i=o.inputs;for(const t in i){const n=i[t];let a=!1;for(let t=0;t<e.length;t++)if(r[n.id]){o.outputs.forEach((t=>r[t.id]=!0)),a=!0,s[o.id]=!0;break}if(a)break}}const o={};o[n.id]=!0;const i={};for(let e=t.length-1;e>=0;e--){const n=t[e],r=n.inputs;for(let t=0;t<n.outputs.length;t++)if(o[n.outputs[t].id]){for(const t in r)o[r[t].id]=!0,i[n.id]=!0;break}}const a=[];for(let e=0;e<t.length;e++){const n=t[e];if(s[n.id]&&i[n.id]){const t={};for(const e in n.inputs){const s=n.inputs[e];r[s.id]&&(t[e]=s)}const e=Object.assign({},n);e.inputs=t,e.outputs=n.outputs,a.push(e)}}return a}(this.state.activeTape,e,s);if(!r&&0===o.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const t={};t[s.id]=null==n?function(t){const e=P(y(t),"float32");return qe.makeTensor(e,t,"float32")}(s.shape):n,function(t,e,n,r){for(let s=e.length-1;s>=0;s--){const o=e[s],i=[];if(o.outputs.forEach((e=>{const n=t[e.id];null!=n?i.push(n):i.push(null)})),null==o.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const e in o.inputs){if(!(e in a))throw new Error(`Cannot backprop through input ${e}. Available gradients found: ${Object.keys(a)}.`);const s=n((()=>a[e]()));if("float32"!==s.dtype)throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${e} must have 'float32' dtype, but has '${s.dtype}'`);const i=o.inputs[e];if(!g(s.shape,i.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${e}' has shape '${s.shape}', which does not match the shape of the input '${i.shape}'`);if(null==t[i.id])t[i.id]=s;else{const e=t[i.id];t[i.id]=r(e,s),e.dispose()}}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,o,(t=>this.tidy(t)),He);const r=e.map((e=>t[e.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((t=>{for(const e of t.saved)e.dispose()})),this.state.activeTape=null),{value:s,grads:r}}))}customGrad(t){return h(M(t),(()=>"The f passed in customGrad(f) must be a function.")),(...e)=>{let n;h(e.every((t=>t instanceof ke)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};e.forEach(((t,e)=>{r[e]=t}));return this.runKernelFunc({forwardFunc:(r,s)=>(n=t(...e,s),h(n.value instanceof ke,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),h(M(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(t,r)=>{const s=n.gradFunc(t,r),o=Array.isArray(s)?s:[s];h(o.length===e.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),h(o.every((t=>t instanceof ke)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const i={};return o.forEach(((t,e)=>{i[e]=()=>t})),i},inputs:r})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)}async time(t){const e=pe(),n=await this.backend.time(t);return n.wallMs=pe()-e,n}track(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Ue;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function Ge(){const t=wt();if(null==t._tfengine){const e=new W(t);t._tfengine=new je(e)}var e;return e=t._tfengine.ENV,G=e,_e=()=>t._tfengine,t._tfengine}je.nextTensorId=0,je.nextVariableId=0;const qe=Ge();function He(t,e){const n={a:t,b:e};return qe.runKernel("Add",n)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Ke;function Xe(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Je=Object.freeze({__proto__:null,mockIsMobile:function(t){Ke=t},isMobile:function(t){if(void 0!==Ke)return Ke;if(t||"undefined"!=typeof navigator&&null!=navigator){if(t||(t=navigator),"ReactNative"===t.product)return!0;const e=t.userAgent||t.vendor||("undefined"!=typeof window?window.opera:"");if(!e){const e=t;return e.userAgentData&&e.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1},isBrowser:Xe});const Ye=j();Ye.registerFlag("DEBUG",(()=>!1),(t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Ye.registerFlag("IS_BROWSER",(()=>Xe())),Ye.registerFlag("IS_NODE",(()=>void 0!==gt&&void 0!==gt.versions&&void 0!==gt.versions.node)),Ye.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),Ye.registerFlag("PROD",(()=>!1)),Ye.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>Ye.getBool("DEBUG"))),Ye.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),Ye.registerFlag("IS_TEST",(()=>!1)),Ye.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>!0)),Ye.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),Ye.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));var Ze=[],Qe=[],tn="undefined"!=typeof Uint8Array?Uint8Array:Array,en=!1;function nn(){en=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,n=t.length;e<n;++e)Ze[e]=t[e],Qe[t.charCodeAt(e)]=e;Qe["-".charCodeAt(0)]=62,Qe["_".charCodeAt(0)]=63}function rn(t,e,n){for(var r,s,o=[],i=e;i<n;i+=3)r=(t[i]<<16)+(t[i+1]<<8)+t[i+2],o.push(Ze[(s=r)>>18&63]+Ze[s>>12&63]+Ze[s>>6&63]+Ze[63&s]);return o.join("")}function sn(t){var e;en||nn();for(var n=t.length,r=n%3,s="",o=[],i=16383,a=0,u=n-r;a<u;a+=i)o.push(rn(t,a,a+i>u?u:a+i));return 1===r?(e=t[n-1],s+=Ze[e>>2],s+=Ze[e<<4&63],s+="=="):2===r&&(e=(t[n-2]<<8)+t[n-1],s+=Ze[e>>10],s+=Ze[e>>4&63],s+=Ze[e<<2&63],s+="="),o.push(s),o.join("")}function on(t,e,n,r,s){var o,i,a=8*s-r-1,u=(1<<a)-1,c=u>>1,l=-7,f=n?s-1:0,h=n?-1:1,p=t[e+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+t[e+f],f+=h,l-=8);for(i=o&(1<<-l)-1,o>>=-l,l+=r;l>0;i=256*i+t[e+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return i?NaN:1/0*(p?-1:1);i+=Math.pow(2,r),o-=c}return(p?-1:1)*i*Math.pow(2,o-r)}function an(t,e,n,r,s,o){var i,a,u,c=8*o-s-1,l=(1<<c)-1,f=l>>1,h=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,i=l):(i=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-i))<1&&(i--,u*=2),(e+=i+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(i++,u/=2),i+f>=l?(a=0,i=l):i+f>=1?(a=(e*u-1)*Math.pow(2,s),i+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,s),i=0));s>=8;t[n+p]=255&a,p+=d,a/=256,s-=8);for(i=i<<s|a,c+=s;c>0;t[n+p]=255&i,p+=d,i/=256,c-=8);t[n+p-d]|=128*m}var un={}.toString,cn=Array.isArray||function(t){return"[object Array]"==un.call(t)};function ln(){return hn.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function fn(t,e){if(ln()<e)throw new RangeError("Invalid typed array length");return hn.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=hn.prototype:(null===t&&(t=new hn(e)),t.length=e),t}function hn(t,e,n){if(!(hn.TYPED_ARRAY_SUPPORT||this instanceof hn))return new hn(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return mn(this,t)}return pn(this,t,e,n)}function pn(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);hn.TYPED_ARRAY_SUPPORT?(t=e).__proto__=hn.prototype:t=yn(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!hn.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|wn(e,n),s=(t=fn(t,r)).write(e,n);s!==r&&(t=t.slice(0,s));return t}(t,e,n):function(t,e){if(bn(e)){var n=0|gn(e.length);return 0===(t=fn(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?fn(t,0):yn(t,e);if("Buffer"===e.type&&cn(e.data))return yn(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function dn(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function mn(t,e){if(dn(e),t=fn(t,e<0?0:0|gn(e)),!hn.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function yn(t,e){var n=e.length<0?0:0|gn(e.length);t=fn(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function gn(t){if(t>=ln())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+ln().toString(16)+" bytes");return 0|t}function bn(t){return!(null==t||!t._isBuffer)}function wn(t,e){if(bn(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return Gn(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return qn(t).length;default:if(r)return Gn(t).length;e=(""+e).toLowerCase(),r=!0}}function vn(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return Rn(this,e,n);case"utf8":case"utf-8":return On(this,e,n);case"ascii":return In(this,e,n);case"latin1":case"binary":return Mn(this,e,n);case"base64":return Cn(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Dn(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function xn(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function Nn(t,e,n,r,s){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=s?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(s)return-1;n=t.length-1}else if(n<0){if(!s)return-1;n=0}if("string"==typeof e&&(e=hn.from(e,r)),bn(e))return 0===e.length?-1:$n(t,e,n,r,s);if("number"==typeof e)return e&=255,hn.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):$n(t,[e],n,r,s);throw new TypeError("val must be string, number or Buffer")}function $n(t,e,n,r,s){var o,i=1,a=t.length,u=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;i=2,a/=2,u/=2,n/=2}function c(t,e){return 1===i?t[e]:t.readUInt16BE(e*i)}if(s){var l=-1;for(o=n;o<a;o++)if(c(t,o)===c(e,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*i}else-1!==l&&(o-=o-l),l=-1}else for(n+u>a&&(n=a-u),o=n;o>=0;o--){for(var f=!0,h=0;h<u;h++)if(c(t,o+h)!==c(e,h)){f=!1;break}if(f)return o}return-1}function En(t,e,n,r){n=Number(n)||0;var s=t.length-n;r?(r=Number(r))>s&&(r=s):r=s;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var i=0;i<r;++i){var a=parseInt(e.substr(2*i,2),16);if(isNaN(a))return i;t[n+i]=a}return i}function Sn(t,e,n,r){return Hn(Gn(e,t.length-n),t,n,r)}function _n(t,e,n,r){return Hn(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function Tn(t,e,n,r){return _n(t,e,n,r)}function kn(t,e,n,r){return Hn(qn(e),t,n,r)}function An(t,e,n,r){return Hn(function(t,e){for(var n,r,s,o=[],i=0;i<t.length&&!((e-=2)<0);++i)r=(n=t.charCodeAt(i))>>8,s=n%256,o.push(s),o.push(r);return o}(e,t.length-n),t,n,r)}function Cn(t,e,n){return 0===e&&n===t.length?sn(t):sn(t.slice(e,n))}function On(t,e,n){n=Math.min(t.length,n);for(var r=[],s=e;s<n;){var o,i,a,u,c=t[s],l=null,f=c>239?4:c>223?3:c>191?2:1;if(s+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=t[s+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=t[s+1],i=t[s+2],128==(192&o)&&128==(192&i)&&(u=(15&c)<<12|(63&o)<<6|63&i)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=t[s+1],i=t[s+2],a=t[s+3],128==(192&o)&&128==(192&i)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&i)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),s+=f}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=4096));return n}(r)}hn.TYPED_ARRAY_SUPPORT=void 0===q.TYPED_ARRAY_SUPPORT||q.TYPED_ARRAY_SUPPORT,ln(),hn.poolSize=8192,hn._augment=function(t){return t.__proto__=hn.prototype,t},hn.from=function(t,e,n){return pn(null,t,e,n)},hn.TYPED_ARRAY_SUPPORT&&(hn.prototype.__proto__=Uint8Array.prototype,hn.__proto__=Uint8Array),hn.alloc=function(t,e,n){return function(t,e,n,r){return dn(e),e<=0?fn(t,e):void 0!==n?"string"==typeof r?fn(t,e).fill(n,r):fn(t,e).fill(n):fn(t,e)}(null,t,e,n)},hn.allocUnsafe=function(t){return mn(null,t)},hn.allocUnsafeSlow=function(t){return mn(null,t)},hn.isBuffer=function(t){return null!=t&&(!!t._isBuffer||Kn(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&Kn(t.slice(0,0))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t))},hn.compare=function(t,e){if(!bn(t)||!bn(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,s=0,o=Math.min(n,r);s<o;++s)if(t[s]!==e[s]){n=t[s],r=e[s];break}return n<r?-1:r<n?1:0},hn.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},hn.concat=function(t,e){if(!cn(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return hn.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=hn.allocUnsafe(e),s=0;for(n=0;n<t.length;++n){var o=t[n];if(!bn(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,s),s+=o.length}return r},hn.byteLength=wn,hn.prototype._isBuffer=!0,hn.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)xn(this,e,e+1);return this},hn.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)xn(this,e,e+3),xn(this,e+1,e+2);return this},hn.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)xn(this,e,e+7),xn(this,e+1,e+6),xn(this,e+2,e+5),xn(this,e+3,e+4);return this},hn.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?On(this,0,t):vn.apply(this,arguments)},hn.prototype.equals=function(t){if(!bn(t))throw new TypeError("Argument must be a Buffer");return this===t||0===hn.compare(this,t)},hn.prototype.inspect=function(){var t="";return this.length>0&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(t+=" ... ")),"<Buffer "+t+">"},hn.prototype.compare=function(t,e,n,r,s){if(!bn(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===s&&(s=this.length),e<0||n>t.length||r<0||s>this.length)throw new RangeError("out of range index");if(r>=s&&e>=n)return 0;if(r>=s)return-1;if(e>=n)return 1;if(this===t)return 0;for(var o=(s>>>=0)-(r>>>=0),i=(n>>>=0)-(e>>>=0),a=Math.min(o,i),u=this.slice(r,s),c=t.slice(e,n),l=0;l<a;++l)if(u[l]!==c[l]){o=u[l],i=c[l];break}return o<i?-1:i<o?1:0},hn.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},hn.prototype.indexOf=function(t,e,n){return Nn(this,t,e,n,!0)},hn.prototype.lastIndexOf=function(t,e,n){return Nn(this,t,e,n,!1)},hn.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var s=this.length-e;if((void 0===n||n>s)&&(n=s),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return En(this,t,e,n);case"utf8":case"utf-8":return Sn(this,t,e,n);case"ascii":return _n(this,t,e,n);case"latin1":case"binary":return Tn(this,t,e,n);case"base64":return kn(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return An(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},hn.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function In(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(127&t[s]);return r}function Mn(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(t[s]);return r}function Rn(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var s="",o=e;o<n;++o)s+=jn(t[o]);return s}function Dn(t,e,n){for(var r=t.slice(e,n),s="",o=0;o<r.length;o+=2)s+=String.fromCharCode(r[o]+256*r[o+1]);return s}function Fn(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function Ln(t,e,n,r,s,o){if(!bn(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function Pn(t,e,n,r){e<0&&(e=65535+e+1);for(var s=0,o=Math.min(t.length-n,2);s<o;++s)t[n+s]=(e&255<<8*(r?s:1-s))>>>8*(r?s:1-s)}function Bn(t,e,n,r){e<0&&(e=4294967295+e+1);for(var s=0,o=Math.min(t.length-n,4);s<o;++s)t[n+s]=e>>>8*(r?s:3-s)&255}function Vn(t,e,n,r,s,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function zn(t,e,n,r,s){return s||Vn(t,0,n,4),an(t,e,n,r,23,4),n+4}function Wn(t,e,n,r,s){return s||Vn(t,0,n,8),an(t,e,n,r,52,8),n+8}hn.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),hn.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=hn.prototype;else{var s=e-t;n=new hn(s,void 0);for(var o=0;o<s;++o)n[o]=this[o+t]}return n},hn.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||Fn(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r},hn.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||Fn(t,e,this.length);for(var r=this[t+--e],s=1;e>0&&(s*=256);)r+=this[t+--e]*s;return r},hn.prototype.readUInt8=function(t,e){return e||Fn(t,1,this.length),this[t]},hn.prototype.readUInt16LE=function(t,e){return e||Fn(t,2,this.length),this[t]|this[t+1]<<8},hn.prototype.readUInt16BE=function(t,e){return e||Fn(t,2,this.length),this[t]<<8|this[t+1]},hn.prototype.readUInt32LE=function(t,e){return e||Fn(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},hn.prototype.readUInt32BE=function(t,e){return e||Fn(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},hn.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||Fn(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r>=(s*=128)&&(r-=Math.pow(2,8*e)),r},hn.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||Fn(t,e,this.length);for(var r=e,s=1,o=this[t+--r];r>0&&(s*=256);)o+=this[t+--r]*s;return o>=(s*=128)&&(o-=Math.pow(2,8*e)),o},hn.prototype.readInt8=function(t,e){return e||Fn(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},hn.prototype.readInt16LE=function(t,e){e||Fn(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},hn.prototype.readInt16BE=function(t,e){e||Fn(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},hn.prototype.readInt32LE=function(t,e){return e||Fn(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},hn.prototype.readInt32BE=function(t,e){return e||Fn(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},hn.prototype.readFloatLE=function(t,e){return e||Fn(t,4,this.length),on(this,t,!0,23,4)},hn.prototype.readFloatBE=function(t,e){return e||Fn(t,4,this.length),on(this,t,!1,23,4)},hn.prototype.readDoubleLE=function(t,e){return e||Fn(t,8,this.length),on(this,t,!0,52,8)},hn.prototype.readDoubleBE=function(t,e){return e||Fn(t,8,this.length),on(this,t,!1,52,8)},hn.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||Ln(this,t,e,n,Math.pow(2,8*n)-1,0);var s=1,o=0;for(this[e]=255&t;++o<n&&(s*=256);)this[e+o]=t/s&255;return e+n},hn.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||Ln(this,t,e,n,Math.pow(2,8*n)-1,0);var s=n-1,o=1;for(this[e+s]=255&t;--s>=0&&(o*=256);)this[e+s]=t/o&255;return e+n},hn.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||Ln(this,t,e,1,255,0),hn.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},hn.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||Ln(this,t,e,2,65535,0),hn.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):Pn(this,t,e,!0),e+2},hn.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||Ln(this,t,e,2,65535,0),hn.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):Pn(this,t,e,!1),e+2},hn.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||Ln(this,t,e,4,4294967295,0),hn.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):Bn(this,t,e,!0),e+4},hn.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||Ln(this,t,e,4,4294967295,0),hn.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Bn(this,t,e,!1),e+4},hn.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);Ln(this,t,e,n,s-1,-s)}var o=0,i=1,a=0;for(this[e]=255&t;++o<n&&(i*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},hn.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);Ln(this,t,e,n,s-1,-s)}var o=n-1,i=1,a=0;for(this[e+o]=255&t;--o>=0&&(i*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},hn.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||Ln(this,t,e,1,127,-128),hn.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},hn.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||Ln(this,t,e,2,32767,-32768),hn.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):Pn(this,t,e,!0),e+2},hn.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||Ln(this,t,e,2,32767,-32768),hn.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):Pn(this,t,e,!1),e+2},hn.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||Ln(this,t,e,4,2147483647,-2147483648),hn.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):Bn(this,t,e,!0),e+4},hn.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||Ln(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),hn.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Bn(this,t,e,!1),e+4},hn.prototype.writeFloatLE=function(t,e,n){return zn(this,t,e,!0,n)},hn.prototype.writeFloatBE=function(t,e,n){return zn(this,t,e,!1,n)},hn.prototype.writeDoubleLE=function(t,e,n){return Wn(this,t,e,!0,n)},hn.prototype.writeDoubleBE=function(t,e,n){return Wn(this,t,e,!1,n)},hn.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var s,o=r-n;if(this===t&&n<e&&e<r)for(s=o-1;s>=0;--s)t[s+e]=this[s+n];else if(o<1e3||!hn.TYPED_ARRAY_SUPPORT)for(s=0;s<o;++s)t[s+e]=this[s+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},hn.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var s=t.charCodeAt(0);s<256&&(t=s)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!hn.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var i=bn(t)?t:Gn(new hn(t,r).toString()),a=i.length;for(o=0;o<n-e;++o)this[o+e]=i[o%a]}return this};var Un=/[^+\/0-9A-Za-z-_]/g;function jn(t){return t<16?"0"+t.toString(16):t.toString(16)}function Gn(t,e){var n;e=e||1/0;for(var r=t.length,s=null,o=[],i=0;i<r;++i){if((n=t.charCodeAt(i))>55295&&n<57344){if(!s){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(i+1===r){(e-=3)>-1&&o.push(239,191,189);continue}s=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),s=n;continue}n=65536+(s-55296<<10|n-56320)}else s&&(e-=3)>-1&&o.push(239,191,189);if(s=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function qn(t){return function(t){var e,n,r,s,o,i;en||nn();var a=t.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===t[a-2]?2:"="===t[a-1]?1:0,i=new tn(3*a/4-o),r=o>0?a-4:a;var u=0;for(e=0,n=0;e<r;e+=4,n+=3)s=Qe[t.charCodeAt(e)]<<18|Qe[t.charCodeAt(e+1)]<<12|Qe[t.charCodeAt(e+2)]<<6|Qe[t.charCodeAt(e+3)],i[u++]=s>>16&255,i[u++]=s>>8&255,i[u++]=255&s;return 2===o?(s=Qe[t.charCodeAt(e)]<<2|Qe[t.charCodeAt(e+1)]>>4,i[u++]=255&s):1===o&&(s=Qe[t.charCodeAt(e)]<<10|Qe[t.charCodeAt(e+1)]<<4|Qe[t.charCodeAt(e+2)]>>2,i[u++]=s>>8&255,i[u++]=255&s),i}(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(Un,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function Hn(t,e,n,r){for(var s=0;s<r&&!(s+n>=e.length||s>=t.length);++s)e[s+n]=t[s];return s}function Kn(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function Xn(t,e){let n=t;if(_(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||_(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&j().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Jn(t,r,[]),r}function Jn(t,e,n){if(n=n||[],!Array.isArray(t)&&!_(t))return void h(0===e.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`));h(e.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`)),h(t.length===e[0],(()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`));const r=e.slice(1);for(let e=0;e<t.length;++e)Jn(t[e],r,n.concat(e))}function Yn(t,e,n,r){if("string_or_numeric"!==t){if(null==t)throw new Error("Expected dtype cannot be null.");if("numeric"!==t&&t!==e||"numeric"===t&&"string"===e)throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}}function Zn(t,e,n,r="numeric"){if(t instanceof ke)return Yn(r,t.dtype,e,n),t;let s=I(t);if("string"!==s&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),Yn(r,s,e,n),null==t||!_(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){const r=null==t?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const o=Xn(t,s);_(t)||Array.isArray(t)||(t=[t]);const i="string"!==s?he(t,s):m(t,[],!0);return qe.makeTensor(i,o,s)}function Qn(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map(((t,s)=>Zn(t,`${e}[${s}]`,n,r)))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tr(t){const e=Object.keys(t);if(1!==e.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const s=(...t)=>{qe.startScope(n);try{const e=r(...t);return z(e)&&console.error("Cannot return a Promise inside of tidy."),qe.endScope(e),e}catch(t){throw qe.endScope(null),t}};return Object.defineProperty(s,"name",{value:n,configurable:!0}),s}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const er=tr({complex_:function(t,e){const n=Zn(t,"real","complex"),r=Zn(e,"imag","complex");p(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const s={real:n,imag:r};return qe.runKernel("Complex",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nr(t,e,n,r){if(null==r&&(r=I(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!_(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){V(e);const t=y(e),r=y(n);h(t===r,(()=>`Based on the provided shape, [${e}], the tensor should have ${t} values but has ${r}`));for(let t=0;t<n.length;++t){const r=n[t],s=t!==n.length-1||r!==y(e.slice(t));h(n[t]===e[t]||!s,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `))}}return _(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?he(t,r):m(t,[],!0),qe.makeTensor(t,e,r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rr(t,e,n){return nr(t,e,Xn(t,n),n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sr={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};function or(t,e){const n={};let r,s=0;for(const o of e){const e=o.name,i=o.dtype,a=o.shape,u=y(a);let c;if("quantization"in o){const n=o.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error(`Weight ${o.name} with quantization ${n.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==n.dtype)throw new Error(`Weight ${o.name} has unknown quantization dtype ${n.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==i)throw new Error(`Weight ${o.name} is quantized with ${n.dtype} which only supports weights of type float32 not ${i}.`)}const a=sr[n.dtype],l=t.slice(s,s+u*a),f="uint8"===n.dtype?new Uint8Array(l):new Uint16Array(l);if("float32"===i)if("uint8"===n.dtype||"uint16"===n.dtype){c=new Float32Array(f.length);for(let t=0;t<f.length;t++){const e=f[t];c[t]=e*n.scale+n.min}}else{if("float16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type float32.`);void 0===r&&(r=dr()),c=r(f)}else{if("int32"!==i)throw new Error(`Unsupported dtype in weight '${e}': ${i}`);if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type int32.`);c=new Int32Array(f.length);for(let t=0;t<f.length;t++){const e=f[t];c[t]=Math.round(e*n.scale+n.min)}}s+=u*a}else if("string"===i){const e=y(o.shape);c=[];for(let n=0;n<e;n++){const e=new Uint32Array(t.slice(s,s+4))[0];s+=4;const n=new Uint8Array(t.slice(s,s+e));c.push(n),s+=e}}else{const r=sr[i],o=t.slice(s,s+u*r);if("float32"===i)c=new Float32Array(o);else if("int32"===i)c=new Int32Array(o);else if("bool"===i)c=new Uint8Array(o);else{if("complex64"!==i)throw new Error(`Unsupported dtype in weight '${e}': ${i}`);{c=new Float32Array(o);const t=new Float32Array(c.length/2),r=new Float32Array(c.length/2);for(let e=0;e<t.length;e++)t[e]=c[2*e],r[e]=c[2*e+1];const s=rr(t,a,"float32"),i=rr(r,a,"float32");n[e]=er(s,i),s.dispose(),i.dispose()}}s+=u*r}"complex64"!==i&&(n[e]=rr(c,a,i))}return n}function ir(t){if(null===t)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach((t=>{if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${t.constructor.name}`)}));const r=new Uint8Array(e);let s=0;return n.forEach((t=>{r.set(new Uint8Array(t.buffer),s),s+=t.byteLength})),r.buffer}const ar="undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa;function ur(t){return ar?hn.byteLength(t):new Blob([t]).size}function cr(t){if(1===t.length)return t[0];let e=0;t.forEach((t=>{e+=t.byteLength}));const n=new Uint8Array(e);let r=0;return t.forEach((t=>{n.set(new Uint8Array(t),r),r+=t.byteLength})),n.buffer}function lr(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);const e=t.split("/");return e[e.length-1]}function fr(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),n}async function hr(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),null!=t.weightsManifest){const[r,s]=await e(t.weightsManifest);n.weightSpecs=r,n.weightData=s}return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),n}function pr(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:ur(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:ur(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}function dr(){const t=function(){const t=t=>{let e=t<<13,n=0;for(;0==(8388608&e);)n-=8388608,e<<=1;return e&=-8388609,n+=947912704,e|n},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}(),e=function(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}(),n=function(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}();return r=>{const s=new ArrayBuffer(4*r.length),o=new Uint32Array(s);for(let s=0;s<r.length;s++){const i=r[s],a=t[n[i>>10]+(1023&i)]+e[i>>10];o[s]=a}return new Float32Array(s)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mr{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==mr.instance&&(mr.instance=new mr),mr.instance}static registerSaveRouter(t){mr.getInstance().saveRouters.push(t)}static registerLoadRouter(t){mr.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return mr.getHandlers(t,"save")}static getLoadHandlers(t,e){return mr.getHandlers(t,"load",e)}static getHandlers(t,e,n){const r=[];return("load"===e?mr.getInstance().loadRouters:mr.getInstance().saveRouters).forEach((e=>{const s=e(t,n);null!==s&&r.push(s)})),r}}const yr=t=>mr.getSaveHandlers(t),gr=(t,e)=>mr.getLoadHandlers(t,e)
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */;function br(){if(!j().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t="undefined"==typeof window?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function wr(t){const e=t.result;e.createObjectStore("models_store",{keyPath:"modelPath"}),e.createObjectStore("model_info_store",{keyPath:"modelPath"})}class vr{constructor(t){if(this.indexedDB=br(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise(((t,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>wr(r),r.onsuccess=()=>{const s=r.result;if(null==e){const e=s.transaction("models_store","readonly"),r=e.objectStore("models_store").get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return s.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));t(r.result.modelArtifacts)},r.onerror=t=>(s.close(),n(r.error)),e.oncomplete=()=>s.close()}else{const r=pr(e),o=s.transaction("model_info_store","readwrite");let i=o.objectStore("model_info_store");const a=i.put({modelPath:this.modelPath,modelArtifactsInfo:r});let u;a.onsuccess=()=>{u=s.transaction("models_store","readwrite");const a=u.objectStore("models_store").put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:r});a.onsuccess=()=>t({modelArtifactsInfo:r}),a.onerror=t=>{i=o.objectStore("model_info_store");const e=i.delete(this.modelPath);e.onsuccess=()=>(s.close(),n(a.error)),e.onerror=t=>(s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}}},r.onerror=t=>n(r.error)}))}}vr.URL_SCHEME="indexeddb://";const xr=t=>{return j().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(vr.URL_SCHEME)?(e=t.slice(vr.URL_SCHEME.length),new vr(e)):null;var e};mr.registerSaveRouter(xr),mr.registerLoadRouter(xr);class Nr{constructor(){this.indexedDB=br()}async listModels(){return new Promise(((t,e)=>{const n=this.indexedDB.open("tensorflowjs",1);n.onupgradeneeded=()=>wr(n),n.onsuccess=()=>{const r=n.result,s=r.transaction("model_info_store","readonly"),o=s.objectStore("model_info_store").getAll();o.onsuccess=()=>{const e={};for(const t of o.result)e[t.modelPath]=t.modelArtifactsInfo;t(e)},o.onerror=t=>(r.close(),e(o.error)),s.oncomplete=()=>r.close()},n.onerror=t=>e(n.error)}))}async removeModel(t){var e;return t=(e=t).startsWith(vr.URL_SCHEME)?e.slice(vr.URL_SCHEME.length):e,new Promise(((e,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>wr(r),r.onsuccess=()=>{const s=r.result,o=s.transaction("model_info_store","readwrite"),i=o.objectStore("model_info_store"),a=i.get(t);let u;a.onsuccess=()=>{if(null==a.result)return s.close(),n(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const r=i.delete(t),o=()=>{u=s.transaction("models_store","readwrite");const r=u.objectStore("models_store").delete(t);r.onsuccess=()=>e(a.result.modelArtifactsInfo),r.onerror=t=>n(a.error)};r.onsuccess=o,r.onerror=t=>(o(),s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}},r.onerror=t=>n(r.error)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $r="tensorflowjs_models",Er="info",Sr="model_topology",_r="weight_specs",Tr="weight_data",kr="model_metadata";function Ar(t){return{info:[$r,t,Er].join("/"),topology:[$r,t,Sr].join("/"),weightSpecs:[$r,t,_r].join("/"),weightData:[$r,t,Tr].join("/"),modelMetadata:[$r,t,kr].join("/")}}function Cr(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function Or(t){const e=t.split("/");if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join("/")}class Ir{constructor(t){if(!j().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Ar(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=pr(t);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(ar)return hn.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let t=0,r=e.length;t<r;t++)n+=String.fromCharCode(e[t]);return btoa(n)}(t.weightData));const s={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:r}}catch(t){throw Cr(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(null==t)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=r;const s=this.LS.getItem(this.keys.modelMetadata);if(null!=s){const t=JSON.parse(s);e.format=t.format,e.generatedBy=t.generatedBy,e.convertedBy=t.convertedBy,null!=t.signature&&(e.signature=t.signature),null!=t.userDefinedMetadata&&(e.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(e.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(e.trainingConfig=t.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(null==o)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=function(t){if(ar){const e=hn.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;++t)n.set([e.charCodeAt(t)],t);return n.buffer}(o),e}}Ir.URL_SCHEME="localstorage://";const Mr=t=>{return j().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Ir.URL_SCHEME)?(e=t.slice(Ir.URL_SCHEME.length),new Ir(e)):null;var e};mr.registerSaveRouter(Mr),mr.registerLoadRouter(Mr);class Rr{constructor(){h(j().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),h("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const t={},e=$r+"/",n="/"+Er;for(let r=0;r<this.LS.length;++r){const s=this.LS.key(r);if(s.startsWith(e)&&s.endsWith(n)){t[Or(s)]=JSON.parse(this.LS.getItem(s))}}return t}async removeModel(t){var e;const n=Ar(t=(e=t).startsWith(Ir.URL_SCHEME)?e.slice(Ir.URL_SCHEME.length):e);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(n.info));return Cr(n),r}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dr{constructor(){this.managers={}}static getInstance(){return null==Dr.instance&&(Dr.instance=new Dr),Dr.instance}static registerManager(t,e){h(null!=t,(()=>"scheme must not be undefined or null.")),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),h(t.length>0,(()=>"scheme must not be an empty string."));const n=Dr.getInstance();h(null==n.managers[t],(()=>`A model store manager is already registered for scheme '${t}'.`)),n.managers[t]=e}static getManager(t){const e=this.getInstance().managers[t];if(null==e)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}}function Fr(t){if(-1===t.indexOf("://"))throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Dr.getSchemes().join(",")}`);return{scheme:t.split("://")[0],path:t.split("://")[1]}}async function Lr(t,e,n=!1){h(t!==e,(()=>`Old path and new path are the same: '${t}'`));const r=mr.getLoadHandlers(t);h(r.length>0,(()=>`Copying failed because no load handler is found for source URL ${t}.`)),h(r.length<2,(()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${t}.`));const s=r[0],o=mr.getSaveHandlers(e);h(o.length>0,(()=>`Copying failed because no save handler is found for destination URL ${e}.`)),h(o.length<2,(()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${e}.`));const i=o[0],a=Fr(t).scheme,u=Fr(t).path,c=a===Fr(t).scheme,l=await s.load();n&&c&&await Dr.getManager(a).removeModel(u);const f=await i.save(l);return n&&!c&&await Dr.getManager(a).removeModel(u),f.modelArtifactsInfo}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Pr{fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}}if(j().get("IS_BROWSER")){j().setPlatform("browser",new Pr);try{Dr.registerManager(Ir.URL_SCHEME,new Rr)}catch(t){}try{Dr.registerManager(vr.URL_SCHEME,new Nr)}catch(t){}}const Br=()=>require("node-fetch");let Vr;class zr{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return null!=j().global.fetch?j().global.fetch(t,e):(null==Vr&&(Vr=Br()),Vr(t,e))}now(){const t=gt.hrtime();return 1e3*t[0]+t[1]/1e6}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)}}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Wr(t,e="float32",n){return e=e||"float32",V(t),new Se(t,e,n)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().get("IS_NODE")&&!j().get("IS_BROWSER")&&j().setPlatform("node",new zr);const Ur=tr({cast_:function(t,e){const n=Zn(t,"x","cast");if(!S(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},s={dtype:e};return qe.runKernel("Cast",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jr=tr({clone_:function(t){const e={x:Zn(t,"x","clone","string_or_numeric")};return qe.runKernel("Identity",e)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gr(t,e=!1){console.log(t.toString(e))}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Ge();Te={buffer:Wr,cast:Ur,clone:jr,print:Gr};function qr(t){return new Promise((t=>setTimeout(t))).then(t)}class Hr{constructor(t){if(!j().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(Hr.URL_SCHEME)&&(t=t.slice(Hr.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}async save(t){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n=fr(t,[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]),r=window.URL.createObjectURL(new Blob([JSON.stringify(n)],{type:"application/json"})),s=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(s.download=this.modelJsonFileName,s.href=r,await qr((()=>s.dispatchEvent(new MouseEvent("click")))),null!=t.weightData){const t=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;t.download=this.weightDataFileName,t.href=e,await qr((()=>t.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:pr(t)}}}}Hr.URL_SCHEME="downloads://";class Kr{constructor(t){if(null==t||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.jsonFile=t[0],this.weightsFiles=t.slice(1)}async load(){return new Promise(((t,e)=>{const n=new FileReader;n.onload=n=>{const r=JSON.parse(n.target.result),s=r.modelTopology;if(null==s)return void e(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));if(null==r.weightsManifest)return void e(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));if(0===this.weightsFiles.length)return void t({modelTopology:s});const o=hr(r,(t=>this.loadWeights(t)));t(o)},n.onerror=t=>e(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),n.readAsText(this.jsonFile)}))}loadWeights(t){const e=[],n=[];for(const r of t)e.push(...r.weights),n.push(...r.paths);const r=this.checkManifestAndWeightFiles(t),s=n.map((t=>this.loadWeightsFile(t,r[t])));return Promise.all(s).then((t=>[e,cr(t)]))}loadWeightsFile(t,e){return new Promise(((n,r)=>{const s=new FileReader;s.onload=t=>{const e=t.target.result;n(e)},s.onerror=e=>r(`Failed to weights data from file of path '${t}'.`),s.readAsArrayBuffer(e)}))}checkManifestAndWeightFiles(t){const e=[],n=this.weightsFiles.map((t=>lr(t.name))),r={};for(const s of t)s.paths.forEach((t=>{const s=lr(t);if(-1!==e.indexOf(s))throw new Error(`Duplicate file basename found in weights manifest: '${s}'`);if(e.push(s),-1===n.indexOf(s))throw new Error(`Weight file with basename '${s}' is not provided.`);r[t]=this.weightsFiles[n.indexOf(s)]}));if(e.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${e.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Xr(t,e,n,r){!function(t){h(null!=t&&Array.isArray(t)&&t.length>0,(()=>"promises must be a none empty array"))}(t),function(t,e){h(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${t}`)),h(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${e}`)),h(e>=t,(()=>`startFraction must be no more than endFraction, but got startFraction ${t} and endFraction ${e}`))}(n=null==n?0:n,r=null==r?1:r);let s=0;return Promise.all(t.map((o=>(o.then((o=>{const i=n+ ++s/t.length*(r-n);return e(i),o})),o))))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Jr(t,e){null==e&&(e={});const n=null==e.fetchFunc?j().platform.fetch:e.fetchFunc,r=t.map((t=>n(t,e.requestInit,{isBinary:!0}))),s=(null==e.onProgress?await Promise.all(r):await Xr(r,e.onProgress,0,.5)).map((t=>t.arrayBuffer()));return null==e.onProgress?await Promise.all(s):await Xr(s,e.onProgress,.5,1)}function Yr(t){return async(e,n="",r)=>{const s=e.map((()=>!1)),o={},i=null!=r?r.map((()=>!1)):[],a=[];if(e.forEach(((t,e)=>{let n=0;t.weights.forEach((t=>{const u="quantization"in t?t.quantization.dtype:t.dtype,c=sr[u]*y(t.shape),l=()=>{s[e]=!0,null==o[e]&&(o[e]=[]),o[e].push({manifestEntry:t,groupOffset:n,sizeBytes:c})};null!=r?r.forEach(((e,n)=>{e===t.name&&(l(),i[n]=!0)})):l(),a.push(t.name),n+=c}))})),!i.every((t=>t))){const t=r.filter(((t,e)=>!i[e]));throw new Error(`Could not find weights in manifest with names: ${t.join(", ")}. \nManifest JSON has weights with names: ${a.join(", ")}.`)}const u=s.reduce(((t,e,n)=>(e&&t.push(n),t)),[]),c=[];u.forEach((t=>{e[t].paths.forEach((t=>{const e=n+(n.endsWith("/")?"":"/")+t;c.push(e)}))}));const l=await t(c),f={};let h=0;return u.forEach((t=>{const n=e[t].paths.length;let r=0;for(let t=0;t<n;t++)r+=l[h+t].byteLength;const s=new ArrayBuffer(r),i=new Uint8Array(s);let a=0;for(let t=0;t<n;t++){const e=new Uint8Array(l[h+t]);i.set(e,a),a+=e.byteLength}o[t].forEach((t=>{const e=or(s.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(const t in e)f[t]=e[t]})),h+=n})),f}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mr.registerSaveRouter((t=>j().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Hr.URL_SCHEME)?function(t="model"){return new Hr(t)}(t.slice(Hr.URL_SCHEME.length)):null));class Zr{constructor(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,this.weightUrlConverter=e.weightUrlConverter,null!=e.fetchFunc?(h("function"==typeof e.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=e.fetchFunc):this.fetch=j().platform.fetch,h(null!=t&&t.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(t)&&h(2===t.length,(()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`)),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData;const n=fr(t,[{paths:["./model.weights.bin"],weights:t.weightSpecs}]);e.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin");const r=await this.fetch(this.path,e);if(r.ok)return{modelArtifactsInfo:pr(t),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let e;try{e=await t.json()}catch(t){let e=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=e.modelTopology,r=e.weightsManifest;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return hr(e,(t=>this.loadWeights(t)))}async loadWeights(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),r=t.substring(0,e),s=n>e?t.substring(n):"";return[r+"/",s]}(e),s=this.weightPathPrefix||n,o=[];for(const e of t)o.push(...e.weights);const i=[],a=[];for(const e of t)for(const t of e.paths)null!=this.weightUrlConverter?a.push(this.weightUrlConverter(t)):i.push(s+t+r);this.weightUrlConverter&&i.push(...await Promise.all(a));return[o,cr(await Jr(i,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress}))]}}function Qr(t){return null!=t.match(Zr.URL_SCHEME_REGEX)}Zr.URL_SCHEME_REGEX=/^https?:\/\//;const ts=(t,e)=>{if("undefined"==typeof fetch&&(null==e||null==e.fetchFunc))return null;{let n=!0;if(n=Array.isArray(t)?t.every((t=>Qr(t))):Qr(t),n)return es(t,e)}return null};function es(t,e){return new Zr(t,e)}function ns(t,e){return es(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mr.registerSaveRouter(ts),mr.registerLoadRouter(ts);class rs{constructor(t){this.modelArtifacts=t}load(){return this.modelArtifacts}}class ss{constructor(t){this.saveHandler=t}save(t){return this.saveHandler(t)}}class os{constructor(t){t.load&&(this.load=()=>Promise.resolve(t.load())),t.save&&(this.save=e=>Promise.resolve(t.save(e)))}}function is(t,e,n,r){if(1===arguments.length){return null!=t.modelTopology||null!=t.weightSpecs?new rs(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new rs({modelTopology:t}))}return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new rs({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r})}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var as=Object.freeze({__proto__:null,browserFiles:function(t){return new Kr(t)},browserHTTPRequest:ns,concatenateArrayBuffers:cr,decodeWeights:or,encodeWeights:async function(t,e){const n=[],r=[],s=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);for(let o=0;o<s.length;++o){const i=s[o],a=Array.isArray(t)?t[o].tensor:t[i];if("float32"!==a.dtype&&"int32"!==a.dtype&&"bool"!==a.dtype&&"string"!==a.dtype&&"complex64"!==a.dtype)throw new Error(`Unsupported dtype in weight '${i}': ${a.dtype}`);const u={name:i,shape:a.shape,dtype:a.dtype};if("string"===a.dtype){const t=new Promise((async t=>{const e=await a.bytes(),n=e.reduce(((t,e)=>t+e.length),0)+4*e.length,r=new Uint8Array(n);let s=0;for(let t=0;t<e.length;t++){const n=e[t],o=new Uint8Array(new Uint32Array([n.length]).buffer);r.set(o,s),s+=4,r.set(n,s),s+=n.length}t(r)}));r.push(t)}else r.push(a.data());null!=e&&(u.group=e),n.push(u)}return{data:ir(await Promise.all(r)),specs:n}},fromMemory:function(t,e,n,r){const s=arguments;return new os(is(...s))},fromMemorySync:is,getLoadHandlers:gr,getModelArtifactsForJSON:hr,getModelArtifactsInfoForJSON:pr,getSaveHandlers:yr,http:es,isHTTPScheme:Qr,loadWeights:async function(t,e="",n,r){return Yr((t=>Jr(t,{requestInit:r})))(t,e,n)},registerLoadRouter:t=>mr.registerLoadRouter(t),registerSaveRouter:t=>mr.registerSaveRouter(t),weightsLoaderFactory:Yr,withSaveHandler:function(t){return new ss(t)},withSaveHandlerSync:function(t){return new ss(t)},copyModel:async function(t,e){return Lr(t,e,!1)},listModels:async function(){const t=Dr.getSchemes(),e={};for(const n of t){const t=await Dr.getManager(n).listModels();for(const r in t){e[n+"://"+r]=t[r]}}return e},moveModel:async function(t,e){return Lr(t,e,!0)},removeModel:async function(t){const e=Fr(t);return Dr.getManager(e.scheme).removeModel(e.path)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const us=tr({matMul_:function(t,e,n=!1,r=!1){let s=Zn(t,"a","matMul"),o=Zn(e,"b","matMul");[s,o]=Le(s,o);const i={a:s,b:o},a={transposeA:n,transposeB:r};return qe.runKernel("BatchMatMul",i,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cs=tr({oneHot_:function(t,e,n=1,r=0){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const s={indices:Zn(t,"indices","oneHot","int32")},o={depth:e,onValue:n,offValue:r};return qe.runKernel("OneHot",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ls(){return qe}function fs(t,e){return qe.tidy(t,e)}function hs(t){Be(t).forEach((t=>t.dispose()))}function ps(t){return qe.keep(t)}function ds(){return qe.backendName}function ms(){return qe.backend}const ys=tr({imag_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={input:Zn(t,"input","imag")};return qe.runKernel("Imag",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gs=tr({neg_:function(t){const e={x:Zn(t,"x","neg")};return qe.runKernel("Neg",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bs=tr({real_:function(t){const e={input:Zn(t,"input","real")};return qe.runKernel("Real",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ws=tr({transpose_:function(t,e,n){const r=Zn(t,"x","transpose");if(null==e&&(e=r.shape.map(((t,e)=>e)).reverse()),h(r.rank===e.length,(()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`)),e.forEach((t=>{h(t>=0&&t<r.rank,(()=>"All entries in 'perm' must be between 0 and "+(r.rank-1)+` but got ${e}`))})),r.rank<=1)return r.clone();const s={x:r},o={perm:e};return"complex64"===r.dtype?fs((()=>{let t=bs(r),e=ys(r);return t=qe.runKernel("Transpose",{x:t},o),e=qe.runKernel("Transpose",{x:e},o),n&&(e=gs(e)),er(t,e)})):qe.runKernel("Transpose",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vs=tr({confusionMatrix_:function(t,e,n){const r=Zn(t,"labels","confusionMatrix"),s=Zn(e,"predictions","confusionMatrix");h(null==n||n>0&&Number.isInteger(n),(()=>`If provided, numClasses must be a positive integer, but got ${n}`)),h(1===r.rank,(()=>`Expected the rank of labels to be 1, but got ${r.rank}`)),h(1===s.rank,(()=>`Expected the rank of predictions to be 1, but got ${s.rank}`)),h(r.shape[0]===s.shape[0],(()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${s.shape[0]}. Labels and predictions should have the same number of elements.`)),h(n>0&&Number.isInteger(n),(()=>`numClasses is required to be a positive integer, but got ${n}`));const o=cs(Ur(r,"int32"),n),i=cs(Ur(s,"int32"),n),a=ws(o),u=us(a,i);return Ur(u,"int32")}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var xs=Object.freeze({__proto__:null,confusionMatrix:vs});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ns(t,e){const n=t.length,r=[];for(let s=0;s<n;s++){const o=n-1-s,i=t[o]||1;(e[e.length-1-s]||1)>1&&1===i&&r.unshift(o)}return r}function $s(t,e){const n=[];for(let r=0;r<e.length;r++){const s=t[t.length-r-1],o=e.length-r-1,i=e[o];(null==s||1===s&&i>1)&&n.unshift(o)}return n}function Es(t,e){const n=[],r=Math.max(t.length,e.length);for(let s=0;s<r;s++){let r=t[t.length-s-1];null==r&&(r=1);let o=e[e.length-s-1];if(null==o&&(o=1),1===r)n.unshift(o);else if(1===o)n.unshift(r);else{if(r!==o){throw Error(`Operands could not be broadcast together with shapes ${t} and ${e}.`)}n.unshift(r)}}return n}var Ss=Object.freeze({__proto__:null,getBroadcastDims:Ns,getReductionAxes:$s,assertAndGetBroadcastShape:Es});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _s(t,e,n){if(d(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");const r=Xn(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return nr(t,e,r,n)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Ts;function ks(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,s=!1,o=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)s=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)o=!0;else if(null!=t.getContext)i=!0;else{if(!("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);a=!0}if(s){const e=2;if(s&&t.readyState<e)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=Et("FromPixels",qe.backendName)){const n={pixels:t},r={numChannels:e};return qe.runKernel("FromPixels",n,r)}const[u,c]=s?[t.videoWidth,t.videoHeight]:[t.width,t.height];let l,f;if(i)l=t.getContext("2d").getImageData(0,0,u,c).data;else if(r||n)l=t.data;else if(o||s||a){if(null==Ts)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");Ts=new OffscreenCanvas(1,1).getContext("2d")}else Ts=document.createElement("canvas").getContext("2d");Ts.canvas.width=u,Ts.canvas.height=c,Ts.drawImage(t,0,0,u,c),l=Ts.getImageData(0,0,u,c).data}if(4===e)f=new Int32Array(l);else{const t=u*c;f=new Int32Array(t*e);for(let n=0;n<t;n++)for(let t=0;t<e;++t)f[n*e+t]=l[4*n+t]}return _s(f,[c,u,e],"int32")}function As(t){return"undefined"!=typeof window&&"undefined"!=typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(t instanceof ImageBitmap)&&function(t){return null!=t&&0!==t.width&&0!==t.height}(t)&&!function(t){return null!=t&&t.data instanceof Uint8Array}(t)}const Cs=tr({fromPixels_:ks});var Os=Object.freeze({__proto__:null,fromPixelsAsync:async function(t,e=3){let n=null;if(j().getBool("WRAP_TO_IMAGEBITMAP")&&As(t)){let e;try{e=await createImageBitmap(t,{premultiplyAlpha:"none"})}catch(t){e=null}n=null!=e&&e.width===t.width&&e.height===t.height?e:t}else n=t;return ks(n,e)},toPixels:async function(t,e){let n=Zn(t,"img","toPixels");if(!(t instanceof ke)){const t=n;n=Ur(t,"int32"),t.dispose()}if(2!==n.rank&&3!==n.rank)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const[r,s]=n.shape.slice(0,2),o=2===n.rank?1:n.shape[2];if(o>4||2===o)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${o}`);if("float32"!==n.dtype&&"int32"!==n.dtype)throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`);const i=await n.data(),a="float32"===n.dtype?255:1,u=new Uint8ClampedArray(s*r*4);for(let t=0;t<r*s;++t){const e=[0,0,0,255];for(let r=0;r<o;r++){const s=i[t*o+r];if("float32"===n.dtype){if(s<0||s>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${s}.`)}else if("int32"===n.dtype&&(s<0||s>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${s}.`);1===o?(e[0]=s*a,e[1]=s*a,e[2]=s*a):e[r]=s*a}const r=4*t;u[r+0]=Math.round(e[0]),u[r+1]=Math.round(e[1]),u[r+2]=Math.round(e[2]),u[r+3]=Math.round(e[3])}if(null!=e){e.width=s,e.height=r;const t=e.getContext("2d"),n=new ImageData(u,s,r);t.putImageData(n,0,0)}return n!==t&&n.dispose(),u},fromPixels:Cs});function Is(t,e){const n=t.shape.length,r=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==e.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${n}`);if(0===y(t.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const s=e.shape,o=s[s.length-1];let i=1;for(let t=0;t<s.length-1;++t)i*=s[t];const a=t.shape,u=s.slice();u.pop();let c=1;for(let t=o;t<n;++t)c*=a[t],u.push(a[t]);const l=[...D(t.shape).map((t=>t/c)),1].slice(0,o);return[u,i,c,l]}var Ms=Object.freeze({__proto__:null,prepareAndValidate:Is});function Rs(t,e,n){const r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${s}.`;if(n.rank<s)throw new Error(o+` update.rank < ${s}. `);if(t.length<r+(n.rank-s))throw new Error(o+` Output shape length < ${r+(n.rank-s)}`);if(n.rank!==s+t.length-r)throw new Error(o+" update.rank != "+(s+t.length-r));for(let t=0;t<s;++t)if(n.shape[t]!==e.shape[t])throw new Error(o+` updates.shape[${t}] (${n.shape[t]}) != indices.shape[${t}] (${e.shape[t]}).`);for(let e=0;e<n.rank-s;++e)if(n.shape[e+s]!==t[e+r])throw new Error(o+` updates.shape[${e+s}] (${n.shape[e+s]}) != shape[${e+s}] (${t[e+s]})`)}function Ds(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if("int32"!==e.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===e.size)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(0===t.size)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}Rs(n,e,t)}function Fs(t,e,n){const r=e.shape.length,s=r>1?e.shape[r-1]:1,o=n.length;let i=1;for(let t=s;t<o;++t)i*=n[t];const a=s<1?1:s;return{sliceRank:s,numUpdates:y(e.shape)/a,sliceSize:i,strides:[...D(n.slice(0,s)),1],outputSize:y(n)}}var Ls=Object.freeze({__proto__:null,validateUpdateShape:Rs,validateInput:Ds,calculateShapes:Fs});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ps(t,e,n,r){const s=[...t];for(let t=s.length;t<r.length;t++)s.push(1);for(let t=0;t<n;t++)0===t?s[e]=1:(s.splice(e,0,1),s.pop());return s}function Bs(t,e,n){return n<=t?n:n-(e-1)}function Vs(t,e){const n=[];for(let r=0;r<t;r++)n.push(e+r);return n}function zs(t,e,n,r,s){const o=[...s],i=Vs(n,e);for(let s=0;s<o.length;s++)if(i.indexOf(s)>-1)o[s]=0;else{const i=Bs(e,n,s);let a=r[i];t&1<<i&&(a=0),o[s]=a}return o}function Ws(t,e,n,r,s){const o=[...s],i=Vs(n,e);for(let s=0;s<o.length;s++)if(i.indexOf(s)>-1)o[s]=Number.MAX_SAFE_INTEGER;else{const i=Bs(e,n,s);let a=r[i];t&1<<i&&(a=Number.MAX_SAFE_INTEGER),o[s]=a}for(let t=0;t<o.length;t++){const e=s[t];o[t]<0&&(o[t]+=e),o[t]=l(0,o[t],s[t])}return o}function Us(t,e,n){let r=t[e];return(n&1<<e||null==r)&&(r=1),r}function js(t,e,n,r,s,o){let i=e[s];const a=n[s]||1;(t&1<<s||o&1<<s||null==i)&&(i=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const u=r[s];return i<0&&(i+=u),i=l(0,i,u-1),i}function Gs(t,e,n,r,s,o){let i=e[s];const a=n[s]||1;(t&1<<s||o&1<<s||null==i)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const u=r[s];return i<0&&(i+=u),i=a>0?l(0,i,u):l(-1,i,u-1),i}function qs(t,e,n,r,s,o){if(s[e])return n>0?o[e]:o[e+1&1];{const e=t<0?r+t:t;return e<o[0]?o[0]:e>o[1]?o[1]:e}}var Hs=Object.freeze({__proto__:null,assertParamsValid:function(t,e,n){const r=t.shape.length;h(r===e.length,(()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`)),h(r===n.length,(()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`));for(let s=0;s<r;++s)h(e[s]+n[s]<=t.shape[s],(()=>`Error in slice${r}D: begin[${s}] + size[${s}] (${e[s]+n[s]}) would overflow input.shape[${s}] (${t.shape[s]})`))},maskToAxes:function(t){const e=[];let n=0;for(;t>0;)1&t&&e.push(n),t/=2,n++;return e},computeOutShape:function(t,e,n){const r=[];for(let s=0;s<t.length;s++)r[s]=Math.ceil((e[s]-t[s])/n[s]);return r},stridesWithElidedDims:Ps,getNormalizedAxes:function(t,e,n,r,s,o,i,a,u){const c=t.length;let l=new Array(c),f=new Array(c),h=new Array(c);if(e.length&&n>0){const u=e[0],c=n+1;l=zs(i,u,c,r,t),f=Ws(a,u,c,s,t),h=Ps(o,u,c,t)}else for(let e=0;e<c;e++)l[e]=js(i,r,o,t,e,u),f[e]=Gs(a,s,o,t,e,u),h[e]=Us(o,e,u);return{begin:l,end:f,strides:h}},startIndicesWithElidedDims:zs,stopIndicesWithElidedDims:Ws,stridesForAxis:Us,startForAxis:js,stopForAxis:Gs,isSliceContinous:function(t,e,n){let r=n.length;for(let t=0;t<n.length;t++)if(n[t]>1){r=t;break}for(let s=r+1;s<n.length;s++)if(e[s]>0||n[s]!==t[s])return!1;return!0},computeFlatOffset:function(t,e){let n=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)n+=t[r]*e[r];return n},parseSliceParams:function(t,e,n){let r;const s=t.shape.length;let o;return r="number"==typeof e?[e,...new Array(s-1).fill(0)]:e.length<s?e.concat(new Array(s-e.length).fill(0)):e.slice(),r.forEach((t=>{h(-1!==t,(()=>"slice() does not support negative begin indexing."))})),o=null==n?new Array(s).fill(-1):"number"==typeof n?[n,...new Array(s-1).fill(-1)]:n.length<s?n.concat(new Array(s-n.length).fill(-1)):n,o=o.map(((e,n)=>e>=0?e:(h(-1===e,(()=>`Negative size values should be exactly -1 but got ${e} for the slice() size at index ${n}.`)),t.shape[n]-r[n]))),[r,o]},sliceInfo:function(t,e,n,r,s,o,i,a,u){let c;if(null==r?(c=new Array(e.length),c.fill(1)):c=r,null!=i&&0!=(i&i-1))throw new Error("Multiple ellipses in slice is not allowed.");let l=!1;const f={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};for(let t=0;t<f.dims;t++)l&&0!=(1<<t&a)&&f.numAddAxisAfterEllipsis++,1<<t&i&&(l=!0);l||(f.ellipsisMask|=1<<f.dims,f.dims++);const h={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=null!=t.begin,e.endValid=null!=t.end,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<t.dims;r++)if(1<<r&t.ellipsisMask){const s=Math.min(e.dims-(t.dims-r)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<s;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&t.newAxisMask)e.finalShapeGatherIndices.push(-2),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);null!=t.begin&&(e.begin[n]=t.begin[r]),null!=t.end&&(e.end[n]=t.end[r]),e.strides[n]=t.strides[r],t.beginMask&1<<r&&(e.beginMask|=1<<n),t.endMask&1<<r&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(-1),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[n]=r,n++}}(f,h);let p=!0,d=!0,m=!0;const y=[],g=[];for(let e=0;e<t.length;++e){if(0===h.strides[e])throw Error(`strides[${e}] must be non-zero`);const n=!!(h.shrinkAxisMask&1<<e),r=t[e];if(-1===r){y.push(n?1:-1);continue}const s=[h.beginMask&1<<e,h.endMask&1<<e],o=[h.strides[e]>0?0:-1,h.strides[e]>0?r:r-1];if(n&&h.strides[e]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===h.strides[e];const i=!!(h.beginMask&1<<e&&h.endMask&1<<e);if(h.beginValid&&h.endValid){if(n){const t=h.begin[e]<0?r+h.begin[e]:h.begin[e];if(h.begin[e]=t,h.end[e]=h.begin[e]+1,t<0||t>=r)throw Error(`slice index ${h.begin[e]} of dimension ${e} out of bounds.`)}else h.begin[e]=qs(h.begin[e],0,h.strides[e],r,s,o),h.end[e]=qs(h.end[e],1,h.strides[e],r,s,o);const t=1===h.strides[e]&&0===h.begin[e]&&h.end[e]===r;p=p&&t,d=d&&(0===e&&1===h.strides[e]||t)}else p=p&&1===h.strides[e]&&i,d=d&&(0===e&&1===h.strides[e]||i);let a,u=!1;if(h.beginValid&&h.endValid?(a=h.end[e]-h.begin[e],u=!0):n?(a=1,u=!0):i&&r>=0&&(a=h.strides[e]<0?-r:r,u=!0),u){let t;t=0===a||a<0!=h.strides[e]<0?0:Math.trunc(a/h.strides[e])+(a%h.strides[e]!=0?1:0),y.push(t)}else y.push(-1)}for(let t=0;t<h.finalShapeGatherIndices.length;++t){const e=h.finalShapeGatherIndices[t];e>=0?g.push(y[e]):-2===e&&g.push(1)}const b=g.filter(((t,e)=>-2!==h.finalShapeGatherIndices[e]));return{finalShapeSparse:b,finalShape:g,isIdentity:p,sliceDim0:d,isSimpleSlice:m,begin:h.begin,end:h.end,strides:h.strides}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ks{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}class Xs{constructor(){this.classNameMap={}}static getMap(){return null==Xs.instance&&(Xs.instance=new Xs),Xs.instance}static register(t){Xs.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function Js(t){h(null!=t.className,(()=>"Class being registered does not have the static className property defined.")),h("string"==typeof t.className,(()=>"className is required to be a string, but got type "+typeof t.className)),h(t.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),Xs.register(t)}var Ys=Object.freeze({__proto__:null,Serializable:Ks,SerializationMap:Xs,registerClass:Js});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zs(){return 32===qe.backend.floatPrecision()?.001:.1}function Qs(t,e,n){let r=!0;if((_(t)||_(e))&&(r=!1),_(t)&&_(e)&&(r=!0),r){const n=t.constructor.name,r=e.constructor.name;if(n!==r)throw new Error(`Arrays are of different type. Actual: ${n}. Expected: ${r}`)}if(Array.isArray(t)&&Array.isArray(e)){const n=Xn(t),r=Xn(e);if(!g(n,r))throw new Error(`Arrays have different shapes. Actual: [${n}]. Expected: [${r}]`)}const s=_(t)?t:m(t),o=_(e)?e:m(e);if(s.length!==o.length)throw new Error(`Arrays have different lengths actual: ${s.length} vs expected: ${o.length}.\nActual:   ${s}.\nExpected: ${o}.`);for(let t=0;t<o.length;++t){const e=s[t],r=o[t];if(!n(e,r))throw new Error(`Arrays differ: actual[${t}] = ${e}, expected[${t}] = ${r}.\nActual:   ${s}.\nExpected: ${o}.`)}}function to(t,e,n){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}var eo=Object.freeze({__proto__:null,TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(t,e,n){return null==n&&(n=Zs()),Qs(t,e,((t,e)=>to(t,e,n)))},testEpsilon:Zs,expectPromiseToFail:function(t,e){t().then((()=>e.fail()),(()=>e()))},expectArraysEqual:function(t,e){const n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return A(t)||A(t[0])||A(e)||A(e[0])?Qs(t,n,((t,e)=>t==e)):Qs(t,e,((t,e)=>to(t,e,0)))},expectNumbersClose:function(t,e,n){if(null==n&&(n=Zs()),!to(t,e,n))throw new Error(`Numbers differ: actual === ${t}, expected === ${e}`)},expectValuesInRange:function(t,e,n){for(let r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error(`Value out of range:${t[r]} low: ${e}, high: ${n}`)},expectArrayBuffersEqual:function(t,e){const n=new Float32Array(t),r=new Float32Array(e);if(n.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${n.length}`);for(let t=0;t<r.length;t++)if(n[t]!==r[t])throw new Error(`Expected ArrayBuffer value at ${t} to be ${r[t]} but got ${n[t]} instead`)},encodeStrings:function t(e){for(let n=0;n<e.length;n++){const r=e[n];Array.isArray(r)?t(r):e[n]=de(r)}return e}});
/** @license See the LICENSE file. */const no=tr({add_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=Zn(t,"a","add"),r=Zn(e,"b","add");[n,r]=Le(n,r);const s={a:n,b:r};return qe.runKernel("Add",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ro=tr({floorDiv_:function(t,e){let n=Zn(t,"a","floorDiv"),r=Zn(e,"b","floorDiv");[n,r]=Le(n,r);const s={a:n,b:r};return qe.runKernel("FloorDiv",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const so=tr({div_:function(t,e){let n=Zn(t,"a","div"),r=Zn(e,"b","div");if([n,r]=Le(n,r),"int32"===n.dtype&&"int32"===r.dtype)return ro(n,r);const s={a:n,b:r};return qe.runKernel("RealDiv",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oo=tr({mul_:function(t,e){let n=Zn(t,"a","mul"),r=Zn(e,"b","mul");[n,r]=Le(n,r);const s={a:n,b:r};return qe.runKernel("Multiply",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const io=tr({abs_:function(t){const e=Zn(t,"x","abs");if("complex64"===e.dtype){const t={x:e};return qe.runKernel("ComplexAbs",t)}{const t={x:e};return qe.runKernel("Abs",t)}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ao=tr({acos_:function(t){const e={x:Zn(t,"x","acos")};return qe.runKernel("Acos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uo=tr({acosh_:function(t){const e={x:Zn(t,"x","acosh")};return qe.runKernel("Acosh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const co=tr({addN_:function(t){h(Array.isArray(t),(()=>"The argument passed to tf.addN() must be a list of tensors")),h(t.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`));const e=t.map(((t,e)=>Zn(t,`tensors${e}`,"addN"))),n=e[0];e.forEach((t=>{if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((t=>{if(!g(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const r=e;return qe.runKernel("AddN",r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lo=tr({all_:function(t,e=null,n=!1){const r={x:Zn(t,"x","all","bool")},s={axis:e,keepDims:n};return qe.runKernel("All",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fo=tr({any_:function(t,e=null,n=!1){const r={x:Zn(t,"x","any","bool")},s={axis:e,keepDims:n};return qe.runKernel("Any",r,s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ho=tr({argMax_:function(t,e=0){const n={x:Zn(t,"x","argMax")},r={axis:e};return qe.runKernel("ArgMax",n,r)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const po=tr({argMin_:function(t,e=0){const n={x:Zn(t,"x","argMin")},r={axis:e};return qe.runKernel("ArgMin",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mo=tr({asin_:function(t){const e={x:Zn(t,"x","asin")};return qe.runKernel("Asin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yo=tr({asinh_:function(t){const e={x:Zn(t,"x","asinh")};return qe.runKernel("Asinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const go=tr({atan_:function(t){const e={x:Zn(t,"x","atan")};return qe.runKernel("Atan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bo=tr({atan2_:function(t,e){let n=Zn(t,"a","atan2"),r=Zn(e,"b","atan2");[n,r]=Le(n,r);const s={a:n,b:r};return qe.runKernel("Atan2",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wo=tr({atanh_:function(t){const e={x:Zn(t,"x","atanh")};return qe.runKernel("Atanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vo(t,e,n,r,s,o,i="channelsLast"){const[a,u]=Eo(e);let c;if("channelsLast"===i)c=[a,u,t[3],t[3]];else{if("channelsFirst"!==i)throw new Error(`Unknown dataFormat ${i}`);c=[a,u,t[1],t[1]]}return xo(t,c,n,r,s,o,!1,i)}function xo(t,e,n,r,s,o,i=!1,a="channelsLast"){let[u,c,l,f]=[-1,-1,-1,-1];if("channelsLast"===a)[u,c,l,f]=t;else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);[u,f,c,l]=t}const[h,p,,d]=e,[m,y]=Eo(n),[g,b]=Eo(r),w=_o(h,g),v=_o(p,b),{padInfo:x,outHeight:N,outWidth:$}=function(t,e,n,r,s,o,i,a,u){let c,l,f;if("number"==typeof t){c={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};const s=function(t,e,n,r,s){null==r&&(r=$o(t,e,n));const o=t[0],i=t[1],a=To((o-e+2*r)/n+1,s),u=To((i-e+2*r)/n+1,s);return[a,u]}([e,n],o,r,t,a);l=s[0],f=s[1]}else if("same"===t){l=Math.ceil(e/r),f=Math.ceil(n/s);const t=Math.max(0,(l-1)*r+o-e),a=Math.max(0,(f-1)*s+i-n),u=Math.floor(t/2),h=t-u,p=Math.floor(a/2);c={top:u,bottom:h,left:p,right:a-p,type:"SAME"}}else if("valid"===t)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-o+1)/r),f=Math.ceil((n-i+1)/s);else{if("object"!=typeof t)throw Error(`Unknown padding parameter: ${t}`);{const h="channelsLast"===u?t[1][0]:t[2][0],p="channelsLast"===u?t[1][1]:t[2][1],d="channelsLast"===u?t[2][0]:t[3][0],m="channelsLast"===u?t[2][1]:t[3][1];c={top:h,bottom:p,left:d,right:m,type:0===h&&0===p&&0===d&&0===m?"VALID":"EXPLICIT"},l=To((e-o+h+p)/r+1,a),f=To((n-i+d+m)/s+1,a)}}return{padInfo:c,outHeight:l,outWidth:f}}(s,c,l,m,y,w,v,o,a),E=i?d*f:d;let S;return"channelsFirst"===a?S=[u,E,N,$]:"channelsLast"===a&&(S=[u,N,$,E]),{batchSize:u,dataFormat:a,inHeight:c,inWidth:l,inChannels:f,outHeight:N,outWidth:$,outChannels:E,padInfo:x,strideHeight:m,strideWidth:y,filterHeight:h,filterWidth:p,effectiveFilterHeight:w,effectiveFilterWidth:v,dilationHeight:g,dilationWidth:b,inShape:t,outShape:S,filterShape:e}}function No(t,e,n,r,s,o=!1,i="channelsLast",a){let[u,c,l,f,h]=[-1,-1,-1,-1,-1];if("channelsLast"===i)[u,c,l,f,h]=t;else{if("channelsFirst"!==i)throw new Error(`Unknown dataFormat ${i}`);[u,h,c,l,f]=t}const[p,d,m,,y]=e,[g,b,w]=So(n),[v,x,N]=So(r),$=_o(p,v),E=_o(d,x),S=_o(m,N),{padInfo:_,outDepth:T,outHeight:k,outWidth:A}=function(t,e,n,r,s,o,i,a,u,c,l){let f,h,p,d;if("number"==typeof t){f={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};const o=function(t,e,n,r,s,o){null==s&&(s=$o(t,e,r));const i=t[0],a=t[1],u=t[2],c=To((i-e+2*s)/r+1,o),l=To((a-e+2*s)/r+1,o),f=To((u-e+2*s)/r+1,o);return[c,l,f,n]}([e,n,r,1],a,1,s,t,l);h=o[0],p=o[1],d=o[2]}else if("same"===t){h=Math.ceil(e/s),p=Math.ceil(n/o),d=Math.ceil(r/i);const t=(h-1)*s+a-e,l=(p-1)*o+u-n,m=(d-1)*i+c-r,y=Math.floor(t/2),g=t-y,b=Math.floor(l/2),w=l-b,v=Math.floor(m/2);f={top:b,bottom:w,left:v,right:m-v,front:y,back:g,type:"SAME"}}else{if("valid"!==t)throw Error(`Unknown padding parameter: ${t}`);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((e-a+1)/s),p=Math.ceil((n-u+1)/o),d=Math.ceil((r-c+1)/i)}return{padInfo:f,outDepth:h,outHeight:p,outWidth:d}}(s,c,l,f,g,b,w,$,E,S,a),C=o?y*h:y;let O;return"channelsFirst"===i?O=[u,C,T,k,A]:"channelsLast"===i&&(O=[u,T,k,A,C]),{batchSize:u,dataFormat:i,inDepth:c,inHeight:l,inWidth:f,inChannels:h,outDepth:T,outHeight:k,outWidth:A,outChannels:C,padInfo:_,strideDepth:g,strideHeight:b,strideWidth:w,filterDepth:p,filterHeight:d,filterWidth:m,effectiveFilterDepth:$,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationDepth:v,dilationHeight:x,dilationWidth:N,inShape:t,outShape:O,filterShape:e}}function $o(t,e,n,r=1){const s=_o(e,r);return Math.floor((t[0]*(n-1)-n+s)/2)}function Eo(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function So(t){return"number"==typeof t?[t,t,t]:t}function _o(t,e){return e<=1?t:t+(t-1)*(e-1)}function To(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function ko(t){const[e,n,r]=Eo(t);return 1===e&&1===n&&1===r}function Ao(t,e){return ko(t)||ko(e)}function Co(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function Oo(t,e,n){if(null!=n){if("string"==typeof e)throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if("number"==typeof e)h(b(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`));else{if("object"!=typeof e)throw Error(`Error in ${t}: Unknown padding parameter: ${e}`);e.forEach((e=>{e.forEach((e=>{h(b(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`))}))}))}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Io=tr({reshape_:function(t,e){const n={x:Zn(t,"x","reshape","string_or_numeric")},r={shape:e};return qe.runKernel("Reshape",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mo=tr({avgPool_:function(t,e,n,r,s){const o=Zn(t,"x","avgPool","float32");h(Ao(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let i=o,a=!1;3===o.rank&&(a=!0,i=Io(o,[1,o.shape[0],o.shape[1],o.shape[2]])),h(4===i.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${i.rank}.`)),Oo("avgPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s};let l=qe.runKernel("AvgPool",u,c);return l=Ur(l,o.dtype),a?Io(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ro=tr({avgPool3d_:function(t,e,n,r,s,o="NDHWC"){const i=Zn(t,"x","avgPool3d","float32");let a=i,u=!1;4===i.rank&&(u=!0,a=Io(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),h(5===a.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`)),h("NDHWC"===o,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),Oo("avgPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o};let f=qe.runKernel("AvgPool3D",c,l);return f=Ur(f,a.dtype),u?Io(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Do=tr({concat_:function(t,e=0){h(t.length>=1,(()=>"Pass at least one tensor to concat"));const n=Qn(t,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((t=>{if("complex64"!==t.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${t.dtype}. `)})),1===n.length)return jr(n[0]);const r=n,s={axis:e};return qe.runKernel("Concat",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fo=tr({sigmoid_:function(t){const e={x:Zn(t,"x","sigmoid","float32")};return qe.runKernel("Sigmoid",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lo=tr({slice_:function(t,e,n){const r=Zn(t,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const s={x:r},o={begin:e,size:n};return qe.runKernel("Slice",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Po=tr({tanh_:function(t){const e={x:Zn(t,"x","tanh","float32")};return qe.runKernel("Tanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bo=tr({basicLSTMCell_:function(t,e,n,r,s,o){const i=Zn(t,"forgetBias","basicLSTMCell"),a=Zn(e,"lstmKernel","basicLSTMCell"),u=Zn(n,"lstmBias","basicLSTMCell"),c=Zn(r,"data","basicLSTMCell"),l=Zn(s,"c","basicLSTMCell"),f=Zn(o,"h","basicLSTMCell"),h=Do([c,f],1),p=us(h,a),d=no(p,u),m=d.shape[0],y=d.shape[1]/4,g=[m,y],b=Lo(d,[0,0],g),w=Lo(d,[0,y],g),v=Lo(d,[0,2*y],g),x=Lo(d,[0,3*y],g),N=no(oo(Fo(b),Po(w)),oo(l,Fo(no(i,v))));return[N,oo(Po(N),Fo(x))]}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vo=tr({batchToSpaceND_:function(t,e,n){const r=Zn(t,"x","batchToSpaceND"),s=e.reduce(((t,e)=>t*e));h(r.rank>=1+e.length,(()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`)),h(n.length===e.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`)),h(r.shape[0]%s==0,(()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${s}`));const o={x:r},i={blockShape:e,crops:n};return qe.runKernel("BatchToSpaceND",o,i)}});const zo=tr({batchNorm_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s,o){null==o&&(o=.001);const i=Zn(t,"x","batchNorm"),a=Zn(e,"mean","batchNorm"),u=Zn(n,"variance","batchNorm");let c,l;null!=s&&(c=Zn(s,"scale","batchNorm")),null!=r&&(l=Zn(r,"offset","batchNorm")),h(a.rank===u.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),h(null==l||a.rank===l.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),h(null==c||a.rank===c.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const f=function(t){let e;return e=0===t.rank||1===t.rank?Io(t,[1,1,1,t.size]):2===t.rank?Io(t,[1,1,t.shape[0],t.shape[1]]):3===t.rank?Io(t,[1,t.shape[0],t.shape[1],t.shape[2]]):t,e}(i),p={x:f,scale:c,offset:l,mean:a,variance:u},d={varianceEpsilon:o},m=qe.runKernel("FusedBatchNorm",p,d);return Io(m,i.shape)}});const Wo=tr({batchNorm2d_:function(t,e,n,r,s,o){const i=Zn(t,"x","batchNorm"),a=Zn(e,"mean","batchNorm"),u=Zn(n,"variance","batchNorm");let c,l;return null!=s&&(c=Zn(s,"scale","batchNorm")),null!=r&&(l=Zn(r,"offset","batchNorm")),h(2===i.rank,(()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`)),h(2===a.rank||1===a.rank,(()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`)),h(2===u.rank||1===u.rank,(()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`)),null!=c&&h(2===c.rank||1===c.rank,(()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`)),null!=l&&h(2===l.rank||1===l.rank,(()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${l.rank}.`)),zo(i,a,u,l,c,o)}});const Uo=tr({batchNorm3d_:function(t,e,n,r,s,o){const i=Zn(t,"x","batchNorm"),a=Zn(e,"mean","batchNorm"),u=Zn(n,"variance","batchNorm");let c,l;return null!=s&&(c=Zn(s,"scale","batchNorm")),null!=r&&(l=Zn(r,"offset","batchNorm")),h(3===i.rank,(()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`)),h(3===a.rank||1===a.rank,(()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`)),h(3===u.rank||1===u.rank,(()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`)),null!=c&&h(3===c.rank||1===c.rank,(()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`)),null!=l&&h(3===l.rank||1===l.rank,(()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${l.rank}.`)),zo(i,a,u,l,c,o)}});const jo=tr({batchNorm4d_:function(t,e,n,r,s,o){const i=Zn(t,"x","batchNorm"),a=Zn(e,"mean","batchNorm"),u=Zn(n,"variance","batchNorm");let c,l;return null!=s&&(c=Zn(s,"scale","batchNorm")),null!=r&&(l=Zn(r,"offset","batchNorm")),h(4===i.rank,(()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`)),h(4===a.rank||1===a.rank,(()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`)),h(4===u.rank||1===u.rank,(()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`)),null!=c&&h(4===c.rank||1===c.rank,(()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`)),null!=l&&h(4===l.rank||1===l.rank,(()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${l.rank}.`)),zo(i,a,u,l,c,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Go=tr({bincount_:function(t,e,n){const r=Zn(t,"x","bincount"),s=Zn(e,"weights","bincount");h("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),h(n>=0,(()=>`size must be non-negative, but got ${n}.`)),h(s.size===r.size||0===s.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${s.shape}.`));const o={x:r,weights:s},i={size:n};return qe.runKernel("Bincount",o,i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qo=tr({broadcastArgs_:function(t,e){const n=Zn(t,"s0","broadcastArgs","int32"),r=Zn(e,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(1!==r.rank)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const s={s0:n,s1:r};return qe.runKernel("BroadcastArgs",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ho=tr({broadcastTo_:function(t,e){let n=Zn(t,"broadcastTo","x");const r=n.shape;if(e.some((t=>!(t>0)||t%1!=0)))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const t=n.shape.slice();for(;t.length<e.length;)t.unshift(1);n=Io(n,t)}const s=n.shape,o=Array.from(e);for(let t=e.length-1;t>=0;t--)if(s[t]===e[t])o[t]=1;else if(1!==n.shape[t])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);const i=o.map(((t,e)=>t>1?e:-1)).filter((t=>t>=0));if(0===i.length)return jr(n);const a={x:n},u={reps:o};return qe.runKernel("Tile",a,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ko=tr({ceil_:function(t){const e={x:Zn(t,"x","ceil","float32")};return qe.runKernel("Ceil",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xo=tr({clipByValue_:function(t,e,n){const r=Zn(t,"x","clipByValue");h(e<=n,(()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`));const s={x:r},o={clipValueMin:e,clipValueMax:n};return qe.runKernel("ClipByValue",s,o)}});const Jo=tr({concat1d_:function(t){return Do(t,0)}});const Yo=tr({concat2d_:function(t,e){return Do(t,e)}});const Zo=tr({concat3d_:function(t,e){return Do(t,e)}});const Qo=tr({concat4d_:function(t,e){return Do(t,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ti=tr({conv2d_:function(t,e,n,r,s="NHWC",o=[1,1],i){const a=Zn(t,"x","conv2d","float32"),u=Zn(e,"filter","conv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=Io(a,[1,a.shape[0],a.shape[1],a.shape[2]])),h(4===c.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`)),h(4===u.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`)),Oo("conv2d",r,i);const f="NHWC"===s?c.shape[3]:c.shape[1];h(f===u.shape[2],(()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`)),h(Ao(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const p={x:c,filter:u},d={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},m=qe.runKernel("Conv2D",p,d);return l?Io(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});const ei=tr({conv1d_:function(t,e,n,r,s="NWC",o=1,i){const a=Zn(t,"x","conv1d"),u=Zn(e,"filter","conv1d");let c=a,l=!1;2===a.rank&&(l=!0,c=Io(a,[1,a.shape[0],a.shape[1]])),h(3===c.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`)),h(3===u.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`)),Oo("conv1d",r,i),h(c.shape[2]===u.shape[1],(()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`)),h(Ao(n,o),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${o}'`)),h("NWC"===s,(()=>`Error in conv1d: got dataFormat of ${s} but only NWC is currently supported.`));const f=Io(u,[1,u.shape[0],u.shape[1],u.shape[2]]),p=Io(c,[c.shape[0],1,c.shape[1],c.shape[2]]),d=ti(p,f,[1,n],r,"NHWC",[1,o],i);return Io(d,l?[d.shape[2],d.shape[3]]:[d.shape[0],d.shape[2],d.shape[3]])}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ni=tr({conv2DBackpropInput_:function(t,e,n,r,s,o="NHWC",i){h(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let a=t,u=e,c=!1;3===e.rank&&(c=!0,u=Io(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),h(4===a.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`)),h(4===u.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`)),h(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const l="NHWC"===o?a[3]:a[1],f="NHWC"===o?u.shape[3]:u.shape[1];h(l===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[2]}.`)),h(f===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${n.shape[3]}.`)),Oo("conv2dDerInput",s,i);const p={dy:u,filter:n},d={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,inputShape:a},m=qe.runKernel("Conv2DBackpropInput",p,d);return c?Io(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});const ri=tr({conv2dTranspose_:function(t,e,n,r,s,o){const i=Zn(t,"x","conv2dTranspose"),a=Zn(e,"filter","conv2dTranspose");return ni(n,i,a,r,s,"NHWC",o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const si=tr({conv3d_:function(t,e,n,r,s="NDHWC",o=[1,1,1]){const i=Zn(t,"x","conv3d"),a=Zn(e,"filter","conv3d");let u=i,c=!1;4===i.rank&&(c=!0,u=Io(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),h(5===u.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`)),h(5===a.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`)),h(u.shape[4]===a.shape[3],(()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${a.shape[3]}.`)),h(Ao(n,o),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),h("NDHWC"===s,(()=>`Error in conv3d: got dataFormat of ${s} but only NDHWC is currently supported.`));const l={x:u,filter:a},f={strides:n,pad:r,dataFormat:s,dilations:o},p=qe.runKernel("Conv3D",l,f);return c?Io(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oi=tr({conv3DBackpropInput_:function(t,e,n,r,s){h(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let o=t,i=e,a=!1;4===e.rank&&(a=!0,i=Io(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,t[0],t[1],t[2],t[3]]);const u=o[4],c=i.shape[4];h(5===o.length,(()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`)),h(5===i.rank,(()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`)),h(5===n.rank,(()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`)),h(u===n.shape[3],(()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[3]}.`)),h(c===n.shape[4],(()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`));const l={dy:i,filter:n},f={pad:s,strides:r,inputShape:o},p=qe.runKernel("Conv3DBackpropInputV2",l,f);return a?Io(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});const ii=tr({conv3dTranspose_:function(t,e,n,r,s){const o=Zn(t,"x","conv3dTranspose"),i=Zn(e,"filter","conv3dTranspose");return oi(n,o,i,r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ai=tr({cos_:function(t){const e={x:Zn(t,"x","cos","float32")};return qe.runKernel("Cos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ui=tr({cosh_:function(t){const e={x:Zn(t,"x","cosh","float32")};return qe.runKernel("Cosh",e)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ci=tr({cumprod_:function(t,e=0,n=!1,r=!1){const s={x:Zn(t,"x","cumprod")},o={axis:e,exclusive:n,reverse:r};return qe.runKernel("Cumprod",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const li=tr({cumsum_:function(t,e=0,n=!1,r=!1){const s={x:Zn(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:r};return qe.runKernel("Cumsum",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fi=tr({denseBincount_:function(t,e,n,r=!1){const s=Zn(t,"x","denseBincount"),o=Zn(e,"weights","denseBincount");h("int32"===s.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${s.dtype}`)),h(s.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${s.rank}.`)),h(n>=0,(()=>`size must be non-negative, but got ${n}.`)),h(o.size===s.size||0===o.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${s.shape}, weights shape: ${o.shape}.`));const i={x:s,weights:o},a={size:n,binaryOutput:r};return qe.runKernel("DenseBincount",i,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hi=tr({depthToSpace_:function(t,e,n="NHWC"){const r=Zn(t,"x","depthToSpace","float32"),s="NHWC"===n?r.shape[1]:r.shape[2],o="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];h(e>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`)),h(s*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${s} and ${e}  for depthToSpace with input shape\n    ${r.shape}`)),h(o*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${o} and ${e} for depthToSpace with input shape\n        ${r.shape}`)),h(i%(e*e)==0,(()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${r.shape}`));const a={x:r},u={blockSize:e,dataFormat:n};return qe.runKernel("DepthToSpace",a,u)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pi=tr({depthwiseConv2d_:function(t,e,n,r,s="NHWC",o=[1,1],i){const a=Zn(t,"x","depthwiseConv2d","float32"),u=Zn(e,"filter","depthwiseConv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=Io(a,[1,a.shape[0],a.shape[1],a.shape[2]])),h(4===c.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`)),h(4===u.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`)),h(c.shape[3]===u.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`)),Oo("depthwiseConv2d",r,i);const f={x:c,filter:u},p={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},d=qe.runKernel("DepthwiseConv2dNative",f,p);return l?Io(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const di=tr({diag_:function(t){const e={x:Zn(t,"x","diag")};return qe.runKernel("Diag",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mi=tr({dilation2d_:function(t,e,n,r,s=[1,1],o="NHWC"){const i=Zn(t,"x","dilation2d"),a=Zn(e,"filter","dilation2d");h(3===i.rank||4===i.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`)),h(3===a.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`)),h("NHWC"===o,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`));let u=i,c=!1;3===i.rank&&(u=Io(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=!0);const l={x:u,filter:a},f={strides:n,pad:r,dilations:s},p=qe.runKernel("Dilation2D",l,f);return c?Io(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yi=tr({equal_:function(t,e){let n=Zn(t,"a","equal","string_or_numeric"),r=Zn(e,"b","equal","string_or_numeric");[n,r]=Le(n,r),Es(n.shape,r.shape);const s={a:n,b:r};return qe.runKernel("Equal",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gi=tr({where_:function(t,e,n){const r=Zn(e,"a","where"),s=Zn(n,"b","where"),o=Zn(t,"condition","where","bool"),i=Es(Es(o.shape,r.shape),s.shape),a={condition:Ho(o,i),t:Ho(r,i),e:Ho(s,i)};return qe.runKernel("Select",a)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bi=tr({zerosLike_:function(t){const e={x:Zn(t,"x","zerosLike")};return qe.runKernel("ZerosLike",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wi=tr({divNoNan_:function(t,e){let n=Zn(t,"a","div"),r=Zn(e,"b","div");[n,r]=Le(n,r);const s=so(n,r),o=bi(s),i=yi(r,o);return gi(i,o,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vi=tr({dot_:function(t,e){const n=Zn(t,"t1","dot"),r=Zn(e,"t2","dot");h(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`));const s=1===n.rank?n.size:n.shape[1],o=1===r.rank?r.size:r.shape[0];if(h(s===o,(()=>`Error in dot: inner dimensions of inputs must match, but got ${s} and ${o}.`)),1===n.rank&&1===r.rank){const t=Io(n,[1,-1]),e=Io(r,[-1,1]),s=us(t,e);return Io(s,[])}if(1===n.rank&&2===r.rank){const t=Io(n,[1,-1]),e=Io(r,[r.shape[0],r.shape[1]]),s=us(t,e);return Io(s,[s.size])}if(2===n.rank&&1===r.rank){const t=Io(r,[-1,1]),e=us(n,t);return Io(e,[e.size])}{const t=Io(r,[r.shape[0],r.shape[1]]);return us(n,t)}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xi=tr({einsum_:function(t,...e){const n=e.map(((t,e)=>Zn(t,`tensors${e}`,"einsum"))),r={equation:t};return qe.runKernel("Einsum",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ni=tr({elu_:function(t){const e={x:Zn(t,"x","elu","float32")};return qe.runKernel("Elu",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $i=tr({erf_:function(t){let e=Zn(t,"x","erf");h("int32"===e.dtype||"float32"===e.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===e.dtype&&(e=Ur(e,"float32"));const n={x:e};return qe.runKernel("Erf",n)}});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ei(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function Si(t,e,n){const r=t.length+e.length,s=[];let o=0,i=0;for(let a=0;a<r;a++)-1===n.indexOf(a)?s.push(t[o++]):s.push(e[i++]);return s}function _i(t,e){return Si(t,e.map((t=>1)),e)}const Ti=tr({max_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=null,n=!1){const r={x:Zn(t,"x","max")},s={reductionIndices:e,keepDims:n};return qe.runKernel("Max",r,s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ki=tr({min_:function(t,e=null,n=!1){const r={x:Zn(t,"x","min")},s={axis:e,keepDims:n};return qe.runKernel("Min",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ai=tr({pow_:function(t,e){let n=Zn(t,"base","pow"),r=Zn(e,"exp","pow");[n,r]=Le(n,r);const s={a:n,b:r};return qe.runKernel("Pow",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ci(t,e){if((_(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&_(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return nr(t,[],[],e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oi=tr({sqrt_:function(t){const e={x:Zn(t,"x","sqrt","float32")};return qe.runKernel("Sqrt",e)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ii=tr({square_:function(t){const e=Zn(t,"x","square");return qe.runKernel("Square",{x:e},{})}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mi=tr({sum_:function(t,e=null,n=!1){let r=Zn(t,"x","sum");"bool"===r.dtype&&(r=Ur(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return qe.runKernel("Sum",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ri(t,e,n=null){if(0===t.rank)return io(t);if(1!==t.rank&&null===n)return Ri(Io(t,[-1]),e,n);if(1===t.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===e)return Mi(io(t),n);if(e===1/0)return Ti(io(t),n);if(e===-1/0)return ki(io(t),n);if("euclidean"===e||2===e)return Oi(Mi(Ai(io(t),Ci(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&2===n.length){if(1===e)return Ti(Mi(io(t),n[0]),n[1]-1);if(e===1/0)return Ti(Mi(io(t),n[1]),n[0]);if(e===-1/0)return ki(Mi(io(t),n[1]),n[0]);if("fro"===e||"euclidean"===e)return Oi(Mi(Ii(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const Di=tr({norm_:function(t,e="euclidean",n=null,r=!1){const s=Ri(t=Zn(t,"x","norm"),e,n);let o=s.shape;if(r){const e=v(n,t.shape);o=_i(s.shape,e)}return Io(s,o)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fi=tr({euclideanNorm_:function(t,e=null,n=!1){return Di(t,"euclidean",e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Li=tr({exp_:function(t){const e={x:Zn(t,"x","exp")};return qe.runKernel("Exp",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pi=tr({expandDims_:function(t,e=0){const n=Zn(t,"x","expandDims","string_or_numeric");h(e<=n.rank,(()=>"Axis must be <= rank of the tensor"));const r={input:n},s={dim:e};return qe.runKernel("ExpandDims",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bi=tr({expm1_:function(t){const e={x:Zn(t,"x","expm1")};return qe.runKernel("Expm1",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vi=tr({tile_:function(t,e){const n=Zn(t,"x","tile","string_or_numeric");h(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`));const r={x:n},s={reps:e};return qe.runKernel("Tile",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zi=tr({eye_:function(t,e,n,r="float32"){null==e&&(e=t);const s=Wr([t,e],r),o=t<=e?t:e;for(let t=0;t<o;++t)s.set(1,t,t);const i=Io(s.toTensor(),[t,e]);if(null==n)return i;if(1===n.length)return Vi(Pi(i,0),[n[0],1,1]);if(2===n.length)return Vi(Pi(Pi(i,0),0),[n[0],n[1],1,1]);if(3===n.length)return Vi(Pi(Pi(Pi(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wi(t,e,n){const r={shape:t,value:e,dtype:n};return qe.runKernel("Fill",{},r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ui=tr({floor_:function(t){const e={x:Zn(t,"x","floor","float32")};return qe.runKernel("Floor",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ji=tr({gather_:function(t,e,n=0,r=0){const s={x:Zn(t,"x","gather"),indices:Zn(e,"indices","gather","int32")},o={axis:n,batchDims:r};return qe.runKernel("GatherV2",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gi=tr({greater_:function(t,e){let n=Zn(t,"a","greater","string_or_numeric"),r=Zn(e,"b","greater","string_or_numeric");[n,r]=Le(n,r),Es(n.shape,r.shape);const s={a:n,b:r};return qe.runKernel("Greater",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qi=tr({greaterEqual_:function(t,e){let n=Zn(t,"a","greaterEqual","string_or_numeric"),r=Zn(e,"b","greaterEqual","string_or_numeric");[n,r]=Le(n,r),Es(n.shape,r.shape);const s={a:n,b:r};return qe.runKernel("GreaterEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hi=tr({isFinite_:function(t){const e={x:Zn(t,"x","isFinite")};return qe.runKernel("IsFinite",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ki=tr({isInf_:function(t){const e={x:Zn(t,"x","isInf")};return qe.runKernel("IsInf",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xi=tr({isNaN_:function(t){const e={x:Zn(t,"x","isNaN")};return qe.runKernel("IsNan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ji=tr({leakyRelu_:function(t,e=.2){const n={x:Zn(t,"x","leakyRelu")},r={alpha:e};return qe.runKernel("LeakyRelu",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yi=tr({less_:function(t,e){let n=Zn(t,"a","less","string_or_numeric"),r=Zn(e,"b","less","string_or_numeric");[n,r]=Le(n,r),Es(n.shape,r.shape);const s={a:n,b:r};return qe.runKernel("Less",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zi=tr({lessEqual_:function(t,e){let n=Zn(t,"a","lessEqual","string_or_numeric"),r=Zn(e,"b","lessEqual","string_or_numeric");[n,r]=Le(n,r),Es(n.shape,r.shape);const s={a:n,b:r};return qe.runKernel("LessEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qi(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:t,stop:e,num:n};return qe.runKernel("LinSpace",{},r)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ta=tr({localResponseNormalization_:function(t,e=5,n=1,r=1,s=.5){const o=Zn(t,"x","localResponseNormalization");h(4===o.rank||3===o.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${o.rank}.`)),h(b(e),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`));let i=o,a=!1;3===o.rank&&(a=!0,i=Io(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const u={x:i},c={depthRadius:e,bias:n,alpha:r,beta:s},l=qe.runKernel("LRN",u,c);return a?Io(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ea=tr({log_:function(t){const e={x:Zn(t,"x","log","float32")};return qe.runKernel("Log",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const na=tr({log1p_:function(t){const e={x:Zn(t,"x","log1p")};return qe.runKernel("Log1p",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ra(t,e){h(M(t),(()=>"The f passed in variableGrads(f) must be a function")),h(null==e||Array.isArray(e)&&e.every((t=>t instanceof Ae)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=e;if(!n){e=[];for(const t in qe.registeredVariables)e.push(qe.registeredVariables[t])}const r=n?e.filter((t=>!t.trainable)):null,s=e.length;e=e.filter((t=>t.trainable)),h(e.length>0,(()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${s} variables is trainable.`));const{value:o,grads:i}=qe.gradients(t,e,null,!0);h(i.some((t=>null!=t)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),h(0===o.rank,(()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`));const a={};return e.forEach(((t,e)=>{null!=i[e]&&(a[t.name]=i[e])})),null!=r&&r.forEach((t=>a[t.name]=null)),{value:o,grads:a}}function sa(t){return qe.customGrad(t)}function oa(t){const e=t.filter((t=>null==t)).length;if(e>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ia=tr({softplus_:function(t){const e={x:Zn(t,"x","softplus")};return qe.runKernel("Softplus",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aa=tr({logSigmoid_:function(t){const e=Zn(t,"x","logSigmoid"),n=sa((t=>({value:gs(ia(gs(t))),gradFunc:e=>oo(e,Fo(gs(t)))})));return n(e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ua=tr({sub_:function(t,e){let n=Zn(t,"a","sub"),r=Zn(e,"b","sub");[n,r]=Le(n,r);const s={a:n,b:r};return qe.runKernel("Sub",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ca=tr({logSoftmax_:function(t,e=-1){const n=Zn(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);const r=sa(((t,n)=>{const r=Ti(t,e,!0),s=ua(t,r),o=ua(Ur(s,"float32"),ea(Mi(Li(s),e,!0)));n([o]);return{value:o,gradFunc:(t,n)=>{const[r]=n,s=Li(r);return ua(t,oo(Mi(t,e,!0),s))}}}));return r(n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const la=tr({logSumExp_:function(t,e=null,n=!1){const r=Zn(t,"x","logSumExp"),s=v(e,r.shape),o=Ti(r,s,!0),i=ua(r,o),a=Li(i),u=Mi(a,s),c=ea(u),l=no(Io(o,c.shape),c);if(n){const t=_i(l.shape,s);return Io(l,t)}return l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fa=tr({logicalAnd_:function(t,e){const n=Zn(t,"a","logicalAnd","bool"),r=Zn(e,"b","logicalAnd","bool");Es(n.shape,r.shape);const s={a:n,b:r};return qe.runKernel("LogicalAnd",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ha=tr({logicalNot_:function(t){const e={x:Zn(t,"x","logicalNot","bool")};return qe.runKernel("LogicalNot",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pa=tr({logicalOr_:function(t,e){const n=Zn(t,"a","logicalOr","bool"),r=Zn(e,"b","logicalOr","bool");Es(n.shape,r.shape);const s={a:n,b:r};return qe.runKernel("LogicalOr",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const da=tr({logicalXor_:function(t,e){const n=Zn(t,"a","logicalXor","bool"),r=Zn(e,"b","logicalXor","bool");return Es(n.shape,r.shape),fa(pa(t,e),ha(fa(t,e)))}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ma=tr({searchSorted_:function(t,e,n="left"){const r=Zn(t,"sortedSequence","searchSorted"),s=Zn(e,"values","searchSorted"),o=r.shape[r.shape.length-1],i=s.shape[s.shape.length-1],a=Io(r,[-1,o]),u=Io(s,[-1,i]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(y(u.shape)>=2147483648)throw new Error("values tensor size must less than 2147483648");if(a.shape[1]>=2147483648)throw new Error(`trailing dim_size must less than 2147483648 for int32 output type, was ${a.shape[1]}`);const c={sortedSequence:a,values:u},l={side:n};return qe.runKernel("SearchSorted",c,l)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ya(t,e){return ma(t,e,"left")}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ga=tr({maxPool_:function(t,e,n,r,s){const o=Zn(t,"x","maxPool");let i=o,a=!1;3===o.rank&&(a=!0,i=Io(o,[1,o.shape[0],o.shape[1],o.shape[2]])),h(4===i.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${i.rank}.`)),h(Ao(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),Oo("maxPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s},l=qe.runKernel("MaxPool",u,c);return a?Io(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ba=tr({maxPool3d_:function(t,e=[1,1,1],n,r,s,o="NDHWC"){const i=Zn(t,"x","maxPool3d");let a=i,u=!1;4===i.rank&&(u=!0,a=Io(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),h(5===a.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`)),h("NDHWC"===o,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),Oo("maxPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o},f=qe.runKernel("MaxPool3D",c,l);return u?Io(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wa=tr({maxPoolWithArgmax_:function(t,e,n,r,s=!1){const o={x:Zn(t,"x","maxPoolWithArgmax")},i={filterSize:e,strides:n,pad:r,includeBatchInIndex:s},a=qe.runKernel("MaxPoolWithArgmax",o,i);return{result:a[0],indexes:a[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const va=tr({maximum_:function(t,e){let n=Zn(t,"a","maximum"),r=Zn(e,"b","maximum");[n,r]=Le(n,r),"bool"===n.dtype&&(n=Ur(n,"int32"),r=Ur(r,"int32")),Es(n.shape,r.shape);const s={a:n,b:r};return qe.runKernel("Maximum",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xa=tr({mean_:function(t,e=null,n=!1){const r={x:Zn(t,"x","mean")},s={axis:e,keepDims:n};return qe.runKernel("Mean",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Na(t,e="float32"){if("complex64"===e){const e=Na(t,"float32"),n=Na(t,"float32");return er(e,n)}const n=B(y(t),e);return qe.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $a(t,e="float32"){if("complex64"===e){const e=$a(t,"float32"),n=Na(t,"float32");return er(e,n)}const n=P(y(t),e);return qe.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ea=tr({minimum_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=Zn(t,"a","minimum"),r=Zn(e,"b","minimum");[n,r]=Le(n,r),"bool"===n.dtype&&(n=Ur(n,"int32"),r=Ur(r,"int32")),Es(n.shape,r.shape);const s={a:n,b:r};return qe.runKernel("Minimum",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sa=tr({mirrorPad_:function(t,e,n){h("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const r=Zn(t,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");h(e.length===r.rank,(()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`));const s="reflect"===n?1:0;for(let t=0;t<r.rank;t++)h(2===e[t].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),h(e[t][0]>=0&&e[t][0]<=r.shape[t]-s&&e[t][1]>=0&&e[t][1]<=r.shape[t]-s,(()=>`Padding in dimension ${t} cannot be greater than or equal to ${r.shape[t]-s} or less than 0 for input of shape ${r.shape}`));const o={paddings:e,mode:n},i={x:r};return qe.runKernel("MirrorPad",i,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _a=tr({mod_:function(t,e){let n=Zn(t,"a","mod"),r=Zn(e,"b","mod");[n,r]=Le(n,r);const s={a:n,b:r};return qe.runKernel("Mod",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ta=tr({moments_:function(t,e=null,n=!1){const r=v(e,(t=Zn(t,"x","moments")).shape),s=xa(t,r,n);let o=s.shape;n||(o=_i(s.shape,r));const i=Ii(ua(Ur(t,"float32"),Io(s,o)));return{mean:s,variance:xa(i,r,n)}}});const ka=tr({multiRNNCell_:function(t,e,n,r){const s=Zn(e,"data","multiRNNCell"),o=Qn(n,"c","multiRNNCell"),i=Qn(r,"h","multiRNNCell");let a=s;const u=[];for(let e=0;e<t.length;e++){const n=t[e](a,o[e],i[e]);u.push(n[0]),u.push(n[1]),a=n[1]}const c=[],l=[];for(let t=0;t<u.length;t+=2)c.push(u[t]),l.push(u[t+1]);return[c,l]}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aa=tr({multinomial_:function(t,e,n,r=!1){const s=Zn(t,"logits","multinomial"),o=s.size,i=s.rank;if(o<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${o}.`);if(i>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${i}`);n=n||Math.random();const a={logits:1===i?Io(s,[1,-1]):s},u={numSamples:e,seed:n,normalized:r},c=qe.runKernel("Multinomial",a,u);return 1===i?Io(c,[c.size]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ca=tr({notEqual_:function(t,e){let n=Zn(t,"a","notEqual","string_or_numeric"),r=Zn(e,"b","notEqual","string_or_numeric");[n,r]=Le(n,r),Es(n.shape,r.shape);const s={a:n,b:r};return qe.runKernel("NotEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oa=tr({onesLike_:function(t){const e={x:Zn(t,"x","onesLike")};return qe.runKernel("OnesLike",e)}});const Ia=tr({outerProduct_:function(t,e){const n=Zn(t,"v1","outerProduct"),r=Zn(e,"v2","outerProduct");h(1===n.rank&&1===r.rank,(()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`));const s=Io(n,[-1,1]),o=Io(r,[1,-1]);return us(s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ma=tr({pad_:function(t,e,n=0){const r=Zn(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:n},o={x:r};return qe.runKernel("PadV2",o,s)}});const Ra=tr({pad1d_:function(t,e,n=0){return h(2===e.length,(()=>"Invalid number of paddings. Must be length of 2.")),Ma(t,[e],n)}});const Da=tr({pad2d_:function(t,e,n=0){return h(2===e.length&&2===e[0].length&&2===e[1].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),Ma(t,e,n)}});const Fa=tr({pad3d_:function(t,e,n=0){return h(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),Ma(t,e,n)}});const La=tr({pad4d_:function(t,e,n=0){return h(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),Ma(t,e,n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pa=tr({spaceToBatchND_:function(t,e,n){const r=Zn(t,"x","spaceToBatchND");h(r.rank>=1+e.length,(()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`)),h(n.length===e.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`)),h(r.shape.reduce(((t,r,s)=>s>0&&s<=e.length?t&&(r+n[s-1][0]+n[s-1][1])%e[s-1]==0:t),!0),(()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`));const s={x:r},o={blockShape:e,paddings:n};return qe.runKernel("SpaceToBatchND",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ba=tr({pool_:function(t,e,n,r,s,o,i){null==s&&(s=[1,1]),null==o&&(o=1),0===r&&(r="valid");const a=Zn(t,"x","maxPool");let u=a,c=!1;3===a.rank&&(c=!0,u=Io(a,[1,a.shape[0],a.shape[1],a.shape[2]])),h(Ao(o,s),(()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${s}'`));const l=vo(u.shape,e,o,s,r),f=[l.dilationHeight,l.dilationWidth];let p;p="same"===r?function(t,e){const n=t.map(((t,n)=>t+(t-1)*(e[n]-1))),r=n.map((t=>t-1)),s=r.map((t=>Math.floor(t/2))),o=r.map(((t,e)=>t-s[e]));return r.map(((t,e)=>[s[e],o[e]]))}([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];const d=1===f[0]&&1===f[1],[m,y]=function(t,e,n){const r=n.map((t=>t[0])),s=n.map((t=>t[1])),o=t.concat(r,s),i=e.map(((t,e)=>(t-o[e]%t)%t)),a=s.map(((t,e)=>t+i[e])),u=e.map(((t,e)=>[r[e],a[e]])),c=e.map(((t,e)=>[0,i[e]]));return[u,c]}([l.inHeight,l.inWidth],f,p),g=d?r:"valid",b=d?u:Pa(u,f,m),w=("avg"===n?()=>Mo(b,e,o,g,i):()=>ga(b,e,o,g,i))(),v=d?w:Vo(w,f,y);return c?Io(v,[v.shape[1],v.shape[2],v.shape[3]]):v}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Va=tr({prelu_:function(t,e){const n={x:Zn(t,"x","prelu"),alpha:Zn(e,"alpha","prelu")};return qe.runKernel("Prelu",n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const za=tr({prod_:function(t,e=null,n=!1){let r=Zn(t,"x","prod");"bool"===r.dtype&&(r=Ur(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return qe.runKernel("Prod",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wa=tr({rand_:function(t,e,n){const r=y(t);let s=null;if(null==n||"float32"===n)s=new Float32Array(r);else if("int32"===n)s=new Int32Array(r);else{if("bool"!==n)throw new Error(`Unknown data type ${n}`);s=new Uint8Array(r)}for(let t=0;t<r;t++)s[t]=e();return qe.makeTensor(s,t,n)}});var Ua={exports:{}};!function(t,e,n){function r(t){var e=this,n=function(){var t=4022871197,e=function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)};return e}();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}function s(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var n=new r(t),o=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.alea=o}(0,Ua,!1);var ja={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor128=o}(0,ja,!1);var Ga={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorwow=o}(0,Ga,!1);var qa={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,s=e.i;return t=r[s],n=(t^=t>>>7)^t<<24,n^=(t=r[s+1&7])^t>>>10,n^=(t=r[s+3&7])^t>>>3,n^=(t=r[s+4&7])^t<<7,t=r[s+7&7],n^=(t^=t<<13)^t<<9,r[s]=n,e.i=s+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function s(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.x&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorshift7=o}(0,qa,!1);var Ha={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,s=e.X,o=e.i;return e.w=r=r+1640531527|0,n=s[o+34&127],t=s[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=s[o]=n^t,e.i=o,n+(r^r>>>16)|0},function(t,e){var n,r,s,o,i,a=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),s=0,o=-32;o<u;++o)e&&(r^=e.charCodeAt((o+32)%e.length)),0===o&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(i=i+1640531527|0,s=0==(n=a[127&o]^=r+i)?s+1:0);for(s>=128&&(a[127&(e&&e.length||0)]=-1),s=127,o=512;o>0;--o)r=a[s+34&127],n=a[s=s+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,a[s]=r^n;t.w=i,t.X=a,t.i=s}(e,t)}function s(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.X&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor4096=o}(0,Ha,!1);var Ka={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,s=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^s,s=s-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^s,e.a=s-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.tychei=o}(0,Ka,!1);var Xa,Ja={exports:{}};Xa=Ja,function(t,e){var n,r=this,s=256,o=e.pow(s,6),i=e.pow(2,52),a=2*i,u=255;function c(u,c,m){var y=[],g=p(h((c=1==c?{entropy:!0}:c||{}).entropy?[u,d(t)]:null==u?function(){try{var e;return n&&(e=n.randomBytes)?e=e(s):(e=new Uint8Array(s),(r.crypto||r.msCrypto).getRandomValues(e)),d(e)}catch(e){var o=r.navigator,i=o&&o.plugins;return[+new Date,r,i,r.screen,d(t)]}}():u,3),y),b=new l(y),w=function(){for(var t=b.g(6),e=o,n=0;t<i;)t=(t+n)*s,e*=s,n=b.g(1);for(;t>=a;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,p(d(b.S),t),(c.pass||m||function(t,n,r,s){return s&&(s.S&&f(s,b),t.state=function(){return f(b,{})}),r?(e.random=t,n):t})(w,g,"global"in c?c.global:this==e,c.state)}function l(t){var e,n=t.length,r=this,o=0,i=r.i=r.j=0,a=r.S=[];for(n||(t=[n++]);o<s;)a[o]=o++;for(o=0;o<s;o++)a[o]=a[i=u&i+t[o%n]+(e=a[o])],a[i]=e;(r.g=function(t){for(var e,n=0,o=r.i,i=r.j,a=r.S;t--;)e=a[o=u&o+1],n=n*s+a[u&(a[o]=a[i=u&i+e])+(a[i]=e)];return r.i=o,r.j=i,n})(s)}function f(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function h(t,e){var n,r=[],s=typeof t;if(e&&"object"==s)for(n in t)try{r.push(h(t[n],e-1))}catch(t){}return r.length?r:"string"==s?t:t+"\0"}function p(t,e){for(var n,r=t+"",s=0;s<r.length;)e[u&s]=u&(n^=19*e[u&s])+r.charCodeAt(s++);return d(e)}function d(t){return String.fromCharCode.apply(0,t)}if(e.seedrandom=c,p(e.random(),t),Xa.exports){Xa.exports=c;try{n=require("crypto")}catch(t){}}}([],Math);var Ya=Ua.exports,Za=ja.exports,Qa=Ga.exports,tu=qa.exports,eu=Ha.exports,nu=Ka.exports,ru=Ja.exports;ru.alea=Ya,ru.xor128=Za,ru.xorwow=Qa,ru.xorshift7=tu,ru.xor4096=eu,ru.tychei=nu;var su=ru;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ou{constructor(t,e,n,r,s){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const o=s||Math.random();this.random=su.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const t=this.nextVal;return this.nextVal=NaN,t}let t,e,n=!1;for(;!n;){let r,s,o;do{r=2*this.random()-1,s=2*this.random()-1,o=r*r+s*s}while(o>=1||0===o);const i=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*r*i,e=this.mean+this.stdDev*s*i,this.truncated&&!this.isValidTruncated(t)||(n=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class iu{constructor(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;const s=r||Math.random();this.randu=su.alea(s.toString()),this.randn=new ou(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,e,n,r,s,o;for(;;){do{r=this.randn.nextValue(),o=1+this.c*r}while(o<=0);if(o*=o*o,t=r*r,e=1-.331*t*t,n=.5*t+this.d*(1-o+Math.log(o)),s=this.randu(),s<e||Math.log(s)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(t){return"float32"===this.dtype?t:Math.round(t)}}class au{constructor(t=0,e=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=su.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uu=tr({randomGamma_:function(t,e,n=1,r="float32",s){if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error(`Unsupported data type ${r}`);const o=new iu(e,n,r,s),i=Wr(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cu=tr({randomNormal_:function(t,e=0,n=1,r,s){if(null!=r&&"bool"===r)throw new Error(`Unsupported data type ${r}`);const o=new ou(e,n,r,!1,s),i=Wr(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lu=tr({randomUniform_:function(t,e=0,n=1,r="float32",s){const o=Wr(t,r),i=new au(e,n,null,s);for(let t=0;t<o.values.length;t++)o.values[t]=i.nextValue();return o.toTensor()}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fu(t,e,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");const s={start:t,stop:e,step:n,dtype:r};return qe.runKernel("Range",{},s)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hu=tr({reciprocal_:function(t){const e={x:Zn(t,"x","reciprocal")};return qe.runKernel("Reciprocal",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pu=tr({relu_:function(t){const e={x:Zn(t,"x","relu")};return qe.runKernel("Relu",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const du=tr({relu6_:function(t){const e={x:Zn(t,"x","relu6")};return qe.runKernel("Relu6",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mu=tr({reverse_:function(t,e){const n={x:Zn(t,"x","reverse")},r={dims:e};return qe.runKernel("Reverse",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yu=tr({reverse1d_:function(t){const e=Zn(t,"x","reverse");return h(1===e.rank,(()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`)),mu(e,0)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gu=tr({reverse2d_:function(t,e){const n=Zn(t,"x","reverse");return h(2===n.rank,(()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`)),mu(n,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bu=tr({reverse3d_:function(t,e){const n=Zn(t,"x","reverse");return h(3===n.rank,(()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`)),mu(n,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wu=tr({reverse4d_:function(t,e){const n=Zn(t,"x","reverse");return h(4===n.rank,(()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`)),mu(n,e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vu=tr({round_:function(t){const e={x:Zn(t,"x","round")};return qe.runKernel("Round",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xu=tr({rsqrt_:function(t){const e={x:Zn(t,"x","rsqrt","float32")};return qe.runKernel("Rsqrt",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nu=tr({selu_:function(t){const e={x:Zn(t,"x","selu")};return qe.runKernel("Selu",e)}});const $u=tr({separableConv2d_:function(t,e,n,r,s,o=[1,1],i="NHWC"){const a=Zn(t,"x","separableConv2d"),u=Zn(e,"depthwiseFilter","separableConv2d"),c=Zn(n,"pointwiseFilter","separableConv2d");let l=a,f=!1;if(3===a.rank&&(f=!0,l=Io(a,[1,a.shape[0],a.shape[1],a.shape[2]])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");h(4===l.rank,(()=>`Error in separableConv2d: input must be rank 4, but got rank ${l.rank}.`)),h(4===u.rank,(()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`)),h(4===c.rank,(()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`)),h(1===c.shape[0],(()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`)),h(1===c.shape[1],(()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`));const p=u.shape[2],d=u.shape[3];h(c.shape[2]===p*d,(()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*d}, but got ${c.shape[2]}.`));const m=pi(l,u,r,s,i,o),y=ti(m,c,1,"valid",i);return f?Io(y,[y.shape[1],y.shape[2],y.shape[3]]):y}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eu=async function(t,e){const n=Zn(t,"x","setdiff1d"),r=Zn(e,"y","setdiff1d");h(n.dtype===r.dtype,(()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`)),h(1===n.rank,(()=>`x should be 1D tensor, but got x (${n.shape}).`)),h(1===r.rank,(()=>`y should be 1D tensor, but got y (${r.shape}).`));const s=await n.data(),o=await r.data(),i=new Set(o);let a=0;for(let t=0;t<s.length;t++)i.has(s[t])||a++;const u=new Se([a],n.dtype),c=new Se([a],"int32");for(let t=0,e=0;t<s.length;t++)i.has(s[t])||(u.values[e]=s[t],c.values[e]=t,e++);return[u.toTensor(),c.toTensor()]};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Su=tr({sign_:function(t){const e={x:Zn(t,"x","sign")};return qe.runKernel("Sign",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _u=tr({sin_:function(t){const e={x:Zn(t,"x","sin","float32")};return qe.runKernel("Sin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tu=tr({sinh_:function(t){const e={x:Zn(t,"x","sinh")};return qe.runKernel("Sinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ku=tr({slice1d_:function(t,e,n){const r=Zn(t,"x","slice1d");return h(1===r.rank,(()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`)),Lo(r,[e],[n])}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Au=tr({slice2d_:function(t,e,n){const r=Zn(t,"x","slice2d");return h(2===r.rank,(()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`)),Lo(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cu=tr({slice3d_:function(t,e,n){const r=Zn(t,"x","slice3d");return h(3===r.rank,(()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`)),Lo(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ou=tr({slice4d_:function(t,e,n){const r=Zn(t,"x","slice4d");return h(4===r.rank,(()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`)),Lo(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iu=tr({softmax_:function(t,e=-1){const n=Zn(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const r={logits:n},s={dim:e};return qe.runKernel("Softmax",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mu=tr({fft_:function(t){h("complex64"===t.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`));const e={input:t};return qe.runKernel("FFT",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ru=tr({ifft_:function(t){h("complex64"===t.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`));const e={input:t};return qe.runKernel("IFFT",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Du=tr({irfft_:function(t){const e=t.shape[t.shape.length-1],n=t.size/e;let r;if(e<=2){const s=Io(t,[n,e]);r=Ru(s)}else{const s=[n,2*(e-1)],o=Io(bs(t),[n,e]),i=Io(ys(t),[n,e]),a=mu(Lo(o,[0,1],[n,e-2]),1),u=oo(mu(Lo(i,[0,1],[n,e-2]),1),Ci(-1)),c=Do([o,a],1),l=Do([i,u],1),f=Io(er(c,l),[s[0],s[1]]);r=Ru(f)}if(r=bs(r),3===t.rank&&0!==t.shape[0]){const e=r,n=t.shape[0];r=Io(r,[n,r.shape[0]/n,r.shape[1]]),e.dispose()}return r}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fu=tr({split_:function(t,e,n=0){const r={x:Zn(t,"x","split")},s={numOrSizeSplits:e,axis:n};return qe.runKernel("SplitV",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lu=tr({rfft_:function(t,e){h("float32"===t.dtype,(()=>`The dtype for rfft() must be real value but got ${t.dtype}`));let n=t.shape[t.shape.length-1];const r=t.size/n;let s;if(null!=e&&e<n){const r=t.shape.map((t=>0)),o=t.shape.map((t=>t));o[t.shape.length-1]=e,s=Lo(t,r,o),n=e}else if(null!=e&&e>n){const r=t.shape.map((t=>t));r[t.shape.length-1]=e-n,s=Do([t,Na(r)],t.shape.length-1),n=e}else s=t;const o=bi(s),i=Io(er(s,o),[r,n]),a=Mu(i),u=Math.floor(n/2)+1,c=bs(a),l=ys(a),f=Fu(c,[u,n-u],c.shape.length-1),p=Fu(l,[u,n-u],l.shape.length-1),d=s.shape.slice();return d[s.shape.length-1]=u,Io(er(f[0],p[0]),d)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pu=tr({squaredDifference_:function(t,e){let n=Zn(t,"a","squaredDifference"),r=Zn(e,"b","squaredDifference");[n,r]=Le(n,r),Es(n.shape,r.shape);const s={a:n,b:r};return qe.runKernel("SquaredDifference",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bu=tr({squeeze_:function(t,e){const n=Zn(t,"x","squeeze");return Io(n,x(n.shape,e).newShape)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vu=tr({stack_:function(t,e=0){const n=Qn(t,"tensors","stack","string_or_numeric");h(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&h(e<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const r=n,s={axis:e};return qe.runKernel("Pack",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zu=tr({step_:function(t,e=0){const n={x:Zn(t,"x","step")},r={alpha:e};return qe.runKernel("Step",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wu=tr({stridedSlice_:function(t,e,n,r,s=0,o=0,i=0,a=0,u=0){const c={x:Zn(t,"x","stridedSlice","string_or_numeric")},l={begin:e,end:n,strides:r,beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};return qe.runKernel("StridedSlice",c,l)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uu=tr({tan_:function(t){const e={x:Zn(t,"x","tan","float32")};return qe.runKernel("Tan",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ju(t,e){d(t);const n=Xn(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return nr(t,null,n,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gu(t,e,n){if(d(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");const r=Xn(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return nr(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qu=tr({topk_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=1,n=!0){const r=Zn(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const s=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const o={x:r},i={k:e,sorted:n},[a,u]=qe.runKernel("TopK",o,i);return{values:a,indices:u}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hu=tr({truncatedNormal_:function(t,e=0,n=1,r,s){if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const o=new ou(e,n,r,!0,s),i=Wr(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ku=tr({unique_:function(t,e=0){const n=Zn(t,"x","unique","string_or_numeric");h(n.rank>0,(()=>"The input tensor must be at least 1D"));const r={x:n},s={axis:e},[o,i]=qe.runKernel("Unique",r,s);return{values:o,indices:i}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xu=tr({unsortedSegmentSum_:function(t,e,n){const r=Zn(t,"x","unsortedSegmentSum"),s=Zn(e,"segmentIds","unsortedSegmentSum","int32");h(b(n),(()=>"numSegments must be of dtype int"));const o={x:r,segmentIds:s},i={numSegments:n};return qe.runKernel("UnsortedSegmentSum",o,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ju=tr({unstack_:function(t,e=0){const n=Zn(t,"x","unstack","string_or_numeric");h(e>=-n.shape.length&&e<n.shape.length,(()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`));const r={value:n},s={axis:e};return qe.runKernel("Unpack",r,s)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yu(t,e){return ma(t,e,"right")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Zu(t,e){const n=[];for(let t=0;t<e.length;t++)e[t]&&n.push(t);const r=Wr(t,"int32"),s=Wr([n.length,t.length],"int32");for(let e=0;e<n.length;e++){const o=r.indexToLoc(n[e]),i=e*t.length;s.values.set(o,i)}return s.toTensor()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qu=async function(t){const e=Zn(t,"condition","whereAsync","bool"),n=await e.data(),r=Zu(e.shape,n);return t!==e&&e.dispose(),r};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tc=async function(t,e,n){const r=Zn(t,"tensor","boolMask"),s=Zn(e,"mask","boolMask","bool"),o=null==n?0:n,i=s.rank,a=r.shape;h(i>0,(()=>"mask cannot be scalar")),p(a.slice(o,o+i),s.shape,"mask's shape must match the first K dimensions of tensor's shape,");let u=1;for(let t=o;t<o+i;t++)u*=a[t];const c=a.slice(0,o).concat([u],a.slice(o+i)),l=Io(r,c),f=Io(s,[-1]),d=await Qu(f),m=Bu(d,[1]),y=ji(l,m,o);return t!==r&&r.dispose(),e!==s&&s.dispose(),m.dispose(),l.dispose(),f.dispose(),d.dispose(),y};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ec=tr({movingAverage_:function(t,e,n,r,s=!0){const o=Zn(t,"v","movingAverage"),i=Zn(e,"x","movingAverage"),a=Zn(n,"decay","movingAverage");Pe(o,i),h(g(o.shape,i.shape),(()=>"Shape mismatch in v and x"));const u=Ci(1),c=ua(u,a);let l=oo(ua(i,o),c);if(s){h(null!=r,(()=>"When using zeroDebias: true, step is required."));const t=Zn(r,"step","movingAverage");l=so(l,ua(u,Ai(a,t)))}return no(o,l)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nc=tr({scatterND_:function(t,e,n){const r=Zn(t,"indices","scatterND","int32"),s=Zn(e,"updates","scatterND");Ds(s,r,n);const o={indices:r,updates:s},i={shape:n};return qe.runKernel("ScatterNd",o,i)}});const rc=tr({sparseToDense_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=0){const s=Zn(t,"sparseIndices","sparseToDense","int32"),o=Zn(e,"sparseValues","sparseToDense","string_or_numeric"),i=Zn(r,"defaultValue","sparseToDense",o.dtype);!function(t,e,n,r){if("int32"!==t.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const s=t.rank>0?t.shape[0]:1,o=t.rank>1?t.shape[1]:1;if(n.length!==o)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${o}.`);const i=e.size;if(0!==e.rank&&(1!==e.rank||i!==s))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${s}]`);if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(s,o,n,i);const a={sparseIndices:s,sparseValues:o,defaultValue:i},u={outputShape:n};return qe.runKernel("SparseToDense",a,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sc=tr({gatherND_:function(t,e){const n=Zn(e,"indices","gatherND","int32"),r={params:Zn(t,"x","gatherND","string_or_numeric"),indices:n};return qe.runKernel("GatherNd",r)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oc=tr({dropout_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const s=Zn(t,"x","dropout");if(h("float32"===s.dtype,(()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${s.dtype} tensor instead.`)),h(e>=0&&e<1,(()=>`rate must be a float in the range [0, 1), but got ${e}.`)),0===e)return t instanceof ke?s.clone():s;const o=function(t,e){if(null==e)return t.shape.slice();if(g(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let r=0;r<t.shape.length;r++)null==e[r]&&null!=t.shape[r]?n.push(t.shape[r]):n.push(e[r]);return n}return e}(s,n),i=1-e,a=so(Ui(no(lu(o,0,1,"float32",r),i)),i);return oo(s,a)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ic(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function ac(t,e,n){const r=1-t%2,s=new Float32Array(t);for(let o=0;o<t;++o){const i=2*Math.PI*o/(t+r-1);s[o]=e-n*Math.cos(i)}return ju(s,"float32")}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uc=async function(t,e,n=1){const r=Zn(t,"predictions","inTopK"),s=Zn(e,"targets","inTopK");h(r.rank>1,(()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`)),h(r.rank-1===s.rank,(()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${s.rank}`)),p(r.shape.slice(0,r.shape.length-1),s.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const o=r.shape[r.shape.length-1];h(n>0&&n<=o,(()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${o}), but got ${n}`));const i=await r.data(),a=await s.data(),[u,c]=[i.length/o,o],l=N("bool",u);for(let t=0;t<u;t++){const e=t*c,r=i.subarray(e,e+c),s=[];for(let t=0;t<r.length;t++)s.push({value:r[t],index:t});s.sort(((t,e)=>e.value-t.value)),l[t]=0;for(let e=0;e<n;e++)if(s[e].index===a[t]){l[t]=1;break}}return t!==r&&r.dispose(),e!==s&&s.dispose(),rr(l,s.shape,"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cc=tr({conv2DBackpropFilter_:function(t,e,n,r,s,o="NHWC",i){let a=t;3===t.rank&&(a=Io(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=Io(e,[1,e.shape[0],e.shape[1],e.shape[2]])),h(4===a.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`)),h(4===u.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`)),h(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const c="NHWC"===o?a.shape[3]:a.shape[1],l="NHWC"===o?u.shape[3]:u.shape[1];h(c===n[2],(()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`)),h(l===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${l}) must match output depth for filter (${n[3]}).`)),Oo("conv2dDerFilter",s,i);const f={x:a,dy:u},p={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,filterShape:n};return qe.runKernel("Conv2DBackpropFilter",f,p)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lc(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return oo(t,zu(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function fc(t,e){let n=e;const r=$s(t.shape,e.shape);return r.length>0&&(n=Mi(n,r)),Io(n,t.shape)}function hc(t,e,n,r){if("linear"===e)return t;if("relu"===e)return pu(t);if("elu"===e)return Ni(t);if("relu6"===e)return du(t);if("prelu"===e)return Va(t,n);if("leakyrelu"===e)return Ji(t,r);if("sigmoid"===e)return Fo(t);throw new Error(`Unknown fused activation ${e}.`)}const pc=(t,e)=>!(t>0)||"linear"===e;
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dc=tr({fusedConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(u=u||"linear",!1===pc(qe.state.gradientDepth,u)){h("NHWC"===s,(()=>`Error in fused conv2d: got dataFormat of ${s} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`));let f=ti(t,e,n,r,s,o,i);return null!=a&&(f=no(f,a)),hc(f,u,c,l)}const f=Zn(t,"x","conv2d","float32"),p=Zn(e,"filter","conv2d","float32");let d=f,m=!1;3===f.rank&&(m=!0,d=Io(f,[1,f.shape[0],f.shape[1],f.shape[2]])),h(4===d.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${d.rank}.`)),h(4===p.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`)),Oo("fused conv2d",r,i);const y="NHWC"===s?d.shape[3]:d.shape[1];h(p.shape[2]===y,(()=>`Error in conv2d: depth of input (${y}) must match input depth for filter ${p.shape[2]}.`)),h(Ao(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const g=xo(d.shape,p.shape,n,o,r,i);let b,w;if(null!=a&&(b=Zn(a,"bias","fused conv2d"),[b]=Le(b,f),"NHWC"===s?Es(g.outShape,b.shape):(h(b.shape.length<=1,(()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${b.shape.length}.`)),h(0===b.shape.length||b.shape[0]===g.outChannels||1===b.shape[0],(()=>`Error in fused conv2d: bias shape (${b.shape}) is not compatible with the number of output channels (${g.outChannels})`)))),null!=c){const t=c.shape;if(h(t.length<=1||3===t.length,(()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${t.length}.`)),1===t.length)h(1===t[0]||t[0]===g.outChannels,(()=>`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the number of output channels (${g.outChannels}).`));else if(3===t.length)try{Es(t,g.outShape)}catch(e){const n=`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error(n)}w=Zn(c,"prelu weights","fused conv2d")}const v=(t,e)=>{h("NHWC"===s,(()=>`Error in gradient of fused conv2D: got dataFormat of ${s} but only NHWC is currently supported.`));const[i,a,c,l]=e,f=lc(t,c,u);h(ko(o),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`));const p=[ni(a.shape,f,i,n,r),cc(a,f,i.shape,n,r)];if(null!=l){const t=fc(l,f);p.push(t)}return p},x={x:d,filter:p,bias:b,preluActivationWeights:w},N={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=sa(((t,e,n)=>{let r=qe.runKernel("FusedConv2D",x,N);return n([e,t,r]),m&&(r=Io(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:v}}));return t(d,p)}{const t=sa(((t,e,n,r)=>{let s=qe.runKernel("FusedConv2D",x,N);return r([e,t,s,n]),m&&(s=Io(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:v}}));return t(d,p,b)}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mc=tr({depthwiseConv2dNativeBackpropFilter_:function(t,e,n,r,s,o=[1,1],i){let a=t;3===t.rank&&(a=Io(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=Io(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:u},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,filterShape:n};return qe.runKernel("DepthwiseConv2dNativeBackpropFilter",c,l)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yc=tr({depthwiseConv2dNativeBackpropInput_:function(t,e,n,r,s,o=[1,1],i){let a=e,u=!1;3===e.rank&&(u=!0,a=Io(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,inputShape:t},f=qe.runKernel("DepthwiseConv2dNativeBackpropInput",c,l);return u?Io(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gc=tr({fusedDepthwiseConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(!1===pc(qe.state.gradientDepth,u)){let f=pi(t,e,n,r,s,o,i);return null!=a&&(f=no(f,a)),hc(f,u,c,l)}const f=Zn(t,"x","depthwiseConv2d","float32"),p=Zn(e,"filter","depthwiseConv2d","float32");let d=f,m=!1;3===f.rank&&(m=!0,d=Io(f,[1,f.shape[0],f.shape[1],f.shape[2]])),h(4===d.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${d.rank}.`)),h(4===p.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`)),h(d.shape[3]===p.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${d.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`)),null==o&&(o=[1,1]),h(Ao(n,o),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),Oo("fused depthwiseConv2d",r,i);const y=xo(d.shape,p.shape,n,o,r,i,!0);let g,b;null!=a&&(g=Zn(a,"bias","fused conv2d"),[g]=Le(g,f),Es(y.outShape,g.shape)),null!=c&&(b=Zn(c,"prelu weights","fused depthwiseConv2d"));const w=(t,e)=>{h(ko(o),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`));const[s,a,c,l]=e,f=lc(t,c,u),p=yc(a.shape,f,s,n,r,o,i),d=mc(a,f,s.shape,n,r,o,i);if(null!=l){return[p,d,fc(g,f)]}return[p,d]},v={x:d,filter:p,bias:g,preluActivationWeights:b},x={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=sa(((t,e,n)=>{let r=qe.runKernel("FusedDepthwiseConv2D",v,x);return n([e,t,r]),m&&(r=Io(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:w}}));return t(d,p)}{const t=sa(((t,e,n,r)=>{let s=qe.runKernel("FusedDepthwiseConv2D",v,x);return r([e,t,s,n]),m&&(s=Io(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:w}}));return t(d,p,g)}}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bc=tr({fusedMatMul_:function({a:t,b:e,transposeA:n=!1,transposeB:r=!1,bias:s,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a}){if(!1===pc(qe.state.gradientDepth,o)){let u=us(t,e,n,r);return null!=s&&(u=no(u,s)),hc(u,o,i,a)}let u=Zn(t,"a","fused matMul"),c=Zn(e,"b","fused matMul");[u,c]=Le(u,c);const l=n?u.shape[u.rank-2]:u.shape[u.rank-1],f=r?c.shape[c.rank-1]:c.shape[c.rank-2],p=n?u.shape[u.rank-1]:u.shape[u.rank-2],d=r?c.shape[c.rank-2]:c.shape[c.rank-1],m=u.shape.slice(0,-2),g=c.shape.slice(0,-2),b=y(m),w=y(g);h(l===f,(()=>`Error in fused matMul: inner shapes (${l}) and (${f}) of Tensors with shapes ${u.shape} and ${c.shape} and transposeA=${n} and transposeB=${r} must match.`));const v=Es(u.shape.slice(0,-2),c.shape.slice(0,-2)).concat([p,d]),x=Io(u,n?[b,l,p]:[b,p,l]),N=Io(c,r?[w,d,f]:[w,f,d]);let $,E;null!=s&&($=Zn(s,"bias","fused matMul"),[$]=Le($,u),Es(v,$.shape)),null!=i&&(E=Zn(i,"prelu weights","fused matMul"));const S=(t,e)=>{const[i,a,u,c]=e,l=lc(Io(t,u.shape),u,o);let f,h;if(n||r?!n&&r?(f=us(l,a,!1,!1),h=us(l,i,!0,!1)):n&&!r?(f=us(a,l,!1,!0),h=us(i,l,!1,!1)):(f=us(a,l,!0,!0),h=us(l,i,!0,!0)):(f=us(l,a,!1,!0),h=us(i,l,!0,!1)),null!=s){return[f,h,fc(c,l)]}return[f,h]},_={a:x,b:N,bias:$,preluActivationWeights:E},T={transposeA:n,transposeB:r,activation:o,leakyreluAlpha:a};if(null==s){const t=sa(((t,e,n)=>{const r=qe.runKernel("_FusedMatMul",_,T);return n([t,e,r]),{value:Io(r,v),gradFunc:S}}));return t(x,N)}{const t=sa(((t,e,n,r)=>{const s=qe.runKernel("_FusedMatMul",_,T);return r([t,e,s,n]),{value:Io(s,v),gradFunc:S}}));return t(x,N,$)}}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var wc=Object.freeze({__proto__:null,conv2d:dc,depthwiseConv2d:gc,matMul:bc});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vc=tr({hammingWindow_:function(t){return ac(t,.54,.46)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xc=tr({hannWindow_:function(t){return ac(t,.5,.5)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nc=tr({frame_:function(t,e,n,r=!1,s=0){let o=0;const i=[];for(;o+e<=t.size;)i.push(Lo(t,o,e)),o+=n;if(r)for(;o<t.size;){const r=o+e-t.size,a=Do([Lo(t,o,e-r),Wi([r],s)]);i.push(a),o+=n}return 0===i.length?Gu([],[0,e]):Io(Do(i),[i.length,e])}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $c=tr({stft_:function(t,e,n,r,s=xc){null==r&&(r=ic(e));const o=Nc(t,e,n),i=oo(o,s(e));return Lu(i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ec=tr({cropAndResize_:function(t,e,n,r,s="bilinear",o=0){const i=Zn(t,"image","cropAndResize"),a=Zn(e,"boxes","cropAndResize","float32"),u=Zn(n,"boxInd","cropAndResize","int32"),c=a.shape[0];h(4===i.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`)),h(2===a.rank&&4===a.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`)),h(1===u.rank&&u.shape[0]===c,(()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`)),h(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),h(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),h("bilinear"===s||"nearest"===s,(()=>`method must be bilinear or nearest, but was ${s}`));const l={image:i,boxes:a,boxInd:u},f={method:s,extrapolationValue:o,cropSize:r};return qe.runKernel("CropAndResize",l,f)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sc=tr({flipLeftRight_:function(t){const e=Zn(t,"image","flipLeftRight","float32");h(4===e.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`));const n={image:e};return qe.runKernel("FlipLeftRight",n,{})}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _c=tr({grayscaleToRGB_:function(t){const e=Zn(t,"image","grayscaleToRGB"),n=e.rank-1,r=e.shape[n];h(e.rank>=2,(()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`)),h(1===r,(()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`));const s=new Array(e.rank);return s.fill(1,0,n),s[n]=3,Vi(e,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tc=tr({rotateWithOffset_:function(t,e,n=0,r=.5){const s=Zn(t,"image","rotateWithOffset","float32");h(4===s.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${s.rank}.`));const o={image:s},i={radians:e,fillValue:n,center:r};return qe.runKernel("RotateWithOffset",o,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kc(t,e,n,r,s,o){null==r&&(r=.5),null==s&&(s=Number.NEGATIVE_INFINITY),null==o&&(o=0);const i=t.shape[0];return n=Math.min(n,i),h(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),h(2===t.rank,(()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`)),h(4===t.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`)),h(1===e.rank,(()=>"scores must be a 1D tensor")),h(e.shape[0]===i,(()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`)),h(0<=o&&o<=1,(()=>`softNmsSigma must be in [0, 1], but was '${o}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:s,softNmsSigma:o}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ac=tr({nonMaxSuppression_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const o=Zn(t,"boxes","nonMaxSuppression","float32"),i=Zn(e,"scores","nonMaxSuppression","float32"),a=kc(o,i,n,r,s),u={maxOutputSize:n=a.maxOutputSize,iouThreshold:r=a.iouThreshold,scoreThreshold:s=a.scoreThreshold};return qe.runKernel("NonMaxSuppressionV3",{boxes:o,scores:i},u)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cc(t,e,n){const r=function(t,e,n){return function(t,e,n){let r=0,s=t.length,o=0,i=!1;for(;r<s;){o=r+(s-r>>>1);const a=n(e,t[o]);a>0?r=o+1:(s=o,i=!a)}return i?r:-r-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e,n||Oc)}(t,e,n),s=r<0?-(r+1):r;t.splice(s,0,e)}function Oc(t,e){return t>e?1:t<e?-1:0}function Ic(t,e,n,r,s){return Dc(t,e,n,r,s,0)}function Mc(t,e,n,r,s,o){return Dc(t,e,n,r,s,0,!1,o,!0)}function Rc(t,e,n,r,s,o){return Dc(t,e,n,r,s,o,!0)}function Dc(t,e,n,r,s,o,i=!1,a=!1,u=!1){const c=[];for(let t=0;t<e.length;t++)e[t]>s&&c.push({score:e[t],boxIndex:t,suppressBeginIndex:0});c.sort(Pc);const l=o>0?-.5/o:0,f=[],h=[];for(;f.length<n&&c.length>0;){const e=c.pop(),{score:n,boxIndex:o,suppressBeginIndex:i}=e;if(n<s)break;let a=!1;for(let n=f.length-1;n>=i;--n){const i=Fc(t,o,f[n]);if(i>=r){a=!0;break}if(e.score=e.score*Lc(r,l,i),e.score<=s)break}e.suppressBeginIndex=f.length,a||(e.score===n?(f.push(o),h.push(e.score)):e.score>s&&Cc(c,e,Pc))}const p=f.length,d=n-p;a&&d>0&&(f.push(...new Array(d).fill(0)),h.push(...new Array(d).fill(0)));const m={selectedIndices:f};return i&&(m.selectedScores=h),u&&(m.validOutputs=p),m}function Fc(t,e,n){const r=t.subarray(4*e,4*e+4),s=t.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(s[0],s[2]),l=Math.min(s[1],s[3]),f=Math.max(s[0],s[2]),h=Math.max(s[1],s[3]),p=(a-o)*(u-i),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;const m=Math.max(o,c),y=Math.max(i,l),g=Math.min(a,f),b=Math.min(u,h),w=Math.max(g-m,0)*Math.max(b-y,0);return w/(p+d-w)}function Lc(t,e,n){const r=Math.exp(e*n*n);return n<=t?r:0}function Pc(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bc=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const o=Zn(t,"boxes","nonMaxSuppressionAsync"),i=Zn(e,"scores","nonMaxSuppressionAsync"),a=kc(o,i,n,r,s);n=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;const u=await Promise.all([o.data(),i.data()]),c=u[0],l=u[1],{selectedIndices:f}=Ic(c,l,n,r,s);return o!==t&&o.dispose(),i!==e&&i.dispose(),ju(f,"int32")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vc=tr({nonMaxSuppressionWithScore_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=Zn(t,"boxes","nonMaxSuppression"),a=Zn(e,"scores","nonMaxSuppression"),u=kc(i,a,n,r,s,o),c={boxes:i,scores:a},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:s=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},f=qe.runKernel("NonMaxSuppressionV5",c,l);return{selectedIndices:f[0],selectedScores:f[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zc=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=Zn(t,"boxes","nonMaxSuppressionAsync"),a=Zn(e,"scores","nonMaxSuppressionAsync"),u=kc(i,a,n,r,s,o);n=u.maxOutputSize,r=u.iouThreshold,s=u.scoreThreshold,o=u.softNmsSigma;const c=await Promise.all([i.data(),a.data()]),l=c[0],f=c[1],{selectedIndices:h,selectedScores:p}=Rc(l,f,n,r,s,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:ju(h,"int32"),selectedScores:ju(p)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wc=tr({nonMaxSuppressionPadded_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=Zn(t,"boxes","nonMaxSuppression"),a=Zn(e,"scores","nonMaxSuppression"),u=kc(i,a,n,r,s,null),c={boxes:i,scores:a},l={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:o},f=qe.runKernel("NonMaxSuppressionV4",c,l);return{selectedIndices:f[0],validOutputs:f[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uc=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=Zn(t,"boxes","nonMaxSuppressionAsync"),a=Zn(e,"scores","nonMaxSuppressionAsync"),u=kc(i,a,n,r,s,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[h,p]=await Promise.all([i.data(),a.data()]),{selectedIndices:d,validOutputs:m}=Mc(h,p,c,l,f,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:ju(d,"int32"),validOutputs:Ci(m,"int32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jc=tr({resizeBilinear_:function(t,e,n=!1,r=!1){const s=Zn(t,"images","resizeBilinear");h(3===s.rank||4===s.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${s.rank}.`)),h(2===e.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`)),h(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=Io(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=qe.runKernel("ResizeBilinear",a,u);return i?Io(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gc=tr({resizeNearestNeighbor_:function(t,e,n=!1,r=!1){const s=Zn(t,"images","resizeNearestNeighbor");h(3===s.rank||4===s.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${s.rank}.`)),h(2===e.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`)),h("float32"===s.dtype||"int32"===s.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),h(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=Io(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=qe.runKernel("ResizeNearestNeighbor",a,u);return i?Io(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qc=tr({threshold_:function(t,e="binary",n=!1,r=.5){const s=Zn(t,"image","threshold"),o=s.shape[0]*s.shape[1];let i,a,u,c,l=oo(ju([r]),255);if(h(3===s.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${s.rank}.`)),h(3===s.shape[2]||1===s.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${s.shape[2]}.`)),h("int32"===s.dtype||"float32"===s.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${s.dtype}.`)),h("otsu"===e||"binary"===e,(()=>`Method must be binary or otsu, but was ${e}`)),3===s.shape[2]){[i,a,u]=Fu(s,[1,1,1],-1);const t=oo(i,.2989),e=oo(a,.587),n=oo(u,.114);c=no(no(t,e),n)}else c=t;if("otsu"===e){l=function(t,e){let n,r,s,o,i,a,u=ju([-1]),c=ju([0]),l=ju([0]);for(let f=0;f<t.size-1;f++){n=Lo(t,0,f+1),r=Lo(t,f+1),i=so(Mi(n),e),a=so(Mi(r),e);const h=Mi(oo(n,fu(0,n.size)));s=so(h,Mi(n));const p=Wi(r.shape,n.size),d=no(fu(0,r.size),p),m=oo(r,d);o=so(Mi(m),Mi(r));const y=ua(s,o),g=ua(s,o),b=oo(i,a);l=oo(oo(b,y),g);const w=Gi(l,c);c=gi(w,l,c),u=gi(w,ju([f]),u)}return u}(Go(Ur(vu(c),"int32"),rr([]),256),o)}const f=n?Zi(c,l):Gi(c,l);return Ur(oo(f,255),"int32")}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hc=tr({transform_:function(t,e,n="nearest",r="constant",s=0,o){const i=Zn(t,"image","transform","float32"),a=Zn(e,"transforms","transform","float32");h(4===i.rank,(()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`)),h(2===a.rank&&(a.shape[0]===i.shape[0]||1===a.shape[0])&&8===a.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),h(null==o||2===o.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`));const u={image:i,transforms:a},c={interpolation:n,fillMode:r,fillValue:s,outputShape:o};return qe.runKernel("Transform",u,c)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kc=tr({bandPart_:function(t,e,n){h(e%1==0,(()=>`bandPart(): numLower must be an integer, got ${e}.`)),h(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`));const r=Zn(t,"a","bandPart");h(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));const s=r.shape,[o,i]=r.shape.slice(-2);if(!(e<=o))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`);if(!(n<=i))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${i}).`);e<0&&(e=o),n<0&&(n=i);const a=Io(fu(0,o,1,"int32"),[-1,1]),u=fu(0,i,1,"int32"),c=ua(a,u),l=fa(Zi(c,Ci(+e,"int32")),qi(c,Ci(-n,"int32"))),f=Na([o,i],r.dtype);return Io(Vu(Ju(Io(r,[-1,o,i])).map((t=>gi(l,t,f)))),s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xc=tr({gramSchmidt_:function(t){let e;if(Array.isArray(t)){e=!1,h(null!=t&&t.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=t[0].shape[0];for(let e=1;e<t.length;++e)h(t[e].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[e].shape[0]} vs. ${n})`))}else e=!0,t=Fu(t,t.shape[0],0).map((t=>Bu(t,[0])));h(t.length<=t[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`));const n=[],r=t;for(let e=0;e<t.length;++e)n.push(qe.tidy((()=>{let t=r[e];if(e>0)for(let r=0;r<e;++r){const e=oo(Mi(oo(n[r],t)),n[r]);t=ua(t,e)}return so(t,Di(t,"euclidean"))})));return e?Vu(n,0):n}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jc(t,e=!1){return qe.tidy((()=>{h(2===t.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`));const n=t.shape[0],r=t.shape[1];let s=zi(n),o=jr(t);const i=Gu([[1]],[1,1]);let a=jr(i);const u=n>=r?r:n;for(let t=0;t<u;++t){const e=o,u=a,c=s;[a,o,s]=qe.tidy((()=>{const e=Lo(o,[t,t],[n-t,1]),u=Di(e),c=Lo(o,[t,t],[1,1]),l=gi(Gi(c,0),Gu([[-1]]),Gu([[1]])),f=ua(c,oo(l,u)),h=so(e,f);a=1===h.shape[0]?jr(i):Do([i,Lo(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);const p=gs(so(us(l,f),u)),d=Lo(o,[t,0],[n-t,r]),m=oo(p,a),y=ws(a);if(0===t)o=ua(d,us(m,us(y,d)));else{const e=ua(d,us(m,us(y,d)));o=Do([Lo(o,[0,0],[t,r]),e],0)}const g=ws(m),b=Lo(s,[0,t],[n,s.shape[1]-t]);if(0===t)s=ua(b,us(us(b,a),g));else{const e=ua(b,us(us(b,a),g));s=Do([Lo(s,[0,0],[n,t]),e],1)}return[a,o,s]})),hs([e,u,c])}return!e&&n>r&&(s=Lo(s,[0,0],[n,r]),o=Lo(o,[0,0],[r,r])),[s,o]}))}const Yc=tr({qr_:function(t,e=!1){if(h(t.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`)),2===t.rank)return Jc(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce(((t,e)=>t*e)),r=Ju(Io(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),s=[],o=[];r.forEach((t=>{const[n,r]=Jc(t,e);s.push(n),o.push(r)}));return[Io(Vu(s,0),t.shape),Io(Vu(o,0),t.shape)]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Zc;!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Zc||(Zc={}));const Qc=tr({computeWeightedLoss_:function(t,e,n=Zc.SUM_BY_NONZERO_WEIGHTS){const r=Zn(t,"losses","computeWeightedLoss");let s=null;null!=e&&(s=Zn(e,"weights","computeWeightedLoss"));const o=null==s?r:oo(r,s);if(n===Zc.NONE)return o;if(n===Zc.SUM)return Mi(o);if(n===Zc.MEAN){if(null==s)return xa(o);{const t=r.size/s.size,e=so(Mi(o),Mi(s));return t>1?so(e,Ci(t)):e}}if(n===Zc.SUM_BY_NONZERO_WEIGHTS){if(null==s)return so(Mi(o),Ci(r.size));{const t=oo(s,$a(r.shape)),e=Ur(Mi(Ca(t,Ci(0))),"float32");return so(Mi(o),e)}}throw Error(`Unknown reduction: ${n}`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tl=tr({absoluteDifference_:function(t,e,n,r=Zc.SUM_BY_NONZERO_WEIGHTS){const s=Zn(t,"labels","absoluteDifference"),o=Zn(e,"predictions","absoluteDifference");let i=null;null!=n&&(i=Zn(n,"weights","absoluteDifference")),p(s.shape,o.shape,"Error in absoluteDifference: ");const a=io(ua(s,o));return Qc(a,i,r)}});const el=tr({cosineDistance_:function(t,e,n,r,s=Zc.SUM_BY_NONZERO_WEIGHTS){const o=Zn(t,"labels","cosineDistance"),i=Zn(e,"predictions","cosineDistance");let a=null;null!=r&&(a=Zn(r,"weights","cosineDistance")),p(o.shape,i.shape,"Error in cosineDistance: ");const u=Ci(1),c=ua(u,Mi(oo(o,i),n,!0));return Qc(c,a,s)}});const nl=tr({hingeLoss_:function(t,e,n,r=Zc.SUM_BY_NONZERO_WEIGHTS){let s=Zn(t,"labels","hingeLoss");const o=Zn(e,"predictions","hingeLoss");let i=null;null!=n&&(i=Zn(n,"weights","hingeLoss")),p(s.shape,o.shape,"Error in hingeLoss: ");const a=Ci(1);s=ua(oo(Ci(2),s),a);const u=pu(ua(a,oo(s,o)));return Qc(u,i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rl=tr({huberLoss_:function(t,e,n,r=1,s=Zc.SUM_BY_NONZERO_WEIGHTS){const o=Zn(t,"labels","huberLoss"),i=Zn(e,"predictions","huberLoss");let a=null;null!=n&&(a=Zn(n,"weights","huberLoss")),p(o.shape,i.shape,"Error in huberLoss: ");const u=Ci(r),c=io(ua(i,o)),l=Ea(c,u),f=ua(c,l),h=no(oo(Ci(.5),Ii(l)),oo(u,f));return Qc(h,a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sl=tr({logLoss_:function(t,e,n,r=1e-7,s=Zc.SUM_BY_NONZERO_WEIGHTS){const o=Zn(t,"labels","logLoss"),i=Zn(e,"predictions","logLoss");let a=null;null!=n&&(a=Zn(n,"weights","logLoss")),p(o.shape,i.shape,"Error in logLoss: ");const u=Ci(1),c=Ci(r),l=gs(oo(o,ea(no(i,c)))),f=oo(ua(u,o),ea(no(ua(u,i),c))),h=ua(l,f);return Qc(h,a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ol=tr({meanSquaredError_:function(t,e,n,r=Zc.SUM_BY_NONZERO_WEIGHTS){const s=Zn(t,"labels","meanSquaredError"),o=Zn(e,"predictions","meanSquaredError");let i=null;null!=n&&(i=Zn(n,"weights","meanSquaredError")),p(s.shape,o.shape,"Error in meanSquaredError: ");const a=Pu(s,o);return Qc(a,i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const il=tr({sigmoidCrossEntropy_:function(t,e,n,r=0,s=Zc.SUM_BY_NONZERO_WEIGHTS){let o=Zn(t,"multiClassLabels","sigmoidCrossEntropy");const i=Zn(e,"logits","sigmoidCrossEntropy");let a=null;if(null!=n&&(a=Zn(n,"weights","sigmoidCrossEntropy")),p(o.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){const t=Ci(r),e=Ci(1),n=Ci(.5);o=no(oo(o,ua(e,t)),oo(n,t))}const u=function(t,e){const n=Zn(t,"labels","sigmoidCrossEntropyWithLogits"),r=Zn(e,"logits","sigmoidCrossEntropyWithLogits");p(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const s=pu(r),o=oo(r,n),i=na(Li(gs(io(r))));return no(ua(s,o),i)}(o,i);return Qc(u,a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const al=tr({softmaxCrossEntropy_:function(t,e,n,r=0,s=Zc.SUM_BY_NONZERO_WEIGHTS){let o=Zn(t,"onehotLabels","softmaxCrossEntropy");const i=Zn(e,"logits","softmaxCrossEntropy");let a=null;if(null!=n&&(a=Zn(n,"weights","softmaxCrossEntropy")),p(o.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){const t=Ci(r),e=Ci(1),n=Ci(o.shape[1]);o=no(oo(o,ua(e,t)),so(t,n))}const u=function(t,e,n=-1){if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);const r=sa(((t,e,r)=>{const s=la(e,[n],!0),o=ua(Ur(e,"float32"),s);r([t,o]);const i=gs(oo(o,t));return{value:Mi(i,[n]),gradFunc:(t,e)=>{const[r,s]=e,o=_i(t.shape,[n]);return[oo(Io(t,o),ua(Ur(r,"float32"),Li(s))),oo(Io(t,o),ua(Li(s),Ur(r,"float32")))]}}}));return r(t,e)}(o,i);return Qc(u,a,s)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ul=tr({sparseFillEmptyRows_:function(t,e,n,r){const s=Zn(t,"indices","sparseFillEmptyRows","int32"),o=Zn(e,"values","sparseFillEmptyRows"),i=Zn(n,"denseShape","sparseFillEmptyRows","int32"),a=Zn(r,"defaultValue","sparseFillEmptyRows",o.dtype);if(2!==s.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${s.shape}`);if(1!==o.rank)throw new Error(`Values should be Tensor1D but received shape ${o.shape}`);if(1!==i.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${i.shape}`);if(0!==a.rank)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const u={indices:s,values:o,denseShape:i,defaultValue:a},c=qe.runKernel("SparseFillEmptyRows",u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cl=tr({sparseReshape_:function(t,e,n){const r=Zn(t,"inputIndices","sparseReshape","int32"),s=Zn(e,"inputShape","sparseReshape","int32"),o=Zn(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==s.rank)throw new Error(`Input shape should be Tensor1D but received shape ${s.shape}`);if(1!==o.rank)throw new Error(`New shape should be Tensor1D but received shape ${o.shape}`);const i={inputIndices:r,inputShape:s,newShape:o},a=qe.runKernel("SparseReshape",i);return{outputIndices:a[0],outputShape:a[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ll=tr({sparseSegmentMean_:function(t,e,n){const r=Zn(t,"data","sparseSegmentMean"),s=Zn(e,"indices","sparseSegmentMean","int32"),o=Zn(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return qe.runKernel("SparseSegmentMean",i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fl=tr({sparseSegmentSum_:function(t,e,n){const r=Zn(t,"data","sparseSegmentSum"),s=Zn(e,"indices","sparseSegmentSum","int32"),o=Zn(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return qe.runKernel("SparseSegmentSum",i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hl=tr({stringNGrams_:function(t,e,n,r,s,o,i,a){const u=Zn(t,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error(`Data must be a vector, saw: ${u.shape}`);const c=Zn(e,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");const l={separator:n,nGramWidths:r,leftPad:s,rightPad:o,padWidth:i,preserveShortSequences:a},f={data:u,dataSplits:c},h=qe.runKernel("StringNGrams",f,l);return{nGrams:h[0],nGramsSplits:h[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pl=tr({stringSplit_:function(t,e,n=!0){const r=Zn(t,"input","stringSplit","string"),s=Zn(e,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(0!==s.rank)throw new Error(`Delimiter should be a scalar but received shape ${s.shape}`);const o={skipEmpty:n},i={input:r,delimiter:s},a=qe.runKernel("StringSplit",i,o);return{indices:a[0],values:a[1],shape:a[2]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dl=tr({stringToHashBucketFast_:function(t,e){const n=Zn(t,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const s={input:n};return qe.runKernel("StringToHashBucketFast",s,r)}}),ml={fft:Mu,ifft:Ru,rfft:Lu,irfft:Du},yl={hammingWindow:vc,hannWindow:xc,frame:Nc,stft:$c},gl={flipLeftRight:Sc,grayscaleToRGB:_c,resizeNearestNeighbor:Gc,resizeBilinear:jc,rotateWithOffset:Tc,cropAndResize:Ec,nonMaxSuppression:Ac,nonMaxSuppressionAsync:Bc,nonMaxSuppressionWithScore:Vc,nonMaxSuppressionWithScoreAsync:zc,nonMaxSuppressionPadded:Wc,nonMaxSuppressionPaddedAsync:Uc,threshold:qc,transform:Hc},bl={bandPart:Kc,gramSchmidt:Xc,qr:Yc},wl={absoluteDifference:tl,computeWeightedLoss:Qc,cosineDistance:el,hingeLoss:nl,huberLoss:rl,logLoss:sl,meanSquaredError:ol,sigmoidCrossEntropy:il,softmaxCrossEntropy:al},vl={sparseFillEmptyRows:ul,sparseReshape:cl,sparseSegmentMean:ll,sparseSegmentSum:fl},xl={stringNGrams:hl,stringSplit:pl,stringToHashBucketFast:dl};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Nl extends Ks{minimize(t,e=!1,n){const{value:r,grads:s}=this.computeGradients(t,n);if(null!=n){const t=n.map((t=>({name:t.name,tensor:s[t.name]})));this.applyGradients(t)}else this.applyGradients(s);return hs(s),e?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return ra(t,e)}dispose(){null!=this.iterations_&&hs(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:Ci(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(Nl,Symbol.hasInstance,{value:t=>null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class $l extends Nl{constructor(t,e,n=null){super(),this.learningRate=t,this.rho=e,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=qe.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=qe.registeredVariables[e];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${e}/accum_grad`,variable:fs((()=>bi(r).variable(false)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${e}/accum_var`,variable:fs((()=>bi(r).variable(false)))});const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const o=this.accumulatedGrads[n].variable,i=this.accumulatedUpdates[n].variable;fs((()=>{const t=no(oo(o,this.rho),oo(Ii(s),1-this.rho)),e=oo(so(Oi(no(i,this.epsilon)),Oi(no(o,this.epsilon))),s),n=no(oo(i,this.rho),oo(Ii(e),1-this.rho));o.assign(t),i.assign(n);const a=no(oo(e,-this.learningRate),r);r.assign(a)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(hs(this.accumulatedGrads.map((t=>t.variable))),hs(this.accumulatedUpdates.map((t=>t.variable))))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){const e=(t=await this.extractIterations(t)).length/2;this.accumulatedGrads=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedUpdates=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}$l.className="Adadelta",Js($l);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class El extends Nl{constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=qe.registeredVariables[e];if(null==this.accumulatedGrads[n]){const t=!1;this.accumulatedGrads[n]={originalName:`${e}/accumulator`,variable:fs((()=>Wi(r.shape,this.initialAccumulatorValue).variable(t)))}}const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const o=this.accumulatedGrads[n].variable;fs((()=>{const t=no(o,Ii(s));o.assign(t);const e=no(oo(so(s,Oi(no(t,qe.backend.epsilon()))),-this.learningRate),r);r.assign(e)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&hs(this.accumulatedGrads.map((t=>t.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulatedGrads=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}El.className="Adagrad",Js(El);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Sl extends Nl{constructor(t,e,n,r=null){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],fs((()=>{this.accBeta1=Ci(e).variable(),this.accBeta2=Ci(n).variable()})),null==r&&(this.epsilon=qe.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);fs((()=>{const n=ua(1,this.accBeta1),r=ua(1,this.accBeta2);e.forEach(((e,s)=>{const o=qe.registeredVariables[e];null==this.accumulatedFirstMoment[s]&&(this.accumulatedFirstMoment[s]={originalName:`${e}/m`,variable:fs((()=>bi(o).variable(false)))}),null==this.accumulatedSecondMoment[s]&&(this.accumulatedSecondMoment[s]={originalName:`${e}/v`,variable:fs((()=>bi(o).variable(false)))});const i=Array.isArray(t)?t[s].tensor:t[e];if(null==i)return;const a=this.accumulatedFirstMoment[s].variable,u=this.accumulatedSecondMoment[s].variable,c=no(oo(a,this.beta1),oo(i,1-this.beta1)),l=no(oo(u,this.beta2),oo(Ii(i),1-this.beta2)),f=so(c,n),h=so(l,r);a.assign(c),u.assign(l);const p=no(oo(so(f,no(Oi(h),this.epsilon)),-this.learningRate),o);o.assign(p)})),this.accBeta1.assign(oo(this.accBeta1,this.beta1)),this.accBeta2.assign(oo(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&hs(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedSecondMoment&&hs(this.accumulatedSecondMoment.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t),fs((()=>{this.accBeta1.assign(Ai(this.beta1,this.iterations_+1)),this.accBeta2.assign(Ai(this.beta2,this.iterations_+1))}));const e=t.length/2;this.accumulatedFirstMoment=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedSecondMoment=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}Sl.className="Adam",Js(Sl);
/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/
class _l extends Nl{constructor(t,e,n,r=null,s=0){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],fs((()=>{this.iteration=Ci(0).variable(),this.accBeta1=Ci(e).variable()})),null==r&&(this.epsilon=qe.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);fs((()=>{const n=ua(1,this.accBeta1),r=so(-this.learningRate,no(oo(this.iteration,this.decay),1));e.forEach(((e,s)=>{const o=qe.registeredVariables[e];null==this.accumulatedFirstMoment[s]&&(this.accumulatedFirstMoment[s]={originalName:`${e}/m`,variable:bi(o).variable(false)}),null==this.accumulatedWeightedInfNorm[s]&&(this.accumulatedWeightedInfNorm[s]={originalName:`${e}/v`,variable:bi(o).variable(false)});const i=Array.isArray(t)?t[s].tensor:t[e];if(null==i)return;const a=this.accumulatedFirstMoment[s].variable,u=this.accumulatedWeightedInfNorm[s].variable,c=no(oo(a,this.beta1),oo(i,1-this.beta1)),l=oo(u,this.beta2),f=io(i),h=va(l,f);a.assign(c),u.assign(h);const p=no(oo(so(r,n),so(c,no(h,this.epsilon))),o);o.assign(p)})),this.iteration.assign(no(this.iteration,1)),this.accBeta1.assign(oo(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&hs(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedWeightedInfNorm&&hs(this.accumulatedWeightedInfNorm.map((t=>t.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}_l.className="Adamax",Js(_l);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Tl extends Nl{constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);e.forEach(((e,n)=>{const r=Array.isArray(t)?t[n].tensor:t[e];if(null==r)return;const s=qe.registeredVariables[e];fs((()=>{const t=no(oo(this.c,r),s);s.assign(t)}))})),this.incrementIterations()}setLearningRate(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=ps(Ci(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(0!==(t=await this.extractIterations(t)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}Tl.className="SGD",Js(Tl);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class kl extends Tl{constructor(t,e,n=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=n,this.accumulations=[],this.m=Ci(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=qe.registeredVariables[e];if(null==this.accumulations[n]){const t=!1;this.accumulations[n]={originalName:`${e}/momentum`,variable:fs((()=>bi(r).variable(t)))}}const s=this.accumulations[n].variable,o=Array.isArray(t)?t[n].tensor:t[e];null!=o&&fs((()=>{let t;const e=no(oo(this.m,s),o);t=this.useNesterov?no(oo(this.c,no(o,oo(e,this.m))),r):no(oo(this.c,e),r),s.assign(e),r.assign(t)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&hs(this.accumulations.map((t=>t.variable)))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulations=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}kl.className="Momentum",Js(kl);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Al extends Nl{constructor(t,e=.9,n=0,r=null,s=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,null==r&&(this.epsilon=qe.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=qe.registeredVariables[e],s=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${e}/rms`,variable:fs((()=>bi(r).variable(s)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${e}/momentum`,variable:fs((()=>bi(r).variable(s)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${e}/mg`,variable:fs((()=>bi(r).variable(s)))});const o=Array.isArray(t)?t[n].tensor:t[e];if(null==o)return;const i=this.accumulatedMeanSquares[n].variable,a=this.accumulatedMoments[n].variable;fs((()=>{const t=no(oo(i,this.decay),oo(Ii(o),1-this.decay));if(this.centered){const e=this.accumulatedMeanGrads[n].variable,s=no(oo(e,this.decay),oo(o,1-this.decay)),u=so(oo(o,this.learningRate),Oi(ua(t,no(Ii(s),this.epsilon)))),c=no(oo(a,this.momentum),u);i.assign(t),e.assign(s),a.assign(c);const l=ua(r,c);r.assign(l)}else{const t=no(oo(i,this.decay),oo(Ii(o),1-this.decay)),e=no(oo(a,this.momentum),so(oo(o,this.learningRate),Oi(no(t,this.epsilon))));i.assign(t),a.assign(e);const n=ua(r,e);r.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&hs(this.accumulatedMeanSquares.map((t=>t.variable))),null!=this.accumulatedMeanGrads&&this.centered&&hs(this.accumulatedMeanGrads.map((t=>t.variable))),null!=this.accumulatedMoments&&hs(this.accumulatedMoments.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,n=!1;this.accumulatedMeanSquares=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.accumulatedMoments=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}Al.className="RMSProp",Js(Al);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Cl{static sgd(t){return new Tl(t)}static momentum(t,e,n=!1){return new kl(t,e,n)}static rmsprop(t,e=.9,n=0,r=null,s=!1){return new Al(t,e,n,r,s)}static adam(t=.001,e=.9,n=.999,r=null){return new Sl(t,e,n,r)}static adadelta(t=.001,e=.95,n=null){return new $l(t,e,n)}static adamax(t=.002,e=.9,n=.999,r=null,s=0){return new _l(t,e,n,r,s)}static adagrad(t,e=.1){return new El(t,e)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ol={sgd:Cl.sgd,momentum:Cl.momentum,adadelta:Cl.adadelta,adagrad:Cl.adagrad,rmsprop:Cl.rmsprop,adamax:Cl.adamax,adam:Cl.adam},Il="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:t=>t();
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Ml=/->/g;function Rl(t,e){const n=[];for(let r=0;r<t.length;++r)0!==t[r].length&&-1===t[r].indexOf(e)&&-1!==e||n.push(r);return n}var Dl=Object.freeze({__proto__:null,segOpComputeOptimalWindowSize:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n,r=!1;for(t<=30?(n=t,r=!0):n=R(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=R(t,n+1);return n},computeOutShape:function(t,e,n){const r=[],s=t.length;for(let o=0;o<s;o++)o!==e?r.push(t[o]):r.push(n);return r},collectGatherOpShapeInfo:function(t,e,n,r){const s=e.shape.length,o=t.shape.length;if(0!==r&&(r<-s||r>s))throw new Error(`Expect batchDims in the range of [-${s}, ${s}], but got ${r}`);if(r<0&&(r+=s),r>o)throw new Error(`batchDims (${r}) must be less than rank(x) (\n    ${o}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let n=0;n<r;++n)if(t.shape[n]!==e.shape[n])throw new Error(`x.shape[${n}]: ${t.shape[n]} should be equal to indices.shape[${n}]: ${e.shape[n]}.`);const i=t.shape[n],a=[];let u=1,c=1,l=1;for(let e=0;e<r;++e)a.push(t.shape[e]),u*=t.shape[e];for(let e=r;e<n;e++)a.push(t.shape[e]),c*=t.shape[e];for(let t=r;t<s;t++)a.push(e.shape[t]);for(let e=n+1;e<o;e++)a.push(t.shape[e]),l*=t.shape[e];return{batchSize:u,sliceSize:l,outerSize:c,dimSize:i,outputShape:a}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Fl=Object.freeze({__proto__:null,slice_util:Hs,segment_util:Dl,fromUint8ToStringArray:function(t){try{return t.map((t=>me(t)))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}},fromStringArrayToUint8:function(t){return t.map((t=>de(t)))},upcastType:Fe,axesAreInnerMostDims:Ei,combineLocations:Si,computeOutAndReduceShapes:function(t,e){const n=[],r=t.length;for(let s=0;s<r;s++)-1===e.indexOf(s)&&n.push(t[s]);return[n,e.map((e=>t[e]))]},expandShapeToKeepDim:_i,assertAxesAreInnerMostDims:function(t,e,n){h(Ei(e,n),(()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`))},getAxesPermutation:function(t,e){if(Ei(t,e))return null;const n=[];for(let r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach((t=>n.push(t))),n},getUndoAxesPermutation:function(t){return t.map(((t,e)=>[e,t])).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]))},getInnerMostAxes:function(t,e){const n=[];for(let r=e-t;r<e;++r)n.push(r);return n},getBroadcastDims:Ns,getReductionAxes:$s,assertAndGetBroadcastShape:Es,assertParamsConsistent:
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=t[0].length;t.forEach(((t,e)=>{h(t.length===n,(()=>`Error in concat${n}D: rank of tensors[${e}] must be the same as the rank of the rest (${n})`))})),h(e>=0&&e<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));const r=t[0];t.forEach(((t,s)=>{for(let o=0;o<n;o++)h(o===e||t[o]===r[o],(()=>`Error in concat${n}D: Shape of tensors[${s}] (${t}) does not match the shape of the rest (${r}) along the non-concatenated axis ${s}.`))}))},computeOutShape:function(t,e){const n=t[0].slice();for(let r=1;r<t.length;r++)n[e]+=t[r][e];return n}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,computeDilation2DInfo:function(t,e,n,r,s="NHWC",o){return xo(t,[...e,t[3]],n,o,r,null,null,Co(s))},computePool2DInfo:vo,computePool3DInfo:function(t,e,n,r,s,o,i="NDHWC"){const[a,u,c]=So(e);let l,f;if("NDHWC"===i)f="channelsLast",l=[a,u,c,t[4],t[4]];else{if("NCDHW"!==i)throw new Error(`Unknown dataFormat ${i}`);f="channelsFirst",l=[a,u,c,t[1],t[1]]}return No(t,l,n,r,s,!1,f,o)},computeConv2DInfo:xo,computeConv3DInfo:No,computeDefaultPad:$o,tupleValuesAreOne:ko,eitherStridesOrDilationsAreOne:Ao,convertConv2DDataFormat:Co,checkPadOnDimRoundingMode:Oo,getFusedDyActivation:lc,getFusedBiasGradient:fc,applyActivation:hc,shouldFuse:pc,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:function(t){return t<=30?t:R(t,Math.floor(Math.sqrt(t)))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getImageCenter:function(t,e,n){return[n*("number"==typeof t?t:t[0]),e*("number"==typeof t?t:t[1])]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getReshaped:function(t,e,n,r=!0){let s=[];if(r)s=s.concat(e.slice(0)),s.push(t[0]/n),s=s.concat(t.slice(1));else{s=s.concat(t[0]);const n=e.length;for(let r=0;r<n;++r)s=s.concat([t[r+1]/e[r],e[r]]);s=s.concat(t.slice(n+1))}return s},getPermuted:function(t,e,n=!0){const r=[];if(n){r.push(e);for(let n=e+1;n<t;++n)n<=2*e?(r.push(n),r.push(n-(e+1))):r.push(n)}else{const n=[],s=[];for(let r=1;r<t;++r)r>=2*e+1||r%2==1?s.push(r):n.push(r);r.push(...n),r.push(0),r.push(...s)}return r},getReshapedPermuted:function(t,e,n,r=!0){const s=[];r?s.push(t[0]/n):s.push(t[0]*n);for(let n=1;n<t.length;++n)n<=e.length?r?s.push(e[n-1]*t[n]):s.push(t[n]/e[n-1]):s.push(t[n]);return s},getSliceBeginCoords:function(t,e){const n=[0];for(let r=0;r<e;++r)n.push(t[r][0]);return n},getSliceSize:function(t,e,n){const r=t.slice(0,1);for(let s=0;s<n;++s)r.push(t[s+1]-e[s][0]-e[s][1]);return r}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,prepareAndValidate:Is,validateUpdateShape:Rs,validateInput:Ds,calculateShapes:Fs,SELU_SCALEALPHA:1.7580993408473768,SELU_SCALE:1.0507009873554805,ERF_P:.3275911,ERF_A1:.254829592,ERF_A2:-.284496736,ERF_A3:1.421413741,ERF_A4:-1.453152027,ERF_A5:1.061405429,warn:xt,log:function(...t){j().getBool("IS_TEST")||j().getBool("PROD")||console.log(...t)},mergeRealAndImagArrays:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(2*t.length);for(let r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n},splitRealAndImagArrays:function(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}},complexWithEvenIndex:function(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=0;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}},complexWithOddIndex:function(t){const e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=2;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}},getComplexWithIndex:function(t,e){return{real:t[2*e],imag:t[2*e+1]}},assignToTypedArray:function(t,e,n,r){t[2*r]=e,t[2*r+1]=n},exponents:function(t,e){const n=new Float32Array(t/2),r=new Float32Array(t/2);for(let s=0;s<Math.ceil(t/2);s++){const o=(e?2:-2)*Math.PI*(s/t);n[s]=Math.cos(o),r[s]=Math.sin(o)}return{real:n,imag:r}},exponent:function(t,e,n){const r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}},decodeEinsumEquation:function(t,e){const n=((t=t.replace(/\s/g,"")).length-t.replace(Ml,"").length)/"->".length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("->").');const[r,s]=t.split("->");h(-1===r.indexOf("..."),(()=>'The ellipsis notation ("...") is not supported yet.'));const o=r.split(","),i=o.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let t=0;t<s.length;++t){const e=s[t];if(!o.some((t=>-1!==t.indexOf(e))))throw new Error(`Output subscripts contain the label ${e} not present in the input subscripts.`);-1===a.indexOf(e)&&a.push(e)}for(let t=0;t<r.length;++t){const e=r[t];-1===a.indexOf(e)&&","!==e&&a.push(e)}const u=new Array(o.length);for(let t=0;t<i;++t){if(new Set(o[t].split("")).size!==o[t].length)throw new Error(`Found duplicate axes in input component ${o[t]}. Support for duplicate axes in input is not implemented yet.`);u[t]=[];for(let e=0;e<o[t].length;++e)u[t].push(a.indexOf(o[t][e]))}const c=a.length,l=[];for(let t=s.length;t<c;++t)l.push(t);return{allDims:a,summedDims:l,idDims:u}},getEinsumPermutation:function(t,e){let n=new Array(t);n.fill(-1);for(let t=0;t<e.length;++t)n[e[t]]=t;const r=[];for(let e=0;e<t;++e)-1===n[e]&&r.push(e);return n=n.filter((t=>-1!==t)),{permutationIndices:n,expandDims:r}},checkEinsumDimSizes:function(t,e,n){const r=new Array(t);for(let t=0;t<n.length;++t){const s=n[t].shape;for(let n=0;n<e[t].length;++n)void 0===r[e[t][n]]?r[e[t][n]]=s[n]:h(r[e[t][n]]===s[n],(()=>`Expected dimension ${r[e[t][n]]} at axis ${n} of input shaped ${JSON.stringify(s)}, but got dimension ${s[n]}`))}},getEinsumComputePath:function(t,e){const n=t,r=[];let s=0;0===t.length&&n.push(-1),s=t.length+1;for(let t=0;t<s;++t)r.push([]);const o=[];for(let t=0;t<n.length;++t){const s=Rl(e,n[t]);for(const e of s)-1===o.indexOf(e)&&(r[t].push(e),o.push(e))}return{path:n,steps:r}},isIdentityPermutation:function(t){return t.every(((t,e)=>t===e))},prepareSplitSize:function(t,e,n=0){let r=[];if("number"==typeof e)h(t.shape[n]%e==0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(e).fill(t.shape[n]/e);else{h(e.reduce(((t,e)=>(-1===e&&(t+=1),t)),0)<=1,(()=>"There should be only one negative value in split array."));const s=e.indexOf(-1);if(-1!==s){const r=e.reduce(((t,e)=>e>0?t+e:t));e[s]=t.shape[n]-r}h(t.shape[n]===e.reduce(((t,e)=>t+e)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=e}return r}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getSparseFillEmptyRowsIndicesDenseShapeMismatch:function(t){return`Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ${t}`},getSparseFillEmptyRowsNegativeIndexErrorMessage:function(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`},getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:function(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:function(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`},getSparseReshapeNegativeOutputDimErrorMessage:function(t,e){return`size ${t} must be non-negative, not ${e}`},getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:function(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"},getSparseReshapeInputOutputMultipleErrorMessage:function(t,e){return`Input to reshape is a SparseTensor with ${y(t)}\n  dense values, but the requested shape requires a multiple of ${y(e)}. inputShape=${t} outputShape= ${e}`},getSparseReshapeInputOutputMismatchErrorMessage:function(t,e){return`Input to reshape is a tensor with ${y(t)} dense values, but the requested shape has ${y(e)}. inputShape=${t} outputShape=${e}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:function(){return"segment ids must be >= 0"},getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:function(){return"segment ids are not increasing"},getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:function(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`},getSparseSegmentReductionIndicesOutOfRangeErrorMessage:function(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}}),Ll=Object.freeze({__proto__:null,nonMaxSuppressionV3Impl:Ic,nonMaxSuppressionV4Impl:Mc,nonMaxSuppressionV5Impl:Rc,whereImpl:Zu}),Pl=Object.freeze({__proto__:null,AdadeltaOptimizer:$l,AdagradOptimizer:El,AdamOptimizer:Sl,AdamaxOptimizer:_l,MomentumOptimizer:kl,Optimizer:Nl,OptimizerConstructors:Cl,RMSPropOptimizer:Al,SGDOptimizer:Tl,Tensor:ke,TensorBuffer:Se,Variable:Ae,get Rank(){return Ce},sumOutType:function(t){return Fe(t,"int32")},upcastType:Fe,get Reduction(){return Zc},customGrad:sa,grad:function(t){return h(M(t),(()=>"The f passed in grad(f) must be a function")),(e,n)=>{const r=Zn(e,"x","tf.grad","string_or_numeric"),s=null!=n?Zn(n,"dy","tf.grad"):null;return qe.tidy((()=>{const{value:e,grads:n}=qe.gradients((()=>t(r)),[r],s);return null!=s&&p(e.shape,s.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),oa(n),n[0]}))}},grads:function(t){return h(M(t),(()=>"The f passed in grads(f) must be a function")),(e,n)=>{h(Array.isArray(e),(()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"));const r=Qn(e,"args","tf.grads","string_or_numeric"),s=null!=n?Zn(n,"dy","tf.grads"):null;return qe.tidy((()=>{const{value:e,grads:n}=qe.gradients((()=>t(...r)),r,s);return null!=s&&p(e.shape,s.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),oa(n),n}))}},valueAndGrad:function(t){return h(M(t),(()=>"The f passed in valueAndGrad(f) must be a function")),(e,n)=>{h(e instanceof ke,(()=>"The x passed in valueAndGrad(f)(x) must be a tensor")),h(null==n||n instanceof ke,(()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"));const{grads:r,value:s}=qe.gradients((()=>t(e)),[e],n);return oa(r),{grad:r[0],value:s}}},valueAndGrads:function(t){return h(M(t),(()=>"The f passed in valueAndGrads(f) must be a function")),(e,n)=>{h(Array.isArray(e)&&e.every((t=>t instanceof ke)),(()=>"The args passed in valueAndGrads(f)(args) must be array of tensors")),h(null==n||n instanceof ke,(()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"));const r=qe.gradients((()=>t(...e)),e,n);return null!=n&&p(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),oa(r.grads),r}},variableGrads:ra,Environment:W,env:j,get ENV(){return G},nextFrame:function(){return new Promise((t=>Il((()=>t()))))},KernelBackend:a,DataStorage:class{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}},abs:io,acos:ao,acosh:uo,add:no,addN:co,all:lo,any:fo,argMax:ho,argMin:po,asin:mo,asinh:yo,atan:go,atan2:bo,atanh:wo,avgPool:Mo,avgPool3d:Ro,basicLSTMCell:Bo,batchToSpaceND:Vo,batchNorm:zo,batchNorm2d:Wo,batchNorm3d:Uo,batchNorm4d:jo,bincount:Go,broadcastArgs:qo,broadcastTo:Ho,buffer:Wr,cast:Ur,ceil:Ko,clipByValue:Xo,clone:jr,complex:er,concat:Do,concat1d:Jo,concat2d:Yo,concat3d:Zo,concat4d:Qo,conv1d:ei,conv2d:ti,conv2dTranspose:ri,conv3d:si,conv3dTranspose:ii,cos:ai,cosh:ui,cumprod:ci,cumsum:li,denseBincount:fi,depthToSpace:hi,depthwiseConv2d:pi,diag:di,dilation2d:mi,div:so,divNoNan:wi,dot:vi,einsum:xi,elu:Ni,equal:yi,erf:$i,euclideanNorm:Fi,exp:Li,expandDims:Pi,expm1:Bi,eye:zi,fill:Wi,floor:Ui,floorDiv:ro,gather:ji,greater:Gi,greaterEqual:qi,imag:ys,isFinite:Hi,isInf:Ki,isNaN:Xi,leakyRelu:Ji,less:Yi,lessEqual:Zi,linspace:Qi,localResponseNormalization:ta,log:ea,log1p:na,logSigmoid:aa,logSoftmax:ca,logSumExp:la,logicalAnd:fa,logicalNot:ha,logicalOr:pa,logicalXor:da,lowerBound:ya,matMul:us,max:Ti,maxPool:ga,maxPool3d:ba,maxPoolWithArgmax:wa,maximum:va,mean:xa,meshgrid:function(t,e,{indexing:n="xy"}={}){if("xy"!==n&&"ij"!==n)throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(void 0===t)return[];let r=Zn(t,"x","meshgrid",t instanceof ke?t.dtype:"float32");if(void 0===e)return[r];let s=Zn(e,"y","meshgrid",e instanceof ke?e.dtype:"float32");const o=y(r.shape),i=y(s.shape);return"xy"===n?(r=Io(r,[1,-1]),s=Io(s,[-1,1]),[us($a([i,1],r.dtype),r),us(s,$a([1,o],s.dtype))]):(r=Io(r,[-1,1]),s=Io(s,[1,-1]),[us(r,$a([1,i],r.dtype)),us($a([o,1],s.dtype),s)])},min:ki,minimum:Ea,mirrorPad:Sa,mod:_a,moments:Ta,mul:oo,multiRNNCell:ka,multinomial:Aa,neg:gs,notEqual:Ca,oneHot:cs,ones:$a,onesLike:Oa,outerProduct:Ia,pad:Ma,pad1d:Ra,pad2d:Da,pad3d:Fa,pad4d:La,pool:Ba,pow:Ai,prelu:Va,print:Gr,prod:za,rand:Wa,randomGamma:uu,randomNormal:cu,randomUniform:lu,range:fu,real:bs,reciprocal:hu,relu:pu,relu6:du,reshape:Io,reverse:mu,reverse1d:yu,reverse2d:gu,reverse3d:bu,reverse4d:wu,round:vu,rsqrt:xu,scalar:Ci,selu:Nu,separableConv2d:$u,setdiff1dAsync:Eu,sigmoid:Fo,sign:Su,sin:_u,sinh:Tu,slice:Lo,slice1d:ku,slice2d:Au,slice3d:Cu,slice4d:Ou,softmax:Iu,softplus:ia,spaceToBatchND:Pa,fft:Mu,ifft:Ru,irfft:Du,rfft:Lu,split:Fu,sqrt:Oi,square:Ii,squaredDifference:Pu,squeeze:Bu,stack:Vu,step:zu,stridedSlice:Wu,sub:ua,sum:Mi,tan:Uu,tanh:Po,tensor:rr,tensor1d:ju,tensor2d:Gu,tensor3d:_s,tensor4d:function(t,e,n){if(d(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");const r=Xn(t,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return nr(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,tensor5d:function(t,e,n){if(d(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");const r=Xn(t,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return nr(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,tensor6d:function(t,e,n){if(d(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");const r=Xn(t,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return nr(t,e=e||r,r,n)},tile:Vi,topk:qu,truncatedNormal:Hu,unique:Ku,unsortedSegmentSum:Xu,unstack:Ju,upperBound:Yu,variable:function(t,e=!0,n,r){return qe.makeVariable(t,e,n,r)},where:gi,whereAsync:Qu,zeros:Na,zerosLike:bi,op:tr,OP_SCOPE_SUFFIX:"__op",booleanMaskAsync:tc,transpose:ws,norm:Di,movingAverage:ec,scatterND:nc,searchSorted:ma,sparseToDense:rc,gatherND:sc,dropout:oc,enclosingPowerOfTwo:ic,cosineWindow:ac,inTopKAsync:uc,image:gl,linalg:bl,losses:wl,spectral:ml,fused:wc,signal:yl,sparse:vl,string:xl,train:Ol,enableProdMode:function(){j().set("PROD",!0)},enableDebugMode:function(){j().set("DEBUG",!0)},disableDeprecationWarnings:function(){j().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},deprecationWarn:function(t){j().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")},disposeVariables:function(){qe.disposeVariables()},engine:ls,memory:function(){return qe.memory()},profile:function(t){return qe.profile(t)},tidy:fs,dispose:hs,keep:ps,time:function(t){return qe.time(t)},setBackend:function(t){return qe.setBackend(t)},ready:function(){return qe.ready()},getBackend:ds,removeBackend:function(t){qe.removeBackend(t)},findBackend:function(t){return qe.findBackend(t)},findBackendFactory:function(t){return qe.findBackendFactory(t)},registerBackend:function(t,e,n=1){return qe.registerBackend(t,e,n)},backend:ms,setPlatform:function(t,e){j().setPlatform(t,e)},getKernel:Et,getGradient:St,getKernelsForBackend:_t,registerKernel:Tt,registerGradient:function(t){const{kernelName:e}=t;$t.has(e)&&j().getBool("DEBUG")&&xt(`Overriding the gradient for '${e}'`),$t.set(e,t)},unregisterKernel:function(t,e){const n=kt(t,e);if(!Nt.has(n))throw new Error(`The kernel '${t}' for backend '${e}' is not registered`);Nt.delete(n)},unregisterGradient:function(t){if(!$t.has(t))throw new Error(`The gradient '${t}' for backend is not registered`);$t.delete(t)},copyRegisteredKernels:function(t,e){_t(t).forEach((t=>{Tt(Object.assign({},t,{backendName:e}))}))},Abs:"Abs",Acos:"Acos",Acosh:"Acosh",Add:"Add",AddN:"AddN",All:"All",Any:"Any",ArgMax:"ArgMax",ArgMin:"ArgMin",Asin:"Asin",Asinh:"Asinh",Atan:"Atan",Atanh:"Atanh",Atan2:"Atan2",AvgPool:"AvgPool",AvgPoolGrad:"AvgPoolGrad",AvgPool3D:"AvgPool3D",AvgPool3DGrad:"AvgPool3DGrad",BatchMatMul:"BatchMatMul",BatchToSpaceND:"BatchToSpaceND",Bincount:"Bincount",BroadcastTo:"BroadcastTo",BroadcastArgs:"BroadcastArgs",Cast:"Cast",Ceil:"Ceil",ClipByValue:"ClipByValue",Complex:"Complex",ComplexAbs:"ComplexAbs",Concat:"Concat",Conv2D:"Conv2D",Conv2DBackpropFilter:"Conv2DBackpropFilter",Conv2DBackpropInput:"Conv2DBackpropInput",Conv3D:"Conv3D",Conv3DBackpropFilterV2:"Conv3DBackpropFilterV2",Conv3DBackpropInputV2:"Conv3DBackpropInputV2",Cos:"Cos",Cosh:"Cosh",Cumprod:"Cumprod",Cumsum:"Cumsum",CropAndResize:"CropAndResize",DenseBincount:"DenseBincount",DepthToSpace:"DepthToSpace",DepthwiseConv2dNative:"DepthwiseConv2dNative",DepthwiseConv2dNativeBackpropFilter:"DepthwiseConv2dNativeBackpropFilter",DepthwiseConv2dNativeBackpropInput:"DepthwiseConv2dNativeBackpropInput",Diag:"Diag",Dilation2D:"Dilation2D",Dilation2DBackpropInput:"Dilation2DBackpropInput",Dilation2DBackpropFilter:"Dilation2DBackpropFilter",RealDiv:"RealDiv",Einsum:"Einsum",Elu:"Elu",EluGrad:"EluGrad",Erf:"Erf",Equal:"Equal",Exp:"Exp",ExpandDims:"ExpandDims",Expm1:"Expm1",FFT:"FFT",Fill:"Fill",FlipLeftRight:"FlipLeftRight",Floor:"Floor",FloorDiv:"FloorDiv",FusedBatchNorm:"FusedBatchNorm",GatherV2:"GatherV2",GatherNd:"GatherNd",Greater:"Greater",GreaterEqual:"GreaterEqual",Identity:"Identity",IFFT:"IFFT",Imag:"Imag",IsFinite:"IsFinite",IsInf:"IsInf",IsNan:"IsNan",LeakyRelu:"LeakyRelu",Less:"Less",LessEqual:"LessEqual",LinSpace:"LinSpace",Log:"Log",Log1p:"Log1p",LogicalAnd:"LogicalAnd",LogicalNot:"LogicalNot",LogicalOr:"LogicalOr",LogSoftmax:"LogSoftmax",LowerBound:"LowerBound",LRN:"LRN",LRNGrad:"LRNGrad",Max:"Max",Maximum:"Maximum",MaxPool:"MaxPool",MaxPoolGrad:"MaxPoolGrad",MaxPool3D:"MaxPool3D",MaxPool3DGrad:"MaxPool3DGrad",MaxPoolWithArgmax:"MaxPoolWithArgmax",Mean:"Mean",Min:"Min",Minimum:"Minimum",MirrorPad:"MirrorPad",Mod:"Mod",Multinomial:"Multinomial",Multiply:"Multiply",Neg:"Neg",NotEqual:"NotEqual",NonMaxSuppressionV3:"NonMaxSuppressionV3",NonMaxSuppressionV4:"NonMaxSuppressionV4",NonMaxSuppressionV5:"NonMaxSuppressionV5",OnesLike:"OnesLike",OneHot:"OneHot",Pack:"Pack",PadV2:"PadV2",Pool:"Pool",Pow:"Pow",Prelu:"Prelu",Prod:"Prod",Range:"Range",Real:"Real",Reciprocal:"Reciprocal",Relu:"Relu",Reshape:"Reshape",ResizeNearestNeighbor:"ResizeNearestNeighbor",ResizeNearestNeighborGrad:"ResizeNearestNeighborGrad",ResizeBilinear:"ResizeBilinear",ResizeBilinearGrad:"ResizeBilinearGrad",Relu6:"Relu6",Reverse:"Reverse",Round:"Round",Rsqrt:"Rsqrt",ScatterNd:"ScatterNd",SearchSorted:"SearchSorted",Select:"Select",Selu:"Selu",Slice:"Slice",Sin:"Sin",Sinh:"Sinh",Sign:"Sign",Sigmoid:"Sigmoid",Softplus:"Softplus",Sqrt:"Sqrt",Sum:"Sum",SpaceToBatchND:"SpaceToBatchND",SplitV:"SplitV",Softmax:"Softmax",SparseFillEmptyRows:"SparseFillEmptyRows",SparseReshape:"SparseReshape",SparseSegmentMean:"SparseSegmentMean",SparseSegmentSum:"SparseSegmentSum",SparseToDense:"SparseToDense",SquaredDifference:"SquaredDifference",Square:"Square",StridedSlice:"StridedSlice",StringNGrams:"StringNGrams",StringSplit:"StringSplit",StringToHashBucketFast:"StringToHashBucketFast",Sub:"Sub",Tan:"Tan",Tanh:"Tanh",Tile:"Tile",TopK:"TopK",Transform:"Transform",Transpose:"Transpose",Unique:"Unique",Unpack:"Unpack",UnsortedSegmentSum:"UnsortedSegmentSum",UpperBound:"UpperBound",ZerosLike:"ZerosLike",Step:"Step",FromPixels:"FromPixels",RotateWithOffset:"RotateWithOffset",_FusedMatMul:"_FusedMatMul",FusedConv2D:"FusedConv2D",FusedDepthwiseConv2D:"FusedDepthwiseConv2D",version_core:"3.18.0",browser:Os,io:as,math:xs,serialization:Ys,test_util:eo,util:ye,backend_util:Fl,broadcast_util:Ss,tensor_util:ze,slice_util:Hs,gather_util:Ms,scatter_util:Ls,device_util:Je,kernel_impls:Ll});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
var Bl,Vl;j().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"}(Bl||(Bl={})),function(t){var e;(e=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(Vl||(Vl={}));
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const zl={};function Wl(t){return zl[t]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ul(t,e,n,r,s){const o=e.inputParams[t];if(o&&void 0!==o.inputIndexStart){const t=o.inputIndexStart,i=0===o.inputIndexEnd?void 0:void 0===o.inputIndexEnd?t+1:o.inputIndexEnd;if("tensor"===o.type)return jl(e.inputNames[o.inputIndexStart],n,r,s);if("tensors"===o.type){return e.inputNames.slice(t,i).map((t=>jl(t,n,r,s)))}const a=jl(e.inputNames.slice(t)[0],n,r,s),u=a.dataSync();return"number"===o.type?u[0]:L(a.shape,u)}const i=e.attrParams[t];return i&&i.value}function jl(t,e,n,r){const[s,o]=Hl(t);if(null!=r){const t=r.getHashTableHandleByName(s);if(null!=t)return t}const i=n.currentContextIds.find((t=>!!e[ql(s,t)]));return void 0!==i?e[ql(s,i)][o]:void 0}function Gl(t,e){const[n,r,s]=Hl(t);return[ql(n,e&&e.currentContextId),r,s]}function ql(t,e){return e?`${t}-${e}`:t}function Hl(t){const e=t.split(":");if(1===e.length)return[t,0,void 0];const n=e[0],r=3===e.length?e[1]:void 0;return[n,Number(e[e.length-1]),r]}function Kl(t,e,n){let r=Ul("pad",t,e,n);if("explicit"===r){r=Ul("explicitPaddings",t,e,n);const s=[[0,0],[0,0],[0,0],[0,0]];for(let t=0;t<4;t++)s[t][0]=r[2*t],s[t][1]=r[2*t+1];return s}return r}function Xl(t){return t.kept?t:jr(t)}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Jl=Object.freeze({__proto__:null,json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Yl=Object.freeze({__proto__:null,json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Zl=Object.freeze({__proto__:null,json:[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Ql=Object.freeze({__proto__:null,json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var tf=Object.freeze({__proto__:null,json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ef=Object.freeze({__proto__:null,json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var nf=Object.freeze({__proto__:null,json:[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var rf=Object.freeze({__proto__:null,json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var sf=Object.freeze({__proto__:null,json:[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var of=Object.freeze({__proto__:null,json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var af=Object.freeze({__proto__:null,json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var uf=Object.freeze({__proto__:null,json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var cf=Object.freeze({__proto__:null,json:[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var lf=Object.freeze({__proto__:null,json:[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ff=Object.freeze({__proto__:null,json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var hf=Object.freeze({__proto__:null,json:[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var pf=Object.freeze({__proto__:null,json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var df=Object.freeze({__proto__:null,json:[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var mf=Object.freeze({__proto__:null,json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}]});class yf{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const t=[].concat(...[Jl,Yl,Zl,Ql,tf,ef,nf,rf,sf,of,af,uf,cf,lf,ff,hf,pf,df,mf].map((t=>t.json)));this.opMappers=t.reduce(((t,e)=>(t[e.tfOpName]=e,t)),{})}transformGraph(t,e={}){const n=t.node,r=[],s=[],o=[],i=n.reduce(((t,e)=>(t[e.name]=this.mapNode(e),e.op.startsWith("Placeholder")?r.push(t[e.name]):"Const"===e.op?s.push(t[e.name]):null!=e.input&&0!==e.input.length||o.push(t[e.name]),t)),{});let a=[];const u=[];let c={},l={};null!=e&&(c=this.mapSignatureEntries(e.inputs),l=this.mapSignatureEntries(e.outputs));const f=Object.keys(i);f.forEach((t=>{const e=i[t];e.inputNames.forEach(((t,n)=>{const[r,,s]=Gl(t),o=i[r];if(null!=o.outputs){const t=o.outputs.indexOf(s);if(-1!==t){const s=`${r}:${t}`;e.inputNames[n]=s}}e.inputs.push(o),o.children.push(e)}))})),0===Object.keys(l).length?f.forEach((t=>{const e=i[t];0===e.children.length&&u.push(e)})):Object.keys(l).forEach((t=>{const[e]=Gl(t),n=i[e];null!=n&&(n.signatureKey=l[t],u.push(n))})),Object.keys(c).length>0?Object.keys(c).forEach((t=>{const[e]=Gl(t),n=i[e];n&&(n.signatureKey=c[t],a.push(n))})):a=r;let h={};null!=t.library&&null!=t.library.function&&(h=t.library.function.reduce(((t,e)=>(t[e.signature.name]=this.mapFunction(e),t)),{}));const p={nodes:i,inputs:a,outputs:u,weights:s,placeholders:r,signature:e,functions:h};return o.length>0&&(p.initNodes=o),p}mapSignatureEntries(t){return Object.keys(t||{}).reduce(((e,n)=>(e[t[n].name]=n,e)),{})}mapNode(t){const e=Wl(t.op)||this.opMappers[t.op]||{};null==t.attr&&(t.attr={});const n={name:t.name,op:t.op,category:e.category,inputNames:(t.input||[]).map((t=>t.startsWith("^")?t.slice(1):t)),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr,outputs:e.outputs};return null!=e.inputs&&(n.inputParams=e.inputs.reduce(((t,e)=>(t[e.name]={type:e.type,inputIndexStart:e.start,inputIndexEnd:e.end},t)),{})),null!=e.attrs&&(n.attrParams=e.attrs.reduce(((e,n)=>{const r=n.type;let s;switch(n.type){case"string":s=bf(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=bf(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":s=kf(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=kf(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":s=vf(t.attr,n.tfName,n.defaultValue||0),void 0===s&&n.tfDeprecatedName&&(s=vf(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":s=Tf(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Tf(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":s=wf(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=wf(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":s=Cf(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Cf(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":s=_f(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=_f(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":s=Af(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Af(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":s=$f(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=$f(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":s=Ef(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Ef(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":s=Nf(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Nf(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${n.type} for op: ${t.op}`)}return e[n.name]={value:s,type:r},e}),{})),n}mapFunction(t){const e=t.nodeDef,n=[];let r={};null!=e&&(r=e.reduce(((t,e)=>(t[e.name]=this.mapNode(e),"Const"===e.op&&n.push(t[e.name]),t)),{}));const s=[],o=[];t.signature.inputArg.forEach((t=>{const[e]=Gl(t.name),n={name:e,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:xf(t.type),type:"dtype"}},children:[]};n.signatureKey=t.name,s.push(n),r[e]=n}));Object.keys(r).forEach((t=>{const e=r[t];e.inputNames.forEach(((t,n)=>{const[s,,o]=Gl(t),i=r[s];if(null!=i.outputs){const t=i.outputs.indexOf(o);if(-1!==t){const r=`${s}:${t}`;e.inputNames[n]=r}}e.inputs.push(i),i.children.push(e)}))}));const i=t.ret;t.signature.outputArg.forEach((t=>{const[e,n]=Gl(i[t.name]),s=r[e];null!=s&&(s.defaultOutput=n,o.push(s))}));const a=this.mapArgsToSignature(t);return{nodes:r,inputs:s,outputs:o,weights:n,placeholders:[],signature:a}}mapArgsToSignature(t){return{methodName:t.signature.name,inputs:t.signature.inputArg.reduce(((t,e)=>(t[e.name]=this.mapArgToTensorInfo(e),t)),{}),outputs:t.signature.outputArg.reduce(((e,n)=>(e[n.name]=this.mapArgToTensorInfo(n,t.ret),e)),{})}}mapArgToTensorInfo(t,e){let n=t.name;return null!=e&&(n=e[n]),{name:n,dtype:t.type}}}function gf(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):function(t){const e=j().global;return void 0!==e.atob?e.atob(t):new hn(t,"base64").toString()}(t);return e?n:n.toLowerCase()}function bf(t,e,n,r=!1){const s=t[e];return null!=s?gf(s.s,r):n}function wf(t,e,n){const r=t[e];return r?r.b:n}function vf(t,e,n){const r=t[e]||{},s=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof s?s:parseInt(s,10)}function xf(t){switch("string"==typeof t&&(t=Bl[t]),t){case Bl.DT_FLOAT:case Bl.DT_HALF:return"float32";case Bl.DT_INT32:case Bl.DT_INT64:case Bl.DT_INT8:case Bl.DT_UINT8:return"int32";case Bl.DT_BOOL:return"bool";case Bl.DT_DOUBLE:return"float32";case Bl.DT_STRING:return"string";default:return null}}function Nf(t,e,n){const r=t[e];return r&&r.func?r.func.name:n}function $f(t,e,n){const r=t[e];return r&&r.type?xf(r.type):n}function Ef(t,e,n){const r=t[e];return r&&r.list&&r.list.type?r.list.type.map((t=>xf(t))):n}function Sf(t){if(!t.unknownRank)return null!=t.dim?t.dim.map((t=>"number"==typeof t.size?t.size:parseInt(t.size,10))):[]}function _f(t,e,n){const r=t[e];return r&&r.shape?Sf(r.shape):n}function Tf(t,e,n){const r=t[e];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((t=>"number"==typeof t?t:parseInt(t,10))):n}function kf(t,e,n,r=!1){const s=t[e];return s&&s.list&&s.list.s?s.list.s.map((t=>gf(t,r))):n}function Af(t,e,n){const r=t[e];return r&&r.list&&r.list.shape?r.list.shape.map((t=>Sf(t))):n}function Cf(t,e,n){const r=t[e];return r&&r.list&&r.list.b?r.list.b:n}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Of{constructor(t,e,n){this.node=t,this.tensorMap=e,this.context=n,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((t=>this.getInput(t))),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce(((t,e)=>(t[e]=this.getAttr(e),t)),{}))}getInput(t){return jl(t,this.tensorMap,this.context)}getAttr(t,e){const n=this.node.rawAttrs[t];if(null!=n.tensor)return jl(t,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return vf(this.node.rawAttrs,t,e);if(null!=n.s)return bf(this.node.rawAttrs,t,e);if(null!=n.b)return wf(this.node.rawAttrs,t,e);if(null!=n.shape)return _f(this.node.rawAttrs,t,e);if(null!=n.type)return $f(this.node.rawAttrs,t,e);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return Tf(this.node.rawAttrs,t,e);if(null!=n.list.s)return kf(this.node.rawAttrs,t,e);if(null!=n.list.shape)return Af(this.node.rawAttrs,t,e);if(null!=n.list.b)return Cf(this.node.rawAttrs,t,e);if(null!=n.list.type)return Ef(this.node.rawAttrs,t,e)}return e}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function If(t,e,n=""){if("number"!=typeof t&&"number"!=typeof e){h(t.length===e.length,(()=>n+` Shapes ${t} and ${e} must match`));for(let r=0;r<t.length;r++){const s=t[r],o=e[r];h(s<0||o<0||s===o,(()=>n+` Shapes ${t} and ${e} must match`))}}}function Mf(t){return"number"!=typeof t&&!t.some((t=>t<0))}function Rf(t,e,n){let r=Df(t,n);const s=!Mf(r);if(s&&0===e.length)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(s&&e.forEach((t=>{r=Df(t.shape,r)})),!Mf(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function Df(t,e){if("number"==typeof t)return e;if("number"==typeof e)return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let r=0;r<t.length;++r){const s=t[r],o=e[r];if(s>=0&&o>=0&&s!==o)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[r]=s>=0?s:o}return n}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ff{constructor(t,e,n,r,s,o,i){this.name=t,this.dtype=e,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=s,this.dynamicSize=o,this.clearAfterRead=i,this.tensors=[],this.closed_=!1,this.idTensor=Ci(0),ps(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.tensor.id)||e.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||t>=this.size())throw new Error(`Tried to read from index ${t}, but array size is: ${this.size()}`);const e=this.tensors[t];if(e.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${t} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor}readMany(t){return t.map((t=>this.read(t)))}write(t,e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error(`Tried to write to index ${t}, but array is not resizeable and size is: ${this.maxSize}`);const n=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t},\n          because the value dtype is ${e.dtype}, but TensorArray dtype is ${this.dtype}.`);if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=e.shape),If(this.elementShape,e.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${t}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been written.`);n.tensor=e,ps(e),n.written=!0,this.tensors[t]=n}writeMany(t,e){if(t.length!==e.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${t.length} is not the same as tensors size: ${e.length}.`);t.forEach(((t,n)=>this.write(t,e[n])))}gather(t,e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${e}`);if(t)t=t.slice(0,this.size());else{t=[];for(let e=0;e<this.size();e++)t.push(e)}if(0===t.length)return rr([],[0].concat(this.elementShape));const n=this.readMany(t);return If(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),Vu(n,0)}concat(t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${t}`);if(0===this.size())return rr([],[0].concat(this.elementShape));const e=[];for(let t=0;t<this.size();t++)e.push(t);const n=this.readMany(e);return If(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),Do(n,0)}scatter(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);const n=Math.max(...t);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(t,Ju(e,0))}split(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);let n=0;const r=t.map((t=>(n+=t,n)));if(n!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${n}, and tensor's shape is: ${e.shape}`);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${t.length}), and the TensorArray is not marked as dynamically resizeable`);const s=0===n?0:e.size/n,o=[];fs((()=>{e=Io(e,[1,n,s]);for(let n=0;n<t.length;++n){const i=[0,0===n?0:r[n-1],0],a=[1,t[n],s];o[n]=Io(Lo(e,i,a),this.elementShape)}return o}));const i=[];for(let e=0;e<t.length;e++)i[e]=e;this.writeMany(i,o)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lf{constructor(t,e,n,r=-1){this.tensors=t,this.elementShape=e,this.elementDtype=n,null!=t&&t.forEach((t=>{if(n!==t.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${t.dtype}`);If(e,t.shape,"TensorList shape mismatch: "),ps(t)})),this.idTensor=Ci(0),this.maxNumElements=r,ps(this.idTensor)}get id(){return this.idTensor.id}copy(){return new Lf([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.id)||e.dispose()})),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,e,n=-1){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(-1!==n&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);If(t,this.elementShape,"TensorList shape mismatch: ");const r=Rf(this.elementShape,this.tensors,t);return fs((()=>{const t=this.tensors.map((t=>Io(t,r)));return Vu(t,0)}))}popBack(t,e){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=Rf(this.elementShape,this.tensors,t),r=this.tensors.pop();return If(r.shape,t,"TensorList shape mismatch: "),Io(r,n)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(If(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");ps(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);const e=new Lf([],this.elementShape,this.elementDtype,this.maxNumElements);e.tensors.length=t;for(let n=0;n<Math.min(this.tensors.length,t);++n)e.tensors[n]=this.tensors[n];return e}getItem(t,e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(null==this.tensors[t])throw new Error(`element at index ${t} is null.`);If(this.tensors[t].shape,e,"TensorList shape mismatch: ");const r=Rf(this.elementShape,this.tensors,e);return Io(this.tensors[t],r)}setItem(t,e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(t<0||-1!==this.maxNumElements&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);If(this.elementShape,e.shape,"TensorList shape mismatch: "),ps(e),this.tensors[t]=e}gather(t,e,n){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);If(this.elementShape,n,"TensorList shape mismatch: "),t=t.slice(0,this.size());const r=Rf(this.elementShape,this.tensors,n);return 0===t.length?rr([],[0].concat(r)):fs((()=>{const e=t.map((t=>Io(this.tensors[t],r)));return Vu(e,0)}))}concat(t,e){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);If(this.elementShape,e,"TensorList shape mismatch: ");const n=Rf(this.elementShape,this.tensors,e);return 0===this.size()?rr([],[0].concat(n)):fs((()=>{const t=this.tensors.map((t=>Io(t,n)));return Do(t,0)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Pf=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const r=Ul("thenBranch",t,e,n),s=Ul("elseBranch",t,e,n),o=Ul("cond",t,e,n),i=Ul("args",t,e,n);return(await o.data())[0]?n.functionMap[r].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap):n.functionMap[s].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=Ul("body",t,e,n),s=Ul("cond",t,e,n),o=Ul("args",t,e,n),i=await n.functionMap[s].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap),a=o.map((t=>t.id));let u=await i[0].data();i.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||t.dispose()}));let c=o;for(;u[0];){const t=c;c=await n.functionMap[r].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);const e=c.map((t=>t.id));t.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}));const o=await n.functionMap[s].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);u=await o[0].data(),o.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}))}return c}case"LoopCond":return[Xl(Ul("pred",t,e,n))];case"Switch":{const r=Ul("pred",t,e,n);let s=Ul("data",t,e,n);return s.kept||(s=Xl(s)),(await r.data())[0]?[void 0,s]:[s,void 0]}case"Merge":{const r=t.inputNames.find((t=>void 0!==jl(t,e,n)));if(r){return[Xl(jl(r,e,n))]}return}case"Enter":{const r=Ul("frameName",t,e,n),s=Ul("tensor",t,e,n);return n.enterFrame(r),[Xl(s)]}case"Exit":{const r=Ul("tensor",t,e,n);return n.exitFrame(),[Xl(r)]}case"NextIteration":{const r=Ul("tensor",t,e,n);return n.nextIteration(),[Xl(r)]}case"TensorArrayV3":{const r=Ul("size",t,e,n),s=Ul("dtype",t,e,n),o=Ul("elementShape",t,e,n),i=Ul("dynamicSize",t,e,n),a=Ul("clearAfterRead",t,e,n),u=Ul("identicalElementShapes",t,e,n),c=Ul("name",t,e,n),l=new Ff(c,s,r,o,u,i,a);return n.addTensorArray(l),[l.idTensor,Ci(1)]}case"TensorArrayWriteV3":{const r=Ul("tensorArrayId",t,e,n),s=Ul("index",t,e,n),o=Ul("tensor",t,e,n),i=n.getTensorArray(r.id);return i.write(s,o),[i.idTensor]}case"TensorArrayReadV3":{const r=Ul("tensorArrayId",t,e,n),s=Ul("index",t,e,n);return[n.getTensorArray(r.id).read(s)]}case"TensorArrayGatherV3":{const r=Ul("tensorArrayId",t,e,n),s=Ul("indices",t,e,n),o=Ul("dtype",t,e,n);return[n.getTensorArray(r.id).gather(s,o)]}case"TensorArrayScatterV3":{const r=Ul("tensorArrayId",t,e,n),s=Ul("indices",t,e,n),o=Ul("tensor",t,e,n),i=n.getTensorArray(r.id);return i.scatter(s,o),[i.idTensor]}case"TensorArrayConcatV3":{const r=Ul("tensorArrayId",t,e,n),s=n.getTensorArray(r.id),o=Ul("dtype",t,e,n);return[s.concat(o)]}case"TensorArraySplitV3":{const r=Ul("tensorArrayId",t,e,n),s=Ul("tensor",t,e,n),o=Ul("lengths",t,e,n),i=n.getTensorArray(r.id);return i.split(o,s),[i.idTensor]}case"TensorArraySizeV3":{const r=Ul("tensorArrayId",t,e,n);return[Ci(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{const r=Ul("tensorArrayId",t,e,n),s=n.getTensorArray(r.id);return s.clearAndClose(),[s.idTensor]}case"TensorListSetItem":{const r=Ul("tensorListId",t,e,n),s=Ul("index",t,e,n),o=Ul("tensor",t,e,n),i=n.getTensorList(r.id);return i.setItem(s,o),[i.idTensor]}case"TensorListGetItem":{const r=Ul("tensorListId",t,e,n),s=Ul("index",t,e,n),o=Ul("elementShape",t,e,n),i=Ul("elementDType",t,e,n);return[n.getTensorList(r.id).getItem(s,o,i)]}case"TensorListScatterV2":case"TensorListScatter":{const r=Ul("indices",t,e,n),s=function(t,e,n,r){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const s=Math.max(...e);if(null!=r&&-1!==r&&s>=r)throw new Error(`Max index must be < array size (${s}  vs. ${r})`);const o=new Lf([],n,t.dtype,r),i=Ju(t,0);return e.forEach(((t,e)=>{o.setItem(t,i[e])})),o}(Ul("tensor",t,e,n),r,Ul("elementShape",t,e,n),Ul("numElements",t,e,n));return n.addTensorList(s),[s.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=Ul("elementShape",t,e,n),s=Ul("elementDType",t,e,n);let o;o="TensorListReserve"===t.op?"numElements":"maxNumElements";const i=function(t,e,n){return new Lf([],t,e,n)}(r,s,Ul(o,t,e,n));return n.addTensorList(i),[i.idTensor]}case"TensorListGather":{const r=Ul("tensorListId",t,e,n),s=Ul("indices",t,e,n),o=Ul("elementShape",t,e,n),i=Ul("elementDType",t,e,n);return[n.getTensorList(r.id).gather(s,i,o)]}case"TensorListStack":{const r=Ul("tensorListId",t,e,n),s=Ul("elementShape",t,e,n),o=Ul("elementDType",t,e,n),i=Ul("numElements",t,e,n);return[n.getTensorList(r.id).stack(s,o,i)]}case"TensorListFromTensor":{const r=function(t,e,n){const r=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);If(t.shape.slice(1),e,"TensorList shape mismatch: ");const s=Ju(t);return new Lf(s,e,r)}(Ul("tensor",t,e,n),Ul("elementShape",t,e,n),Ul("elementDType",t,e,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const r=Ul("tensorListId",t,e,n),s=n.getTensorList(r.id),o=Ul("dtype",t,e,n),i=Ul("elementShape",t,e,n);return[s.concat(o,i)]}case"TensorListPushBack":{const r=Ul("tensorListId",t,e,n),s=Ul("tensor",t,e,n),o=n.getTensorList(r.id);return o.pushBack(s),[o.idTensor]}case"TensorListPopBack":{const r=Ul("tensorListId",t,e,n),s=Ul("elementShape",t,e,n),o=Ul("elementDType",t,e,n);return[n.getTensorList(r.id).popBack(s,o)]}case"TensorListSplit":{const r=Ul("tensor",t,e,n),s=Ul("elementShape",t,e,n),o=function(t,e,n){let r=0;const s=e.map((t=>(r+=t,r)));if(r!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${r}, and tensor's shape is: ${t.shape}`);const o=Df(t.shape.slice(1),n),i=0===r?0:t.size/r,a=fs((()=>{const n=[];t=Io(t,[1,r,i]);for(let r=0;r<e.length;++r){const a=[0,0===r?0:s[r-1],0],u=[1,e[r],i];n[r]=Io(Lo(t,a,u),o)}return t.dispose(),n})),u=new Lf([],n,t.dtype,e.length);for(let t=0;t<a.length;t++)u.setItem(t,a[t]);return u}(r,Ul("lengths",t,e,n),s);return n.addTensorList(o),[o.idTensor]}case"TensorListLength":{const r=Ul("tensorListId",t,e,n);return[Ci(n.getTensorList(r.id).size(),"int32")]}case"TensorListResize":{const r=Ul("tensorListId",t,e,n),s=Ul("size",t,e,n),o=n.getTensorList(r.id).resize(s);return n.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bf(t,e,n){const[r,s]=Ul("fusedOps",t,e,n),o="biasadd"===r,i=!o,a="prelu"===s,u="fusedbatchnorm"===r,c=Ul("numArgs",t,e,n);if(o){if(a&&2!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&o&&1!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(u)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const l=Ul("strides",t,e,n),f=Kl(t,e,n),h=Ul("dataFormat",t,e,n).toUpperCase(),p=Ul("dilations",t,e,n);let[d,m]=Ul("args",t,e,n);i&&(m=d,d=void 0);return{stride:l,pad:f,dataFormat:h,dilations:p,biasArg:d,preluArg:m,activationFunc:s,leakyreluAlpha:Ul("leakyreluAlpha",t,e,n)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Vf(t,e,n){return{boxes:Ul("boxes",t,e,n),scores:Ul("scores",t,e,n),maxOutputSize:Ul("maxOutputSize",t,e,n),iouThreshold:Ul("iouThreshold",t,e,n),scoreThreshold:Ul("scoreThreshold",t,e,n),softNmsSigma:Ul("softNmsSigma",t,e,n)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class zf{constructor(t,e){this.keyDType=t,this.valueDType=e,this.handle=Ci(0),this.tensorMap=new Map,ps(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Ci(this.size(),"int32")}async import(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),fs((()=>{const t=Ju(e),r=n.length,s=t.length;h(r===s,(()=>`The number of elements doesn't match, keys has ${r} elements, the values has ${s} elements.`));for(let e=0;e<r;e++){const r=n[e],s=t[e];ps(s),this.tensorMap.set(r,s)}return this.handle}))}async find(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return fs((()=>{const t=[];for(let r=0;r<n.length;r++){const s=n[r],o=this.findWithDefault(s,e);t.push(o)}return Vu(t)}))}findWithDefault(t,e){const n=this.tensorMap.get(t);return null!=n?n:e}checkKeyAndValueTensor(t,e){if(t.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${t.dtype}`);if(e.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${e.dtype}`)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Wf(t,e,n,r){const s=((t,e,n)=>{switch(t.category){case"arithmetic":return fs((()=>((t,e,n)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[no(Ul("a",t,e,n),Ul("b",t,e,n))];case"AddN":return[co(Ul("tensors",t,e,n))];case"FloorMod":case"Mod":return[_a(Ul("a",t,e,n),Ul("b",t,e,n))];case"Mul":return[oo(Ul("a",t,e,n),Ul("b",t,e,n))];case"RealDiv":case"Div":return[so(Ul("a",t,e,n),Ul("b",t,e,n))];case"DivNoNan":return[wi(Ul("a",t,e,n),Ul("b",t,e,n))];case"FloorDiv":return[ro(Ul("a",t,e,n),Ul("b",t,e,n))];case"Sub":return[ua(Ul("a",t,e,n),Ul("b",t,e,n))];case"Minimum":return[Ea(Ul("a",t,e,n),Ul("b",t,e,n))];case"Maximum":return[va(Ul("a",t,e,n),Ul("b",t,e,n))];case"Pow":return[Ai(Ul("a",t,e,n),Ul("b",t,e,n))];case"SquaredDifference":return[Pu(Ul("a",t,e,n),Ul("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"basic_math":return fs((()=>((t,e,n)=>{switch(t.op){case"Abs":case"ComplexAbs":return[io(Ul("x",t,e,n))];case"Acos":return[ao(Ul("x",t,e,n))];case"Acosh":return[uo(Ul("x",t,e,n))];case"Asin":return[mo(Ul("x",t,e,n))];case"Asinh":return[yo(Ul("x",t,e,n))];case"Atan":return[go(Ul("x",t,e,n))];case"Atan2":return[bo(Ul("x",t,e,n),Ul("y",t,e,n))];case"Atanh":return[wo(Ul("x",t,e,n))];case"Ceil":return[Ko(Ul("x",t,e,n))];case"Complex":return[er(Ul("real",t,e,n),Ul("imag",t,e,n))];case"Cos":return[ai(Ul("x",t,e,n))];case"Cosh":return[ui(Ul("x",t,e,n))];case"Elu":return[Ni(Ul("x",t,e,n))];case"Erf":return[$i(Ul("x",t,e,n))];case"Exp":return[Li(Ul("x",t,e,n))];case"Expm1":return[Bi(Ul("x",t,e,n))];case"Floor":return[Ui(Ul("x",t,e,n))];case"Log":return[ea(Ul("x",t,e,n))];case"Log1p":return[na(Ul("x",t,e,n))];case"Imag":return[ys(Ul("x",t,e,n))];case"Neg":return[gs(Ul("x",t,e,n))];case"Reciprocal":return[hu(Ul("x",t,e,n))];case"Real":return[bs(Ul("x",t,e,n))];case"Relu":return[pu(Ul("x",t,e,n))];case"Round":return[vu(Ul("x",t,e,n))];case"Selu":return[Nu(Ul("x",t,e,n))];case"Sigmoid":return[Fo(Ul("x",t,e,n))];case"Sin":return[_u(Ul("x",t,e,n))];case"Sign":return[Su(Ul("x",t,e,n))];case"Sinh":return[Tu(Ul("x",t,e,n))];case"Softplus":return[ia(Ul("x",t,e,n))];case"Sqrt":return[Oi(Ul("x",t,e,n))];case"Square":return[Ii(Ul("x",t,e,n))];case"Tanh":return[Po(Ul("x",t,e,n))];case"Tan":return[Uu(Ul("x",t,e,n))];case"ClipByValue":return[Xo(Ul("x",t,e,n),Ul("clipValueMin",t,e,n),Ul("clipValueMax",t,e,n))];case"Relu6":return[du(Ul("x",t,e,n))];case"Rsqrt":return[xu(jl(t.inputNames[0],e,n))];case"Prod":return[za(Ul("x",t,e,n),Ul("axes",t,e,n))];case"LeakyRelu":return[Ji(Ul("x",t,e,n),Ul("alpha",t,e,n))];case"Prelu":return[Va(Ul("x",t,e,n),Ul("alpha",t,e,n))];case"IsNan":return[Xi(jl(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"control":return Pf(t,e,n);case"convolution":return fs((()=>((t,e,n)=>{switch(t.op){case"Conv1D":{const r=Ul("stride",t,e,n),s=Ul("pad",t,e,n),o=Ul("dataFormat",t,e,n).toUpperCase(),i=Ul("dilation",t,e,n);return[ei(Ul("x",t,e,n),Ul("filter",t,e,n),r,s,o,i)]}case"Conv2D":{const r=Ul("strides",t,e,n),s=Kl(t,e,n),o=Ul("dataFormat",t,e,n).toUpperCase(),i=Ul("dilations",t,e,n);return[ti(Ul("x",t,e,n),Ul("filter",t,e,n),[r[1],r[2]],s,o,[i[1],i[2]])]}case"_FusedConv2D":{const{stride:r,pad:s,dataFormat:o,dilations:i,biasArg:a,preluArg:u,activationFunc:c,leakyreluAlpha:l}=Bf(t,e,n);return[dc({x:Ul("x",t,e,n),filter:Ul("filter",t,e,n),strides:[r[1],r[2]],pad:s,dataFormat:o,dilations:[i[1],i[2]],bias:a,activation:c,preluActivationWeights:u,leakyreluAlpha:l})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:s,dataFormat:o,dilations:i,biasArg:a,preluArg:u,activationFunc:c,leakyreluAlpha:l}=Bf(t,e,n);return[gc({x:Ul("x",t,e,n),filter:Ul("filter",t,e,n),strides:[r[1],r[2]],pad:s,dataFormat:o,dilations:[i[1],i[2]],bias:a,activation:c,preluActivationWeights:u,leakyreluAlpha:l})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=Ul("outputShape",t,e,n),s=Ul("strides",t,e,n),o=Kl(t,e,n);return[ri(Ul("x",t,e,n),Ul("filter",t,e,n),r,[s[1],s[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=Ul("strides",t,e,n),s=Kl(t,e,n),o=Ul("dilations",t,e,n),i=Ul("dataFormat",t,e,n).toUpperCase();return[pi(Ul("input",t,e,n),Ul("filter",t,e,n),[r[1],r[2]],s,i,[o[1],o[2]])]}case"Conv3D":{const r=Ul("strides",t,e,n),s=Ul("pad",t,e,n),o=Ul("dataFormat",t,e,n).toUpperCase(),i=Ul("dilations",t,e,n);return[si(Ul("x",t,e,n),Ul("filter",t,e,n),[r[1],r[2],r[3]],s,o,[i[1],i[2],i[3]])]}case"AvgPool":{const r=Ul("strides",t,e,n),s=Ul("pad",t,e,n),o=Ul("kernelSize",t,e,n);return[Mo(Ul("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s)]}case"MaxPool":{const r=Ul("strides",t,e,n),s=Ul("pad",t,e,n),o=Ul("kernelSize",t,e,n);return[ga(Ul("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s)]}case"MaxPoolWithArgmax":{const r=Ul("strides",t,e,n),s=Ul("pad",t,e,n),o=Ul("kernelSize",t,e,n),i=Ul("includeBatchInIndex",t,e,n),{result:a,indexes:u}=wa(Ul("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s,i);return[a,u]}case"AvgPool3D":{const r=Ul("strides",t,e,n),s=Ul("pad",t,e,n),o=Ul("kernelSize",t,e,n);return[Ro(Ul("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],s)]}case"MaxPool3D":{const r=Ul("strides",t,e,n),s=Ul("pad",t,e,n),o=Ul("kernelSize",t,e,n);return[ba(Ul("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],s)]}case"Dilation2D":{const r=Ul("strides",t,e,n),s=Ul("pad",t,e,n),o=Ul("dilations",t,e,n),i=r[1],a=r[2],u=o[1],c=o[2];return[mi(Ul("x",t,e,n),Ul("filter",t,e,n),[i,a],s,[u,c],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"creation":return fs((()=>((t,e,n)=>{switch(t.op){case"Fill":{const r=Ul("shape",t,e,n),s=Ul("dtype",t,e,n);return[Wi(r,Ul("value",t,e,n),s)]}case"LinSpace":return[Qi(Ul("start",t,e,n),Ul("stop",t,e,n),Ul("num",t,e,n))];case"Multinomial":{const r=Ul("logits",t,e,n),s=Ul("numSamples",t,e,n),o=Ul("seed",t,e,n);return[Aa(r,s,o)]}case"OneHot":{const r=Ul("indices",t,e,n),s=Ul("depth",t,e,n),o=Ul("onValue",t,e,n),i=Ul("offValue",t,e,n);return[cs(r,s,o,i)]}case"Ones":return[$a(Ul("shape",t,e,n),Ul("dtype",t,e,n))];case"OnesLike":return[Oa(Ul("x",t,e,n))];case"RandomUniform":return[lu(Ul("shape",t,e,n),Ul("minval",t,e,n),Ul("maxval",t,e,n),Ul("dtype",t,e,n))];case"Range":return[fu(Ul("start",t,e,n),Ul("stop",t,e,n),Ul("step",t,e,n),Ul("dtype",t,e,n))];case"TruncatedNormal":{const r=Ul("shape",t,e,n),s=Ul("mean",t,e,n),o=Ul("stdDev",t,e,n),i=Ul("seed",t,e,n);return[Hu(r,s,o,Ul("dtype",t,e,n),i)]}case"Zeros":return[Na(Ul("shape",t,e,n),Ul("dtype",t,e,n))];case"ZerosLike":return[bi(Ul("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"dynamic":return(async(t,e,n)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a,softNmsSigma:u}=Vf(t,e,n),c=await gl.nonMaxSuppressionWithScoreAsync(r,s,o,i,a,u);return[c.selectedIndices,c.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a}=Vf(t,e,n),u=Ul("padToMaxOutputSize",t,e,n),c=await gl.nonMaxSuppressionPaddedAsync(r,s,o,i,a,u);return[c.selectedIndices,c.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a}=Vf(t,e,n);return[await gl.nonMaxSuppressionAsync(r,s,o,i,a)]}case"Where":{const r=Ur(Ul("condition",t,e,n),"bool"),s=[await Qu(r)];return r.dispose(),s}case"ListDiff":return Eu(Ul("x",t,e,n),Ul("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n);case"evaluation":return fs((()=>((t,e,n)=>{switch(t.op){case"LowerBound":return[ya(Ul("sortedSequence",t,e,n),Ul("values",t,e,n))];case"TopKV2":{const r=Ul("x",t,e,n),s=Ul("k",t,e,n),o=Ul("sorted",t,e,n),i=qu(r,s,o);return[i.values,i.indices]}case"UpperBound":return[Yu(Ul("sortedSequence",t,e,n),Ul("values",t,e,n))];case"Unique":{const r=Ul("x",t,e,n),s=Ku(r);return[s.values,s.indices]}case"UniqueV2":{const r=Ul("x",t,e,n),s=Ul("axis",t,e,n),o=Ku(r,s);return[o.values,o.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"image":return fs((()=>((t,e,n)=>{switch(t.op){case"ResizeBilinear":{const r=Ul("images",t,e,n),s=Ul("size",t,e,n),o=Ul("alignCorners",t,e,n),i=Ul("halfPixelCenters",t,e,n);return[gl.resizeBilinear(r,[s[0],s[1]],o,i)]}case"ResizeNearestNeighbor":{const r=Ul("images",t,e,n),s=Ul("size",t,e,n),o=Ul("alignCorners",t,e,n),i=Ul("halfPixelCenters",t,e,n);return[gl.resizeNearestNeighbor(r,[s[0],s[1]],o,i)]}case"CropAndResize":{const r=Ul("image",t,e,n),s=Ul("boxes",t,e,n),o=Ul("boxInd",t,e,n),i=Ul("cropSize",t,e,n),a=Ul("method",t,e,n),u=Ul("extrapolationValue",t,e,n);return[gl.cropAndResize(r,s,o,i,a,u)]}case"ImageProjectiveTransformV3":{const r=Ul("images",t,e,n),s=Ul("transforms",t,e,n),o=Ul("outputShape",t,e,n),i=Ul("fillValue",t,e,n),a=Ul("interpolation",t,e,n),u=Ul("fillMode",t,e,n);return[gl.transform(r,s,a.toLowerCase(),u.toLowerCase(),i,o)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"graph":return fs((()=>((t,e,n)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const r=Ul("default",t,e,n);return[jl(t.name,e,n)||r];case"Placeholder":return[jl(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[Xl(Ul("x",t,e,n))];case"IdentityN":return Ul("x",t,e,n).map((t=>Xl(t)));case"Shape":return[ju(Ul("x",t,e,n).shape,"int32")];case"ShapeN":return Ul("x",t,e,n).map((t=>ju(t.shape)));case"Size":return[Ci(Ul("x",t,e,n).size,"int32")];case"Rank":return[Ci(Ul("x",t,e,n).rank,"int32")];case"NoOp":return[Ci(1)];case"Print":const s=Ul("x",t,e,n),o=Ul("data",t,e,n),i=Ul("message",t,e,n),a=Ul("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(i);for(let t=0;t<o.length;t++)console.log(Array.prototype.slice.call(o[t].dataSync()).slice(0,a));return[s];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"logical":return fs((()=>((t,e,n)=>{switch(t.op){case"Equal":return[yi(Ul("a",t,e,n),Ul("b",t,e,n))];case"NotEqual":return[Ca(Ul("a",t,e,n),Ul("b",t,e,n))];case"Greater":return[Gi(Ul("a",t,e,n),Ul("b",t,e,n))];case"GreaterEqual":return[qi(Ul("a",t,e,n),Ul("b",t,e,n))];case"Less":return[Yi(Ul("a",t,e,n),Ul("b",t,e,n))];case"LessEqual":return[Zi(Ul("a",t,e,n),Ul("b",t,e,n))];case"LogicalAnd":return[fa(Ul("a",t,e,n),Ul("b",t,e,n))];case"LogicalNot":return[ha(Ul("a",t,e,n))];case"LogicalOr":return[pa(Ul("a",t,e,n),Ul("b",t,e,n))];case"Select":case"SelectV2":return[gi(Ul("condition",t,e,n),Ul("a",t,e,n),Ul("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"matrices":return fs((()=>((t,e,n)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[us(Ul("a",t,e,n),Ul("b",t,e,n),Ul("transposeA",t,e,n),Ul("transposeB",t,e,n))];case"Einsum":return[xi(Ul("equation",t,e,n),...Ul("tensors",t,e,n))];case"Transpose":return[ws(Ul("x",t,e,n),Ul("perm",t,e,n))];case"_FusedMatMul":const[r,s]=Ul("fusedOps",t,e,n),o="biasadd"===r,i="prelu"===s,a=Ul("numArgs",t,e,n),u=Ul("leakyreluAlpha",t,e,n);if(o){if(i&&2!==a)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!i&&1!==a)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[c,l]=Ul("args",t,e,n);return[bc({a:Ul("a",t,e,n),b:Ul("b",t,e,n),transposeA:Ul("transposeA",t,e,n),transposeB:Ul("transposeB",t,e,n),bias:c,activation:s,preluActivationWeights:l,leakyreluAlpha:u})];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"normalization":return fs((()=>((t,e,n)=>{switch(t.op){case"EuclideanNorm":return[Fi(Ul("x",t,e,n),Ul("axis",t,e,n),Ul("keepDims",t,e,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[zo(Ul("x",t,e,n),Ul("mean",t,e,n),Ul("variance",t,e,n),Ul("offset",t,e,n),Ul("scale",t,e,n),Ul("epsilon",t,e,n))];case"LRN":return[ta(Ul("x",t,e,n),Ul("radius",t,e,n),Ul("bias",t,e,n),Ul("alpha",t,e,n),Ul("beta",t,e,n))];case"Softmax":return[Iu(Ul("x",t,e,n))];case"LogSoftmax":return[ca(Ul("x",t,e,n))];case"SparseToDense":return[rc(Ul("sparseIndices",t,e,n),Ul("outputShape",t,e,n),Ul("sparseValues",t,e,n),Ul("defaultValue",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"reduction":return fs((()=>((t,e,n)=>{switch(t.op){case"Max":{const r=Ul("axis",t,e,n),s=Ul("keepDims",t,e,n);return[Ti(Ul("x",t,e,n),r,s)]}case"Mean":{const r=Ul("axis",t,e,n),s=Ul("keepDims",t,e,n);return[xa(Ul("x",t,e,n),r,s)]}case"Min":{const r=Ul("axis",t,e,n),s=Ul("keepDims",t,e,n);return[ki(Ul("x",t,e,n),r,s)]}case"Sum":{const r=Ul("axis",t,e,n),s=Ul("keepDims",t,e,n);return[Mi(Ul("x",t,e,n),r,s)]}case"All":{const r=Ul("axis",t,e,n),s=Ul("keepDims",t,e,n);return[lo(Ul("x",t,e,n),r,s)]}case"Any":{const r=Ul("axis",t,e,n),s=Ul("keepDims",t,e,n);return[fo(Ul("x",t,e,n),r,s)]}case"ArgMax":{const r=Ul("axis",t,e,n);return[ho(Ul("x",t,e,n),r)]}case"ArgMin":{const r=Ul("axis",t,e,n);return[po(Ul("x",t,e,n),r)]}case"Prod":{const r=Ul("axis",t,e,n),s=Ul("keepDims",t,e,n);return[za(Ul("x",t,e,n),r,s)]}case"Cumprod":{const r=Ul("axis",t,e,n),s=Ul("exclusive",t,e,n),o=Ul("reverse",t,e,n);return[ci(Ul("x",t,e,n),r,s,o)]}case"Cumsum":{const r=Ul("axis",t,e,n),s=Ul("exclusive",t,e,n),o=Ul("reverse",t,e,n);return[li(Ul("x",t,e,n),r,s,o)]}case"Bincount":const r=Ul("x",t,e,n),s=Ul("weights",t,e,n),o=Ul("size",t,e,n);return[Go(r,s,o)];case"DenseBincount":{const r=Ul("x",t,e,n),s=Ul("weights",t,e,n),o=Ul("size",t,e,n),i=Ul("binaryOutput",t,e,n);return[fi(r,s,o,i)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"slice_join":return fs((()=>((t,e,n)=>{switch(t.op){case"ConcatV2":case"Concat":{const r=Ul("n",t,e,n),s=Ul("axis",t,e,n);let o=Ul("tensors",t,e,n);return o=o.slice(0,r),[Do(o,s)]}case"Gather":{const r=Ul("x",t,e,n),s=Ul("indices",t,e,n);return[ji(r,Ur(s,"int32"),0)]}case"GatherV2":{const r=Ul("axis",t,e,n),s=Ul("batchDims",t,e,n),o=Ul("x",t,e,n),i=Ul("indices",t,e,n);return[ji(o,Ur(i,"int32"),r,s)]}case"Reverse":{const r=Ul("dims",t,e,n),s=[];for(let t=0;t<r.length;t++)r[t]&&s.push(t);const o=Ul("x",t,e,n);return[mu(o,s)]}case"ReverseV2":{const r=Ul("axis",t,e,n),s=Ul("x",t,e,n);return[mu(s,r)]}case"Slice":{const r=Ul("begin",t,e,n),s=Ul("size",t,e,n);return[Lo(Ul("x",t,e,n),r,s)]}case"StridedSlice":{const r=Ul("begin",t,e,n),s=Ul("end",t,e,n),o=Ul("strides",t,e,n),i=Ul("beginMask",t,e,n),a=Ul("endMask",t,e,n),u=Ul("ellipsisMask",t,e,n),c=Ul("newAxisMask",t,e,n),l=Ul("shrinkAxisMask",t,e,n),f=Ul("x",t,e,n);return[Wu(f,r,s,o,i,a,u,c,l)]}case"Pack":return fs((()=>{const r=Ul("axis",t,e,n),s=Ul("tensors",t,e,n),o=s[0].shape,i=Bu(s[0]).shape,a=s.map((t=>{const e=g(t.shape,o);if(!e&&!g(Bu(t).shape,i))throw new Error("the input tensors shape does not match");return e?t:Io(t,o)}));return[Vu(a,r)]}));case"Unpack":{const r=Ul("axis",t,e,n),s=Ul("tensor",t,e,n);return Ju(s,r)}case"Tile":{const r=Ul("reps",t,e,n);return[Vi(Ul("x",t,e,n),r)]}case"Split":case"SplitV":{const r=Ul("axis",t,e,n),s=Ul("numOrSizeSplits",t,e,n),o=Ul("x",t,e,n);return Fu(o,s,r)}case"ScatterNd":{const r=Ul("indices",t,e,n),s=Ul("values",t,e,n),o=Ul("shape",t,e,n);return[nc(r,s,o)]}case"GatherNd":{const r=Ul("x",t,e,n),s=Ul("indices",t,e,n);return[sc(r,s)]}case"SparseToDense":{const r=Ul("sparseIndices",t,e,n),s=Ul("outputShape",t,e,n),o=Ul("sparseValues",t,e,n),i=Ul("defaultValue",t,e,n);return[rc(r,o,s,o.dtype===i.dtype?i:Ur(i,o.dtype))]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"sparse":return fs((()=>((t,e,n)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:s,emptyRowIndicator:o,reverseIndexMap:i}=vl.sparseFillEmptyRows(Ul("indices",t,e,n),Ul("values",t,e,n),Ul("denseShape",t,e,n),Ul("defaultValue",t,e,n));return[r,s,o,i]}case"SparseReshape":{const{outputIndices:r,outputShape:s}=vl.sparseReshape(Ul("inputIndices",t,e,n),Ul("inputShape",t,e,n),Ul("newShape",t,e,n));return[r,s]}case"SparseSegmentMean":return[vl.sparseSegmentMean(Ul("data",t,e,n),Ul("indices",t,e,n),Ul("segmentIds",t,e,n))];case"SparseSegmentSum":return[vl.sparseSegmentSum(Ul("data",t,e,n),Ul("indices",t,e,n),Ul("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"spectral":return fs((()=>((t,e,n)=>{switch(t.op){case"FFT":return[Mu(Ul("x",t,e,n))];case"IFFT":return[Ru(Ul("x",t,e,n))];case"RFFT":return[Lu(Ul("x",t,e,n))];case"IRFFT":return[Du(Ul("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"string":return fs((()=>((t,e,n)=>{switch(t.op){case"StringNGrams":{const{nGrams:r,nGramsSplits:s}=xl.stringNGrams(Ul("data",t,e,n),Ul("dataSplits",t,e,n),Ul("separator",t,e,n),Ul("nGramWidths",t,e,n),Ul("leftPad",t,e,n),Ul("rightPad",t,e,n),Ul("padWidth",t,e,n),Ul("preserveShortSequences",t,e,n));return[r,s]}case"StringSplit":{const{indices:r,values:s,shape:o}=xl.stringSplit(Ul("input",t,e,n),Ul("delimiter",t,e,n),Ul("skipEmpty",t,e,n));return[r,s,o]}case"StringToHashBucketFast":return[xl.stringToHashBucketFast(Ul("input",t,e,n),Ul("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"transformation":return fs((()=>((t,e,n)=>{switch(t.op){case"Cast":return[Ur(Ul("x",t,e,n),Ul("dtype",t,e,n))];case"ExpandDims":{const r=Ul("axis",t,e,n);return[Pi(Ul("x",t,e,n),r)]}case"Squeeze":{const r=Ul("axis",t,e,n);return[Bu(Ul("x",t,e,n),r)]}case"Reshape":return[Io(Ul("x",t,e,n),Ul("shape",t,e,n))];case"MirrorPad":return[Sa(Ul("x",t,e,n),Ul("padding",t,e,n),Ul("mode",t,e,n))];case"PadV2":case"Pad":return[Ma(Ul("x",t,e,n),Ul("padding",t,e,n),Ul("constantValue",t,e,n))];case"SpaceToBatchND":{const r=Ul("blockShape",t,e,n),s=Ul("paddings",t,e,n);return[Pa(Ul("x",t,e,n),r,s)]}case"BatchToSpaceND":{const r=Ul("blockShape",t,e,n),s=Ul("crops",t,e,n);return[Vo(Ul("x",t,e,n),r,s)]}case"DepthToSpace":{const r=Ul("blockSize",t,e,n),s=Ul("dataFormat",t,e,n).toUpperCase();return[hi(Ul("x",t,e,n),r,s)]}case"BroadcastTo":return[Ho(Ul("x",t,e,n),Ul("shape",t,e,n))];case"BroadcastArgs":return[qo(Ul("s0",t,e,n),Ul("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"hash_table":return(async(t,e,n,r)=>{switch(t.op){case"HashTable":case"HashTableV2":{const s=Ul("keyDType",t,e,n),o=Ul("valueDType",t,e,n),i=new zf(s,o);return r.addHashTable(t.name,i),[i.handle]}case"LookupTableImport":case"LookupTableImportV2":{const s=Ul("tableHandle",t,e,n,r),o=Ul("keys",t,e,n),i=Ul("values",t,e,n),a=r.getHashTableById(s.id);return[await a.import(o,i)]}case"LookupTableFind":case"LookupTableFindV2":{const s=Ul("tableHandle",t,e,n,r),o=Ul("keys",t,e,n),i=Ul("defaultValue",t,e,n),a=r.getHashTableById(s.id);return[await a.find(o,i)]}case"LookupTableSize":case"LookupTableSizeV2":{const s=Ul("tableHandle",t,e,n,r);return[r.getHashTableById(s.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n,r);case"custom":const s=Wl(t.op);if(s&&s.customExecutor)return s.customExecutor(new Of(t,e,n));throw TypeError(`Custom op ${t.op} is not registered.`);default:throw TypeError(`Unknown op '${t.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return z(s)?s.then((t=>[].concat(t))):[].concat(s)}class Uf{constructor(t={},e={},n={},r={}){this.weightMap=t,this.tensorArrayMap=e,this.tensorListMap=n,this.functionMap=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(t,e){return{id:t,frameName:e,iterationId:0}}set currentContext(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const t=[];for(let e=0;e<this.contexts.length-1;e++){const n=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(n))}t.push(""),this._currentContextIds=t}contextIdforContexts(t){return t?t.map((t=>0===t.id&&0===t.iterationId?"":`${t.frameName}-${t.iterationId}`)).join("/"):""}enterFrame(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(t){return this.weightMap[t]}addTensorArray(t){this.tensorArrayMap[t.id]=t}getTensorArray(t){return this.tensorArrayMap[t]}addTensorList(t){this.tensorListMap[t.id]=t}getTensorList(t){return this.tensorListMap[t]}dispose(t){for(const e in this.tensorArrayMap)this.tensorArrayMap[e].clearAndClose(t);for(const e in this.tensorListMap)this.tensorListMap[e].clearAndClose(t)}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jf(t,e,n,r){const s=new Set,o=[];let i=null,a=null;const u=new Set,c=Object.keys(t).map((t=>Hl(t)[0]));let l=[];null!=r&&(l=r.map((t=>Hl(t.name)[0])));const f=[...e];for(;f.length>0;){const t=f.pop();(Kf(t)||Xf(t)||Jf(t))&&null==i&&(i=t,a=i.children.map((t=>t.name)).filter((t=>s.has(t)))),s.add(t.name),null==n[t.name]&&(-1===c.indexOf(t.name)&&-1===l.indexOf(t.name)&&(0!==t.inputs.length?t.inputs.forEach((t=>{u.has(t.name)||(u.add(t.name),f.push(t))})):o.push(t.name)))}return{inputs:t,outputs:e,usedNodes:s,missingInputs:o,dynamicNode:i,syncInputs:a}}const Gf=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],qf=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],Hf=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function Kf(t){return Gf.indexOf(t.op)>=0}function Xf(t){return qf.indexOf(t.op)>=0}function Jf(t){return Hf.indexOf(t.op)>=0}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yf{constructor(t,e){this.graph=t,this.parent=e,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((e=>{this._functionExecutorMap[e]=new Yf(t.functions[e],this)}))}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){const e=Object.keys(t).map((e=>t[e].map((t=>t.id))));this._weightIds=[].concat(...e),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get outputs(){return this._outputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get inputNodes(){return this._inputs.map((t=>t.signatureKey||t.name))}get outputNodes(){return this._outputs.map((t=>{const e=t.signatureKey||t.name;return t.defaultOutput?`${e}:${t.defaultOutput}`:e}))}get functions(){return Object.keys(this._functions).reduce(((t,e)=>(t[e]=this._functions[e].signature,t)),{})}getCompilationKey(t,e){const n=t.map((t=>t.name)).sort(),r=e.map((t=>t.name)).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}compile(t,e){const n=jf(t,e,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:s,syncInputs:o}=n;if(null!=s)throw new Error(`This execution contains the node '${s.name}', which has the dynamic op '${s.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(r.length>0){const n=e.map((t=>t.name)),s=Object.keys(t);throw new Error(`Cannot compute the outputs [${n}] from the provided inputs [${s}]. Missing the following inputs: [${r}]`)}return function(t,e,n){const{usedNodes:r,inputs:s}=n,o=[],i=Object.keys(s).map((t=>Hl(t)[0])).map((e=>t.nodes[e])),a=t.initNodes;i.forEach((t=>{r.has(t.name)&&o.push(t)})),t.weights.forEach((t=>{r.has(t.name)&&o.push(t)})),null!=a&&a.forEach((t=>{r.has(t.name)&&o.push(t)}));const u=new Set,c=[];for(;o.length>0;){const t=o.pop();u.add(t.name),e[t.name]||c.push(t),t.children.forEach((t=>{!u.has(t.name)&&r.has(t.name)&&t.inputs.every((t=>u.has(t.name)))&&o.push(t)}))}return c}(this.graph,this.weightMap,n)}execute(t,e){t=this.mapInputs(t);const n=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e);const r=n.map((t=>this.graph.nodes[Hl(t)[0]])),s=e.map((t=>Hl(t)[0]));let o=s.map((t=>this.graph.nodes[t]));this.resetIntermediateTensors(),0===o.length&&(o=this._outputs);const i=this.getCompilationKey(r,o);let a=this.compiledMap.get(i);null==a&&(a=this.compile(t,o),this.compiledMap.set(i,a));const u={},c={};return fs((()=>{const n=new Uf(this.weightMap,u,c,this.functionExecutorMap),r=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,s]=Hl(e),o=[];o[s]=t[e],r[n]=o}));const o=this.getFrozenTensorIds(r),i={};for(let t=0;t<a.length;t++){const e=a[t];if(!r[e.name]){const t=Wf(e,r,n,this._resourceManager);if(z(t))throw new Error(`The execution of the op '${e.op}' returned a promise. Please use model.executeAsync() instead.`);r[e.name]=t,this.checkTensorForDisposal(e.name,e,r,n,o,s,i)}}return null==this.parent&&n.dispose(o),e.map((t=>jl(t,r,n)))}))}getFrozenTensorIds(t){const e=[].concat.apply([],Object.keys(t).map((e=>t[e])).map((t=>t.map((t=>t.id)))));return new Set(e)}checkTensorForDisposal(t,e,n,r,s,o,i){"control"!==e.category&&-1===o.indexOf(t)&&(n[t].forEach((t=>{null!=t&&(i[t.id]=(i[t.id]||0)+e.children.length)})),e.inputs.forEach((t=>{if("control"!==t.category){const o=function(t,e,n){return e[ql(t,n.currentContextId)]}(t.name,n,r);null!=o&&o.forEach((t=>{if(t&&!t.kept&&!s.has(t.id)){const n=i[t.id];if(1===n){if(this.keepTensorForDebug){const[n,s]=Gl(e.name,r);this.intermediateTensors[n]||(this.intermediateTensors[n]=[]),this.intermediateTensors[n][s]=t}else t.dispose();delete i[t.id]}else null!=n&&i[t.id]--}}))}})))}async executeAsync(t,e){return this._executeAsync(t,e)}disposeIntermediateTensors(){this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach((t=>this.intermediateTensors[t].forEach((t=>t.dispose())))),this.disposeTensorsMap())}disposeTensorsMap(){this.tensorsMap&&Object.keys(this.tensorsMap).forEach((t=>{this.tensorsMap[t].forEach((t=>{!t||t.kept||t.isDisposed||this.keepIds.has(t.id)||t.dispose()}))}))}getIntermediateTensors(){return this.tensorsMap}resetIntermediateTensors(){for(const t in this.intermediateTensors)this.intermediateTensors[t].forEach((t=>t.dispose())),delete this.intermediateTensors[t]}async _executeAsync(t,e,n=!1,r={},s={}){n||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e));try{this.keepTensorForDebug=j().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(t){console.warn(t.message)}this.resetIntermediateTensors();const o=new Uf(this.weightMap,r,s,this.functionExecutorMap);this.tensorsMap=await this.executeWithControlFlow(t,o,e,n);const i=e.map((t=>jl(t,this.tensorsMap,o))),a=i.map((t=>t.id)),u=Object.keys(t).map((e=>t[e].id));return this.keepIds=new Set([...a,...u,...this.weightIds]),this.keepTensorForDebug||this.disposeTensorsMap(),null==this.parent&&o.dispose(this.keepIds),i}async executeFunctionAsync(t,e,n){const r=t.reduce(((t,e,n)=>(t[this.inputs[n].name]=e,t)),{});return this._executeAsync(r,this.outputNodes,!0,e,n)}async executeWithControlFlow(t,e,n,r){const s=Object.keys(t),o=s.map((t=>this.graph.nodes[Hl(t)[0]])),i=n.map((t=>Hl(t)[0]));let a=i.map((t=>this.graph.nodes[t]));0===a.length&&(a=this._outputs);const{usedNodes:u,missingInputs:c,dynamicNode:l,syncInputs:f}=jf(t,a,this.weightMap,this._initNodes),h=[...o,...this.graph.weights,...this._initNodes||[]].map((t=>({node:t,contexts:e.currentContext}))),p=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,r]=Hl(e),s=[];s[r]=t[e],p[n]=s}));const d={},m=this.getFrozenTensorIds(p),y={};for(;h.length>0;){const t=this.processStack(o,h,e,p,y,m,i,d,u);await Promise.all(t)}null!=l||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const g=a.filter((t=>!Kf(t)&&!jl(t.name,p,e))).map((t=>t.name));if(g.length>0){let t="";throw null!=l&&(t=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${f}]`),new Error(`Cannot compute the outputs [${g}] from the provided inputs [${s}]. Consider providing the following inputs: [${c}]. ${t}`)}return p}processStack(t,e,n,r,s,o,i,a,u){const c=[];for(;e.length>0;){const t=e.pop();n.currentContext=t.contexts;let l="";if("Enter"===t.node.op&&Ul("isConstant",t.node,r,n)&&([l]=Gl(t.node.name,n)),null==r[t.node.name]){const f=Wf(t.node,r,n,this._resourceManager);l||([l]=Gl(t.node.name,n));const h=n.currentContext;z(f)?c.push(f.then((c=>(r[l]=c,n.currentContext=h,this.checkTensorForDisposal(l,t.node,r,n,o,i,a),this.processChildNodes(t.node,e,n,r,s,u),c)))):(r[l]=f,this.checkTensorForDisposal(l,t.node,r,n,o,i,a),this.processChildNodes(t.node,e,n,r,s,u))}else this.processChildNodes(t.node,e,n,r,s,u)}return c}processChildNodes(t,e,n,r,s,o){t.children.forEach((t=>{const[i]=Gl(t.name,n);!s[i]&&o.has(t.name)&&("Merge"===t.op?t.inputNames.some((t=>!!jl(t,r,n)))&&(s[i]=!0,e.push({contexts:n.currentContext,node:t})):t.inputNames.every((t=>!!jl(t,r,n)))&&(s[i]=!0,e.push({contexts:n.currentContext,node:t})))}))}dispose(){Object.keys(this.weightMap).forEach((t=>this.weightMap[t].forEach((t=>t.dispose()))))}checkInputShapeAndType(t){Object.keys(t).forEach((e=>{const n=t[e],[r]=Hl(e),s=this.graph.nodes[r];if(s.attrParams.shape&&s.attrParams.shape.value){const t=s.attrParams.shape.value,e=t.length===n.shape.length&&n.shape.every(((e,n)=>-1===t[n]||t[n]===e));h(e,(()=>`The shape of dict['${s.name}'] provided in model.execute(dict) must be [${t}], but was [${n.shape}]`))}s.attrParams.dtype&&s.attrParams.dtype.value&&h(n.dtype===s.attrParams.dtype.value,(()=>`The dtype of dict['${s.name}'] provided in model.execute(dict) must be ${s.attrParams.dtype.value}, but was ${n.dtype}`))}))}mapInputs(t){const e={};for(const n in t)if(null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]){e[this._signature.inputs[n].name]=t[n]}else e[n]=t[n];return e}checkInputs(t){const e=Object.keys(t).filter((t=>{const[e]=Hl(t);return null==this.graph.nodes[e]}));if(e.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${e}] that are not part of graph`)}mapOutputs(t){return t.map((t=>{if(null!=this._signature&&null!=this._signature.outputs&&null!=this._signature.outputs[t]){return this._signature.outputs[t].name}return t}),{})}checkOutputs(t){t.forEach((t=>{const[e]=Hl(t);if(!this.graph.nodes[e])throw new Error(`The output '${t}' is not found in the graph`)}))}}class Zf{constructor(t={},e={}){this.hashTableNameToHandle=t,this.hashTableMap=e}addHashTable(t,e){this.hashTableNameToHandle[t]=e.handle,this.hashTableMap[e.id]=e}getHashTableHandleByName(t){return this.hashTableNameToHandle[t]}getHashTableById(t){return this.hashTableMap[t]}dispose(){for(const t in this.hashTableMap)this.hashTableMap[t].clearAndClose(),delete this.hashTableMap[t];for(const t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qf{constructor(t,e={}){this.modelUrl=t,this.loadOptions=e,this.version="n/a",null==e&&(this.loadOptions={}),this.resourceManager=new Zf}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}findIOHandler(){const t=this.modelUrl;if(null!=t.load)this.handler=t;else if(null!=this.loadOptions.requestInit)this.handler=ns(t,this.loadOptions);else{const e=gr(t,this.loadOptions);if(0===e.length)e.push(ns(t,this.loadOptions));else if(e.length>1)throw new Error(`Found more than one (${e.length}) load handlers for URL '${[t]}'`);this.handler=e[0]}}load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const t=this.handler.load();return z(t)?t.then((t=>this.loadSync(t))):this.loadSync(t)}loadSync(t){this.artifacts=t;const e=this.artifacts.modelTopology;let n;n=null!=this.artifacts.userDefinedMetadata&&null!=this.artifacts.userDefinedMetadata.signature?this.artifacts.userDefinedMetadata.signature:this.artifacts.signature,this.signature=n,this.version=`${e.versions.producer}.${e.versions.minConsumer}`;const r=or(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new Yf(yf.Instance.transformGraph(e,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=t.modelInitializer&&null!=t.modelInitializer.node){const e=yf.Instance.transformGraph(t.modelInitializer);this.initializer=new Yf(e),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(t,e){if("string"==typeof t){const e=yr(t);if(0===e.length)throw new Error(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new Error(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}if(null==t.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return t.save(this.artifacts)}predict(t,e){return this.execute(t,this.outputNodes)}normalizeInputs(t){if(!(t instanceof ke||Array.isArray(t)))return t;if((t=Array.isArray(t)?t:[t]).length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${t.length} input tensors.`);return this.inputNodes.reduce(((e,n,r)=>(e[n]=t[r],e)),{})}normalizeOutputs(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]}execute(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=this.executor.execute(t,e);return n.length>1?n:n[0]}async executeAsync(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=await this.executor.executeAsync(t,e);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(t){return Object.keys(t).reduce(((e,n)=>(e[n]=[t[n]],e)),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}async function th(t,e={}){if(null==t)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==e&&(e={}),e.fromTFHub&&"string"==typeof t&&(t=function(t){t.endsWith("/")||(t+="/");return`${t}model.json?tfjs-format=file`}
/**
    * @license
    * Copyright 2021 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */(t));const n=new Qf(t,e);return await n.load(),n}var eh=function(t,e){return(eh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function nh(t,e){function n(){this.constructor=t}eh(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var rh=function(){return(rh=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)};function sh(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}u((r=r.apply(t,e||[])).next())}))}function oh(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=(s=i.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function ih(t){var e=t.shape[2],n=ho(t,2),r=Io(n,[-1]);return cs(r,e)}function ah(t,e){return fs((function(){return Ur(Gi(t,Ci(e)),"int32")}))}function uh(t,e){var n=e.shape,r=n[0],s=n[1],o=n[2];return fs((function(){var n=ih(e),i=Pi(fu(0,o,1,"int32"),1),a=Ur(us(n,i),"int32"),u=Io(a,[r,s]),c=no(u,Ci(1,"int32"));return ua(function(t,e){return oo(t,e)}(c,t),Ci(1,"int32"))}))}function ch(t){var e=t.shape,n=e[0],r=e[1],s=e[2];return fs((function(){var e=ih(t),o=Pi(fu(0,s,1,"int32"),1),i=Ur(us(e,o),"int32");return Io(i,[n,r])}))}var lh=function(){function t(t,e){this.model=t,this.outputStride=e;var n=this.model.inputs[0].shape;h(-1===n[1]&&-1===n[2],(function(){return"Input shape ["+n[1]+", "+n[2]+"] must both be equal to or -1"}))}return t.prototype.predict=function(t){var e=this;return fs((function(){var n=e.preprocessInput(Ur(t,"float32")),r=Pi(n,0),s=e.model.predict(r).map((function(t){return Bu(t,[0])})),o=e.nameOutputResults(s);return{heatmapScores:Fo(o.heatmap),offsets:o.offsets,displacementFwd:o.displacementFwd,displacementBwd:o.displacementBwd,segmentation:o.segmentation,partHeatmaps:o.partHeatmaps,longOffsets:o.longOffsets,partOffsets:o.partOffsets}}))},t.prototype.dispose=function(){this.model.dispose()},t}(),fh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return nh(e,t),e.prototype.preprocessInput=function(t){return fs((function(){return ua(so(t,127.5),1)}))},e.prototype.nameOutputResults=function(t){return{offsets:t[0],segmentation:t[1],partHeatmaps:t[2],longOffsets:t[3],heatmap:t[4],displacementFwd:t[5],displacementBwd:t[6],partOffsets:t[7]}},e}(lh),hh=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],ph=hh.length,dh=hh.reduce((function(t,e,n){return t[e]=n,t}),{});function mh(t,e,n){var r=t[0],s=t[1],o=e[0],i=e[1],a=n.top,u=n.bottom;return[i/(n.left+n.right+s),o/(a+u+r)]}function yh(t,e,n,r){return{y:r.get(t,e,n),x:r.get(t,e,n+ph)}}function gh(t,e,n){var r=yh(t.heatmapY,t.heatmapX,t.id,n),s=r.y,o=r.x;return{x:t.heatmapX*e+o,y:t.heatmapY*e+s}}function bh(t,e,n){return t<e?e:t>n?n:t}function wh(t,e){return{x:t.x+e.x,y:t.y+e.y}}function vh(t,e,n){void 0===n&&(n=.3);for(var r=0,s=0,o=0;o<t.length;o++)e.keypoints[o].score>n&&(s+=1,r+=Math.pow(t[o].x-e.keypoints[o].position.x,2)+Math.pow(t[o].y-e.keypoints[o].position.y,2));return 0===s?r=1/0:r/=s,r}function xh(t,e,n,r,s,o,i){for(var a=i[0],u=i[1],c=n(t),l=c.y*r+c.x,f=s[ph*(2*l)+e],h=s[ph*(2*l+1)+e],p=t.y+f,d=t.x+h,m=0;m<o;m++){p=Math.min(p,a-1);var y=n({x:d=Math.min(d,u-1),y:p}),g=y.y*r+y.x;p+=f=s[ph*(2*g)+e],d+=h=s[ph*(2*g+1)+e]}return{x:d,y:p}}function Nh(t,e,n,r,s,o,i,a,u,c){for(var l=s[0],f=s[1],h=o[0],p=o[1],d=a[0],m=a[1],y=[],g=function(t){return function(t,e,n,r){var s=e[0],o=e[1],i=n[0],a=n[1],u=Math.round(((s+t.y+1)*a-1)/r);return{x:Math.round(((o+t.x+1)*i-1)/r),y:u}}(t,[l,f],[h,p],u)},b=0;b<r;b++){var w=xh(t,b,g,i,e,c,[d,m]);y.push(w)}for(var v=-1,x=1/0,N=0;N<n.length;N++){var $=vh(y,n[N]);$<x&&(v=N,x=$)}return v}function $h(t,e){var n=t[0],r=t[1];return[Math.round((r-1)/e+1),Math.round((n-1)/e+1)]}function Eh(t,e,n,r,s,o,i,a,u,c,l){for(var f=i[0],h=i[1],p=t.shape,d=p[0],m=p[1],y=e.shape.slice(0,2),g=y[0],b=y[1],w=Io(e,[g,b,2,ph]),v=new Float32Array(l*ph*3).fill(0),x=0;x<n.length;x++)for(var N=x*ph*3,$=n[x],E=0;E<ph;E++){var S=$.keypoints[E],_=N+3*E;v[_]=S.score,v[_+1]=S.position.y,v[_+2]=S.position.x}var T=mh([r,s],[f,h],a),k=T[0],A=T[1],C=rr(v,[l,ph,3]),O=a.top,I=a.left,M={variableNames:["segmentation","longOffsets","poses"],outputShape:[d,m],userCode:"\n    int convertToPositionInOutput(int pos, int pad, float scale, int stride) {\n      return round(((float(pos + pad) + 1.0) * scale - 1.0) / float(stride));\n    }\n\n    float convertToPositionInOutputFloat(\n        int pos, int pad, float scale, int stride) {\n      return ((float(pos + pad) + 1.0) * scale - 1.0) / float(stride);\n    }\n\n    float dist(float x1, float y1, float x2, float y2) {\n      return pow(x1 - x2, 2.0) + pow(y1 - y2, 2.0);\n    }\n\n    float sampleLongOffsets(float h, float w, int d, int k) {\n      float fh = fract(h);\n      float fw = fract(w);\n      int clH = int(ceil(h));\n      int clW = int(ceil(w));\n      int flH = int(floor(h));\n      int flW = int(floor(w));\n      float o11 = getLongOffsets(flH, flW, d, k);\n      float o12 = getLongOffsets(flH, clW, d, k);\n      float o21 = getLongOffsets(clH, flW, d, k);\n      float o22 = getLongOffsets(clH, clW, d, k);\n      float o1 = mix(o11, o12, fw);\n      float o2 = mix(o21, o22, fw);\n      return mix(o1, o2, fh);\n    }\n\n    int findNearestPose(int h, int w) {\n      float prob = getSegmentation(h, w);\n      if (prob < 1.0) {\n        return -1;\n      }\n\n      // Done(Tyler): convert from output space h/w to strided space.\n      float stridedH = convertToPositionInOutputFloat(\n        h, "+O+", "+A+", "+o+");\n      float stridedW = convertToPositionInOutputFloat(\n        w, "+I+", "+k+", "+o+");\n\n      float minDist = 1000000.0;\n      int iMin = -1;\n      for (int i = 0; i < "+l+"; i++) {\n        float curDistSum = 0.0;\n        int numKpt = 0;\n        for (int k = 0; k < "+ph+"; k++) {\n          float dy = sampleLongOffsets(stridedH, stridedW, 0, k);\n          float dx = sampleLongOffsets(stridedH, stridedW, 1, k);\n\n          float y = float(h) + dy;\n          float x = float(w) + dx;\n\n          for (int s = 0; s < "+u+"; s++) {\n            int yRounded = round(min(y, float("+(r-1)+")));\n            int xRounded = round(min(x, float("+(s-1)+")));\n\n            float yStrided = convertToPositionInOutputFloat(\n              yRounded, "+O+", "+A+", "+o+");\n            float xStrided = convertToPositionInOutputFloat(\n              xRounded, "+I+", "+k+", "+o+");\n\n            float dy = sampleLongOffsets(yStrided, xStrided, 0, k);\n            float dx = sampleLongOffsets(yStrided, xStrided, 1, k);\n\n            y = y + dy;\n            x = x + dx;\n          }\n\n          float poseScore = getPoses(i, k, 0);\n          float poseY = getPoses(i, k, 1);\n          float poseX = getPoses(i, k, 2);\n          if (poseScore > "+c+") {\n            numKpt = numKpt + 1;\n            curDistSum = curDistSum + dist(x, y, poseX, poseY);\n          }\n        }\n        if (numKpt > 0 && curDistSum / float(numKpt) < minDist) {\n          minDist = curDistSum / float(numKpt);\n          iMin = i;\n        }\n      }\n      return iMin;\n    }\n\n    void main() {\n        ivec2 coords = getOutputCoords();\n        int nearestPose = findNearestPose(coords[0], coords[1]);\n        setOutput(float(nearestPose));\n      }\n  "};return ms().compileAndRun(M,[t,w,C])}function Sh(){return"webgl"===ds()}function _h(t,e,n,r,s,o,i,a,u,c,l,f){var h=i[0],p=i[1];return void 0===u&&(u=.2),void 0===c&&(c=8),void 0===l&&(l=.3),void 0===f&&(f=10),sh(this,void 0,void 0,(function(){var i,d,m,y,g;return oh(this,(function(b){switch(b.label){case 0:return i=n.filter((function(t){return t.score>=u})),Sh()?(m=fs((function(){var n=Eh(t,e,i,r,s,o,[h,p],a,c,l,f),u=ls().makeTensorFromDataId(n.dataId,n.shape,n.dtype);return i.map((function(t,e){return function(t,e){return fs((function(){return Ur(yi(t,Ci(e)),"int32")}))}(u,e)}))})),[4,Promise.all(m.map((function(t){return t.data()})))]):[3,2];case 1:return d=b.sent(),m.forEach((function(t){return t.dispose()})),[3,5];case 2:return[4,t.data()];case 3:return y=b.sent(),[4,e.data()];case 4:g=b.sent(),d=function(t,e,n,r,s,o,i,a,u,c){var l=i[0],f=i[1];void 0===c&&(c=5);for(var h=n.map((function(t){return new Uint8Array(r*s).fill(0)})),p=a.top,d=a.left,m=mh([r,s],[l,f],a),y=m[0],g=m[1],b=$h([l,f],o)[0],w=0;w<r;w+=1)for(var v=0;v<s;v+=1){var x=w*s+v;if(1===t[x]){var N=Nh({x:v,y:w},e,n,c,[p,d],[y,g],b,[r,s],o,u);N>=0&&(h[N][x]=1)}}return h}(y,g,i,r,s,o,[h,p],a,c),b.label=5;case 5:return[2,d.map((function(t,e){return{data:t,pose:i[e],width:s,height:r}}))]}}))}))}function Th(t,e,n,r,s,o,i,a,u,c,l,f,h){var p=a[0],d=a[1];return void 0===c&&(c=.2),void 0===l&&(l=8),void 0===f&&(f=.3),void 0===h&&(h=10),sh(this,void 0,void 0,(function(){var a,m,y,g,b,w;return oh(this,(function(v){switch(v.label){case 0:return a=r.filter((function(t){return t.score>=c})),Sh()?(y=fs((function(){var r=Eh(t,e,a,s,o,i,[p,d],u,l,f,h),c=ls().makeTensorFromDataId(r.dataId,r.shape,r.dtype);return a.map((function(t,e){return function(t,e,n){return fs((function(){return ua(oo(Ur(yi(t,Ci(n)),"int32"),no(e,1)),1)}))}(c,n,e)}))})),[4,Promise.all(y.map((function(t){return t.data()})))]):[3,2];case 1:return m=v.sent(),y.forEach((function(t){return t.dispose()})),[3,6];case 2:return[4,t.data()];case 3:return g=v.sent(),[4,e.data()];case 4:return b=v.sent(),[4,n.data()];case 5:w=v.sent(),m=function(t,e,n,r,s,o,i,a,u,c,l){var f=a[0],h=a[1];void 0===l&&(l=5);for(var p=r.map((function(t){return new Int32Array(s*o).fill(-1)})),d=u.top,m=u.left,y=mh([s,o],[f,h],u),g=y[0],b=y[1],w=$h([f,h],i)[0],v=0;v<s;v+=1)for(var x=0;x<o;x+=1){var N=v*o+x;if(1===t[N]){var $=Nh({x,y:v},e,r,l,[d,m],[g,b],w,[s,o],i,c);$>=0&&(p[$][N]=n[N])}}return p}(g,b,w,a,s,o,i,[p,d],u,l),v.label=6;case 6:return[2,m.map((function(t,e){return{pose:a[e],data:t,height:s,width:o}}))]}}))}))}function kh(t){return Math.floor(t/2)}[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map((function(t){var e=t[0],n=t[1];return[dh[e],dh[n]]}));var Ah=function(){function t(t,e){this.priorityQueue=new Array(t),this.numberOfElements=-1,this.getElementValue=e}return t.prototype.enqueue=function(t){this.priorityQueue[++this.numberOfElements]=t,this.swim(this.numberOfElements)},t.prototype.dequeue=function(){var t=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,t},t.prototype.empty=function(){return-1===this.numberOfElements},t.prototype.size=function(){return this.numberOfElements+1},t.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},t.prototype.max=function(){return this.priorityQueue[0]},t.prototype.swim=function(t){for(;t>0&&this.less(kh(t),t);)this.exchange(t,kh(t)),t=kh(t)},t.prototype.sink=function(t){for(;2*t<=this.numberOfElements;){var e=2*t;if(e<this.numberOfElements&&this.less(e,e+1)&&e++,!this.less(t,e))break;this.exchange(t,e),t=e}},t.prototype.getValueAt=function(t){return this.getElementValue(this.priorityQueue[t])},t.prototype.less=function(t,e){return this.getValueAt(t)<this.getValueAt(e)},t.prototype.exchange=function(t,e){var n=this.priorityQueue[t];this.priorityQueue[t]=this.priorityQueue[e],this.priorityQueue[e]=n},t}();function Ch(t,e,n,r,s,o){for(var i=o.shape,a=i[0],u=i[1],c=!0,l=Math.max(n-s,0),f=Math.min(n+s+1,a),h=l;h<f;++h){for(var p=Math.max(r-s,0),d=Math.min(r+s+1,u),m=p;m<d;++m)if(o.get(h,m,t)>e){c=!1;break}if(!c)break}return c}var Oh=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]].map((function(t){var e=t[0],n=t[1];return[dh[e],dh[n]]})),Ih=Oh.map((function(t){return t[1]})),Mh=Oh.map((function(t){return t[0]}));function Rh(t,e,n,r){return{y:bh(Math.round(t.y/e),0,n-1),x:bh(Math.round(t.x/e),0,r-1)}}function Dh(t,e,n,r,s,o,i,a){void 0===a&&(a=2);for(var u=r.shape,c=u[0],l=u[1],f=function(t,e,n){var r=n.shape[2]/2;return{y:n.get(e.y,e.x,t),x:n.get(e.y,e.x,r+t)}}(t,Rh(e.position,o,c,l),i),h=wh(e.position,f),p=0;p<a;p++){var d=Rh(h,o,c,l),m=yh(d.y,d.x,n,s);h=wh({x:d.x*o,y:d.y*o},{x:m.x,y:m.y})}var y=Rh(h,o,c,l),g=r.get(y.y,y.x,n);return{position:h,part:hh[n],score:g}}function Fh(t,e,n,r,s,o){var i=e.shape[2],a=Ih.length,u=new Array(i),c=t.part,l=t.score,f=gh(c,r,n);u[c.id]={score:l,part:hh[c.id],position:f};for(var h=a-1;h>=0;--h){var p=Ih[h],d=Mh[h];u[p]&&!u[d]&&(u[d]=Dh(h,u[p],d,e,n,r,o))}for(h=0;h<a;++h)p=Mh[h],d=Ih[h],u[p]&&!u[d]&&(u[d]=Dh(h,u[p],d,e,n,r,s));return u}function Lh(t,e,n,r){var s=n.x,o=n.y;return t.some((function(t){var n=t.keypoints[r].position;return function(t,e,n,r){var s=n-t,o=r-e;return s*s+o*o}(o,s,n.y,n.x)<=e}))}function Ph(t,e,n){return n.reduce((function(n,r,s){var o=r.position,i=r.score;return Lh(t,e,o,s)||(n+=i),n}),0)/n.length}function Bh(t,e,n,r,s,o,i,a){void 0===i&&(i=.5),void 0===a&&(a=20);for(var u=[],c=function(t,e,n){for(var r=n.shape,s=r[0],o=r[1],i=r[2],a=new Ah(s*o*i,(function(t){return t.score})),u=0;u<s;++u)for(var c=0;c<o;++c)for(var l=0;l<i;++l){var f=n.get(u,c,l);f<t||Ch(l,f,u,c,e,n)&&a.enqueue({score:f,part:{heatmapY:u,heatmapX:c,id:l}})}return a}(i,1,t),l=a*a;u.length<o&&!c.empty();){var f=c.dequeue();if(!Lh(u,l,gh(f.part,s,e),f.part.id)){var h=Fh(f,t,e,s,n,r),p=Ph(u,l,h);u.push({keypoints:h,score:p})}}return u}var Vh,zh=[-123.15,-115.9,-103.06],Wh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return nh(e,t),e.prototype.preprocessInput=function(t){return no(t,zh)},e.prototype.nameOutputResults=function(t){var e=t[0],n=t[1],r=t[2],s=t[3],o=t[4],i=t[5];return{offsets:o,segmentation:t[6],partHeatmaps:i,longOffsets:s,heatmap:r,displacementFwd:n,displacementBwd:e,partOffsets:t[7]}},e}(lh),Uh="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/resnet50/",jh="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/mobilenet/";function Gh(t){if("undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas||"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)return function(t){if("offsetHeight"in t&&0!==t.offsetHeight&&"offsetWidth"in t&&0!==t.offsetWidth)return[t.offsetHeight,t.offsetWidth];if(null!=t.height&&null!=t.width)return[t.height,t.width];throw new Error("HTMLImageElement must have height and width attributes set.")}(t);if("undefined"!=typeof ImageData&&t instanceof ImageData)return[t.height,t.width];if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)return function(t){return t.hasAttribute("height")&&t.hasAttribute("width")?[t.height,t.width]:[t.videoHeight,t.videoWidth]}(t);if(t instanceof ke)return[t.shape[0],t.shape[1]];throw new Error("error: Unknown input type: "+t+".")}function qh(t,e){return function(t,e){return(t-1)%e==0}(t,e)?t:Math.floor(t/e)*e+1}var Hh={low:"low",medium:"medium",high:"high",full:"full"},Kh=((Vh={})[Hh.low]=.25,Vh[Hh.medium]=.5,Vh[Hh.high]=.75,Vh[Hh.full]=1,Vh);function Xh(t,e,n){var r=n[0],s=n[1],o=function(t){if("string"==typeof t){var e=Kh[t];return h("number"==typeof e,(function(){return"string value of inputResolution must be one of "+Object.values(Hh).join(",")+" but was "+t+"."})),e}return h("number"==typeof t&&t<=2&&t>=.1,(function(){return"inputResolution must be a string or number between 0.1 and 2, but was "+t})),t}(t);return[qh(r*o,e),qh(s*o,e)]}function Jh(t,e,n,r,s){var o=e[0],i=e[1],a=n[0],u=n[1],c=r[0],l=c[0],f=c[1],h=r[1],p=h[0],d=h[1];return void 0===s&&(s=!1),fs((function(){var e=gl.resizeBilinear(t,[a,u],!0);return s&&(e=Fo(e)),function(t,e,n){var r=e[0],s=e[1],o=n[0],i=o[0],a=o[1],u=n[1],c=u[0],l=u[1];return fs((function(){var e=Pi(t);return Bu(gl.cropAndResize(e,[[i/(r+i+a-1),c/(s+c+l-1),(i+r-1)/(r+i+a-1),(c+s-1)/(s+c+l-1)]],[0],[r,s]),[0])}))}(e,[o,i],[[l,f],[p,d]])}))}function Yh(t,e){var n=e[0],r=e[1],s=Gh(t),o=s[0],i=s[1],a=r/n,u=[0,0,0,0],c=u[0],l=u[1],f=u[2],h=u[3];return i/o<a?(c=0,l=0,f=Math.round(.5*(a*o-i)),h=Math.round(.5*(a*o-i))):(c=Math.round(.5*(1/a*i-o)),l=Math.round(.5*(1/a*i-o)),f=0,h=0),{resized:fs((function(){var e=function(t){return t instanceof ke?t:Cs(t)}(t);return e=Fa(e,[[c,l],[f,h],[0,0]]),gl.resizeBilinear(e,[n,r])})),padding:{top:c,left:f,right:h,bottom:l}}}function Zh(t){return sh(this,void 0,void 0,(function(){return oh(this,(function(e){return[2,Promise.all(t.map((function(t){return t.buffer()})))]}))}))}function Qh(t,e){return{score:t.score,keypoints:t.keypoints.map((function(t){var n=t.score,r=t.part,s=t.position;return{score:n,part:r,position:{x:e-1-s.x,y:s.y}}}))}}function tp(t,e,n,r,s){var o=e[0],i=e[1],a=n[0],u=n[1],c=function(t,e,n,r,s){return void 0===r&&(r=0),void 0===s&&(s=0),1===n&&1===e&&0===r&&0===s?t:t.map((function(t){return function(t,e,n,r,s){return void 0===r&&(r=0),void 0===s&&(s=0),{score:t.score,keypoints:t.keypoints.map((function(t){var o=t.score,i=t.part,a=t.position;return{score:o,part:i,position:{x:a.x*n+s,y:a.y*e+r}}}))}}(t,e,n,r,s)}))}(t,(o+r.top+r.bottom)/a,(i+r.left+r.right)/u,-r.top,-r.left);return s?function(t,e){return e<=0?t:t.map((function(t){return Qh(t,e)}))}(c,i):c}var ep={architecture:"MobileNetV1",outputStride:16,quantBytes:4,multiplier:.75},np=["MobileNetV1","ResNet50"],rp={MobileNetV1:[8,16,32],ResNet50:[32,16]},sp={MobileNetV1:[.5,.75,1],ResNet50:[1]},op=[1,2,4];var ip={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20},ap={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20,minKeypointScore:.3,refineSteps:10};function up(t){var e=t.segmentationThreshold,n=t.maxDetections,r=t.scoreThreshold,s=t.nmsRadius;if(e<0||e>1)throw new Error("segmentationThreshold "+e+". Should be in range [0.0, 1.0]");if(n<=0)throw new Error("Invalid maxDetections "+n+". Should be > 0");if(r<0||r>1)throw new Error("Invalid scoreThreshold "+r+". Should be in range [0.0, 1.0]");if(s<=0)throw new Error("Invalid nmsRadius "+s+".")}function cp(t){var e=t.segmentationThreshold,n=t.maxDetections,r=t.scoreThreshold,s=t.nmsRadius,o=t.minKeypointScore,i=t.refineSteps;if(e<0||e>1)throw new Error("segmentationThreshold "+e+". Should be in range [0.0, 1.0]");if(n<=0)throw new Error("Invalid maxDetections "+n+". Should be > 0");if(r<0||r>1)throw new Error("Invalid scoreThreshold "+r+". Should be in range [0.0, 1.0]");if(s<=0)throw new Error("Invalid nmsRadius "+s+".");if(o<0||o>1)throw new Error("Invalid minKeypointScore "+o+".Should be in range [0.0, 1.0]");if(i<=0||i>20)throw new Error("Invalid refineSteps "+i+".Should be in range [1, 20]")}var lp=function(){function t(t){this.baseModel=t}return t.prototype.predictForPersonSegmentation=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd}},t.prototype.predictForPersonSegmentationAndPart=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,partHeatmapLogits:e.partHeatmaps,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd}},t.prototype.predictForMultiPersonInstanceSegmentationAndPart=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,longOffsets:e.longOffsets,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd,partHeatmaps:e.partHeatmaps}},t.prototype.segmentPersonActivation=function(t,e,n){var r=this;void 0===n&&(n=.5);var s=Gh(t),o=s[0],i=s[1],a=Xh(e,this.baseModel.outputStride,[o,i]),u=Yh(t,a),c=u.resized,l=u.padding,f=fs((function(){var t=r.predictForPersonSegmentation(c),e=t.segmentLogits,s=t.heatmapScores,a=t.offsets,u=t.displacementFwd,f=t.displacementBwd,h=c.shape,p=h[0],d=h[1],m=Jh(e,[o,i],[p,d],[[l.top,l.bottom],[l.left,l.right]],true);return{segmentation:ah(Bu(m),n),heatmapScores:s,offsets:a,displacementFwd:u,displacementBwd:f}})),h=f.segmentation,p=f.heatmapScores,d=f.offsets,m=f.displacementFwd,y=f.displacementBwd;return c.dispose(),{segmentation:h,heatmapScores:p,offsets:d,displacementFwd:m,displacementBwd:y,padding:l,internalResolutionHeightAndWidth:a}},t.prototype.segmentPerson=function(t,e){return void 0===e&&(e=ip),sh(this,void 0,void 0,(function(){var n,r,s,o,i,a,u,c,l,f,h,p,d,m,y,g,b,w;return oh(this,(function(v){switch(v.label){case 0:return up(e=rh(rh({},ip),e)),n=this.segmentPersonActivation(t,e.internalResolution,e.segmentationThreshold),r=n.segmentation,s=n.heatmapScores,o=n.offsets,i=n.displacementFwd,a=n.displacementBwd,u=n.padding,c=n.internalResolutionHeightAndWidth,l=r.shape,f=l[0],h=l[1],[4,r.data()];case 1:return p=v.sent(),r.dispose(),[4,Zh([s,o,i,a])];case 2:return d=v.sent(),m=d[0],y=d[1],g=d[2],b=d[3],w=tp(w=Bh(m,y,g,b,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[f,h],c,u,false),s.dispose(),o.dispose(),i.dispose(),a.dispose(),[2,{height:f,width:h,data:p,allPoses:w}]}}))}))},t.prototype.segmentMultiPerson=function(t,e){return void 0===e&&(e=ap),sh(this,void 0,void 0,(function(){var n,r,s,o,i,a,u,c,l,f,h,p,d,m,y,g,b,w,v,x,N,$=this;return oh(this,(function(E){switch(E.label){case 0:return cp(e=rh(rh({},ap),e)),n=Gh(t),r=n[0],s=n[1],o=Xh(e.internalResolution,this.baseModel.outputStride,[r,s]),i=Yh(t,o),a=i.resized,u=i.padding,c=fs((function(){var t,n=$.predictForMultiPersonInstanceSegmentationAndPart(a),i=n.segmentLogits,c=n.longOffsets,l=n.heatmapScores,f=n.offsets,h=n.displacementFwd,p=n.displacementBwd,d=Jh(i,[r,s],o,[[u.top,u.bottom],[u.left,u.right]],true);return t=c,{segmentation:ah(Bu(d),e.segmentationThreshold),longOffsets:t,heatmapScoresRaw:l,offsetsRaw:f,displacementFwdRaw:h,displacementBwdRaw:p}})),l=c.segmentation,f=c.longOffsets,h=c.heatmapScoresRaw,p=c.offsetsRaw,d=c.displacementFwdRaw,m=c.displacementBwdRaw,[4,Zh([h,p,d,m])];case 1:return y=E.sent(),g=y[0],b=y[1],w=y[2],v=y[3],x=tp(x=Bh(g,b,w,v,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[r,s],o,u,false),[4,_h(l,f,x,r,s,this.baseModel.outputStride,o,u,e.scoreThreshold,e.refineSteps,e.minKeypointScore,e.maxDetections)];case 2:return N=E.sent(),a.dispose(),l.dispose(),f.dispose(),h.dispose(),p.dispose(),d.dispose(),m.dispose(),[2,N]}}))}))},t.prototype.segmentPersonPartsActivation=function(t,e,n){var r=this;void 0===n&&(n=.5);var s=Gh(t),o=s[0],i=s[1],a=Xh(e,this.baseModel.outputStride,[o,i]),u=Yh(t,a),c=u.resized,l=u.padding,f=fs((function(){var t=r.predictForPersonSegmentationAndPart(c),e=t.segmentLogits,s=t.partHeatmapLogits,a=t.heatmapScores,u=t.offsets,f=t.displacementFwd,h=t.displacementBwd,p=c.shape,d=p[0],m=p[1],y=Jh(e,[o,i],[d,m],[[l.top,l.bottom],[l.left,l.right]],true),g=Jh(s,[o,i],[d,m],[[l.top,l.bottom],[l.left,l.right]],true);return{partSegmentation:uh(ah(Bu(y),n),g),heatmapScores:a,offsets:u,displacementFwd:f,displacementBwd:h}})),h=f.partSegmentation,p=f.heatmapScores,d=f.offsets,m=f.displacementFwd,y=f.displacementBwd;return c.dispose(),{partSegmentation:h,heatmapScores:p,offsets:d,displacementFwd:m,displacementBwd:y,padding:l,internalResolutionHeightAndWidth:a}},t.prototype.segmentPersonParts=function(t,e){return void 0===e&&(e=ip),sh(this,void 0,void 0,(function(){var n,r,s,o,i,a,u,c,l,f,h,p,d,m,y,g,b,w;return oh(this,(function(v){switch(v.label){case 0:return up(e=rh(rh({},ip),e)),n=this.segmentPersonPartsActivation(t,e.internalResolution,e.segmentationThreshold),r=n.partSegmentation,s=n.heatmapScores,o=n.offsets,i=n.displacementFwd,a=n.displacementBwd,u=n.padding,c=n.internalResolutionHeightAndWidth,l=r.shape,f=l[0],h=l[1],[4,r.data()];case 1:return p=v.sent(),r.dispose(),[4,Zh([s,o,i,a])];case 2:return d=v.sent(),m=d[0],y=d[1],g=d[2],b=d[3],w=tp(w=Bh(m,y,g,b,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[f,h],c,u,false),s.dispose(),o.dispose(),i.dispose(),a.dispose(),[2,{height:f,width:h,data:p,allPoses:w}]}}))}))},t.prototype.segmentMultiPersonParts=function(t,e){return void 0===e&&(e=ap),sh(this,void 0,void 0,(function(){var n,r,s,o,i,a,u,c,l,f,h,p,d,m,y,g,b,w,v,x,N,$,E=this;return oh(this,(function(S){switch(S.label){case 0:return cp(e=rh(rh({},ap),e)),n=Gh(t),r=n[0],s=n[1],o=Xh(e.internalResolution,this.baseModel.outputStride,[r,s]),i=Yh(t,o),a=i.resized,u=i.padding,c=fs((function(){var t=E.predictForMultiPersonInstanceSegmentationAndPart(a),n=t.segmentLogits,i=t.longOffsets,c=t.heatmapScores,l=t.offsets,f=t.displacementFwd,h=t.displacementBwd,p=t.partHeatmaps,d=Jh(n,[r,s],o,[[u.top,u.bottom],[u.left,u.right]],true),m=Jh(p,[r,s],o,[[u.top,u.bottom],[u.left,u.right]],true),y=i;return{segmentation:ah(Bu(d),e.segmentationThreshold),longOffsets:y,heatmapScoresRaw:c,offsetsRaw:l,displacementFwdRaw:f,displacementBwdRaw:h,partSegmentation:ch(m)}})),l=c.segmentation,f=c.longOffsets,h=c.heatmapScoresRaw,p=c.offsetsRaw,d=c.displacementFwdRaw,m=c.displacementBwdRaw,y=c.partSegmentation,[4,Zh([h,p,d,m])];case 1:return g=S.sent(),b=g[0],w=g[1],v=g[2],x=g[3],N=tp(N=Bh(b,w,v,x,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[r,s],o,u,false),[4,Th(l,f,y,N,r,s,this.baseModel.outputStride,o,u,e.scoreThreshold,e.refineSteps,e.minKeypointScore,e.maxDetections)];case 2:return $=S.sent(),a.dispose(),l.dispose(),f.dispose(),h.dispose(),p.dispose(),d.dispose(),m.dispose(),y.dispose(),[2,$]}}))}))},t.prototype.dispose=function(){this.baseModel.dispose()},t}();function fp(t){return sh(this,void 0,void 0,(function(){var e,n,r,s,o,i;return oh(this,(function(a){switch(a.label){case 0:if(e=t.outputStride,n=t.quantBytes,r=t.multiplier,null==Pl)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this\n        model.");return s=function(t,e,n){var r={1:"100",.75:"075",.5:"050"},s="model-stride"+t+".json";return 4===n?jh+"float/"+r[e]+"/"+s:jh+"quant"+n+"/"+r[e]+"/"+s}(e,r,n),[4,th(t.modelUrl||s)];case 1:return o=a.sent(),i=new fh(o,e),[2,new lp(i)]}}))}))}function hp(t){return sh(this,void 0,void 0,(function(){var e,n,r,s,o;return oh(this,(function(i){switch(i.label){case 0:if(e=t.outputStride,n=t.quantBytes,null==Pl)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this\n        model.");return r=function(t,e){var n="model-stride"+t+".json";return 4===e?Uh+"float/"+n:Uh+"quant"+e+"/"+n}(e,n),[4,th(t.modelUrl||r)];case 1:return s=i.sent(),o=new Wh(s,e),[2,new lp(o)]}}))}))}var pp={};function dp(t,e,n,r){var s=t.width,o=t.height,i=e.width,a=e.height;if(s!==i||o!==a)throw new Error("error: dimensions must match. "+n+" has dimensions "+s+"x"+o+", "+r+" has dimensions "+i+"x"+a)}function mp(t){var e=t.getContext("2d");e.scale(-1,1),e.translate(-t.width,0)}function yp(t,e,n){t.globalCompositeOperation=n,t.drawImage(e,0,0)}function gp(t){return pp[t]||(pp[t]=function(){if("undefined"!=typeof document)return document.createElement("canvas");if("undefined"!=typeof OffscreenCanvas)return new OffscreenCanvas(0,0);throw new Error("Cannot create a canvas in this context")}()),pp[t]}function bp(t,e,n){var r=t.height,s=t.width,o=n.getContext("2d");n.width=s,n.height=r,o.clearRect(0,0,s,r),o.save(),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?function(t,e,n){for(var r=t.getContext("2d"),s=0,o=1/(2*Math.PI*5*5),i=n<3?1:2,a=-n;a<=n;a+=i)for(var u=-n;u<=n;u+=i)s+=o*Math.exp(-(u*u+a*a)/50);for(a=-n;a<=n;a+=i)for(u=-n;u<=n;u+=i)r.globalAlpha=o*Math.exp(-(u*u+a*a)/50)/s*n,r.drawImage(e,u,a);r.globalAlpha=1}(n,t,e):(o.filter="blur("+e+"px)",o.drawImage(t,0,0,s,r)),o.restore()}function wp(t,e,n){var r=gp(n);return 0===e?function(t,e){var n=t.width,r=t.height;e.width=n,e.height=r,e.getContext("2d").drawImage(t,0,0,n,r)}(t,r):bp(t,e,r),r}function vp(t,e){var n=gp(e);return function(t,e){e.width=t.width,e.height=t.height,e.getContext("2d").putImageData(t,0,0)}(t,n),n}function xp(t,e,n,r,s){if(void 0===e&&(e={r:0,g:0,b:0,a:0}),void 0===n&&(n={r:0,g:0,b:0,a:255}),void 0===r&&(r=!1),void 0===s&&(s=[1]),Array.isArray(t)&&0===t.length)return null;var o,i=(o=Array.isArray(t)?t:[t])[0],a=i.width,u=i.height,c=new Uint8ClampedArray(a*u*4);function l(t,e,n,r,s,o){void 0===o&&(o={r:0,g:255,b:255,a:255});for(var i=-s;i<=s;i++)for(var a=-s;a<=s;a++)if(0!==i&&0!==a){var u=(e+i)*r+(n+a);t[4*u+0]=o.r,t[4*u+1]=o.g,t[4*u+2]=o.b,t[4*u+3]=o.a}}function f(t,e,n,r,s,o){void 0===s&&(s=[1]),void 0===o&&(o=1);for(var i=0,a=-o;a<=o;a++)for(var u=function(o){if(0!==a&&0!==o){var u=(e+a)*r+(n+o);s.some((function(e){return e===t[u]}))||(i+=1)}},c=-o;c<=o;c++)u(c);return i>0}for(var h=0;h<u;h+=1)for(var p=function(t){var i=h*a+t;c[4*i+0]=n.r,c[4*i+1]=n.g,c[4*i+2]=n.b,c[4*i+3]=n.a;for(var p=function(n){if(s.some((function(t){return t===o[n].data[i]}))){c[4*i]=e.r,c[4*i+1]=e.g,c[4*i+2]=e.b,c[4*i+3]=e.a;var p=f(o[n].data,h,t,a,s);r&&h-1>=0&&h+1<u&&t-1>=0&&t+1<a&&p&&l(c,h,t,a,1)}},d=0;d<o.length;d++)p(d)},d=0;d<a;d+=1)p(d);return new ImageData(c,a,u)}var Np=[[110,64,170],[143,61,178],[178,60,178],[210,62,167],[238,67,149],[255,78,125],[255,94,99],[255,115,75],[255,140,56],[239,167,47],[217,194,49],[194,219,64],[175,240,91],[135,245,87],[96,247,96],[64,243,115],[40,234,141],[28,219,169],[26,199,194],[33,176,213],[47,150,224],[65,125,224],[84,101,214],[99,81,195]];var $p="blurred",Ep="blurred-mask",Sp="mask",_p="lowres-part-mask";var Tp=Object.freeze({__proto__:null,BodyPix:lp,load:function(t){return void 0===t&&(t=ep),sh(this,void 0,void 0,(function(){return oh(this,(function(e){return"ResNet50"===(t=function(t){if(null==(t=t||ep).architecture&&(t.architecture="MobileNetV1"),np.indexOf(t.architecture)<0)throw new Error("Invalid architecture "+t.architecture+". Should be one of "+np);if(null==t.outputStride&&(t.outputStride=16),rp[t.architecture].indexOf(t.outputStride)<0)throw new Error("Invalid outputStride "+t.outputStride+". Should be one of "+rp[t.architecture]+" for architecture "+t.architecture+".");if(null==t.multiplier&&(t.multiplier=1),sp[t.architecture].indexOf(t.multiplier)<0)throw new Error("Invalid multiplier "+t.multiplier+". Should be one of "+sp[t.architecture]+" for architecture "+t.architecture+".");if(null==t.quantBytes&&(t.quantBytes=4),op.indexOf(t.quantBytes)<0)throw new Error("Invalid quantBytes "+t.quantBytes+". Should be one of "+op+" for architecture "+t.architecture+".");return t}(t)).architecture?[2,hp(t)]:"MobileNetV1"===t.architecture?[2,fp(t)]:[2,null]}))}))},blurBodyPart:function(t,e,n,r,s,o,i){void 0===r&&(r=[0,1]),void 0===s&&(s=3),void 0===o&&(o=3),void 0===i&&(i=!1);var a=wp(e,s,$p);t.width=a.width,t.height=a.height;var u=t.getContext("2d");if(Array.isArray(n)&&0===n.length)u.drawImage(a,0,0);else{var c=function(t,e,n){var r=vp(xp(t,{r:0,g:0,b:0,a:0},{r:0,g:0,b:0,a:255},!0,e),Sp);return 0===n?r:wp(r,n,Ep)}(n,r,o);u.save(),i&&mp(t);var l=Gh(e),f=l[0],h=l[1];u.drawImage(e,0,0,h,f),yp(u,c,"destination-in"),yp(u,a,"destination-over"),u.restore()}},drawBokehEffect:function(t,e,n,r,s,o){void 0===r&&(r=3),void 0===s&&(s=3),void 0===o&&(o=!1);var i=wp(e,r,$p);t.width=i.width,t.height=i.height;var a=t.getContext("2d");if(Array.isArray(n)&&0===n.length)a.drawImage(i,0,0);else{var u=function(t,e){var n=vp(xp(t,{r:0,g:0,b:0,a:255},{r:0,g:0,b:0,a:0}),Sp);return 0===e?n:wp(n,e,Ep)}(n,s);a.save(),o&&mp(t);var c=Gh(e),l=c[0],f=c[1];a.drawImage(e,0,0,f,l),yp(a,u,"destination-in"),yp(a,i,"destination-over"),a.restore()}},drawMask:function(t,e,n,r,s,o){void 0===r&&(r=.7),void 0===s&&(s=0),void 0===o&&(o=!1);var i=Gh(e),a=i[0],u=i[1];t.width=u,t.height=a;var c=t.getContext("2d");if(c.save(),o&&mp(t),c.drawImage(e,0,0),c.globalAlpha=r,n){dp({width:u,height:a},n,"image","mask");var l=wp(vp(n,Sp),s,Ep);c.drawImage(l,0,0,u,a)}c.restore()},drawPixelatedMask:function(t,e,n,r,s,o,i){void 0===r&&(r=.7),void 0===s&&(s=0),void 0===o&&(o=!1),void 0===i&&(i=10);var a=Gh(e),u=a[0];dp({width:a[1],height:u},n,"image","mask");var c=wp(vp(n,Sp),s,Ep);t.width=c.width,t.height=c.height;var l=t.getContext("2d");l.save(),o&&mp(t);var f=gp(_p),h=f.getContext("2d");f.width=c.width*(1/i),f.height=c.height*(1/i),h.drawImage(c,0,0,c.width,c.height,0,0,f.width,f.height),l.imageSmoothingEnabled=!1,l.drawImage(f,0,0,f.width,f.height,0,0,t.width,t.height);for(var p=0;p<f.width;p++)l.beginPath(),l.strokeStyle="#ffffff",l.moveTo(i*p,0),l.lineTo(i*p,t.height),l.stroke();for(p=0;p<f.height;p++)l.beginPath(),l.strokeStyle="#ffffff",l.moveTo(0,i*p),l.lineTo(t.width,i*p),l.stroke();l.globalAlpha=1-r,l.drawImage(e,0,0,c.width,c.height),l.restore()},toColoredPartMask:function(t,e){if(void 0===e&&(e=Np),Array.isArray(t)&&0===t.length)return null;for(var n,r=(n=Array.isArray(t)?t:[t])[0],s=r.width,o=r.height,i=new Uint8ClampedArray(s*o*4),a=0;a<o*s;++a){var u=4*a;i[u+0]=255,i[u+1]=255,i[u+2]=255,i[u+3]=255;for(var c=0;c<n.length;c++){var l=n[c].data[a];if(-1!==l){var f=e[l];if(!f)throw new Error("No color could be found for part id "+l);i[u+0]=f[0],i[u+1]=f[1],i[u+2]=f[2],i[u+3]=255}}}return new ImageData(i,s,o)},toMask:xp,PART_CHANNELS:["left_face","right_face","left_upper_arm_front","left_upper_arm_back","right_upper_arm_front","right_upper_arm_back","left_lower_arm_front","left_lower_arm_back","right_lower_arm_front","right_lower_arm_back","left_hand","right_hand","torso_front","torso_back","left_upper_leg_front","left_upper_leg_back","right_upper_leg_front","right_upper_leg_back","left_lower_leg_front","left_lower_leg_back","right_lower_leg_front","right_lower_leg_back","left_feet","right_feet"],flipPoseHorizontal:Qh,resizeAndPadTo:function(t,e,n){var r=e[0],s=e[1];void 0===n&&(n=!1);var o,i,a,u,c,l,f=t.shape,h=f[0],p=f[1]/h;if(p>s/r){o=s;var d=r-(i=Math.ceil(o/p));a=0,u=0,c=Math.floor(d/2),l=r-(i+c)}else{i=r;var m=s-(o=Math.ceil(r*p));a=Math.floor(m/2),u=s-(o+a),c=0,l=0}return{resizedAndPadded:fs((function(){var e;return e=n?gl.resizeBilinear(mu(t,1),[i,o]):gl.resizeBilinear(t,[i,o]),Fa(e,[[c,l],[a,u],[0,0]])})),paddedBy:[[c,l],[a,u]]}},scaleAndCropToInputTensorShape:Jh,version:"2.2.0"});function kp(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(n){if("default"!==n&&!(n in t)){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}))})),Object.freeze(t)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ap{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class Cp{refCount(t){return Op("refCount")}incRef(t){return Op("incRef")}timerAvailable(){return!0}time(t){return Op("time")}read(t){return Op("read")}readSync(t){return Op("readSync")}readToGPU(t,e){return Op("readToGPU")}numDataIds(){return Op("numDataIds")}disposeData(t,e){return Op("disposeData")}write(t,e,n){return Op("write")}move(t,e,n,r,s){return Op("move")}memory(){return Op("memory")}floatPrecision(){return Op("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return Op("dispose")}}function Op(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function Ip(t,e,n){return Math.max(t,Math.min(e,n))}function Mp(t){return t%2==0?t:t+1}function Rp(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function Dp(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function Fp(t,e,n=""){Dp(Vp(t,e),(()=>n+` Shapes ${t} and ${e} must match`))}function Lp(t){Dp(null!=t,(()=>"The input to the tensor constructor must be a non-null value."))}function Pp(t,e=[],n=!1){if(null==e&&(e=[]),Array.isArray(t)||Xp(t)&&!n)for(let r=0;r<t.length;++r)Pp(t[r],e,n);else e.push(t);return e}function Bp(t){if(0===t.length)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function Vp(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function zp(t){return t%1==0}function Wp(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function Up(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function jp(t,e=(t=>0),n){return new Promise(((r,s)=>{let o=0;const i=()=>{if(t())return void r();o++;const a=e(o);null!=n&&o>=n?s():setTimeout(i,a)};i()}))}function Gp(t,e){const n=e.length;return t=null==t?e.map(((t,e)=>e)):[].concat(t),Dp(t.every((t=>t>=-n&&t<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`)),Dp(t.every((t=>zp(t))),(()=>`All values in axis param must be integers but got axis ${t}`)),t.map((t=>t<0?n+t:t))}function qp(t,e){const n=[],r=[],s=null!=e&&Array.isArray(e)&&0===e.length,o=null==e||s?null:Gp(e,t).sort();let i=0;for(let e=0;e<t.length;++e){if(null!=o){if(o[i]===e&&1!==t[e])throw new Error(`Can't squeeze axis ${e} since its dim '${t[e]}' is not 1`);(null==o[i]||o[i]>e)&&1===t[e]&&(n.push(t[e]),r.push(e)),o[i]<=e&&i++}1!==t[e]&&(n.push(t[e]),r.push(e))}return{newShape:n,keptDims:r}}function Hp(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error(`Unknown data type ${t}`);n=new Uint8Array(e)}return n}function Kp(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error(`Unknown data type ${t}`);n=new Array(e)}return n}function Xp(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function Jp(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error(`Unknown dtype ${t}`)}function Yp(t){return"string"==typeof t||t instanceof String}function Zp(t){return Array.isArray(t)?Zp(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":"number"==typeof t?"float32":Yp(t)?"string":function(t){return"boolean"==typeof t}(t)?"bool":"float32"}function Qp(t){return!!(t&&t.constructor&&t.call&&t.apply)}function td(t,e){for(let n=e;n<t;++n)if(t%n==0)return n;return t}function ed(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function nd(t,e,n,r=!1){const s=new Array;if(1===e.length){const o=e[0]*(r?2:1);for(let e=0;e<o;e++)s[e]=n[t+e]}else{const o=e[0],i=e.slice(1),a=i.reduce(((t,e)=>t*e))*(r?2:1);for(let e=0;e<o;e++)s[e]=nd(t+e*a,i,n,r)}return s}function rd(t,e,n=!1){if(0===t.length)return e[0];const r=t.reduce(((t,e)=>t*e))*(n?2:1);if(0===r)return[];if(r!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return nd(0,t,e,n)}function sd(t,e){const n=od(t,e);for(let t=0;t<n.length;t++)n[t]=1;return n}function od(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function id(t){t.forEach((e=>{Dp(Number.isInteger(e)&&e>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`))}))}function ad(t,e,n){if(0===e)return 0;if(1===e)return t[0];let r=t[t.length-1];for(let e=0;e<t.length-1;++e)r+=n[e]*t[e];return r}function ud(t,e,n){if(0===e)return[];if(1===e)return[t];const r=new Array(e);for(let e=0;e<r.length-1;++e)r[e]=Math.floor(t/n[e]),t-=r[e]*n[e];return r[r.length-1]=t,r}function cd(t){return t&&t.then&&"function"==typeof t.then}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ld{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=fd,this.populateURLFlags()}setPlatform(t,e){null!=this.platform&&(hd().getBool("IS_TEST")||hd().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=e}registerFlag(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){const e=this.urlFlags[t];hd().getBool("IS_TEST")||hd().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${e}.`),this.set(t,e)}}async getAsync(t){return t in this.flags||(this.flags[t]=await this.evaluateFlag(t)),this.flags[t]}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(cd(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(null==this.flagRegistry[t])throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(null==this.flagRegistry[t])throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const t=this.getQueryParams(this.global.location.search);if("tfjsflags"in t){t.tfjsflags.split(",").forEach((t=>{const[e,n]=t.split(":");this.urlFlags[e]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}(e,n)}))}}}function fd(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((t,...n)=>(function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")))),e}function hd(){return pd}let pd=null;var dd="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function md(){throw new Error("setTimeout has not been defined")}function yd(){throw new Error("clearTimeout has not been defined")}var gd=md,bd=yd;function wd(t){if(gd===setTimeout)return setTimeout(t,0);if((gd===md||!gd)&&setTimeout)return gd=setTimeout,setTimeout(t,0);try{return gd(t,0)}catch(e){try{return gd.call(null,t,0)}catch(e){return gd.call(this,t,0)}}}"function"==typeof dd.setTimeout&&(gd=setTimeout),"function"==typeof dd.clearTimeout&&(bd=clearTimeout);var vd,xd=[],Nd=!1,$d=-1;function Ed(){Nd&&vd&&(Nd=!1,vd.length?xd=vd.concat(xd):$d=-1,xd.length&&Sd())}function Sd(){if(!Nd){var t=wd(Ed);Nd=!0;for(var e=xd.length;e;){for(vd=xd,xd=[];++$d<e;)vd&&vd[$d].run();$d=-1,e=xd.length}vd=null,Nd=!1,function(t){if(bd===clearTimeout)return clearTimeout(t);if((bd===yd||!bd)&&clearTimeout)return bd=clearTimeout,clearTimeout(t);try{bd(t)}catch(e){try{return bd.call(null,t)}catch(e){return bd.call(this,t)}}}(t)}}function _d(t,e){this.fun=t,this.array=e}_d.prototype.run=function(){this.fun.apply(null,this.array)};function Td(){}var kd=Td,Ad=Td,Cd=Td,Od=Td,Id=Td,Md=Td,Rd=Td;var Dd=dd.performance||{},Fd=Dd.now||Dd.mozNow||Dd.msNow||Dd.oNow||Dd.webkitNow||function(){return(new Date).getTime()};var Ld=new Date;var Pd={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];xd.push(new _d(t,e)),1!==xd.length||Nd||wd(Sd)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:kd,addListener:Ad,once:Cd,off:Od,removeListener:Id,removeAllListeners:Md,emit:Rd,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*Fd.call(Dd),n=Math.floor(e),r=Math.floor(e%1*1e9);return t&&(n-=t[0],(r-=t[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-Ld)/1e3}},Bd=Pd;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
let Vd;function zd(){if(null==Vd){let t;if("undefined"!=typeof window)t=window;else if(void 0!==dd)t=dd;else if(void 0!==Bd)t=Bd;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}Vd=t}return Vd}function Wd(t,e){const n=function(){const t=zd();return null==t._tfGlobals&&(t._tfGlobals=new Map),t._tfGlobals}();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ud(...t){hd().getBool("IS_TEST")||hd().getBool("PROD")||console.warn(...t)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const jd=Wd("kernelRegistry",(()=>new Map)),Gd=Wd("gradRegistry",(()=>new Map));function qd(t,e){const n=Jd(t,e);return jd.get(n)}function Hd(t){return Gd.get(t)}function Kd(t){const e=jd.entries(),n=[];for(;;){const{done:r,value:s}=e.next();if(r)break;const[o,i]=s,[a]=o.split("_");a===t&&n.push(i)}return n}function Xd(t){const{kernelName:e,backendName:n}=t,r=Jd(e,n);jd.has(r)&&Ud(`The kernel '${e}' for backend '${n}' is already registered`),jd.set(r,t)}function Jd(t,e){return`${e}_${t}`}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function Yd(t){if(t.q)return t;var e=Object.defineProperty({},"q",{value:!0});return Object.keys(t).forEach((function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})})),e}var Zd=tm,Qd=null;try{Qd=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(Wot){}function tm(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function em(t){return!0===(t&&t._)}tm.prototype._,Object.defineProperty(tm.prototype,"_",{value:!0}),tm.isLong=em;var nm={},rm={};function sm(t,e){var n,r,s;return e?(s=0<=(t>>>=0)&&t<256)&&(r=rm[t])?r:(n=im(t,(0|t)<0?-1:0,!0),s&&(rm[t]=n),n):(s=-128<=(t|=0)&&t<128)&&(r=nm[t])?r:(n=im(t,t<0?-1:0,!1),s&&(nm[t]=n),n)}function om(t,e){if(isNaN(t))return e?mm:dm;if(e){if(t<0)return mm;if(t>=fm)return vm}else{if(t<=-hm)return xm;if(t+1>=hm)return wm}return t<0?om(-t,e).neg():im(t%lm|0,t/lm|0,e)}function im(t,e,n){return new tm(t,e,n)}tm.fromInt=sm,tm.fromNumber=om,tm.fromBits=im;var am=Math.pow;function um(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return dm;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return um(t.substring(1),e,n).neg();for(var s=om(am(n,8)),o=dm,i=0;i<t.length;i+=8){var a=Math.min(8,t.length-i),u=parseInt(t.substring(i,i+a),n);if(a<8){var c=om(am(n,a));o=o.mul(c).add(om(u))}else o=(o=o.mul(s)).add(om(u))}return o.unsigned=e,o}function cm(t,e){return"number"==typeof t?om(t,e):"string"==typeof t?um(t,e):im(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}tm.fromString=um,tm.fromValue=cm;var lm=4294967296,fm=lm*lm,hm=fm/2,pm=sm(1<<24),dm=sm(0);tm.ZERO=dm;var mm=sm(0,!0);tm.UZERO=mm;var ym=sm(1);tm.ONE=ym;var gm=sm(1,!0);tm.UONE=gm;var bm=sm(-1);tm.NEG_ONE=bm;var wm=im(-1,2147483647,!1);tm.MAX_VALUE=wm;var vm=im(-1,-1,!0);tm.MAX_UNSIGNED_VALUE=vm;var xm=im(0,-2147483648,!1);tm.MIN_VALUE=xm;var Nm=tm.prototype;Nm.toInt=function(){return this.unsigned?this.low>>>0:this.low},Nm.toNumber=function(){return this.unsigned?(this.high>>>0)*lm+(this.low>>>0):this.high*lm+(this.low>>>0)},Nm.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(xm)){var e=om(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var s=om(am(t,6),this.unsigned),o=this,i="";;){var a=o.div(s),u=(o.sub(a.mul(s)).toInt()>>>0).toString(t);if((o=a).isZero())return u+i;for(;u.length<6;)u="0"+u;i=""+u+i}},Nm.getHighBits=function(){return this.high},Nm.getHighBitsUnsigned=function(){return this.high>>>0},Nm.getLowBits=function(){return this.low},Nm.getLowBitsUnsigned=function(){return this.low>>>0},Nm.getNumBitsAbs=function(){if(this.isNegative())return this.eq(xm)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},Nm.isZero=function(){return 0===this.high&&0===this.low},Nm.eqz=Nm.isZero,Nm.isNegative=function(){return!this.unsigned&&this.high<0},Nm.isPositive=function(){return this.unsigned||this.high>=0},Nm.isOdd=function(){return 1==(1&this.low)},Nm.isEven=function(){return 0==(1&this.low)},Nm.equals=function(t){return em(t)||(t=cm(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},Nm.eq=Nm.equals,Nm.notEquals=function(t){return!this.eq(t)},Nm.neq=Nm.notEquals,Nm.ne=Nm.notEquals,Nm.lessThan=function(t){return this.comp(t)<0},Nm.lt=Nm.lessThan,Nm.lessThanOrEqual=function(t){return this.comp(t)<=0},Nm.lte=Nm.lessThanOrEqual,Nm.le=Nm.lessThanOrEqual,Nm.greaterThan=function(t){return this.comp(t)>0},Nm.gt=Nm.greaterThan,Nm.greaterThanOrEqual=function(t){return this.comp(t)>=0},Nm.gte=Nm.greaterThanOrEqual,Nm.ge=Nm.greaterThanOrEqual,Nm.compare=function(t){if(em(t)||(t=cm(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},Nm.comp=Nm.compare,Nm.negate=function(){return!this.unsigned&&this.eq(xm)?xm:this.not().add(ym)},Nm.neg=Nm.negate,Nm.add=function(t){em(t)||(t=cm(t));var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,o=t.high>>>16,i=65535&t.high,a=t.low>>>16,u=0,c=0,l=0,f=0;return l+=(f+=s+(65535&t.low))>>>16,c+=(l+=r+a)>>>16,u+=(c+=n+i)>>>16,u+=e+o,im((l&=65535)<<16|(f&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},Nm.subtract=function(t){return em(t)||(t=cm(t)),this.add(t.neg())},Nm.sub=Nm.subtract,Nm.multiply=function(t){if(this.isZero())return dm;if(em(t)||(t=cm(t)),Qd)return im(Qd.mul(this.low,this.high,t.low,t.high),Qd.get_high(),this.unsigned);if(t.isZero())return dm;if(this.eq(xm))return t.isOdd()?xm:dm;if(t.eq(xm))return this.isOdd()?xm:dm;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(pm)&&t.lt(pm))return om(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,o=t.high>>>16,i=65535&t.high,a=t.low>>>16,u=65535&t.low,c=0,l=0,f=0,h=0;return f+=(h+=s*u)>>>16,l+=(f+=r*u)>>>16,f&=65535,l+=(f+=s*a)>>>16,c+=(l+=n*u)>>>16,l&=65535,c+=(l+=r*a)>>>16,l&=65535,c+=(l+=s*i)>>>16,c+=e*u+n*a+r*i+s*o,im((f&=65535)<<16|(h&=65535),(c&=65535)<<16|(l&=65535),this.unsigned)},Nm.mul=Nm.multiply,Nm.divide=function(t){if(em(t)||(t=cm(t)),t.isZero())throw Error("division by zero");var e,n,r;if(Qd)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?im((this.unsigned?Qd.div_u:Qd.div_s)(this.low,this.high,t.low,t.high),Qd.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?mm:dm;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return mm;if(t.gt(this.shru(1)))return gm;r=mm}else{if(this.eq(xm))return t.eq(ym)||t.eq(bm)?xm:t.eq(xm)?ym:(e=this.shr(1).div(t).shl(1)).eq(dm)?t.isNegative()?ym:bm:(n=this.sub(t.mul(e)),r=e.add(n.div(t)));if(t.eq(xm))return this.unsigned?mm:dm;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=dm}for(n=this;n.gte(t);){e=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(e)/Math.LN2),o=s<=48?1:am(2,s-48),i=om(e),a=i.mul(t);a.isNegative()||a.gt(n);)a=(i=om(e-=o,this.unsigned)).mul(t);i.isZero()&&(i=ym),r=r.add(i),n=n.sub(a)}return r},Nm.div=Nm.divide,Nm.modulo=function(t){return em(t)||(t=cm(t)),Qd?im((this.unsigned?Qd.rem_u:Qd.rem_s)(this.low,this.high,t.low,t.high),Qd.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},Nm.mod=Nm.modulo,Nm.rem=Nm.modulo,Nm.not=function(){return im(~this.low,~this.high,this.unsigned)},Nm.and=function(t){return em(t)||(t=cm(t)),im(this.low&t.low,this.high&t.high,this.unsigned)},Nm.or=function(t){return em(t)||(t=cm(t)),im(this.low|t.low,this.high|t.high,this.unsigned)},Nm.xor=function(t){return em(t)||(t=cm(t)),im(this.low^t.low,this.high^t.high,this.unsigned)},Nm.shiftLeft=function(t){return em(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?im(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):im(0,this.low<<t-32,this.unsigned)},Nm.shl=Nm.shiftLeft,Nm.shiftRight=function(t){return em(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?im(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):im(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},Nm.shr=Nm.shiftRight,Nm.shiftRightUnsigned=function(t){if(em(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?im(this.low>>>t|e<<32-t,e>>>t,this.unsigned):im(32===t?e:e>>>t-32,0,this.unsigned)},Nm.shru=Nm.shiftRightUnsigned,Nm.shr_u=Nm.shiftRightUnsigned,Nm.toSigned=function(){return this.unsigned?im(this.low,this.high,!1):this},Nm.toUnsigned=function(){return this.unsigned?this:im(this.low,this.high,!0)},Nm.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},Nm.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},Nm.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},tm.fromBytes=function(t,e,n){return n?tm.fromBytesLE(t,e):tm.fromBytesBE(t,e)},tm.fromBytesLE=function(t,e){return new tm(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},tm.fromBytesBE=function(t,e){return new tm(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const $m=Zd||kp({__proto__:null,default:Zd},[Zd]);function Em(t){return $m.fromString(t,!0,16)}const Sm=Em("c3a5c85c97cb3127"),_m=Em("b492b66fbe98f273"),Tm=Em("9ae16a3b2f90404f");function km(t){return t.xor(t.shru(47))}function Am(t,e,n){const r=t.slice(e,e+n);return $m.fromBytes(Array.from(r),!0,!0)}function Cm(t,e){return Am(t,e,8)}function Om(t,e){return Am(t,e,4)}function Im(t,e){return 0===e?t:t.shru(e).or(t.shl(64-e))}function Mm(t,e,n=Em("9ddfea08eb382d69")){let r=t.xor(e).mul(n);r=r.xor(r.shru(47));let s=e.xor(r).mul(n);return s=s.xor(s.shru(47)),s=s.mul(n),s}function Rm(t,e,n,r){return function(t,e,n,r,s,o){s=s.add(t),o=Im(o.add(s).add(r),21);const i=s;return s=(s=s.add(e)).add(n),o=o.add(Im(s,44)),[s.add(r),o.add(i)]}(Cm(t,e),Cm(t,e+8),Cm(t,e+16),Cm(t,e+24),n,r)}function Dm(t,e=t.length){const n=$m.fromNumber(81,!0);if(e<=32)return e<=16?function(t,e=t.length){if(e>=8){const n=Tm.add(2*e),r=Cm(t,0).add(Tm),s=Cm(t,e-8);return Mm(Im(s,37).mul(n).add(r),Im(r,25).add(s).mul(n),n)}if(e>=4){const n=Tm.add(2*e);return Mm(Om(t,0).shl(3).add(e),Om(t,e-4),n)}if(e>0){const n=t[0]+(t[e>>1]<<8),r=e+(t[e-1]<<2);return km(Tm.mul(n).xor(Sm.mul(r))).mul(Tm)}return Tm}(t,e):function(t,e=t.length){const n=Tm.add(2*e),r=Cm(t,0).mul(_m),s=Cm(t,8),o=Cm(t,e-8).mul(n),i=Cm(t,e-16).mul(Tm);return Mm(Im(r.add(s),43).add(Im(o,30)).add(i),r.add(Im(s.add(Tm),18)).add(o),n)}(t,e);if(e<=64)return function(t,e=t.length){const n=Tm.add(2*e),r=Cm(t,0).mul(Tm),s=Cm(t,8),o=Cm(t,e-8).mul(n),i=Cm(t,e-16).mul(Tm),a=Im(r.add(s),43).add(Im(o,30)).add(i),u=Mm(a,r.add(Im(s.add(Tm),18)).add(o),n),c=Cm(t,16).mul(n),l=Cm(t,24),f=a.add(Cm(t,e-32)).mul(n),h=u.add(Cm(t,e-24)).mul(n);return Mm(Im(c.add(l),43).add(Im(f,30)).add(h),c.add(Im(l.add(r),18)).add(f),n)}(t,e);let r=n,s=n.mul(_m).add(113),o=km(s.mul(Tm).add(113)).mul(Tm),i=[$m.UZERO,$m.UZERO],a=[$m.UZERO,$m.UZERO];r=r.mul(Tm).add(Cm(t,0));let u=0;const c=64*(e-1>>6),l=c+(e-1&63)-63;do{r=Im(r.add(s).add(i[0]).add(Cm(t,u+8)),37).mul(_m),s=Im(s.add(i[1]).add(Cm(t,u+48)),42).mul(_m),r=r.xor(a[1]),s=s.add(i[0]).add(Cm(t,u+40)),o=Im(o.add(a[0]),33).mul(_m),i=Rm(t,u,i[1].mul(_m),r.add(a[0])),a=Rm(t,u+32,o.add(a[1]),s.add(Cm(t,u+16))),[o,r]=[r,o],u+=64}while(u!==c);const f=_m.add(o.and(255).shl(1));return u=l,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),r=Im(r.add(s).add(i[0]).add(Cm(t,u+8)),37).mul(f),s=Im(s.add(i[1]).add(Cm(t,u+48)),42).mul(f),r=r.xor(a[1].mul(9)),s=s.add(i[0].mul(9).add(Cm(t,u+40))),o=Im(o.add(a[0]),33).mul(f),i=Rm(t,u,i[1].mul(f),r.add(a[0])),a=Rm(t,u+32,o.add(a[1]),s.add(Cm(t,u+16))),[o,r]=[r,o],Mm(Mm(i[0],a[0],f).add(km(s).mul(Sm)).add(o),Mm(i[1],a[1],f).add(r),f)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fm(t,e){return"string"===e?Bm(t):Lm([t],e)}function Lm(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Pp(t)),hd().getBool("DEBUG")&&function(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){const e=new Uint8Array(t.length);for(let n=0;n<e.length;++n)0!==Math.round(t[n])&&(e[n]=1);return e}throw new Error(`Unknown data type ${e}`)}function Pm(){return hd().platform.now()}function Bm(t,e="utf-8"){return e=e||"utf-8",hd().platform.encode(t,e)}function Vm(t,e="utf-8"){return e=e||"utf-8",hd().platform.decode(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zm{constructor(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new Um)}profileKernel(t,e,n){let r;const s=()=>{r=n()};let o;const i=Pm();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(s);else{s();for(const t of r)t.dataSync();o=Promise.resolve({kernelMs:Pm()-i})}if(hd().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let e=0;e<r.length;e++){const n=r[e];n.data().then((e=>{Wm(e,n.dtype,t)}))}return{kernelName:t,outputs:r,inputs:e,timeMs:o.then((t=>t.kernelMs)),extraInfo:o.then((t=>null!=t.getExtraProfileInfo?t.getExtraProfileInfo():""))}}logKernelProfile(t){const{kernelName:e,outputs:n,timeMs:r,inputs:s,extraInfo:o}=t;n.forEach((t=>{Promise.all([t.data(),r,o]).then((n=>{this.logger.logKernelProfile(e,t,n[0],n[1],s,n[2])}))}))}}function Wm(t,e,n){if("float32"!==e)return!1;for(let e=0;e<t.length;e++){const r=t[e];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class Um{logKernelProfile(t,e,n,r,s,o){const i="number"==typeof r?Up(`${r}ms`,9):r.error,a=Up(t,25),u=e.rank,c=e.size,l=Up(e.shape.toString(),14);let f="";for(const t in s){const n=s[t];if(null!=n){const r=n.shape||e.shape,s=r.length;f+=`${t}: ${s}D ${s>0?r:""} `}}console.log(`%c${a}\t%c${i}\t%c${u}D ${l}\t%c${c}\t%c${f}\t%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jm(t,e,n,r){const s=ed(e),o=function(t,e,n,r){const s=Bp(e),o=r[r.length-1],i=new Array(o).fill(0),a=e.length,u="complex64"===n?Km(t):t;if(a>1)for(let t=0;t<s/o;t++){const e=t*o;for(let t=0;t<o;t++)i[t]=Math.max(i[t],Gm(u[e+t],0,n).length)}return i}(t,e,n,s),i=e.length,a=Hm(t,e,n,s,o),u=["Tensor"];return r&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${i}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(a.map((t=>"    "+t)).join("\n")),u.join("\n")}function Gm(t,e,n){let r;return r=Array.isArray(t)?`${parseFloat(t[0].toFixed(7))} + ${parseFloat(t[1].toFixed(7))}j`:Yp(t)?`'${t}'`:"bool"===n?qm(t):parseFloat(t.toFixed(7)).toString(),Up(r,e)}function qm(t){return 0===t?"false":"true"}function Hm(t,e,n,r,s,o=!0){const i="complex64"===n?2:1,a=e[0],u=e.length;if(0===u){if("complex64"===n){return[Gm(Km(t)[0],0,n)]}return"bool"===n?[qm(t[0])]:[t[0].toString()]}if(1===u){if(a>20){const e=3*i;let r=Array.from(t.slice(0,e)),o=Array.from(t.slice((a-3)*i,a*i));return"complex64"===n&&(r=Km(r),o=Km(o)),["["+r.map(((t,e)=>Gm(t,s[e],n))).join(", ")+", ..., "+o.map(((t,e)=>Gm(t,s[a-3+e],n))).join(", ")+"]"]}return["["+("complex64"===n?Km(t):Array.from(t)).map(((t,e)=>Gm(t,s[e],n))).join(", ")+"]"]}const c=e.slice(1),l=r.slice(1),f=r[0]*i,h=[];if(a>20){for(let e=0;e<3;e++){const r=e*f,o=r+f;h.push(...Hm(t.slice(r,o),c,n,l,s,!1))}h.push("...");for(let e=a-3;e<a;e++){const r=e*f,o=r+f;h.push(...Hm(t.slice(r,o),c,n,l,s,e===a-1))}}else for(let e=0;e<a;e++){const r=e*f,o=r+f;h.push(...Hm(t.slice(r,o),c,n,l,s,e===a-1))}const p=2===u?",":"";h[0]="["+h[0]+p;for(let t=1;t<h.length-1;t++)h[t]=" "+h[t]+p;let d=",\n";for(let t=2;t<u;t++)d+="\n";return h[h.length-1]=" "+h[h.length-1]+"]"+(o?"":d),h}function Km(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xm{constructor(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=Bp(t),null!=n){const t=n.length;Dp(t===this.size,(()=>`Length of values '${t}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Kp(e,this.size),this.strides=ed(t)}set(t,...e){0===e.length&&(e=[0]),Dp(e.length===this.rank,(()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`));const n=this.locToIndex(e);this.values[n]=t}get(...t){0===t.length&&(t=[0]);let e=0;for(const n of t){if(n<0||n>=this.shape[e]){const e=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(e)}e++}let n=t[t.length-1];for(let e=0;e<t.length-1;++e)n+=this.strides[e]*t[e];return this.values[n]}locToIndex(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];let e=t[t.length-1];for(let n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e}indexToLoc(t){if(0===this.rank)return[];if(1===this.rank)return[t];const e=new Array(this.shape.length);for(let n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return Jm().makeTensor(this.values,this.shape,this.dtype)}}let Jm=null,Ym=null;class Zm{constructor(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=Bp(t),this.strides=ed(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return Ym.buffer(this.shape,this.dtype,t)}bufferSync(){return Ym.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return rd(this.shape,t,"complex64"===this.dtype)}arraySync(){return rd(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const t=Jm().read(this.dataId);if("string"===this.dtype){const e=await t;try{return e.map((t=>Vm(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),Jm().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=Jm().readSync(this.dataId);if("string"===this.dtype)try{return t.map((t=>Vm(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await Jm().read(this.dataId);return"string"===this.dtype?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(Jm().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return Ym.print(this,t)}clone(){return this.throwIfDisposed(),Ym.clone(this)}toString(t=!1){return jm(this.dataSync(),this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),Ym.cast(this,t)}variable(t=!0,e,n){return this.throwIfDisposed(),Jm().makeVariable(this,t,e,n)}}Object.defineProperty(Zm,Symbol.hasInstance,{value:t=>!!t&&null!=t.data&&null!=t.dataSync&&null!=t.throwIfDisposed}),Wd("Tensor",(()=>Zm));class Qm extends Zm{constructor(t,e,n,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=e,this.name=n}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!Vp(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);Jm().disposeTensor(this),this.dataId=t.dataId,Jm().incRef(this,null)}dispose(){Jm().disposeVariable(this),this.isDisposedInternal=!0}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var ty,ey,ny,ry,sy;Object.defineProperty(Qm,Symbol.hasInstance,{value:t=>t instanceof Zm&&null!=t.assign&&t.assign instanceof Function}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(ty||(ty={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(ey||(ey={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(ny||(ny={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(ry||(ry={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(sy||(sy={}));const oy={float32:ry,int32:ey,bool:ny,complex64:sy};function iy(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return oy[t][e]}function ay(t){return iy(t,"int32")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uy(t,e){if(t.dtype===e.dtype)return[t,e];const n=iy(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function cy(t){const e=[];return ly(t,e,new Set),e}function ly(t,e,n){if(null==t)return;if(t instanceof Zm)return void e.push(t);if(r=t,!Array.isArray(r)&&"object"!=typeof r)return;var r;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s=t;for(const t in s){const r=s[t];n.has(r)||(n.add(r),ly(r,e,n))}}function fy(t){return null!=t.kernelName}class hy{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((t=>t.name))))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class py{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new hy}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;{const{asyncInit:e}=this.initializeBackend(t);if(e)return null}}return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,n=1){return t in this.registryFactory?(Ud(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:n},!0)}async setBackend(t){if(null==this.registryFactory[t])throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,null==this.registry[t]){this.backendInstance=null;const{success:e,asyncInit:n}=this.initializeBackend(t);if(!(n?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new zm(this.backendInstance),!0}setupRegisteredKernels(){Kd(this.backendName).forEach((t=>{null!=t.setupFunc&&t.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(t){Kd(t).forEach((e=>{null!=e.disposeFunc&&e.disposeFunc(this.registry[t])}))}initializeBackend(t){const e=this.registryFactory[t];if(null==e)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const n=e.factory();if(!n||n instanceof Cp||"function"!=typeof n.then)return this.registry[t]=n,{success:!0,asyncInit:!1};{const e=++this.pendingBackendInitId,r=n.then((n=>!(e<this.pendingBackendInitId)&&(this.registry[t]=n,this.pendingBackendInit=null,!0))).catch((n=>(e<this.pendingBackendInitId||(this.pendingBackendInit=null,Ud(`Initialization of backend ${t} failed`),Ud(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(e){return Ud(`Initialization of backend ${t} failed`),Ud(e.stack||e.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority))}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e],{success:r,asyncInit:s}=this.initializeBackend(n);if(s||r)return{name:n,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const n=this.state.tensorInfo.get(e),r=n.backend,s=this.readSync(e),o=r.refCount(e);r.disposeData(e,!0),n.backend=t,t.move(e,s,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let n,r=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=e(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(t,e,n){t();try{const t=n();return e(),t}catch(t){throw e(),t}}nextTensorId(){return py.nextTensorId++}nextVariableId(){return py.nextVariableId++}clone(t){const e=my.runKernel("Identity",{x:t}),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(t=>({x:()=>{const e={x:t},n={dtype:"float32"};return my.runKernel("Cast",e,n)}})),[],{}),e}runKernel(t,e,n){null==this.backendName&&this.backend;if(!(null!=qd(t,this.backendName)))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,n){const r=this.backend.numDataIds();let s=0;n.forEach((t=>{s+="complex64"===t.dtype?3:1}));const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=r-e-s-o;if(i>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${i} data ids) after running '${t}'`)}runKernelFunc(t){let e,n=[];const r=this.isTapeOn(),s=this.state.numBytes,o=this.state.numTensors;let i,a;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const u=fy(t)?t.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(fy(t)){const{kernelName:e,inputs:s,attrs:o}=t;null==this.backendName&&this.backend;const u=qd(e,this.backendName);Dp(null!=u,(()=>`Cannot find registered kernel '${e}' for backend '${this.backendName}'`)),i=()=>{const t=this.backend.numDataIds();a=u.kernelFunc({inputs:s,attrs:o,backend:this.backend});const i=Array.isArray(a)?a:[a];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(e,t,i);const c=i.map((t=>null!=t.rank?t:this.makeTensorFromTensorInfo(t)));if(r){const t=this.getTensorsForGradient(e,s,c);n=this.saveTensorsForBackwardMode(t)}return c}}else{const{forwardFunc:e}=t,s=t=>{r&&(n=t.map((t=>this.keep(this.clone(t)))))};i=()=>{const t=this.backend.numDataIds();a=this.tidy((()=>e(this.backend,s)));const n=Array.isArray(a)?a:[a];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,t,n),n}}const{inputs:c,attrs:l}=t,f=fy(t)?null:t.backwardsFunc;let h;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(h=this.profiler.profileKernel(u,c,(()=>i())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(h),e=h.outputs):e=i()})),r&&this.addTapeNode(u,c,e,f,n,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map((t=>null!=c[t]?c[t].shape:null)),outputShapes:e.map((t=>t.shape)),kernelTimeMs:h.timeMs,extraInfo:h.extraInfo}),Array.isArray(a)?e:e[0]}saveTensorsForBackwardMode(t){const e=t.map((t=>this.keep(this.clone(t))));return e}getTensorsForGradient(t,e,n){const r=Hd(t);if(null!=r){const t=r.inputsToSave||[],s=r.outputsToSave||[];let o;r.saveAllInputs?(Dp(Array.isArray(e),(()=>"saveAllInputs is true, expected inputs to be an array.")),o=Object.keys(e).map((t=>e[t]))):o=t.map((t=>e[t]));const i=n.filter(((t,e)=>s[e]));return o.concat(i)}return[]}makeTensor(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let s=t;"string"===n&&Yp(t[0])&&(s=t.map((t=>Bm(t))));const o=r.write(s,e,n),i=new Zm(e,n,o,this.nextTensorId());if(this.trackTensor(i,r),"string"===n){const t=this.state.tensorInfo.get(o),e=function(t){if(null==t)return 0;let e=0;return t.forEach((t=>e+=t.length)),e}(s);this.state.numBytes+=e-t.bytes,t.bytes=e}return i}makeTensorFromDataId(t,e,n,r){const s={dataId:t,shape:e,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(s,r)}makeTensorFromTensorInfo(t,e){const{dataId:n,shape:r,dtype:s}=t,o=new Zm(r,s,n,this.nextTensorId());return this.trackTensor(o,e),o}makeVariable(t,e=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.cast(r));const s=new Qm(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[s.name])throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(t,e){this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*Jp(t.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n})),t instanceof Qm||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,"string"===t.dtype&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),"complex64"!==t.dtype&&"string"!==t.dtype){const e=t.size*Jp(t.dtype);this.state.numBytes-=e}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((t=>t.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const t of this.state.activeProfile.kernels)t.kernelTimeMs=await t.kernelTimeMs,t.extraInfo=await t.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(t,e,n,r,s,o){const i={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:s},a=Hd(t);null!=a&&(r=a.gradFunc),null!=r&&(i.gradient=t=>(t=t.map(((t,e)=>{if(null==t){const t=n[e],r=od(t.size,t.dtype);return this.makeTensor(r,t.shape,t.dtype)}return t})),r(t.length>1?t:t[0],s,o))),this.state.activeTape.push(i)}keep(t){return t.kept=!0,t}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=cy(t),n=new Set(e.map((t=>t.id)));for(let t=0;t<this.state.activeScope.track.length;t++){const e=this.state.activeScope.track[t];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach((t=>{t.kept||t.scopeId!==r.id||this.track(t)}))}gradients(t,e,n,r=!1){if(Dp(e.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const s=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",t)));Dp(s instanceof Zm,(()=>"The result y returned by f() must be a tensor."));const o=function(t,e,n){const r={},s={};for(let t=0;t<e.length;t++)r[e[t].id]=!0;for(let n=0;n<t.length;n++){const o=t[n],i=o.inputs;for(const t in i){const n=i[t];let a=!1;for(let t=0;t<e.length;t++)if(r[n.id]){o.outputs.forEach((t=>r[t.id]=!0)),a=!0,s[o.id]=!0;break}if(a)break}}const o={};o[n.id]=!0;const i={};for(let e=t.length-1;e>=0;e--){const n=t[e],r=n.inputs;for(let t=0;t<n.outputs.length;t++)if(o[n.outputs[t].id]){for(const t in r)o[r[t].id]=!0,i[n.id]=!0;break}}const a=[];for(let e=0;e<t.length;e++){const n=t[e];if(s[n.id]&&i[n.id]){const t={};for(const e in n.inputs){const s=n.inputs[e];r[s.id]&&(t[e]=s)}const e=Object.assign({},n);e.inputs=t,e.outputs=n.outputs,a.push(e)}}return a}(this.state.activeTape,e,s);if(!r&&0===o.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const t={};t[s.id]=null==n?function(t){const e=sd(Bp(t),"float32");return my.makeTensor(e,t,"float32")}(s.shape):n,function(t,e,n,r){for(let s=e.length-1;s>=0;s--){const o=e[s],i=[];if(o.outputs.forEach((e=>{const n=t[e.id];null!=n?i.push(n):i.push(null)})),null==o.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const e in o.inputs){if(!(e in a))throw new Error(`Cannot backprop through input ${e}. Available gradients found: ${Object.keys(a)}.`);const s=n((()=>a[e]()));if("float32"!==s.dtype)throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${e} must have 'float32' dtype, but has '${s.dtype}'`);const i=o.inputs[e];if(!Vp(s.shape,i.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${e}' has shape '${s.shape}', which does not match the shape of the input '${i.shape}'`);if(null==t[i.id])t[i.id]=s;else{const e=t[i.id];t[i.id]=r(e,s),e.dispose()}}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,o,(t=>this.tidy(t)),yy);const r=e.map((e=>t[e.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((t=>{for(const e of t.saved)e.dispose()})),this.state.activeTape=null),{value:s,grads:r}}))}customGrad(t){return Dp(Qp(t),(()=>"The f passed in customGrad(f) must be a function.")),(...e)=>{let n;Dp(e.every((t=>t instanceof Zm)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};e.forEach(((t,e)=>{r[e]=t}));return this.runKernelFunc({forwardFunc:(r,s)=>(n=t(...e,s),Dp(n.value instanceof Zm,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),Dp(Qp(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(t,r)=>{const s=n.gradFunc(t,r),o=Array.isArray(s)?s:[s];Dp(o.length===e.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),Dp(o.every((t=>t instanceof Zm)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const i={};return o.forEach(((t,e)=>{i[e]=()=>t})),i},inputs:r})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)}async time(t){const e=Pm(),n=await this.backend.time(t);return n.wallMs=Pm()-e,n}track(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new hy;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function dy(){const t=zd();if(null==t._tfengine){const e=new ld(t);t._tfengine=new py(e)}var e;return e=t._tfengine.ENV,pd=e,Jm=()=>t._tfengine,t._tfengine}py.nextTensorId=0,py.nextVariableId=0;const my=dy();function yy(t,e){const n={a:t,b:e};return my.runKernel("Add",n)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gy(t){if(t||"undefined"!=typeof navigator&&null!=navigator){if(t||(t=navigator),"ReactNative"===t.product)return!0;const e=t.userAgent||t.vendor||("undefined"!=typeof window?window.opera:"");if(!e){const e=t;return e.userAgentData&&e.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function by(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}const wy=hd();wy.registerFlag("DEBUG",(()=>!1),(t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),wy.registerFlag("IS_BROWSER",(()=>by())),wy.registerFlag("IS_NODE",(()=>void 0!==Bd&&void 0!==Bd.versions&&void 0!==Bd.versions.node)),wy.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),wy.registerFlag("PROD",(()=>!1)),wy.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>wy.getBool("DEBUG"))),wy.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),wy.registerFlag("IS_TEST",(()=>!1)),wy.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>!0)),wy.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),wy.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));var vy=[],xy=[],Ny="undefined"!=typeof Uint8Array?Uint8Array:Array,$y=!1;function Ey(){$y=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,n=t.length;e<n;++e)vy[e]=t[e],xy[t.charCodeAt(e)]=e;xy["-".charCodeAt(0)]=62,xy["_".charCodeAt(0)]=63}function Sy(t,e,n){for(var r,s,o=[],i=e;i<n;i+=3)r=(t[i]<<16)+(t[i+1]<<8)+t[i+2],o.push(vy[(s=r)>>18&63]+vy[s>>12&63]+vy[s>>6&63]+vy[63&s]);return o.join("")}function _y(t){var e;$y||Ey();for(var n=t.length,r=n%3,s="",o=[],i=16383,a=0,u=n-r;a<u;a+=i)o.push(Sy(t,a,a+i>u?u:a+i));return 1===r?(e=t[n-1],s+=vy[e>>2],s+=vy[e<<4&63],s+="=="):2===r&&(e=(t[n-2]<<8)+t[n-1],s+=vy[e>>10],s+=vy[e>>4&63],s+=vy[e<<2&63],s+="="),o.push(s),o.join("")}function Ty(t,e,n,r,s){var o,i,a=8*s-r-1,u=(1<<a)-1,c=u>>1,l=-7,f=n?s-1:0,h=n?-1:1,p=t[e+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+t[e+f],f+=h,l-=8);for(i=o&(1<<-l)-1,o>>=-l,l+=r;l>0;i=256*i+t[e+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return i?NaN:1/0*(p?-1:1);i+=Math.pow(2,r),o-=c}return(p?-1:1)*i*Math.pow(2,o-r)}function ky(t,e,n,r,s,o){var i,a,u,c=8*o-s-1,l=(1<<c)-1,f=l>>1,h=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,i=l):(i=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-i))<1&&(i--,u*=2),(e+=i+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(i++,u/=2),i+f>=l?(a=0,i=l):i+f>=1?(a=(e*u-1)*Math.pow(2,s),i+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,s),i=0));s>=8;t[n+p]=255&a,p+=d,a/=256,s-=8);for(i=i<<s|a,c+=s;c>0;t[n+p]=255&i,p+=d,i/=256,c-=8);t[n+p-d]|=128*m}var Ay={}.toString,Cy=Array.isArray||function(t){return"[object Array]"==Ay.call(t)};function Oy(){return My.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Iy(t,e){if(Oy()<e)throw new RangeError("Invalid typed array length");return My.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=My.prototype:(null===t&&(t=new My(e)),t.length=e),t}function My(t,e,n){if(!(My.TYPED_ARRAY_SUPPORT||this instanceof My))return new My(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return Fy(this,t)}return Ry(this,t,e,n)}function Ry(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);My.TYPED_ARRAY_SUPPORT?(t=e).__proto__=My.prototype:t=Ly(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!My.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|Vy(e,n),s=(t=Iy(t,r)).write(e,n);s!==r&&(t=t.slice(0,s));return t}(t,e,n):function(t,e){if(By(e)){var n=0|Py(e.length);return 0===(t=Iy(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?Iy(t,0):Ly(t,e);if("Buffer"===e.type&&Cy(e.data))return Ly(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function Dy(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function Fy(t,e){if(Dy(e),t=Iy(t,e<0?0:0|Py(e)),!My.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function Ly(t,e){var n=e.length<0?0:0|Py(e.length);t=Iy(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function Py(t){if(t>=Oy())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Oy().toString(16)+" bytes");return 0|t}function By(t){return!(null==t||!t._isBuffer)}function Vy(t,e){if(By(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return hg(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return pg(t).length;default:if(r)return hg(t).length;e=(""+e).toLowerCase(),r=!0}}function zy(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return eg(this,e,n);case"utf8":case"utf-8":return Zy(this,e,n);case"ascii":return Qy(this,e,n);case"latin1":case"binary":return tg(this,e,n);case"base64":return Yy(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ng(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function Wy(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function Uy(t,e,n,r,s){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=s?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(s)return-1;n=t.length-1}else if(n<0){if(!s)return-1;n=0}if("string"==typeof e&&(e=My.from(e,r)),By(e))return 0===e.length?-1:jy(t,e,n,r,s);if("number"==typeof e)return e&=255,My.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):jy(t,[e],n,r,s);throw new TypeError("val must be string, number or Buffer")}function jy(t,e,n,r,s){var o,i=1,a=t.length,u=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;i=2,a/=2,u/=2,n/=2}function c(t,e){return 1===i?t[e]:t.readUInt16BE(e*i)}if(s){var l=-1;for(o=n;o<a;o++)if(c(t,o)===c(e,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*i}else-1!==l&&(o-=o-l),l=-1}else for(n+u>a&&(n=a-u),o=n;o>=0;o--){for(var f=!0,h=0;h<u;h++)if(c(t,o+h)!==c(e,h)){f=!1;break}if(f)return o}return-1}function Gy(t,e,n,r){n=Number(n)||0;var s=t.length-n;r?(r=Number(r))>s&&(r=s):r=s;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var i=0;i<r;++i){var a=parseInt(e.substr(2*i,2),16);if(isNaN(a))return i;t[n+i]=a}return i}function qy(t,e,n,r){return dg(hg(e,t.length-n),t,n,r)}function Hy(t,e,n,r){return dg(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function Ky(t,e,n,r){return Hy(t,e,n,r)}function Xy(t,e,n,r){return dg(pg(e),t,n,r)}function Jy(t,e,n,r){return dg(function(t,e){for(var n,r,s,o=[],i=0;i<t.length&&!((e-=2)<0);++i)r=(n=t.charCodeAt(i))>>8,s=n%256,o.push(s),o.push(r);return o}(e,t.length-n),t,n,r)}function Yy(t,e,n){return 0===e&&n===t.length?_y(t):_y(t.slice(e,n))}function Zy(t,e,n){n=Math.min(t.length,n);for(var r=[],s=e;s<n;){var o,i,a,u,c=t[s],l=null,f=c>239?4:c>223?3:c>191?2:1;if(s+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=t[s+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=t[s+1],i=t[s+2],128==(192&o)&&128==(192&i)&&(u=(15&c)<<12|(63&o)<<6|63&i)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=t[s+1],i=t[s+2],a=t[s+3],128==(192&o)&&128==(192&i)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&i)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),s+=f}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=4096));return n}(r)}My.TYPED_ARRAY_SUPPORT=void 0===dd.TYPED_ARRAY_SUPPORT||dd.TYPED_ARRAY_SUPPORT,Oy(),My.poolSize=8192,My._augment=function(t){return t.__proto__=My.prototype,t},My.from=function(t,e,n){return Ry(null,t,e,n)},My.TYPED_ARRAY_SUPPORT&&(My.prototype.__proto__=Uint8Array.prototype,My.__proto__=Uint8Array),My.alloc=function(t,e,n){return function(t,e,n,r){return Dy(e),e<=0?Iy(t,e):void 0!==n?"string"==typeof r?Iy(t,e).fill(n,r):Iy(t,e).fill(n):Iy(t,e)}(null,t,e,n)},My.allocUnsafe=function(t){return Fy(null,t)},My.allocUnsafeSlow=function(t){return Fy(null,t)},My.isBuffer=function(t){return null!=t&&(!!t._isBuffer||mg(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&mg(t.slice(0,0))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t))},My.compare=function(t,e){if(!By(t)||!By(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,s=0,o=Math.min(n,r);s<o;++s)if(t[s]!==e[s]){n=t[s],r=e[s];break}return n<r?-1:r<n?1:0},My.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},My.concat=function(t,e){if(!Cy(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return My.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=My.allocUnsafe(e),s=0;for(n=0;n<t.length;++n){var o=t[n];if(!By(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,s),s+=o.length}return r},My.byteLength=Vy,My.prototype._isBuffer=!0,My.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)Wy(this,e,e+1);return this},My.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)Wy(this,e,e+3),Wy(this,e+1,e+2);return this},My.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)Wy(this,e,e+7),Wy(this,e+1,e+6),Wy(this,e+2,e+5),Wy(this,e+3,e+4);return this},My.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?Zy(this,0,t):zy.apply(this,arguments)},My.prototype.equals=function(t){if(!By(t))throw new TypeError("Argument must be a Buffer");return this===t||0===My.compare(this,t)},My.prototype.inspect=function(){var t="";return this.length>0&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(t+=" ... ")),"<Buffer "+t+">"},My.prototype.compare=function(t,e,n,r,s){if(!By(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===s&&(s=this.length),e<0||n>t.length||r<0||s>this.length)throw new RangeError("out of range index");if(r>=s&&e>=n)return 0;if(r>=s)return-1;if(e>=n)return 1;if(this===t)return 0;for(var o=(s>>>=0)-(r>>>=0),i=(n>>>=0)-(e>>>=0),a=Math.min(o,i),u=this.slice(r,s),c=t.slice(e,n),l=0;l<a;++l)if(u[l]!==c[l]){o=u[l],i=c[l];break}return o<i?-1:i<o?1:0},My.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},My.prototype.indexOf=function(t,e,n){return Uy(this,t,e,n,!0)},My.prototype.lastIndexOf=function(t,e,n){return Uy(this,t,e,n,!1)},My.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var s=this.length-e;if((void 0===n||n>s)&&(n=s),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return Gy(this,t,e,n);case"utf8":case"utf-8":return qy(this,t,e,n);case"ascii":return Hy(this,t,e,n);case"latin1":case"binary":return Ky(this,t,e,n);case"base64":return Xy(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Jy(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},My.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Qy(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(127&t[s]);return r}function tg(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(t[s]);return r}function eg(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var s="",o=e;o<n;++o)s+=fg(t[o]);return s}function ng(t,e,n){for(var r=t.slice(e,n),s="",o=0;o<r.length;o+=2)s+=String.fromCharCode(r[o]+256*r[o+1]);return s}function rg(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function sg(t,e,n,r,s,o){if(!By(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function og(t,e,n,r){e<0&&(e=65535+e+1);for(var s=0,o=Math.min(t.length-n,2);s<o;++s)t[n+s]=(e&255<<8*(r?s:1-s))>>>8*(r?s:1-s)}function ig(t,e,n,r){e<0&&(e=4294967295+e+1);for(var s=0,o=Math.min(t.length-n,4);s<o;++s)t[n+s]=e>>>8*(r?s:3-s)&255}function ag(t,e,n,r,s,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function ug(t,e,n,r,s){return s||ag(t,0,n,4),ky(t,e,n,r,23,4),n+4}function cg(t,e,n,r,s){return s||ag(t,0,n,8),ky(t,e,n,r,52,8),n+8}My.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),My.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=My.prototype;else{var s=e-t;n=new My(s,void 0);for(var o=0;o<s;++o)n[o]=this[o+t]}return n},My.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||rg(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r},My.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||rg(t,e,this.length);for(var r=this[t+--e],s=1;e>0&&(s*=256);)r+=this[t+--e]*s;return r},My.prototype.readUInt8=function(t,e){return e||rg(t,1,this.length),this[t]},My.prototype.readUInt16LE=function(t,e){return e||rg(t,2,this.length),this[t]|this[t+1]<<8},My.prototype.readUInt16BE=function(t,e){return e||rg(t,2,this.length),this[t]<<8|this[t+1]},My.prototype.readUInt32LE=function(t,e){return e||rg(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},My.prototype.readUInt32BE=function(t,e){return e||rg(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},My.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||rg(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r>=(s*=128)&&(r-=Math.pow(2,8*e)),r},My.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||rg(t,e,this.length);for(var r=e,s=1,o=this[t+--r];r>0&&(s*=256);)o+=this[t+--r]*s;return o>=(s*=128)&&(o-=Math.pow(2,8*e)),o},My.prototype.readInt8=function(t,e){return e||rg(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},My.prototype.readInt16LE=function(t,e){e||rg(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},My.prototype.readInt16BE=function(t,e){e||rg(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},My.prototype.readInt32LE=function(t,e){return e||rg(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},My.prototype.readInt32BE=function(t,e){return e||rg(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},My.prototype.readFloatLE=function(t,e){return e||rg(t,4,this.length),Ty(this,t,!0,23,4)},My.prototype.readFloatBE=function(t,e){return e||rg(t,4,this.length),Ty(this,t,!1,23,4)},My.prototype.readDoubleLE=function(t,e){return e||rg(t,8,this.length),Ty(this,t,!0,52,8)},My.prototype.readDoubleBE=function(t,e){return e||rg(t,8,this.length),Ty(this,t,!1,52,8)},My.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||sg(this,t,e,n,Math.pow(2,8*n)-1,0);var s=1,o=0;for(this[e]=255&t;++o<n&&(s*=256);)this[e+o]=t/s&255;return e+n},My.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||sg(this,t,e,n,Math.pow(2,8*n)-1,0);var s=n-1,o=1;for(this[e+s]=255&t;--s>=0&&(o*=256);)this[e+s]=t/o&255;return e+n},My.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||sg(this,t,e,1,255,0),My.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},My.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||sg(this,t,e,2,65535,0),My.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):og(this,t,e,!0),e+2},My.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||sg(this,t,e,2,65535,0),My.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):og(this,t,e,!1),e+2},My.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||sg(this,t,e,4,4294967295,0),My.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):ig(this,t,e,!0),e+4},My.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||sg(this,t,e,4,4294967295,0),My.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):ig(this,t,e,!1),e+4},My.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);sg(this,t,e,n,s-1,-s)}var o=0,i=1,a=0;for(this[e]=255&t;++o<n&&(i*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},My.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);sg(this,t,e,n,s-1,-s)}var o=n-1,i=1,a=0;for(this[e+o]=255&t;--o>=0&&(i*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},My.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||sg(this,t,e,1,127,-128),My.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},My.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||sg(this,t,e,2,32767,-32768),My.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):og(this,t,e,!0),e+2},My.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||sg(this,t,e,2,32767,-32768),My.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):og(this,t,e,!1),e+2},My.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||sg(this,t,e,4,2147483647,-2147483648),My.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):ig(this,t,e,!0),e+4},My.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||sg(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),My.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):ig(this,t,e,!1),e+4},My.prototype.writeFloatLE=function(t,e,n){return ug(this,t,e,!0,n)},My.prototype.writeFloatBE=function(t,e,n){return ug(this,t,e,!1,n)},My.prototype.writeDoubleLE=function(t,e,n){return cg(this,t,e,!0,n)},My.prototype.writeDoubleBE=function(t,e,n){return cg(this,t,e,!1,n)},My.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var s,o=r-n;if(this===t&&n<e&&e<r)for(s=o-1;s>=0;--s)t[s+e]=this[s+n];else if(o<1e3||!My.TYPED_ARRAY_SUPPORT)for(s=0;s<o;++s)t[s+e]=this[s+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},My.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var s=t.charCodeAt(0);s<256&&(t=s)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!My.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var i=By(t)?t:hg(new My(t,r).toString()),a=i.length;for(o=0;o<n-e;++o)this[o+e]=i[o%a]}return this};var lg=/[^+\/0-9A-Za-z-_]/g;function fg(t){return t<16?"0"+t.toString(16):t.toString(16)}function hg(t,e){var n;e=e||1/0;for(var r=t.length,s=null,o=[],i=0;i<r;++i){if((n=t.charCodeAt(i))>55295&&n<57344){if(!s){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(i+1===r){(e-=3)>-1&&o.push(239,191,189);continue}s=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),s=n;continue}n=65536+(s-55296<<10|n-56320)}else s&&(e-=3)>-1&&o.push(239,191,189);if(s=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function pg(t){return function(t){var e,n,r,s,o,i;$y||Ey();var a=t.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===t[a-2]?2:"="===t[a-1]?1:0,i=new Ny(3*a/4-o),r=o>0?a-4:a;var u=0;for(e=0,n=0;e<r;e+=4,n+=3)s=xy[t.charCodeAt(e)]<<18|xy[t.charCodeAt(e+1)]<<12|xy[t.charCodeAt(e+2)]<<6|xy[t.charCodeAt(e+3)],i[u++]=s>>16&255,i[u++]=s>>8&255,i[u++]=255&s;return 2===o?(s=xy[t.charCodeAt(e)]<<2|xy[t.charCodeAt(e+1)]>>4,i[u++]=255&s):1===o&&(s=xy[t.charCodeAt(e)]<<10|xy[t.charCodeAt(e+1)]<<4|xy[t.charCodeAt(e+2)]>>2,i[u++]=s>>8&255,i[u++]=255&s),i}(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(lg,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function dg(t,e,n,r){for(var s=0;s<r&&!(s+n>=e.length||s>=t.length);++s)e[s+n]=t[s];return s}function mg(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function yg(t,e){let n=t;if(Xp(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||Xp(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&hd().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&gg(t,r,[]),r}function gg(t,e,n){if(n=n||[],!Array.isArray(t)&&!Xp(t))return void Dp(0===e.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`));Dp(e.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`)),Dp(t.length===e[0],(()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`));const r=e.slice(1);for(let e=0;e<t.length;++e)gg(t[e],r,n.concat(e))}function bg(t,e,n,r){if("string_or_numeric"!==t){if(null==t)throw new Error("Expected dtype cannot be null.");if("numeric"!==t&&t!==e||"numeric"===t&&"string"===e)throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}}function wg(t,e,n,r="numeric"){if(t instanceof Zm)return bg(r,t.dtype,e,n),t;let s=Zp(t);if("string"!==s&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),bg(r,s,e,n),null==t||!Xp(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){const r=null==t?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const o=yg(t,s);Xp(t)||Array.isArray(t)||(t=[t]);const i="string"!==s?Lm(t,s):Pp(t,[],!0);return my.makeTensor(i,o,s)}function vg(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map(((t,s)=>wg(t,`${e}[${s}]`,n,r)))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xg(t){const e=Object.keys(t);if(1!==e.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const s=(...t)=>{my.startScope(n);try{const e=r(...t);return cd(e)&&console.error("Cannot return a Promise inside of tidy."),my.endScope(e),e}catch(t){throw my.endScope(null),t}};return Object.defineProperty(s,"name",{value:n,configurable:!0}),s}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ng=xg({complex_:function(t,e){const n=wg(t,"real","complex"),r=wg(e,"imag","complex");Fp(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const s={real:n,imag:r};return my.runKernel("Complex",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $g(t,e,n,r){if(null==r&&(r=Zp(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Xp(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){id(e);const t=Bp(e),r=Bp(n);Dp(t===r,(()=>`Based on the provided shape, [${e}], the tensor should have ${t} values but has ${r}`));for(let t=0;t<n.length;++t){const r=n[t],s=t!==n.length-1||r!==Bp(e.slice(t));Dp(n[t]===e[t]||!s,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `))}}return Xp(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?Lm(t,r):Pp(t,[],!0),my.makeTensor(t,e,r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eg="undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa;function Sg(t){return Eg?My.byteLength(t):new Blob([t]).size}function _g(t){if(1===t.length)return t[0];let e=0;t.forEach((t=>{e+=t.byteLength}));const n=new Uint8Array(e);let r=0;return t.forEach((t=>{n.set(new Uint8Array(t),r),r+=t.byteLength})),n.buffer}function Tg(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),n}function kg(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:Sg(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:Sg(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ag{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==Ag.instance&&(Ag.instance=new Ag),Ag.instance}static registerSaveRouter(t){Ag.getInstance().saveRouters.push(t)}static registerLoadRouter(t){Ag.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return Ag.getHandlers(t,"save")}static getLoadHandlers(t,e){return Ag.getHandlers(t,"load",e)}static getHandlers(t,e,n){const r=[];return("load"===e?Ag.getInstance().loadRouters:Ag.getInstance().saveRouters).forEach((e=>{const s=e(t,n);null!==s&&r.push(s)})),r}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cg(){if(!hd().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t="undefined"==typeof window?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Og(t){const e=t.result;e.createObjectStore("models_store",{keyPath:"modelPath"}),e.createObjectStore("model_info_store",{keyPath:"modelPath"})}class Ig{constructor(t){if(this.indexedDB=Cg(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise(((t,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>Og(r),r.onsuccess=()=>{const s=r.result;if(null==e){const e=s.transaction("models_store","readonly"),r=e.objectStore("models_store").get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return s.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));t(r.result.modelArtifacts)},r.onerror=t=>(s.close(),n(r.error)),e.oncomplete=()=>s.close()}else{const r=kg(e),o=s.transaction("model_info_store","readwrite");let i=o.objectStore("model_info_store");const a=i.put({modelPath:this.modelPath,modelArtifactsInfo:r});let u;a.onsuccess=()=>{u=s.transaction("models_store","readwrite");const a=u.objectStore("models_store").put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:r});a.onsuccess=()=>t({modelArtifactsInfo:r}),a.onerror=t=>{i=o.objectStore("model_info_store");const e=i.delete(this.modelPath);e.onsuccess=()=>(s.close(),n(a.error)),e.onerror=t=>(s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}}},r.onerror=t=>n(r.error)}))}}Ig.URL_SCHEME="indexeddb://";const Mg=t=>{return hd().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Ig.URL_SCHEME)?(e=t.slice(Ig.URL_SCHEME.length),new Ig(e)):null;var e};Ag.registerSaveRouter(Mg),Ag.registerLoadRouter(Mg);class Rg{constructor(){this.indexedDB=Cg()}async listModels(){return new Promise(((t,e)=>{const n=this.indexedDB.open("tensorflowjs",1);n.onupgradeneeded=()=>Og(n),n.onsuccess=()=>{const r=n.result,s=r.transaction("model_info_store","readonly"),o=s.objectStore("model_info_store").getAll();o.onsuccess=()=>{const e={};for(const t of o.result)e[t.modelPath]=t.modelArtifactsInfo;t(e)},o.onerror=t=>(r.close(),e(o.error)),s.oncomplete=()=>r.close()},n.onerror=t=>e(n.error)}))}async removeModel(t){var e;return t=(e=t).startsWith(Ig.URL_SCHEME)?e.slice(Ig.URL_SCHEME.length):e,new Promise(((e,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>Og(r),r.onsuccess=()=>{const s=r.result,o=s.transaction("model_info_store","readwrite"),i=o.objectStore("model_info_store"),a=i.get(t);let u;a.onsuccess=()=>{if(null==a.result)return s.close(),n(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const r=i.delete(t),o=()=>{u=s.transaction("models_store","readwrite");const r=u.objectStore("models_store").delete(t);r.onsuccess=()=>e(a.result.modelArtifactsInfo),r.onerror=t=>n(a.error)};r.onsuccess=o,r.onerror=t=>(o(),s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}},r.onerror=t=>n(r.error)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dg="tensorflowjs_models",Fg="info",Lg="model_topology",Pg="weight_specs",Bg="weight_data",Vg="model_metadata";function zg(t){return{info:[Dg,t,Fg].join("/"),topology:[Dg,t,Lg].join("/"),weightSpecs:[Dg,t,Pg].join("/"),weightData:[Dg,t,Bg].join("/"),modelMetadata:[Dg,t,Vg].join("/")}}function Wg(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function Ug(t){const e=t.split("/");if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join("/")}class jg{constructor(t){if(!hd().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=zg(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=kg(t);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(Eg)return My.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let t=0,r=e.length;t<r;t++)n+=String.fromCharCode(e[t]);return btoa(n)}(t.weightData));const s={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:r}}catch(t){throw Wg(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(null==t)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=r;const s=this.LS.getItem(this.keys.modelMetadata);if(null!=s){const t=JSON.parse(s);e.format=t.format,e.generatedBy=t.generatedBy,e.convertedBy=t.convertedBy,null!=t.signature&&(e.signature=t.signature),null!=t.userDefinedMetadata&&(e.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(e.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(e.trainingConfig=t.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(null==o)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=function(t){if(Eg){const e=My.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;++t)n.set([e.charCodeAt(t)],t);return n.buffer}(o),e}}jg.URL_SCHEME="localstorage://";const Gg=t=>{return hd().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(jg.URL_SCHEME)?(e=t.slice(jg.URL_SCHEME.length),new jg(e)):null;var e};Ag.registerSaveRouter(Gg),Ag.registerLoadRouter(Gg);class qg{constructor(){Dp(hd().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),Dp("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const t={},e=Dg+"/",n="/"+Fg;for(let r=0;r<this.LS.length;++r){const s=this.LS.key(r);if(s.startsWith(e)&&s.endsWith(n)){t[Ug(s)]=JSON.parse(this.LS.getItem(s))}}return t}async removeModel(t){var e;const n=zg(t=(e=t).startsWith(jg.URL_SCHEME)?e.slice(jg.URL_SCHEME.length):e);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(n.info));return Wg(n),r}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hg{constructor(){this.managers={}}static getInstance(){return null==Hg.instance&&(Hg.instance=new Hg),Hg.instance}static registerManager(t,e){Dp(null!=t,(()=>"scheme must not be undefined or null.")),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),Dp(t.length>0,(()=>"scheme must not be an empty string."));const n=Hg.getInstance();Dp(null==n.managers[t],(()=>`A model store manager is already registered for scheme '${t}'.`)),n.managers[t]=e}static getManager(t){const e=this.getInstance().managers[t];if(null==e)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kg{fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}}if(hd().get("IS_BROWSER")){hd().setPlatform("browser",new Kg);try{Hg.registerManager(jg.URL_SCHEME,new qg)}catch(t){}try{Hg.registerManager(Ig.URL_SCHEME,new Rg)}catch(t){}}const Xg=()=>require("node-fetch");let Jg;class Yg{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return null!=hd().global.fetch?hd().global.fetch(t,e):(null==Jg&&(Jg=Xg()),Jg(t,e))}now(){const t=Bd.hrtime();return 1e3*t[0]+t[1]/1e6}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)}}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Zg(t,e="float32",n){return e=e||"float32",id(t),new Xm(t,e,n)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */hd().get("IS_NODE")&&!hd().get("IS_BROWSER")&&hd().setPlatform("node",new Yg);const Qg=xg({cast_:function(t,e){const n=wg(t,"x","cast");if(!function(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},s={dtype:e};return my.runKernel("Cast",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tb=xg({clone_:function(t){const e={x:wg(t,"x","clone","string_or_numeric")};return my.runKernel("Identity",e)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
dy();const eb={buffer:Zg,cast:Qg,clone:tb,print:function(t,e=!1){console.log(t.toString(e))}};!function(t){Ym=t}(eb);function nb(t){return new Promise((t=>setTimeout(t))).then(t)}class rb{constructor(t){if(!hd().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(rb.URL_SCHEME)&&(t=t.slice(rb.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}async save(t){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n=Tg(t,[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]),r=window.URL.createObjectURL(new Blob([JSON.stringify(n)],{type:"application/json"})),s=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(s.download=this.modelJsonFileName,s.href=r,await nb((()=>s.dispatchEvent(new MouseEvent("click")))),null!=t.weightData){const t=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;t.download=this.weightDataFileName,t.href=e,await nb((()=>t.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:kg(t)}}}}rb.URL_SCHEME="downloads://";
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function sb(t,e,n,r){!function(t){Dp(null!=t&&Array.isArray(t)&&t.length>0,(()=>"promises must be a none empty array"))}(t),function(t,e){Dp(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${t}`)),Dp(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${e}`)),Dp(e>=t,(()=>`startFraction must be no more than endFraction, but got startFraction ${t} and endFraction ${e}`))}(n=null==n?0:n,r=null==r?1:r);let s=0;return Promise.all(t.map((o=>(o.then((o=>{const i=n+ ++s/t.length*(r-n);return e(i),o})),o))))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Ag.registerSaveRouter((t=>hd().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(rb.URL_SCHEME)?function(t="model"){return new rb(t)}(t.slice(rb.URL_SCHEME.length)):null));class ob{constructor(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,this.weightUrlConverter=e.weightUrlConverter,null!=e.fetchFunc?(Dp("function"==typeof e.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=e.fetchFunc):this.fetch=hd().platform.fetch,Dp(null!=t&&t.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(t)&&Dp(2===t.length,(()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`)),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData;const n=Tg(t,[{paths:["./model.weights.bin"],weights:t.weightSpecs}]);e.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin");const r=await this.fetch(this.path,e);if(r.ok)return{modelArtifactsInfo:kg(t),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let e;try{e=await t.json()}catch(t){let e=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=e.modelTopology,r=e.weightsManifest;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return async function(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),null!=t.weightsManifest){const[r,s]=await e(t.weightsManifest);n.weightSpecs=r,n.weightData=s}return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),n}(e,(t=>this.loadWeights(t)))}async loadWeights(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),r=t.substring(0,e),s=n>e?t.substring(n):"";return[r+"/",s]}(e),s=this.weightPathPrefix||n,o=[];for(const e of t)o.push(...e.weights);const i=[],a=[];for(const e of t)for(const t of e.paths)null!=this.weightUrlConverter?a.push(this.weightUrlConverter(t)):i.push(s+t+r);this.weightUrlConverter&&i.push(...await Promise.all(a));const u=await async function(t,e){null==e&&(e={});const n=null==e.fetchFunc?hd().platform.fetch:e.fetchFunc,r=t.map((t=>n(t,e.requestInit,{isBinary:!0}))),s=(null==e.onProgress?await Promise.all(r):await sb(r,e.onProgress,0,.5)).map((t=>t.arrayBuffer()));return null==e.onProgress?await Promise.all(s):await sb(s,e.onProgress,.5,1)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(i,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[o,_g(u)]}}function ib(t){return null!=t.match(ob.URL_SCHEME_REGEX)}ob.URL_SCHEME_REGEX=/^https?:\/\//;const ab=(t,e)=>{if("undefined"==typeof fetch&&(null==e||null==e.fetchFunc))return null;{let n=!0;if(n=Array.isArray(t)?t.every((t=>ib(t))):ib(t),n)return function(t,e){return new ob(t,e)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e)}return null};Ag.registerSaveRouter(ab),Ag.registerLoadRouter(ab);const ub=xg({matMul_:function(t,e,n=!1,r=!1){let s=wg(t,"a","matMul"),o=wg(e,"b","matMul");[s,o]=uy(s,o);const i={a:s,b:o},a={transposeA:n,transposeB:r};return my.runKernel("BatchMatMul",i,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cb=xg({oneHot_:function(t,e,n=1,r=0){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const s={indices:wg(t,"indices","oneHot","int32")},o={depth:e,onValue:n,offValue:r};return my.runKernel("OneHot",s,o)}});function lb(){return my}function fb(t,e){return my.tidy(t,e)}function hb(t){cy(t).forEach((t=>t.dispose()))}const pb=xg({imag_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={input:wg(t,"input","imag")};return my.runKernel("Imag",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const db=xg({neg_:function(t){const e={x:wg(t,"x","neg")};return my.runKernel("Neg",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mb=xg({real_:function(t){const e={input:wg(t,"input","real")};return my.runKernel("Real",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yb=xg({transpose_:function(t,e,n){const r=wg(t,"x","transpose");if(null==e&&(e=r.shape.map(((t,e)=>e)).reverse()),Dp(r.rank===e.length,(()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`)),e.forEach((t=>{Dp(t>=0&&t<r.rank,(()=>"All entries in 'perm' must be between 0 and "+(r.rank-1)+` but got ${e}`))})),r.rank<=1)return r.clone();const s={x:r},o={perm:e};return"complex64"===r.dtype?fb((()=>{let t=mb(r),e=pb(r);return t=my.runKernel("Transpose",{x:t},o),e=my.runKernel("Transpose",{x:e},o),n&&(e=db(e)),Ng(t,e)})):my.runKernel("Transpose",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function gb(t,e){const n=t.length,r=[];for(let s=0;s<n;s++){const o=n-1-s,i=t[o]||1;(e[e.length-1-s]||1)>1&&1===i&&r.unshift(o)}return r}function bb(t,e){const n=[];for(let r=0;r<e.length;r++){const s=t[t.length-r-1],o=e.length-r-1,i=e[o];(null==s||1===s&&i>1)&&n.unshift(o)}return n}function wb(t,e){const n=[],r=Math.max(t.length,e.length);for(let s=0;s<r;s++){let r=t[t.length-s-1];null==r&&(r=1);let o=e[e.length-s-1];if(null==o&&(o=1),1===r)n.unshift(o);else if(1===o)n.unshift(r);else{if(r!==o){throw Error(`Operands could not be broadcast together with shapes ${t} and ${e}.`)}n.unshift(r)}}return n}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
let vb;function xb(t,e){const n=t.shape.length,r=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==e.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${n}`);if(0===Bp(t.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const s=e.shape,o=s[s.length-1];let i=1;for(let t=0;t<s.length-1;++t)i*=s[t];const a=t.shape,u=s.slice();u.pop();let c=1;for(let t=o;t<n;++t)c*=a[t],u.push(a[t]);const l=[...ed(t.shape).map((t=>t/c)),1].slice(0,o);return[u,i,c,l]}function Nb(t,e,n){const r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${s}.`;if(n.rank<s)throw new Error(o+` update.rank < ${s}. `);if(t.length<r+(n.rank-s))throw new Error(o+` Output shape length < ${r+(n.rank-s)}`);if(n.rank!==s+t.length-r)throw new Error(o+" update.rank != "+(s+t.length-r));for(let t=0;t<s;++t)if(n.shape[t]!==e.shape[t])throw new Error(o+` updates.shape[${t}] (${n.shape[t]}) != indices.shape[${t}] (${e.shape[t]}).`);for(let e=0;e<n.rank-s;++e)if(n.shape[e+s]!==t[e+r])throw new Error(o+` updates.shape[${e+s}] (${n.shape[e+s]}) != shape[${e+s}] (${t[e+s]})`)}function $b(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if("int32"!==e.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===e.size)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(0===t.size)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}Nb(n,e,t)}function Eb(t,e,n){const r=e.shape.length,s=r>1?e.shape[r-1]:1,o=n.length;let i=1;for(let t=s;t<o;++t)i*=n[t];const a=s<1?1:s;return{sliceRank:s,numUpdates:Bp(e.shape)/a,sliceSize:i,strides:[...ed(n.slice(0,s)),1],outputSize:Bp(n)}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({confusionMatrix_:function(t,e,n){const r=wg(t,"labels","confusionMatrix"),s=wg(e,"predictions","confusionMatrix");Dp(null==n||n>0&&Number.isInteger(n),(()=>`If provided, numClasses must be a positive integer, but got ${n}`)),Dp(1===r.rank,(()=>`Expected the rank of labels to be 1, but got ${r.rank}`)),Dp(1===s.rank,(()=>`Expected the rank of predictions to be 1, but got ${s.rank}`)),Dp(r.shape[0]===s.shape[0],(()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${s.shape[0]}. Labels and predictions should have the same number of elements.`)),Dp(n>0&&Number.isInteger(n),(()=>`numClasses is required to be a positive integer, but got ${n}`));const o=cb(Qg(r,"int32"),n),i=cb(Qg(s,"int32"),n),a=yb(o),u=ub(a,i);return Qg(u,"int32")}}),xg({fromPixels_:function(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,s=!1,o=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)s=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)o=!0;else if(null!=t.getContext)i=!0;else{if(!("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);a=!0}if(s){const e=2;if(s&&t.readyState<e)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=qd("FromPixels",my.backendName)){const n={pixels:t},r={numChannels:e};return my.runKernel("FromPixels",n,r)}const[u,c]=s?[t.videoWidth,t.videoHeight]:[t.width,t.height];let l,f;if(i)l=t.getContext("2d").getImageData(0,0,u,c).data;else if(r||n)l=t.data;else if(o||s||a){if(null==vb)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");vb=new OffscreenCanvas(1,1).getContext("2d")}else vb=document.createElement("canvas").getContext("2d");vb.canvas.width=u,vb.canvas.height=c,vb.drawImage(t,0,0,u,c),l=vb.getImageData(0,0,u,c).data}if(4===e)f=new Int32Array(l);else{const t=u*c;f=new Int32Array(t*e);for(let n=0;n<t;n++)for(let t=0;t<e;++t)f[n*e+t]=l[4*n+t]}return function(t,e,n){if(Lp(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");const r=yg(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return $g(t,e,r,n)}(f,[c,u,e],"int32")}});function Sb(t,e,n){const r=t.shape.length;Dp(r===e.length,(()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`)),Dp(r===n.length,(()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`));for(let s=0;s<r;++s)Dp(e[s]+n[s]<=t.shape[s],(()=>`Error in slice${r}D: begin[${s}] + size[${s}] (${e[s]+n[s]}) would overflow input.shape[${s}] (${t.shape[s]})`))}function _b(t,e,n){const r=[];for(let s=0;s<t.length;s++)r[s]=Math.ceil((e[s]-t[s])/n[s]);return r}function Tb(t,e,n,r){const s=[...t];for(let t=s.length;t<r.length;t++)s.push(1);for(let t=0;t<n;t++)0===t?s[e]=1:(s.splice(e,0,1),s.pop());return s}function kb(t,e,n){return n<=t?n:n-(e-1)}function Ab(t,e){const n=[];for(let r=0;r<t;r++)n.push(e+r);return n}function Cb(t,e,n,r,s){const o=[...s],i=Ab(n,e);for(let s=0;s<o.length;s++)if(i.indexOf(s)>-1)o[s]=0;else{const i=kb(e,n,s);let a=r[i];t&1<<i&&(a=0),o[s]=a}return o}function Ob(t,e,n,r,s){const o=[...s],i=Ab(n,e);for(let s=0;s<o.length;s++)if(i.indexOf(s)>-1)o[s]=Number.MAX_SAFE_INTEGER;else{const i=kb(e,n,s);let a=r[i];t&1<<i&&(a=Number.MAX_SAFE_INTEGER),o[s]=a}for(let t=0;t<o.length;t++){const e=s[t];o[t]<0&&(o[t]+=e),o[t]=Ip(0,o[t],s[t])}return o}function Ib(t,e,n){let r=t[e];return(n&1<<e||null==r)&&(r=1),r}function Mb(t,e,n,r,s,o){let i=e[s];const a=n[s]||1;(t&1<<s||o&1<<s||null==i)&&(i=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const u=r[s];return i<0&&(i+=u),i=Ip(0,i,u-1),i}function Rb(t,e,n,r,s,o){let i=e[s];const a=n[s]||1;(t&1<<s||o&1<<s||null==i)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const u=r[s];return i<0&&(i+=u),i=a>0?Ip(0,i,u):Ip(-1,i,u-1),i}function Db(t,e,n){let r=n.length;for(let t=0;t<n.length;t++)if(n[t]>1){r=t;break}for(let s=r+1;s<n.length;s++)if(e[s]>0||n[s]!==t[s])return!1;return!0}function Fb(t,e){let n=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}function Lb(t,e,n){let r;const s=t.shape.length;let o;return r="number"==typeof e?[e,...new Array(s-1).fill(0)]:e.length<s?e.concat(new Array(s-e.length).fill(0)):e.slice(),r.forEach((t=>{Dp(-1!==t,(()=>"slice() does not support negative begin indexing."))})),o=null==n?new Array(s).fill(-1):"number"==typeof n?[n,...new Array(s-1).fill(-1)]:n.length<s?n.concat(new Array(s-n.length).fill(-1)):n,o=o.map(((e,n)=>e>=0?e:(Dp(-1===e,(()=>`Negative size values should be exactly -1 but got ${e} for the slice() size at index ${n}.`)),t.shape[n]-r[n]))),[r,o]}function Pb(t,e,n,r,s,o,i,a,u){let c;if(null==r?(c=new Array(e.length),c.fill(1)):c=r,null!=i&&0!=(i&i-1))throw new Error("Multiple ellipses in slice is not allowed.");let l=!1;const f={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};for(let t=0;t<f.dims;t++)l&&0!=(1<<t&a)&&f.numAddAxisAfterEllipsis++,1<<t&i&&(l=!0);l||(f.ellipsisMask|=1<<f.dims,f.dims++);const h={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=null!=t.begin,e.endValid=null!=t.end,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<t.dims;r++)if(1<<r&t.ellipsisMask){const s=Math.min(e.dims-(t.dims-r)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<s;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&t.newAxisMask)e.finalShapeGatherIndices.push(-2),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);null!=t.begin&&(e.begin[n]=t.begin[r]),null!=t.end&&(e.end[n]=t.end[r]),e.strides[n]=t.strides[r],t.beginMask&1<<r&&(e.beginMask|=1<<n),t.endMask&1<<r&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(-1),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[n]=r,n++}}(f,h);let p=!0,d=!0,m=!0;const y=[],g=[];for(let e=0;e<t.length;++e){if(0===h.strides[e])throw Error(`strides[${e}] must be non-zero`);const n=!!(h.shrinkAxisMask&1<<e),r=t[e];if(-1===r){y.push(n?1:-1);continue}const s=[h.beginMask&1<<e,h.endMask&1<<e],o=[h.strides[e]>0?0:-1,h.strides[e]>0?r:r-1];if(n&&h.strides[e]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===h.strides[e];const i=!!(h.beginMask&1<<e&&h.endMask&1<<e);if(h.beginValid&&h.endValid){if(n){const t=h.begin[e]<0?r+h.begin[e]:h.begin[e];if(h.begin[e]=t,h.end[e]=h.begin[e]+1,t<0||t>=r)throw Error(`slice index ${h.begin[e]} of dimension ${e} out of bounds.`)}else h.begin[e]=Bb(h.begin[e],0,h.strides[e],r,s,o),h.end[e]=Bb(h.end[e],1,h.strides[e],r,s,o);const t=1===h.strides[e]&&0===h.begin[e]&&h.end[e]===r;p=p&&t,d=d&&(0===e&&1===h.strides[e]||t)}else p=p&&1===h.strides[e]&&i,d=d&&(0===e&&1===h.strides[e]||i);let a,u=!1;if(h.beginValid&&h.endValid?(a=h.end[e]-h.begin[e],u=!0):n?(a=1,u=!0):i&&r>=0&&(a=h.strides[e]<0?-r:r,u=!0),u){let t;t=0===a||a<0!=h.strides[e]<0?0:Math.trunc(a/h.strides[e])+(a%h.strides[e]!=0?1:0),y.push(t)}else y.push(-1)}for(let t=0;t<h.finalShapeGatherIndices.length;++t){const e=h.finalShapeGatherIndices[t];e>=0?g.push(y[e]):-2===e&&g.push(1)}const b=g.filter(((t,e)=>-2!==h.finalShapeGatherIndices[e]));return{finalShapeSparse:b,finalShape:g,isIdentity:p,sliceDim0:d,isSimpleSlice:m,begin:h.begin,end:h.end,strides:h.strides}}function Bb(t,e,n,r,s,o){if(s[e])return n>0?o[e]:o[e+1&1];{const e=t<0?r+t:t;return e<o[0]?o[0]:e>o[1]?o[1]:e}}var Vb=Object.freeze({__proto__:null,assertParamsValid:Sb,maskToAxes:function(t){const e=[];let n=0;for(;t>0;)1&t&&e.push(n),t/=2,n++;return e},computeOutShape:_b,stridesWithElidedDims:Tb,getNormalizedAxes:function(t,e,n,r,s,o,i,a,u){const c=t.length;let l=new Array(c),f=new Array(c),h=new Array(c);if(e.length&&n>0){const u=e[0],c=n+1;l=Cb(i,u,c,r,t),f=Ob(a,u,c,s,t),h=Tb(o,u,c,t)}else for(let e=0;e<c;e++)l[e]=Mb(i,r,o,t,e,u),f[e]=Rb(a,s,o,t,e,u),h[e]=Ib(o,e,u);return{begin:l,end:f,strides:h}},startIndicesWithElidedDims:Cb,stopIndicesWithElidedDims:Ob,stridesForAxis:Ib,startForAxis:Mb,stopForAxis:Rb,isSliceContinous:Db,computeFlatOffset:Fb,parseSliceParams:Lb,sliceInfo:Pb});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zb{constructor(){this.classNameMap={}}static getMap(){return null==zb.instance&&(zb.instance=new zb),zb.instance}static register(t){zb.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function Wb(t){Dp(null!=t.className,(()=>"Class being registered does not have the static className property defined.")),Dp("string"==typeof t.className,(()=>"className is required to be a string, but got type "+typeof t.className)),Dp(t.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),zb.register(t)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ub=xg({add_:function(t,e){let n=wg(t,"a","add"),r=wg(e,"b","add");[n,r]=uy(n,r);const s={a:n,b:r};return my.runKernel("Add",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jb=xg({floorDiv_:function(t,e){let n=wg(t,"a","floorDiv"),r=wg(e,"b","floorDiv");[n,r]=uy(n,r);const s={a:n,b:r};return my.runKernel("FloorDiv",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gb=xg({div_:function(t,e){let n=wg(t,"a","div"),r=wg(e,"b","div");if([n,r]=uy(n,r),"int32"===n.dtype&&"int32"===r.dtype)return jb(n,r);const s={a:n,b:r};return my.runKernel("RealDiv",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qb=xg({mul_:function(t,e){let n=wg(t,"a","mul"),r=wg(e,"b","mul");[n,r]=uy(n,r);const s={a:n,b:r};return my.runKernel("Multiply",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hb=xg({abs_:function(t){const e=wg(t,"x","abs");if("complex64"===e.dtype){const t={x:e};return my.runKernel("ComplexAbs",t)}{const t={x:e};return my.runKernel("Abs",t)}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Kb(t,e,n,r,s="NHWC",o){return Yb(t,[...e,t[3]],n,o,r,null,null,iw(s))}function Xb(t,e,n,r,s,o,i="channelsLast"){const[a,u]=tw(e);let c;if("channelsLast"===i)c=[a,u,t[3],t[3]];else{if("channelsFirst"!==i)throw new Error(`Unknown dataFormat ${i}`);c=[a,u,t[1],t[1]]}return Yb(t,c,n,r,s,o,!1,i)}function Jb(t,e,n,r,s,o,i="NDHWC"){const[a,u,c]=ew(e);let l,f;if("NDHWC"===i)f="channelsLast",l=[a,u,c,t[4],t[4]];else{if("NCDHW"!==i)throw new Error(`Unknown dataFormat ${i}`);f="channelsFirst",l=[a,u,c,t[1],t[1]]}return Zb(t,l,n,r,s,!1,f,o)}function Yb(t,e,n,r,s,o,i=!1,a="channelsLast"){let[u,c,l,f]=[-1,-1,-1,-1];if("channelsLast"===a)[u,c,l,f]=t;else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);[u,f,c,l]=t}const[h,p,,d]=e,[m,y]=tw(n),[g,b]=tw(r),w=nw(h,g),v=nw(p,b),{padInfo:x,outHeight:N,outWidth:$}=function(t,e,n,r,s,o,i,a,u){let c,l,f;if("number"==typeof t){c={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};const s=function(t,e,n,r,s){null==r&&(r=Qb(t,e,n));const o=t[0],i=t[1],a=rw((o-e+2*r)/n+1,s),u=rw((i-e+2*r)/n+1,s);return[a,u]}([e,n],o,r,t,a);l=s[0],f=s[1]}else if("same"===t){l=Math.ceil(e/r),f=Math.ceil(n/s);const t=Math.max(0,(l-1)*r+o-e),a=Math.max(0,(f-1)*s+i-n),u=Math.floor(t/2),h=t-u,p=Math.floor(a/2);c={top:u,bottom:h,left:p,right:a-p,type:"SAME"}}else if("valid"===t)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-o+1)/r),f=Math.ceil((n-i+1)/s);else{if("object"!=typeof t)throw Error(`Unknown padding parameter: ${t}`);{const h="channelsLast"===u?t[1][0]:t[2][0],p="channelsLast"===u?t[1][1]:t[2][1],d="channelsLast"===u?t[2][0]:t[3][0],m="channelsLast"===u?t[2][1]:t[3][1];c={top:h,bottom:p,left:d,right:m,type:0===h&&0===p&&0===d&&0===m?"VALID":"EXPLICIT"},l=rw((e-o+h+p)/r+1,a),f=rw((n-i+d+m)/s+1,a)}}return{padInfo:c,outHeight:l,outWidth:f}}(s,c,l,m,y,w,v,o,a),E=i?d*f:d;let S;return"channelsFirst"===a?S=[u,E,N,$]:"channelsLast"===a&&(S=[u,N,$,E]),{batchSize:u,dataFormat:a,inHeight:c,inWidth:l,inChannels:f,outHeight:N,outWidth:$,outChannels:E,padInfo:x,strideHeight:m,strideWidth:y,filterHeight:h,filterWidth:p,effectiveFilterHeight:w,effectiveFilterWidth:v,dilationHeight:g,dilationWidth:b,inShape:t,outShape:S,filterShape:e}}function Zb(t,e,n,r,s,o=!1,i="channelsLast",a){let[u,c,l,f,h]=[-1,-1,-1,-1,-1];if("channelsLast"===i)[u,c,l,f,h]=t;else{if("channelsFirst"!==i)throw new Error(`Unknown dataFormat ${i}`);[u,h,c,l,f]=t}const[p,d,m,,y]=e,[g,b,w]=ew(n),[v,x,N]=ew(r),$=nw(p,v),E=nw(d,x),S=nw(m,N),{padInfo:_,outDepth:T,outHeight:k,outWidth:A}=function(t,e,n,r,s,o,i,a,u,c,l){let f,h,p,d;if("number"==typeof t){f={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};const o=function(t,e,n,r,s,o){null==s&&(s=Qb(t,e,r));const i=t[0],a=t[1],u=t[2],c=rw((i-e+2*s)/r+1,o),l=rw((a-e+2*s)/r+1,o),f=rw((u-e+2*s)/r+1,o);return[c,l,f,n]}([e,n,r,1],a,1,s,t,l);h=o[0],p=o[1],d=o[2]}else if("same"===t){h=Math.ceil(e/s),p=Math.ceil(n/o),d=Math.ceil(r/i);const t=(h-1)*s+a-e,l=(p-1)*o+u-n,m=(d-1)*i+c-r,y=Math.floor(t/2),g=t-y,b=Math.floor(l/2),w=l-b,v=Math.floor(m/2);f={top:b,bottom:w,left:v,right:m-v,front:y,back:g,type:"SAME"}}else{if("valid"!==t)throw Error(`Unknown padding parameter: ${t}`);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((e-a+1)/s),p=Math.ceil((n-u+1)/o),d=Math.ceil((r-c+1)/i)}return{padInfo:f,outDepth:h,outHeight:p,outWidth:d}}(s,c,l,f,g,b,w,$,E,S,a),C=o?y*h:y;let O;return"channelsFirst"===i?O=[u,C,T,k,A]:"channelsLast"===i&&(O=[u,T,k,A,C]),{batchSize:u,dataFormat:i,inDepth:c,inHeight:l,inWidth:f,inChannels:h,outDepth:T,outHeight:k,outWidth:A,outChannels:C,padInfo:_,strideDepth:g,strideHeight:b,strideWidth:w,filterDepth:p,filterHeight:d,filterWidth:m,effectiveFilterDepth:$,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationDepth:v,dilationHeight:x,dilationWidth:N,inShape:t,outShape:O,filterShape:e}}function Qb(t,e,n,r=1){const s=nw(e,r);return Math.floor((t[0]*(n-1)-n+s)/2)}function tw(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function ew(t){return"number"==typeof t?[t,t,t]:t}function nw(t,e){return e<=1?t:t+(t-1)*(e-1)}function rw(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function sw(t){const[e,n,r]=tw(t);return 1===e&&1===n&&1===r}function ow(t,e){return sw(t)||sw(e)}function iw(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function aw(t,e,n){if(null!=n){if("string"==typeof e)throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if("number"==typeof e)Dp(zp(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`));else{if("object"!=typeof e)throw Error(`Error in ${t}: Unknown padding parameter: ${e}`);e.forEach((e=>{e.forEach((e=>{Dp(zp(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`))}))}))}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({acos_:function(t){const e={x:wg(t,"x","acos")};return my.runKernel("Acos",e)}}),xg({acosh_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:wg(t,"x","acosh")};return my.runKernel("Acosh",e)}}),xg({addN_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){Dp(Array.isArray(t),(()=>"The argument passed to tf.addN() must be a list of tensors")),Dp(t.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`));const e=t.map(((t,e)=>wg(t,`tensors${e}`,"addN"))),n=e[0];e.forEach((t=>{if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((t=>{if(!Vp(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const r=e;return my.runKernel("AddN",r)}}),xg({all_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=null,n=!1){const r={x:wg(t,"x","all","bool")},s={axis:e,keepDims:n};return my.runKernel("All",r,s)}}),xg({any_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=null,n=!1){const r={x:wg(t,"x","any","bool")},s={axis:e,keepDims:n};return my.runKernel("Any",r,s)}}),xg({argMax_:
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0){const n={x:wg(t,"x","argMax")},r={axis:e};return my.runKernel("ArgMax",n,r)}}),xg({argMin_:
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0){const n={x:wg(t,"x","argMin")},r={axis:e};return my.runKernel("ArgMin",n,r)}}),xg({asin_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:wg(t,"x","asin")};return my.runKernel("Asin",e)}}),xg({asinh_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:wg(t,"x","asinh")};return my.runKernel("Asinh",e)}}),xg({atan_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:wg(t,"x","atan")};return my.runKernel("Atan",e)}}),xg({atan2_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=wg(t,"a","atan2"),r=wg(e,"b","atan2");[n,r]=uy(n,r);const s={a:n,b:r};return my.runKernel("Atan2",s)}}),xg({atanh_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:wg(t,"x","atanh")};return my.runKernel("Atanh",e)}});const uw=xg({reshape_:function(t,e){const n={x:wg(t,"x","reshape","string_or_numeric")},r={shape:e};return my.runKernel("Reshape",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cw=xg({avgPool_:function(t,e,n,r,s){const o=wg(t,"x","avgPool","float32");Dp(ow(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let i=o,a=!1;3===o.rank&&(a=!0,i=uw(o,[1,o.shape[0],o.shape[1],o.shape[2]])),Dp(4===i.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${i.rank}.`)),aw("avgPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s};let l=my.runKernel("AvgPool",u,c);return l=Qg(l,o.dtype),a?uw(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({avgPool3d_:function(t,e,n,r,s,o="NDHWC"){const i=wg(t,"x","avgPool3d","float32");let a=i,u=!1;4===i.rank&&(u=!0,a=uw(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),Dp(5===a.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`)),Dp("NDHWC"===o,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),aw("avgPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o};let f=my.runKernel("AvgPool3D",c,l);return f=Qg(f,a.dtype),u?uw(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});const lw=xg({concat_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0){Dp(t.length>=1,(()=>"Pass at least one tensor to concat"));const n=vg(t,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((t=>{if("complex64"!==t.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${t.dtype}. `)})),1===n.length)return tb(n[0]);const r=n,s={axis:e};return my.runKernel("Concat",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fw=xg({sigmoid_:function(t){const e={x:wg(t,"x","sigmoid","float32")};return my.runKernel("Sigmoid",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hw=xg({slice_:function(t,e,n){const r=wg(t,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const s={x:r},o={begin:e,size:n};return my.runKernel("Slice",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pw=xg({tanh_:function(t){const e={x:wg(t,"x","tanh","float32")};return my.runKernel("Tanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({basicLSTMCell_:function(t,e,n,r,s,o){const i=wg(t,"forgetBias","basicLSTMCell"),a=wg(e,"lstmKernel","basicLSTMCell"),u=wg(n,"lstmBias","basicLSTMCell"),c=wg(r,"data","basicLSTMCell"),l=wg(s,"c","basicLSTMCell"),f=wg(o,"h","basicLSTMCell"),h=lw([c,f],1),p=ub(h,a),d=Ub(p,u),m=d.shape[0],y=d.shape[1]/4,g=[m,y],b=hw(d,[0,0],g),w=hw(d,[0,y],g),v=hw(d,[0,2*y],g),x=hw(d,[0,3*y],g),N=Ub(qb(fw(b),pw(w)),qb(l,fw(Ub(i,v))));return[N,qb(pw(N),fw(x))]}});const dw=xg({batchToSpaceND_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=wg(t,"x","batchToSpaceND"),s=e.reduce(((t,e)=>t*e));Dp(r.rank>=1+e.length,(()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`)),Dp(n.length===e.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`)),Dp(r.shape[0]%s==0,(()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${s}`));const o={x:r},i={blockShape:e,crops:n};return my.runKernel("BatchToSpaceND",o,i)}});const mw=xg({batchNorm_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s,o){null==o&&(o=.001);const i=wg(t,"x","batchNorm"),a=wg(e,"mean","batchNorm"),u=wg(n,"variance","batchNorm");let c,l;null!=s&&(c=wg(s,"scale","batchNorm")),null!=r&&(l=wg(r,"offset","batchNorm")),Dp(a.rank===u.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),Dp(null==l||a.rank===l.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),Dp(null==c||a.rank===c.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const f=function(t){let e;return e=0===t.rank||1===t.rank?uw(t,[1,1,1,t.size]):2===t.rank?uw(t,[1,1,t.shape[0],t.shape[1]]):3===t.rank?uw(t,[1,t.shape[0],t.shape[1],t.shape[2]]):t,e}(i),h={x:f,scale:c,offset:l,mean:a,variance:u},p={varianceEpsilon:o},d=my.runKernel("FusedBatchNorm",h,p);return uw(d,i.shape)}});xg({batchNorm2d_:function(t,e,n,r,s,o){const i=wg(t,"x","batchNorm"),a=wg(e,"mean","batchNorm"),u=wg(n,"variance","batchNorm");let c,l;return null!=s&&(c=wg(s,"scale","batchNorm")),null!=r&&(l=wg(r,"offset","batchNorm")),Dp(2===i.rank,(()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`)),Dp(2===a.rank||1===a.rank,(()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`)),Dp(2===u.rank||1===u.rank,(()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`)),null!=c&&Dp(2===c.rank||1===c.rank,(()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`)),null!=l&&Dp(2===l.rank||1===l.rank,(()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${l.rank}.`)),mw(i,a,u,l,c,o)}}),xg({batchNorm3d_:function(t,e,n,r,s,o){const i=wg(t,"x","batchNorm"),a=wg(e,"mean","batchNorm"),u=wg(n,"variance","batchNorm");let c,l;return null!=s&&(c=wg(s,"scale","batchNorm")),null!=r&&(l=wg(r,"offset","batchNorm")),Dp(3===i.rank,(()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`)),Dp(3===a.rank||1===a.rank,(()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`)),Dp(3===u.rank||1===u.rank,(()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`)),null!=c&&Dp(3===c.rank||1===c.rank,(()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`)),null!=l&&Dp(3===l.rank||1===l.rank,(()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${l.rank}.`)),mw(i,a,u,l,c,o)}}),xg({batchNorm4d_:function(t,e,n,r,s,o){const i=wg(t,"x","batchNorm"),a=wg(e,"mean","batchNorm"),u=wg(n,"variance","batchNorm");let c,l;return null!=s&&(c=wg(s,"scale","batchNorm")),null!=r&&(l=wg(r,"offset","batchNorm")),Dp(4===i.rank,(()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`)),Dp(4===a.rank||1===a.rank,(()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`)),Dp(4===u.rank||1===u.rank,(()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`)),null!=c&&Dp(4===c.rank||1===c.rank,(()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`)),null!=l&&Dp(4===l.rank||1===l.rank,(()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${l.rank}.`)),mw(i,a,u,l,c,o)}});const yw=xg({bincount_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=wg(t,"x","bincount"),s=wg(e,"weights","bincount");Dp("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),Dp(n>=0,(()=>`size must be non-negative, but got ${n}.`)),Dp(s.size===r.size||0===s.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${s.shape}.`));const o={x:r,weights:s},i={size:n};return my.runKernel("Bincount",o,i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({broadcastArgs_:function(t,e){const n=wg(t,"s0","broadcastArgs","int32"),r=wg(e,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(1!==r.rank)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const s={s0:n,s1:r};return my.runKernel("BroadcastArgs",s)}});const gw=xg({broadcastTo_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=wg(t,"broadcastTo","x");const r=n.shape;if(e.some((t=>!(t>0)||t%1!=0)))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const t=n.shape.slice();for(;t.length<e.length;)t.unshift(1);n=uw(n,t)}const s=n.shape,o=Array.from(e);for(let t=e.length-1;t>=0;t--)if(s[t]===e[t])o[t]=1;else if(1!==n.shape[t])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);const i=o.map(((t,e)=>t>1?e:-1)).filter((t=>t>=0));if(0===i.length)return tb(n);const a={x:n},u={reps:o};return my.runKernel("Tile",a,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({ceil_:function(t){const e={x:wg(t,"x","ceil","float32")};return my.runKernel("Ceil",e)}}),xg({clipByValue_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=wg(t,"x","clipByValue");Dp(e<=n,(()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`));const s={x:r},o={clipValueMin:e,clipValueMax:n};return my.runKernel("ClipByValue",s,o)}}),xg({concat1d_:function(t){return lw(t,0)}}),xg({concat2d_:function(t,e){return lw(t,e)}}),xg({concat3d_:function(t,e){return lw(t,e)}}),xg({concat4d_:function(t,e){return lw(t,e)}});const bw=xg({conv2d_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s="NHWC",o=[1,1],i){const a=wg(t,"x","conv2d","float32"),u=wg(e,"filter","conv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=uw(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Dp(4===c.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`)),Dp(4===u.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`)),aw("conv2d",r,i);const f="NHWC"===s?c.shape[3]:c.shape[1];Dp(f===u.shape[2],(()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`)),Dp(ow(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const h={x:c,filter:u},p={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},d=my.runKernel("Conv2D",h,p);return l?uw(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});xg({conv1d_:function(t,e,n,r,s="NWC",o=1,i){const a=wg(t,"x","conv1d"),u=wg(e,"filter","conv1d");let c=a,l=!1;2===a.rank&&(l=!0,c=uw(a,[1,a.shape[0],a.shape[1]])),Dp(3===c.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`)),Dp(3===u.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`)),aw("conv1d",r,i),Dp(c.shape[2]===u.shape[1],(()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`)),Dp(ow(n,o),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${o}'`)),Dp("NWC"===s,(()=>`Error in conv1d: got dataFormat of ${s} but only NWC is currently supported.`));const f=uw(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=uw(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=bw(h,f,[1,n],r,"NHWC",[1,o],i);return uw(p,l?[p.shape[2],p.shape[3]]:[p.shape[0],p.shape[2],p.shape[3]])}});const ww=xg({conv2DBackpropInput_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s,o="NHWC",i){Dp(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let a=t,u=e,c=!1;3===e.rank&&(c=!0,u=uw(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),Dp(4===a.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`)),Dp(4===u.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`)),Dp(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const l="NHWC"===o?a[3]:a[1],f="NHWC"===o?u.shape[3]:u.shape[1];Dp(l===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[2]}.`)),Dp(f===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${n.shape[3]}.`)),aw("conv2dDerInput",s,i);const h={dy:u,filter:n},p={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,inputShape:a},d=my.runKernel("Conv2DBackpropInput",h,p);return c?uw(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});xg({conv2dTranspose_:function(t,e,n,r,s,o){const i=wg(t,"x","conv2dTranspose"),a=wg(e,"filter","conv2dTranspose");return ww(n,i,a,r,s,"NHWC",o)}}),xg({conv3d_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s="NDHWC",o=[1,1,1]){const i=wg(t,"x","conv3d"),a=wg(e,"filter","conv3d");let u=i,c=!1;4===i.rank&&(c=!0,u=uw(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),Dp(5===u.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`)),Dp(5===a.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`)),Dp(u.shape[4]===a.shape[3],(()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${a.shape[3]}.`)),Dp(ow(n,o),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),Dp("NDHWC"===s,(()=>`Error in conv3d: got dataFormat of ${s} but only NDHWC is currently supported.`));const l={x:u,filter:a},f={strides:n,pad:r,dataFormat:s,dilations:o},h=my.runKernel("Conv3D",l,f);return c?uw(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});const vw=xg({conv3DBackpropInput_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s){Dp(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let o=t,i=e,a=!1;4===e.rank&&(a=!0,i=uw(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,t[0],t[1],t[2],t[3]]);const u=o[4],c=i.shape[4];Dp(5===o.length,(()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`)),Dp(5===i.rank,(()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`)),Dp(5===n.rank,(()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`)),Dp(u===n.shape[3],(()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[3]}.`)),Dp(c===n.shape[4],(()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`));const l={dy:i,filter:n},f={pad:s,strides:r,inputShape:o},h=my.runKernel("Conv3DBackpropInputV2",l,f);return a?uw(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});xg({conv3dTranspose_:function(t,e,n,r,s){const o=wg(t,"x","conv3dTranspose"),i=wg(e,"filter","conv3dTranspose");return vw(n,o,i,r,s)}}),xg({cos_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:wg(t,"x","cos","float32")};return my.runKernel("Cos",e)}}),xg({cosh_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:wg(t,"x","cosh","float32")};return my.runKernel("Cosh",e)}}),xg({cumprod_:
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0,n=!1,r=!1){const s={x:wg(t,"x","cumprod")},o={axis:e,exclusive:n,reverse:r};return my.runKernel("Cumprod",s,o)}}),xg({cumsum_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0,n=!1,r=!1){const s={x:wg(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:r};return my.runKernel("Cumsum",s,o)}}),xg({denseBincount_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=!1){const s=wg(t,"x","denseBincount"),o=wg(e,"weights","denseBincount");Dp("int32"===s.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${s.dtype}`)),Dp(s.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${s.rank}.`)),Dp(n>=0,(()=>`size must be non-negative, but got ${n}.`)),Dp(o.size===s.size||0===o.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${s.shape}, weights shape: ${o.shape}.`));const i={x:s,weights:o},a={size:n,binaryOutput:r};return my.runKernel("DenseBincount",i,a)}}),xg({depthToSpace_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n="NHWC"){const r=wg(t,"x","depthToSpace","float32"),s="NHWC"===n?r.shape[1]:r.shape[2],o="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];Dp(e>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`)),Dp(s*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${s} and ${e}  for depthToSpace with input shape\n    ${r.shape}`)),Dp(o*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${o} and ${e} for depthToSpace with input shape\n        ${r.shape}`)),Dp(i%(e*e)==0,(()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${r.shape}`));const a={x:r},u={blockSize:e,dataFormat:n};return my.runKernel("DepthToSpace",a,u)}});const xw=xg({depthwiseConv2d_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s="NHWC",o=[1,1],i){const a=wg(t,"x","depthwiseConv2d","float32"),u=wg(e,"filter","depthwiseConv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=uw(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Dp(4===c.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`)),Dp(4===u.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`)),Dp(c.shape[3]===u.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`)),aw("depthwiseConv2d",r,i);const f={x:c,filter:u},h={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},p=my.runKernel("DepthwiseConv2dNative",f,h);return l?uw(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({diag_:function(t){const e={x:wg(t,"x","diag")};return my.runKernel("Diag",e)}}),xg({dilation2d_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s=[1,1],o="NHWC"){const i=wg(t,"x","dilation2d"),a=wg(e,"filter","dilation2d");Dp(3===i.rank||4===i.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`)),Dp(3===a.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`)),Dp("NHWC"===o,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`));let u=i,c=!1;3===i.rank&&(u=uw(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=!0);const l={x:u,filter:a},f={strides:n,pad:r,dilations:s},h=my.runKernel("Dilation2D",l,f);return c?uw(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});const Nw=xg({equal_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=wg(t,"a","equal","string_or_numeric"),r=wg(e,"b","equal","string_or_numeric");[n,r]=uy(n,r),wb(n.shape,r.shape);const s={a:n,b:r};return my.runKernel("Equal",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $w=xg({where_:function(t,e,n){const r=wg(e,"a","where"),s=wg(n,"b","where"),o=wg(t,"condition","where","bool"),i=wb(wb(o.shape,r.shape),s.shape),a={condition:gw(o,i),t:gw(r,i),e:gw(s,i)};return my.runKernel("Select",a)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ew=xg({zerosLike_:function(t){const e={x:wg(t,"x","zerosLike")};return my.runKernel("ZerosLike",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({divNoNan_:function(t,e){let n=wg(t,"a","div"),r=wg(e,"b","div");[n,r]=uy(n,r);const s=Gb(n,r),o=Ew(s),i=Nw(r,o);return $w(i,o,s)}}),xg({dot_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=wg(t,"t1","dot"),r=wg(e,"t2","dot");Dp(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`));const s=1===n.rank?n.size:n.shape[1],o=1===r.rank?r.size:r.shape[0];if(Dp(s===o,(()=>`Error in dot: inner dimensions of inputs must match, but got ${s} and ${o}.`)),1===n.rank&&1===r.rank){const t=uw(n,[1,-1]),e=uw(r,[-1,1]),s=ub(t,e);return uw(s,[])}if(1===n.rank&&2===r.rank){const t=uw(n,[1,-1]),e=uw(r,[r.shape[0],r.shape[1]]),s=ub(t,e);return uw(s,[s.size])}if(2===n.rank&&1===r.rank){const t=uw(r,[-1,1]),e=ub(n,t);return uw(e,[e.size])}{const t=uw(r,[r.shape[0],r.shape[1]]);return ub(n,t)}}}),xg({einsum_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,...e){const n=e.map(((t,e)=>wg(t,`tensors${e}`,"einsum"))),r={equation:t};return my.runKernel("Einsum",n,r)}});const Sw=xg({elu_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:wg(t,"x","elu","float32")};return my.runKernel("Elu",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function _w(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function Tw(t,e,n){const r=t.length+e.length,s=[];let o=0,i=0;for(let a=0;a<r;a++)-1===n.indexOf(a)?s.push(t[o++]):s.push(e[i++]);return s}function kw(t,e){const n=[],r=t.length;for(let s=0;s<r;s++)-1===e.indexOf(s)&&n.push(t[s]);return[n,e.map((e=>t[e]))]}function Aw(t,e){return Tw(t,e.map((t=>1)),e)}function Cw(t,e,n){Dp(_w(e,n),(()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`))}function Ow(t,e){if(_w(t,e))return null;const n=[];for(let r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach((t=>n.push(t))),n}function Iw(t){return t.map(((t,e)=>[e,t])).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]))}function Mw(t,e){const n=[];for(let r=e-t;r<e;++r)n.push(r);return n}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({erf_:function(t){let e=wg(t,"x","erf");Dp("int32"===e.dtype||"float32"===e.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===e.dtype&&(e=Qg(e,"float32"));const n={x:e};return my.runKernel("Erf",n)}});const Rw=xg({max_:function(t,e=null,n=!1){const r={x:wg(t,"x","max")},s={reductionIndices:e,keepDims:n};return my.runKernel("Max",r,s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dw=xg({min_:function(t,e=null,n=!1){const r={x:wg(t,"x","min")},s={axis:e,keepDims:n};return my.runKernel("Min",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fw=xg({pow_:function(t,e){let n=wg(t,"base","pow"),r=wg(e,"exp","pow");[n,r]=uy(n,r);const s={a:n,b:r};return my.runKernel("Pow",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lw(t,e){if((Xp(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&Xp(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return $g(t,[],[],e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pw=xg({sqrt_:function(t){const e={x:wg(t,"x","sqrt","float32")};return my.runKernel("Sqrt",e)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bw=xg({square_:function(t){const e=wg(t,"x","square");return my.runKernel("Square",{x:e},{})}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vw=xg({sum_:function(t,e=null,n=!1){let r=wg(t,"x","sum");"bool"===r.dtype&&(r=Qg(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return my.runKernel("Sum",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zw(t,e,n=null){if(0===t.rank)return Hb(t);if(1!==t.rank&&null===n)return zw(uw(t,[-1]),e,n);if(1===t.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===e)return Vw(Hb(t),n);if(e===1/0)return Rw(Hb(t),n);if(e===-1/0)return Dw(Hb(t),n);if("euclidean"===e||2===e)return Pw(Vw(Fw(Hb(t),Lw(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&2===n.length){if(1===e)return Rw(Vw(Hb(t),n[0]),n[1]-1);if(e===1/0)return Rw(Vw(Hb(t),n[1]),n[0]);if(e===-1/0)return Dw(Vw(Hb(t),n[1]),n[0]);if("fro"===e||"euclidean"===e)return Pw(Vw(Bw(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const Ww=xg({norm_:function(t,e="euclidean",n=null,r=!1){const s=zw(t=wg(t,"x","norm"),e,n);let o=s.shape;if(r){const e=Gp(n,t.shape);o=Aw(s.shape,e)}return uw(s,o)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({euclideanNorm_:function(t,e=null,n=!1){return Ww(t,"euclidean",e,n)}});const Uw=xg({exp_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:wg(t,"x","exp")};return my.runKernel("Exp",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jw=xg({expandDims_:function(t,e=0){const n=wg(t,"x","expandDims","string_or_numeric");Dp(e<=n.rank,(()=>"Axis must be <= rank of the tensor"));const r={input:n},s={dim:e};return my.runKernel("ExpandDims",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({expm1_:function(t){const e={x:wg(t,"x","expm1")};return my.runKernel("Expm1",e)}});const Gw=xg({tile_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=wg(t,"x","tile","string_or_numeric");Dp(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`));const r={x:n},s={reps:e};return my.runKernel("Tile",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qw=xg({eye_:function(t,e,n,r="float32"){null==e&&(e=t);const s=Zg([t,e],r),o=t<=e?t:e;for(let t=0;t<o;++t)s.set(1,t,t);const i=uw(s.toTensor(),[t,e]);if(null==n)return i;if(1===n.length)return Gw(jw(i,0),[n[0],1,1]);if(2===n.length)return Gw(jw(jw(i,0),0),[n[0],n[1],1,1]);if(3===n.length)return Gw(jw(jw(jw(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hw(t,e,n){const r={shape:t,value:e,dtype:n};return my.runKernel("Fill",{},r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kw=xg({floor_:function(t){const e={x:wg(t,"x","floor","float32")};return my.runKernel("Floor",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({gather_:function(t,e,n=0,r=0){const s={x:wg(t,"x","gather"),indices:wg(e,"indices","gather","int32")},o={axis:n,batchDims:r};return my.runKernel("GatherV2",s,o)}});const Xw=xg({greater_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=wg(t,"a","greater","string_or_numeric"),r=wg(e,"b","greater","string_or_numeric");[n,r]=uy(n,r),wb(n.shape,r.shape);const s={a:n,b:r};return my.runKernel("Greater",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jw=xg({greaterEqual_:function(t,e){let n=wg(t,"a","greaterEqual","string_or_numeric"),r=wg(e,"b","greaterEqual","string_or_numeric");[n,r]=uy(n,r),wb(n.shape,r.shape);const s={a:n,b:r};return my.runKernel("GreaterEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({isFinite_:function(t){const e={x:wg(t,"x","isFinite")};return my.runKernel("IsFinite",e)}}),xg({isInf_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:wg(t,"x","isInf")};return my.runKernel("IsInf",e)}}),xg({isNaN_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:wg(t,"x","isNaN")};return my.runKernel("IsNan",e)}});const Yw=xg({leakyRelu_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=.2){const n={x:wg(t,"x","leakyRelu")},r={alpha:e};return my.runKernel("LeakyRelu",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({less_:function(t,e){let n=wg(t,"a","less","string_or_numeric"),r=wg(e,"b","less","string_or_numeric");[n,r]=uy(n,r),wb(n.shape,r.shape);const s={a:n,b:r};return my.runKernel("Less",s)}});const Zw=xg({lessEqual_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=wg(t,"a","lessEqual","string_or_numeric"),r=wg(e,"b","lessEqual","string_or_numeric");[n,r]=uy(n,r),wb(n.shape,r.shape);const s={a:n,b:r};return my.runKernel("LessEqual",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({localResponseNormalization_:function(t,e=5,n=1,r=1,s=.5){const o=wg(t,"x","localResponseNormalization");Dp(4===o.rank||3===o.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${o.rank}.`)),Dp(zp(e),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`));let i=o,a=!1;3===o.rank&&(a=!0,i=uw(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const u={x:i},c={depthRadius:e,bias:n,alpha:r,beta:s},l=my.runKernel("LRN",u,c);return a?uw(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});const Qw=xg({log_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:wg(t,"x","log","float32")};return my.runKernel("Log",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tv=xg({log1p_:function(t){const e={x:wg(t,"x","log1p")};return my.runKernel("Log1p",e)}});function ev(t){return my.customGrad(t)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nv=xg({softplus_:function(t){const e={x:wg(t,"x","softplus")};return my.runKernel("Softplus",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({logSigmoid_:function(t){const e=wg(t,"x","logSigmoid"),n=ev((t=>({value:db(nv(db(t))),gradFunc:e=>qb(e,fw(db(t)))})));return n(e)}});const rv=xg({sub_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=wg(t,"a","sub"),r=wg(e,"b","sub");[n,r]=uy(n,r);const s={a:n,b:r};return my.runKernel("Sub",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({logSoftmax_:function(t,e=-1){const n=wg(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);const r=ev(((t,n)=>{const r=Rw(t,e,!0),s=rv(t,r),o=rv(Qg(s,"float32"),Qw(Vw(Uw(s),e,!0)));n([o]);return{value:o,gradFunc:(t,n)=>{const[r]=n,s=Uw(r);return rv(t,qb(Vw(t,e,!0),s))}}}));return r(n)}});const sv=xg({logSumExp_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=null,n=!1){const r=wg(t,"x","logSumExp"),s=Gp(e,r.shape),o=Rw(r,s,!0),i=rv(r,o),a=Uw(i),u=Vw(a,s),c=Qw(u),l=Ub(uw(o,c.shape),c);if(n){const t=Aw(l.shape,s);return uw(l,t)}return l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ov=xg({logicalAnd_:function(t,e){const n=wg(t,"a","logicalAnd","bool"),r=wg(e,"b","logicalAnd","bool");wb(n.shape,r.shape);const s={a:n,b:r};return my.runKernel("LogicalAnd",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iv=xg({logicalNot_:function(t){const e={x:wg(t,"x","logicalNot","bool")};return my.runKernel("LogicalNot",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const av=xg({logicalOr_:function(t,e){const n=wg(t,"a","logicalOr","bool"),r=wg(e,"b","logicalOr","bool");wb(n.shape,r.shape);const s={a:n,b:r};return my.runKernel("LogicalOr",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({logicalXor_:function(t,e){const n=wg(t,"a","logicalXor","bool"),r=wg(e,"b","logicalXor","bool");return wb(n.shape,r.shape),ov(av(t,e),iv(ov(t,e)))}});xg({searchSorted_:function(t,e,n="left"){const r=wg(t,"sortedSequence","searchSorted"),s=wg(e,"values","searchSorted"),o=r.shape[r.shape.length-1],i=s.shape[s.shape.length-1],a=uw(r,[-1,o]),u=uw(s,[-1,i]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Bp(u.shape)>=2147483648)throw new Error("values tensor size must less than 2147483648");if(a.shape[1]>=2147483648)throw new Error(`trailing dim_size must less than 2147483648 for int32 output type, was ${a.shape[1]}`);const c={sortedSequence:a,values:u},l={side:n};return my.runKernel("SearchSorted",c,l)}});const uv=xg({maxPool_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s){const o=wg(t,"x","maxPool");let i=o,a=!1;3===o.rank&&(a=!0,i=uw(o,[1,o.shape[0],o.shape[1],o.shape[2]])),Dp(4===i.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${i.rank}.`)),Dp(ow(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),aw("maxPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s},l=my.runKernel("MaxPool",u,c);return a?uw(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({maxPool3d_:function(t,e=[1,1,1],n,r,s,o="NDHWC"){const i=wg(t,"x","maxPool3d");let a=i,u=!1;4===i.rank&&(u=!0,a=uw(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),Dp(5===a.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`)),Dp("NDHWC"===o,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),aw("maxPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o},f=my.runKernel("MaxPool3D",c,l);return u?uw(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}}),xg({maxPoolWithArgmax_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s=!1){const o={x:wg(t,"x","maxPoolWithArgmax")},i={filterSize:e,strides:n,pad:r,includeBatchInIndex:s},a=my.runKernel("MaxPoolWithArgmax",o,i);return{result:a[0],indexes:a[1]}}});const cv=xg({maximum_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=wg(t,"a","maximum"),r=wg(e,"b","maximum");[n,r]=uy(n,r),"bool"===n.dtype&&(n=Qg(n,"int32"),r=Qg(r,"int32")),wb(n.shape,r.shape);const s={a:n,b:r};return my.runKernel("Maximum",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lv=xg({mean_:function(t,e=null,n=!1){const r={x:wg(t,"x","mean")},s={axis:e,keepDims:n};return my.runKernel("Mean",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fv(t,e="float32"){if("complex64"===e){const e=fv(t,"float32"),n=fv(t,"float32");return Ng(e,n)}const n=od(Bp(t),e);return my.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hv(t,e="float32"){if("complex64"===e){const e=hv(t,"float32"),n=fv(t,"float32");return Ng(e,n)}const n=sd(Bp(t),e);return my.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pv=xg({minimum_:function(t,e){let n=wg(t,"a","minimum"),r=wg(e,"b","minimum");[n,r]=uy(n,r),"bool"===n.dtype&&(n=Qg(n,"int32"),r=Qg(r,"int32")),wb(n.shape,r.shape);const s={a:n,b:r};return my.runKernel("Minimum",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({mirrorPad_:function(t,e,n){Dp("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const r=wg(t,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");Dp(e.length===r.rank,(()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`));const s="reflect"===n?1:0;for(let t=0;t<r.rank;t++)Dp(2===e[t].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),Dp(e[t][0]>=0&&e[t][0]<=r.shape[t]-s&&e[t][1]>=0&&e[t][1]<=r.shape[t]-s,(()=>`Padding in dimension ${t} cannot be greater than or equal to ${r.shape[t]-s} or less than 0 for input of shape ${r.shape}`));const o={paddings:e,mode:n},i={x:r};return my.runKernel("MirrorPad",i,o)}}),xg({mod_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=wg(t,"a","mod"),r=wg(e,"b","mod");[n,r]=uy(n,r);const s={a:n,b:r};return my.runKernel("Mod",s)}}),xg({moments_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=null,n=!1){const r=Gp(e,(t=wg(t,"x","moments")).shape),s=lv(t,r,n);let o=s.shape;n||(o=Aw(s.shape,r));const i=Bw(rv(Qg(t,"float32"),uw(s,o)));return{mean:s,variance:lv(i,r,n)}}}),xg({multiRNNCell_:function(t,e,n,r){const s=wg(e,"data","multiRNNCell"),o=vg(n,"c","multiRNNCell"),i=vg(r,"h","multiRNNCell");let a=s;const u=[];for(let e=0;e<t.length;e++){const n=t[e](a,o[e],i[e]);u.push(n[0]),u.push(n[1]),a=n[1]}const c=[],l=[];for(let t=0;t<u.length;t+=2)c.push(u[t]),l.push(u[t+1]);return[c,l]}}),xg({multinomial_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=!1){const s=wg(t,"logits","multinomial"),o=s.size,i=s.rank;if(o<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${o}.`);if(i>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${i}`);n=n||Math.random();const a={logits:1===i?uw(s,[1,-1]):s},u={numSamples:e,seed:n,normalized:r},c=my.runKernel("Multinomial",a,u);return 1===i?uw(c,[c.size]):c}});const dv=xg({notEqual_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=wg(t,"a","notEqual","string_or_numeric"),r=wg(e,"b","notEqual","string_or_numeric");[n,r]=uy(n,r),wb(n.shape,r.shape);const s={a:n,b:r};return my.runKernel("NotEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({onesLike_:function(t){const e={x:wg(t,"x","onesLike")};return my.runKernel("OnesLike",e)}}),xg({outerProduct_:function(t,e){const n=wg(t,"v1","outerProduct"),r=wg(e,"v2","outerProduct");Dp(1===n.rank&&1===r.rank,(()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`));const s=uw(n,[-1,1]),o=uw(r,[1,-1]);return ub(s,o)}});const mv=xg({pad_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n=0){const r=wg(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:n},o={x:r};return my.runKernel("PadV2",o,s)}});xg({pad1d_:function(t,e,n=0){return Dp(2===e.length,(()=>"Invalid number of paddings. Must be length of 2.")),mv(t,[e],n)}}),xg({pad2d_:function(t,e,n=0){return Dp(2===e.length&&2===e[0].length&&2===e[1].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),mv(t,e,n)}}),xg({pad3d_:function(t,e,n=0){return Dp(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),mv(t,e,n)}}),xg({pad4d_:function(t,e,n=0){return Dp(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),mv(t,e,n)}});const yv=xg({spaceToBatchND_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=wg(t,"x","spaceToBatchND");Dp(r.rank>=1+e.length,(()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`)),Dp(n.length===e.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`)),Dp(r.shape.reduce(((t,r,s)=>s>0&&s<=e.length?t&&(r+n[s-1][0]+n[s-1][1])%e[s-1]==0:t),!0),(()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`));const s={x:r},o={blockShape:e,paddings:n};return my.runKernel("SpaceToBatchND",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({pool_:function(t,e,n,r,s,o,i){null==s&&(s=[1,1]),null==o&&(o=1),0===r&&(r="valid");const a=wg(t,"x","maxPool");let u=a,c=!1;3===a.rank&&(c=!0,u=uw(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Dp(ow(o,s),(()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${s}'`));const l=Xb(u.shape,e,o,s,r),f=[l.dilationHeight,l.dilationWidth];let h;h="same"===r?function(t,e){const n=t.map(((t,n)=>t+(t-1)*(e[n]-1))),r=n.map((t=>t-1)),s=r.map((t=>Math.floor(t/2))),o=r.map(((t,e)=>t-s[e]));return r.map(((t,e)=>[s[e],o[e]]))}([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];const p=1===f[0]&&1===f[1],[d,m]=function(t,e,n){const r=n.map((t=>t[0])),s=n.map((t=>t[1])),o=t.concat(r,s),i=e.map(((t,e)=>(t-o[e]%t)%t)),a=s.map(((t,e)=>t+i[e])),u=e.map(((t,e)=>[r[e],a[e]])),c=e.map(((t,e)=>[0,i[e]]));return[u,c]}([l.inHeight,l.inWidth],f,h),y=p?r:"valid",g=p?u:yv(u,f,d),b=("avg"===n?()=>cw(g,e,o,y,i):()=>uv(g,e,o,y,i))(),w=p?b:dw(b,f,m);return c?uw(w,[w.shape[1],w.shape[2],w.shape[3]]):w}});const gv=xg({prelu_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n={x:wg(t,"x","prelu"),alpha:wg(e,"alpha","prelu")};return my.runKernel("Prelu",n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({prod_:function(t,e=null,n=!1){let r=wg(t,"x","prod");"bool"===r.dtype&&(r=Qg(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return my.runKernel("Prod",s,o)}}),xg({rand_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=Bp(t);let s=null;if(null==n||"float32"===n)s=new Float32Array(r);else if("int32"===n)s=new Int32Array(r);else{if("bool"!==n)throw new Error(`Unknown data type ${n}`);s=new Uint8Array(r)}for(let t=0;t<r;t++)s[t]=e();return my.makeTensor(s,t,n)}});var bv={exports:{}};!function(t,e,n){function r(t){var e=this,n=function(){var t=4022871197,e=function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)};return e}();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}function s(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var n=new r(t),o=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.alea=o}(0,bv,!1);var wv=Yd(kp({__proto__:null,default:bv.exports},[bv.exports])),vv={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor128=o}(0,vv,!1);var xv=Yd(kp({__proto__:null,default:vv.exports},[vv.exports])),Nv={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorwow=o}(0,Nv,!1);var $v=Yd(kp({__proto__:null,default:Nv.exports},[Nv.exports])),Ev={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,s=e.i;return t=r[s],n=(t^=t>>>7)^t<<24,n^=(t=r[s+1&7])^t>>>10,n^=(t=r[s+3&7])^t>>>3,n^=(t=r[s+4&7])^t<<7,t=r[s+7&7],n^=(t^=t<<13)^t<<9,r[s]=n,e.i=s+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function s(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.x&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorshift7=o}(0,Ev,!1);var Sv=Yd(kp({__proto__:null,default:Ev.exports},[Ev.exports])),_v={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,s=e.X,o=e.i;return e.w=r=r+1640531527|0,n=s[o+34&127],t=s[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=s[o]=n^t,e.i=o,n+(r^r>>>16)|0},function(t,e){var n,r,s,o,i,a=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),s=0,o=-32;o<u;++o)e&&(r^=e.charCodeAt((o+32)%e.length)),0===o&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(i=i+1640531527|0,s=0==(n=a[127&o]^=r+i)?s+1:0);for(s>=128&&(a[127&(e&&e.length||0)]=-1),s=127,o=512;o>0;--o)r=a[s+34&127],n=a[s=s+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,a[s]=r^n;t.w=i,t.X=a,t.i=s}(e,t)}function s(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.X&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor4096=o}(0,_v,!1);var Tv=Yd(kp({__proto__:null,default:_v.exports},[_v.exports])),kv={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,s=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^s,s=s-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^s,e.a=s-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.tychei=o}(0,kv,!1);var Av=Yd(kp({__proto__:null,default:kv.exports},[kv.exports])),Cv={exports:{}};!function(t){!function(e,n){var r,s=this,o=256,i=n.pow(o,6),a=n.pow(2,52),u=2*a,c=255;function l(t,c,l){var y=[],g=d(p((c=1==c?{entropy:!0}:c||{}).entropy?[t,m(e)]:null==t?function(){try{var t;return r&&(t=r.randomBytes)?t=t(o):(t=new Uint8Array(o),(s.crypto||s.msCrypto).getRandomValues(t)),m(t)}catch(t){var n=s.navigator,i=n&&n.plugins;return[+new Date,s,i,s.screen,m(e)]}}():t,3),y),b=new f(y),w=function(){for(var t=b.g(6),e=i,n=0;t<a;)t=(t+n)*o,e*=o,n=b.g(1);for(;t>=u;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,d(m(b.S),e),(c.pass||l||function(t,e,r,s){return s&&(s.S&&h(s,b),t.state=function(){return h(b,{})}),r?(n.random=t,e):t})(w,g,"global"in c?c.global:this==n,c.state)}function f(t){var e,n=t.length,r=this,s=0,i=r.i=r.j=0,a=r.S=[];for(n||(t=[n++]);s<o;)a[s]=s++;for(s=0;s<o;s++)a[s]=a[i=c&i+t[s%n]+(e=a[s])],a[i]=e;(r.g=function(t){for(var e,n=0,s=r.i,i=r.j,a=r.S;t--;)e=a[s=c&s+1],n=n*o+a[c&(a[s]=a[i=c&i+e])+(a[i]=e)];return r.i=s,r.j=i,n})(o)}function h(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function p(t,e){var n,r=[],s=typeof t;if(e&&"object"==s)for(n in t)try{r.push(p(t[n],e-1))}catch(t){}return r.length?r:"string"==s?t:t+"\0"}function d(t,e){for(var n,r=t+"",s=0;s<r.length;)e[c&s]=c&(n^=19*e[c&s])+r.charCodeAt(s++);return m(e)}function m(t){return String.fromCharCode.apply(0,t)}if(n.seedrandom=l,d(n.random(),e),t.exports){t.exports=l;try{r=require("crypto")}catch(t){}}}([],Math)}(Cv);var Ov=wv,Iv=xv,Mv=$v,Rv=Sv,Dv=Tv,Fv=Av,Lv=Yd(kp({__proto__:null,default:Cv.exports},[Cv.exports]));Lv.alea=Ov,Lv.xor128=Iv,Lv.xorwow=Mv,Lv.xorshift7=Rv,Lv.xor4096=Dv,Lv.tychei=Fv;var Pv=Lv;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bv{constructor(t,e,n,r,s){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const o=s||Math.random();this.random=Pv.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const t=this.nextVal;return this.nextVal=NaN,t}let t,e,n=!1;for(;!n;){let r,s,o;do{r=2*this.random()-1,s=2*this.random()-1,o=r*r+s*s}while(o>=1||0===o);const i=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*r*i,e=this.mean+this.stdDev*s*i,this.truncated&&!this.isValidTruncated(t)||(n=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class Vv{constructor(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;const s=r||Math.random();this.randu=Pv.alea(s.toString()),this.randn=new Bv(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,e,n,r,s,o;for(;;){do{r=this.randn.nextValue(),o=1+this.c*r}while(o<=0);if(o*=o*o,t=r*r,e=1-.331*t*t,n=.5*t+this.d*(1-o+Math.log(o)),s=this.randu(),s<e||Math.log(s)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(t){return"float32"===this.dtype?t:Math.round(t)}}class zv{constructor(t=0,e=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=Pv.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({randomGamma_:function(t,e,n=1,r="float32",s){if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error(`Unsupported data type ${r}`);const o=new Vv(e,n,r,s),i=Zg(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}}),xg({randomNormal_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0,n=1,r,s){if(null!=r&&"bool"===r)throw new Error(`Unsupported data type ${r}`);const o=new Bv(e,n,r,!1,s),i=Zg(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});const Wv=xg({randomUniform_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0,n=1,r="float32",s){const o=Zg(t,r),i=new zv(e,n,null,s);for(let t=0;t<o.values.length;t++)o.values[t]=i.nextValue();return o.toTensor()}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uv(t,e,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");const s={start:t,stop:e,step:n,dtype:r};return my.runKernel("Range",{},s)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({reciprocal_:function(t){const e={x:wg(t,"x","reciprocal")};return my.runKernel("Reciprocal",e)}});const jv=xg({relu_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:wg(t,"x","relu")};return my.runKernel("Relu",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gv=xg({relu6_:function(t){const e={x:wg(t,"x","relu6")};return my.runKernel("Relu6",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qv=xg({reverse_:function(t,e){const n={x:wg(t,"x","reverse")},r={dims:e};return my.runKernel("Reverse",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({reverse1d_:function(t){const e=wg(t,"x","reverse");return Dp(1===e.rank,(()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`)),qv(e,0)}}),xg({reverse2d_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=wg(t,"x","reverse");return Dp(2===n.rank,(()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`)),qv(n,e)}}),xg({reverse3d_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=wg(t,"x","reverse");return Dp(3===n.rank,(()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`)),qv(n,e)}}),xg({reverse4d_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=wg(t,"x","reverse");return Dp(4===n.rank,(()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`)),qv(n,e)}});const Hv=xg({round_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:wg(t,"x","round")};return my.runKernel("Round",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({rsqrt_:function(t){const e={x:wg(t,"x","rsqrt","float32")};return my.runKernel("Rsqrt",e)}}),xg({selu_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:wg(t,"x","selu")};return my.runKernel("Selu",e)}}),xg({separableConv2d_:function(t,e,n,r,s,o=[1,1],i="NHWC"){const a=wg(t,"x","separableConv2d"),u=wg(e,"depthwiseFilter","separableConv2d"),c=wg(n,"pointwiseFilter","separableConv2d");let l=a,f=!1;if(3===a.rank&&(f=!0,l=uw(a,[1,a.shape[0],a.shape[1],a.shape[2]])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Dp(4===l.rank,(()=>`Error in separableConv2d: input must be rank 4, but got rank ${l.rank}.`)),Dp(4===u.rank,(()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`)),Dp(4===c.rank,(()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`)),Dp(1===c.shape[0],(()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`)),Dp(1===c.shape[1],(()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`));const h=u.shape[2],p=u.shape[3];Dp(c.shape[2]===h*p,(()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*p}, but got ${c.shape[2]}.`));const d=xw(l,u,r,s,i,o),m=bw(d,c,1,"valid",i);return f?uw(m,[m.shape[1],m.shape[2],m.shape[3]]):m}}),xg({sign_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:wg(t,"x","sign")};return my.runKernel("Sign",e)}}),xg({sin_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:wg(t,"x","sin","float32")};return my.runKernel("Sin",e)}}),xg({sinh_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:wg(t,"x","sinh")};return my.runKernel("Sinh",e)}}),xg({slice1d_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=wg(t,"x","slice1d");return Dp(1===r.rank,(()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`)),hw(r,[e],[n])}}),xg({slice2d_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=wg(t,"x","slice2d");return Dp(2===r.rank,(()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`)),hw(r,e,n)}}),xg({slice3d_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=wg(t,"x","slice3d");return Dp(3===r.rank,(()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`)),hw(r,e,n)}}),xg({slice4d_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=wg(t,"x","slice4d");return Dp(4===r.rank,(()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`)),hw(r,e,n)}}),xg({softmax_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=-1){const n=wg(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const r={logits:n},s={dim:e};return my.runKernel("Softmax",r,s)}});const Kv=xg({fft_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){Dp("complex64"===t.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`));const e={input:t};return my.runKernel("FFT",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xv=xg({ifft_:function(t){Dp("complex64"===t.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`));const e={input:t};return my.runKernel("IFFT",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({irfft_:function(t){const e=t.shape[t.shape.length-1],n=t.size/e;let r;if(e<=2){const s=uw(t,[n,e]);r=Xv(s)}else{const s=[n,2*(e-1)],o=uw(mb(t),[n,e]),i=uw(pb(t),[n,e]),a=qv(hw(o,[0,1],[n,e-2]),1),u=qb(qv(hw(i,[0,1],[n,e-2]),1),Lw(-1)),c=lw([o,a],1),l=lw([i,u],1),f=uw(Ng(c,l),[s[0],s[1]]);r=Xv(f)}if(r=mb(r),3===t.rank&&0!==t.shape[0]){const e=r,n=t.shape[0];r=uw(r,[n,r.shape[0]/n,r.shape[1]]),e.dispose()}return r}});const Jv=xg({split_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n=0){const r={x:wg(t,"x","split")},s={numOrSizeSplits:e,axis:n};return my.runKernel("SplitV",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yv=xg({rfft_:function(t,e){Dp("float32"===t.dtype,(()=>`The dtype for rfft() must be real value but got ${t.dtype}`));let n=t.shape[t.shape.length-1];const r=t.size/n;let s;if(null!=e&&e<n){const r=t.shape.map((t=>0)),o=t.shape.map((t=>t));o[t.shape.length-1]=e,s=hw(t,r,o),n=e}else if(null!=e&&e>n){const r=t.shape.map((t=>t));r[t.shape.length-1]=e-n,s=lw([t,fv(r)],t.shape.length-1),n=e}else s=t;const o=Ew(s),i=uw(Ng(s,o),[r,n]),a=Kv(i),u=Math.floor(n/2)+1,c=mb(a),l=pb(a),f=Jv(c,[u,n-u],c.shape.length-1),h=Jv(l,[u,n-u],l.shape.length-1),p=s.shape.slice();return p[s.shape.length-1]=u,uw(Ng(f[0],h[0]),p)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zv=xg({squaredDifference_:function(t,e){let n=wg(t,"a","squaredDifference"),r=wg(e,"b","squaredDifference");[n,r]=uy(n,r),wb(n.shape,r.shape);const s={a:n,b:r};return my.runKernel("SquaredDifference",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qv=xg({squeeze_:function(t,e){const n=wg(t,"x","squeeze");return uw(n,qp(n.shape,e).newShape)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tx=xg({stack_:function(t,e=0){const n=vg(t,"tensors","stack","string_or_numeric");Dp(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&Dp(e<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const r=n,s={axis:e};return my.runKernel("Pack",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ex=xg({step_:function(t,e=0){const n={x:wg(t,"x","step")},r={alpha:e};return my.runKernel("Step",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function nx(t,e){Lp(t);const n=yg(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return $g(t,null,n,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rx(t,e,n){if(Lp(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");const r=yg(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return $g(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({stridedSlice_:function(t,e,n,r,s=0,o=0,i=0,a=0,u=0){const c={x:wg(t,"x","stridedSlice","string_or_numeric")},l={begin:e,end:n,strides:r,beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};return my.runKernel("StridedSlice",c,l)}}),xg({tan_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={x:wg(t,"x","tan","float32")};return my.runKernel("Tan",e)}}),xg({topk_:function(t,e=1,n=!0){const r=wg(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const s=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const o={x:r},i={k:e,sorted:n},[a,u]=my.runKernel("TopK",o,i);return{values:a,indices:u}}}),xg({truncatedNormal_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0,n=1,r,s){if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const o=new Bv(e,n,r,!0,s),i=Zg(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}}),xg({unique_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0){const n=wg(t,"x","unique","string_or_numeric");Dp(n.rank>0,(()=>"The input tensor must be at least 1D"));const r={x:n},s={axis:e},[o,i]=my.runKernel("Unique",r,s);return{values:o,indices:i}}}),xg({unsortedSegmentSum_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=wg(t,"x","unsortedSegmentSum"),s=wg(e,"segmentIds","unsortedSegmentSum","int32");Dp(zp(n),(()=>"numSegments must be of dtype int"));const o={x:r,segmentIds:s},i={numSegments:n};return my.runKernel("UnsortedSegmentSum",o,i)}});const sx=xg({unstack_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=0){const n=wg(t,"x","unstack","string_or_numeric");Dp(e>=-n.shape.length&&e<n.shape.length,(()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`));const r={value:n},s={axis:e};return my.runKernel("Unpack",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ox(t,e,n){const r=1-t%2,s=new Float32Array(t);for(let o=0;o<t;++o){const i=2*Math.PI*o/(t+r-1);s[o]=e-n*Math.cos(i)}return nx(s,"float32")}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({movingAverage_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s=!0){const o=wg(t,"v","movingAverage"),i=wg(e,"x","movingAverage"),a=wg(n,"decay","movingAverage");!function(t,e){Dp(t.dtype===e.dtype,(()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`))}(o,i),Dp(Vp(o.shape,i.shape),(()=>"Shape mismatch in v and x"));const u=Lw(1),c=rv(u,a);let l=qb(rv(i,o),c);if(s){Dp(null!=r,(()=>"When using zeroDebias: true, step is required."));const t=wg(r,"step","movingAverage");l=Gb(l,rv(u,Fw(a,t)))}return Ub(o,l)}}),xg({scatterND_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=wg(t,"indices","scatterND","int32"),s=wg(e,"updates","scatterND");$b(s,r,n);const o={indices:r,updates:s},i={shape:n};return my.runKernel("ScatterNd",o,i)}}),xg({sparseToDense_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=0){const s=wg(t,"sparseIndices","sparseToDense","int32"),o=wg(e,"sparseValues","sparseToDense","string_or_numeric"),i=wg(r,"defaultValue","sparseToDense",o.dtype);!function(t,e,n,r){if("int32"!==t.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const s=t.rank>0?t.shape[0]:1,o=t.rank>1?t.shape[1]:1;if(n.length!==o)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${o}.`);const i=e.size;if(0!==e.rank&&(1!==e.rank||i!==s))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${s}]`);if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(s,o,n,i);const a={sparseIndices:s,sparseValues:o,defaultValue:i},u={outputShape:n};return my.runKernel("SparseToDense",a,u)}}),xg({gatherND_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=wg(e,"indices","gatherND","int32"),r={params:wg(t,"x","gatherND","string_or_numeric"),indices:n};return my.runKernel("GatherNd",r)}}),xg({dropout_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const s=wg(t,"x","dropout");if(Dp("float32"===s.dtype,(()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${s.dtype} tensor instead.`)),Dp(e>=0&&e<1,(()=>`rate must be a float in the range [0, 1), but got ${e}.`)),0===e)return t instanceof Zm?s.clone():s;const o=
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){if(null==e)return t.shape.slice();if(Vp(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let r=0;r<t.shape.length;r++)null==e[r]&&null!=t.shape[r]?n.push(t.shape[r]):n.push(e[r]);return n}return e}(s,n),i=1-e,a=Gb(Kw(Ub(Wv(o,0,1,"float32",r),i)),i);return qb(s,a)}});const ix=xg({conv2DBackpropFilter_:function(t,e,n,r,s,o="NHWC",i){let a=t;3===t.rank&&(a=uw(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=uw(e,[1,e.shape[0],e.shape[1],e.shape[2]])),Dp(4===a.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`)),Dp(4===u.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`)),Dp(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const c="NHWC"===o?a.shape[3]:a.shape[1],l="NHWC"===o?u.shape[3]:u.shape[1];Dp(c===n[2],(()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`)),Dp(l===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${l}) must match output depth for filter (${n[3]}).`)),aw("conv2dDerFilter",s,i);const f={x:a,dy:u},h={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,filterShape:n};return my.runKernel("Conv2DBackpropFilter",f,h)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ax(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return qb(t,ex(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function ux(t,e){let n=e;const r=bb(t.shape,e.shape);return r.length>0&&(n=Vw(n,r)),uw(n,t.shape)}function cx(t,e,n,r){if("linear"===e)return t;if("relu"===e)return jv(t);if("elu"===e)return Sw(t);if("relu6"===e)return Gv(t);if("prelu"===e)return gv(t,n);if("leakyrelu"===e)return Yw(t,r);if("sigmoid"===e)return fw(t);throw new Error(`Unknown fused activation ${e}.`)}const lx=(t,e)=>!(t>0)||"linear"===e;
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({fusedConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(u=u||"linear",!1===lx(my.state.gradientDepth,u)){Dp("NHWC"===s,(()=>`Error in fused conv2d: got dataFormat of ${s} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`));let f=bw(t,e,n,r,s,o,i);return null!=a&&(f=Ub(f,a)),cx(f,u,c,l)}const f=wg(t,"x","conv2d","float32"),h=wg(e,"filter","conv2d","float32");let p=f,d=!1;3===f.rank&&(d=!0,p=uw(f,[1,f.shape[0],f.shape[1],f.shape[2]])),Dp(4===p.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`)),Dp(4===h.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`)),aw("fused conv2d",r,i);const m="NHWC"===s?p.shape[3]:p.shape[1];Dp(h.shape[2]===m,(()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${h.shape[2]}.`)),Dp(ow(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const y=Yb(p.shape,h.shape,n,o,r,i);let g,b;if(null!=a&&(g=wg(a,"bias","fused conv2d"),[g]=uy(g,f),"NHWC"===s?wb(y.outShape,g.shape):(Dp(g.shape.length<=1,(()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${g.shape.length}.`)),Dp(0===g.shape.length||g.shape[0]===y.outChannels||1===g.shape[0],(()=>`Error in fused conv2d: bias shape (${g.shape}) is not compatible with the number of output channels (${y.outChannels})`)))),null!=c){const t=c.shape;if(Dp(t.length<=1||3===t.length,(()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${t.length}.`)),1===t.length)Dp(1===t[0]||t[0]===y.outChannels,(()=>`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the number of output channels (${y.outChannels}).`));else if(3===t.length)try{wb(t,y.outShape)}catch(e){const n=`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the output shape of the conv2d (${y.outShape}).`;throw Error(n)}b=wg(c,"prelu weights","fused conv2d")}const w=(t,e)=>{Dp("NHWC"===s,(()=>`Error in gradient of fused conv2D: got dataFormat of ${s} but only NHWC is currently supported.`));const[i,a,c,l]=e,f=ax(t,c,u);Dp(sw(o),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`));const h=[ww(a.shape,f,i,n,r),ix(a,f,i.shape,n,r)];if(null!=l){const t=ux(l,f);h.push(t)}return h},v={x:p,filter:h,bias:g,preluActivationWeights:b},x={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=ev(((t,e,n)=>{let r=my.runKernel("FusedConv2D",v,x);return n([e,t,r]),d&&(r=uw(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:w}}));return t(p,h)}{const t=ev(((t,e,n,r)=>{let s=my.runKernel("FusedConv2D",v,x);return r([e,t,s,n]),d&&(s=uw(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:w}}));return t(p,h,g)}}});const fx=xg({depthwiseConv2dNativeBackpropFilter_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s,o=[1,1],i){let a=t;3===t.rank&&(a=uw(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=uw(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:u},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,filterShape:n};return my.runKernel("DepthwiseConv2dNativeBackpropFilter",c,l)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hx=xg({depthwiseConv2dNativeBackpropInput_:function(t,e,n,r,s,o=[1,1],i){let a=e,u=!1;3===e.rank&&(u=!0,a=uw(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,inputShape:t},f=my.runKernel("DepthwiseConv2dNativeBackpropInput",c,l);return u?uw(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({fusedDepthwiseConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(!1===lx(my.state.gradientDepth,u)){let f=xw(t,e,n,r,s,o,i);return null!=a&&(f=Ub(f,a)),cx(f,u,c,l)}const f=wg(t,"x","depthwiseConv2d","float32"),h=wg(e,"filter","depthwiseConv2d","float32");let p=f,d=!1;3===f.rank&&(d=!0,p=uw(f,[1,f.shape[0],f.shape[1],f.shape[2]])),Dp(4===p.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`)),Dp(4===h.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`)),Dp(p.shape[3]===h.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${p.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`)),null==o&&(o=[1,1]),Dp(ow(n,o),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),aw("fused depthwiseConv2d",r,i);const m=Yb(p.shape,h.shape,n,o,r,i,!0);let y,g;null!=a&&(y=wg(a,"bias","fused conv2d"),[y]=uy(y,f),wb(m.outShape,y.shape)),null!=c&&(g=wg(c,"prelu weights","fused depthwiseConv2d"));const b=(t,e)=>{Dp(sw(o),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`));const[s,a,c,l]=e,f=ax(t,c,u),h=hx(a.shape,f,s,n,r,o,i),p=fx(a,f,s.shape,n,r,o,i);if(null!=l){return[h,p,ux(y,f)]}return[h,p]},w={x:p,filter:h,bias:y,preluActivationWeights:g},v={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=ev(((t,e,n)=>{let r=my.runKernel("FusedDepthwiseConv2D",w,v);return n([e,t,r]),d&&(r=uw(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}}));return t(p,h)}{const t=ev(((t,e,n,r)=>{let s=my.runKernel("FusedDepthwiseConv2D",w,v);return r([e,t,s,n]),d&&(s=uw(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:b}}));return t(p,h,y)}}}),xg({fusedMatMul_:
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function({a:t,b:e,transposeA:n=!1,transposeB:r=!1,bias:s,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a}){if(!1===lx(my.state.gradientDepth,o)){let u=ub(t,e,n,r);return null!=s&&(u=Ub(u,s)),cx(u,o,i,a)}let u=wg(t,"a","fused matMul"),c=wg(e,"b","fused matMul");[u,c]=uy(u,c);const l=n?u.shape[u.rank-2]:u.shape[u.rank-1],f=r?c.shape[c.rank-1]:c.shape[c.rank-2],h=n?u.shape[u.rank-1]:u.shape[u.rank-2],p=r?c.shape[c.rank-2]:c.shape[c.rank-1],d=u.shape.slice(0,-2),m=c.shape.slice(0,-2),y=Bp(d),g=Bp(m);Dp(l===f,(()=>`Error in fused matMul: inner shapes (${l}) and (${f}) of Tensors with shapes ${u.shape} and ${c.shape} and transposeA=${n} and transposeB=${r} must match.`));const b=wb(u.shape.slice(0,-2),c.shape.slice(0,-2)).concat([h,p]),w=uw(u,n?[y,l,h]:[y,h,l]),v=uw(c,r?[g,p,f]:[g,f,p]);let x,N;null!=s&&(x=wg(s,"bias","fused matMul"),[x]=uy(x,u),wb(b,x.shape)),null!=i&&(N=wg(i,"prelu weights","fused matMul"));const $=(t,e)=>{const[i,a,u,c]=e,l=ax(uw(t,u.shape),u,o);let f,h;if(n||r?!n&&r?(f=ub(l,a,!1,!1),h=ub(l,i,!0,!1)):n&&!r?(f=ub(a,l,!1,!0),h=ub(i,l,!1,!1)):(f=ub(a,l,!0,!0),h=ub(l,i,!0,!0)):(f=ub(l,a,!1,!0),h=ub(i,l,!0,!1)),null!=s){return[f,h,ux(c,l)]}return[f,h]},E={a:w,b:v,bias:x,preluActivationWeights:N},S={transposeA:n,transposeB:r,activation:o,leakyreluAlpha:a};if(null==s){const t=ev(((t,e,n)=>{const r=my.runKernel("_FusedMatMul",E,S);return n([t,e,r]),{value:uw(r,b),gradFunc:$}}));return t(w,v)}{const t=ev(((t,e,n,r)=>{const s=my.runKernel("_FusedMatMul",E,S);return r([t,e,s,n]),{value:uw(s,b),gradFunc:$}}));return t(w,v,x)}}}),xg({hammingWindow_:
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){return ox(t,.54,.46)}});const px=xg({hannWindow_:
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){return ox(t,.5,.5)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dx=xg({frame_:function(t,e,n,r=!1,s=0){let o=0;const i=[];for(;o+e<=t.size;)i.push(hw(t,o,e)),o+=n;if(r)for(;o<t.size;){const r=o+e-t.size,a=lw([hw(t,o,e-r),Hw([r],s)]);i.push(a),o+=n}return 0===i.length?rx([],[0,e]):uw(lw(i),[i.length,e])}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function mx(t,e,n,r,s,o){null==r&&(r=.5),null==s&&(s=Number.NEGATIVE_INFINITY),null==o&&(o=0);const i=t.shape[0];return n=Math.min(n,i),Dp(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),Dp(2===t.rank,(()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`)),Dp(4===t.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`)),Dp(1===e.rank,(()=>"scores must be a 1D tensor")),Dp(e.shape[0]===i,(()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`)),Dp(0<=o&&o<=1,(()=>`softNmsSigma must be in [0, 1], but was '${o}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:s,softNmsSigma:o}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function yx(t,e,n){const r=function(t,e,n){return function(t,e,n){let r=0,s=t.length,o=0,i=!1;for(;r<s;){o=r+(s-r>>>1);const a=n(e,t[o]);a>0?r=o+1:(s=o,i=!a)}return i?r:-r-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e,n||gx)}(t,e,n),s=r<0?-(r+1):r;t.splice(s,0,e)}function gx(t,e){return t>e?1:t<e?-1:0}function bx(t,e,n,r,s,o,i=!1,a=!1,u=!1){const c=[];for(let t=0;t<e.length;t++)e[t]>s&&c.push({score:e[t],boxIndex:t,suppressBeginIndex:0});c.sort(xx);const l=o>0?-.5/o:0,f=[],h=[];for(;f.length<n&&c.length>0;){const e=c.pop(),{score:n,boxIndex:o,suppressBeginIndex:i}=e;if(n<s)break;let a=!1;for(let n=f.length-1;n>=i;--n){const i=wx(t,o,f[n]);if(i>=r){a=!0;break}if(e.score=e.score*vx(r,l,i),e.score<=s)break}e.suppressBeginIndex=f.length,a||(e.score===n?(f.push(o),h.push(e.score)):e.score>s&&yx(c,e,xx))}const p=f.length,d=n-p;a&&d>0&&(f.push(...new Array(d).fill(0)),h.push(...new Array(d).fill(0)));const m={selectedIndices:f};return i&&(m.selectedScores=h),u&&(m.validOutputs=p),m}function wx(t,e,n){const r=t.subarray(4*e,4*e+4),s=t.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(s[0],s[2]),l=Math.min(s[1],s[3]),f=Math.max(s[0],s[2]),h=Math.max(s[1],s[3]),p=(a-o)*(u-i),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;const m=Math.max(o,c),y=Math.max(i,l),g=Math.min(a,f),b=Math.min(u,h),w=Math.max(g-m,0)*Math.max(b-y,0);return w/(p+d-w)}function vx(t,e,n){const r=Math.exp(e*n*n);return n<=t?r:0}function xx(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nx(t,e=!1){return my.tidy((()=>{Dp(2===t.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`));const n=t.shape[0],r=t.shape[1];let s=qw(n),o=tb(t);const i=rx([[1]],[1,1]);let a=tb(i);const u=n>=r?r:n;for(let t=0;t<u;++t){const e=o,u=a,c=s;[a,o,s]=my.tidy((()=>{const e=hw(o,[t,t],[n-t,1]),u=Ww(e),c=hw(o,[t,t],[1,1]),l=$w(Xw(c,0),rx([[-1]]),rx([[1]])),f=rv(c,qb(l,u)),h=Gb(e,f);a=1===h.shape[0]?tb(i):lw([i,hw(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);const p=db(Gb(ub(l,f),u)),d=hw(o,[t,0],[n-t,r]),m=qb(p,a),y=yb(a);if(0===t)o=rv(d,ub(m,ub(y,d)));else{const e=rv(d,ub(m,ub(y,d)));o=lw([hw(o,[0,0],[t,r]),e],0)}const g=yb(m),b=hw(s,[0,t],[n,s.shape[1]-t]);if(0===t)s=rv(b,ub(ub(b,a),g));else{const e=rv(b,ub(ub(b,a),g));s=lw([hw(s,[0,0],[n,t]),e],1)}return[a,o,s]})),hb([e,u,c])}return!e&&n>r&&(s=hw(s,[0,0],[n,r]),o=hw(o,[0,0],[r,r])),[s,o]}))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var $x;xg({stft_:function(t,e,n,r,s=px){
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var o;null==r&&(o=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));const i=dx(t,e,n),a=qb(i,s(e));return Yv(a,r)}}),xg({cropAndResize_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s="bilinear",o=0){const i=wg(t,"image","cropAndResize"),a=wg(e,"boxes","cropAndResize","float32"),u=wg(n,"boxInd","cropAndResize","int32"),c=a.shape[0];Dp(4===i.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`)),Dp(2===a.rank&&4===a.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`)),Dp(1===u.rank&&u.shape[0]===c,(()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`)),Dp(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),Dp(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),Dp("bilinear"===s||"nearest"===s,(()=>`method must be bilinear or nearest, but was ${s}`));const l={image:i,boxes:a,boxInd:u},f={method:s,extrapolationValue:o,cropSize:r};return my.runKernel("CropAndResize",l,f)}}),xg({flipLeftRight_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e=wg(t,"image","flipLeftRight","float32");Dp(4===e.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`));const n={image:e};return my.runKernel("FlipLeftRight",n,{})}}),xg({grayscaleToRGB_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e=wg(t,"image","grayscaleToRGB"),n=e.rank-1,r=e.shape[n];Dp(e.rank>=2,(()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`)),Dp(1===r,(()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`));const s=new Array(e.rank);return s.fill(1,0,n),s[n]=3,Gw(e,s)}}),xg({rotateWithOffset_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n=0,r=.5){const s=wg(t,"image","rotateWithOffset","float32");Dp(4===s.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${s.rank}.`));const o={image:s},i={radians:e,fillValue:n,center:r};return my.runKernel("RotateWithOffset",o,i)}}),xg({nonMaxSuppression_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const o=wg(t,"boxes","nonMaxSuppression","float32"),i=wg(e,"scores","nonMaxSuppression","float32"),a=mx(o,i,n,r,s),u={maxOutputSize:n=a.maxOutputSize,iouThreshold:r=a.iouThreshold,scoreThreshold:s=a.scoreThreshold};return my.runKernel("NonMaxSuppressionV3",{boxes:o,scores:i},u)}}),xg({nonMaxSuppressionWithScore_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=wg(t,"boxes","nonMaxSuppression"),a=wg(e,"scores","nonMaxSuppression"),u=mx(i,a,n,r,s,o),c={boxes:i,scores:a},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:s=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},f=my.runKernel("NonMaxSuppressionV5",c,l);return{selectedIndices:f[0],selectedScores:f[1]}}}),xg({nonMaxSuppressionPadded_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=wg(t,"boxes","nonMaxSuppression"),a=wg(e,"scores","nonMaxSuppression"),u=mx(i,a,n,r,s,null),c={boxes:i,scores:a},l={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:o},f=my.runKernel("NonMaxSuppressionV4",c,l);return{selectedIndices:f[0],validOutputs:f[1]}}}),xg({resizeBilinear_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n=!1,r=!1){const s=wg(t,"images","resizeBilinear");Dp(3===s.rank||4===s.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${s.rank}.`)),Dp(2===e.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`)),Dp(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=uw(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=my.runKernel("ResizeBilinear",a,u);return i?uw(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),xg({resizeNearestNeighbor_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n=!1,r=!1){const s=wg(t,"images","resizeNearestNeighbor");Dp(3===s.rank||4===s.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${s.rank}.`)),Dp(2===e.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`)),Dp("float32"===s.dtype||"int32"===s.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),Dp(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=uw(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=my.runKernel("ResizeNearestNeighbor",a,u);return i?uw(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),xg({threshold_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e="binary",n=!1,r=.5){const s=wg(t,"image","threshold"),o=s.shape[0]*s.shape[1];let i,a,u,c,l=qb(nx([r]),255);if(Dp(3===s.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${s.rank}.`)),Dp(3===s.shape[2]||1===s.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${s.shape[2]}.`)),Dp("int32"===s.dtype||"float32"===s.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${s.dtype}.`)),Dp("otsu"===e||"binary"===e,(()=>`Method must be binary or otsu, but was ${e}`)),3===s.shape[2]){[i,a,u]=Jv(s,[1,1,1],-1);const t=qb(i,.2989),e=qb(a,.587),n=qb(u,.114);c=Ub(Ub(t,e),n)}else c=t;if("otsu"===e){l=function(t,e){let n,r,s,o,i,a,u=nx([-1]),c=nx([0]),l=nx([0]);for(let f=0;f<t.size-1;f++){n=hw(t,0,f+1),r=hw(t,f+1),i=Gb(Vw(n),e),a=Gb(Vw(r),e);const h=Vw(qb(n,Uv(0,n.size)));s=Gb(h,Vw(n));const p=Hw(r.shape,n.size),d=Ub(Uv(0,r.size),p),m=qb(r,d);o=Gb(Vw(m),Vw(r));const y=rv(s,o),g=rv(s,o),b=qb(i,a);l=qb(qb(b,y),g);const w=Xw(l,c);c=$w(w,l,c),u=$w(w,nx([f]),u)}return u}(yw(Qg(Hv(c),"int32"),$g(f=[],h,yg(f,p),p),256),o)}var f,h,p;const d=n?Zw(c,l):Xw(c,l);return Qg(qb(d,255),"int32")}}),xg({transform_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n="nearest",r="constant",s=0,o){const i=wg(t,"image","transform","float32"),a=wg(e,"transforms","transform","float32");Dp(4===i.rank,(()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`)),Dp(2===a.rank&&(a.shape[0]===i.shape[0]||1===a.shape[0])&&8===a.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),Dp(null==o||2===o.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`));const u={image:i,transforms:a},c={interpolation:n,fillMode:r,fillValue:s,outputShape:o};return my.runKernel("Transform",u,c)}}),xg({bandPart_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){Dp(e%1==0,(()=>`bandPart(): numLower must be an integer, got ${e}.`)),Dp(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`));const r=wg(t,"a","bandPart");Dp(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));const s=r.shape,[o,i]=r.shape.slice(-2);if(!(e<=o))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`);if(!(n<=i))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${i}).`);e<0&&(e=o),n<0&&(n=i);const a=uw(Uv(0,o,1,"int32"),[-1,1]),u=Uv(0,i,1,"int32"),c=rv(a,u),l=ov(Zw(c,Lw(+e,"int32")),Jw(c,Lw(-n,"int32"))),f=fv([o,i],r.dtype);return uw(tx(sx(uw(r,[-1,o,i])).map((t=>$w(l,t,f)))),s)}}),xg({gramSchmidt_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){let e;if(Array.isArray(t)){e=!1,Dp(null!=t&&t.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=t[0].shape[0];for(let e=1;e<t.length;++e)Dp(t[e].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[e].shape[0]} vs. ${n})`))}else e=!0,t=Jv(t,t.shape[0],0).map((t=>Qv(t,[0])));Dp(t.length<=t[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`));const n=[],r=t;for(let e=0;e<t.length;++e)n.push(my.tidy((()=>{let t=r[e];if(e>0)for(let r=0;r<e;++r){const e=qb(Vw(qb(n[r],t)),n[r]);t=rv(t,e)}return Gb(t,Ww(t,"euclidean"))})));return e?tx(n,0):n}}),xg({qr_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=!1){if(Dp(t.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`)),2===t.rank)return Nx(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce(((t,e)=>t*e)),r=sx(uw(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),s=[],o=[];r.forEach((t=>{const[n,r]=Nx(t,e);s.push(n),o.push(r)}));return[uw(tx(s,0),t.shape),uw(tx(o,0),t.shape)]}}}),function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}($x||($x={}));const Ex=xg({computeWeightedLoss_:function(t,e,n=$x.SUM_BY_NONZERO_WEIGHTS){const r=wg(t,"losses","computeWeightedLoss");let s=null;null!=e&&(s=wg(e,"weights","computeWeightedLoss"));const o=null==s?r:qb(r,s);if(n===$x.NONE)return o;if(n===$x.SUM)return Vw(o);if(n===$x.MEAN){if(null==s)return lv(o);{const t=r.size/s.size,e=Gb(Vw(o),Vw(s));return t>1?Gb(e,Lw(t)):e}}if(n===$x.SUM_BY_NONZERO_WEIGHTS){if(null==s)return Gb(Vw(o),Lw(r.size));{const t=qb(s,hv(r.shape)),e=Qg(Vw(dv(t,Lw(0))),"float32");return Gb(Vw(o),e)}}throw Error(`Unknown reduction: ${n}`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xg({absoluteDifference_:function(t,e,n,r=$x.SUM_BY_NONZERO_WEIGHTS){const s=wg(t,"labels","absoluteDifference"),o=wg(e,"predictions","absoluteDifference");let i=null;null!=n&&(i=wg(n,"weights","absoluteDifference")),Fp(s.shape,o.shape,"Error in absoluteDifference: ");const a=Hb(rv(s,o));return Ex(a,i,r)}}),xg({cosineDistance_:function(t,e,n,r,s=$x.SUM_BY_NONZERO_WEIGHTS){const o=wg(t,"labels","cosineDistance"),i=wg(e,"predictions","cosineDistance");let a=null;null!=r&&(a=wg(r,"weights","cosineDistance")),Fp(o.shape,i.shape,"Error in cosineDistance: ");const u=Lw(1),c=rv(u,Vw(qb(o,i),n,!0));return Ex(c,a,s)}}),xg({hingeLoss_:function(t,e,n,r=$x.SUM_BY_NONZERO_WEIGHTS){let s=wg(t,"labels","hingeLoss");const o=wg(e,"predictions","hingeLoss");let i=null;null!=n&&(i=wg(n,"weights","hingeLoss")),Fp(s.shape,o.shape,"Error in hingeLoss: ");const a=Lw(1);s=rv(qb(Lw(2),s),a);const u=jv(rv(a,qb(s,o)));return Ex(u,i,r)}}),xg({huberLoss_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=1,s=$x.SUM_BY_NONZERO_WEIGHTS){const o=wg(t,"labels","huberLoss"),i=wg(e,"predictions","huberLoss");let a=null;null!=n&&(a=wg(n,"weights","huberLoss")),Fp(o.shape,i.shape,"Error in huberLoss: ");const u=Lw(r),c=Hb(rv(i,o)),l=pv(c,u),f=rv(c,l),h=Ub(qb(Lw(.5),Bw(l)),qb(u,f));return Ex(h,a,s)}}),xg({logLoss_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=1e-7,s=$x.SUM_BY_NONZERO_WEIGHTS){const o=wg(t,"labels","logLoss"),i=wg(e,"predictions","logLoss");let a=null;null!=n&&(a=wg(n,"weights","logLoss")),Fp(o.shape,i.shape,"Error in logLoss: ");const u=Lw(1),c=Lw(r),l=db(qb(o,Qw(Ub(i,c)))),f=qb(rv(u,o),Qw(Ub(rv(u,i),c))),h=rv(l,f);return Ex(h,a,s)}}),xg({meanSquaredError_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=$x.SUM_BY_NONZERO_WEIGHTS){const s=wg(t,"labels","meanSquaredError"),o=wg(e,"predictions","meanSquaredError");let i=null;null!=n&&(i=wg(n,"weights","meanSquaredError")),Fp(s.shape,o.shape,"Error in meanSquaredError: ");const a=Zv(s,o);return Ex(a,i,r)}}),xg({sigmoidCrossEntropy_:function(t,e,n,r=0,s=$x.SUM_BY_NONZERO_WEIGHTS){let o=wg(t,"multiClassLabels","sigmoidCrossEntropy");const i=wg(e,"logits","sigmoidCrossEntropy");let a=null;if(null!=n&&(a=wg(n,"weights","sigmoidCrossEntropy")),Fp(o.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){const t=Lw(r),e=Lw(1),n=Lw(.5);o=Ub(qb(o,rv(e,t)),qb(n,t))}const u=
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=wg(t,"labels","sigmoidCrossEntropyWithLogits"),r=wg(e,"logits","sigmoidCrossEntropyWithLogits");Fp(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const s=jv(r),o=qb(r,n),i=tv(Uw(db(Hb(r))));return Ub(rv(s,o),i)}(o,i);return Ex(u,a,s)}}),xg({softmaxCrossEntropy_:function(t,e,n,r=0,s=$x.SUM_BY_NONZERO_WEIGHTS){let o=wg(t,"onehotLabels","softmaxCrossEntropy");const i=wg(e,"logits","softmaxCrossEntropy");let a=null;if(null!=n&&(a=wg(n,"weights","softmaxCrossEntropy")),Fp(o.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){const t=Lw(r),e=Lw(1),n=Lw(o.shape[1]);o=Ub(qb(o,rv(e,t)),Gb(t,n))}const u=
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n=-1){if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);const r=ev(((t,e,r)=>{const s=sv(e,[n],!0),o=rv(Qg(e,"float32"),s);r([t,o]);const i=db(qb(o,t));return{value:Vw(i,[n]),gradFunc:(t,e)=>{const[r,s]=e,o=Aw(t.shape,[n]);return[qb(uw(t,o),rv(Qg(r,"float32"),Uw(s))),qb(uw(t,o),rv(Uw(s),Qg(r,"float32")))]}}}));return r(t,e)}(o,i);return Ex(u,a,s)}}),xg({sparseFillEmptyRows_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const s=wg(t,"indices","sparseFillEmptyRows","int32"),o=wg(e,"values","sparseFillEmptyRows"),i=wg(n,"denseShape","sparseFillEmptyRows","int32"),a=wg(r,"defaultValue","sparseFillEmptyRows",o.dtype);if(2!==s.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${s.shape}`);if(1!==o.rank)throw new Error(`Values should be Tensor1D but received shape ${o.shape}`);if(1!==i.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${i.shape}`);if(0!==a.rank)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const u={indices:s,values:o,denseShape:i,defaultValue:a},c=my.runKernel("SparseFillEmptyRows",u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}}),xg({sparseReshape_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=wg(t,"inputIndices","sparseReshape","int32"),s=wg(e,"inputShape","sparseReshape","int32"),o=wg(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==s.rank)throw new Error(`Input shape should be Tensor1D but received shape ${s.shape}`);if(1!==o.rank)throw new Error(`New shape should be Tensor1D but received shape ${o.shape}`);const i={inputIndices:r,inputShape:s,newShape:o},a=my.runKernel("SparseReshape",i);return{outputIndices:a[0],outputShape:a[1]}}}),xg({sparseSegmentMean_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=wg(t,"data","sparseSegmentMean"),s=wg(e,"indices","sparseSegmentMean","int32"),o=wg(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return my.runKernel("SparseSegmentMean",i)}}),xg({sparseSegmentSum_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=wg(t,"data","sparseSegmentSum"),s=wg(e,"indices","sparseSegmentSum","int32"),o=wg(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return my.runKernel("SparseSegmentSum",i)}}),xg({stringNGrams_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s,o,i,a){const u=wg(t,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error(`Data must be a vector, saw: ${u.shape}`);const c=wg(e,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");const l={separator:n,nGramWidths:r,leftPad:s,rightPad:o,padWidth:i,preserveShortSequences:a},f={data:u,dataSplits:c},h=my.runKernel("StringNGrams",f,l);return{nGrams:h[0],nGramsSplits:h[1]}}}),xg({stringSplit_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n=!0){const r=wg(t,"input","stringSplit","string"),s=wg(e,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(0!==s.rank)throw new Error(`Delimiter should be a scalar but received shape ${s.shape}`);const o={skipEmpty:n},i={input:r,delimiter:s},a=my.runKernel("StringSplit",i,o);return{indices:a[0],values:a[1],shape:a[2]}}}),xg({stringToHashBucketFast_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=wg(t,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const s={input:n};return my.runKernel("StringToHashBucketFast",s,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Sx extends class{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}{minimize(t,e=!1,n){const{value:r,grads:s}=this.computeGradients(t,n);if(null!=n){const t=n.map((t=>({name:t.name,tensor:s[t.name]})));this.applyGradients(t)}else this.applyGradients(s);return hb(s),e?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return function(t,e){Dp(Qp(t),(()=>"The f passed in variableGrads(f) must be a function")),Dp(null==e||Array.isArray(e)&&e.every((t=>t instanceof Qm)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=e;if(!n){e=[];for(const t in my.registeredVariables)e.push(my.registeredVariables[t])}const r=n?e.filter((t=>!t.trainable)):null,s=e.length;e=e.filter((t=>t.trainable)),Dp(e.length>0,(()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${s} variables is trainable.`));const{value:o,grads:i}=my.gradients(t,e,null,!0);Dp(i.some((t=>null!=t)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),Dp(0===o.rank,(()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`));const a={};return e.forEach(((t,e)=>{null!=i[e]&&(a[t.name]=i[e])})),null!=r&&r.forEach((t=>a[t.name]=null)),{value:o,grads:a}}(t,e)}dispose(){null!=this.iterations_&&hb(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:Lw(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(Sx,Symbol.hasInstance,{value:t=>null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class _x extends Sx{constructor(t,e,n=null){super(),this.learningRate=t,this.rho=e,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=my.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=my.registeredVariables[e];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${e}/accum_grad`,variable:fb((()=>Ew(r).variable(false)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${e}/accum_var`,variable:fb((()=>Ew(r).variable(false)))});const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const o=this.accumulatedGrads[n].variable,i=this.accumulatedUpdates[n].variable;fb((()=>{const t=Ub(qb(o,this.rho),qb(Bw(s),1-this.rho)),e=qb(Gb(Pw(Ub(i,this.epsilon)),Pw(Ub(o,this.epsilon))),s),n=Ub(qb(i,this.rho),qb(Bw(e),1-this.rho));o.assign(t),i.assign(n);const a=Ub(qb(e,-this.learningRate),r);r.assign(a)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(hb(this.accumulatedGrads.map((t=>t.variable))),hb(this.accumulatedUpdates.map((t=>t.variable))))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){const e=(t=await this.extractIterations(t)).length/2;this.accumulatedGrads=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedUpdates=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}_x.className="Adadelta",Wb(_x);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Tx extends Sx{constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=my.registeredVariables[e];if(null==this.accumulatedGrads[n]){const t=!1;this.accumulatedGrads[n]={originalName:`${e}/accumulator`,variable:fb((()=>Hw(r.shape,this.initialAccumulatorValue).variable(t)))}}const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const o=this.accumulatedGrads[n].variable;fb((()=>{const t=Ub(o,Bw(s));o.assign(t);const e=Ub(qb(Gb(s,Pw(Ub(t,my.backend.epsilon()))),-this.learningRate),r);r.assign(e)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&hb(this.accumulatedGrads.map((t=>t.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulatedGrads=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}Tx.className="Adagrad",Wb(Tx);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class kx extends Sx{constructor(t,e,n,r=null){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],fb((()=>{this.accBeta1=Lw(e).variable(),this.accBeta2=Lw(n).variable()})),null==r&&(this.epsilon=my.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);fb((()=>{const n=rv(1,this.accBeta1),r=rv(1,this.accBeta2);e.forEach(((e,s)=>{const o=my.registeredVariables[e];null==this.accumulatedFirstMoment[s]&&(this.accumulatedFirstMoment[s]={originalName:`${e}/m`,variable:fb((()=>Ew(o).variable(false)))}),null==this.accumulatedSecondMoment[s]&&(this.accumulatedSecondMoment[s]={originalName:`${e}/v`,variable:fb((()=>Ew(o).variable(false)))});const i=Array.isArray(t)?t[s].tensor:t[e];if(null==i)return;const a=this.accumulatedFirstMoment[s].variable,u=this.accumulatedSecondMoment[s].variable,c=Ub(qb(a,this.beta1),qb(i,1-this.beta1)),l=Ub(qb(u,this.beta2),qb(Bw(i),1-this.beta2)),f=Gb(c,n),h=Gb(l,r);a.assign(c),u.assign(l);const p=Ub(qb(Gb(f,Ub(Pw(h),this.epsilon)),-this.learningRate),o);o.assign(p)})),this.accBeta1.assign(qb(this.accBeta1,this.beta1)),this.accBeta2.assign(qb(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&hb(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedSecondMoment&&hb(this.accumulatedSecondMoment.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t),fb((()=>{this.accBeta1.assign(Fw(this.beta1,this.iterations_+1)),this.accBeta2.assign(Fw(this.beta2,this.iterations_+1))}));const e=t.length/2;this.accumulatedFirstMoment=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedSecondMoment=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}kx.className="Adam",Wb(kx);
/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/
class Ax extends Sx{constructor(t,e,n,r=null,s=0){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],fb((()=>{this.iteration=Lw(0).variable(),this.accBeta1=Lw(e).variable()})),null==r&&(this.epsilon=my.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);fb((()=>{const n=rv(1,this.accBeta1),r=Gb(-this.learningRate,Ub(qb(this.iteration,this.decay),1));e.forEach(((e,s)=>{const o=my.registeredVariables[e];null==this.accumulatedFirstMoment[s]&&(this.accumulatedFirstMoment[s]={originalName:`${e}/m`,variable:Ew(o).variable(false)}),null==this.accumulatedWeightedInfNorm[s]&&(this.accumulatedWeightedInfNorm[s]={originalName:`${e}/v`,variable:Ew(o).variable(false)});const i=Array.isArray(t)?t[s].tensor:t[e];if(null==i)return;const a=this.accumulatedFirstMoment[s].variable,u=this.accumulatedWeightedInfNorm[s].variable,c=Ub(qb(a,this.beta1),qb(i,1-this.beta1)),l=qb(u,this.beta2),f=Hb(i),h=cv(l,f);a.assign(c),u.assign(h);const p=Ub(qb(Gb(r,n),Gb(c,Ub(h,this.epsilon))),o);o.assign(p)})),this.iteration.assign(Ub(this.iteration,1)),this.accBeta1.assign(qb(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&hb(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedWeightedInfNorm&&hb(this.accumulatedWeightedInfNorm.map((t=>t.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}Ax.className="Adamax",Wb(Ax);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Cx extends Sx{constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);e.forEach(((e,n)=>{const r=Array.isArray(t)?t[n].tensor:t[e];if(null==r)return;const s=my.registeredVariables[e];fb((()=>{const t=Ub(qb(this.c,r),s);s.assign(t)}))})),this.incrementIterations()}setLearningRate(t){var e;this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=(e=Lw(-t),my.keep(e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(0!==(t=await this.extractIterations(t)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}Cx.className="SGD",Wb(Cx);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Ox extends Cx{constructor(t,e,n=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=n,this.accumulations=[],this.m=Lw(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=my.registeredVariables[e];if(null==this.accumulations[n]){const t=!1;this.accumulations[n]={originalName:`${e}/momentum`,variable:fb((()=>Ew(r).variable(t)))}}const s=this.accumulations[n].variable,o=Array.isArray(t)?t[n].tensor:t[e];null!=o&&fb((()=>{let t;const e=Ub(qb(this.m,s),o);t=this.useNesterov?Ub(qb(this.c,Ub(o,qb(e,this.m))),r):Ub(qb(this.c,e),r),s.assign(e),r.assign(t)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&hb(this.accumulations.map((t=>t.variable)))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulations=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}Ox.className="Momentum",Wb(Ox);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Ix extends Sx{constructor(t,e=.9,n=0,r=null,s=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,null==r&&(this.epsilon=my.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=my.registeredVariables[e],s=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${e}/rms`,variable:fb((()=>Ew(r).variable(s)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${e}/momentum`,variable:fb((()=>Ew(r).variable(s)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${e}/mg`,variable:fb((()=>Ew(r).variable(s)))});const o=Array.isArray(t)?t[n].tensor:t[e];if(null==o)return;const i=this.accumulatedMeanSquares[n].variable,a=this.accumulatedMoments[n].variable;fb((()=>{const t=Ub(qb(i,this.decay),qb(Bw(o),1-this.decay));if(this.centered){const e=this.accumulatedMeanGrads[n].variable,s=Ub(qb(e,this.decay),qb(o,1-this.decay)),u=Gb(qb(o,this.learningRate),Pw(rv(t,Ub(Bw(s),this.epsilon)))),c=Ub(qb(a,this.momentum),u);i.assign(t),e.assign(s),a.assign(c);const l=rv(r,c);r.assign(l)}else{const t=Ub(qb(i,this.decay),qb(Bw(o),1-this.decay)),e=Ub(qb(a,this.momentum),Gb(qb(o,this.learningRate),Pw(Ub(t,this.epsilon))));i.assign(t),a.assign(e);const n=rv(r,e);r.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&hb(this.accumulatedMeanSquares.map((t=>t.variable))),null!=this.accumulatedMeanGrads&&this.centered&&hb(this.accumulatedMeanGrads.map((t=>t.variable))),null!=this.accumulatedMoments&&hb(this.accumulatedMoments.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,n=!1;this.accumulatedMeanSquares=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.accumulatedMoments=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}Ix.className="RMSProp",Wb(Ix);
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Mx="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:t=>t();
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Rx(t,e){const n=t[0].length;t.forEach(((t,e)=>{Dp(t.length===n,(()=>`Error in concat${n}D: rank of tensors[${e}] must be the same as the rank of the rest (${n})`))})),Dp(e>=0&&e<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));const r=t[0];t.forEach(((t,s)=>{for(let o=0;o<n;o++)Dp(o===e||t[o]===r[o],(()=>`Error in concat${n}D: Shape of tensors[${s}] (${t}) does not match the shape of the rest (${r}) along the non-concatenated axis ${s}.`))}))}function Dx(t,e){const n=t[0].slice();for(let r=1;r<t.length;r++)n[e]+=t[r][e];return n}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fx(t){return t<=30?t:td(t,Math.floor(Math.sqrt(t)))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lx(t,e,n){return[n*("number"==typeof t?t:t[0]),e*("number"==typeof t?t:t[1])]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Px(t,e,n,r=!0){let s=[];if(r)s=s.concat(e.slice(0)),s.push(t[0]/n),s=s.concat(t.slice(1));else{s=s.concat(t[0]);const n=e.length;for(let r=0;r<n;++r)s=s.concat([t[r+1]/e[r],e[r]]);s=s.concat(t.slice(n+1))}return s}function Bx(t,e,n=!0){const r=[];if(n){r.push(e);for(let n=e+1;n<t;++n)n<=2*e?(r.push(n),r.push(n-(e+1))):r.push(n)}else{const n=[],s=[];for(let r=1;r<t;++r)r>=2*e+1||r%2==1?s.push(r):n.push(r);r.push(...n),r.push(0),r.push(...s)}return r}function Vx(t,e,n,r=!0){const s=[];r?s.push(t[0]/n):s.push(t[0]*n);for(let n=1;n<t.length;++n)n<=e.length?r?s.push(e[n-1]*t[n]):s.push(t[n]/e[n-1]):s.push(t[n]);return s}function zx(t,e){const n=[0];for(let r=0;r<e;++r)n.push(t[r][0]);return n}function Wx(t,e,n){const r=t.slice(0,1);for(let s=0;s<n;++s)r.push(t[s+1]-e[s][0]-e[s][1]);return r}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ux(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(2*t.length);for(let r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const jx=/->/g;function Gx(t,e){const n=((t=t.replace(/\s/g,"")).length-t.replace(jx,"").length)/"->".length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("->").');const[r,s]=t.split("->");Dp(-1===r.indexOf("..."),(()=>'The ellipsis notation ("...") is not supported yet.'));const o=r.split(","),i=o.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let t=0;t<s.length;++t){const e=s[t];if(!o.some((t=>-1!==t.indexOf(e))))throw new Error(`Output subscripts contain the label ${e} not present in the input subscripts.`);-1===a.indexOf(e)&&a.push(e)}for(let t=0;t<r.length;++t){const e=r[t];-1===a.indexOf(e)&&","!==e&&a.push(e)}const u=new Array(o.length);for(let t=0;t<i;++t){if(new Set(o[t].split("")).size!==o[t].length)throw new Error(`Found duplicate axes in input component ${o[t]}. Support for duplicate axes in input is not implemented yet.`);u[t]=[];for(let e=0;e<o[t].length;++e)u[t].push(a.indexOf(o[t][e]))}const c=a.length,l=[];for(let t=s.length;t<c;++t)l.push(t);return{allDims:a,summedDims:l,idDims:u}}function qx(t,e){let n=new Array(t);n.fill(-1);for(let t=0;t<e.length;++t)n[e[t]]=t;const r=[];for(let e=0;e<t;++e)-1===n[e]&&r.push(e);return n=n.filter((t=>-1!==t)),{permutationIndices:n,expandDims:r}}function Hx(t,e,n){const r=new Array(t);for(let t=0;t<n.length;++t){const s=n[t].shape;for(let n=0;n<e[t].length;++n)void 0===r[e[t][n]]?r[e[t][n]]=s[n]:Dp(r[e[t][n]]===s[n],(()=>`Expected dimension ${r[e[t][n]]} at axis ${n} of input shaped ${JSON.stringify(s)}, but got dimension ${s[n]}`))}}function Kx(t,e){const n=t,r=[];let s=0;0===t.length&&n.push(-1),s=t.length+1;for(let t=0;t<s;++t)r.push([]);const o=[];for(let t=0;t<n.length;++t){const s=Jx(e,n[t]);for(const e of s)-1===o.indexOf(e)&&(r[t].push(e),o.push(e))}return{path:n,steps:r}}function Xx(t){return t.every(((t,e)=>t===e))}function Jx(t,e){const n=[];for(let r=0;r<t.length;++r)0!==t[r].length&&-1===t[r].indexOf(e)&&-1!==e||n.push(r);return n}function Yx(t,e,n=0){let r=[];if("number"==typeof e)Dp(t.shape[n]%e==0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(e).fill(t.shape[n]/e);else{Dp(e.reduce(((t,e)=>(-1===e&&(t+=1),t)),0)<=1,(()=>"There should be only one negative value in split array."));const s=e.indexOf(-1);if(-1!==s){const r=e.reduce(((t,e)=>e>0?t+e:t));e[s]=t.shape[n]-r}Dp(t.shape[n]===e.reduce(((t,e)=>t+e)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=e}return r}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zx(t){return`Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ${t}`}function Qx(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function tN(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eN(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function nN(t,e){return`size ${t} must be non-negative, not ${e}`}function rN(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function sN(t,e){return`Input to reshape is a SparseTensor with ${Bp(t)}\n  dense values, but the requested shape requires a multiple of ${Bp(e)}. inputShape=${t} outputShape= ${e}`}function oN(t,e){return`Input to reshape is a tensor with ${Bp(t)} dense values, but the requested shape has ${Bp(e)}. inputShape=${t} outputShape=${e}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iN(){return"segment ids must be >= 0"}function aN(){return"segment ids are not increasing"}function uN(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function cN(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lN(t,e){let n,r=!1;for(t<=30?(n=t,r=!0):n=td(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=td(t,n+1);return n}function fN(t,e,n){const r=[],s=t.length;for(let o=0;o<s;o++)o!==e?r.push(t[o]):r.push(n);return r}function hN(t,e,n,r){const s=e.shape.length,o=t.shape.length;if(0!==r&&(r<-s||r>s))throw new Error(`Expect batchDims in the range of [-${s}, ${s}], but got ${r}`);if(r<0&&(r+=s),r>o)throw new Error(`batchDims (${r}) must be less than rank(x) (\n    ${o}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let n=0;n<r;++n)if(t.shape[n]!==e.shape[n])throw new Error(`x.shape[${n}]: ${t.shape[n]} should be equal to indices.shape[${n}]: ${e.shape[n]}.`);const i=t.shape[n],a=[];let u=1,c=1,l=1;for(let e=0;e<r;++e)a.push(t.shape[e]),u*=t.shape[e];for(let e=r;e<n;e++)a.push(t.shape[e]),c*=t.shape[e];for(let t=r;t<s;t++)a.push(e.shape[t]);for(let e=n+1;e<o;e++)a.push(t.shape[e]),l*=t.shape[e];return{batchSize:u,sliceSize:l,outerSize:c,dimSize:i,outputShape:a}}var pN=Object.freeze({__proto__:null,segOpComputeOptimalWindowSize:lN,computeOutShape:fN,collectGatherOpShapeInfo:hN});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dN(t){try{return t.map((t=>Vm(t)))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function mN(t){return t.map((t=>Bm(t)))}var yN=Object.freeze({__proto__:null,slice_util:Vb,segment_util:pN,fromUint8ToStringArray:dN,fromStringArrayToUint8:mN,upcastType:iy,axesAreInnerMostDims:_w,combineLocations:Tw,computeOutAndReduceShapes:kw,expandShapeToKeepDim:Aw,assertAxesAreInnerMostDims:Cw,getAxesPermutation:Ow,getUndoAxesPermutation:Iw,getInnerMostAxes:Mw,getBroadcastDims:gb,getReductionAxes:bb,assertAndGetBroadcastShape:wb,assertParamsConsistent:Rx,computeOutShape:Dx,computeDilation2DInfo:Kb,computePool2DInfo:Xb,computePool3DInfo:Jb,computeConv2DInfo:Yb,computeConv3DInfo:Zb,computeDefaultPad:Qb,tupleValuesAreOne:sw,eitherStridesOrDilationsAreOne:ow,convertConv2DDataFormat:iw,checkPadOnDimRoundingMode:aw,getFusedDyActivation:ax,getFusedBiasGradient:ux,applyActivation:cx,shouldFuse:lx,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:Fx,getImageCenter:Lx,getReshaped:Px,getPermuted:Bx,getReshapedPermuted:Vx,getSliceBeginCoords:zx,getSliceSize:Wx,prepareAndValidate:xb,validateUpdateShape:Nb,validateInput:$b,calculateShapes:Eb,SELU_SCALEALPHA:1.7580993408473768,SELU_SCALE:1.0507009873554805,ERF_P:.3275911,ERF_A1:.254829592,ERF_A2:-.284496736,ERF_A3:1.421413741,ERF_A4:-1.453152027,ERF_A5:1.061405429,warn:Ud,log:function(...t){hd().getBool("IS_TEST")||hd().getBool("PROD")||console.log(...t)},mergeRealAndImagArrays:Ux,splitRealAndImagArrays:function(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}},complexWithEvenIndex:function(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=0;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}},complexWithOddIndex:function(t){const e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=2;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}},getComplexWithIndex:function(t,e){return{real:t[2*e],imag:t[2*e+1]}},assignToTypedArray:function(t,e,n,r){t[2*r]=e,t[2*r+1]=n},exponents:function(t,e){const n=new Float32Array(t/2),r=new Float32Array(t/2);for(let s=0;s<Math.ceil(t/2);s++){const o=(e?2:-2)*Math.PI*(s/t);n[s]=Math.cos(o),r[s]=Math.sin(o)}return{real:n,imag:r}},exponent:function(t,e,n){const r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}},decodeEinsumEquation:Gx,getEinsumPermutation:qx,checkEinsumDimSizes:Hx,getEinsumComputePath:Kx,isIdentityPermutation:Xx,prepareSplitSize:Yx,getSparseFillEmptyRowsIndicesDenseShapeMismatch:Zx,getSparseFillEmptyRowsNegativeIndexErrorMessage:Qx,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:tN,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:eN,getSparseReshapeNegativeOutputDimErrorMessage:nN,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:rN,getSparseReshapeInputOutputMultipleErrorMessage:sN,getSparseReshapeInputOutputMismatchErrorMessage:oN,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:iN,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:aN,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:uN,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:cN});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gN={},bN={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function wN(t,e){if(!(t in gN)||null!=e){const n=function(t,e){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=null==e?function(t){if("undefined"!=typeof OffscreenCanvas&&2===t)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t):e;if(n.addEventListener("webglcontextlost",(e=>{e.preventDefault(),delete gN[t]}),!1),1===t)return n.getContext("webgl",bN)||n.getContext("experimental-webgl",bN);return n.getContext("webgl2",bN)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e);if(null===n)return console.log("Could not get context for WebGL version",t),null;gN[t]=n}const n=gN[t];return null==n||n.isContextLost()?(delete gN[t],wN(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),gN[t])}var vN,xN,NN;function $N(t,e){return[e,t]}function EN(t){const e=Bp(t);return Wp(Math.ceil(e/4))}function SN(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function _N(t,e){const n=t;let r,s,o,i,a,u,c,l,f,h;return 2===hd().getNumber("WEBGL_VERSION")?(r=n.R32F,s=n.R16F,o=n.RGBA16F,i=n.RGBA32F,a=n.RED,c=4,l=1,f=n.HALF_FLOAT,h=n.FLOAT,u=n.RGBA8):(r=t.RGBA,s=t.RGBA,o=t.RGBA,i=n.RGBA,a=t.RGBA,c=4,l=4,f=null!=e?e.HALF_FLOAT_OES:null,h=t.FLOAT,u=t.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:s,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:u,downloadUnpackNumChannels:c,defaultNumChannels:l,textureTypeHalfFloat:f,textureTypeFloat:h}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TN(t,e){const n=e();return hd().getBool("DEBUG")&&function(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+function(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}(t,e))}(t),n}!function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"}(vN||(vN={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(xN||(xN={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(NN||(NN={}));function kN(t){return!!(hd().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||5.96e-8<Math.abs(t)&&Math.abs(t)<65504)}function AN(t,e){return PN(t,(()=>t.getExtension(e)),'Extension "'+e+'" not supported on this browser.')}const CN=/ERROR: [0-9]+:([0-9]+):/g;function ON(t,e){const n=CN.exec(e);if(null==n)return console.log(`Couldn't parse line number in error: ${e}`),void console.log(t);const r=+n[1],s=t.split("\n"),o=s.length.toString().length+2,i=s.map(((t,e)=>Up((e+1).toString(),o)+t));let a=0;for(let t=0;t<i.length;t++)a=Math.max(i[t].length,a);const u=i.slice(0,r-1),c=i.slice(r-1,r),l=i.slice(r);console.log(u.join("\n")),console.log(e.split("\n")[0]),console.log(`%c ${Up(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(l.join("\n"))}function IN(t,e){if(TN(t,(()=>t.validateProgram(e))),!1===t.getProgramParameter(e,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function MN(t,e,n,r,s,o,i){const a=t.getAttribLocation(e,n);return-1!==a&&(TN(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,r))),TN(t,(()=>t.vertexAttribPointer(a,s,t.FLOAT,!1,o,i))),TN(t,(()=>t.enableVertexAttribArray(a))),!0)}function RN(t,e,n){!function(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n){throw new Error(`textureUnit must be in ${`[gl.TEXTURE0, gl.TEXTURE${n}]`}.`)}}(t,n),TN(t,(()=>t.activeTexture(t.TEXTURE0+n))),TN(t,(()=>t.bindTexture(t.TEXTURE_2D,e)))}function DN(t,e,n){TN(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,n))),TN(t,(()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)))}function FN(t,e){TN(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,e))),TN(t,(()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)))}function LN(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}(t,e))}function PN(t,e,n){const r=TN(t,(()=>e()));if(null==r)throw new Error(n);return r}function BN(t,e=2){return Bp(t.slice(0,t.length-e))}function VN(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function zN(t){let e=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(e=[BN(t),...VN(t)]),e}function WN(t){return t%2==0}function UN(t,e){if(Vp(t=t.slice(-2),e=e.slice(-2)))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){const n=t.slice(-1)[0],r=e.slice(-1)[0];if(n===r)return!0;if(WN(n)&&WN(r)&&(1===t[0]||1===e[0]))return!0}return t[1]===e[1]&&WN(t[0])&&WN(e[0])}let jN,GN;function qN(t,e){return null!=t.getExtension(e)}function HN(t){try{if(null!=wN(t))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function KN(t){if(0===t)return!1;const e=wN(t);if(1!==t){if(qN(e,"EXT_color_buffer_float"))return XN(e);const t="EXT_color_buffer_half_float";if(qN(e,t)){const n=e.getExtension(t);return function(t,e){const n=_N(t,e),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);const s=1,o=1;t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,s,o,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(i),a}(e,n)}return!1}if(!qN(e,"OES_texture_float"))return!1;if(!qN(e,"WEBGL_color_buffer_float"))return!1;return XN(e)}function XN(t){const e=_N(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const s=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),s}function JN(t,e){Array.isArray(t)||(t=[t]),t.forEach((t=>{null!=t&&Dp("complex64"!==t.dtype,(()=>`${e} does not support complex64 tensors in the WebGL backend.`))}))}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YN=hd();
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ZN(){let t,e,n,r,s,o,i,a,u,c;return 2===hd().getNumber("WEBGL_VERSION")?(t="#version 300 es",e="in",n="out",r="in",s="texture",o="outputColor",i="out vec4 outputColor;",a="\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",n="varying",r="varying",s="texture2D",o="gl_FragColor",i="",a="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:s,output:o,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:u,defineRound:c}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QN(t,e,n="index"){const r=ed(e);return r.map(((e,s)=>`${`int ${t[s]} = ${n} / ${e}`}; ${s===r.length-1?`int ${t[s+1]} = ${n} - ${t[s]} * ${e}`:`index -= ${t[s]} * ${e}`};`)).join("")}function t$(t,e,n="index"){const r=ed(e);return r.map(((e,s)=>`${`int ${t[s]} = ${n} / outShapeStrides[${s}]`}; ${s===r.length-1?`int ${t[s+1]} = ${n} - ${t[s]} * outShapeStrides[${s}]`:`index -= ${t[s]} * outShapeStrides[${s}]`};`)).join("")}function e$(t,e,n="index"){const r=t.map(((t,e)=>e)),s=function(t,e){const n=t.length,r=t.map((t=>`${e}[${t}]`)),s=new Array(n-1);s[n-2]=r[n-1];for(let t=n-3;t>=0;--t)s[t]=`(${s[t+1]} * ${r[t+1]})`;return s}(r,e);return s.map(((e,r)=>`${`int ${t[r]} = ${n} / ${s[r]}`}; ${r===s.length-1?`int ${t[r+1]} = ${n} - ${t[r]} * ${s[r]}`:`index -= ${t[r]} * ${s[r]}`};`)).join("")}function n$(t){const e=ed(t).map((t=>t.toString()));return`\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;\n  }\n`}YN.registerFlag("HAS_WEBGL",(()=>YN.getNumber("WEBGL_VERSION")>0)),YN.registerFlag("WEBGL_VERSION",(()=>HN(2)?2:HN(1)?1:0)),YN.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(()=>!1)),YN.registerFlag("WEBGL_BUFFER_SUPPORTED",(()=>2===YN.get("WEBGL_VERSION"))),YN.registerFlag("WEBGL_CPU_FORWARD",(()=>!0)),YN.registerFlag("WEBGL_FORCE_F16_TEXTURES",(()=>!1)),YN.registerFlag("WEBGL_PACK",(()=>YN.getBool("HAS_WEBGL"))),YN.registerFlag("WEBGL_PACK_NORMALIZATION",(()=>YN.getBool("WEBGL_PACK"))),YN.registerFlag("WEBGL_PACK_CLIP",(()=>YN.getBool("WEBGL_PACK"))),YN.registerFlag("WEBGL_PACK_DEPTHWISECONV",(()=>YN.getBool("WEBGL_PACK"))),YN.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(()=>YN.getBool("WEBGL_PACK"))),YN.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(()=>YN.getBool("WEBGL_PACK"))),YN.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(()=>YN.getBool("WEBGL_PACK"))),YN.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(()=>YN.getBool("WEBGL_PACK"))),YN.registerFlag("WEBGL_PACK_REDUCE",(()=>YN.getBool("WEBGL_PACK"))),YN.registerFlag("WEBGL_LAZILY_UNPACK",(()=>YN.getBool("WEBGL_PACK"))),YN.registerFlag("WEBGL_CONV_IM2COL",(()=>YN.getBool("WEBGL_PACK"))),YN.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(()=>function(t){if(null==jN){const e=wN(t);jN=e.getParameter(e.MAX_TEXTURE_SIZE)}return jN}(YN.getNumber("WEBGL_VERSION")))),YN.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(()=>function(t){if(null==GN){const e=wN(t);GN=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,GN)}(YN.getNumber("WEBGL_VERSION")))),YN.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(()=>{const t=YN.getNumber("WEBGL_VERSION");return 0===t?0:function(t){if(0===t)return 0;let e;const n=wN(t);return e=qN(n,"EXT_disjoint_timer_query_webgl2")&&2===t?2:qN(n,"EXT_disjoint_timer_query")?1:0,e}(t)})),YN.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(()=>YN.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!gy())),YN.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(()=>function(t){if(0===t)return!1;const e=wN(t);if(1===t){if(!qN(e,"OES_texture_float"))return!1}else if(!qN(e,"EXT_color_buffer_float"))return!1;return XN(e)}(YN.getNumber("WEBGL_VERSION")))),YN.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(()=>!YN.getBool("WEBGL_FORCE_F16_TEXTURES")&&YN.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))),YN.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(()=>KN(YN.getNumber("WEBGL_VERSION")))),YN.registerFlag("WEBGL_FENCE_API_ENABLED",(()=>{return 2===(t=YN.getNumber("WEBGL_VERSION"))&&null!=wN(t).fenceSync;var t})),YN.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(()=>YN.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0)),YN.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(()=>-1),(t=>{if(t<0&&-1!==t)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)})),YN.registerFlag("WEBGL_FLUSH_THRESHOLD",(()=>gy()?1:-1),(t=>{if(t<0&&-1!==t)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)})),YN.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(()=>128)),YN.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(()=>!1)),YN.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(()=>1e5)),YN.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(()=>128));const r$="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:s$}=yN;
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o$(t,e,n){const r=[];if(t.forEach((t=>{const e=Bp(t.shapeInfo.logicalShape);if(t.shapeInfo.isUniform?r.push(`uniform float ${t.name}${e>1?`[${e}]`:""};`):(r.push(`uniform sampler2D ${t.name};`),r.push(`uniform int offset${t.name};`)),n.enableShapeUniforms){const{uniformShape:e}=y$(n.packedInputs,t.shapeInfo.logicalShape,t.shapeInfo.texShape);switch(e.length){case 1:r.push(`uniform int ${t.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${t.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${t.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${t.name}Shape;`)}r.push(`uniform ivec2 ${t.name}TexShape;`)}})),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((t=>{r.push(`uniform ${t.type} ${t.name}${t.arrayIndex?`[${t.arrayIndex}]`:""};`)}));const s=r.join("\n"),o=t.map((t=>function(t,e,n=!1,r){let s="";s+=n?a$(t,r):i$(t,r);const o=t.shapeInfo.logicalShape,i=e.logicalShape;o.length<=i.length&&(s+=n?function(t,e){const n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),s="get"+r+"AtOutCoords",o=t.shapeInfo.logicalShape.length,i=e.logicalShape.length,a=s$(t.shapeInfo.logicalShape,e.logicalShape),u=m$(i),c=i-o;let l;const f=["x","y","z","w","u","v"];l=0===o?"":i<2&&a.length>=1?"coords = 0;":a.map((t=>`coords.${f[t+c]} = 0;`)).join("\n");let h="";h=i<2&&o>0?"coords":t.shapeInfo.logicalShape.map(((t,e)=>`coords.${f[e+c]}`)).join(", ");let p="return outputValue;";const d=1===Bp(t.shapeInfo.logicalShape),m=1===Bp(e.logicalShape);if(1!==o||d||m){if(d&&!m)p=1===i?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(a.length){const t=o-2,e=o-1;a.indexOf(t)>-1&&a.indexOf(e)>-1?p="return vec4(outputValue.x);":a.indexOf(t)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(e)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return`\n    vec4 ${s}() {\n      ${u} coords = getOutputCoords();\n      ${l}\n      vec4 outputValue = get${r}(${h});\n      ${p}\n    }\n  `}(t,e):function(t,e){const n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),s="get"+r+"AtOutCoords",o=e.texShape,i=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===u&&null==t.shapeInfo.flatOffset&&Vp(i,o))return`\n      float ${s}() {\n        return sampleTexture(${n}, resultUV);\n      }\n    `;const c=m$(u),l=s$(t.shapeInfo.logicalShape,e.logicalShape),f=u-a;let h;const p=["x","y","z","w","u","v"];h=0===a?"":u<2&&l.length>=1?"coords = 0;":l.map((t=>`coords.${p[t+f]} = 0;`)).join("\n");let d="";d=u<2&&a>0?"coords":t.shapeInfo.logicalShape.map(((t,e)=>`coords.${p[e+f]}`)).join(", ");return`\n    float ${s}() {\n      ${c} coords = getOutputCoords();\n      ${h}\n      return get${r}(${d});\n    }\n  `}(t,e));return s}(t,e,n.packedInputs,n.enableShapeUniforms))).join("\n"),i=e.texShape,a=ZN(),u=function(t){return`\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ${t.texture2D}(textureSampler, uv).r;\n    }\n  `}(a);let c,l,f=function(t){return`${t.version}\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ${t.varyingFs} vec2 resultUV;\n    ${t.defineOutput}\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ${t.defineSpecialNaN}\n    ${t.defineSpecialInf}\n    ${t.defineRound}\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ${u$}\n    ${c$}\n    ${l$}\n  `}(a);e.isPacked?(c=function(t,e,n){switch(t.length){case 0:return h$();case 1:return function(t,e,n){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(1===r[0])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ${r[1]}.0);\n      }\n    `;if(1===r[1])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ${r[0]}.0);\n      }\n    `;if(n)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);\n    }\n  `}(0,e,n);case 2:return function(t,e,n){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Vp(t,e))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));\n      }\n    `;const s=Math.ceil(t[1]/2);if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n      int r = 2 * (index / ${s});\n      int c = imod(index, ${s}) * 2;\n\n      return ivec2(r, c);\n    }\n  `}(t,e,n);case 3:return function(t,e,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(t[2]/2),o=s*Math.ceil(t[1]/2);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      int b = index / ${o};\n      index -= b * ${o};\n\n      int r = 2 * (index / ${s});\n      int c = imod(index, ${s}) * 2;\n\n      return ivec3(b, r, c);\n    }\n  `}(t,e,n);default:return function(t,e,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(t[t.length-1]/2),o=s*Math.ceil(t[t.length-2]/2);let i=o,a="",u="b, r, c";for(let e=2;e<t.length-1;e++)i*=t[t.length-e-1],a=`\n      int b${e} = index / ${i};\n      index -= b${e} * ${i};\n    `+a,u=`b${e}, `+u;return`\n    ivec${t.length} getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      ${a}\n\n      int b = index / ${o};\n      index -= b * ${o};\n\n      int r = 2 * (index / ${s});\n      int c = imod(index, ${s}) * 2;\n\n      return ivec${t.length}(${u});\n    }\n  `}(t,e,n)}}(e.logicalShape,i,n.enableShapeUniforms),l=function(t){return`\n    void setOutput(vec4 val) {\n      ${t.output} = val;\n    }\n  `}(a)):(c=function(t,e,n){switch(t.length){case 0:return h$();case 1:return function(t,e,n){if(1===e[0])return n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.x * ${e[1]}.0);\n      }\n    `;if(1===e[1])return n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.y * ${e[0]}.0);\n      }\n    `;if(n)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      return resTexRC.x * ${e[1]} + resTexRC.y;\n    }\n  `}(0,e,n);case 2:return function(t,e,n){if(Vp(t,e))return n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));\n      }\n    `;if(1===t[1])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${e[0]}, ${e[1]}));\n        int index = resTexRC.x * ${e[1]} + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    `;if(1===t[0])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${e[0]}, ${e[1]}));\n        int index = resTexRC.x * ${e[1]} + resTexRC.y;\n        return ivec2(0, index);\n      }\n    `;if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      int r = index / ${t[1]};\n      int c = index - r * ${t[1]};\n      return ivec2(r, c);\n    }\n  `}(t,e,n);case 3:return function(t,e,n){if(n){return`\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ${t$(["r","c","d"],t)}\n    return ivec3(r, c, d);\n  }\n`}const r=QN(["r","c","d"],t);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      ${r}\n      return ivec3(r, c, d);\n    }\n  `}(t,e,n);case 4:return function(t,e,n){if(n){return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ${t$(["r","c","d","d2"],t)}\n      return ivec4(r, c, d, d2);\n    }\n  `}const r=QN(["r","c","d","d2"],t);return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      ${r}\n      return ivec4(r, c, d, d2);\n    }\n  `}(t,e,n);case 5:return function(t,e){const n=QN(["r","c","d","d2","d3"],t);return`\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},\n                             ${e[1]}));\n\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  `}(t,e);case 6:return function(t,e){const n=QN(["r","c","d","d2","d3","d4"],t);return`\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  `}(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}(e.logicalShape,i,n.enableShapeUniforms),l=function(t){return`\n    void setOutput(float val) {\n      ${t.output} = vec4(val, 0, 0, 0);\n    }\n  `}(a)),n.packedInputs&&(f+=f$);return[f,u,l,s,c,o,n.userCode].join("\n")}function i$(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;const[s,o]=t.shapeInfo.texShape;if(1===s&&1===o)return`\n      float ${r}() {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const i=p$(n);if(e)return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${i});\n      return sampleTexture(${n}, uv);\n    }\n  `;const[a,u]=t.shapeInfo.texShape;return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${a}, ${u}, ${i});\n      return sampleTexture(${n}, uv);\n    }\n  `}(t,e);case 1:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`\n      float ${r}(int index) {\n        ${d$(t)}\n      }\n    `;const s=t.shapeInfo.texShape,o=s[0],i=s[1];if(1===i&&1===o)return`\n      float ${r}(int index) {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const a=p$(n);if(1===i)return e?`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${o}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(1===o)return e?`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(e)return`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});\n      return sampleTexture(${n}, uv);\n    }\n  `;return`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${o}, ${i}, index + ${a});\n      return sampleTexture(${n}, uv);\n    }\n  `}(t,e);case 2:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t.shapeInfo.texShape;if(null!=o&&Vp(n,o)){if(e)return`\n      float ${s}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `;const t=o[0];return`\n    float ${s}(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(${o[1]}.0, ${t}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `}const{newShape:i,keptDims:a}=qp(n),u=i;if(u.length<n.length){const n=["row","col"];return`\n      ${i$(g$(t,u),e)}\n      float ${s}(int row, int col) {\n        return ${s}(${b$(n,a)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${s}(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));\n        ${d$(t)}\n      }\n    `;const c=o[0],l=o[1],f=p$(r);if(1===l)return e?`\n      float ${s}(int row, int col) {\n        float index = dot(vec3(row, col, ${f}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${s}(int row, int col) {\n      float index = dot(vec3(row, col, ${f}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `;if(1===c)return e?`\n      float ${s}(int row, int col) {\n        float index = dot(vec3(row, col, ${f}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${s}(int row, int col) {\n      float index = dot(vec3(row, col, ${f}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2((index + 0.5) / ${l}.0, 0.5);\n      return sampleTexture(${r}, uv);\n    }\n  `;if(e)return`\n      float ${s}(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${r}Shape[1] + col + ${f};\n        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n        return sampleTexture(${r}, uv);\n      }\n    `;return`\n  float ${s}(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ${n[1]} + col + ${f};\n    vec2 uv = uvFromFlat(${c}, ${l}, index);\n    return sampleTexture(${r}, uv);\n  }\n`}(t,e);case 3:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n[1]*n[2],i=n[2],{newShape:a,keptDims:u}=qp(n),c=a;if(c.length<n.length){const n=["row","col","depth"];return`\n        ${i$(g$(t,c),e)}\n        float ${s}(int row, int col, int depth) {\n          return ${s}(${b$(n,u)});\n        }\n      `}if(t.shapeInfo.isUniform)return`\n      float ${s}(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(${o}, ${i}, 1)));\n        ${d$(t)}\n      }\n    `;const l=t.shapeInfo.texShape,f=l[0],h=l[1],p=t.shapeInfo.flatOffset;if(h===o&&null==p)return e?`\n      float ${s}(int row, int col, int depth) {\n        int stride1 = ${r}Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n        float ${s}(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(${i}, 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(${h}.0, ${f}.0);\n          return sampleTexture(${r}, uv);\n        }\n      `;if(h===i&&null==p)return e?`\n      float ${s}(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${s}(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${f}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `;const d=p$(r);if(e)return`\n    float ${s}(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ${r}Shape[1] * ${r}Shape[2];\n      int stride1 = ${r}Shape[2];\n      int index = row * ${o} + col * ${i} + depth + ${d};\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n      return sampleTexture(${r}, uv);\n    }\n    `;return`\n      float ${s}(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${o} + col * ${i} + depth + ${d};\n        vec2 uv = uvFromFlat(${f}, ${h}, index);\n        return sampleTexture(${r}, uv);\n      }\n  `}(t,e);case 4:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n[3],i=n[2]*o,a=n[1]*i,{newShape:u,keptDims:c}=qp(n);if(u.length<n.length){const n=["row","col","depth","depth2"];return`\n      ${i$(g$(t,u),e)}\n      float ${s}(int row, int col, int depth, int depth2) {\n        return ${s}(${b$(n,c)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${s}(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(${a}, ${i}, ${o}, 1)));\n        ${d$(t)}\n      }\n    `;const l=t.shapeInfo.flatOffset,f=t.shapeInfo.texShape,h=f[0],p=f[1],d=`int stride2 = ${r}Shape[3];`,m=`int stride1 = ${r}Shape[2] * stride2;`,y=`int stride0 = ${r}Shape[1] * stride1;`;if(p===a&&null==l)return e?`\n      float ${s}(int row, int col, int depth, int depth2) {\n        ${d}\n        ${m}\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${s}(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(${i}, ${o}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${h}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;if(p===o&&null==l)return e?`\n      float ${s}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${s}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${n[1]*n[2]}, ${n[2]}, 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${h}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;const g=p$(r);if(e)return`\n    float ${s}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ${d}\n      ${m}\n      ${y}\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${g});\n      return sampleTexture(${r}, uv);\n    }\n  `;return`\n    float ${s}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${a} + col * ${i} +\n          depth * ${o} + depth2;\n      vec2 uv = uvFromFlat(${h}, ${p}, index + ${g});\n      return sampleTexture(${r}, uv);\n    }\n  `}(t,e);case 5:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),s=e[4],o=e[3]*s,i=e[2]*o,a=e[1]*i,{newShape:u,keptDims:c}=qp(e);if(u.length<e.length){const e=["row","col","depth","depth2","depth3"];return`\n      ${i$(g$(t,u))}\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        return ${r}(${b$(e,c)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${a}, ${i}, ${o}, ${s})) +\n          depth3;\n        ${d$(t)}\n      }\n    `;const l=t.shapeInfo.flatOffset,f=t.shapeInfo.texShape,h=f[0],p=f[1];if(p===a&&null==l)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(${i}, ${o}, ${s}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${h}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(p===s&&null==l)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${e[1]*e[2]*e[3]},\n               ${e[2]*e[3]}, ${e[3]}, 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${h}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const d=p$(n);return`\n    float ${r}(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${a} + col * ${i} + depth * ${o} +\n          depth2 * ${s} + depth3 + ${d};\n      vec2 uv = uvFromFlat(${h}, ${p}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(t);case 6:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:s,keptDims:o}=qp(e);if(s.length<e.length){const e=["row","col","depth","depth2","depth3","depth4"];return`\n      ${i$(g$(t,s))}\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ${r}(${b$(e,o)});\n      }\n    `}const i=e[5],a=e[4]*i,u=e[3]*a,c=e[2]*u,l=e[1]*c;if(t.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(${l}, ${c}, ${u}, ${a})) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(${i}, 1)));\n        ${d$(t)}\n      }\n    `;const f=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,p=h[0],d=h[1];if(d===l&&null==f)return`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(${c}, ${u}, ${a}, ${i})) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${d}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(d===i&&null==f)return`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(${e[1]*e[2]*e[3]*e[4]},\n               ${e[2]*e[3]*e[4]},\n               ${e[3]*e[4]},\n               ${e[4]})) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${d}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const m=p$(n);return`\n    float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${l} + col * ${c} + depth * ${u} +\n          depth2 * ${a} + depth3 * ${i} + depth4 + ${m};\n      vec2 uv = uvFromFlat(${p}, ${d}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function a$(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return function(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=ZN();return`\n    vec4 ${n}() {\n      return ${r.texture2D}(${e}, halfCR);\n    }\n  `}(t);case 1:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),s=t.shapeInfo.texShape,o=ZN();if(e)return`\n    vec4 ${r}(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ${o.texture2D}(${n}, uv);\n    }\n  `;const i=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];return`\n    vec4 ${r}(int index) {\n      vec2 uv = packedUVfrom1D(\n        ${i[0]}, ${i[1]}, index);\n      return ${o.texture2D}(${n}, uv);\n    }\n  `}(t,e);case 2:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t.shapeInfo.texShape,i=o[0],a=o[1],u=ZN();if(null!=o&&Vp(n,o))return e?`\n      vec4 ${s}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n\n        return ${u.texture2D}(${r}, uv);\n      }\n    `:`\n      vec4 ${s}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);\n\n        return ${u.texture2D}(${r}, uv);\n      }\n    `;if(e)return`\n    vec4 ${s}(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ${u.texture2D}(${r}, uv);\n    }\n  `;const c=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],l=Math.ceil(n[1]/2);return`\n    vec4 ${s}(int row, int col) {\n      vec2 uv = packedUVfrom2D(${l}, ${c[0]}, ${c[1]}, row, col);\n      return ${u.texture2D}(${r}, uv);\n    }\n  `}(t,e);case 3:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===n[0]){const r=[1,2],o=["b","row","col"];return`\n        ${a$(g$(t,n.slice(1)),e)}\n        vec4 ${s}(int b, int row, int col) {\n          return ${s}(${b$(o,r)});\n        }\n      `}const a=ZN();if(e)return`\n    vec4 ${s}(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ${a.texture2D}(${r}, uv);\n    }\n  `;const u=i[0],c=i[1],l=Math.ceil(n[2]/2),f=l*Math.ceil(n[1]/2);return`\n    vec4 ${s}(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ${u}, ${c}, ${f}, ${l}, b, row, col);\n      return ${a.texture2D}(${r}, uv);\n    }\n  `}(t,e);default:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),s=ZN();if(e)return`\n    vec4 ${r}(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ${n}Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${s.texture2D}(${n}, uv);\n    }\n  `;const o=t.shapeInfo.logicalShape,i=o.length,a=t.shapeInfo.texShape,u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=u[0],l=u[1],f=Math.ceil(o[i-1]/2);let h=f*Math.ceil(o[i-2]/2),p="int b, int row, int col",d=`b * ${h} + (row / 2) * ${f} + (col / 2)`;for(let t=2;t<i-1;t++)p=`int b${t}, `+p,h*=o[i-t-1],d=`b${t} * ${h} + `+d;return`\n    vec4 ${r}(${p}) {\n      int index = ${d};\n      int texR = index / ${l};\n      int texC = index - texR * ${l};\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${l}, ${c});\n      return ${s.texture2D}(${n}, uv);\n    }\n  `}(t,e)}}const u$="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",c$="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",l$="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",f$="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function h$(){return"\n    int getOutputCoords() {\n      return 0;\n    }\n  "}function p$(t){return`offset${t}`}function d$(t){const e=t.name,n=Bp(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`\n    for (int i = 0; i < ${n}; i++) {\n      if (i == index) {\n        return ${e}[i];\n      }\n    }\n  `}function m$(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function y$(t,e,n){const{newShape:r,keptDims:s}=qp(e),o=e.length,i=t&&3===o&&1===e[0],a=i?e.slice(1):r,u=!t&&o>1&&!Vp(e,n)&&r.length<o||i;return{useSqueezeShape:u,uniformShape:u?a:e,keptDims:s}}function g$(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function b$(t,e){return e.map((e=>t[e])).join(", ")}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w$(t,e,n,r){const s=n.map(((t,n)=>{const r={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(r.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[n],shapeInfo:r}})),o=s.map((t=>t.shapeInfo)),i={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},a=o$(s,i,e),u=function(t,e){const n=PN(t,(()=>t.createShader(t.FRAGMENT_SHADER)),"Unable to create fragment WebGLShader.");if(TN(t,(()=>t.shaderSource(n,e))),TN(t,(()=>t.compileShader(n))),hd().get("ENGINE_COMPILE_ONLY"))return n;if(!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw ON(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(t.gl,a),c=t.createProgram(u);return hd().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:u,source:a,webGLProgram:c,inShapeInfos:o,outShapeInfo:i,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:e,fragmentShader:u,source:a,webGLProgram:c,inShapeInfos:o,outShapeInfo:i},v$(t,e,c))}function v$(t,e,n){const r={},s={},o={},i=[];let a,u,c,l=null,f=null;f=t.getUniformLocation(n,"NAN",!1),1===hd().getNumber("WEBGL_VERSION")&&(l=t.getUniformLocation(n,"INFINITY",!1));const h=!1;for(let i=0;i<e.variableNames.length;i++){const a=e.variableNames[i];r[a]=t.getUniformLocation(n,a,h),r[`offset${a}`]=t.getUniformLocation(n,`offset${a}`,h),e.enableShapeUniforms&&(s[`${a}Shape`]=t.getUniformLocation(n,`${a}Shape`,h),o[`${a}TexShape`]=t.getUniformLocation(n,`${a}TexShape`,h))}return e.enableShapeUniforms&&(a=t.getUniformLocation(n,"outShape",h),c=t.getUniformLocation(n,"outShapeStrides",h),u=t.getUniformLocation(n,"outTexShape",h)),e.customUniforms&&e.customUniforms.forEach(((e,r)=>{i[r]=t.getUniformLocation(n,e.name,h)})),{uniformLocations:r,customUniformLocations:i,infLoc:l,nanLoc:f,inShapesLocations:s,inTexShapesLocations:o,outShapeLocation:a,outShapeStridesLocation:c,outTexShapeLocation:u}}function x$(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach(((t,n)=>{const r=t.logicalShape,s=e[n],o=s.shape;if(!Vp(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(t.isUniform&&s.isUniform)return;const i=t.texShape,a=s.isUniform?null:s.texData.texShape;if(!Vp(i,a))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${i} and ${a} must match`)}))}function N$(t){return hd().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $${constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=vN.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=ZN();this.outputShape=t,this.enableShapeUniforms=N$(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?t$(["r","c","d"],t):QN(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${e.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E${constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=vN.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=ZN();this.outputShape=t,this.enableShapeUniforms=N$(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?t$(["r","c","d"],t):QN(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${e.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S${constructor(t){this.variableNames=["A"],this.outTexUsage=xN.DOWNLOAD;const e=ZN();this.outputShape=t,this.userCode=`\n      ${r$}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${e.output} = encode_float(x);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _${constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=xN.DOWNLOAD;const e=ZN();this.outputShape=t,this.userCode=`\n      ${r$}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${e.output} = encode_float(x);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class T${constructor(t,e=!1){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=ZN();this.outputShape=t,this.enableShapeUniforms=N$(this.outputShape.length);let r="result";e&&(r="floor(result * 255. + 0.5)"),this.userCode=`\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":n$(t)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / texShape[1];\n        int c = imod(flatIndex, texShape[1]);\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n        vec4 values = ${n.texture2D}(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ${n.output} = vec4(${r}, 0., 0., 0.);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class k${constructor(t,e=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=ZN();this.outputShape=t,this.enableShapeUniforms=N$(this.outputShape.length);let r="",s="result";e&&(s="floor(result * 255. + 0.5)");for(let e=0;e<=1;e++)for(let s=0;s<=1;s++){const o=2*e+s;r+=`\n          localCoords = coords;\n          if(localCoords[2] + ${s} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {\n          localCoords[2] += ${s};\n          if (localCoords[1] + ${e} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {\n            localCoords[1] += ${e};\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ${n.texture2D}(A, uv);\n\n            if (offset == 0) {\n              result[${o}] = values[0];\n            } else if (offset == 1) {\n              result[${o}] = values[1];\n            } else if (offset == 2) {\n              result[${o}] = values[2];\n            } else {\n              result[${o}] = values[3];\n            }\n          }\n        }\n        `}this.userCode=`\n        ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":n$(t)}\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ${r}\n\n          ${n.output} = ${s};\n        }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A$(t){const e=ZN();return function(t,e){const n=PN(t,(()=>t.createShader(t.VERTEX_SHADER)),"Unable to create vertex WebGLShader.");if(TN(t,(()=>t.shaderSource(n,e))),TN(t,(()=>t.compileShader(n))),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(t,`${e.version}\n    precision highp float;\n    ${e.attribute} vec3 clipSpacePos;\n    ${e.attribute} vec2 uv;\n    ${e.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`)}function C$(t){return function(t,e){const n=PN(t,(()=>t.createBuffer()),"Unable to create WebGLBuffer");return TN(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,n))),TN(t,(()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW))),n}(t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function O$(t){return function(t,e){const n=PN(t,(()=>t.createBuffer()),"Unable to create WebGLBuffer");return TN(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n))),TN(t,(()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW))),n}(t,new Uint16Array([0,1,2,2,1,3]))}function I$(t,e,n,r,s,o){!function(t,e){const n=hd().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0)throw new Error(`Requested texture size [${t}x${e}] is invalid.`);if(t>n||e>n)throw new Error(`Requested texture size [${t}x${e}] greater than WebGL maximum on this browser / GPU [${n}x${n}].`)}(e,n);const i=function(t){return PN(t,(()=>t.createTexture()),"Unable to create WebGLTexture.")}(t),a=t.TEXTURE_2D;return TN(t,(()=>t.bindTexture(a,i))),TN(t,(()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE))),TN(t,(()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE))),TN(t,(()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST))),TN(t,(()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST))),1===hd().getNumber("WEBGL_VERSION")?TN(t,(()=>t.texImage2D(a,0,r,e,n,0,s,o,null))):TN(t,(()=>t.texStorage2D(a,1,r,e,n))),TN(t,(()=>t.bindTexture(t.TEXTURE_2D,null))),{texture:i,texShape:[n,e]}}function M$(t){return t.internalFormatFloat}function R$(t){return t.internalFormatHalfFloat}function D$(t){return t.downloadTextureFormat}function F$(t){return t.internalFormatPackedFloat}function L$(t){return t.internalFormatPackedHalfFloat}function P$(t,e,n,r,s,o,i,a){const u=t,c=new Float32Array(function(t,e){const[n,r]=SN(t,e);return n*r*4}(o,i));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class B${constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const e=hd().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,function(t,e){gN[t]=e}(e,t)):this.gl=wN(e);let n="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===hd().getNumber("WEBGL_VERSION")){const t="OES_texture_float",e="OES_texture_half_float";if(this.textureFloatExtension=AN(this.gl,t),qN(this.gl,e))this.textureHalfFloatExtension=AN(this.gl,e);else if(hd().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),qN(this.gl,r))this.colorBufferHalfFloatExtension=AN(this.gl,r);else if(hd().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",qN(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!qN(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=C$(this.gl),this.indexBuffer=O$(this.gl),this.framebuffer=function(t){return PN(t,(()=>t.createFramebuffer()),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=_N(this.gl,this.textureHalfFloatExtension)}get debug(){return hd().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;TN(t,(()=>t.finish())),TN(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,null))),TN(t,(()=>t.deleteFramebuffer(this.framebuffer))),TN(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,null))),TN(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null))),TN(t,(()=>t.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[s,o]=$N(e,n);return I$(t,s,o,M$(r),r.textureFormatFloat,t.FLOAT)}(this.gl,t,e,this.textureConfig)}createFloat16MatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[s,o]=$N(e,n);return I$(t,s,o,R$(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,t,e,this.textureConfig)}createUnsignedBytesMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[s,o]=$N(e,n);return I$(t,s,o,D$(r),t.RGBA,t.UNSIGNED_BYTE)}(this.gl,t,e,this.textureConfig)}uploadPixelDataToTexture(t,e){this.throwIfDisposed(),function(t,e,n){TN(t,(()=>t.bindTexture(t.TEXTURE_2D,e))),n.data instanceof Uint8Array?2===hd().getNumber("WEBGL_VERSION")?TN(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data))):TN(t,(()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data))):2===hd().getNumber("WEBGL_VERSION")?TN(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n))):TN(t,(()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n))),TN(t,(()=>t.bindTexture(t.TEXTURE_2D,null)))}(this.gl,t,e)}uploadDenseMatrixToTexture(t,e,n,r){this.throwIfDisposed(),function(t,e,n,r,s,o){let i,a,u;TN(t,(()=>t.bindTexture(t.TEXTURE_2D,e))),s instanceof Uint8Array?(i=new Uint8Array(n*r*4),a=t.UNSIGNED_BYTE,u=t.RGBA):(i=new Float32Array(n*r*4),a=t.FLOAT,u=o.internalFormatPackedFloat),i.set(s),2===hd().getNumber("WEBGL_VERSION")?TN(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,r,t.RGBA,a,i))):TN(t,(()=>t.texImage2D(t.TEXTURE_2D,0,u,n,r,0,t.RGBA,a,i))),TN(t,(()=>t.bindTexture(t.TEXTURE_2D,null)))}(this.gl,t,e,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[s,o]=SN(e,n);return I$(t,s,o,L$(r),t.RGBA,r.textureTypeHalfFloat)}(this.gl,t,e,this.textureConfig)}createPackedMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[s,o]=SN(e,n);return I$(t,s,o,F$(r),t.RGBA,t.FLOAT)}(this.gl,t,e,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(FN(this.gl,this.framebuffer),this.outputTexture=null),TN(this.gl,(()=>this.gl.deleteTexture(t)))}downloadByteEncodedFloatMatrixFromOutputTexture(t,e,n){return this.downloadMatrixDriver(t,(()=>function(t,e,n,r){const[s,o]=$N(e,n),i=new Uint8Array(e*n*4);return TN(t,(()=>t.readPixels(0,0,s,o,r.downloadTextureFormat,t.UNSIGNED_BYTE,i))),new Float32Array(i.buffer)}(this.gl,e,n,this.textureConfig)))}downloadPackedMatrixFromBuffer(t,e,n,r,s,o){return P$(this.gl,t,0,0,0,s,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,e){return function(t,e,n){const r=t,s=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,s),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),s}(this.gl,t,e)}createBufferFromTexture(t,e,n){this.bindTextureToFrameBuffer(t);const r=function(t,e,n,r){const s=t.createBuffer();TN(t,(()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,s)));const o=16*e*n;return TN(t,(()=>t.bufferData(t.PIXEL_PACK_BUFFER,o,t.STREAM_READ))),TN(t,(()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0))),TN(t,(()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null))),s}(this.gl,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let e,n;if(hd().getBool("WEBGL_FENCE_API_ENABLED")){const r=t,s=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=()=>{const t=r.clientWaitSync(s,0,0);return t===r.ALREADY_SIGNALED||t===r.CONDITION_SATISFIED},e=s}else hd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(e,hd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:e,isFencePassed:n}}downloadMatrixFromPackedTexture(t,e,n){return this.downloadMatrixDriver(t,(()=>function(t,e,n){const r=new Float32Array(e*n*4);return TN(t,(()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,r))),r}(this.gl,e,n)))}createProgram(t){this.throwIfDisposed();const e=this.gl;null==this.vertexShader&&(this.vertexShader=A$(e));const n=function(t){return PN(t,(()=>t.createProgram()),"Unable to create WebGLProgram.")}(e);return TN(e,(()=>e.attachShader(n,this.vertexShader))),TN(e,(()=>e.attachShader(n,t))),function(t,e){if(TN(t,(()=>t.linkProgram(e))),!hd().get("ENGINE_COMPILE_ONLY")&&!1===t.getProgramParameter(e,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}(e,n),this.debug&&IN(e,n),this.vertexAttrsAreBound||(this.setProgram(n),this.vertexAttrsAreBound=function(t,e,n){return TN(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,n))),MN(t,e,"clipSpacePos",n,3,20,0)&&MN(t,e,"uv",n,2,20,12)}(e,this.program,this.vertexBuffer)),n}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&TN(this.gl,(()=>this.gl.deleteProgram(t)))}setProgram(t){this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&IN(this.gl,this.program),TN(this.gl,(()=>this.gl.useProgram(t)))}getUniformLocation(t,e,n=!0){return this.throwIfDisposed(),n?function(t,e,n){return PN(t,(()=>t.getUniformLocation(e,n)),'uniform "'+n+'" not present in program.')}(this.gl,t,e):function(t,e,n){return t.getUniformLocation(e,n)}(this.gl,t,e)}getAttributeLocation(t,e){return this.throwIfDisposed(),TN(this.gl,(()=>this.gl.getAttribLocation(t,e)))}getUniformLocationNoThrow(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)}setInputMatrixTexture(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(t,e,n,r){TN(t,(()=>RN(t,e,r))),TN(t,(()=>t.uniform1i(n,r)))}(this.gl,t,e,n)}setOutputMatrixTexture(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)}setOutputPackedMatrixTexture(t,e,n){this.throwIfDisposed();const[r,s]=SN(e,n);this.setOutputMatrixTextureDriver(t,r,s)}setOutputMatrixWriteRegion(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)}setOutputPackedMatrixWriteRegion(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&IN(this.gl,this.program),LN(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;this.debug&&this.debugValidate(),TN(t,(()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),TN(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=AN(this.gl,2===hd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===hd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}const t=this.getQueryTimerExtensionWebGL1(),e=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,e),e}endQuery(){if(2===hd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2();return void t.endQuery(e.TIME_ELAPSED_EXT)}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await jp((()=>this.disposed||this.isQueryAvailable(t,hd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(t,hd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,e){if(0===e)return null;if(2===e){const e=this.gl;return e.getQueryParameter(t,e.QUERY_RESULT)/1e6}{const e=this.getQueryTimerExtensionWebGL1();return e.getQueryObjectEXT(t,e.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,e){if(0===e)return!0;if(2===e){const e=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const e=this.getQueryTimerExtensionWebGL1(),n=e.getQueryObjectEXT(t,e.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(e.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(t){return new Promise((e=>{this.addItemToPoll((()=>t.isFencePassed()),(()=>e()))}))}pollItems(){const t=function(t){let e=0;for(;e<t.length;++e){if(!t[e]())break}return e-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(this.itemsToPoll.map((t=>t.isDoneFn)));for(let e=0;e<=t;++e){const{resolveFn:t}=this.itemsToPoll[e];t()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,e){this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||jp((()=>(this.pollItems(),0===this.itemsToPoll.length)))}bindTextureToFrameBuffer(t){this.throwIfDisposed(),DN(this.gl,t,this.framebuffer),this.debug&&LN(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(DN(this.gl,this.outputTexture,this.framebuffer),this.debug&&LN(this.gl)):FN(this.gl,this.framebuffer)}downloadMatrixDriver(t,e){this.bindTextureToFrameBuffer(t);const n=e();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(t,e,n){this.throwIfDisposed();const r=this.gl;DN(r,t,this.framebuffer),this.debug&&LN(r),this.outputTexture=t,TN(r,(()=>r.viewport(0,0,e,n))),TN(r,(()=>r.scissor(0,0,e,n)))}setOutputMatrixWriteRegionDriver(t,e,n,r){this.throwIfDisposed(),TN(this.gl,(()=>this.gl.scissor(t,e,n,r)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function V$(t){return(e,n,r,s,o)=>{const i=wb(e,n),a=i.length,u=ed(i),c=Hp(o,Bp(i)),l=e.length,f=n.length,h=ed(e),p=ed(n),d=gb(e,i),m=gb(n,i);if(d.length+m.length===0)for(let e=0;e<c.length;++e)c[e]=t(r[e%r.length],s[e%s.length]);else for(let e=0;e<c.length;++e){const n=ud(e,a,u),o=n.slice(-l);d.forEach((t=>o[t]=0));const i=ad(o,l,h),y=n.slice(-f);m.forEach((t=>y[t]=0));const g=ad(y,f,p);c[e]=t(r[i],s[g])}return[c,i]}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z$=V$(((t,e)=>t+e));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function W$(t){return(e,n,r)=>{const s=Hp(n,e.length);for(let n=0;n<e.length;++n)s[n]=t(e[n],r);return s}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U$=W$((t=>Math.ceil(t)));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const j$=V$(((t,e)=>t===e?1:0)),G$=W$((t=>Math.exp(t))),q$=W$((t=>Math.expm1(t))),H$=W$((t=>Math.floor(t)));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const K$=V$(((t,e)=>t>e?1:0)),X$=V$(((t,e)=>t>=e?1:0)),J$=V$(((t,e)=>t<e?1:0)),Y$=V$(((t,e)=>t<=e?1:0));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Z$=W$((t=>Math.log(t)));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Q$=V$(((t,e)=>Math.max(t,e))),tE=V$(((t,e)=>Math.min(t,e))),eE=V$(((t,e)=>t*e));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const nE=V$(((t,e)=>t!==e?1:0));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const rE=W$((t=>1/Math.sqrt(t)));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const sE=W$((t=>1/(1+Math.exp(-t))));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const oE=W$((t=>Math.sqrt(t))),iE=V$(((t,e)=>{const n=t-e;return n*n}));
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class aE{constructor(t,e,n,r,s,o){this.separator=Bm(t),this.nGramWidths=e,this.leftPad=Bm(n),this.rightPad=Bm(r),this.padWidth=s,this.preserveShort=o}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,e){const n=this.getPadWidth(e);return Math.max(0,t+2*n-e+1)}createNGrams(t,e,n,r,s,o){for(let i=0;i<s;++i){const a=this.getPadWidth(o),u=Math.max(0,a-i),c=Math.max(0,a-(s-(i+1))),l=o-(u+c),f=e+(u>0?0:i-a);let h=0;h+=u*this.leftPad.length;for(let e=0;e<l;++e)h+=t[f+e].length;h+=c*this.rightPad.length;h+=(u+c+l-1)*this.separator.length,n[r+i]=new Uint8Array(h);const p=n[r+i];let d=0;const m=t=>t.forEach((t=>p[d++]=t));for(let t=0;t<u;++t)m(this.leftPad),m(this.separator);for(let e=0;e<l-1;++e)m(t[f+e]),m(this.separator);if(l>0){m(t[f+l-1]);for(let t=0;t<c;++t)m(this.separator),m(this.rightPad)}else{for(let t=0;t<c-1;++t)m(this.rightPad),m(this.separator);m(this.rightPad)}}}compute(t,e){const n=t.length,r=e.length;if(r>0){let t=e[0];if(0!==t)throw new Error(`First split value must be 0, got ${t}`);for(let s=1;s<r;++s){let r=e[s]>=t;if(r=r&&e[s]<=n,!r)throw new Error(`Invalid split value ${e[s]}, must be in [${t}, ${n}]`);t=e[s]}if(t!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${t}`)}const s=r-1,o=Kp("int32",r);if(0===n||0===r){const t=new Array(n);for(let t=0;t<=s;++t)o[t]=0;return[t,o]}o[0]=0;for(let t=1;t<=s;++t){const n=e[t]-e[t-1];let r=0;this.nGramWidths.forEach((t=>{r+=this.getNumNGrams(n,t)})),this.preserveShort&&n>0&&0===r&&(r=1),o[t]=o[t-1]+r}const i=new Array(o[s]);for(let n=0;n<s;++n){const r=e[n];let s=o[n];if(this.nGramWidths.forEach((o=>{const a=e[n+1]-e[n],u=this.getNumNGrams(a,o);this.createNGrams(t,r,i,s,u,o),s+=u})),this.preserveShort&&s===o[n]){const o=e[n+1]-e[n];if(0===o)continue;const a=o+2*this.padWidth,u=1;this.createNGrams(t,r,i,s,u,a)}}return[i,o]}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function uE(t,e,n,r){if(!t.length)return;if(0===e.length){for(let e=0;e<t.length;++e)r.push(t.subarray(e,e+1));return}if(1===e.length){const s=e[0];let o=t.indexOf(s);for(;-1!==o;){const e=t.subarray(0,o);n&&0===e.length||r.push(e),t=t.subarray(o+1),o=t.indexOf(s)}return void(n&&0===t.length||r.push(t))}let s=0;for(let o=0;o<t.length+1;o++)if(o===t.length||-1!==e.indexOf(t[o])){const e=t.subarray(s,o);n&&0===e.length||r.push(e),s=o+1}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const cE=V$(((t,e)=>t-e));
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const lE=(t,e)=>{const n=e.value-t.value;return 0===n?t.index-e.index:n};function fE(t,e,n=0,r=t.length-1){for(;r>n;){if(r-n>600){const s=r-n+1,o=e-n+1,i=Math.log(s),a=.5*Math.exp(2*i/3),u=.5*Math.sqrt(i*a*(s-a)/s)*Math.sign(o-s/2);fE(t,e,Math.max(n,Math.floor(e-o*a/s+u)),Math.min(r,Math.floor(e+(s-o)*a/s+u)))}const s=t[e];let o=n,i=r;for(Rp(t,n,e),lE(t[r],s)>0&&Rp(t,n,r);o<i;){for(Rp(t,o,i),o++,i--;lE(t[o],s)<0;)o+=1;for(;lE(t[i],s)>0;)i-=1}0===lE(t[n],s)?Rp(t,n,i):(i+=1,Rp(t,i,r)),i<=e&&(n=i+1),e<=i&&(r=i-1)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var hE=Object.freeze({__proto__:null,simpleAbsImpl:function(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e},addImpl:z$,bincountImpl:function(t,e,n,r,s){const o=Bp(r),i=od(s,n);for(let n=0;n<t.length;n++){const r=t[n];if(r<0)throw new Error("Input x must be non-negative!");r>=s||(i[r]+=o>0?e[n]:1)}return i},bincountReduceImpl:function(t,e,n,r=!1){const s=t.shape[0],o=t.shape[1],i=Zg([s,n],e.dtype);for(let a=0;a<s;a++)for(let s=0;s<o;s++){const o=t.get(a,s);if(o<0)throw new Error("Input x must be non-negative!");o>=n||(r?i.set(1,a,o):e.size>0?i.set(i.get(a,o)+e.get(a,s),a,o):i.set(i.get(a,o)+1,a,o))}return i},ceilImpl:U$,concatImpl:function(t,e,n,r){const s=Kp(n,Bp(e));if(r&&"string"!==n){let e=0;t.forEach((t=>{const n=Bp(t.shape);s.set(t.vals,e),e+=n}))}else{let r=0;t.forEach((t=>{const o="string"===n?dN(t.vals):t.vals;let i=0;for(let n=0;n<t.shape[0];++n){const a=n*e[1]+r;for(let e=0;e<t.shape[1];++e)s[a+e]=o[i++]}r+=t.shape[1]}))}return s},equalImpl:j$,expImpl:G$,expm1Impl:q$,floorImpl:H$,gatherNdImpl:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s,o,i,a,u){const c=Zg([r,o],n);for(let n=0;n<r;n++){const r=[];let l=0;for(let e=0;e<s;e++){const o=t[n*s+e];l+=o*i[e],r.push(o)}if(l<0||l>=u/o)throw new Error(`Invalid indices: ${r} does not index into ${a}`);for(let t=0;t<o;t++)c.values[n*o+t]=e.get(...e.indexToLoc(l*o+t))}return c}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,gatherV2Impl:function(t,e,n){const r=Zg(n,t.dtype);for(let n=0;n<r.size;++n){const s=r.indexToLoc(n).slice(),o=s[0],i=s[2],a=e.locToIndex([o,i]);s[2]=e.values[a];const u=t.locToIndex(s);0<=u&&u<t.values.length&&(r.values[n]=t.values[u])}return r},greaterImpl:K$,greaterEqualImpl:X$,lessImpl:J$,lessEqualImpl:Y$,linSpaceImpl:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=(e-t)/(n-1),s=od(n,"float32");s[0]=t;for(let t=1;t<s.length;t++)s[t]=s[t-1]+r;return s},logImpl:Z$,maxImpl:function(t,e,n,r){const s=Hp(r,Bp(n));for(let n=0;n<s.length;++n){const r=n*e;let o=t[r];for(let n=0;n<e;++n){const e=t[r+n];(Number.isNaN(e)||e>o)&&(o=e)}s[n]=o}return s},maximumImpl:Q$,minimumImpl:tE,multiplyImpl:eE,negImpl:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n){const r=Fm(-1,n);return eE([],e,r,t,n)},notEqualImpl:nE,prodImpl:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const[s,o]=kw(t,r),i=iy(e,"int32"),a=od(Bp(s),i),u=Bp(o);for(let t=0;t<a.length;++t){const e=t*u;let r=1;for(let t=0;t<u;++t)r*=n[e+t];a[t]=r}return{outVals:a,outShape:s,outDtype:i}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,rangeImpl:function(t,e,n,r){if(t===e||t<e&&n<0||e<t&&n>1)return od(0,r);const s=od(Math.abs(Math.ceil((e-t)/n)),r);e<t&&1===n&&(n=-1),s[0]=t;for(let t=1;t<s.length;t++)s[t]=s[t-1]+n;return s},rsqrtImpl:rE,scatterImpl:function(t,e,n,r,s,o,i,a,u,c){const l=[r/s,s],f=t.values,h=e.values;if(0===r)return Zg(n,e.dtype);const p=Zg(l,e.dtype);"string"==typeof u||"number"==typeof u?p.values.fill(u):"boolean"==typeof u&&p.values.fill(+u);for(let t=0;t<o;t++){const o=[];let u=0;for(let e=0;e<i;e++){const n=f[t*i+e];o.push(n),u+=n*a[e]}if(u<0||u>=r/s)throw new Error(`Invalid indices: ${o} does not index into ${n}`);for(let n=0;n<s;n++)c?p.values[u*s+n]+=h[t*s+n]:p.values[u*s+n]=0===e.rank?h[0]:h[t*s+n]}return p},sigmoidImpl:sE,sliceImpl:function(t,e,n,r,s){const o=Db(r,e,n),i=Bp(n),a=ed(r);if(o){const n=Fb(e,a);return"string"===s?t.slice(n,n+i):t.subarray(n,n+i)}const u=Zg(r,s,"string"===s?dN(t):t),c=Zg(n,s);for(let t=0;t<c.size;++t){const n=c.indexToLoc(t),r=n.map(((t,n)=>t+e[n]));c.set(u.get(...r),...n)}return"string"===s?mN(c.values):c.values}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,sparseFillEmptyRowsImpl:function(t,e,n,r,s,o,i){const a=e[0],u=o[0],c=new Array(u),l=new Array(a),f=e[1];if(0===u){if(0!==a)throw new Error(Zx(a));return[Kp(n,0),[0,f],Kp(s,0),c,l]}let h=!0,p=0;const d=new Array(u).fill(0);for(let e=0;e<a;++e){const n=t[e*f];if(n<0)throw new Error(Qx(e,n));if(n>=u)throw new Error(tN(e,n,u));++d[n],h=h&&n>=p,p=n}let m=!0;for(let t=0;t<u;++t){const e=0===d[t];c[t]=e,m=m&&!e,d[t]=Math.max(d[t],1),t>0&&(d[t]+=d[t-1])}if(m&&h){const e=t,n=r;for(let t=0;t<a;++t)l[t]=t;return[e,[a,f],n,c,l]}{const e=d[u-1],o=Kp(n,e*f),h=Kp(s,e),p=new Array(u).fill(0);for(let e=0;e<a;++e){const n=t[e*f],s=p[n],i=(0===n?0:d[n-1])+s;p[n]++;for(let n=0;n<f;++n)o[i*f+n]=t[e*f+n];h[i]=r[e],l[e]=i}for(let t=0;t<u;++t){if(0===p[t]){const e=0===t?0:d[t-1];o[e*f+0]=t;for(let t=1;t<f;++t)o[e*f+t]=0;h[e]=i}}return[o,[e,f],h,c,l]}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,sparseReshapeImpl:function(t,e,n,r,s){const o=Bp(r),i=e[0],a=s.length,u=[];let c=1,l=-1;for(let t=0;t<a;++t){const e=s[t];if(-1===e){if(-1!==l)throw new Error(eN(l,t));l=t,u.push(1)}else{if(e<0)throw new Error(nN(t,e));c*=e,u.push(e)}}if(-1!==l){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");const t=Math.trunc(o/c);if(c*t!==o)throw new Error(sN(r,u));u[l]=t}if(Bp(u)!==o)throw new Error(oN(r,u));const f=r.length,h=[];if(f>0){h[f-1]=1;for(let t=f-2;t>=0;--t)h[t]=h[t+1]*r[t+1]}const p=[];if(a>0){p[a-1]=1;for(let t=a-2;t>=0;--t)p[t]=p[t+1]*u[t+1]}const d=Kp(n,i*a);for(let e=0;e<i;++e){let n=0;for(let r=0;r<f;++r)n+=t[e*f+r]*h[r];for(let t=0;t<a;++t)d[e*a+t]=Math.trunc(n/p[t]),n%=p[t]}return[d,[i,a],u]}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,sparseSegmentReductionImpl:function(t,e,n,r,s,o=!1,i=0){const a=r.length,u=[e[0],t.length/e[0]],c=u[1],l=a>0?s[a-1]+1:0;if(l<0)throw new Error("segment ids must be >= 0");const f=e.slice();f[0]=l;const h=Kp(n,f.reduce(((t,e)=>t*e),1));if(0===a)return l>0&&h.fill(i),[h,f];if(l<=0)throw new Error("segment ids must be >= 0");let p=0,d=1,m=0,y=s[p];for(;;){let e=0;if(d<a){if(e=s[d],y===e){++d;continue}if(y>=e)throw new Error("segment ids are not increasing")}if(y<0||y>=l)throw new Error(uN(y,l));y>m&&h.fill(i,m*c,y*c);for(let e=p;e<d;++e){const n=r[e];if(n<0||n>=u[0])throw new Error(cN(e,r[e],u[0]));for(let e=0;e<c;e++)h[y*c+e]+=t[n*c+e]}if(o)for(let t=0;t<c;t++)h[y*c+t]/=d-p;if(p=d,++d,m=y+1,y=e,d>a)break}return m<l&&h.fill(i,m*c,l*c),[h,f]},sqrtImpl:oE,squaredDifferenceImpl:iE,stridedSliceImpl:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const s=Zg(t,e.dtype);for(let t=0;t<s.size;t++){const o=s.indexToLoc(t),i=new Array(o.length);for(let t=0;t<i.length;t++)i[t]=o[t]*n[t]+r[t];s.set(e.get(...i),...o)}return s},stringNGramsImpl:function(t,e,n,r,s,o,i,a){return new aE(n,r,s,o,i,a).compute(t,e)},stringSplitImpl:function(t,e,n){const r=t.length,s=[];let o=0,i=0;const a=new Array(r);for(let u=0;u<r;++u){const r=s.length;uE(t[u],e,n,s);const c=s.length-r;a[u]=c,o+=c,i=Math.max(i,c)}const u=Kp("int32",2*o),c=new Array(o),l=[r,i];let f=0;for(let t=0;t<r;++t)for(let e=0;e<a[t];++e)u[2*f]=t,u[2*f+1]=e,c[f]=s[f],++f;return[u,c,l]}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,stringToHashBucketFastImpl:function(t,e){const n=Kp("int32",t.length);for(let r=0;r<t.length;++r)n[r]=Dm(t[r]).modulo(e).getLowBitsUnsigned();return n},subImpl:cE,tileImpl:function(t,e){const n=new Array(t.rank);for(let r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];const r=Zg(n,t.dtype);for(let e=0;e<r.values.length;++e){const n=r.indexToLoc(e),s=new Array(t.rank);for(let e=0;e<s.length;e++)s[e]=n[e]%t.shape[e];const o=t.locToIndex(s);r.values[e]=t.values[o]}return r},topKImpl:function(t,e,n,r,s){const o=e[e.length-1],[i,a]=[t.length/o,o],u=Hp(n,i*r),c=Hp("int32",i*r);for(let e=0;e<i;e++){const n=e*a,o=t.subarray(n,n+a);let i=new Array(o.length);o.forEach(((t,e)=>i[e]={value:t,index:e})),r<i.length&&(fE(i,r),i=i.slice(0,r)),s&&i.sort(lE);const l=e*r,f=u.subarray(l,l+r),h=c.subarray(l,l+r);for(let t=0;t<r;t++)f[t]=i[t].value,h[t]=i[t].index}const l=e.slice();return l[l.length-1]=r,[Zg(l,n,u),Zg(l,"int32",c)]}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,transposeImpl:function(t,e,n,r,s){const o=e.length,i=Bp(e),a=ed(e),u=ed(s),c=Hp(n,Bp(s));for(let e=0;e<i;++e){const n=ud(e,o,a),s=new Array(n.length);for(let t=0;t<s.length;t++)s[t]=n[r[t]];c[ad(s,o,u)]=t[e]}return c},uniqueImpl:function(t,e,n,r){const s=Gp(e,n)[0],o=[1,n[0],1];for(let t=0;t<s;t++)o[0]*=n[t];o[1]=n[s];for(let t=s+1;t<n.length;t++)o[2]*=n[t];const i={},a=new Int32Array(n[s]),u=new Xm(o,r,t),c=[],l=1===o[0]&&1===o[2];for(let e=0;e<n[s];e++){let n;if(l)n=t[e].toString();else{const t=[];for(let n=0;n<o[0];n++)for(let r=0;r<o[2];r++)t.push(u.get(n,e,r));n=t.join(",")}if(void 0!==i[n])a[e]=i[n];else{const t=Object.keys(i).length;i[n]=t,a[e]=t,c.push(e)}}const f=o.slice();f[1]=Object.keys(i).length;const h=new Xm(f,r);c.forEach(((t,e)=>{for(let n=0;n<o[0];n++)for(let r=0;r<o[2];r++)h.set(u.get(n,t,r),n,e,r)}));const p=n.slice();return p[s]=f[1],{outputValues:h.values,outputShape:p,indices:a}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:pE,bincountImpl:dE,bincountReduceImpl:mE,ceilImpl:yE,concatImpl:gE,equalImpl:bE,expImpl:wE,expm1Impl:vE,floorImpl:xE,gatherNdImpl:NE,gatherV2Impl:$E,greaterImpl:EE,greaterEqualImpl:SE,lessImpl:_E,lessEqualImpl:TE,linSpaceImpl:kE,logImpl:AE,maxImpl:CE,maximumImpl:OE,minimumImpl:IE,multiplyImpl:ME,negImpl:RE,notEqualImpl:DE,prodImpl:FE,rangeImpl:LE,rsqrtImpl:PE,scatterImpl:BE,sigmoidImpl:VE,simpleAbsImpl:zE,sliceImpl:WE,sparseFillEmptyRowsImpl:UE,sparseReshapeImpl:jE,sparseSegmentReductionImpl:GE,sqrtImpl:qE,stridedSliceImpl:HE,stringNGramsImpl:KE,stringSplitImpl:XE,stringToHashBucketFastImpl:JE,subImpl:YE,tileImpl:ZE,topKImpl:QE,transposeImpl:tS,uniqueImpl:eS}=hE;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nS(t,e){return["x","y","z","w","u","v"].slice(0,e).map((e=>`${t}.${e}`))}function rS(t,e){return 1===e?[t]:nS(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class sS{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=N$(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const t=rS("rc",this.rank),e=m$(this.rank),n=this.getOutOfBoundsCondition(t),r=this.getSetup(t),s=this.getOutput(t);this.userCode=`\n        void main() {\n          ${e} rc = getOutputCoords();\n\n          if(${n}) {\n            setOutput(vec4(0));\n          } else {\n            ${r}\n\n            setOutput(vec4(${s}));\n          }\n        }\n      `}}getSourceCoordsArr(t){const e=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let s=`${0===n?"r":"rp1"}, ${0===r?"c":"cp1"}`;for(let e=2;e<this.rank;e++)s=`${t[t.length-1-e]},`+s;e.push(s)}return e}getOutOfBoundsCondition(t){if(1===this.rank)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let e="";for(let n=this.rank-2;n<this.rank;n++)e+=`${t[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(e+="||");return e}getSetup(t){if(1===this.rank)return"";const e=t.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`\n      int r = ${e[0]};\n      int c = ${e[1]};\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ${n};\n      bool rEdge = rp1 >= ${r};\n    `}getOutput(t){const e=this.getSourceCoordsArr(t);if(1===this.rank){return`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`}return`getA(${e[0]}),\n            cEdge ? 0. : getA(${e[1]}),\n            rEdge ? 0. : getA(${e[2]}),\n            rEdge || cEdge ? 0. : getA(${e[3]})`}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oS{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=N$(this.outputShape.length);let n="";for(let t=0;t<4;t++){let e="thisRC = rc;";t%2==1&&(e+="thisRC.z += 1;"),t>1&&(e+="thisRC.y += 1;"),n+=`\n        ${e}\n        ${t>0?"if(thisRC.y < rows && thisRC.z < cols){":""}\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${t}] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ${t>0?"}":""}\n      `}var r,s;
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */this.userCode=`\n      ${r=e,s=this.enableShapeUniforms,`\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${s?e$(["r","c","d"],"inputShape"):QN(["r","c","d"],r)}\n      return ivec3(r, c, d);\n    }\n  `}\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":n$(t)}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};\n        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};\n\n        ${n}\n\n        setOutput(result);\n      }\n    `}}class iS{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(t,e,n){const r=uS(e,n),s=cS(t,r,n);s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]);const o=aS(t,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const t=this.freeTextures[s].shift();return this.usedTextures[s].push(t),t}let i;return r===NN.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):r===NN.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):r===NN.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):r===NN.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):r===NN.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[s].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}releaseTexture(t,e,n,r){if(null==this.freeTextures)return;const s=uS(n,r),o=cS(e,s,r);o in this.freeTextures||(this.freeTextures[o]=[]);const i=aS(e,s,this.gpgpu.gl,this.gpgpu.textureConfig,r),a=hd().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==a&&this._numBytesAllocated>a?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=i):(this.freeTextures[o].push(t),this.numFreeTextures++,this._numBytesFree+=i),this.numUsedTextures--;const u=this.usedTextures[o],c=u.indexOf(t);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(c,1),this.log()}log(){if(!this.logEnabled)return;const t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);const e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const t in this.freeTextures)this.freeTextures[t].forEach((t=>{this.gpgpu.deleteMatrixTexture(t.texture)}));for(const t in this.usedTextures)this.usedTextures[t].forEach((t=>{this.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function aS(t,e,n,r,s){const o=function(t,e){switch(t){case NN.PACKED_2X2_FLOAT32:return F$(e);case NN.PACKED_2X2_FLOAT16:return L$(e);case NN.UNPACKED_FLOAT32:return M$(e);case NN.UNPACKED_FLOAT16:return R$(e);case NN.PACKED_4X1_UNSIGNED_BYTE:return D$(e);default:throw new Error(`Unknown physical texture type ${t}`)}}(e,r);let i;if(s){const[e,n]=SN(t[0],t[1]);i=e*n}else{const[e,n]=$N(t[0],t[1]);i=e*n}const a=function(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}(n,o);return i*a}function uS(t,e){if(t===xN.UPLOAD)return NN.PACKED_2X2_FLOAT32;if(t===xN.RENDER||null==t)return function(t){return hd().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?NN.PACKED_2X2_FLOAT32:NN.UNPACKED_FLOAT32:t?NN.PACKED_2X2_FLOAT16:NN.UNPACKED_FLOAT16}(e);if(t===xN.DOWNLOAD||t===xN.PIXELS)return NN.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function cS(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lS{constructor(t,e){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=N$(this.outputShape.length),this.userCode=`\n      float unaryOperation(float x) {\n        ${e}\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}const fS="return x;";class hS{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=N$(this.outputShape.length),this.userCode=`\n      vec4 unaryOperation(vec4 x) {\n        ${e}\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pS{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=N$(this.outputShape.length);const e=t.length,n=rS("rc",e),r=m$(e),s=function(t,e){if(1===t)return"rc";let n="";for(let r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}(e,n),o=n.slice(-2),i=e<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`\n      void main() {\n        ${r} rc = getOutputCoords();\n        vec4 packedInput = getA(${s});\n\n        setOutput(getChannel(packedInput, ${i}));\n      }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dS=function(t,e){const n=[];for(let t=0;t<e.length;t++)e[t]&&n.push(t);const r=Zg(t,"int32"),s=Zg([n.length,t.length],"int32");for(let e=0;e<n.length;e++){const o=r.indexToLoc(n[e]),i=e*t.length;s.values.set(o,i)}return s.toTensor()},mS={};const yS=hd().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class gS extends Cp{constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!hd().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let e;if(null!=t){if(t instanceof B$)e=t;else{const n=wN(hd().getNumber("WEBGL_VERSION"),t);e=new B$(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const t=wN(hd().getNumber("WEBGL_VERSION"));e=new B$(t),this.binaryCache=((n=hd().getNumber("WEBGL_VERSION"))in mS||(mS[n]={}),mS[n]),this.gpgpuCreatedLocally=!0}var n;this.gpgpu=e,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new iS(this.gpgpu),this.numMBBeforeWarning=null==hd().global.screen?1024:hd().global.screen.height*hd().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new Ap(this,lb())}nextDataId(){return gS.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(t,e,n){if((hd().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||hd().getBool("DEBUG"))&&this.checkNumericalProblems(t),"complex64"===n&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:e,dtype:n,values:t,usage:xN.UPLOAD,refCount:1}),r}refCount(t){if(this.texData.has(t)){return this.texData.get(t).refCount}return 0}incRef(t){this.texData.get(t).refCount++}decRef(t){if(this.texData.has(t)){this.texData.get(t).refCount--}}move(t,e,n,r,s){if(hd().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:n,dtype:r,values:e,usage:xN.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){const e=this.texData.get(t),{values:n,dtype:r,complexTensorInfos:s,slice:o,shape:i,isPacked:a}=e;if(null!=o){let e;e=a?new hS(i,fS):new lS(i,fS);const n=this.runWebGLProgram(e,[{dataId:t,shape:i,dtype:r}],r),s=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),s}if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===r)return n;const u=null!=this.activeTimers;let c,l;if(u&&(c=Pm()),"complex64"===r){l=Ux(this.readSync(s.real.dataId),this.readSync(s.imag.dataId))}else l=this.getValuesFromTexture(t);return u&&(this.downloadWaitMs+=Pm()-c),this.convertAndCacheOnCPU(t,l)}async read(t){if(this.pendingRead.has(t)){const e=this.pendingRead.get(t);return new Promise((t=>e.push(t)))}const e=this.texData.get(t),{values:n,shape:r,slice:s,dtype:o,complexTensorInfos:i,isPacked:a}=e;if(null!=s){let e;e=a?new hS(r,fS):new lS(r,fS);const n=this.runWebGLProgram(e,[{dataId:t,shape:r,dtype:o}],o),s=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),s}if(null!=n)return this.convertAndCacheOnCPU(t);if(hd().getBool("DEBUG")&&!hd().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===hd().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u,c,l=null;if("complex64"!==o&&hd().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(t);const e=this.texData.get(u.dataId);l=this.gpgpu.createBufferFromTexture(e.texture.texture,...EN(r))}if(this.pendingRead.set(t,[]),"complex64"!==o&&await this.gpgpu.createAndWaitForFence(),"complex64"===o){const t=await Promise.all([this.read(i.real.dataId),this.read(i.imag.dataId)]);c=Ux(t[0],t[1])}else if(null==l)c=this.getValuesFromTexture(t);else{const t=Bp(r);c=this.gpgpu.downloadFloat32MatrixFromBuffer(l,t)}if(null!=u&&this.disposeIntermediateTensorInfo(u),null!=l){const t=this.gpgpu.gl;TN(t,(()=>t.deleteBuffer(l)))}const f=this.convertAndCacheOnCPU(t,c),h=this.pendingRead.get(t);return this.pendingRead.delete(t),h.forEach((t=>t(f))),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&lb().removeDataId(t,this),this.pendingDeletes--),f}readToGPU(t,e={}){const n=this.texData.get(t),{values:r,shape:s,slice:o,dtype:i,isPacked:a,texture:u}=n;if("complex64"===i)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=o){let n;n=a?new hS(s,fS):new lS(s,fS);const r=this.runWebGLProgram(n,[{dataId:t,shape:s,dtype:i}],i),o=this.readToGPU(r,e);return this.disposeIntermediateTensorInfo(r),o}if(null==u)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(t,e.customTexShape),l=lb().makeTensorFromTensorInfo(c),f=this.texData.get(c.dataId);return Object.assign({tensorRef:l},f.texture)}bufferSync(t){const e=this.readSync(t.dataId);if("string"===t.dtype)try{const n=e.map((t=>Vm(t)));return Zg(t.shape,t.dtype,n)}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return Zg(t.shape,t.dtype,e)}checkNumericalProblems(t){if(null!=t)for(let e=0;e<t.length;e++){const n=t[e];if(!kN(n)){if(hd().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(t){const{shape:e,dtype:n,isPacked:r}=this.texData.get(t),s=Bp(e);if(hd().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(t),r=this.texData.get(n.dataId),o=this.gpgpu.downloadMatrixFromPackedTexture(r.texture.texture,...EN(e)).subarray(0,s);return this.disposeIntermediateTensorInfo(n),o}const o=hd().getBool("WEBGL_PACK")&&!0===r,i=o?zN(e):e,a=o?new _$(i):new S$(i),u=this.runWebGLProgram(a,[{shape:i,dtype:n,dataId:t}],"float32"),c=this.texData.get(u.dataId),l=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(u),l}timerAvailable(){return hd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){const e=this.activeTimers,n=[];let r=!1;null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,t();const s=Pp(this.activeTimers.map((t=>t.query))).filter((t=>null!=t)),o=Pp(this.activeTimers.map((t=>t.name))).filter((t=>null!=t));this.activeTimers=e,r&&(this.programTimersStack=null);const i={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(hd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const t=await Promise.all(s);i.kernelMs=function(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}(t),i.getExtraProfileInfo=()=>t.map(((t,e)=>({name:o[e],ms:t}))).map((t=>`${t.name}: ${t.ms}`)).join(", ")}else i.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,i})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return hd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Pm(),endMs:null}}endTimer(t){return hd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Pm(),t)}async getQueryTime(t){if(hd().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const e=t;return e.endMs-e.startMs}disposeData(t,e=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(e?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!e&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);const{complexTensorInfos:n}=this.texData.get(t);return null!=n&&(this.disposeData(n.real.dataId,e),this.disposeData(n.imag.dataId,e)),this.texData.delete(t),!0}releaseGPUData(t){const{texture:e,dtype:n,texShape:r,usage:s,isPacked:o,slice:i}=this.texData.get(t),a=i&&i.origDataId||t,u=this.dataRefCount.get(a);u>1?this.dataRefCount.set(a,u-1):(this.dataRefCount.delete(a),null!=e&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(e,r,s,o)));const c=this.texData.get(t);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,e=yS){return hd().getBool("WEBGL_CPU_FORWARD")&&t.every((t=>null==this.texData.get(t.dataId).texture&&Bp(t.shape)<e))}getGPGPUContext(){return this.gpgpu}where(t){Ud("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const e=t.dataSync();return dS(t.shape,e)}packedUnaryOp(t,e,n){const r=new hS(t.shape,e),s=this.compileAndRun(r,[t],n);return lb().makeTensorFromTensorInfo(s)}abs(t){if(this.shouldExecuteOnCPU([t])&&"complex64"!==t.dtype){const e=zE(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,e)}if(hd().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,"return abs(x);",t.dtype);const e=new lS(t.shape,"return abs(x);"),n=this.compileAndRun(e,[t]);return lb().makeTensorFromTensorInfo(n)}makeTensorInfo(t,e,n){let r;if("string"===e&&null!=n&&n.length>0&&Yp(n[0])){const s=n.map((t=>Bm(t)));r=this.write(s,t,e)}else r=this.write(n,t,e);return this.texData.get(r).usage=null,{dataId:r,shape:t,dtype:e}}makeOutput(t,e,n){return lb().makeTensorFromTensorInfo(this.makeTensorInfo(t,e,n),this)}unpackTensor(t){const e=new pS(t.shape);return this.runWebGLProgram(e,[t],t.dtype)}packTensor(t){const e=new sS(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)}packedReshape(t,e){const n=[BN(t.shape),...VN(t.shape)],r={dtype:t.dtype,shape:n,dataId:t.dataId},s=[BN(e),...VN(e)],o=new oS(s,n),i=[n],a=this.runWebGLProgram(o,[r],t.dtype,i,!0);return{dataId:a.dataId,shape:e,dtype:a.dtype}}decode(t,e){const n=this.texData.get(t),{isPacked:r,shape:s,dtype:o}=n;if(null!=e){Dp(Bp(s)<=e[0]*e[1]*4,(()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."))}const i=zN(s);let a;a=r?new E$(i):new $$(i);const u=[null!=e?e:EN(i)];return{dtype:o,shape:s,dataId:this.runWebGLProgram(a,[{shape:i,dtype:o,dataId:t}],o,u,!0,e).dataId}}runWebGLProgram(t,e,n,r,s=!1,o){const i=this.makeTensorInfo(t.outputShape,n),a=this.texData.get(i.dataId);if(t.packedOutput&&(a.isPacked=!0),t.outPackingScheme===vN.DENSE){const e=null!=o?o:EN(t.outputShape);a.texShape=e.map((t=>2*t))}if(null!=t.outTexUsage&&(a.usage=t.outTexUsage),0===Bp(i.shape))return a.values=Hp(i.dtype,0),i;const u=[],c=e.map((e=>{if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(e.dataId);if(null==n.texture){if(!t.packedInputs&&Bp(e.shape)<=hd().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:n.values};t.packedInputs&&(n.isPacked=!0,n.shape=e.shape)}if(this.uploadToGPU(e.dataId),!!n.isPacked!=!!t.packedInputs)e=n.isPacked?this.unpackTensor(e):this.packTensor(e),u.push(e),n=this.texData.get(e.dataId);else if(n.isPacked&&!UN(n.shape,e.shape)){const t=e,r=e.shape;e.shape=n.shape,e=this.packedReshape(e,r),u.push(e),n=this.texData.get(e.dataId),t.shape=r}return{shape:e.shape,texData:n,isUniform:!1}}));this.uploadToGPU(i.dataId);const l={shape:i.shape,texData:a,isUniform:!1},f=function(t,e,n){let r="";e.concat(n).forEach((e=>{const s=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!e.isUniform){const o=e.texData.texShape,{useSqueezeShape:i,uniformShape:a,keptDims:u}=y$(t.packedInputs,e.shape,o);let c="",l="",f="";if(1===a.length&&t.packedInputs){const t=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];c=`${t[0]>1}_${t[1]>1}`}else if(2!==a.length||t.packedInputs){if(a.length>2&&!t.packedInputs){const t=ed(a);f=`${t[0]===o[1]}_${t[t.length-1]===o[1]}`}}else l=`${a[0]>1}_${a[1]>1}`;const h=e.shape.length,p=2===a.length&&Vp(e.shape,o),d=1===Bp(e.shape),m=gb(e.shape,n.shape),y=!t.packedInputs&&h===n.shape.length&&Vp(o,n.texData.texShape),g=t.packedInputs||a.length>2?"":`${o[0]>1}_${o[1]>1}`;r+=`${h}_${y}_${i?u:""}_${a.length}_${d}_${m}_${p}_${c}_${l}_${f}_${g}_${s}`}else{const t=e.isUniform?"uniform":e.texData.texShape;r+=`${e.shape}_${t}_${s}`}}));const s=t.userCode;let o=t.constructor.name;return o+="_"+r+"_"+s+`${hd().getNumber("WEBGL_VERSION")}`,o}(t,c,l),h=this.getAndSaveBinary(f,(()=>w$(this.gpgpu,t,c,l))),p=null!=this.activeTimers;let d;p&&(d=this.startTimer()),hd().get("ENGINE_COMPILE_ONLY")||function(t,e,n,r,s){e.program.enableShapeUniforms||(x$(e.inShapeInfos,n),x$([e.outShapeInfo],[r]));const o=r.texData.texture,i=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(o.texture,i[0],i[1]):t.setOutputMatrixTexture(o.texture,i[0],i[1]),t.setProgram(e.webGLProgram),1===hd().getNumber("WEBGL_VERSION")&&null!==e.infLoc&&t.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&t.gl.uniform1f(e.nanLoc,NaN),n.forEach(((n,r)=>{const s=e.program.variableNames[r],o=e.uniformLocations[s],i=e.uniformLocations[`offset${s}`],a=e.inShapesLocations[`${s}Shape`],u=e.inTexShapesLocations[`${s}TexShape`];if(a){const{uniformShape:r}=y$(e.program.packedInputs,n.shape,n.texData.texShape);switch(r.length){case 1:t.gl.uniform1iv(a,new Int32Array(r));break;case 2:t.gl.uniform2iv(a,new Int32Array(r));break;case 3:t.gl.uniform3iv(a,new Int32Array(r));break;case 4:t.gl.uniform4iv(a,new Int32Array(r))}}if(u&&t.gl.uniform2i(u,n.texData.texShape[0],n.texData.texShape[1]),null!=o)if(n.isUniform)if(Bp(n.shape)<2)t.gl.uniform1f(o,n.uniformValues[0]);else{let e=n.uniformValues;e instanceof Float32Array||(e=new Float32Array(e)),t.gl.uniform1fv(o,e)}else null!=n.texData.slice&&null!=i&&t.gl.uniform1i(i,n.texData.slice.flatOffset),t.setInputMatrixTexture(n.texData.texture.texture,o,r)}));const a=e.outShapeLocation;if(a)switch(r.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(r.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(r.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(r.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(r.shape))}if(e.outShapeStridesLocation){const n=ed(r.shape);switch(r.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(n));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(n));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(n))}}e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&s&&e.program.customUniforms.forEach(((n,r)=>{const o=e.customUniformLocations[r],i=s[r];if("float"===n.type)t.gl.uniform1fv(o,i);else if("vec2"===n.type)t.gl.uniform2fv(o,i);else if("vec3"===n.type)t.gl.uniform3fv(o,i);else if("vec4"===n.type)t.gl.uniform4fv(o,i);else if("int"===n.type)t.gl.uniform1iv(o,i);else if("ivec2"===n.type)t.gl.uniform2iv(o,i);else if("ivec3"===n.type)t.gl.uniform3iv(o,i);else{if("ivec4"!==n.type)throw Error(`uniform type ${n.type} is not supported yet.`);t.gl.uniform4iv(o,i)}})),t.executeProgram()}(this.gpgpu,h,c,l,r),u.forEach((t=>this.disposeIntermediateTensorInfo(t))),p&&(d=this.endTimer(d),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(d)}));const m=hd().get("WEBGL_FLUSH_THRESHOLD");if(m>0){const t=Pm();t-this.lastGlFlushTime>m&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=t)}if(!hd().getBool("WEBGL_LAZILY_UNPACK")&&a.isPacked&&!1===s){const t=this.unpackTensor(i);return this.disposeIntermediateTensorInfo(i),t}return i}compileAndRun(t,e,n,r,s=!1){n=n||e[0].dtype;return this.runWebGLProgram(t,e,n,r,s)}getAndSaveBinary(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){if(!this.disposed){if(!hd().getBool("IS_TEST")){Object.keys(this.binaryCache).forEach((t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}))}this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=fb((()=>{if(!hd().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=hd().getBool("DEBUG");hd().set("DEBUG",!1);const e=this.abs(Lw(1e-8)).dataSync()[0];if(hd().set("DEBUG",t),e>0)return 32}return 16}))),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(t){const e=this.texData.get(t),{shape:n,dtype:r,values:s,texture:o,usage:i,isPacked:a}=e;if(null!=o)return;const u=null!=this.activeTimers;let c;u&&(c=Pm());let l=e.texShape;if(null==l&&(l=function(t,e=!1){let n=hd().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(n*=2,t=t.map(((e,n)=>n>=t.length-2?Mp(t[n]):t[n])),1===t.length&&(t=[2,t[0]])),2!==t.length){const e=qp(t);t=e.newShape}let r=Bp(t);if(t.length<=1&&r<=n)return[1,r];if(2===t.length&&t[0]<=n&&t[1]<=n)return t;if(3===t.length&&t[0]*t[1]<=n&&t[2]<=n)return[t[0]*t[1],t[2]];if(3===t.length&&t[0]<=n&&t[1]*t[2]<=n)return[t[0],t[1]*t[2]];if(4===t.length&&t[0]*t[1]*t[2]<=n&&t[3]<=n)return[t[0]*t[1]*t[2],t[3]];if(4===t.length&&t[0]<=n&&t[1]*t[2]*t[3]<=n)return[t[0],t[1]*t[2]*t[3]];if(e){const e=BN(t);let n=2,s=2;return t.length&&([n,s]=VN(t)),r=e*(n/2)*(s/2),Wp(r).map((t=>2*t))}return Wp(r)}(n,a),e.texShape=l),null!=s){const t=zN(n);let o,i=l[1],f=l[0];const h=s instanceof Uint8Array||s instanceof Uint8ClampedArray;!a&&h||([i,f]=SN(l[0],l[1])),o=a?new k$(t,h):new T$(t,h);const p=h?[f,i]:l,d=this.makeTensorInfo(p,r),m=this.texData.get(d.dataId);m.usage=h?xN.PIXELS:xN.UPLOAD,m.texShape=p,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(d.dataId),i,f,s);const y=[[f,i]],g=!0,b=this.runWebGLProgram(o,[d],r,y,g),w=this.texData.get(b.dataId);e.texShape=w.texShape,e.isPacked=w.isPacked,e.usage=w.usage,hd().get("ENGINE_COMPILE_ONLY")?this.disposeData(b.dataId):(e.texture=w.texture,e.values=null,this.texData.delete(b.dataId)),this.disposeIntermediateTensorInfo(d),u&&(this.uploadWaitMs+=Pm()-c)}else{const t=this.acquireTexture(l,i,r,a);e.texture=t}}convertAndCacheOnCPU(t,e){const n=this.texData.get(t),{dtype:r}=n;return this.releaseGPUData(t),null!=e&&(n.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){const n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length);for(let e=0;e<n.length;++e)n[e]=Math.round(t[e]);return n}throw new Error(`Unknown dtype ${e}`)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(e,r)),n.values}acquireTexture(t,e,n,r){if(this.numBytesInGPU+=this.computeBytes(t,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const t=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${t} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,e,r)}computeBytes(t,e){return t[0]*t[1]*Jp(e)}checkCompileCompletion(){for(const[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){const t=[];if(this.gpgpu.parallelCompilationExtension){for(const[,e]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(e));return Promise.all(t)}for(const[,e]of Object.entries(this.binaryCache)){const n=new Promise((t=>{try{this.checkCompletion_(e),t(!0)}catch(t){throw t}}));t.push(n)}return Promise.all(t)}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await new Promise((t=>Mx((()=>t())))),this.checkCompletionAsync_(t))}checkCompletion_(t){if(!1===this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw ON(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}getUniformLocations(){for(const[,t]of Object.entries(this.binaryCache)){const{uniformLocations:e,customUniformLocations:n,infLoc:r,nanLoc:s,inShapesLocations:o,inTexShapesLocations:i,outShapeLocation:a,outShapeStridesLocation:u,outTexShapeLocation:c}=v$(this.gpgpu,t.program,t.webGLProgram);t.uniformLocations=e,t.customUniformLocations=n,t.infLoc=r,t.nanLoc=s,t.inShapesLocations=o,t.inTexShapesLocations=i,t.outShapeLocation=a,t.outShapeStridesLocation=u,t.outTexShapeLocation=c}}}gS.nextDataId=0,by()&&function(t,e,n=1){my.registerBackend(t,e,n)}("webgl",(()=>new gS),2)
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */;class bS{constructor(t,e,n){this.variableNames=["A","B"],this.outputShape=wb(e,n),this.enableShapeUniforms=N$(this.outputShape.length),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${t}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wS{constructor(t,e,n,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=wb(e,n);const s=this.outputShape.length;this.enableShapeUniforms=N$(s);let o="";if(r)if(0===s||1===Bp(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{if(o=`\n          ${m$(s)} coords = getOutputCoords();\n        `,1===s)this.enableShapeUniforms?o+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":o+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{const t=rS("coords",s);this.enableShapeUniforms?o+=`\n            bool nextRowOutOfBounds =\n              (${t[s-2]} + 1) >= outShape[${s} - 2];\n            bool nextColOutOfBounds =\n              (${t[s-1]} + 1) >= outShape[${s} - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `:o+=`\n            bool nextRowOutOfBounds =\n              (${t[s-2]} + 1) >= ${this.outputShape[s-2]};\n            bool nextColOutOfBounds =\n              (${t[s-1]} + 1) >= ${this.outputShape[s-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${t}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${o}\n\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vS(t){const{inputs:e,backend:n}=t,{x:r}=e;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const xS={kernelName:"Identity",backendName:"webgl",kernelFunc:vS};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NS(t){const{inputs:e,backend:n}=t,{real:r,imag:s}=e,o=n.makeTensorInfo(r.shape,"complex64"),i=n.texData.get(o.dataId),a=vS({inputs:{x:r},backend:n}),u=vS({inputs:{x:s},backend:n});return i.complexTensorInfos={real:a,imag:u},o}const $S={kernelName:"Complex",backendName:"webgl",kernelFunc:NS},ES="return (a < 0.) ? b * a : a;",SS="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _S={kernelName:"LeakyRelu",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{alpha:o}=r,i=n.makeTensorInfo([],"float32",Fm(o,"float32")),a=hd().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wS(SS,s.shape,i.shape):new bS(ES,s.shape,i.shape),u=n.runWebGLProgram(a,[s,i],"float32");return n.disposeIntermediateTensorInfo(i),u}},TS="return (a < 0.) ? b * a : a;",kS="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AS={kernelName:"Prelu",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r,alpha:s}=e,o=hd().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wS(kS,r.shape,s.shape):new bS(TS,r.shape,s.shape);return n.runWebGLProgram(o,[r,s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CS({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:r}){return({inputs:s,backend:o})=>{const{x:i}=s,a=o,u=r||i.dtype;if(a.shouldExecuteOnCPU([i])&&null!=n){const t=a.texData.get(i.dataId),e=n(t.values,u);return a.makeTensorInfo(i.shape,u,e)}let c;return c=hd().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=e?new hS(i.shape,e):new lS(i.shape,t),a.runWebGLProgram(c,[i],u)}}function OS({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:s,dtype:o}){return({inputs:i,backend:a})=>{const{a:u,b:c}=i,l=a;if(r&&"complex64"===u.dtype){const e=l.texData.get(u.dataId),n=l.texData.get(c.dataId),[r,s]=[[e.complexTensorInfos.real,n.complexTensorInfos.real],[e.complexTensorInfos.imag,n.complexTensorInfos.imag]].map((e=>{const[n,r]=e,s={dataId:n.dataId,dtype:n.dtype,shape:u.shape},o={dataId:r.dataId,dtype:r.dtype,shape:c.shape},i=new bS(t,u.shape,c.shape);return l.runWebGLProgram(i,[s,o],iy(n.dtype,r.dtype))})),o=NS({inputs:{real:r,imag:s},backend:l});return l.disposeIntermediateTensorInfo(r),l.disposeIntermediateTensorInfo(s),o}const f=o||iy(u.dtype,c.dtype);if(("string"===u.dtype||"string"===c.dtype||l.shouldExecuteOnCPU([u,c]))&&null!=s){const t=l.texData.get(u.dataId).values,e=l.texData.get(c.dataId).values,n="string"===u.dtype?dN(t):t,r="string"===u.dtype?dN(e):e,[o,i]=s(u.shape,c.shape,n,r,f),a=l.makeTensorInfo(i,f);return l.texData.get(a.dataId).values=o,a}let h;return h=hd().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=e?new wS(e,u.shape,c.shape,n):new bS(t,u.shape,c.shape),l.runWebGLProgram(h,[u,c],f)}}function IS(t,e=!1){if("linear"===t)return"return x;";if("relu"===t)return e?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n";if("elu"===t)return e?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===t)return e?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n";if("prelu"===t)return e?kS:TS;if("leakyrelu"===t)return e?SS:ES;if("sigmoid"===t)return"return 1.0 / (1.0 + exp(-1.0 * x));";throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MS{constructor(t,e,n,r=!1,s=!1,o=!1,i=null,a=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=N$(this.outputShape.length);const c=r?t[1]:t[2],l=Math.ceil(c/2),f=r?"i * 2, rc.y":"rc.y, i * 2",h=s?"rc.z, i * 2":"i * 2, rc.z",p=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=s?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let m="",y="";i&&(m=a?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${i}\n        }`:u?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${i}\n        }`:`vec4 activation(vec4 x) {\n          ${i}\n        }`,y="result = activation(result);");const g=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let b="rc.x",w="rc.x";t[0]<e[0]?b=`int(min(float(rc.x), ${t[0]-1}.))`:e[0]<t[0]&&(w=`int(min(float(rc.x), ${e[0]-1}.))`),this.userCode=`\n      ${m}\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ${l}.0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ${l}; i++) {\n          int batchA = ${b};\n          int batchB = ${w};\n          vec4 a = getMatrixA(batchA, ${f});\n          vec4 b = getMatrixB(batchB, ${h});\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (${p[0]} * ${d[0]});\n          result += (${p[1]} * ${d[1]});\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ${g}\n\n        ${y}\n\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RS="return areal * breal - aimag * bimag;",DS="return areal * bimag + aimag * breal;";class FS{constructor(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=wb(e,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${t}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LS="return a * b;";function PS(t){const{inputs:e,backend:n}=t,{a:r,b:s}=e,o=iy(r.dtype,s.dtype);if("complex64"===r.dtype){const t=n.texData.get(r.dataId),e=n.texData.get(s.dataId),o=new FS(RS,r.shape,s.shape),i=new FS(DS,r.shape,s.shape),a=[{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:r.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:s.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:s.shape}],u=n.runWebGLProgram(o,a,"float32"),c=n.runWebGLProgram(i,a,"float32"),l=NS({inputs:{real:u,imag:c},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),l}if(n.shouldExecuteOnCPU([r,s])){const t=n.texData.get(r.dataId),e=n.texData.get(s.dataId),[i,a]=ME(r.shape,s.shape,t.values,e.values,o),u=n.makeTensorInfo(a,o);return n.texData.get(u.dataId).values=i,u}let i;return i=hd().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wS(LS,r.shape,s.shape):new bS(LS,r.shape,s.shape),n.runWebGLProgram(i,[r,s],o)}const BS={kernelName:"Multiply",backendName:"webgl",kernelFunc:PS};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function VS(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{shape:o}=r,i=n,a=Bp(s.shape),u=function(t,e){let n=1,r=-1;for(let e=0;e<t.length;++e)if(t[e]>=0)n*=t[e];else if(-1===t[e]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${e}`);r=e}else if(t[e]<0)throw Error(`Shapes can not be < 0. Found ${t[e]} at dim ${e}`);if(-1===r){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(0===n)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const s=t.slice();return s[r]=e/n,s}(o,a),c=Bp(u);Dp(a===c,(()=>`The new shape (${u}) has ${c} elements and the old shape (${s.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`));const l=i.texData.get(s.dataId);return!l.isPacked||UN(s.shape,u)||null!==l.texture&&UN(l.shape,u)?(i.incRef(s.dataId),{dataId:s.dataId,shape:u,dtype:s.dtype}):function(t,e,n){const r=[BN(t.shape),...VN(t.shape)],s={dtype:t.dtype,shape:r,dataId:t.dataId},o=[BN(e),...VN(e)],i=new oS(o,r),a=[r],u=n.runWebGLProgram(i,[s],t.dtype,a,!0);return{dataId:u.dataId,shape:e,dtype:u.dtype}}(s,u,i)}const zS={kernelName:"Reshape",backendName:"webgl",kernelFunc:VS};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WS{constructor(t,e){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:s,outSize:o}=t;this.outputShape=[r,o];const i=4*Math.floor(n/4),a=n%4;let u="sumValue += dot(values, ones);";if(null!=e){const t=1/e;u=`sumValue += dot(values * ${zp(t)?t.toPrecision(2):t}, ones);`}let c="";s%n>0&&(c=`\n        if (inIdx < 0 || inIdx >= ${s}) {\n          return 0.0;\n        }\n      `),this.userCode=`\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${c}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${i}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${u}\n        }\n\n        int inIdx = inOffset + ${i};\n        if (${1===a}) {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ${u}\n        } else if (${2===a}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ${u}\n        } else if (${3===a}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ${u}\n        }\n        setOutput(sumValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class US{constructor(t,e){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:s,outSize:o}=t;this.outputShape=[r,o];let i="0.0",a="";"prod"===e?i="1.0":"min"===e?(i="1.0 / 1e-20",a="min"):"max"===e&&(i="-1.0 / 1e-20",a="max");let u=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"sum"===e?u="sumValue":"prod"===e?u="prodValue":"all"===e?u="allValue":"any"===e&&(u="anyValue");const c=4*Math.floor(n/4),l=n%4;let f=`\n      if (${"sum"===e}) {\n        sumValue += dot(values, ones);\n      } else if (${"prod"===e}) {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ${a}(values, minMaxValue);\n        if (${"min"===e} || ${"max"===e}) {\n          minMaxValue = ${a}(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    `,h="vec4";"all"===e?(i="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===e&&(i="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");let p="";s%n>0&&(p=`\n        if (inIdx < 0 || inIdx >= ${s}) {\n          return initializationValue;\n        }\n      `),this.userCode=`\n      const float initializationValue = ${i};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${p}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        vec4 minMaxValue = vec4(${i});\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ${c}; i += 4) {\n          int inIdx = inOffset + i;\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${f}\n        }\n\n        int inIdx = inOffset + ${c};\n        if (${1===l}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ${f}\n        } else if (${2===l}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ${f}\n        } else if (${3===l}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ${f}\n        }\n        setOutput(${u});\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jS(t,e,n,r){const s=function(t){const e=[];for(;0===e.length||1!==e[e.length-1].outSize;){const n=e.length?e[e.length-1].outSize:t[1],r=Fx(n);e.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return e}(t.shape);let o=t;for(let i=0;i<s.length;i++){const{inSize:a,windowSize:u,outSize:c}=s[i];let l,f;l="mean"===n?0===i?new WS({windowSize:u,inSize:a,batchSize:t.shape[0],outSize:c},a):new WS({windowSize:u,inSize:a,batchSize:t.shape[0],outSize:c}):new US({windowSize:u,inSize:a,batchSize:t.shape[0],outSize:c},n),f=o,o=r.runWebGLProgram(l,[o],e),f.dataId!==t.dataId&&r.disposeIntermediateTensorInfo(f)}return o}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GS{constructor(t,e){this.variableNames=["A"];const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;const r=m$(this.rank),s=function(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e);for(let e=0;e<t.length;e++)r[t[e]]=n[e];return r.join()}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(e);this.userCode=`\n    void main() {\n      ${r} resRC = getOutputCoords();\n      setOutput(getA(${s}));\n    }\n    `}}class qS{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=t[e[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=m$(this.rank),s=nS("rc",this.rank),o=new Array(this.rank);for(let t=0;t<e.length;t++)o[e[t]]=s[t];const i=`vec2(${o.slice(-2).join()})`,a=`++${s[this.rank-1]} < ${n[this.rank-1]}`,u=`getChannel(getA(${o.join()}), ${i})`;this.userCode=`\n    void main() {\n      ${r} rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ${u};\n      if(${a}) {\n        result[1] = ${u};\n      }\n      --${s[this.rank-1]};\n      if(++${s[this.rank-2]} < ${n[this.rank-2]}) {\n        result[2] = ${u};\n        if(${a}) {\n          result[3] = ${u};\n        }\n      }\n      setOutput(result);\n    }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HS(t,e,n){const r=hd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new qS(t.shape,e):new GS(t.shape,e);return n.runWebGLProgram(r,[t],t.dtype)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function KS(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:o,keepDims:i}=r;return function(t,e,n,r){const s=e,o=t.shape.length,i=Gp(s,t.shape);let a=i;const u=Ow(a,o),c=null!=u;let l=t;c&&(l=HS(t,u,r),a=Mw(a.length,o)),Cw("sum",a,o);const[f,h]=kw(l.shape,a);let p=f;n&&(p=Aw(f,i));const d=Bp(h),m=VS({inputs:{x:l},attrs:{shape:[Bp(t.shape)/d,d]},backend:r}),y=jS(m,ay(t.dtype),"sum",r),g=VS({inputs:{x:y},attrs:{shape:p},backend:r});return r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(y),c&&r.disposeIntermediateTensorInfo(l),g}(s,o,i,n)}const XS={kernelName:"Sum",backendName:"webgl",kernelFunc:KS};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JS(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{perm:o}=r,i=n,a=s.shape.length,u=new Array(a);for(let t=0;t<u.length;t++)u[t]=s.shape[o[t]];let c;if(i.shouldExecuteOnCPU([s])){const t=i.texData.get(s.dataId).values,e=tS(t,s.shape,s.dtype,o,u);c=i.makeTensorInfo(u,s.dtype);i.texData.get(c.dataId).values=e}else c=HS(s,o,i);return c}const YS={kernelName:"Transpose",backendName:"webgl",kernelFunc:JS};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZS({a:t,b:e,transposeA:n,transposeB:r,backend:s,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:u=null}){const c=t.shape.length,l=e.shape.length,f=n?t.shape[c-2]:t.shape[c-1],h=r?e.shape[l-1]:e.shape[l-2],p=n?t.shape[c-1]:t.shape[c-2],d=r?e.shape[l-2]:e.shape[l-1],m=t.shape.slice(0,-2),y=e.shape.slice(0,-2),g=Bp(m),b=Bp(y),w=wb(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([p,d]);Dp(f===h,(()=>`Error in matMul: inner shapes (${f}) and (${h}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${r} must match.`));const v=n?[g,f,p]:[g,p,f],x=r?[b,d,h]:[b,h,d],N=VS({inputs:{x:t},backend:s,attrs:{shape:v}}),$=VS({inputs:{x:e},backend:s,attrs:{shape:x}}),E=[N,$],S=Math.max(g,b),_=n?N.shape[1]:N.shape[2],T=null!=o,k=null!=i,A="leakyrelu"===u,C=null!=u?IS(u,!0):null;let O;if((1===p||1===d)&&_>1e3&&!1===(T||k||A||null!=C)){let t=N,e=$;n&&(t=JS({inputs:{x:N},backend:s,attrs:{perm:[0,2,1]}}),E.push(t)),r&&(e=JS({inputs:{x:$},backend:s,attrs:{perm:[0,2,1]}}),E.push(e));const o=1===d;let i=t;1!==d&&(i=VS({inputs:{x:t},backend:s,attrs:{shape:[S,_,1]}}),E.push(i));const a=1===d?2:1;let u=e;o&&(u=VS({inputs:{x:e},backend:s,attrs:{shape:[S,1,_]}}),E.push(u));const c=PS({inputs:{a:i,b:u},backend:s});O=KS({inputs:{x:c},backend:s,attrs:{axis:a,keepDims:!0}}),E.push(c)}else{const u=iy(t.dtype,e.dtype),c=new MS(v,x,[S,p,d],n,r,T,C,k,A),l=[N,$];if(null!=o&&l.push(o),k&&l.push(i),A){const t=s.makeTensorInfo([],"float32",Fm(a,"float32"));l.push(t),E.push(t)}O=s.runWebGLProgram(c,l,u)}const I=VS({inputs:{x:O},backend:s,attrs:{shape:w}});E.push(O);for(const t of E)s.disposeIntermediateTensorInfo(t);return I}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QS={kernelName:"_FusedMatMul",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{a:s,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:u,transposeB:c,activation:l,leakyreluAlpha:f}=r;return ZS({a:s,b:o,transposeA:u,transposeB:c,backend:n,bias:i,preluActivationWeights:a,leakyreluAlpha:f,activation:l})}},t_="return abs(x);";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e_={kernelName:"Abs",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e;if(n.shouldExecuteOnCPU([r])&&"complex64"!==r.dtype){const t=n.texData.get(r.dataId),e=zE(t.values);return n.makeTensorInfo(r.shape,r.dtype,e)}let s;return s=hd().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new hS(r.shape,t_):new lS(r.shape,t_),n.runWebGLProgram(s,[r],r.dtype)}},n_={kernelName:"Acos",backendName:"webgl",kernelFunc:CS({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"})},r_={kernelName:"Acosh",backendName:"webgl",kernelFunc:CS({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"})},s_="return a + b;",o_={kernelName:"Add",backendName:"webgl",kernelFunc:OS({opSnippet:s_,packedOpSnippet:s_,supportsComplex:!0,cpuKernelImpl:pE})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class i_{constructor(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map(((t,e)=>`T${e}`));const n=[];this.variableNames.forEach((t=>{n.push(`float v${t} = get${t}AtOutCoords();`)}));const r=this.variableNames.map((t=>`v${t}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        float result = ${r};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a_{constructor(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map(((t,e)=>`T${e}`));const n=[];this.variableNames.forEach((t=>{n.push(`vec4 v${t} = get${t}AtOutCoords();`)}));const r=this.variableNames.map((t=>`v${t}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        vec4 result = ${r};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u_={kernelName:"AddN",backendName:"webgl",kernelFunc:function t(e){const{inputs:n,backend:r}=e,s=n;if(1===s.length)return vS({inputs:{x:s[0]},backend:r});if(s.length>hd().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const e=Math.floor(s.length/2),n=t({inputs:s.slice(0,e),backend:r}),o=t({inputs:s.slice(e),backend:r});return t({inputs:[n,o],backend:r})}const o=s.map((t=>t.dtype)).reduce(((t,e)=>iy(t,e))),i=s.map((t=>t.shape)),a=hd().getBool("WEBGL_PACK")?new a_(s[0].shape,i):new i_(s[0].shape,i);return r.runWebGLProgram(a,s,o)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c_={kernelName:"All",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:o,keepDims:i}=r,a=s.shape.length,u=Gp(o,s.shape);let c=u;const l=Ow(c,a);let f=s;null!=l&&(f=JS({inputs:{x:s},backend:n,attrs:{perm:l}}),c=Mw(c.length,a)),Cw("all",c,a);const[h,p]=kw(f.shape,c),d=VS({inputs:{x:f},backend:n,attrs:{shape:[-1,Bp(p)]}}),m=jS(d,d.dtype,"all",n);let y;if(i){y=VS({inputs:{x:m},backend:n,attrs:{shape:Aw(h,u)}})}else y=VS({inputs:{x:m},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),null!=l&&n.disposeIntermediateTensorInfo(f),y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l_={kernelName:"Any",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:o,keepDims:i}=r,a=s.shape.length,u=Gp(o,s.shape);let c=u;const l=Ow(c,a);let f=s;null!=l&&(f=JS({inputs:{x:s},backend:n,attrs:{perm:l}}),c=Mw(c.length,a)),Cw("any",c,a);const[h,p]=kw(f.shape,c),d=VS({inputs:{x:f},backend:n,attrs:{shape:[-1,Bp(p)]}}),m=jS(d,d.dtype,"any",n);let y;if(i){y=VS({inputs:{x:m},backend:n,attrs:{shape:Aw(h,u)}})}else y=VS({inputs:{x:m},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),null!=l&&n.disposeIntermediateTensorInfo(f),y}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f_{constructor(t,e,n){this.variableNames=["A"];const{windowSize:r,batchSize:s,outSize:o}=t;n||this.variableNames.push("bestIndicesA"),this.outputShape=[s,o];const i="max"===e?">":"<",a=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${r};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${r}; i++) {\n          int inIdx = ${a};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${i} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h_{constructor(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Dp(t.length>2,(()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`));const s=t[t.length-1],o=Math.ceil(s/e);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const i=this.outputShape,a=i.length,u=m$(a),c=rS("coords",a);let l,f;if(1===o){f=a+1;const t=m$(f);l=`\n        ${t} sourceLocR = ${t}(${c.join()}, 0);\n        ++${c[a-1]};\n        ${t} sourceLocG = ${t}(${c.join()}, 0);\n        ++${c[a-2]};\n        ${t} sourceLocA = ${t}(${c.join()}, 0);\n        --${c[a-1]};\n        ${t} sourceLocB = ${t}(${c.join()}, 0);\n        --${c[a-2]};`}else f=a,l=`\n        ${u} sourceLocR = coords;\n        ++${c[a-1]};\n        ${u} sourceLocG = coords;\n        ++${c[a-2]};\n        ${u} sourceLocA = coords;\n        --${c[a-1]};\n        ${u} sourceLocB = coords;\n        --${c[a-2]};`;const h=["x","y","z","w","u","v"].slice(0,f),p="."+h[f-1],d=h.map((t=>"int "+t)),m=rS("sourceLocR",f-1).concat("inIdx.r"),y=rS("sourceLocG",f-1).concat("inIdx.g"),g=rS("sourceLocB",f-1).concat("inIdx.b"),b=rS("sourceLocA",f-1).concat("inIdx.a"),w="max"===n?"greaterThan":"lessThan",v=r?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${m.join()}),\n                             getBestIndicesAChannel(${y.join()}),\n                             getBestIndicesAChannel(${g.join()}),\n                             getBestIndicesAChannel(${b.join()})));`,x=`vec4(\n            getAChannel(${m.join()}),\n            hasNextCol ? getAChannel(${y.join()}) : 0.,\n            hasNextRow ? getAChannel(${g.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,N=r?"":`\n      float getBestIndicesAChannel(${d.join()}) {\n        return getChannel(getBestIndicesA(${h.join()}),\n                                          vec2(${h.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${d.join()}) {\n        return getChannel(getA(${h.join()}),\n                               vec2(${h.slice(-2).join()}));\n      }\n      ${N}\n      void main() {\n        ${u} coords = getOutputCoords();\n        bool hasNextCol = ${c[a-1]} < ${i[a-1]-1};\n        bool hasNextRow = ${c[a-2]} < ${i[a-2]-1};\n        ${l}\n        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},\n          sourceLocB${p}, sourceLocA${p}) * ${e};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${x};\n\n        for (int i = 0; i < ${e}; i++) {\n          inIdx = srcIdx;\n          ${v}\n          vec4 candidate = ${x};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${w}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p_(t,e,n,r=null){let s=e.shape[0],o=e.shape[1];null!=r&&(s=r.shape[0],o=r.shape[1]);const i=Fx(o),a={windowSize:i,inSize:o,batchSize:s,outSize:Math.ceil(o/i)},u=new f_(a,n,null==r),c=[e];null!=r&&c.push(r);const l=t.runWebGLProgram(u,c,"int32");if(1===l.shape[1])return l;const f=p_(t,e,n,l);return t.disposeIntermediateTensorInfo(l),f}function d_(t,e,n,r=null){const s=null!=r?r.shape:e.shape,o=Fx(s[s.length-1]),i=new h_(s,o,n,null==r),a=null==r?[e]:[e,r],u=t.runWebGLProgram(i,a,"int32");if(u.shape.length===e.shape.length){const r=d_(t,e,n,u);return t.disposeIntermediateTensorInfo(u),r}return u}function m_(t,e,n,r){const s=[n];if(Cw("arg"+r.charAt(0).toUpperCase()+r.slice(1),s,e.shape.length),!hd().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const n=[],o=t.texData.get(e.dataId);let i=e;null!==o&&o.isPacked&&(i=t.unpackTensor(e),n.push(i));const[a,u]=kw(i.shape,s),c=Bp(u),l=VS({inputs:{x:i},backend:t,attrs:{shape:[-1,c]}});n.push(l);const f=p_(t,l,r);n.push(f);const h=VS({inputs:{x:f},backend:t,attrs:{shape:a}});return n.forEach((e=>t.disposeIntermediateTensorInfo(e))),h}return d_(t,e,r)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y_={kernelName:"ArgMax",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:o}=r;let i=Gp(o,s.shape);const a=Ow(i,s.shape.length);let u=s;const c=[];null!=a&&(u=JS({inputs:{x:s},backend:n,attrs:{perm:a}}),c.push(u),i=Mw(i.length,u.shape.length)),Cw("argMax",[i[0]],u.shape.length);const l=m_(n,u,i[0],"max");return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),l}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g_={kernelName:"ArgMin",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:o}=r;let i=Gp(o,s.shape);const a=Ow(i,s.shape.length);let u=s;const c=[];null!=a&&(u=JS({inputs:{x:s},backend:n,attrs:{perm:a}}),c.push(u),i=Mw(i.length,u.shape.length)),Cw("argMin",[i[0]],u.shape.length);const l=m_(n,u,i[0],"min");return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),l}},b_={kernelName:"Asin",backendName:"webgl",kernelFunc:CS({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"})},w_={kernelName:"Asinh",backendName:"webgl",kernelFunc:CS({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"})},v_={kernelName:"Atan",backendName:"webgl",kernelFunc:CS({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"})},x_={kernelName:"Atan2",backendName:"webgl",kernelFunc:OS({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"})},N_={kernelName:"Atanh",backendName:"webgl",kernelFunc:CS({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class $_{constructor(t,e,n,r=!1,s=!1){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");const o=t.filterWidth,i=t.strideHeight,a=t.strideWidth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;const d="avg"===e,m=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,y=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`;let g="0.0";if(d||(g="-1.0 / 1e-20"),n){const e=">=";return void(this.userCode=`\n        const ivec2 strides = ivec2(${i}, ${a});\n        const ivec2 pads = ivec2(${h}, ${p});\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ${l};\n              wR += ${u}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${f};\n                wC += ${c}) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ${e} currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ${r?s?m:y:`wR * ${f} + wC`};\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let b=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===e&&(b="avgValue / count");const w=4*Math.floor(o/4),v=o%4,x=`\n      if (${d}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec2 strides = ivec2(${i}, ${a});\n      const ivec2 pads = ivec2(${h}, ${p});\n      const float initializationValue = ${g};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ${t.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${g});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ${l};\n            wR += ${u}) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ${t.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${w}; wC += 4) {\n            int xC = xCCorner + wC * ${c};\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${c}, d),\n              getValue(batch, xR, xC + 2 * ${c}, d),\n              getValue(batch, xR, xC + 3 * ${c}, d)\n            );\n\n            ${x}\n          }\n\n          int xC = xCCorner + ${w};\n          if (${1===v}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ${x}\n          } else if (${2===v}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${c}, d),\n              initializationValue,\n              initializationValue\n            );\n\n            ${x}\n          } else if (${3===v}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${c}, d),\n              getValue(batch, xR, xC + 2 * ${c}, d),\n              initializationValue\n            );\n\n            ${x}\n          }\n        }\n        setOutput(${b});\n      }\n    `}}class E_{constructor(t,e,n,r=!1,s=!1){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");const o=t.filterWidth,i=t.strideDepth,a=t.strideHeight,u=t.strideWidth,c=t.dilationDepth,l=t.dilationHeight,f=t.dilationWidth,h=t.effectiveFilterDepth,p=t.effectiveFilterHeight,d=t.effectiveFilterWidth,m=t.padInfo.front,y=t.padInfo.top,g=t.padInfo.left;this.outputShape=t.outShape;const b="avg"===e;let w="0.0";if(b||(w="-1.0 / 1e-20"),n){const e=">=";return void(this.userCode=`\n        const ivec3 strides =\n            ivec3(${i}, ${a}, ${u});\n        const ivec3 pads = ivec3(${m}, ${y}, ${g});\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ${h};\n              wD += ${c}) {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ${t.inDepth}) {\n              continue;\n            }\n\n            for (int wR = 0; wR < ${p};\n                wR += ${l}) {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ${t.inHeight}) {\n                continue;\n              }\n\n              for (int wC = 0; wC < ${d};\n                  wC += ${f}) {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ${t.inWidth}) {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ${e} currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ${r?s?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${p} * ${d} +\n                      wR * ${d} + wC`};\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let v=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===e&&(v="avgValue / count");const x=4*Math.floor(o/4),N=o%4,$=`\n      if (${b}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec3 strides =\n        ivec3(${i}, ${a}, ${u});\n      const ivec3 pads = ivec3(${m}, ${y}, ${g});\n      const float initializationValue = ${w};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ${t.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${w});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ${h};\n            wD += ${c}) {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ${t.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${p};\n            wR += ${l}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${x}; wC += 4) {\n              int xC = xCCorner + wC * ${f};\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${f}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${f}, ch),\n                getValue(batch, xD, xR, xC + 3 * ${f}, ch)\n              );\n\n              ${$}\n            }\n\n            int xC = xCCorner + ${x};\n            if (${1===N}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ${$}\n            } else if (${2===N}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${f}, ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ${$}\n            } else if (${3===N}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${f}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${f}, ch),\n                initializationValue\n              );\n\n              ${$}\n            }\n          }\n          setOutput(${v});\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S_={kernelName:"AvgPool",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e;JN(s,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:u}=r;Dp(ow(i,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '1'`));const c=Xb(s.shape,o,i,1,a,u);if(1===c.filterWidth&&1===c.filterHeight&&Vp(c.inShape,c.outShape))return vS({inputs:{x:s},backend:n});const l=new $_(c,"avg",!1);return n.runWebGLProgram(l,[s],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const __={kernelName:"AvgPool3D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:u,dataFormat:c}=r,l=Jb(s.shape,o,i,[1,1,1],a,u,c),f=new E_(l,"avg",!1);return n.runWebGLProgram(f,[s],"float32")}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class T_{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,s=t.strideWidth,o=t.dilationHeight,i=t.dilationWidth,a=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=a-1-t.padInfo.top,l=u-1-t.padInfo.left,f=1/(e*n);this.userCode=`\n      const ivec2 pads = ivec2(${c}, ${l});\n      const float avgMultiplier = float(${f});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${a};\n            wR += ${o}) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${u};\n            wC+= ${i}) {\n            float dyC = float(dyCCorner + wC) / ${s}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class k_{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,s=t.strideDepth,o=t.strideHeight,i=t.strideWidth,a=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,f=t.effectiveFilterHeight,h=t.effectiveFilterWidth,p=l-1-t.padInfo.front,d=f-1-t.padInfo.top,m=h-1-t.padInfo.left,y=1/(e*n*r);this.userCode=`\n      const ivec3 pads = ivec3(${p}, ${d}, ${m});\n      const float avgMultiplier = float(${y});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${l};\n            wD += ${a}) {\n          float dyD = float(dyDCorner + wD) / ${s}.0;\n\n          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${f};\n              wR += ${u}) {\n            float dyR = float(dyRCorner + wR) / ${o}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${h};\n                wC += ${c}) {\n              float dyC = float(dyCCorner + wC) / ${i}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A_={kernelName:"AvgPool3DGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,input:o}=e,i=o,{filterSize:a,strides:u,pad:c,dimRoundingMode:l}=r,f=Jb(i.shape,a,u,[1,1,1],c,l),h=new k_(f);return n.runWebGLProgram(h,[s],i.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C_={kernelName:"AvgPoolGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,input:o}=e,i=o;JN([s,o],"avgPoolGrad");const{filterSize:a,strides:u,pad:c}=r,l=Xb(i.shape,a,u,1,c),f=new T_(l);return n.runWebGLProgram(f,[s],i.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O_={kernelName:"BatchMatMul",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{a:s,b:o}=e,{transposeA:i,transposeB:a}=r;return ZS({a:s,b:o,transposeA:i,transposeB:a,backend:n})}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class I_{constructor(t,e,n,r,s,o){this.outputShape=[],this.variableNames=["x","mean","variance"],wb(t,e),wb(t,n);let i="0.0";null!=r&&(wb(t,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");let a="1.0";null!=s&&(wb(t,s),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ${i};\n        float scale = ${a};\n        float inv = scale * inversesqrt(variance + float(${o}));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M_{constructor(t,e,n,r,s,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],wb(t,e),wb(t,n);let i="vec4(0.0)";null!=r&&(wb(t,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");let a="vec4(1.0)";null!=s&&(wb(t,s),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        vec4 offset = ${i};\n        vec4 scale = ${a};\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(${o}));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R_={kernelName:"FusedBatchNorm",backendName:"webgl",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,mean:s,variance:o,offset:i,scale:a}=t;Dp(s.shape.length===o.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),Dp(null==i||s.shape.length===i.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),Dp(null==a||s.shape.length===a.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));let{varianceEpsilon:u}=n;null==u&&(u=.001);const c=[r,s,o];let l=null;null!=i&&(l=i.shape,c.push(i));let f=null;null!=a&&(f=a.shape,c.push(a));const h=hd().getBool("WEBGL_PACK_NORMALIZATION")?new M_(r.shape,s.shape,o.shape,l,f,u):new I_(r.shape,s.shape,o.shape,l,f,u);return e.runWebGLProgram(h,c,c[0].dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class D_{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const e=m$(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=function(t){if(1===t)return"sourceLoc";if(t<=6)return F_.slice(0,t).map((t=>"sourceLoc."+t)).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(this.rank);let r;const s=t.map(((t,e)=>`sourceLoc.${F_[e]} = start[${e}] + coords.${F_[e]};`));r=`\n        ${e} sourceLoc;\n        ${e} coords = getOutputCoords();\n        ${s.join("\n")}\n      `,this.userCode=`\n      void main() {\n        ${r}\n        setOutput(getSource(${n}));\n      }\n    `}}const F_=["x","y","z","w","u","v"];class L_{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const e=m$(this.rank),n=rS("coords",this.rank),r=rS("sourceLoc",this.rank),s=1===this.rank?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${s})`,i=`\n      result.x = ${o};\n      if (++${n[this.rank-1]} < ${t[this.rank-1]}) {\n        ++${r[this.rank-1]};\n        result.y = ${o};\n        --${r[this.rank-1]};\n      }\n    `,a=1===this.rank?"":`\n      --${n[this.rank-1]};\n      if (++${n[this.rank-2]} < ${t[this.rank-2]}) {\n        ++${r[this.rank-2]};\n        result.z = ${o};\n        if (++${n[this.rank-1]} < ${t[this.rank-1]}) {\n          ++${r[this.rank-1]};\n          result.w = ${o};\n        }\n      }\n    `,u=this.rank<=4?`sourceLoc = coords +\n            ${e}(${t.map(((t,e)=>`start[${e}]`)).join()});`:t.map(((t,e)=>`${r[e]} = ${n[e]} + start[${e}];`)).join("\n");this.userCode=`\n      void main() {\n        ${e} coords = getOutputCoords();\n        ${e} sourceLoc;\n        ${u}\n        vec4 result = vec4(0.);\n        ${i}\n        ${a}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P_(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{begin:o,size:i}=r,[a,u]=Lb(s,o,i);if(Sb(s,a,u),0===Bp(u))return n.makeTensorInfo(u,s.dtype,[]);if(n.shouldExecuteOnCPU([s])||"string"===s.dtype){const t=n.texData.get(s.dataId),e=WE(t.values,a,u,s.shape,s.dtype);return n.makeTensorInfo(u,s.dtype,e)}const{isPacked:c}=n.texData.get(s.dataId),l=Db(s.shape,a,u);if(c||!l){const t=hd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new L_(u):new D_(u),e=[a];return n.runWebGLProgram(t,[s],s.dtype,e)}return n.uploadToGPU(s.dataId),function(t,e,n,r){const s=r.texData.get(t.dataId),o=r.makeTensorInfo(n,t.dtype),i=r.texData.get(o.dataId);Object.assign(i,s),i.refCount=1,i.shape=n,i.dtype=t.dtype;let a=Fb(e,ed(t.shape));s.slice&&(a+=s.slice.flatOffset),i.slice={flatOffset:a,origDataId:s.slice&&s.slice.origDataId||t.dataId};const u=r.dataRefCount.get(i.slice.origDataId)||1;return r.dataRefCount.set(i.slice.origDataId,u+1),o}(s,a,u,n)}const B_={kernelName:"Slice",backendName:"webgl",kernelFunc:P_},V_={kernelName:"BatchToSpaceND",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{blockShape:o,crops:i}=r;Dp(s.shape.length<=4,(()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"));const a=o.reduce(((t,e)=>t*e)),u=Px(s.shape,o,a),c=Bx(u.length,o.length),l=Vx(s.shape,o,a),f=zx(i,o.length),h=Wx(l,i,o.length),p=[],d=VS({inputs:{x:s},backend:n,attrs:{shape:u}}),m=JS({inputs:{x:d},backend:n,attrs:{perm:c}}),y=VS({inputs:{x:m},backend:n,attrs:{shape:l}}),g=P_({inputs:{x:y},backend:n,attrs:{begin:f,size:h}});return p.push(d),p.push(m),p.push(y),p.forEach((t=>n.disposeIntermediateTensorInfo(t))),g}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z_={kernelName:"Bincount",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,weights:o}=e,{size:i}=r,a=n.readSync(s.dataId),u=n.readSync(o.dataId),c=dE(a,u,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,c)}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W_={kernelName:"BroadcastArgs",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{s0:r,s1:s}=e,o=n.readSync(r.dataId),i=n.readSync(s.dataId),a=wb(Array.from(o),Array.from(i));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}},U_=OS({opSnippet:"return float(a != b);",cpuKernelImpl:DE,dtype:"bool"}),j_={kernelName:"NotEqual",backendName:"webgl",kernelFunc:U_};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function G_(t){const{inputs:e,backend:n}=t,{input:r}=e;return vS({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}const q_={kernelName:"Real",backendName:"webgl",kernelFunc:G_};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H_={kernelName:"Cast",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function t(e){const{inputs:n,backend:r,attrs:s}=e,{x:o}=n,{dtype:i}=s;if("complex64"===i){if("complex64"===o.dtype)return vS({inputs:{x:o},backend:r});const e=fv(o.shape),n=t({inputs:{x:o},backend:r,attrs:{dtype:"float32"}}),s=NS({inputs:{real:n,imag:e},backend:r});return e.dispose(),r.disposeIntermediateTensorInfo(n),s}if("complex64"===o.dtype){const e=G_({inputs:{input:o},backend:r}),n=t({inputs:{x:e},backend:r,attrs:{dtype:i}});return r.disposeIntermediateTensorInfo(e),n}if(a=o.dtype,"complex64"===(u=i)||"float32"===u&&"complex64"!==a||"int32"===u&&"float32"!==a&&"complex64"!==a||"bool"===u&&"bool"===a){const t=vS({inputs:{x:o},backend:r});return{dataId:t.dataId,shape:t.shape,dtype:i}}var a,u;if("int32"===i)return function(t,e){const n=new lS(t.shape,"return float(int(x));"),r=e.runWebGLProgram(n,[t],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(o,r);if("bool"===i){const t=r.makeTensorInfo([],"bool",Hp("bool",1)),e=U_({inputs:{a:o,b:t},backend:r});return r.disposeIntermediateTensorInfo(t),e}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${i}`)}},K_="return ceil(x);",X_={kernelName:"Ceil",backendName:"webgl",kernelFunc:CS({opSnippet:K_,packedOpSnippet:K_,cpuKernelImpl:yE})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class J_{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Y_{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z_={kernelName:"ClipByValue",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{clipValueMin:o,clipValueMax:i}=r;let a;a=hd().getBool("WEBGL_PACK_CLIP")?new Y_(s.shape):new J_(s.shape);const u=[[o],[i]];return n.runWebGLProgram(a,[s],s.dtype,u)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Q_{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tT(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}const eT={kernelName:"ComplexAbs",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e,s=n.texData.get(r.dataId),o=new Q_(r.shape),i=[tT(r,s.complexTensorInfos.real),tT(r,s.complexTensorInfos.imag)];return n.runWebGLProgram(o,i,i[0].dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nT{constructor(t){this.outputShape=[],this.outputShape=Dx(t,1),this.variableNames=t.map(((t,e)=>`T${e}`));const e=new Array(t.length-1);e[0]=t[0][1];for(let n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];const n=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let t=1;t<e.length;t++){const r=e[t-1];n.push(`else if (yC < ${e[t]}) setOutput(getT${t}(yR, yC-${r}));`)}const r=e.length,s=e[e.length-1];n.push(`else setOutput(getT${r}(yR, yC-${s}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rT{constructor(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Dx(t,e);const n=this.outputShape,r=n.length,s=m$(r),o=rS("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(((t,e)=>`T${e}`));const a=new Array(t.length-1);a[0]=t[0][e];for(let n=1;n<a.length;n++)a[n]=a[n-1]+t[n][e];const u=i[e],c=i.slice(-2),l=i.join();let f=`if (${u} < ${a[0]}) {\n        return getChannel(\n            getT0(${l}), vec2(${c.join()}));\n        }`;for(let t=1;t<a.length;t++){const e=a[t-1];f+=`\n        if (${u} < ${a[t]}  && ${u} >= ${a[t-1]}) {\n          return getChannel(\n            getT${t}(${sT(i,u,e)}),\n            vec2(${sT(c,u,e)}));\n        }`}const h=a.length,p=a[a.length-1];f+=`\n        return getChannel(\n          getT${h}(${sT(i,u,p)}),\n          vec2(${sT(c,u,p)}));`,this.userCode=`\n      float getValue(${i.map((t=>"int "+t))}) {\n        ${f}\n      }\n\n      void main() {\n        ${s} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${o}), 0., 0., 0.);\n\n        ${o[r-1]} = ${o[r-1]} + 1;\n        if (${o[r-1]} < ${n[r-1]}) {\n          result.g = getValue(${o});\n        }\n\n        ${o[r-2]} = ${o[r-2]} + 1;\n        if (${o[r-2]} < ${n[r-2]}) {\n          result.a = getValue(${o});\n        }\n\n        ${o[r-1]} = ${o[r-1]} - 1;\n        if (${o[r-2]} < ${n[r-2]} &&\n            ${o[r-1]} < ${n[r-1]}) {\n          result.b = getValue(${o});\n        }\n        setOutput(result);\n      }\n    `}}function sT(t,e,n){const r=t.indexOf(e),s=t.map(((t,e)=>e===r?`${t} - ${n}`:t));return s.join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oT(t){const{inputs:e,backend:n}=t,{input:r}=e;return vS({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}const iT={kernelName:"Imag",backendName:"webgl",kernelFunc:oT};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aT(t,e,n){const r=t[0].dtype;if("complex64"===r){const r=t.map((t=>G_({inputs:{input:t},backend:n}))),s=t.map((t=>oT({inputs:{input:t},backend:n}))),o=aT(r,e,n),i=aT(s,e,n),a=NS({inputs:{real:o,imag:i},backend:n});return r.forEach((t=>n.disposeIntermediateTensorInfo(t))),s.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),a}let s=n.shouldExecuteOnCPU(t);if("string"===r&&(s=!0),s){const s=t.map((t=>{const r=Bp(t.shape.slice(e));return VS({inputs:{x:t},backend:n,attrs:{shape:[-1,r]}})})),o=s.map((t=>({vals:n.readSync(t.dataId),shape:t.shape}))),i=Dx(s.map((t=>t.shape)),1),a=1===s[0].shape[0],u=gE(o,i,r,a),c=Dx(t.map((t=>t.shape)),e),l=n.makeTensorInfo(c,r,u);return s.forEach((t=>n.disposeIntermediateTensorInfo(t))),l}if(t.length>hd().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const r=Math.floor(t.length/2),s=aT(t.slice(0,r),e,n),o=aT(t.slice(r),e,n),i=aT([s,o],e,n);return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),i}if(hd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].shape.length>1){const s=new rT(t.map((t=>t.shape)),e);return n.runWebGLProgram(s,t,r)}const{tensors2D:o,outShape:i}=function(t,e,n){const r=Dx(t.map((t=>t.shape)),e),s=t.map((t=>VS({inputs:{x:t},attrs:{shape:[-1,Bp(t.shape.slice(e))]},backend:n})));return{tensors2D:s,outShape:r}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e,n),a=new nT(o.map((t=>t.shape))),u=n.runWebGLProgram(a,o,r);o.forEach((t=>n.disposeIntermediateTensorInfo(t)));const c=VS({inputs:{x:u},attrs:{shape:i},backend:n});return n.disposeIntermediateTensorInfo(u),c}function uT(t){const{inputs:e,backend:n,attrs:r}=t,{axis:s}=r,o=Gp(s,e[0].shape)[0],i=Dx(e.map((t=>t.shape)),o);if(0===Bp(i))return n.makeTensorInfo(i,e[0].dtype,[]);const a=e.filter((t=>Bp(t.shape)>0));if(1===a.length)return vS({inputs:{x:a[0]},backend:n});const u=a.map((t=>t.shape));return Rx(u,o),aT(a,o,n)}const cT={kernelName:"Concat",backendName:"webgl",kernelFunc:uT};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lT{constructor(t,e=!1,n=null,r=!1,s=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const o=t.padInfo.top,i=t.padInfo.left,a=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,f=t.filterHeight,h=t.filterWidth,p=4*Math.floor(t.inChannels/4),d=t.inChannels%4,m="channelsLast"===t.dataFormat,y=m?1:2,g=m?2:3,b=m?3:1;let w="",v="";n&&(w=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:s?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,v="result = activation(result);");const x=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${w}\n\n      const ivec2 strides = ivec2(${a}, ${u});\n      const ivec2 pads = ivec2(${o}, ${i});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${b}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${y}], coords[${g}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${f}; wR++) {\n          int xR = xRCorner + wR * ${c};\n\n          if (xR < 0 || xR >= ${t.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${h}; wC++) {\n            int xC = xCCorner + wC * ${l};\n\n            if (xC < 0 || xC >= ${t.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${p}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${m}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===d}) {\n\n              if (${m}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${p}) *\n                    getW(wR, wC, ${p}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${p}, xR, xC) *\n                    getW(wR, wC, ${p}, d2);\n              }\n\n            } else if (${2===d}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2)\n              );\n\n              if (${m}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===d}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2),\n                getW(wR, wC, ${p} + 2, d2)\n              );\n\n              if (${m}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1),\n                  getX(batch, xR, xC, ${p} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC),\n                  getX(batch, ${p} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${x}\n        ${v}\n        setOutput(result);\n      }\n    `}}class fT{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,s=t.strideDepth,o=t.strideHeight,i=t.strideWidth,a=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterDepth,f=t.filterHeight,h=t.filterWidth,p=4*Math.floor(t.inChannels/4),d=t.inChannels%4;this.userCode=`\n      const ivec3 strides = ivec3(${s}, ${o}, ${i});\n      const ivec3 pads = ivec3(${e}, ${n}, ${r});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${l}; wF++) {\n          int xF = xFCorner + wF * ${a};\n\n          if (xF < 0 || xF >= ${t.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${f}; wR++) {\n            int xR = xRCorner + wR * ${u};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${h}; wC++) {\n              int xC = xCCorner + wC * ${c};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ${p}; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (${1===d}) {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ${p}) *\n                  getW(wF, wR, wC, ${p}, d2);\n              } else if (${2===d}) {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (${3===d}) {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1),\n                  getX(batch, xF, xR, xC, ${p} + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2),\n                  getW(wF, wR, wC, ${p} + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hT{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=N$(this.outputShape.length);const{dataFormat:n}=e,r=ZN(),s="channelsLast"===n,o=s?0:1,i=s?1:2,a=this.enableShapeUniforms?"if(blockIndex < outShape[1] && pos < outShape[0]) {":`if(blockIndex < ${t[1]} && pos < ${t[0]}) {`;let u="";for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)u+=`\n          blockIndex = rc.y + ${e};\n          pos = rc.x + ${t};\n\n          ${a}\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[${o}] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[${i}] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (${s}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*t+e}] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*t+e}] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${u}\n\n        ${r.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pT({x:t,filter:e,convInfo:n,backend:r,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const u=t.shape,c=r.texData.get(t.dataId),l=n.inChannels,f=u[0]*u[1]*u[2],h=n.outChannels,p="channelsLast"===n.dataFormat;let d;const m=[];if(null!=o&&!p&&3===o.shape.length){const t=JS({inputs:{x:o},backend:r,attrs:{perm:[1,2,0]}});m.push(t),o=t}if(!((1===f||1===h)&&l>1e3)&&c.isPacked&&p&&null!=c.texture&&u[2]%2!=0&&Vp(c.shape.slice(-3),u.slice(-3))){const l=u[0]*u[1]*(u[2]+1),f={dataId:t.dataId,shape:[1,l,n.inChannels],dtype:t.dtype},h=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,Dp(UN(c.shape,f.shape),(()=>`packed reshape ${c.shape} to ${f.shape} isn't free`));const p=VS({inputs:{x:e},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});m.push(p);const y=ZS({a:f,b:p,backend:r,transposeA:false,transposeB:false,bias:s,activation:a,preluActivationWeights:o,leakyreluAlpha:i}),g=r.texData.get(y.dataId);Dp(g.isPacked,(()=>"batchMatMul result is expected to be packed")),c.shape=h,g.shape=n.outShape,d=vS({inputs:{x:y},backend:r}),d.shape=n.outShape,m.push(y)}else{const u=p?t:JS({inputs:{x:t},backend:r,attrs:{perm:[0,2,3,1]}}),c=u.shape,l=VS({inputs:{x:u},backend:r,attrs:{shape:[1,c[0]*c[1]*c[2],n.inChannels]}}),f=VS({inputs:{x:e},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),h=ZS({a:l,b:f,transposeA:false,transposeB:false,backend:r,bias:s,activation:a,preluActivationWeights:o,leakyreluAlpha:i}),y=VS({inputs:{x:h},backend:r,attrs:{shape:[n.batchSize,n.outHeight,n.outWidth,n.outChannels]}});d=p?y:JS({inputs:{x:y},backend:r,attrs:{perm:[0,3,1,2]}}),p||(m.push(u),m.push(y)),m.push(l),m.push(f),m.push(h)}for(const t of m)r.disposeIntermediateTensorInfo(t);return d}function dT({x:t,filter:e,convInfo:n,backend:r,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const{filterWidth:u,filterHeight:c,inChannels:l,outWidth:f,outHeight:h,dataFormat:p}=n,d="channelsLast"===p,m=u*c*l,y=h*f,g=[m,y],b=[];if(null!=o&&!d&&3===o.shape.length){const t=JS({inputs:{x:o},backend:r,attrs:{perm:[1,2,0]}});b.push(t),o=t}const w=VS({inputs:{x:t},backend:r,attrs:{shape:t.shape.slice(1)}}),v=VS({inputs:{x:e},backend:r,attrs:{shape:[1,m,Bp(e.shape)/m]}});b.push(w),b.push(v);const x=new hT(g,n),N=[w.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],$=r.runWebGLProgram(x,[w],"float32",N),E=VS({inputs:{x:$},backend:r,attrs:{shape:[1,g[0],g[1]]}});b.push($),b.push(E);const S=null!=s,_=null!=o,T="leakyrelu"===a,k=a?IS(a,!0):null,A=new MS(E.shape,v.shape,[1,y,n.outChannels],!0,!1,S,k,_,T),C=[E,v];if(s&&C.push(s),_&&C.push(o),T){const t=r.makeTensorInfo([],"float32",Fm(i,"float32"));C.push(t),b.push(t)}const O=r.runWebGLProgram(A,C,"float32"),I=VS({inputs:{x:O},backend:r,attrs:{shape:[1,h,f,n.outChannels]}}),M=d?I:JS({inputs:{x:I},backend:r,attrs:{perm:[0,3,1,2]}});d||b.push(I),b.push(O);for(const t of b)r.disposeIntermediateTensorInfo(t);return M}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mT={kernelName:"Conv2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:o}=e,{strides:i,pad:a,dataFormat:u,dilations:c,dimRoundingMode:l}=r,f=iw(u),h=Yb(s.shape,o.shape,i,c,a,l,!1,f);let p;if(1!==h.filterHeight||1!==h.filterWidth||1!==h.dilationHeight||1!==h.dilationWidth||1!==h.strideHeight||1!==h.strideWidth||"SAME"!==h.padInfo.type&&"VALID"!==h.padInfo.type)if(hd().getBool("WEBGL_CONV_IM2COL")&&1===s.shape[0])p=dT({x:s,filter:o,convInfo:h,backend:n});else{const t=new lT(h);p=n.runWebGLProgram(t,[s,o],"float32")}else p=pT({x:s,filter:o,convInfo:h,backend:n});const d=VS({inputs:{x:p},backend:n,attrs:{shape:h.outShape}});return n.disposeIntermediateTensorInfo(p),d}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yT{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,s=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${e} - ${r};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${s};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              if (${o}) {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class gT{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,s=t.strideWidth,o="channelsLast"===t.dataFormat,i=e-1-t.padInfo.top,a=n-1-t.padInfo.left,u=o?1:2,c=o?2:3,l=o?3:1;this.userCode=`\n      const ivec2 pads = ivec2(${i}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${l}];\n\n        ivec2 dyCorner = ivec2(coords[${u}], coords[${c}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${s}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n\n              if (${o}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class bT{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,s=t.padInfo.front,o=t.padInfo.top,i=t.padInfo.left;this.userCode=`\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yF = 0; yF < ${t.outDepth}; yF++) {\n            int xF = wF + yF * ${e} - ${s};\n\n            if (xF < 0 || xF >= ${t.inDepth}) {\n              continue;\n            }\n\n            for (int yR = 0; yR < ${t.outHeight}; yR++) {\n              int xR = wR + yR * ${n} - ${o};\n\n              if (xR < 0 || xR >= ${t.inHeight}) {\n                continue;\n              }\n\n              for (int yC = 0; yC < ${t.outWidth}; yC++) {\n                int xC = wC + yC * ${r} - ${i};\n\n                if (xC < 0 || xC >= ${t.inWidth}) {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class wT{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,s=t.strideDepth,o=t.strideHeight,i=t.strideWidth,a=e-1-t.padInfo.front,u=n-1-t.padInfo.top,c=r-1-t.padInfo.left;this.userCode=`\n      const ivec3 pads = ivec3(${a}, ${u}, ${c});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${e}; wF++) {\n          float dyF = float(dyFCorner + wF) / ${s}.0;\n\n          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ${e} - 1 - wF;\n\n          for (int wR = 0; wR < ${n}; wR++) {\n            float dyR = float(dyRCorner + wR) / ${o}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ${n} - 1 - wR;\n\n            for (int wC = 0; wC < ${r}; wC++) {\n              float dyC = float(dyCCorner + wC) / ${i}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ${r} - 1 - wC;\n\n              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vT={kernelName:"Conv2DBackpropFilter",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,dy:o}=e,{strides:i,pad:a,dataFormat:u,dimRoundingMode:c,filterShape:l}=r,f=iw(u),h=Yb(s.shape,l,i,1,a,c,!1,f),p=new yT(h);return n.runWebGLProgram(p,[s,o],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xT={kernelName:"Conv2DBackpropInput",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,filter:o}=e,{inputShape:i,strides:a,pad:u,dataFormat:c,dimRoundingMode:l}=r,f=iw(c),h=Yb(i,o.shape,a,1,u,l,!1,f),p=new gT(h);return n.runWebGLProgram(p,[s,o],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NT={kernelName:"Conv3D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:o}=e,{strides:i,pad:a,dilations:u}=r,c=Zb(s.shape,o.shape,i,u,a),l=new fT(c);return n.runWebGLProgram(l,[s,o],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $T={kernelName:"Conv3DBackpropFilterV2",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,dy:o}=e,{strides:i,pad:a,filterShape:u}=r,c=Zb(s.shape,u,i,1,a),l=new bT(c);return n.runWebGLProgram(l,[s,o],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ET={kernelName:"Conv3DBackpropInputV2",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,filter:o}=e,{pad:i,strides:a,inputShape:u}=r,c=Zb(u,o.shape,a,1,i),l=new wT(c);return n.runWebGLProgram(l,[s,o],"float32")}},ST={kernelName:"Cos",backendName:"webgl",kernelFunc:CS({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n"})},_T={kernelName:"Cosh",backendName:"webgl",kernelFunc:CS({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class TT{constructor(t,e,n,r,s){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,i,a,u]=t,[c]=e,[l,f]=n;this.outputShape=[c,l,f,u];const h="bilinear"===r?1:0,[p,d]=[i-1+".0",a-1+".0"],[m,y,g]=l>1?[""+(i-1)/(l-1),"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[b,w,v]=f>1?[""+(a-1)/(f-1),"(x2-x1) * width_ratio",`x1*${d} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${d}`];this.userCode=`\n      const float height_ratio = float(${m});\n      const float width_ratio = float(${b});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${o}) {\n          return;\n        }\n\n        float height_scale = ${y};\n        float width_scale = ${w};\n\n        float in_y = ${g};\n        if( in_y < 0.0 || in_y > ${p} ) {\n          setOutput(float(${s}));\n          return;\n        }\n        float in_x = ${v};\n        if( in_x < 0.0 || in_x > ${d} ) {\n          setOutput(float(${s}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${h} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kT={kernelName:"CropAndResize",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{image:s,boxes:o,boxInd:i}=e,{cropSize:a,method:u,extrapolationValue:c}=r,l=new TT(s.shape,o.shape,a,u,c);return n.runWebGLProgram(l,[s,o,i],"float32")}};var AT;!function(t){t.Prod="*",t.Sum="+"}(AT||(AT={}));class CT{constructor(t,e,n,r){this.op=t,this.outputShape=e,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const s=this.outputShape.length,o=this.op===AT.Prod?"1.0":"0.0",i=n?o:`getX(${OT(s,"coords",this.op)})`,a=this.outputShape[this.outputShape.length-1];let u="",c="";n?(u=r?"end != "+(a-1):"end != 0",c=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${a}`:"end >= pow2",c=r?"end + pow2":"end - pow2"),this.userCode=`\n      void main() {\n        ${m$(s)} coords = getOutputCoords();\n        int end = ${IT(s,"coords",this.op)};\n        float val = ${i};\n        int pow2 = int(pow(2.0, index));\n        if (${u}) {\n          int idx = ${c};\n          ${IT(s,"coords",this.op)} = idx;\n          val ${this.op}= getX(${OT(s,"coords",this.op)});\n        }\n        setOutput(val);\n      }\n    `}}function OT(t,e,n){if(1===t)return`${e}`;if(2===t)return`${e}.x, ${e}.y`;if(3===t)return`${e}.x, ${e}.y, ${e}.z`;if(4===t)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function IT(t,e,n){if(1===t)return`${e}`;if(2===t)return`${e}.y`;if(3===t)return`${e}.z`;if(4===t)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MT(t,e,n,r,s,o){const i=e.shape.length,a=Ow([r],i);let u=e;null!=a&&(u=JS({inputs:{x:e},backend:n,attrs:{perm:a}}));const c=Mw(1,i)[0];if(c!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${r}`);const l=u.shape[c];let f=vS({inputs:{x:u},backend:n});for(let e=0;e<=Math.ceil(Math.log2(l))-1;e++){const r=new CT(t,u.shape,!1,o),s=[[e]],i=f;f=n.runWebGLProgram(r,[f],f.dtype,s),n.disposeIntermediateTensorInfo(i)}if(s){const e=new CT(t,u.shape,s,o),r=f;f=n.runWebGLProgram(e,[f],f.dtype),n.disposeIntermediateTensorInfo(r)}if(null!=a){const t=JS({inputs:{x:f},backend:n,attrs:{perm:Iw(a)}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(u),t}return f}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RT={kernelName:"Cumprod",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:o,exclusive:i,reverse:a}=r;return MT(AT.Prod,s,n,o,i,a)}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DT={kernelName:"Cumsum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:o,exclusive:i,reverse:a}=r;return MT(AT.Sum,s,n,o,i,a)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FT={kernelName:"DenseBincount",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,weights:o}=e,{size:i,binaryOutput:a}=r;if(1===s.shape.length){const t=n.readSync(s.dataId),e=n.readSync(o.dataId),r=dE(t,e,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,r)}if(2===s.shape.length){const t=n.bufferSync(s),e=n.bufferSync(o),r=mE(t,e,i,a);return n.makeTensorInfo(r.shape,o.dtype,r.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LT{constructor(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode=`\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ${this.getHeightCoordString()};\n      int w = ${this.getWidthCoordString()};\n      int d = ${this.getDepthCoordString()};\n\n      int in_h = h / ${e};\n      int offset_h = imod(h, ${e});\n      int in_w = w / ${e};\n      int offset_w = imod(w, ${e});\n      int offset_d = (offset_h * ${e} + offset_w) *\n        ${this.getOutputDepthSize()};\n      int in_d = d + offset_d;\n\n      float result = ${this.getInputSamplingString()};\n      setOutput(result);\n    }\n  `}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PT={kernelName:"DepthToSpace",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{blockSize:o,dataFormat:i}=r,a=s.shape[0],u=("NHWC"===i?s.shape[1]:s.shape[2])*o,c=("NHWC"===i?s.shape[2]:s.shape[3])*o,l=("NHWC"===i?s.shape[3]:s.shape[1])/(o*o),f=new LT("NHWC"===i?[a,u,c,l]:[a,l,u,c],o,i);return n.runWebGLProgram(f,[s],s.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BT{constructor(t,e=!1,n=null,r=!1,s=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=N$(this.outputShape.length);const o=t.filterHeight,i=t.filterWidth,a=t.outChannels/t.inChannels;let u="",c="";n&&(u=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:s?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,c="result = activation(result);");const l=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${u}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${a};\n        int q = d2 - d1 * ${a};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${o}; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${i}; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${l}\n        ${c}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VT{constructor(t,e=!1,n=null,r=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=N$(this.outputShape.length);const o=t.outChannels/t.inChannels,i=t.padInfo.left,a=t.strideWidth,u=t.dilationWidth,c=t.filterHeight,l=t.filterWidth,f=l;let h="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let t=0;t<l;t++)h+=`\n          vec4 xTexelC${2*t};\n          int xTexelC${2*t}Ready;\n          vec4 xTexelC${2*t+1};\n          int xTexelC${2*t+1}Ready;\n          vec4 xC${t};`;h+=`\n    for (int r = 0; r < ${c}; r++) {\n      `;for(let t=0;t<l;t++)h+=`\n          xTexelC${2*t} = vec4(0.0);\n          xTexelC${2*t}Ready = 0;\n          xTexelC${2*t+1} = vec4(0.0);\n          xTexelC${2*t+1}Ready = 0;\n          xC${t} = vec4(0.0);`;h+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let t=0;t<(f+1)/2;t++){const e=2*t;if(h+=`\n          xC = xCCorner + ${e*u};\n          `,1===a){if(e<l&&(i%2==1?(h+=`\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n              `,h+=1===u&&e>0?`\n                xC${e} = vec4(xTexelC${e-2}.zw, xTexelC${e}.xy);\n                `:`\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC${e} = vec4(previous.zw, xTexelC${e}.xy);\n                  } else {\n                    xC${e} = vec4(0.0, 0.0, xTexelC${e}.xy);\n                  }\n                  `):h+=`\n                if (xC >= 0 && xC < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                xC${e} = xTexelC${e};\n                `,e+1<l)){const t=i%2==0?Mp(u):u;u%2==0&&i%2==1||u%2!=0&&i%2!=1?(h+=`\n                  xCOffset = xC + imod(pads[1], 2) + ${t};\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                    xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC${e+1}.zw = vec2(0.0);\n                    }\n                    xTexelC${e+1}Ready = 1;\n                  }\n                  `,u>1&&(h+=`\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                      xTexelC${e} = getX(batch, xR, xCOffset, d1);\n                      xTexelC${e}Ready = 1;\n                    }\n                    `),h+=`\n                  xC${e+1} = vec4(xTexelC${e}.zw, xTexelC${e+1}.xy);\n                  `):h+=1===t?`\n                    xC${e+1} = xTexelC${e};\n                    `:`\n                    xCOffset = xC + ${t};\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                      xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC${e+1}.zw = vec2(0.0);\n                      }\n                      xTexelC${e+1}Ready = 1;\n                    }\n\n                    xC${e+1} = xTexelC${e+1};\n                    `}}else e<l&&(i%2==1?(h+=`\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${e+1}Ready == 0) {\n                  xTexelC${e+1} = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC${e+1}.zw = vec2(0.0);\n                  }\n                  xTexelC${e+1}Ready = 1;\n                }\n\n                xC${e} = vec4(xTexelC${e}.zw, xTexelC${e+1}.zw);\n              `,e+1<l&&(h+=`\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC${e+1} = vec4(xTexelC${e+1}.xy, final.xy);\n                `)):(h+=`\n                if(xC >= 0 && xC < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                  xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e+1}.zw = vec2(0.);\n                  }\n                  xTexelC${e+1}Ready = 1;\n                }\n\n                xC${e} = vec4(\n                  xTexelC${e}.xy, xTexelC${e+1}.xy);\n              `,e+1<l&&(h+=`\n                  xC${e+1} = vec4(xTexelC${e}.zw, xTexelC${e+1}.zw);\n                `)));e<l&&(h+=`\n            wTexel = getW(r, ${e}, d1, q);\n            dotProd += xC${e} * vec4(wTexel.xz, wTexel.xz);\n          `,e+1<l&&(h+=`\n              wTexel = getW(r, ${e+1}, d1, q);\n              dotProd += xC${e+1} * vec4(wTexel.xz, wTexel.xz);\n            `))}h+="\n    }\n  ",h+="\n      }\n    ";let p="",d="";n&&(p=r?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:s?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,d="result = activation(result);");const m=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${p}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${o};\n        int q = d2 - d1 * ${o};\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ${h}\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ${m}\n        ${d}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zT={kernelName:"DepthwiseConv2dNative",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:o}=e,{strides:i,pad:a,dilations:u,dimRoundingMode:c}=r;let l=u;null==l&&(l=[1,1]),Dp(ow(i,l),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`));const f=Yb(s.shape,o.shape,i,l,a,c,!0);let h;h=hd().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels==1?new VT(f):new BT(f);const p=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return n.runWebGLProgram(h,[s,o],"float32",p)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WT{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,s=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ${o} + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${e} - ${r};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${s};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class UT{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,s=t.strideWidth,o=e-1-t.padInfo.top,i=n-1-t.padInfo.left,a=t.outChannels/t.inChannels;this.userCode=`\n      const ivec2 pads = ivec2(${o}, ${i});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${s}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ${a}; dm++) {\n              int d2 = d1 * ${a} + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jT={kernelName:"DepthwiseConv2dNativeBackpropFilter",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,dy:o}=e,{strides:i,dilations:a,pad:u,dimRoundingMode:c,filterShape:l}=r,f=Yb(s.shape,l,i,a,u,c,!0),h=new WT(f);return n.runWebGLProgram(h,[s,o],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GT={kernelName:"DepthwiseConv2dNativeBackpropInput",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,filter:o}=e,{strides:i,dilations:a,pad:u,dimRoundingMode:c,inputShape:l}=r,f=Yb(l,o.shape,i,a,u,c,!0),h=new UT(f);return n.runWebGLProgram(h,[s,o],"float32")}};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qT{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HT={kernelName:"Diag",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e,s=[...r.shape,...r.shape],o=Bp(r.shape),i=VS({inputs:{x:r},backend:n,attrs:{shape:[o]}}),a=new qT(o),u=n.runWebGLProgram(a,[i],i.dtype),c=VS({inputs:{x:u},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(u),c}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KT{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:e,inWidth:n,padInfo:r,strideHeight:s,strideWidth:o,filterHeight:i,filterWidth:a,dilationHeight:u,dilationWidth:c}=t,{top:l,left:f}=r;this.userCode=`\n      const ivec2 strides = ivec2(${s}, ${o});\n      const ivec2 pads = ivec2(${l}, ${f});\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ${i}; h++) {\n          int hIn = hBeg + h * ${u};\n\n          if (hIn >= 0 && hIn < ${e}) {\n            for (int w = 0; w < ${a}; w++) {\n              int wIn = wBeg + w * ${c};\n\n              if (wIn >= 0 && wIn < ${n}) {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XT={kernelName:"Dilation2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:o}=e,{strides:i,pad:a,dilations:u}=r,c=Kb(s.shape,o.shape,i,a,"NHWC",u);let l;const f=new KT(c);l=n.runWebGLProgram(f,[s,o],"float32");const h=VS({inputs:{x:l},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(l),h}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JT={kernelName:"Einsum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{equation:s}=r,o=e,{allDims:i,summedDims:a,idDims:u}=Gx(s,o.length);Hx(i.length,u,o);const{path:c,steps:l}=Kx(a,u),f=l.length;let h=null,p=i.length;const d=[];for(let t=0;t<f;++t){for(const e of l[t]){const{permutationIndices:t,expandDims:r}=qx(p,u[e]);let s;Xx(t)?s=o[e]:(s=JS({inputs:{x:o[e]},backend:n,attrs:{perm:t}}),d.push(s));const i=s.shape.slice();for(let t=0;t<r.length;++t)i.splice(r[t],0,1);Vp(s.shape,i)||(s=VS({inputs:{x:s},backend:n,attrs:{shape:i}}),d.push(s)),null===h?h=s:(h=PS({inputs:{a:s,b:h},backend:n}),d.push(h))}t<f-1&&(c[t]>=0&&(h=KS({inputs:{x:h},backend:n,attrs:{axis:c[t]-(i.length-p),keepDims:!1}}),d.push(h)),p--)}for(const t of d)t!==h&&n.disposeIntermediateTensorInfo(t);return h}},YT={kernelName:"Elu",backendName:"webgl",kernelFunc:CS({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"})},ZT={kernelName:"EluGrad",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n}=t,{dy:r,y:s}=e,o=hd().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wS("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,s.shape):new bS("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,s.shape);return n.runWebGLProgram(o,[r,s],r.dtype)}},QT={kernelName:"Equal",backendName:"webgl",kernelFunc:OS({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:bE})},tk={kernelName:"Erf",backendName:"webgl",kernelFunc:CS({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n'})},ek=CS({opSnippet:"if (isnan(x)) return x;\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:wE,dtype:"float32"}),nk={kernelName:"Exp",backendName:"webgl",kernelFunc:ek};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function rk(t){const{inputs:e,attrs:n,backend:r}=t,{dim:s}=n,{input:o}=e,i=o.shape.length,a=o.shape.slice();let u=s;return s<0&&(Dp(-(i+1)<=s,(()=>`Axis must be in the interval [${-(i+1)}, ${i}]`)),u=i+s+1),a.splice(u,0,1),VS({inputs:{x:o},backend:r,attrs:{shape:a}})}const sk={kernelName:"ExpandDims",backendName:"webgl",kernelFunc:rk},ok="return exp(x) - 1.0;",ik={kernelName:"Expm1",backendName:"webgl",kernelFunc:CS({opSnippet:ok,packedOpSnippet:ok,cpuKernelImpl:vE})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class ak{constructor(t,e,n){this.variableNames=["real","imag"];const r=e[1];this.outputShape=e;const s=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=n?`${r}.0`:"1.0";let i;if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);i="return real * expI + imag * expR;"}this.userCode=`\n      const float exponentMultiplier = ${s};\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ${i}\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(${r});\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ${r}; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ${o};\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uk(t,e,n){const r=n.texData.get(t.dataId),s=Bp(t.shape),o=t.shape[t.shape.length-1],i=VS({inputs:{x:t},backend:n,attrs:{shape:[s/o,o]}}),a=i.shape,u=new ak("real",a,e),c=new ak("imag",a,e),l=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:a},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:a}],f=n.runWebGLProgram(u,l,"float32"),h=n.runWebGLProgram(c,l,"float32"),p=NS({inputs:{real:f,imag:h},backend:n});n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h);const d=VS({inputs:{x:p},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(p),d}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ck={kernelName:"FFT",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{input:r}=e;return uk(r,!1,n)}};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lk{constructor(t,e){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fk(t){const{backend:e,attrs:n}=t,{shape:r,value:s}=n;let{dtype:o}=n;if(o=o||Zp(s),"string"===o){const t=Kp(o,Bp(r));return t.fill(s),e.makeTensorInfo(r,o,t)}{const t=new lk(r,s),n=[[s]];return e.runWebGLProgram(t,[],o,n)}}const hk={kernelName:"Fill",backendName:"webgl",kernelFunc:fk};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pk{constructor(t){this.variableNames=["Image"],this.outputShape=[];const e=t[2];this.outputShape=t,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ${e} - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ${e}) {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dk={kernelName:"FlipLeftRight",backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,r=e,s=new pk(n.shape);return r.runWebGLProgram(s,[n],n.dtype)}},mk="return floor(x);",yk={kernelName:"Floor",backendName:"webgl",kernelFunc:CS({opSnippet:mk,packedOpSnippet:mk,cpuKernelImpl:xE})},gk={kernelName:"FloorDiv",backendName:"webgl",kernelFunc:OS({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class bk{constructor(t){this.variableNames=["A"];const e=ZN(),[n,r]=t;this.outputShape=t,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${n}.0);\n\n        vec4 values = ${e.texture2D}(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wk{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const e=ZN(),[n,r]=t;this.outputShape=t,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(${r}.0, ${n}.0);\n            vec4 values = ${e.texture2D}(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ${e.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vk={kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t;let{pixels:s}=e;const{numChannels:o}=r,i="undefined"!=typeof HTMLVideoElement&&s instanceof HTMLVideoElement,a="undefined"!=typeof HTMLImageElement&&s instanceof HTMLImageElement,[u,c]=i?[s.videoWidth,s.videoHeight]:[s.width,s.height],l=[c,u],f=[c,u,o];(a||i)&&(null==xk&&(xk=document.createElement("canvas").getContext("2d")),xk.canvas.width=u,xk.canvas.height=c,xk.drawImage(s,0,0,u,c),s=xk.canvas);const h=n.makeTensorInfo(l,"int32");n.texData.get(h.dataId).usage=xN.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),s);const p=hd().getBool("WEBGL_PACK")?new wk(f):new bk(f),d=n.runWebGLProgram(p,[h],"int32");return n.disposeData(h.dataId),d}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */};let xk;const Nk={kernelName:"FusedConv2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:o,bias:i,preluActivationWeights:a}=e,{strides:u,pad:c,dataFormat:l,dilations:f,dimRoundingMode:h,activation:p,leakyreluAlpha:d}=r,m=iw(l),y=Yb(s.shape,o.shape,u,f,c,h,!1,m);let g;const b=[];if(1!==y.filterHeight||1!==y.filterWidth||1!==y.dilationHeight||1!==y.dilationWidth||1!==y.strideHeight||1!==y.strideWidth||"SAME"!==y.padInfo.type&&"VALID"!==y.padInfo.type)if(hd().getBool("WEBGL_CONV_IM2COL")&&1===s.shape[0])g=dT({x:s,filter:o,convInfo:y,backend:n,bias:i,activation:p,preluActivationWeights:a,leakyreluAlpha:d});else{const t=null!=i,e=null!=a,r="leakyrelu"===p,u=p?IS(p,!1):null,c=new lT(y,t,u,e,r),f=[s,o],h=(t,e)=>{if("NCHW"===e&&1===t.shape.length&&1!==t.shape[0]){const e=VS({inputs:{x:t},backend:n,attrs:{shape:[t.shape[0],1,1]}});return b.push(e),e}return t};if(t&&f.push(h(i,l)),e&&f.push(h(a,l)),r){const t=n.makeTensorInfo([],"float32",Fm(d,"float32"));f.push(t),b.push(t)}g=n.runWebGLProgram(c,f,"float32")}else g=pT({x:s,filter:o,convInfo:y,backend:n,bias:i,activation:p,preluActivationWeights:a,leakyreluAlpha:d});const w=VS({inputs:{x:g},backend:n,attrs:{shape:y.outShape}});return b.push(g),b.forEach((t=>n.disposeIntermediateTensorInfo(t))),w}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $k={kernelName:"FusedDepthwiseConv2D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,filter:o,bias:i,preluActivationWeights:a}=e,{strides:u,pad:c,dilations:l,dimRoundingMode:f,activation:h,leakyreluAlpha:p}=r,d=[];let m=l;null==m&&(m=[1,1]),Dp(ow(u,m),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${m}'`));const y=Yb(s.shape,o.shape,u,m,c,f,!0),g=hd().getBool("WEBGL_PACK_DEPTHWISECONV")&&y.strideWidth<=2&&y.outChannels/y.inChannels==1,b=h?IS(h,g):null,w=[s,o],v=null!=i,x=null!=a,N="leakyrelu"===h;if(v&&w.push(i),x&&w.push(a),N){const t=n.makeTensorInfo([],"float32",Fm(p,"float32"));w.push(t),d.push(t)}let $;$=g?new VT(y,v,b,x,N):new BT(y,v,b,x,N);const E=[[y.padInfo.top,y.padInfo.left],[y.strideHeight,y.strideWidth],[y.dilationHeight,y.dilationWidth],[y.inHeight,y.inWidth]],S=n.runWebGLProgram($,w,"float32",E);return d.forEach((t=>n.disposeIntermediateTensorInfo(t))),S}};class Ek{constructor(t,e,n){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=n;const r=m$(e.length),s=m$(n.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`\n        ${r} strides = ${r}(${this.strides});\n         void main() {\n          ${s} coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ${this.sliceDim}; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ${o};\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sk={kernelName:"GatherNd",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{params:r,indices:s}=e,o=s.shape,i=o[o.length-1],a=Bp(r.shape),[u,c,l,f]=xb(r,s),h=VS({inputs:{x:s},backend:n,attrs:{shape:[c,i]}}),p=VS({inputs:{x:r},backend:n,attrs:{shape:[Bp(r.shape)/l,l]}});if(n.shouldExecuteOnCPU([r,s])||"string"===r.dtype){const t=n.readSync(s.dataId),e=n.bufferSync(r),o=NE(t,e,r.dtype,c,i,l,f,r.shape,a);return n.makeTensorInfo(u,r.dtype,o.values)}const d=new Ek(i,f,[c,l]),m=n.runWebGLProgram(d,[p,h],p.dtype),y=VS({inputs:{x:m},backend:n,attrs:{shape:u}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),y}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _k{constructor(t,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;const n=m$(this.rank),r=function(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let e=0;e<t.length;e++)2===e?r.push("index"):r.push(`${n[e]}`);return r.join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t);this.userCode=`\n      void main() {\n        ${n} resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;\n        setOutput(inBounds * getA(${r}));\n      }\n    `}}function Tk(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,indices:o}=e,{axis:i,batchDims:a}=r,u=Gp(i,s.shape)[0];if(hd().get("DEBUG")){const t=n.readSync(o.dataId),e=s.shape[u];for(let n=0;n<t.length;++n){const r=t[n];Dp(r<=e-1&&r>=0,(()=>`GatherV2: the index value ${r} is not in [0, ${e-1}]`))}}const c=hN(s,o,u,a),l=Bp(o.shape),f=[],h=VS({inputs:{x:s},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),p=VS({inputs:{x:o},backend:n,attrs:{shape:[c.batchSize,l/c.batchSize]}});f.push(h),f.push(p);const d=[c.batchSize,c.outerSize,l/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([s,o])||"string"===s.dtype){const t=n.bufferSync(p),e=n.bufferSync(h),r=$E(e,t,d);return f.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(c.outputShape,r.dtype,r.values)}const m=new _k(h.shape,d),y=n.runWebGLProgram(m,[h,p],h.dtype);f.push(y);const g=VS({inputs:{x:y},backend:n,attrs:{shape:c.outputShape}});return f.forEach((t=>n.disposeIntermediateTensorInfo(t))),g}const kk={kernelName:"GatherV2",backendName:"webgl",kernelFunc:Tk},Ak={kernelName:"Greater",backendName:"webgl",kernelFunc:OS({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:EE,dtype:"bool"})},Ck={kernelName:"GreaterEqual",backendName:"webgl",kernelFunc:OS({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:SE})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ok={kernelName:"IFFT",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n}=t,{input:r}=e;return uk(r,!0,n)}},Ik={kernelName:"IsFinite",backendName:"webgl",kernelFunc:CS({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"})},Mk={kernelName:"IsInf",backendName:"webgl",kernelFunc:CS({opSnippet:"return float(isinf(x));",dtype:"bool"})},Rk={kernelName:"IsNan",backendName:"webgl",kernelFunc:CS({opSnippet:"return float(isnan(x));",dtype:"bool"})},Dk={kernelName:"Less",backendName:"webgl",kernelFunc:OS({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:_E,dtype:"bool"})},Fk={kernelName:"LessEqual",backendName:"webgl",kernelFunc:OS({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:TE,dtype:"bool"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lk={kernelName:"LinSpace",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{backend:e,attrs:n}=t,{start:r,stop:s,num:o}=n,i=kE(r,s,o);return e.makeTensorInfo([i.length],"float32",i)}},Pk={kernelName:"Log",backendName:"webgl",kernelFunc:CS({opSnippet:"if (isnan(x)) return x;\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:AE})},Bk={kernelName:"Log1p",backendName:"webgl",kernelFunc:CS({opSnippet:"if (isnan(x)) return x;\n  return log(1.0 + x);\n"})},Vk={kernelName:"LogicalAnd",backendName:"webgl",kernelFunc:OS({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"})},zk={kernelName:"LogicalNot",backendName:"webgl",kernelFunc:CS({opSnippet:"return float(!(x >= 1.0));"})},Wk={kernelName:"LogicalOr",backendName:"webgl",kernelFunc:OS({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Uk{constructor(t,e,n,r,s){this.variableNames=["x"],this.outputShape=[];const o=e,i=t[3]-1;let a;this.outputShape=t;const u=`float(${n}) + float(${r}) * sum`;a=.5===s?`inversesqrt(${u})`:1===s?`1.0/(${u})`:`exp(log(${u}) * float(-${s}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -${o}; j <= ${o}; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ${i}) {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ${a};\n        setOutput(val);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jk{constructor(t,e,n,r,s){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=e,i=t[3]-1;let a;this.outputShape=t;const u=`float(${n}) + float(${r}) * sum`;a=.5===s?`inversesqrt(${u})`:1===s?`1.0/(${u})`:`exp(log(${u}) * float(-${s}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ${this.outputShape[3]};\n        bool hasNextRow = c < ${this.outputShape[2]};\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ${o};\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ${o}; j <= ${o}; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${i}));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ${a};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gk={kernelName:"LRN",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{depthRadius:o,bias:i,alpha:a,beta:u}=r,c=hd().getBool("WEBGL_PACK_NORMALIZATION")?new jk(s.shape,o,i,a,u):new Uk(s.shape,o,i,a,u);return n.runWebGLProgram(c,[s],s.dtype)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class qk{constructor(t,e,n,r,s){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=s,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ${this.depth}; ++d) {\n          int depthBegin = int(max(0.0, float(d - ${e})));\n          int depthEnd = int(min(float(${this.depth}),\n              float(d + ${e} + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ${this.depth};\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(${r}) * norm + float(${n});\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(${r})\n                * float(${s})\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ${s});\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hk={kernelName:"LRNGrad",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:s,y:o,dy:i}=e,{depthRadius:a,bias:u,alpha:c,beta:l}=r,f=new qk(s.shape,a,u,c,l);return n.runWebGLProgram(f,[s,o,i],s.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Kk(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{reductionIndices:o,keepDims:i}=r,a=s.shape.length,u=Gp(o,s.shape);let c=u;const l=Ow(c,a),f=null!=l,h=n.shouldExecuteOnCPU([s]);let p=s;if(f){if(h){const t=n.texData.get(p.dataId).values,e=new Array(a);for(let t=0;t<e.length;t++)e[t]=s.shape[l[t]];const r=tS(t,s.shape,s.dtype,l,e);p=n.makeTensorInfo(e,s.dtype);n.texData.get(p.dataId).values=r}else p=HS(s,l,n);c=Mw(c.length,a)}Cw("max",c,a);const[d,m]=kw(p.shape,c);let y,g=d;if(i&&(g=Aw(d,u)),h){const t=n.texData.get(p.dataId).values,e=CE(t,Bp(m),g,s.dtype);y=n.makeTensorInfo(g,s.dtype);n.texData.get(y.dataId).values=e}else y=
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const s=Bp(e),o=VS({inputs:{x:t},attrs:{shape:[Bp(t.shape)/s,s]},backend:r}),i=jS(o,t.dtype,"max",r),a=VS({inputs:{x:i},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(i),a}(p,m,g,n);return f&&n.disposeIntermediateTensorInfo(p),y}const Xk={kernelName:"Max",backendName:"webgl",kernelFunc:Kk},Jk={kernelName:"Maximum",backendName:"webgl",kernelFunc:OS({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:OE})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yk={kernelName:"MaxPool",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e;JN(s,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:u}=r;Dp(ow(i,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '1'`));const c=Xb(s.shape,o,i,1,a,u);if(1===c.filterWidth&&1===c.filterHeight&&Vp(c.inShape,c.outShape))return vS({inputs:{x:s},backend:n});const l=new $_(c,"max",!1);return n.runWebGLProgram(l,[s],s.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zk={kernelName:"MaxPool3D",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{filterSize:o,strides:i,pad:a,dataFormat:u,dimRoundingMode:c}=r,l=Jb(s.shape,o,i,[1,1,1],a,c,u),f=new E_(l,"max",!1);return n.runWebGLProgram(f,[s],s.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qk{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideHeight,n=t.strideWidth,r=t.dilationHeight,s=t.effectiveFilterHeight,o=t.effectiveFilterWidth,i=s-1-t.padInfo.top,a=o-1-t.padInfo.left,u=s*o-1;this.userCode=`\n      const ivec2 pads = ivec2(${i}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${s};\n          wR += ${r}) {\n          float dyR = float(dyRCorner + wR) / ${e}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${o}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${n}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ${o} + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class tA{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,s=t.dilationDepth,o=t.dilationHeight,i=t.dilationWidth,a=t.effectiveFilterDepth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=a-1-t.padInfo.front,f=u-1-t.padInfo.top,h=c-1-t.padInfo.left,p=a*u*c-1;this.userCode=`\n      const ivec3 pads = ivec3(${l}, ${f}, ${h});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${a};\n           wD += ${s}) {\n          float dyD = float(dyDCorner + wD) / ${e}.0;\n\n          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${u};\n              wR += ${o}) {\n            float dyR = float(dyRCorner + wR) / ${n}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${c};\n                wC += ${i}) {\n              float dyC = float(dyCCorner + wC) / ${r}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ${p} -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ${u} * ${c} +\n                  wR * ${c} + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eA={kernelName:"MaxPool3DGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,input:o}=e,i=o,{filterSize:a,strides:u,pad:c,dimRoundingMode:l}=r,f=Jb(i.shape,a,u,[1,1,1],c,l),h=new E_(f,"max",!0),p=n.runWebGLProgram(h,[i],i.dtype),d=new tA(f),m=n.runWebGLProgram(d,[s,p],i.dtype);return n.disposeIntermediateTensorInfo(p),m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nA={kernelName:"MaxPoolGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:s,input:o,output:i}=e,a=o;JN([o,i],"maxPoolGrad");const{filterSize:u,strides:c,pad:l,dimRoundingMode:f}=r,h=Xb(a.shape,u,c,1,l,f),p=new $_(h,"max",!0),d=n.runWebGLProgram(p,[a],a.dtype),m=new Qk(h),y=n.runWebGLProgram(m,[s,d],a.dtype);return n.disposeIntermediateTensorInfo(d),y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const rA={kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{filterSize:s,strides:o,pad:i,includeBatchInIndex:a}=e,u=n;Dp(4===r.shape.length,(()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`));const c=[1,1];Dp(ow(o,c),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`));const l=Xb(r.shape,s,o,c,i),[f,h]=function(t,e,n,r){let s=new $_(n,"max",!1);const o=r.runWebGLProgram(s,[t],"float32");return s=new $_(n,"max",!0,!0,e),[o,r.runWebGLProgram(s,[t],"float32")]}(r,a,l,u);return[f,h]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const sA={kernelName:"Mean",backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{keepDims:s,axis:o}=e,i=n,a=r.shape.length,u=Gp(o,r.shape);let c=u;const l=Ow(c,a),f=null!=l,h=i.shouldExecuteOnCPU([r]),p=[];let d=r;if(f){if(h){const t=i.texData.get(d.dataId).values,e=new Array(a);for(let t=0;t<e.length;t++)e[t]=r.shape[l[t]];const n=tS(t,r.shape,r.dtype,l,e);d=i.makeTensorInfo(e,r.dtype);i.texData.get(d.dataId).values=n}else d=HS(r,l,i);p.push(d),c=Mw(c.length,a)}Cw("sum",c,a);const[m,y]=kw(d.shape,c);let g=m;s&&(g=Aw(m,u));const b=function(t,e,n,r){const s=Bp(e),o=VS({inputs:{x:t},attrs:{shape:[Bp(t.shape)/s,s]},backend:r}),i=jS(o,"float32","mean",r),a=VS({inputs:{x:i},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(i),a}(d,y,g,i);for(const t of p)i.disposeIntermediateTensorInfo(t);return b}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oA={kernelName:"Min",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:o,keepDims:i}=r,a=s.shape.length,u=Gp(o,s.shape);let c=u;const l=Ow(c,a);let f=s;null!=l&&(f=JS({inputs:{x:s},backend:n,attrs:{perm:l}}),c=Mw(c.length,s.shape.length)),Cw("min",c,a);const[h,p]=kw(f.shape,c),d=VS({inputs:{x:f},backend:n,attrs:{shape:[-1,Bp(p)]}}),m=jS(d,d.dtype,"min",n);let y;if(i){y=VS({inputs:{x:m},backend:n,attrs:{shape:Aw(h,u)}})}else y=VS({inputs:{x:m},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),null!=l&&n.disposeIntermediateTensorInfo(f),y}},iA={kernelName:"Minimum",backendName:"webgl",kernelFunc:OS({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:IE})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class aA{constructor(t,e,n){this.variableNames=["x"],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,s=m$(r),o=e.map((t=>t[0])).join(","),i=e.map(((e,n)=>e[0]+t[n])).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u="reflect"===n?0:1;this.userCode=1!==r?`\n      ${s} start = ${s}(${o});\n      ${s} end = ${s}(${i});\n\n      void main() {\n        ${s} outC = getOutputCoords();\n        for (int i = 0; i < ${r}; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ${u};\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};\n          }\n        }\n        ${s} coords = outC - start;\n        setOutput(getX(${a}));\n      }\n    `:`\n        int start = ${o};\n        int end = ${i};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ${u};\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ${u};\n          }\n          setOutput(getX(outC - start));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uA{constructor(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,s=m$(r),o=e.map((t=>t[0])).join(","),i=e.map(((e,n)=>e[0]+t[n])).join(","),a=rS("rc",r),u=rS("source",r),c=`${a[r-1]} < ${this.outputShape[r-1]}`,l=1===r?"source":`vec2(${u.slice(-2).join()})`,f="reflect"===n?0:1;let h="";if(1===r){const t=`\n        ${s} source = rc;\n        if (source < start) {\n          source = start * 2 - source - ${f};\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ${f};\n        }\n        source -= start;\n      `;h=`\n        ${s} rc = outputLoc;\n        ${t}\n        result[0] = getChannel(getX(${u.join()}), ${l});\n        ${a[r-1]} += 1;\n        if(${c}) {\n          ${t}\n          result[1] = getChannel(getX(${u.join()}), ${l});\n        }\n      `}else{const t=`\n        ${s} source = rc;\n        ${s} lt = ${s}(lessThan(source, start));\n        ${s} gte = ${s}(greaterThanEqual(source, end));\n        ${s} orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ${f}) +\n                gte * ((end - 1) * 2 - source + ${f});\n        source -= start;\n      `;h=`\n        ${s} rc = outputLoc;\n        ${t}\n        result[0] = getChannel(getX(${u.join()}), ${l});\n        ${a[r-1]} += 1;\n        if(${c}) {\n          ${t}\n          result[1] = getChannel(getX(${u.join()}), ${l});\n        }\n        rc = outputLoc;\n        ${a[r-2]} += 1;\n        if(${a[r-2]} < ${this.outputShape[r-2]}) {\n          ${t}\n          result[2] = getChannel(getX(${u.join()}), ${l});\n          ${a[r-1]} += 1;\n          if(${c}) {\n            ${t}\n            result[3] = getChannel(getX(${u.join()}), ${l});\n          }\n        }\n      `}this.userCode=`\n      const ${s} start = ${s}(${o});\n      const ${s} end = ${s}(${i});\n\n      void main() {\n        ${s} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${h}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cA={kernelName:"MirrorPad",backendName:"webgl",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r}=t,{paddings:s,mode:o}=n,i=hd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new uA(r.shape,s,o):new aA(r.shape,s,o);return e.runWebGLProgram(i,[r],r.dtype)}},lA={kernelName:"Mod",backendName:"webgl",kernelFunc:OS({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"})};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class fA{constructor(t,e,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,n],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ${e-1}; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(${e-1}));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hA=OS({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),pA={kernelName:"RealDiv",backendName:"webgl",kernelFunc:hA},dA="return a - b;",mA=OS({opSnippet:dA,packedOpSnippet:dA,supportsComplex:!0,cpuKernelImpl:YE}),yA={kernelName:"Sub",backendName:"webgl",kernelFunc:mA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function gA(t){const{inputs:e,backend:n,attrs:r}=t,{logits:s}=e,{dim:o}=r,i=Gp([o],s.shape),a=Kk({inputs:{x:s},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),u=Aw(a.shape,i),c=VS({inputs:{x:a},backend:n,attrs:{shape:u}}),l=mA({inputs:{a:s,b:c},backend:n}),f=ek({inputs:{x:l},backend:n}),h=KS({inputs:{x:f},backend:n,attrs:{axis:i,keepDims:!1}}),p=VS({inputs:{x:h},backend:n,attrs:{shape:u}}),d=hA({inputs:{a:f,b:p},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),d}const bA={kernelName:"Softmax",backendName:"webgl",kernelFunc:gA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wA={kernelName:"Multinomial",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{logits:s}=e,{numSamples:o,seed:i,normalized:a}=r,u=a?s:gA({inputs:{logits:s},backend:n,attrs:{dim:s.shape.length-1}}),c=u.shape[0],l=u.shape[1],f=new fA(c,l,o),h=[[i]],p=n.runWebGLProgram(f,[u],"int32",h);return a||n.disposeIntermediateTensorInfo(u),p}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vA={kernelName:"Neg",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e;if(n.shouldExecuteOnCPU([r])){const t=n.texData.get(r.dataId),[e,s]=RE(t.values,r.shape,r.dtype);return n.makeTensorInfo(s,r.dtype,e)}let s;return s=hd().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new hS(r.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new lS(r.shape,"if (isnan(x)) return x;\n  return -x;\n"),n.runWebGLProgram(s,[r],r.dtype)}},xA=function(t,e,n,r,s){return bx(t,e,n,r,s,0)};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NA={kernelName:"NonMaxSuppressionV3",backendName:"webgl",kernelFunc:function(t){Ud("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:s,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:u}=r,c=n.readSync(s.dataId),l=n.readSync(o.dataId),{selectedIndices:f}=xA(c,l,i,a,u);return n.makeTensorInfo([f.length],"int32",new Int32Array(f))}},$A=function(t,e,n,r,s,o){return bx(t,e,n,r,s,0,!1,o,!0)};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EA={kernelName:"NonMaxSuppressionV4",backendName:"webgl",kernelFunc:function(t){Ud("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:s,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:u,padToMaxOutputSize:c}=r,l=n.readSync(s.dataId),f=n.readSync(o.dataId),{selectedIndices:h,validOutputs:p}=$A(l,f,i,a,u,c);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},SA=function(t,e,n,r,s,o){return bx(t,e,n,r,s,o,!0)};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _A={kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(t){Ud("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:r}=t,{boxes:s,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:u,softNmsSigma:c}=r,l=n.readSync(s.dataId),f=n.readSync(o.dataId),h=i,p=a,d=u,m=c,{selectedIndices:y,selectedScores:g}=SA(l,f,h,p,d,m);return[n.makeTensorInfo([y.length],"int32",new Int32Array(y)),n.makeTensorInfo([g.length],"float32",new Float32Array(g))]}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TA{constructor(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(${r}), float(${n}),\n                      float(index == coords.y)));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kA={kernelName:"OneHot",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{indices:s}=e,{depth:o,onValue:i,offValue:a}=r,u=Bp(s.shape),c=new TA(u,o,i,a),l=VS({inputs:{x:s},backend:n,attrs:{shape:[u]}}),f=n.runWebGLProgram(c,[l],s.dtype);n.disposeIntermediateTensorInfo(l);const h=VS({inputs:{x:f},backend:n,attrs:{shape:[...s.shape,o]}});return n.disposeIntermediateTensorInfo(f),h}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function AA(t){const{inputs:e,backend:n}=t,{x:r}=e;if("complex64"===r.dtype){const t=G_({inputs:{input:r},backend:n}),e=AA({inputs:{x:t},backend:n}),s=oT({inputs:{input:r},backend:n}),o=AA({inputs:{x:s},backend:n}),i=NS({inputs:{real:e,imag:o},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),i}return fk({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}const CA={kernelName:"ZerosLike",backendName:"webgl",kernelFunc:AA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OA={kernelName:"OnesLike",backendName:"webgl",kernelFunc:function t(e){const{inputs:n,backend:r}=e,{x:s}=n;if("string"===s.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===s.dtype){const e=G_({inputs:{input:s},backend:r}),n=t({inputs:{x:e},backend:r}),o=oT({inputs:{input:s},backend:r}),i=AA({inputs:{x:o},backend:r}),a=NS({inputs:{real:n,imag:i},backend:r});return r.disposeIntermediateTensorInfo(e),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(i),a}return fk({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:r})}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IA={kernelName:"Pack",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{axis:s}=r;if(1===e.length)return rk({inputs:{input:e[0]},backend:n,attrs:{dim:s}});const o=e[0].shape,i=e[0].dtype;e.forEach((t=>{Fp(o,t.shape,"All tensors passed to stack must have matching shapes"),Dp(i===t.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const a=[],u=e.map((t=>{const e=rk({inputs:{input:t},backend:n,attrs:{dim:s}});return a.push(e),e})),c=uT({inputs:u,backend:n,attrs:{axis:s}});return a.forEach((t=>n.disposeIntermediateTensorInfo(t))),c}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MA{constructor(t,e,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,s=m$(r),o=e.map((t=>t[0])).join(","),i=e.map(((e,n)=>e[0]+t[n])).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?`\n      ${s} start = ${s}(${o});\n      ${s} end = ${s}(${i});\n\n      void main() {\n        ${s} outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ${s} coords = outC - start;\n          setOutput(getX(${a}));\n        }\n      }\n    `:`\n        int start = ${o};\n        int end = ${i};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RA{constructor(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,s=m$(r),o=e.map((t=>t[0])).join(","),i=e.map(((e,n)=>e[0]+t[n])).join(","),a=rS("rc",r),u=rS("source",r),c=`${a[r-1]} < ${this.outputShape[r-1]}`,l=1===r?"source":`vec2(${u.slice(-2).join()})`,f=[`${s} rc = outputLoc;`,`${a[r-1]} += 1;\n       if(${c}) {\n      `,1===r?"":`}\n       rc = outputLoc;\n       ${a[r-2]} += 1;\n       if(${a[r-2]} < ${this.outputShape[r-2]}) {`,1===r?"":`  ${a[r-1]} += 1;\n         if(${c}) {`],h=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let t=0,e=1===r?2:4;t<e;t++)p+=`\n        ${f[t]}\n        if (${h}) {\n          result[${t}] = float(value);\n        } else {\n          ${s} source = rc - start;\n          result[${t}] = getChannel(getX(${u.join()}), ${l});\n        }\n      `;p+=1===r?"} ":"}}",this.userCode=`\n      const ${s} start = ${s}(${o});\n      const ${s} end = ${s}(${i});\n\n      void main() {\n        ${s} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${p}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DA=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{paddings:o,constantValue:i}=r;if(0===Bp(s.shape)){const t=o.map(((t,e)=>t[0]+s.shape[e]+t[1]));return fk({backend:n,attrs:{shape:t,value:i,dtype:s.dtype}})}const a=hd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new RA(s.shape,o,i):new MA(s.shape,o,i),u=[[i]];return n.runWebGLProgram(a,[s],s.dtype,u)},FA={kernelName:"PadV2",backendName:"webgl",kernelFunc:DA},LA={kernelName:"Pow",backendName:"webgl",kernelFunc:OS({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"})};const PA={kernelName:"Prod",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{axis:o,keepDims:i}=r,a=s.shape.length,u=[],c=Gp(o,s.shape);let l=c;const f=Ow(l,a);let h,p=s;if(null!=f&&(p=JS({inputs:{x:s},backend:n,attrs:{perm:f}}),l=Mw(l.length,a),u.push(p)),Cw("prod",l,a),n.shouldExecuteOnCPU([p])){const t=n.texData.get(p.dataId).values,{outVals:e,outShape:r,outDtype:s}=FE(p.shape,p.dtype,t,l);h=n.makeTensorInfo(r,s,e)}else{const[t,e]=kw(p.shape,l),r=Bp(e),o=VS({inputs:{x:p},backend:n,attrs:{shape:[-1,r]}}),i=jS(o,ay(s.dtype),"prod",n);h=VS({inputs:{x:i},backend:n,attrs:{shape:t}}),u.push(o),u.push(i)}if(i){u.push(h);const t=Aw(h.shape,c);h=VS({inputs:{x:h},backend:n,attrs:{shape:t}})}return u.forEach((t=>n.disposeIntermediateTensorInfo(t))),h}},BA=t=>{const{backend:e,attrs:n}=t,{start:r,stop:s,step:o,dtype:i}=n,a=LE(r,s,o,i);return e.makeTensorInfo([a.length],i,a)},VA={kernelName:"Range",backendName:"webgl",kernelFunc:BA},zA={kernelName:"Reciprocal",backendName:"webgl",kernelFunc:CS({opSnippet:"return 1.0 / x;"})},WA={kernelName:"Relu",backendName:"webgl",kernelFunc:CS({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"})},UA={kernelName:"Relu6",backendName:"webgl",kernelFunc:CS({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class jA{constructor(t,e,n,r,s){this.variableNames=["A"],this.outputShape=[];const[o,i,a,u]=t;this.outputShape=[o,e,n,u];const c=[r&&e>1?i-1:i,r&&n>1?a-1:a],l=[r&&e>1?e-1:e,r&&n>1?n-1:n];let f;f=s?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${c[0]/l[0]},\n          ${c[1]/l[1]});\n      const vec2 inputShapeRC = vec2(${i}.0, ${a}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${f};\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GA{constructor(t,e,n,r,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,i,a,u]=t;this.outputShape=[o,e,n,u];const c=[r&&e>1?i-1:i,r&&n>1?a-1:a],l=[r&&e>1?e-1:e,r&&n>1?n-1:n];let f;f=s?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${c[0]/l[0]},\n          ${c[1]/l[1]},\n          ${c[1]/l[1]});\n      const vec3 inputShapeRC = vec3(${i}.0, ${a}.0,\n                                     ${a}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${f};\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${u-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qA={kernelName:"ResizeBilinear",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:s}=e,{alignCorners:o,halfPixelCenters:i,size:a}=r,[u,c]=a,l=hd().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new GA(s.shape,u,c,o,i):new jA(s.shape,u,c,o,i);return n.runWebGLProgram(l,[s],"float32")}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HA{constructor(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,r,s]=e,[,o,i]=t,a=[n&&o>1?r-1:r,n&&i>1?s-1:s],u=[n&&o>1?o-1:o,n&&i>1?i-1:i],c=a[0]/u[0],l=a[1]/u[1],f=1/c,h=1/l,p=2*Math.ceil(f)+2,d=2*Math.ceil(h)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${c});\n        const float widthScale = float(${l});\n\n        const float invHeightScale = float(${f});\n        const float invWidthScale = float(${h});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${d});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${o}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${i}) {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ${s-1}.0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KA={kernelName:"ResizeBilinearGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:s,dy:o}=e,{alignCorners:i}=r,a=new HA(o.shape,s.shape,i);return n.runWebGLProgram(a,[o],o.dtype)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XA{constructor(t,e,n,r,s){this.variableNames=["A"],this.outputShape=[];const[o,i,a,u]=t;this.outputShape=[o,e,n,u];const c=[r&&e>1?i-1:i,r&&n>1?a-1:a],l=[r&&e>1?e-1:e,r&&n>1?n-1:n],f=r?"0.5":"0.0";let h;h=s?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${c[0]/l[0]},\n          ${c[1]/l[1]});\n      const vec2 inputShapeRC = vec2(${i}.0, ${a}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${h};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JA{constructor(t,e,n,r,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,i,a,u]=t;this.outputShape=[o,e,n,u];const c=[r&&e>1?i-1:i,r&&n>1?a-1:a],l=[r&&e>1?e-1:e,r&&n>1?n-1:n],f=r?"0.5":"0.0";let h;h=s?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${c[0]/l[0]},\n          ${c[1]/l[1]},\n          ${c[1]/l[1]});\n      const vec3 inputShapeRC = vec3(${i}.0, ${a}.0,\n                                     ${a}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${h};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${u-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YA={kernelName:"ResizeNearestNeighbor",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:s}=e,{alignCorners:o,halfPixelCenters:i,size:a}=r,[u,c]=a,l=hd().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new JA(s.shape,u,c,o,i):new XA(s.shape,u,c,o,i);return n.runWebGLProgram(l,[s],s.dtype)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZA{constructor(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,r,s]=e,[,o,i]=t,a=[n&&o>1?r-1:r,n&&i>1?s-1:s],u=[n&&o>1?o-1:o,n&&i>1?i-1:i],c=a[0]/u[0],l=a[1]/u[1],f=1/c,h=1/l,p=2*Math.ceil(f)+2,d=2*Math.ceil(h)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${c});\n        const float widthScale = float(${l});\n\n        const float invHeightScale = float(${f});\n        const float invWidthScale = float(${h});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${d});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${o}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${i}) {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(${a[0]}) *\n                (float(dyR) / float(${u[0]}));\n\n            float sourceFracCol =\n                float(${a[1]}) *\n                  (float(dyC) / float(${u[1]}));\n\n            int sourceNearestRow = int(min(\n                float(int(${r}) - 1),\n                ${n} ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(${s}) - 1),\n                ${n} ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QA={kernelName:"ResizeNearestNeighborGrad",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:s,dy:o}=e,{alignCorners:i}=r,a=new ZA(o.shape,s.shape,i);return n.runWebGLProgram(a,[o],o.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tC{constructor(t,e){this.variableNames=["x"];const n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=t,1===n)return void(this.userCode=`\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(${t[0]} - coord - 1));\n        }\n      `);const r=t.map(((n,r)=>(n=>-1!==e.indexOf(n)&&1!==t[n]?`${t[n]} - coords[${n}] - 1`:`coords[${n}]`)(r))).join(","),s=m$(n);this.userCode=`\n      void main() {\n        ${s} coords = getOutputCoords();\n        setOutput(getX(${r}));\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eC{constructor(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=t;const r=rS("rc",n),s=`${r[n-1]} + 1 < ${this.outputShape[n-1]}`,o=`${r[n-2]} + 1 < ${this.outputShape[n-2]}`,i=m$(n);function a(n){const r=t.map(((r,s)=>function(n,r){return-1!==e.indexOf(n)&&1!==t[n]?`${t[n]} - ${r[n]} - 1`:`${r[n]}`}(s,n)));return`getChannel(getX(${r.join(",")}), vec2(${r.slice(-2).join(",")}))`}this.userCode=1===n?`\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(${t[0]} - rc - 1),\n            ${t[0]} - rc - 1);\n          if(${s}){\n              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),\n                ${t[0]} - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      `:`\n        void main() {\n          ${i} rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ${function(t){return a(t)}(r.slice())};\n          if(${s}){\n            result.g = ${function(t){return t[n-1]="("+t[n-1]+" + 1)",a(t)}(r.slice())};\n          }\n          if(${o}) {\n            result.b = ${function(t){return t[n-2]="("+t[n-2]+" + 1)",a(t)}(r.slice())};\n            if(${s}) {\n              result.a = ${function(t){return t[n-1]="("+t[n-1]+" + 1)",t[n-2]="("+t[n-2]+" + 1)",a(t)}(r.slice())};\n            }\n          }\n          setOutput(result);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nC={kernelName:"Reverse",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{dims:o}=r,i=s.shape.length,a=Gp(o,s.shape);if(0===i)return vS({inputs:{x:s},backend:n});const u=hd().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new eC(s.shape,a):new tC(s.shape,a);return n.runWebGLProgram(u,[s],s.dtype)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rC{constructor(t,e){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const n=t[1],r=t[2];this.outputShape=t;let s="";s="number"==typeof e?`float outputValue = ${e.toFixed(2)};`:`\n        vec3 fill = vec3(${e.join(",")});\n        float outputValue = fill[coords[3]];`,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ${s}\n          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${n}) {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sC={kernelName:"RotateWithOffset",backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,{radians:s,fillValue:o,center:i}=e,a=n,u=new rC(r.shape,o),[c,l]=Lx(i,r.shape[1],r.shape[2]),f=[[c,l,Math.sin(s),Math.cos(s)]];return a.runWebGLProgram(u,[r],r.dtype,f)}},oC={kernelName:"Round",backendName:"webgl",kernelFunc:CS({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"})},iC={kernelName:"Rsqrt",backendName:"webgl",kernelFunc:CS({opSnippet:"return inversesqrt(x);",cpuKernelImpl:PE})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class aC{constructor(t,e,n,r,s,o,i=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const a=m$(s.length),u=m$(o.length);let c="";1===n?c="i":2===n&&(c="i, j");const l=`getIndices(${c})`;let f="";1===r?f="i":2===r&&(f="i, coords[1]");const h=`getUpdates(${f})`,p=e>1?"strides[j]":"strides";this.userCode=`\n        ${a} strides = ${a}(${s});\n\n        void main() {\n          ${u} coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ${t}; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ${e}; j++) {\n              int index = round(${l});\n              flattenedIndex += index * ${p};\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ${h};\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uC={kernelName:"ScatterNd",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{indices:s,updates:o}=e,{shape:i}=r,{sliceRank:a,numUpdates:u,sliceSize:c,strides:l,outputSize:f}=Eb(0,s,i),h=[f/c,c];if(0===f)return n.makeTensorInfo(i,s.dtype);const p=VS({inputs:{x:s},backend:n,attrs:{shape:[u,a]}}),d=VS({inputs:{x:o},backend:n,attrs:{shape:[u,c]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0])),y=new aC(u,a,p.shape.length,d.shape.length,l,h),g=n.runWebGLProgram(y,[d,p,m],d.dtype),b=VS({inputs:{x:g},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),b}};
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cC{constructor(t,e,n,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,n];const s=`for (int i = 0; i < ${Math.ceil(Math.log2(e+1))}; ++i) { if (left >= right) break;`,o=2===hd().getNumber("WEBGL_VERSION")?"while (left < right) {":s,i="left"===r?"<":"<=";this.userCode=`\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ${o}\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ${i} value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     `}}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lC={kernelName:"SearchSorted",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{sortedSequence:s,values:o}=e,{side:i}=r,a=new cC(s.shape[0],s.shape[1],o.shape[1],i),u=[[s.shape[1]]];return n.runWebGLProgram(a,[s,o],"int32",u)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fC{constructor(t,e,n){let r,s;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error(`Where for rank ${n} is not yet supported`);if(1===n)s="resRC",r="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],i=[];for(let r=0;r<e.length;r++)i.push(`${n[r]}`),r<t&&o.push(`${n[r]}`);r=o.join(),s=i.join()}const o=m$(n);this.userCode=`\n      void main() {\n        ${o} resRC = getOutputCoords();\n        float cVal = getC(${r});\n        if (cVal >= 1.0) {\n          setOutput(getA(${s}));\n        } else {\n          setOutput(getB(${s}));\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hC={kernelName:"Select",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{condition:r,t:s,e:o}=e,i=new fC(r.shape.length,s.shape,s.shape.length);return n.runWebGLProgram(i,[r,s,o],iy(s.dtype,o.dtype))}},pC={kernelName:"Selu",backendName:"webgl",kernelFunc:CS({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n"})},dC={kernelName:"Sigmoid",backendName:"webgl",kernelFunc:CS({opSnippet:"if (isnan(x)) return x;\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:VE})},mC={kernelName:"Sign",backendName:"webgl",kernelFunc:CS({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"})},yC={kernelName:"Sin",backendName:"webgl",kernelFunc:CS({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n"})},gC={kernelName:"Sinh",backendName:"webgl",kernelFunc:CS({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"})},bC={kernelName:"Softplus",backendName:"webgl",kernelFunc:CS({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"})},wC={kernelName:"SpaceToBatchND",backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{blockShape:o,paddings:i}=r;Dp(s.shape.length<=4,(()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"));const a=o.reduce(((t,e)=>t*e)),u=[[0,0]];u.push(...i);for(let t=1+o.length;t<s.shape.length;++t)u.push([0,0]);const c=[],l=DA({inputs:{x:s},backend:n,attrs:{paddings:u,constantValue:0}}),f=Px(l.shape,o,a,!1),h=Bx(f.length,o.length,!1),p=Vx(l.shape,o,a,!1),d=VS({inputs:{x:l},backend:n,attrs:{shape:f}}),m=JS({inputs:{x:d},backend:n,attrs:{perm:h}}),y=VS({inputs:{x:m},backend:n,attrs:{shape:p}});return c.push(l),c.push(d),c.push(m),c.forEach((t=>n.disposeIntermediateTensorInfo(t))),y}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vC={kernelName:"SparseFillEmptyRows",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const{inputs:e,backend:n}=t,{indices:r,values:s,denseShape:o,defaultValue:i}=e;if(1!==o.shape.length)throw new Error(`Dense shape must be a vector, saw:\n         ${o.shape}`);if(2!==r.shape.length)throw new Error(`Indices must be a matrix, saw:\n         ${r.shape}`);if(1!==s.shape.length)throw new Error(`Values must be a vector, saw:\n         ${s.shape}`);if(0!==i.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${i.shape}`);const a=n.readSync(r.dataId),u=n.readSync(s.dataId),c=n.readSync(o.dataId),l=n.readSync(i.dataId)[0],[f,h,p,d,m]=UE(a,r.shape,r.dtype,u,s.dtype,c,l);return[n.makeTensorInfo(h,r.dtype,f),n.makeTensorInfo([h[0]],s.dtype,p),n.makeTensorInfo([d.length],"bool",new Uint8Array(d.map((t=>Number(t))))),n.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xC={kernelName:"SparseReshape",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{inputIndices:r,inputShape:s,newShape:o}=e;if(2!==r.shape.length)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(1!==s.shape.length)throw new Error(`Input shape should be a vector but received shape ${s.shape}`);if(1!==o.shape.length)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(n.readSync(s.dataId)),a=n.readSync(r.dataId),u=Array.from(n.readSync(o.dataId)),[c,l,f]=jE(a,r.shape,r.dtype,i,u);return[n.makeTensorInfo(l,r.dtype,c),n.makeTensorInfo([f.length],o.dtype,new Int32Array(f))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NC={kernelName:"SparseSegmentMean",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:s,segmentIds:o}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.shape.length)throw new Error(`Indices should be a vector but received shape\n              ${s.shape}`);if(1!==o.shape.length)throw new Error(`Segment ids should be a vector but received shape\n              ${o.shape}`);const i=n.readSync(r.dataId),a=n.readSync(s.dataId),u=n.readSync(o.dataId),[c,l]=GE(i,r.shape,r.dtype,a,u,!0);return n.makeTensorInfo(l,r.dtype,c)}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $C={kernelName:"SparseSegmentSum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:s,segmentIds:o}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.shape.length)throw new Error(`Indices should be a vector but received shape\n             ${s.shape}`);if(1!==o.shape.length)throw new Error(`Segment ids should be a vector but received shape\n             ${o.shape}`);const i=n.readSync(r.dataId),a=n.readSync(s.dataId),u=n.readSync(o.dataId),[c,l]=GE(i,r.shape,r.dtype,a,u);return n.makeTensorInfo(l,r.dtype,c)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EC={kernelName:"SparseToDense",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{sparseIndices:s,sparseValues:o,defaultValue:i}=e,{outputShape:a}=r,{sliceRank:u,numUpdates:c,sliceSize:l,strides:f,outputSize:h}=Eb(0,s,a);if("string"===o.dtype){const t=n.bufferSync(s),e=n.bufferSync(o),r=Vm(n.readSync(i.dataId)[0]),p=BE(t,e,a,h,l,c,u,f,r,false);return n.makeTensorInfo(a,p.dtype,p.values)}const p=new aC(c,u,s.shape.length,o.shape.length,f,[h,1],false),d=n.runWebGLProgram(p,[o,s,i],o.dtype),m=VS({inputs:{x:d},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(d),m}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SC={kernelName:"SplitV",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{numOrSizeSplits:o,axis:i}=r,a=Gp(i,s.shape)[0],u=Yx(s,o,a),c=s.shape.length,l=new Array(c).fill(0),f=s.shape.slice();return u.map((t=>{const e=[...f];e[a]=t;const r=P_({inputs:{x:s},backend:n,attrs:{begin:l,size:e}});return l[a]+=t,r}))}},_C="return sqrt(x);",TC={kernelName:"Sqrt",backendName:"webgl",kernelFunc:CS({opSnippet:_C,packedOpSnippet:_C,cpuKernelImpl:qE})},kC={kernelName:"Square",backendName:"webgl",kernelFunc:CS({opSnippet:"return x * x;"})},AC={kernelName:"SquaredDifference",backendName:"webgl",kernelFunc:OS({opSnippet:"return (a - b) * (a - b);",packedOpSnippet:"return (a - b) * (a - b);"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CC={kernelName:"Step",backendName:"webgl",kernelFunc:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function({inputs:t,attrs:e,backend:n}){const{x:r}=t,s=`if (isnan(x)) return x;\n    return x > 0.0 ? 1.0 : float(${e.alpha});\n  `,o=new lS(r.shape,s);return n.runWebGLProgram(o,[r],r.dtype)}};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OC{constructor(t,e,n){this.variableNames=["x"],this.outputShape=n;const r=n.length,s=m$(n.length),o=m$(n.length);let i="";if(1===r)i="coords * strides + begin";else{let t=0;i=n.map(((e,r)=>(t++,1===n.length?`coords * strides[${r}] + begin[${r}]`:`coords[${t-1}] * strides[${r}] + begin[${r}]`))).join(",")}this.userCode=`\n      ${s} begin = ${s}(${t});\n      ${s} strides = ${s}(${e});\n\n      void main() {\n        ${o} coords = getOutputCoords();\n        setOutput(getX(${i}));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IC={kernelName:"StridedSlice",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{begin:o,end:i,strides:a,beginMask:u,endMask:c,ellipsisMask:l,newAxisMask:f,shrinkAxisMask:h}=r,{finalShapeSparse:p,finalShape:d,isIdentity:m,sliceDim0:y,isSimpleSlice:g,begin:b,end:w,strides:v}=Pb(s.shape,o,i,a,u,c,l,f,h);let x;if(m)x=VS({inputs:{x:s},backend:n,attrs:{shape:d}});else if(y||g){Dp(s.shape.length>=1,(()=>`Input must have rank at least 1, got: ${s.shape.length}`));const t=_b(b,w,v),e=P_({inputs:{x:s},backend:n,attrs:{begin:b,size:t}});x=VS({inputs:{x:e},backend:n,attrs:{shape:d}}),n.disposeIntermediateTensorInfo(e)}else{if(n.shouldExecuteOnCPU([s])){const t=n.readSync(s.dataId),e=Zg(s.shape,s.dtype,t),r=HE(p,e,v,b);x=n.makeTensorInfo(d,s.dtype,r.values)}else{const t=new OC(b,v,p);x=n.runWebGLProgram(t,[s],s.dtype)}}const N=VS({inputs:{x},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(x),N}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MC={kernelName:"StringNGrams",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{separator:s,nGramWidths:o,leftPad:i,rightPad:a,padWidth:u,preserveShortSequences:c}=r,{data:l,dataSplits:f}=e,h=n.readSync(l.dataId),p=n.readSync(f.dataId),[d,m]=KE(h,p,s,o,i,a,u,c);return[n.makeTensorInfo([d.length],"string",d),n.makeTensorInfo(f.shape,"int32",m)]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RC={kernelName:"StringSplit",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{skipEmpty:s}=r,{input:o,delimiter:i}=e;if("string"!==o.dtype)throw new Error("Input must be of datatype string");if(1!==o.shape.length)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(0!==i.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=n.readSync(o.dataId),u=n.readSync(i.dataId)[0],[c,l,f]=XE(a,u,s),h=l.length;return[n.makeTensorInfo([h,2],"int32",c),n.makeTensorInfo([h],"string",l),n.makeTensorInfo([2],"int32",new Int32Array(f))]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DC={kernelName:"StringToHashBucketFast",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{numBuckets:s}=r,{input:o}=e;if("string"!==o.dtype)throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const i=n.readSync(o.dataId),a=JE(i,s);return n.makeTensorInfo(o.shape,"int32",a)}},FC={kernelName:"Tan",backendName:"webgl",kernelFunc:CS({opSnippet:"return tan(x);"})},LC={kernelName:"Tanh",backendName:"webgl",kernelFunc:CS({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"})};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class PC{constructor(t,e){this.variableNames=["A"];const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;const r=m$(this.rank),s=function(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(1===e)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let e=0;e<t.length;e++)r.push(`imod(${n[e]}, ${t[e]})`);return r.join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t);this.userCode=`\n      void main() {\n        ${r} resRC = getOutputCoords();\n        setOutput(getA(${s}));\n      }\n    `}}function BC(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{reps:o}=r;if("string"===s.dtype||s.shape.length>5){const t=n.readSync(s.dataId),e="string"===s.dtype?t.map((t=>Vm(t))):t,r=Zg(s.shape,s.dtype,e),i=ZE(r,o);return n.makeTensorInfo(i.shape,i.dtype,i.values)}const i=new PC(s.shape,o);return n.runWebGLProgram(i,[s],s.dtype)}const VC={kernelName:"Tile",backendName:"webgl",kernelFunc:BC};class zC{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "}}class WC{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UC(t,e){null!==e&&t.disposeIntermediateTensorInfo(e)}function jC(t){let e=1;for(;e<t;)e*=2;return e}const GC={kernelName:"TopK",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s}=e,{k:o,sorted:i}=r,a=hd().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=hd().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=s.shape,l=c[c.length-1];if(n.shouldExecuteOnCPU([s])||l<a||o>u){const t=n.readSync(s.dataId),[e,r]=QE(t,c,s.dtype,o,i);return[n.makeTensorInfo(e.shape,e.dtype,e.values),n.makeTensorInfo(r.shape,r.dtype,r.values)]}if(0===o)return c[c.length-1]=0,[n.makeTensorInfo(c,s.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(1===l)return[s,fk({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const f=n.texData.get(s.dataId),h=null!==f&&f.isPacked,p=h?n.unpackTensor(s):s,d=Bp(c)/l,m=VS({inputs:{x:p},attrs:{shape:[d,l]},backend:n});h&&UC(n,p);const y=jC(o),g=jC(l);let b=null;const w=()=>null===b?[m,m]:[m,b],v=(t,e,r)=>{const s=w(),o=new zC(r),i=[[l],[null===b?1:0],[Number.NEGATIVE_INFINITY],[t],[e]],a=b;b=n.runWebGLProgram(o,s,"int32",i),UC(n,a)};for(let t=1;t<y;t*=2){const e=2*t;for(let n=t;n>=1;n/=2)v(e,n,[d,g])}for(let t=g;t>y;t/=2){const e=w(),r=new WC([d,t/2]),s=[[l],[null===b?1:0],[y]],o=b;b=n.runWebGLProgram(r,e,"int32",s),UC(n,o);const i=y/2,a=2*i;for(let t=i;t>=1;t/=2)v(a,t,b.shape)}let x=b;b=P_({inputs:{x:b},backend:n,attrs:{begin:0,size:[d,o]}}),UC(n,x);let N=Tk({inputs:{x:m,indices:b},backend:n,attrs:{axis:1,batchDims:1}});UC(n,m);const $=c.slice(0,-1);$.push(o),x=b,b=VS({inputs:{x:b},attrs:{shape:$},backend:n}),UC(n,x);const E=N;return N=VS({inputs:{x:N},attrs:{shape:$},backend:n}),UC(n,E),[N,b]}};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qC{constructor(t,e,n,r,s,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const i="nearest"===n?1:2;let a;switch(r){case"constant":default:a=1;break;case"reflect":a=2;break;case"wrap":a=3;break;case"nearest":a=4}this.userCode=`\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(${a} == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${a} == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${a} == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${e}) {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(${s});\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(${s});\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(${e}));\n                float mapY = mapCoord(inY, float(${t}));\n\n                if (${i} == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        `}}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HC={kernelName:"Transform",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{image:s,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:u,outputShape:c}=r,[l,f,h,p]=s.shape,[d,m]=null!=c?c:[f,h],y=new qC(f,h,i,a,u,[l,d,m,p]);return n.runWebGLProgram(y,[s,o],"float32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KC={kernelName:"Unique",backendName:"webgl",kernelFunc:function(t){const{inputs:e,attrs:n,backend:r}=t,{axis:s}=n,{x:o}=e;JN(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const i=r.readSync(o.dataId),{outputValues:a,outputShape:u,indices:c}=eS(i,s,o.shape,o.dtype);return[r.makeTensorInfo(u,o.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XC={kernelName:"Unpack",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{value:s}=e;let{axis:o}=r;o<0&&(o+=s.shape.length);const i=s,a=i.shape.length,u=s.shape[o],c=new Array(a-1);let l=0;for(let t=0;t<a;t++)t!==o&&(c[l++]=i.shape[t]);const f=[],h=new Array(a).fill(0),p=i.shape.slice();p[o]=1;const d=new Array(u);for(let t=0;t<d.length;t++){h[o]=t;const e=P_({inputs:{x:i},backend:n,attrs:{begin:h,size:p}}),r=VS({inputs:{x:e},backend:n,attrs:{shape:c}});d[t]=r,f.push(e)}return f.forEach((t=>n.disposeIntermediateTensorInfo(t))),d}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JC{constructor(t,e){this.variableNames=["x","segmentIds"];const n=t.windowSize,r=t.batchSize,s=t.inSize,o=t.numSegments,i=o*Math.ceil(s/n);this.outputShape=[r,i];const a=4*Math.floor(n/4),u=n%4,c="\n        sumValue += dot(values, segFilter);\n    ";let l="";s%n>0&&(l=`\n        if (inIdx < 0 || inIdx >= ${s}) {\n          return initializationValue;\n        }\n      `);let f="";s%n>0&&(f=`\n        if (inIdx < 0 || inIdx >= ${s}) {\n          return -1.0;\n        }\n      `),this.userCode=`\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ${l}\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ${f}\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ${o})) * float(${n}));\n        int currentSeg = int(mod(float(outIdx), float(${o})));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${a}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ${c}\n        }\n\n        int inIdx = inOffset + ${a};\n        if (${1===u}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ${c}\n        } else if (${2===u}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ${c}\n        } else if (${3===u}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ${c}\n        }\n        setOutput(sumValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YC={kernelName:"UnsortedSegmentSum",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:s,segmentIds:o}=e,{numSegments:i}=r,a=s.shape.length,u=[];let c=0;const l=Ow([c],a);let f=s;null!=l&&(f=JS({inputs:{x:s},backend:n,attrs:{perm:l}}),u.push(f),c=Mw(1,a)[0]);const h=fN(f.shape,c,i),p=Bp([f.shape[c]]),d=VS({inputs:{x:f},backend:n,attrs:{shape:[-1,p]}});u.push(d);const m=ay(s.dtype),y=(t,e,r,s,o)=>{const i=t.shape[0],a=t.shape[1],c=lN(a,o),l=new JC({windowSize:c,inSize:a,batchSize:i,numSegments:o},e),f=n.compileAndRun(l,[t,r],s);if(u.push(f),f.shape[1]===o)return f;const h=BA({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),p=BC({inputs:{x:h},backend:n,attrs:{reps:[a/c]}});u.push(h),u.push(p);return y(f,e,p,s,o)},g=VS({inputs:{x:y(d,"unsortedSegmentSum",o,m,i)},backend:n,attrs:{shape:h}});let b=g;if(null!=l){u.push(g);const t=Iw(l);b=JS({inputs:{x:b},backend:n,attrs:{perm:t}})}return u.forEach((t=>n.disposeIntermediateTensorInfo(t))),b}},ZC=[QS,e_,n_,r_,o_,u_,c_,l_,y_,g_,b_,w_,v_,x_,N_,S_,__,A_,C_,O_,R_,V_,z_,W_,H_,X_,Z_,$S,eT,cT,mT,vT,xT,NT,$T,ET,ST,_T,kT,RT,DT,FT,PT,zT,jT,GT,HT,XT,JT,YT,ZT,QT,tk,nk,sk,ik,ck,hk,dk,yk,gk,vk,Nk,$k,Sk,kk,Ak,Ck,xS,Ok,iT,Ik,Mk,Rk,_S,Dk,Fk,Lk,Pk,Bk,Vk,zk,Wk,Gk,Hk,Xk,Jk,Yk,Zk,eA,nA,rA,sA,oA,iA,cA,lA,wA,BS,vA,NA,EA,_A,j_,kA,OA,IA,FA,LA,AS,PA,VA,q_,pA,zA,WA,UA,zS,qA,KA,YA,QA,nC,sC,oC,iC,uC,lC,hC,pC,dC,mC,yC,gC,B_,bA,bC,wC,vC,xC,NC,$C,EC,SC,TC,kC,AC,CC,IC,MC,RC,DC,yA,XS,FC,LC,VC,GC,HC,YS,KC,XC,YC,CA];
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */for(const t of ZC)Xd(t);
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
var QC,tO;let eO;hd().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"}(QC||(QC={})),function(t){var e;(e=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(tO||(tO={}));const nO=Tp.PART_CHANNELS;class rO extends o{get poseType(){return"bodypix"}get parts(){return nO}async onMetadata(){super.onMetadata(),await async function(){eO&&(eO.dispose(),eO=void 0),eO=await Tp.load({architecture:"MobileNetV1",outputStride:16,multiplier:.5,quantBytes:2})}(),this.poseDetectionFrame()}async poseDetectionFrame(){if((this.isPlaying||this.forceOneTimePoseProcess)&&this.videoEl.readyState>1){const t=await async function(t,e=0,n=0){const r=[];if(eO){const s=await eO.segmentPersonParts(t.videoElement,{internalResolution:"medium",segmentationThreshold:.7,maxDetections:1,scoreThreshold:.3,nmsRadius:20});s&&s.allPoses.forEach(((s,o)=>{const i={time:Date.now()-e,score:s.score,pose:o,points:[],aspectRatio:t.aspectRatio};s.keypoints.forEach((e=>{e.score>=n&&i.points.push({name:e.part,score:e.score,position:[e.position.x/t.videoElement.width,e.position.y/t.videoElement.height]})})),r.push(i)}))}return r}(this,this.recordingStartTime,this.minConfidence/100);this.onPoseFrame(t),this.forceOneTimePoseProcess=!1}requestAnimationFrame((()=>this.poseDetectionFrame()))}}customElements.define("bodypix-video",rO);function sO(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oO(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function iO(t,e,n=""){oO(lO(t,e),(()=>n+` Shapes ${t} and ${e} must match`))}function aO(t){oO(null!=t,(()=>"The input to the tensor constructor must be a non-null value."))}function uO(t,e=[],n=!1){if(null==e&&(e=[]),Array.isArray(t)||dO(t)&&!n)for(let r=0;r<t.length;++r)uO(t[r],e,n);else e.push(t);return e}function cO(t){if(0===t.length)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function lO(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function fO(t){return t%1==0}function hO(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function pO(t,e){const n=e.length;return t=null==t?e.map(((t,e)=>e)):[].concat(t),oO(t.every((t=>t>=-n&&t<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`)),oO(t.every((t=>fO(t))),(()=>`All values in axis param must be integers but got axis ${t}`)),t.map((t=>t<0?n+t:t))}function dO(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function mO(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error(`Unknown dtype ${t}`)}function yO(t){return"string"==typeof t||t instanceof String}function gO(t){return Array.isArray(t)?gO(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":"number"==typeof t?"float32":yO(t)?"string":function(t){return"boolean"==typeof t}(t)?"bool":"float32"}function bO(t){return!!(t&&t.constructor&&t.call&&t.apply)}function wO(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function vO(t,e,n,r=!1){const s=new Array;if(1===e.length){const o=e[0]*(r?2:1);for(let e=0;e<o;e++)s[e]=n[t+e]}else{const o=e[0],i=e.slice(1),a=i.reduce(((t,e)=>t*e))*(r?2:1);for(let e=0;e<o;e++)s[e]=vO(t+e*a,i,n,r)}return s}function xO(t,e,n=!1){if(0===t.length)return e[0];const r=t.reduce(((t,e)=>t*e))*(n?2:1);if(0===r)return[];if(r!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return vO(0,t,e,n)}function NO(t,e){const n=$O(t,e);for(let t=0;t<n.length;t++)n[t]=1;return n}function $O(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function EO(t){t.forEach((e=>{oO(Number.isInteger(e)&&e>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`))}))}function SO(t){return t&&t.then&&"function"==typeof t.then}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _O{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=TO,this.populateURLFlags()}setPlatform(t,e){null!=this.platform&&(kO().getBool("IS_TEST")||kO().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=e}registerFlag(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){const e=this.urlFlags[t];kO().getBool("IS_TEST")||kO().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${e}.`),this.set(t,e)}}async getAsync(t){return t in this.flags||(this.flags[t]=await this.evaluateFlag(t)),this.flags[t]}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(SO(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(null==this.flagRegistry[t])throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(null==this.flagRegistry[t])throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const t=this.getQueryParams(this.global.location.search);if("tfjsflags"in t){t.tfjsflags.split(",").forEach((t=>{const[e,n]=t.split(":");this.urlFlags[e]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}(e,n)}))}}}function TO(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((t,...n)=>(function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")))),e}function kO(){return AO}let AO=null;var CO="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function OO(){throw new Error("setTimeout has not been defined")}function IO(){throw new Error("clearTimeout has not been defined")}var MO=OO,RO=IO;function DO(t){if(MO===setTimeout)return setTimeout(t,0);if((MO===OO||!MO)&&setTimeout)return MO=setTimeout,setTimeout(t,0);try{return MO(t,0)}catch(e){try{return MO.call(null,t,0)}catch(e){return MO.call(this,t,0)}}}"function"==typeof CO.setTimeout&&(MO=setTimeout),"function"==typeof CO.clearTimeout&&(RO=clearTimeout);var FO,LO=[],PO=!1,BO=-1;function VO(){PO&&FO&&(PO=!1,FO.length?LO=FO.concat(LO):BO=-1,LO.length&&zO())}function zO(){if(!PO){var t=DO(VO);PO=!0;for(var e=LO.length;e;){for(FO=LO,LO=[];++BO<e;)FO&&FO[BO].run();BO=-1,e=LO.length}FO=null,PO=!1,function(t){if(RO===clearTimeout)return clearTimeout(t);if((RO===IO||!RO)&&clearTimeout)return RO=clearTimeout,clearTimeout(t);try{RO(t)}catch(e){try{return RO.call(null,t)}catch(e){return RO.call(this,t)}}}(t)}}function WO(t,e){this.fun=t,this.array=e}WO.prototype.run=function(){this.fun.apply(null,this.array)};function UO(){}var jO=UO,GO=UO,qO=UO,HO=UO,KO=UO,XO=UO,JO=UO;var YO=CO.performance||{},ZO=YO.now||YO.mozNow||YO.msNow||YO.oNow||YO.webkitNow||function(){return(new Date).getTime()};var QO=new Date;var tI={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];LO.push(new WO(t,e)),1!==LO.length||PO||DO(zO)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:jO,addListener:GO,once:qO,off:HO,removeListener:KO,removeAllListeners:XO,emit:JO,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*ZO.call(YO),n=Math.floor(e),r=Math.floor(e%1*1e9);return t&&(n-=t[0],(r-=t[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-QO)/1e3}},eI=tI;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
let nI;function rI(){if(null==nI){let t;if("undefined"!=typeof window)t=window;else if(void 0!==CO)t=CO;else if(void 0!==eI)t=eI;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}nI=t}return nI}function sI(t,e){const n=function(){const t=rI();return null==t._tfGlobals&&(t._tfGlobals=new Map),t._tfGlobals}();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function oI(...t){kO().getBool("IS_TEST")||kO().getBool("PROD")||console.warn(...t)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iI=sI("kernelRegistry",(()=>new Map)),aI=sI("gradRegistry",(()=>new Map));function uI(t,e){const n=function(t,e){return`${e}_${t}`}(t,e);return iI.get(n)}function cI(t){return aI.get(t)}function lI(t){const e=iI.entries(),n=[];for(;;){const{done:r,value:s}=e.next();if(r)break;const[o,i]=s,[a]=o.split("_");a===t&&n.push(i)}return n}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fI(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=uO(t)),kO().getBool("DEBUG")&&function(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){const e=new Uint8Array(t.length);for(let n=0;n<e.length;++n)0!==Math.round(t[n])&&(e[n]=1);return e}throw new Error(`Unknown data type ${e}`)}function hI(){return kO().platform.now()}function pI(t,e="utf-8"){return e=e||"utf-8",kO().platform.decode(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dI{constructor(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new yI)}profileKernel(t,e,n){let r;const s=()=>{r=n()};let o;const i=hI();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(s);else{s();for(const t of r)t.dataSync();o=Promise.resolve({kernelMs:hI()-i})}if(kO().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let e=0;e<r.length;e++){const n=r[e];n.data().then((e=>{mI(e,n.dtype,t)}))}return{kernelName:t,outputs:r,inputs:e,timeMs:o.then((t=>t.kernelMs)),extraInfo:o.then((t=>null!=t.getExtraProfileInfo?t.getExtraProfileInfo():""))}}logKernelProfile(t){const{kernelName:e,outputs:n,timeMs:r,inputs:s,extraInfo:o}=t;n.forEach((t=>{Promise.all([t.data(),r,o]).then((n=>{this.logger.logKernelProfile(e,t,n[0],n[1],s,n[2])}))}))}}function mI(t,e,n){if("float32"!==e)return!1;for(let e=0;e<t.length;e++){const r=t[e];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class yI{logKernelProfile(t,e,n,r,s,o){const i="number"==typeof r?hO(`${r}ms`,9):r.error,a=hO(t,25),u=e.rank,c=e.size,l=hO(e.shape.toString(),14);let f="";for(const t in s){const n=s[t];if(null!=n){const r=n.shape||e.shape,s=r.length;f+=`${t}: ${s}D ${s>0?r:""} `}}console.log(`%c${a}\t%c${i}\t%c${u}D ${l}\t%c${c}\t%c${f}\t%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gI(t,e,n,r){const s=wO(e),o=function(t,e,n,r){const s=cO(e),o=r[r.length-1],i=new Array(o).fill(0),a=e.length,u="complex64"===n?xI(t):t;if(a>1)for(let t=0;t<s/o;t++){const e=t*o;for(let t=0;t<o;t++)i[t]=Math.max(i[t],bI(u[e+t],0,n).length)}return i}(t,e,n,s),i=e.length,a=vI(t,e,n,s,o),u=["Tensor"];return r&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${i}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(a.map((t=>"    "+t)).join("\n")),u.join("\n")}function bI(t,e,n){let r;return r=Array.isArray(t)?`${parseFloat(t[0].toFixed(7))} + ${parseFloat(t[1].toFixed(7))}j`:yO(t)?`'${t}'`:"bool"===n?wI(t):parseFloat(t.toFixed(7)).toString(),hO(r,e)}function wI(t){return 0===t?"false":"true"}function vI(t,e,n,r,s,o=!0){const i="complex64"===n?2:1,a=e[0],u=e.length;if(0===u){if("complex64"===n){return[bI(xI(t)[0],0,n)]}return"bool"===n?[wI(t[0])]:[t[0].toString()]}if(1===u){if(a>20){const e=3*i;let r=Array.from(t.slice(0,e)),o=Array.from(t.slice((a-3)*i,a*i));return"complex64"===n&&(r=xI(r),o=xI(o)),["["+r.map(((t,e)=>bI(t,s[e],n))).join(", ")+", ..., "+o.map(((t,e)=>bI(t,s[a-3+e],n))).join(", ")+"]"]}return["["+("complex64"===n?xI(t):Array.from(t)).map(((t,e)=>bI(t,s[e],n))).join(", ")+"]"]}const c=e.slice(1),l=r.slice(1),f=r[0]*i,h=[];if(a>20){for(let e=0;e<3;e++){const r=e*f,o=r+f;h.push(...vI(t.slice(r,o),c,n,l,s,!1))}h.push("...");for(let e=a-3;e<a;e++){const r=e*f,o=r+f;h.push(...vI(t.slice(r,o),c,n,l,s,e===a-1))}}else for(let e=0;e<a;e++){const r=e*f,o=r+f;h.push(...vI(t.slice(r,o),c,n,l,s,e===a-1))}const p=2===u?",":"";h[0]="["+h[0]+p;for(let t=1;t<h.length-1;t++)h[t]=" "+h[t]+p;let d=",\n";for(let t=2;t<u;t++)d+="\n";return h[h.length-1]=" "+h[h.length-1]+"]"+(o?"":d),h}function xI(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NI{constructor(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=cO(t),null!=n){const t=n.length;oO(t===this.size,(()=>`Length of values '${t}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||function(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error(`Unknown data type ${t}`);n=new Array(e)}return n}(e,this.size),this.strides=wO(t)}set(t,...e){0===e.length&&(e=[0]),oO(e.length===this.rank,(()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`));const n=this.locToIndex(e);this.values[n]=t}get(...t){0===t.length&&(t=[0]);let e=0;for(const n of t){if(n<0||n>=this.shape[e]){const e=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(e)}e++}let n=t[t.length-1];for(let e=0;e<t.length-1;++e)n+=this.strides[e]*t[e];return this.values[n]}locToIndex(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];let e=t[t.length-1];for(let n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e}indexToLoc(t){if(0===this.rank)return[];if(1===this.rank)return[t];const e=new Array(this.shape.length);for(let n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return $I().makeTensor(this.values,this.shape,this.dtype)}}let $I=null,EI=null;class SI{constructor(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=cO(t),this.strides=wO(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return EI.buffer(this.shape,this.dtype,t)}bufferSync(){return EI.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return xO(this.shape,t,"complex64"===this.dtype)}arraySync(){return xO(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const t=$I().read(this.dataId);if("string"===this.dtype){const e=await t;try{return e.map((t=>pI(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),$I().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=$I().readSync(this.dataId);if("string"===this.dtype)try{return t.map((t=>pI(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await $I().read(this.dataId);return"string"===this.dtype?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||($I().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return EI.print(this,t)}clone(){return this.throwIfDisposed(),EI.clone(this)}toString(t=!1){return gI(this.dataSync(),this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),EI.cast(this,t)}variable(t=!0,e,n){return this.throwIfDisposed(),$I().makeVariable(this,t,e,n)}}Object.defineProperty(SI,Symbol.hasInstance,{value:t=>!!t&&null!=t.data&&null!=t.dataSync&&null!=t.throwIfDisposed}),sI("Tensor",(()=>SI));class _I extends SI{constructor(t,e,n,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=e,this.name=n}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!lO(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);$I().disposeTensor(this),this.dataId=t.dataId,$I().incRef(this,null)}dispose(){$I().disposeVariable(this),this.isDisposedInternal=!0}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var TI,kI,AI,CI,OI;Object.defineProperty(_I,Symbol.hasInstance,{value:t=>t instanceof SI&&null!=t.assign&&t.assign instanceof Function}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(TI||(TI={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(kI||(kI={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(AI||(AI={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(CI||(CI={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(OI||(OI={}));const II={float32:CI,int32:kI,bool:AI,complex64:OI};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function MI(t,e){if(t.dtype===e.dtype)return[t,e];const n=function(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return II[t][e]}(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function RI(t){const e=[];return DI(t,e,new Set),e}function DI(t,e,n){if(null==t)return;if(t instanceof SI)return void e.push(t);if(r=t,!Array.isArray(r)&&"object"!=typeof r)return;var r;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s=t;for(const t in s){const r=s[t];n.has(r)||(n.add(r),DI(r,e,n))}}function FI(t){return null!=t.kernelName}class LI{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((t=>t.name))))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class PI{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new LI}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;{const{asyncInit:e}=this.initializeBackend(t);if(e)return null}}return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,n=1){return t in this.registryFactory?(oI(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:n},!0)}async setBackend(t){if(null==this.registryFactory[t])throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,null==this.registry[t]){this.backendInstance=null;const{success:e,asyncInit:n}=this.initializeBackend(t);if(!(n?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new dI(this.backendInstance),!0}setupRegisteredKernels(){lI(this.backendName).forEach((t=>{null!=t.setupFunc&&t.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(t){lI(t).forEach((e=>{null!=e.disposeFunc&&e.disposeFunc(this.registry[t])}))}initializeBackend(t){const e=this.registryFactory[t];if(null==e)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const n=e.factory();if(!n||n instanceof class{refCount(t){return sO("refCount")}incRef(t){return sO("incRef")}timerAvailable(){return!0}time(t){return sO("time")}read(t){return sO("read")}readSync(t){return sO("readSync")}readToGPU(t,e){return sO("readToGPU")}numDataIds(){return sO("numDataIds")}disposeData(t,e){return sO("disposeData")}write(t,e,n){return sO("write")}move(t,e,n,r,s){return sO("move")}memory(){return sO("memory")}floatPrecision(){return sO("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return sO("dispose")}}||"function"!=typeof n.then)return this.registry[t]=n,{success:!0,asyncInit:!1};{const e=++this.pendingBackendInitId,r=n.then((n=>!(e<this.pendingBackendInitId)&&(this.registry[t]=n,this.pendingBackendInit=null,!0))).catch((n=>(e<this.pendingBackendInitId||(this.pendingBackendInit=null,oI(`Initialization of backend ${t} failed`),oI(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(e){return oI(`Initialization of backend ${t} failed`),oI(e.stack||e.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority))}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e],{success:r,asyncInit:s}=this.initializeBackend(n);if(s||r)return{name:n,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const n=this.state.tensorInfo.get(e),r=n.backend,s=this.readSync(e),o=r.refCount(e);r.disposeData(e,!0),n.backend=t,t.move(e,s,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let n,r=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=e(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(t,e,n){t();try{const t=n();return e(),t}catch(t){throw e(),t}}nextTensorId(){return PI.nextTensorId++}nextVariableId(){return PI.nextVariableId++}clone(t){const e=VI.runKernel("Identity",{x:t}),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(t=>({x:()=>{const e={x:t},n={dtype:"float32"};return VI.runKernel("Cast",e,n)}})),[],{}),e}runKernel(t,e,n){null==this.backendName&&this.backend;if(!(null!=uI(t,this.backendName)))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,n){const r=this.backend.numDataIds();let s=0;n.forEach((t=>{s+="complex64"===t.dtype?3:1}));const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=r-e-s-o;if(i>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${i} data ids) after running '${t}'`)}runKernelFunc(t){let e,n=[];const r=this.isTapeOn(),s=this.state.numBytes,o=this.state.numTensors;let i,a;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const u=FI(t)?t.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(FI(t)){const{kernelName:e,inputs:s,attrs:o}=t;null==this.backendName&&this.backend;const u=uI(e,this.backendName);oO(null!=u,(()=>`Cannot find registered kernel '${e}' for backend '${this.backendName}'`)),i=()=>{const t=this.backend.numDataIds();a=u.kernelFunc({inputs:s,attrs:o,backend:this.backend});const i=Array.isArray(a)?a:[a];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(e,t,i);const c=i.map((t=>null!=t.rank?t:this.makeTensorFromTensorInfo(t)));if(r){const t=this.getTensorsForGradient(e,s,c);n=this.saveTensorsForBackwardMode(t)}return c}}else{const{forwardFunc:e}=t,s=t=>{r&&(n=t.map((t=>this.keep(this.clone(t)))))};i=()=>{const t=this.backend.numDataIds();a=this.tidy((()=>e(this.backend,s)));const n=Array.isArray(a)?a:[a];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,t,n),n}}const{inputs:c,attrs:l}=t,f=FI(t)?null:t.backwardsFunc;let h;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(h=this.profiler.profileKernel(u,c,(()=>i())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(h),e=h.outputs):e=i()})),r&&this.addTapeNode(u,c,e,f,n,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map((t=>null!=c[t]?c[t].shape:null)),outputShapes:e.map((t=>t.shape)),kernelTimeMs:h.timeMs,extraInfo:h.extraInfo}),Array.isArray(a)?e:e[0]}saveTensorsForBackwardMode(t){const e=t.map((t=>this.keep(this.clone(t))));return e}getTensorsForGradient(t,e,n){const r=cI(t);if(null!=r){const t=r.inputsToSave||[],s=r.outputsToSave||[];let o;r.saveAllInputs?(oO(Array.isArray(e),(()=>"saveAllInputs is true, expected inputs to be an array.")),o=Object.keys(e).map((t=>e[t]))):o=t.map((t=>e[t]));const i=n.filter(((t,e)=>s[e]));return o.concat(i)}return[]}makeTensor(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let s=t;"string"===n&&yO(t[0])&&(s=t.map((t=>function(t,e="utf-8"){return e=e||"utf-8",kO().platform.encode(t,e)}(t))));const o=r.write(s,e,n),i=new SI(e,n,o,this.nextTensorId());if(this.trackTensor(i,r),"string"===n){const t=this.state.tensorInfo.get(o),e=function(t){if(null==t)return 0;let e=0;return t.forEach((t=>e+=t.length)),e}(s);this.state.numBytes+=e-t.bytes,t.bytes=e}return i}makeTensorFromDataId(t,e,n,r){const s={dataId:t,shape:e,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(s,r)}makeTensorFromTensorInfo(t,e){const{dataId:n,shape:r,dtype:s}=t,o=new SI(r,s,n,this.nextTensorId());return this.trackTensor(o,e),o}makeVariable(t,e=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.cast(r));const s=new _I(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[s.name])throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(t,e){this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*mO(t.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n})),t instanceof _I||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,"string"===t.dtype&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),"complex64"!==t.dtype&&"string"!==t.dtype){const e=t.size*mO(t.dtype);this.state.numBytes-=e}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((t=>t.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const t of this.state.activeProfile.kernels)t.kernelTimeMs=await t.kernelTimeMs,t.extraInfo=await t.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(t,e,n,r,s,o){const i={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:s},a=cI(t);null!=a&&(r=a.gradFunc),null!=r&&(i.gradient=t=>(t=t.map(((t,e)=>{if(null==t){const t=n[e],r=$O(t.size,t.dtype);return this.makeTensor(r,t.shape,t.dtype)}return t})),r(t.length>1?t:t[0],s,o))),this.state.activeTape.push(i)}keep(t){return t.kept=!0,t}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=RI(t),n=new Set(e.map((t=>t.id)));for(let t=0;t<this.state.activeScope.track.length;t++){const e=this.state.activeScope.track[t];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach((t=>{t.kept||t.scopeId!==r.id||this.track(t)}))}gradients(t,e,n,r=!1){if(oO(e.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const s=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",t)));oO(s instanceof SI,(()=>"The result y returned by f() must be a tensor."));const o=function(t,e,n){const r={},s={};for(let t=0;t<e.length;t++)r[e[t].id]=!0;for(let n=0;n<t.length;n++){const o=t[n],i=o.inputs;for(const t in i){const n=i[t];let a=!1;for(let t=0;t<e.length;t++)if(r[n.id]){o.outputs.forEach((t=>r[t.id]=!0)),a=!0,s[o.id]=!0;break}if(a)break}}const o={};o[n.id]=!0;const i={};for(let e=t.length-1;e>=0;e--){const n=t[e],r=n.inputs;for(let t=0;t<n.outputs.length;t++)if(o[n.outputs[t].id]){for(const t in r)o[r[t].id]=!0,i[n.id]=!0;break}}const a=[];for(let e=0;e<t.length;e++){const n=t[e];if(s[n.id]&&i[n.id]){const t={};for(const e in n.inputs){const s=n.inputs[e];r[s.id]&&(t[e]=s)}const e=Object.assign({},n);e.inputs=t,e.outputs=n.outputs,a.push(e)}}return a}(this.state.activeTape,e,s);if(!r&&0===o.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const t={};t[s.id]=null==n?function(t){const e=NO(cO(t),"float32");return VI.makeTensor(e,t,"float32")}(s.shape):n,function(t,e,n,r){for(let s=e.length-1;s>=0;s--){const o=e[s],i=[];if(o.outputs.forEach((e=>{const n=t[e.id];null!=n?i.push(n):i.push(null)})),null==o.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const e in o.inputs){if(!(e in a))throw new Error(`Cannot backprop through input ${e}. Available gradients found: ${Object.keys(a)}.`);const s=n((()=>a[e]()));if("float32"!==s.dtype)throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${e} must have 'float32' dtype, but has '${s.dtype}'`);const i=o.inputs[e];if(!lO(s.shape,i.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${e}' has shape '${s.shape}', which does not match the shape of the input '${i.shape}'`);if(null==t[i.id])t[i.id]=s;else{const e=t[i.id];t[i.id]=r(e,s),e.dispose()}}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,o,(t=>this.tidy(t)),zI);const r=e.map((e=>t[e.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((t=>{for(const e of t.saved)e.dispose()})),this.state.activeTape=null),{value:s,grads:r}}))}customGrad(t){return oO(bO(t),(()=>"The f passed in customGrad(f) must be a function.")),(...e)=>{let n;oO(e.every((t=>t instanceof SI)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};e.forEach(((t,e)=>{r[e]=t}));return this.runKernelFunc({forwardFunc:(r,s)=>(n=t(...e,s),oO(n.value instanceof SI,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),oO(bO(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(t,r)=>{const s=n.gradFunc(t,r),o=Array.isArray(s)?s:[s];oO(o.length===e.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),oO(o.every((t=>t instanceof SI)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const i={};return o.forEach(((t,e)=>{i[e]=()=>t})),i},inputs:r})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)}async time(t){const e=hI(),n=await this.backend.time(t);return n.wallMs=hI()-e,n}track(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new LI;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function BI(){const t=rI();if(null==t._tfengine){const e=new _O(t);t._tfengine=new PI(e)}var e;return e=t._tfengine.ENV,AO=e,$I=()=>t._tfengine,t._tfengine}PI.nextTensorId=0,PI.nextVariableId=0;const VI=BI();function zI(t,e){const n={a:t,b:e};return VI.runKernel("Add",n)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WI=kO();WI.registerFlag("DEBUG",(()=>!1),(t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),WI.registerFlag("IS_BROWSER",(()=>"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope)),WI.registerFlag("IS_NODE",(()=>void 0!==eI&&void 0!==eI.versions&&void 0!==eI.versions.node)),WI.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),WI.registerFlag("PROD",(()=>!1)),WI.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>WI.getBool("DEBUG"))),WI.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),WI.registerFlag("IS_TEST",(()=>!1)),WI.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>!0)),WI.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),WI.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));var UI=[],jI=[],GI="undefined"!=typeof Uint8Array?Uint8Array:Array,qI=!1;function HI(){qI=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,n=t.length;e<n;++e)UI[e]=t[e],jI[t.charCodeAt(e)]=e;jI["-".charCodeAt(0)]=62,jI["_".charCodeAt(0)]=63}function KI(t,e,n){for(var r,s,o=[],i=e;i<n;i+=3)r=(t[i]<<16)+(t[i+1]<<8)+t[i+2],o.push(UI[(s=r)>>18&63]+UI[s>>12&63]+UI[s>>6&63]+UI[63&s]);return o.join("")}function XI(t){var e;qI||HI();for(var n=t.length,r=n%3,s="",o=[],i=16383,a=0,u=n-r;a<u;a+=i)o.push(KI(t,a,a+i>u?u:a+i));return 1===r?(e=t[n-1],s+=UI[e>>2],s+=UI[e<<4&63],s+="=="):2===r&&(e=(t[n-2]<<8)+t[n-1],s+=UI[e>>10],s+=UI[e>>4&63],s+=UI[e<<2&63],s+="="),o.push(s),o.join("")}function JI(t,e,n,r,s){var o,i,a=8*s-r-1,u=(1<<a)-1,c=u>>1,l=-7,f=n?s-1:0,h=n?-1:1,p=t[e+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+t[e+f],f+=h,l-=8);for(i=o&(1<<-l)-1,o>>=-l,l+=r;l>0;i=256*i+t[e+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return i?NaN:1/0*(p?-1:1);i+=Math.pow(2,r),o-=c}return(p?-1:1)*i*Math.pow(2,o-r)}function YI(t,e,n,r,s,o){var i,a,u,c=8*o-s-1,l=(1<<c)-1,f=l>>1,h=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,i=l):(i=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-i))<1&&(i--,u*=2),(e+=i+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(i++,u/=2),i+f>=l?(a=0,i=l):i+f>=1?(a=(e*u-1)*Math.pow(2,s),i+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,s),i=0));s>=8;t[n+p]=255&a,p+=d,a/=256,s-=8);for(i=i<<s|a,c+=s;c>0;t[n+p]=255&i,p+=d,i/=256,c-=8);t[n+p-d]|=128*m}var ZI={}.toString,QI=Array.isArray||function(t){return"[object Array]"==ZI.call(t)};function tM(){return nM.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function eM(t,e){if(tM()<e)throw new RangeError("Invalid typed array length");return nM.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=nM.prototype:(null===t&&(t=new nM(e)),t.length=e),t}function nM(t,e,n){if(!(nM.TYPED_ARRAY_SUPPORT||this instanceof nM))return new nM(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return oM(this,t)}return rM(this,t,e,n)}function rM(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);nM.TYPED_ARRAY_SUPPORT?(t=e).__proto__=nM.prototype:t=iM(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!nM.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|cM(e,n),s=(t=eM(t,r)).write(e,n);s!==r&&(t=t.slice(0,s));return t}(t,e,n):function(t,e){if(uM(e)){var n=0|aM(e.length);return 0===(t=eM(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?eM(t,0):iM(t,e);if("Buffer"===e.type&&QI(e.data))return iM(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function sM(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function oM(t,e){if(sM(e),t=eM(t,e<0?0:0|aM(e)),!nM.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function iM(t,e){var n=e.length<0?0:0|aM(e.length);t=eM(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function aM(t){if(t>=tM())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+tM().toString(16)+" bytes");return 0|t}function uM(t){return!(null==t||!t._isBuffer)}function cM(t,e){if(uM(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return DM(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return FM(t).length;default:if(r)return DM(t).length;e=(""+e).toLowerCase(),r=!0}}function lM(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return EM(this,e,n);case"utf8":case"utf-8":return xM(this,e,n);case"ascii":return NM(this,e,n);case"latin1":case"binary":return $M(this,e,n);case"base64":return vM(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return SM(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function fM(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function hM(t,e,n,r,s){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=s?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(s)return-1;n=t.length-1}else if(n<0){if(!s)return-1;n=0}if("string"==typeof e&&(e=nM.from(e,r)),uM(e))return 0===e.length?-1:pM(t,e,n,r,s);if("number"==typeof e)return e&=255,nM.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):pM(t,[e],n,r,s);throw new TypeError("val must be string, number or Buffer")}function pM(t,e,n,r,s){var o,i=1,a=t.length,u=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;i=2,a/=2,u/=2,n/=2}function c(t,e){return 1===i?t[e]:t.readUInt16BE(e*i)}if(s){var l=-1;for(o=n;o<a;o++)if(c(t,o)===c(e,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*i}else-1!==l&&(o-=o-l),l=-1}else for(n+u>a&&(n=a-u),o=n;o>=0;o--){for(var f=!0,h=0;h<u;h++)if(c(t,o+h)!==c(e,h)){f=!1;break}if(f)return o}return-1}function dM(t,e,n,r){n=Number(n)||0;var s=t.length-n;r?(r=Number(r))>s&&(r=s):r=s;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var i=0;i<r;++i){var a=parseInt(e.substr(2*i,2),16);if(isNaN(a))return i;t[n+i]=a}return i}function mM(t,e,n,r){return LM(DM(e,t.length-n),t,n,r)}function yM(t,e,n,r){return LM(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function gM(t,e,n,r){return yM(t,e,n,r)}function bM(t,e,n,r){return LM(FM(e),t,n,r)}function wM(t,e,n,r){return LM(function(t,e){for(var n,r,s,o=[],i=0;i<t.length&&!((e-=2)<0);++i)r=(n=t.charCodeAt(i))>>8,s=n%256,o.push(s),o.push(r);return o}(e,t.length-n),t,n,r)}function vM(t,e,n){return 0===e&&n===t.length?XI(t):XI(t.slice(e,n))}function xM(t,e,n){n=Math.min(t.length,n);for(var r=[],s=e;s<n;){var o,i,a,u,c=t[s],l=null,f=c>239?4:c>223?3:c>191?2:1;if(s+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=t[s+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=t[s+1],i=t[s+2],128==(192&o)&&128==(192&i)&&(u=(15&c)<<12|(63&o)<<6|63&i)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=t[s+1],i=t[s+2],a=t[s+3],128==(192&o)&&128==(192&i)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&i)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),s+=f}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=4096));return n}(r)}nM.TYPED_ARRAY_SUPPORT=void 0===CO.TYPED_ARRAY_SUPPORT||CO.TYPED_ARRAY_SUPPORT,tM(),nM.poolSize=8192,nM._augment=function(t){return t.__proto__=nM.prototype,t},nM.from=function(t,e,n){return rM(null,t,e,n)},nM.TYPED_ARRAY_SUPPORT&&(nM.prototype.__proto__=Uint8Array.prototype,nM.__proto__=Uint8Array),nM.alloc=function(t,e,n){return function(t,e,n,r){return sM(e),e<=0?eM(t,e):void 0!==n?"string"==typeof r?eM(t,e).fill(n,r):eM(t,e).fill(n):eM(t,e)}(null,t,e,n)},nM.allocUnsafe=function(t){return oM(null,t)},nM.allocUnsafeSlow=function(t){return oM(null,t)},nM.isBuffer=function(t){return null!=t&&(!!t._isBuffer||PM(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&PM(t.slice(0,0))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t))},nM.compare=function(t,e){if(!uM(t)||!uM(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,s=0,o=Math.min(n,r);s<o;++s)if(t[s]!==e[s]){n=t[s],r=e[s];break}return n<r?-1:r<n?1:0},nM.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},nM.concat=function(t,e){if(!QI(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return nM.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=nM.allocUnsafe(e),s=0;for(n=0;n<t.length;++n){var o=t[n];if(!uM(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,s),s+=o.length}return r},nM.byteLength=cM,nM.prototype._isBuffer=!0,nM.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)fM(this,e,e+1);return this},nM.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)fM(this,e,e+3),fM(this,e+1,e+2);return this},nM.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)fM(this,e,e+7),fM(this,e+1,e+6),fM(this,e+2,e+5),fM(this,e+3,e+4);return this},nM.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?xM(this,0,t):lM.apply(this,arguments)},nM.prototype.equals=function(t){if(!uM(t))throw new TypeError("Argument must be a Buffer");return this===t||0===nM.compare(this,t)},nM.prototype.inspect=function(){var t="";return this.length>0&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(t+=" ... ")),"<Buffer "+t+">"},nM.prototype.compare=function(t,e,n,r,s){if(!uM(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===s&&(s=this.length),e<0||n>t.length||r<0||s>this.length)throw new RangeError("out of range index");if(r>=s&&e>=n)return 0;if(r>=s)return-1;if(e>=n)return 1;if(this===t)return 0;for(var o=(s>>>=0)-(r>>>=0),i=(n>>>=0)-(e>>>=0),a=Math.min(o,i),u=this.slice(r,s),c=t.slice(e,n),l=0;l<a;++l)if(u[l]!==c[l]){o=u[l],i=c[l];break}return o<i?-1:i<o?1:0},nM.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},nM.prototype.indexOf=function(t,e,n){return hM(this,t,e,n,!0)},nM.prototype.lastIndexOf=function(t,e,n){return hM(this,t,e,n,!1)},nM.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var s=this.length-e;if((void 0===n||n>s)&&(n=s),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return dM(this,t,e,n);case"utf8":case"utf-8":return mM(this,t,e,n);case"ascii":return yM(this,t,e,n);case"latin1":case"binary":return gM(this,t,e,n);case"base64":return bM(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return wM(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},nM.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function NM(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(127&t[s]);return r}function $M(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(t[s]);return r}function EM(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var s="",o=e;o<n;++o)s+=RM(t[o]);return s}function SM(t,e,n){for(var r=t.slice(e,n),s="",o=0;o<r.length;o+=2)s+=String.fromCharCode(r[o]+256*r[o+1]);return s}function _M(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function TM(t,e,n,r,s,o){if(!uM(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function kM(t,e,n,r){e<0&&(e=65535+e+1);for(var s=0,o=Math.min(t.length-n,2);s<o;++s)t[n+s]=(e&255<<8*(r?s:1-s))>>>8*(r?s:1-s)}function AM(t,e,n,r){e<0&&(e=4294967295+e+1);for(var s=0,o=Math.min(t.length-n,4);s<o;++s)t[n+s]=e>>>8*(r?s:3-s)&255}function CM(t,e,n,r,s,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function OM(t,e,n,r,s){return s||CM(t,0,n,4),YI(t,e,n,r,23,4),n+4}function IM(t,e,n,r,s){return s||CM(t,0,n,8),YI(t,e,n,r,52,8),n+8}nM.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),nM.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=nM.prototype;else{var s=e-t;n=new nM(s,void 0);for(var o=0;o<s;++o)n[o]=this[o+t]}return n},nM.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||_M(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r},nM.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||_M(t,e,this.length);for(var r=this[t+--e],s=1;e>0&&(s*=256);)r+=this[t+--e]*s;return r},nM.prototype.readUInt8=function(t,e){return e||_M(t,1,this.length),this[t]},nM.prototype.readUInt16LE=function(t,e){return e||_M(t,2,this.length),this[t]|this[t+1]<<8},nM.prototype.readUInt16BE=function(t,e){return e||_M(t,2,this.length),this[t]<<8|this[t+1]},nM.prototype.readUInt32LE=function(t,e){return e||_M(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},nM.prototype.readUInt32BE=function(t,e){return e||_M(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},nM.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||_M(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r>=(s*=128)&&(r-=Math.pow(2,8*e)),r},nM.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||_M(t,e,this.length);for(var r=e,s=1,o=this[t+--r];r>0&&(s*=256);)o+=this[t+--r]*s;return o>=(s*=128)&&(o-=Math.pow(2,8*e)),o},nM.prototype.readInt8=function(t,e){return e||_M(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},nM.prototype.readInt16LE=function(t,e){e||_M(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},nM.prototype.readInt16BE=function(t,e){e||_M(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},nM.prototype.readInt32LE=function(t,e){return e||_M(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},nM.prototype.readInt32BE=function(t,e){return e||_M(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},nM.prototype.readFloatLE=function(t,e){return e||_M(t,4,this.length),JI(this,t,!0,23,4)},nM.prototype.readFloatBE=function(t,e){return e||_M(t,4,this.length),JI(this,t,!1,23,4)},nM.prototype.readDoubleLE=function(t,e){return e||_M(t,8,this.length),JI(this,t,!0,52,8)},nM.prototype.readDoubleBE=function(t,e){return e||_M(t,8,this.length),JI(this,t,!1,52,8)},nM.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||TM(this,t,e,n,Math.pow(2,8*n)-1,0);var s=1,o=0;for(this[e]=255&t;++o<n&&(s*=256);)this[e+o]=t/s&255;return e+n},nM.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||TM(this,t,e,n,Math.pow(2,8*n)-1,0);var s=n-1,o=1;for(this[e+s]=255&t;--s>=0&&(o*=256);)this[e+s]=t/o&255;return e+n},nM.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||TM(this,t,e,1,255,0),nM.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},nM.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||TM(this,t,e,2,65535,0),nM.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):kM(this,t,e,!0),e+2},nM.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||TM(this,t,e,2,65535,0),nM.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):kM(this,t,e,!1),e+2},nM.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||TM(this,t,e,4,4294967295,0),nM.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):AM(this,t,e,!0),e+4},nM.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||TM(this,t,e,4,4294967295,0),nM.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):AM(this,t,e,!1),e+4},nM.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);TM(this,t,e,n,s-1,-s)}var o=0,i=1,a=0;for(this[e]=255&t;++o<n&&(i*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},nM.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);TM(this,t,e,n,s-1,-s)}var o=n-1,i=1,a=0;for(this[e+o]=255&t;--o>=0&&(i*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},nM.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||TM(this,t,e,1,127,-128),nM.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},nM.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||TM(this,t,e,2,32767,-32768),nM.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):kM(this,t,e,!0),e+2},nM.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||TM(this,t,e,2,32767,-32768),nM.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):kM(this,t,e,!1),e+2},nM.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||TM(this,t,e,4,2147483647,-2147483648),nM.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):AM(this,t,e,!0),e+4},nM.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||TM(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),nM.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):AM(this,t,e,!1),e+4},nM.prototype.writeFloatLE=function(t,e,n){return OM(this,t,e,!0,n)},nM.prototype.writeFloatBE=function(t,e,n){return OM(this,t,e,!1,n)},nM.prototype.writeDoubleLE=function(t,e,n){return IM(this,t,e,!0,n)},nM.prototype.writeDoubleBE=function(t,e,n){return IM(this,t,e,!1,n)},nM.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var s,o=r-n;if(this===t&&n<e&&e<r)for(s=o-1;s>=0;--s)t[s+e]=this[s+n];else if(o<1e3||!nM.TYPED_ARRAY_SUPPORT)for(s=0;s<o;++s)t[s+e]=this[s+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},nM.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var s=t.charCodeAt(0);s<256&&(t=s)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!nM.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var i=uM(t)?t:DM(new nM(t,r).toString()),a=i.length;for(o=0;o<n-e;++o)this[o+e]=i[o%a]}return this};var MM=/[^+\/0-9A-Za-z-_]/g;function RM(t){return t<16?"0"+t.toString(16):t.toString(16)}function DM(t,e){var n;e=e||1/0;for(var r=t.length,s=null,o=[],i=0;i<r;++i){if((n=t.charCodeAt(i))>55295&&n<57344){if(!s){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(i+1===r){(e-=3)>-1&&o.push(239,191,189);continue}s=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),s=n;continue}n=65536+(s-55296<<10|n-56320)}else s&&(e-=3)>-1&&o.push(239,191,189);if(s=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function FM(t){return function(t){var e,n,r,s,o,i;qI||HI();var a=t.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===t[a-2]?2:"="===t[a-1]?1:0,i=new GI(3*a/4-o),r=o>0?a-4:a;var u=0;for(e=0,n=0;e<r;e+=4,n+=3)s=jI[t.charCodeAt(e)]<<18|jI[t.charCodeAt(e+1)]<<12|jI[t.charCodeAt(e+2)]<<6|jI[t.charCodeAt(e+3)],i[u++]=s>>16&255,i[u++]=s>>8&255,i[u++]=255&s;return 2===o?(s=jI[t.charCodeAt(e)]<<2|jI[t.charCodeAt(e+1)]>>4,i[u++]=255&s):1===o&&(s=jI[t.charCodeAt(e)]<<10|jI[t.charCodeAt(e+1)]<<4|jI[t.charCodeAt(e+2)]>>2,i[u++]=s>>8&255,i[u++]=255&s),i}(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(MM,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function LM(t,e,n,r){for(var s=0;s<r&&!(s+n>=e.length||s>=t.length);++s)e[s+n]=t[s];return s}function PM(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function BM(t,e){let n=t;if(dO(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||dO(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&kO().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&VM(t,r,[]),r}function VM(t,e,n){if(n=n||[],!Array.isArray(t)&&!dO(t))return void oO(0===e.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`));oO(e.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`)),oO(t.length===e[0],(()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`));const r=e.slice(1);for(let e=0;e<t.length;++e)VM(t[e],r,n.concat(e))}function zM(t,e,n,r){if("string_or_numeric"!==t){if(null==t)throw new Error("Expected dtype cannot be null.");if("numeric"!==t&&t!==e||"numeric"===t&&"string"===e)throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}}function WM(t,e,n,r="numeric"){if(t instanceof SI)return zM(r,t.dtype,e,n),t;let s=gO(t);if("string"!==s&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),zM(r,s,e,n),null==t||!dO(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){const r=null==t?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const o=BM(t,s);dO(t)||Array.isArray(t)||(t=[t]);const i="string"!==s?fI(t,s):uO(t,[],!0);return VI.makeTensor(i,o,s)}function UM(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map(((t,s)=>WM(t,`${e}[${s}]`,n,r)))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jM(t){const e=Object.keys(t);if(1!==e.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const s=(...t)=>{VI.startScope(n);try{const e=r(...t);return SO(e)&&console.error("Cannot return a Promise inside of tidy."),VI.endScope(e),e}catch(t){throw VI.endScope(null),t}};return Object.defineProperty(s,"name",{value:n,configurable:!0}),s}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GM=jM({complex_:function(t,e){const n=WM(t,"real","complex"),r=WM(e,"imag","complex");iO(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const s={real:n,imag:r};return VI.runKernel("Complex",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qM(t,e,n,r){if(null==r&&(r=gO(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!dO(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){EO(e);const t=cO(e),r=cO(n);oO(t===r,(()=>`Based on the provided shape, [${e}], the tensor should have ${t} values but has ${r}`));for(let t=0;t<n.length;++t){const r=n[t],s=t!==n.length-1||r!==cO(e.slice(t));oO(n[t]===e[t]||!s,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `))}}return dO(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?fI(t,r):uO(t,[],!0),VI.makeTensor(t,e,r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HM(t,e,n){return qM(t,e,BM(t,n),n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KM={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};const XM="undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa;function JM(t){return XM?nM.byteLength(t):new Blob([t]).size}function YM(t){if(1===t.length)return t[0];let e=0;t.forEach((t=>{e+=t.byteLength}));const n=new Uint8Array(e);let r=0;return t.forEach((t=>{n.set(new Uint8Array(t),r),r+=t.byteLength})),n.buffer}function ZM(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:JM(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:JM(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}function QM(){const t=function(){const t=t=>{let e=t<<13,n=0;for(;0==(8388608&e);)n-=8388608,e<<=1;return e&=-8388609,n+=947912704,e|n},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}(),e=function(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}(),n=function(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}();return r=>{const s=new ArrayBuffer(4*r.length),o=new Uint32Array(s);for(let s=0;s<r.length;s++){const i=r[s],a=t[n[i>>10]+(1023&i)]+e[i>>10];o[s]=a}return new Float32Array(s)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tR{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==tR.instance&&(tR.instance=new tR),tR.instance}static registerSaveRouter(t){tR.getInstance().saveRouters.push(t)}static registerLoadRouter(t){tR.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return tR.getHandlers(t,"save")}static getLoadHandlers(t,e){return tR.getHandlers(t,"load",e)}static getHandlers(t,e,n){const r=[];return("load"===e?tR.getInstance().loadRouters:tR.getInstance().saveRouters).forEach((e=>{const s=e(t,n);null!==s&&r.push(s)})),r}}function eR(){if(!kO().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t="undefined"==typeof window?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function nR(t){const e=t.result;e.createObjectStore("models_store",{keyPath:"modelPath"}),e.createObjectStore("model_info_store",{keyPath:"modelPath"})}class rR{constructor(t){if(this.indexedDB=eR(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise(((t,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>nR(r),r.onsuccess=()=>{const s=r.result;if(null==e){const e=s.transaction("models_store","readonly"),r=e.objectStore("models_store").get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return s.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));t(r.result.modelArtifacts)},r.onerror=t=>(s.close(),n(r.error)),e.oncomplete=()=>s.close()}else{const r=ZM(e),o=s.transaction("model_info_store","readwrite");let i=o.objectStore("model_info_store");const a=i.put({modelPath:this.modelPath,modelArtifactsInfo:r});let u;a.onsuccess=()=>{u=s.transaction("models_store","readwrite");const a=u.objectStore("models_store").put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:r});a.onsuccess=()=>t({modelArtifactsInfo:r}),a.onerror=t=>{i=o.objectStore("model_info_store");const e=i.delete(this.modelPath);e.onsuccess=()=>(s.close(),n(a.error)),e.onerror=t=>(s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}}},r.onerror=t=>n(r.error)}))}}rR.URL_SCHEME="indexeddb://";const sR=t=>{return kO().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(rR.URL_SCHEME)?(e=t.slice(rR.URL_SCHEME.length),new rR(e)):null;var e};tR.registerSaveRouter(sR),tR.registerLoadRouter(sR);class oR{constructor(){this.indexedDB=eR()}async listModels(){return new Promise(((t,e)=>{const n=this.indexedDB.open("tensorflowjs",1);n.onupgradeneeded=()=>nR(n),n.onsuccess=()=>{const r=n.result,s=r.transaction("model_info_store","readonly"),o=s.objectStore("model_info_store").getAll();o.onsuccess=()=>{const e={};for(const t of o.result)e[t.modelPath]=t.modelArtifactsInfo;t(e)},o.onerror=t=>(r.close(),e(o.error)),s.oncomplete=()=>r.close()},n.onerror=t=>e(n.error)}))}async removeModel(t){var e;return t=(e=t).startsWith(rR.URL_SCHEME)?e.slice(rR.URL_SCHEME.length):e,new Promise(((e,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>nR(r),r.onsuccess=()=>{const s=r.result,o=s.transaction("model_info_store","readwrite"),i=o.objectStore("model_info_store"),a=i.get(t);let u;a.onsuccess=()=>{if(null==a.result)return s.close(),n(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const r=i.delete(t),o=()=>{u=s.transaction("models_store","readwrite");const r=u.objectStore("models_store").delete(t);r.onsuccess=()=>e(a.result.modelArtifactsInfo),r.onerror=t=>n(a.error)};r.onsuccess=o,r.onerror=t=>(o(),s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}},r.onerror=t=>n(r.error)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iR="tensorflowjs_models",aR="info",uR="model_topology",cR="weight_specs",lR="weight_data",fR="model_metadata";function hR(t){return{info:[iR,t,aR].join("/"),topology:[iR,t,uR].join("/"),weightSpecs:[iR,t,cR].join("/"),weightData:[iR,t,lR].join("/"),modelMetadata:[iR,t,fR].join("/")}}function pR(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function dR(t){const e=t.split("/");if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join("/")}class mR{constructor(t){if(!kO().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=hR(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=ZM(t);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(XM)return nM.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let t=0,r=e.length;t<r;t++)n+=String.fromCharCode(e[t]);return btoa(n)}(t.weightData));const s={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:r}}catch(t){throw pR(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(null==t)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=r;const s=this.LS.getItem(this.keys.modelMetadata);if(null!=s){const t=JSON.parse(s);e.format=t.format,e.generatedBy=t.generatedBy,e.convertedBy=t.convertedBy,null!=t.signature&&(e.signature=t.signature),null!=t.userDefinedMetadata&&(e.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(e.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(e.trainingConfig=t.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(null==o)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=function(t){if(XM){const e=nM.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;++t)n.set([e.charCodeAt(t)],t);return n.buffer}(o),e}}mR.URL_SCHEME="localstorage://";const yR=t=>{return kO().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(mR.URL_SCHEME)?(e=t.slice(mR.URL_SCHEME.length),new mR(e)):null;var e};tR.registerSaveRouter(yR),tR.registerLoadRouter(yR);class gR{constructor(){oO(kO().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),oO("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const t={},e=iR+"/",n="/"+aR;for(let r=0;r<this.LS.length;++r){const s=this.LS.key(r);if(s.startsWith(e)&&s.endsWith(n)){t[dR(s)]=JSON.parse(this.LS.getItem(s))}}return t}async removeModel(t){var e;const n=hR(t=(e=t).startsWith(mR.URL_SCHEME)?e.slice(mR.URL_SCHEME.length):e);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(n.info));return pR(n),r}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bR{constructor(){this.managers={}}static getInstance(){return null==bR.instance&&(bR.instance=new bR),bR.instance}static registerManager(t,e){oO(null!=t,(()=>"scheme must not be undefined or null.")),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),oO(t.length>0,(()=>"scheme must not be an empty string."));const n=bR.getInstance();oO(null==n.managers[t],(()=>`A model store manager is already registered for scheme '${t}'.`)),n.managers[t]=e}static getManager(t){const e=this.getInstance().managers[t];if(null==e)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wR{fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}}if(kO().get("IS_BROWSER")){kO().setPlatform("browser",new wR);try{bR.registerManager(mR.URL_SCHEME,new gR)}catch(t){}try{bR.registerManager(rR.URL_SCHEME,new oR)}catch(t){}}const vR=()=>require("node-fetch");let xR;class NR{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return null!=kO().global.fetch?kO().global.fetch(t,e):(null==xR&&(xR=vR()),xR(t,e))}now(){const t=eI.hrtime();return 1e3*t[0]+t[1]/1e6}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)}}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function $R(t,e="float32",n){return e=e||"float32",EO(t),new NI(t,e,n)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */kO().get("IS_NODE")&&!kO().get("IS_BROWSER")&&kO().setPlatform("node",new NR);const ER=jM({cast_:function(t,e){const n=WM(t,"x","cast");if(!function(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},s={dtype:e};return VI.runKernel("Cast",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SR=jM({clone_:function(t){const e={x:WM(t,"x","clone","string_or_numeric")};return VI.runKernel("Identity",e)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
BI();const _R={buffer:$R,cast:ER,clone:SR,print:function(t,e=!1){console.log(t.toString(e))}};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function TR(t,e,n,r){!function(t){oO(null!=t&&Array.isArray(t)&&t.length>0,(()=>"promises must be a none empty array"))}(t),function(t,e){oO(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${t}`)),oO(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${e}`)),oO(e>=t,(()=>`startFraction must be no more than endFraction, but got startFraction ${t} and endFraction ${e}`))}(n=null==n?0:n,r=null==r?1:r);let s=0;return Promise.all(t.map((o=>(o.then((o=>{const i=n+ ++s/t.length*(r-n);return e(i),o})),o))))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */!function(t){EI=t}(_R);class kR{constructor(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,this.weightUrlConverter=e.weightUrlConverter,null!=e.fetchFunc?(oO("function"==typeof e.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=e.fetchFunc):this.fetch=kO().platform.fetch,oO(null!=t&&t.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(t)&&oO(2===t.length,(()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`)),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData;const n=function(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),n}(t,[{paths:["./model.weights.bin"],weights:t.weightSpecs}]);e.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin");const r=await this.fetch(this.path,e);if(r.ok)return{modelArtifactsInfo:ZM(t),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let e;try{e=await t.json()}catch(t){let e=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=e.modelTopology,r=e.weightsManifest;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return async function(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),null!=t.weightsManifest){const[r,s]=await e(t.weightsManifest);n.weightSpecs=r,n.weightData=s}return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),n}(e,(t=>this.loadWeights(t)))}async loadWeights(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),r=t.substring(0,e),s=n>e?t.substring(n):"";return[r+"/",s]}(e),s=this.weightPathPrefix||n,o=[];for(const e of t)o.push(...e.weights);const i=[],a=[];for(const e of t)for(const t of e.paths)null!=this.weightUrlConverter?a.push(this.weightUrlConverter(t)):i.push(s+t+r);this.weightUrlConverter&&i.push(...await Promise.all(a));const u=await async function(t,e){null==e&&(e={});const n=null==e.fetchFunc?kO().platform.fetch:e.fetchFunc,r=t.map((t=>n(t,e.requestInit,{isBinary:!0}))),s=(null==e.onProgress?await Promise.all(r):await TR(r,e.onProgress,0,.5)).map((t=>t.arrayBuffer()));return null==e.onProgress?await Promise.all(s):await TR(s,e.onProgress,.5,1)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(i,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[o,YM(u)]}}function AR(t){return null!=t.match(kR.URL_SCHEME_REGEX)}kR.URL_SCHEME_REGEX=/^https?:\/\//;const CR=(t,e)=>{if("undefined"==typeof fetch&&(null==e||null==e.fetchFunc))return null;{let n=!0;if(n=Array.isArray(t)?t.every((t=>AR(t))):AR(t),n)return OR(t,e)}return null};function OR(t,e){return new kR(t,e)}function IR(t,e){return OR(t,e)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */tR.registerSaveRouter(CR),tR.registerLoadRouter(CR);const MR=jM({matMul_:function(t,e,n=!1,r=!1){let s=WM(t,"a","matMul"),o=WM(e,"b","matMul");[s,o]=MI(s,o);const i={a:s,b:o},a={transposeA:n,transposeB:r};return VI.runKernel("BatchMatMul",i,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RR=jM({oneHot_:function(t,e,n=1,r=0){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const s={indices:WM(t,"indices","oneHot","int32")},o={depth:e,onValue:n,offValue:r};return VI.runKernel("OneHot",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DR(t,e){return VI.tidy(t,e)}function FR(t){return VI.keep(t)}const LR=jM({imag_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={input:WM(t,"input","imag")};return VI.runKernel("Imag",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PR=jM({neg_:function(t){const e={x:WM(t,"x","neg")};return VI.runKernel("Neg",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BR=jM({real_:function(t){const e={input:WM(t,"input","real")};return VI.runKernel("Real",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VR=jM({transpose_:function(t,e,n){const r=WM(t,"x","transpose");if(null==e&&(e=r.shape.map(((t,e)=>e)).reverse()),oO(r.rank===e.length,(()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`)),e.forEach((t=>{oO(t>=0&&t<r.rank,(()=>"All entries in 'perm' must be between 0 and "+(r.rank-1)+` but got ${e}`))})),r.rank<=1)return r.clone();const s={x:r},o={perm:e};return"complex64"===r.dtype?DR((()=>{let t=BR(r),e=LR(r);return t=VI.runKernel("Transpose",{x:t},o),e=VI.runKernel("Transpose",{x:e},o),n&&(e=PR(e)),GM(t,e)})):VI.runKernel("Transpose",s,o)}});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zR(t,e){const n=[],r=Math.max(t.length,e.length);for(let s=0;s<r;s++){let r=t[t.length-s-1];null==r&&(r=1);let o=e[e.length-s-1];if(null==o&&(o=1),1===r)n.unshift(o);else if(1===o)n.unshift(r);else{if(r!==o){throw Error(`Operands could not be broadcast together with shapes ${t} and ${e}.`)}n.unshift(r)}}return n}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
let WR;const UR=jM({fromPixels_:function(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,s=!1,o=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)s=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)o=!0;else if(null!=t.getContext)i=!0;else{if(!("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);a=!0}if(s){const e=2;if(s&&t.readyState<e)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=uI("FromPixels",VI.backendName)){const n={pixels:t},r={numChannels:e};return VI.runKernel("FromPixels",n,r)}const[u,c]=s?[t.videoWidth,t.videoHeight]:[t.width,t.height];let l,f;if(i)l=t.getContext("2d").getImageData(0,0,u,c).data;else if(r||n)l=t.data;else if(o||s||a){if(null==WR)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");WR=new OffscreenCanvas(1,1).getContext("2d")}else WR=document.createElement("canvas").getContext("2d");WR.canvas.width=u,WR.canvas.height=c,WR.drawImage(t,0,0,u,c),l=WR.getImageData(0,0,u,c).data}if(4===e)f=new Int32Array(l);else{const t=u*c;f=new Int32Array(t*e);for(let n=0;n<t;n++)for(let t=0;t<e;++t)f[n*e+t]=l[4*n+t]}return function(t,e,n){if(aO(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");const r=BM(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return qM(t,e,r,n)}(f,[c,u,e],"int32")}});function jR(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if("int32"!==e.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===e.size)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(0===t.size)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}!function(t,e,n){const r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${s}.`;if(n.rank<s)throw new Error(o+` update.rank < ${s}. `);if(t.length<r+(n.rank-s))throw new Error(o+` Output shape length < ${r+(n.rank-s)}`);if(n.rank!==s+t.length-r)throw new Error(o+" update.rank != "+(s+t.length-r));for(let t=0;t<s;++t)if(n.shape[t]!==e.shape[t])throw new Error(o+` updates.shape[${t}] (${n.shape[t]}) != indices.shape[${t}] (${e.shape[t]}).`);for(let e=0;e<n.rank-s;++e)if(n.shape[e+s]!==t[e+r])throw new Error(o+` updates.shape[${e+s}] (${n.shape[e+s]}) != shape[${e+s}] (${t[e+s]})`)}(n,e,t)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GR=jM({add_:function(t,e){let n=WM(t,"a","add"),r=WM(e,"b","add");[n,r]=MI(n,r);const s={a:n,b:r};return VI.runKernel("Add",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qR=jM({floorDiv_:function(t,e){let n=WM(t,"a","floorDiv"),r=WM(e,"b","floorDiv");[n,r]=MI(n,r);const s={a:n,b:r};return VI.runKernel("FloorDiv",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HR=jM({div_:function(t,e){let n=WM(t,"a","div"),r=WM(e,"b","div");if([n,r]=MI(n,r),"int32"===n.dtype&&"int32"===r.dtype)return qR(n,r);const s={a:n,b:r};return VI.runKernel("RealDiv",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KR=jM({mul_:function(t,e){let n=WM(t,"a","mul"),r=WM(e,"b","mul");[n,r]=MI(n,r);const s={a:n,b:r};return VI.runKernel("Multiply",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XR=jM({abs_:function(t){const e=WM(t,"x","abs");if("complex64"===e.dtype){const t={x:e};return VI.runKernel("ComplexAbs",t)}{const t={x:e};return VI.runKernel("Abs",t)}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JR=jM({acos_:function(t){const e={x:WM(t,"x","acos")};return VI.runKernel("Acos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YR=jM({acosh_:function(t){const e={x:WM(t,"x","acosh")};return VI.runKernel("Acosh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZR=jM({addN_:function(t){oO(Array.isArray(t),(()=>"The argument passed to tf.addN() must be a list of tensors")),oO(t.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`));const e=t.map(((t,e)=>WM(t,`tensors${e}`,"addN"))),n=e[0];e.forEach((t=>{if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((t=>{if(!lO(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const r=e;return VI.runKernel("AddN",r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QR=jM({all_:function(t,e=null,n=!1){const r={x:WM(t,"x","all","bool")},s={axis:e,keepDims:n};return VI.runKernel("All",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tD=jM({any_:function(t,e=null,n=!1){const r={x:WM(t,"x","any","bool")},s={axis:e,keepDims:n};return VI.runKernel("Any",r,s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eD=jM({argMax_:function(t,e=0){const n={x:WM(t,"x","argMax")},r={axis:e};return VI.runKernel("ArgMax",n,r)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nD=jM({argMin_:function(t,e=0){const n={x:WM(t,"x","argMin")},r={axis:e};return VI.runKernel("ArgMin",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rD=jM({asin_:function(t){const e={x:WM(t,"x","asin")};return VI.runKernel("Asin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sD=jM({asinh_:function(t){const e={x:WM(t,"x","asinh")};return VI.runKernel("Asinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oD=jM({atan_:function(t){const e={x:WM(t,"x","atan")};return VI.runKernel("Atan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iD=jM({atan2_:function(t,e){let n=WM(t,"a","atan2"),r=WM(e,"b","atan2");[n,r]=MI(n,r);const s={a:n,b:r};return VI.runKernel("Atan2",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aD=jM({atanh_:function(t){const e={x:WM(t,"x","atanh")};return VI.runKernel("Atanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uD(t,e,n,r,s,o,i=!1,a="channelsLast"){let[u,c,l,f]=[-1,-1,-1,-1];if("channelsLast"===a)[u,c,l,f]=t;else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);[u,f,c,l]=t}const[h,p,,d]=e,[m,y]=cD(n),[g,b]=cD(r),w=lD(h,g),v=lD(p,b),{padInfo:x,outHeight:N,outWidth:$}=function(t,e,n,r,s,o,i,a,u){let c,l,f;if("number"==typeof t){c={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};const s=function(t,e,n,r,s){null==r&&(r=function(t,e,n,r=1){const s=lD(e,r);return Math.floor((t[0]*(n-1)-n+s)/2)}(t,e,n));const o=t[0],i=t[1],a=fD((o-e+2*r)/n+1,s),u=fD((i-e+2*r)/n+1,s);return[a,u]}([e,n],o,r,t,a);l=s[0],f=s[1]}else if("same"===t){l=Math.ceil(e/r),f=Math.ceil(n/s);const t=Math.max(0,(l-1)*r+o-e),a=Math.max(0,(f-1)*s+i-n),u=Math.floor(t/2),h=t-u,p=Math.floor(a/2);c={top:u,bottom:h,left:p,right:a-p,type:"SAME"}}else if("valid"===t)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-o+1)/r),f=Math.ceil((n-i+1)/s);else{if("object"!=typeof t)throw Error(`Unknown padding parameter: ${t}`);{const h="channelsLast"===u?t[1][0]:t[2][0],p="channelsLast"===u?t[1][1]:t[2][1],d="channelsLast"===u?t[2][0]:t[3][0],m="channelsLast"===u?t[2][1]:t[3][1];c={top:h,bottom:p,left:d,right:m,type:0===h&&0===p&&0===d&&0===m?"VALID":"EXPLICIT"},l=fD((e-o+h+p)/r+1,a),f=fD((n-i+d+m)/s+1,a)}}return{padInfo:c,outHeight:l,outWidth:f}}(s,c,l,m,y,w,v,o,a),E=i?d*f:d;let S;return"channelsFirst"===a?S=[u,E,N,$]:"channelsLast"===a&&(S=[u,N,$,E]),{batchSize:u,dataFormat:a,inHeight:c,inWidth:l,inChannels:f,outHeight:N,outWidth:$,outChannels:E,padInfo:x,strideHeight:m,strideWidth:y,filterHeight:h,filterWidth:p,effectiveFilterHeight:w,effectiveFilterWidth:v,dilationHeight:g,dilationWidth:b,inShape:t,outShape:S,filterShape:e}}function cD(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function lD(t,e){return e<=1?t:t+(t-1)*(e-1)}function fD(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function hD(t){const[e,n,r]=cD(t);return 1===e&&1===n&&1===r}function pD(t,e){return hD(t)||hD(e)}function dD(t,e,n){if(null!=n){if("string"==typeof e)throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if("number"==typeof e)oO(fO(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`));else{if("object"!=typeof e)throw Error(`Error in ${t}: Unknown padding parameter: ${e}`);e.forEach((e=>{e.forEach((e=>{oO(fO(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`))}))}))}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mD=jM({reshape_:function(t,e){const n={x:WM(t,"x","reshape","string_or_numeric")},r={shape:e};return VI.runKernel("Reshape",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yD=jM({avgPool_:function(t,e,n,r,s){const o=WM(t,"x","avgPool","float32");oO(pD(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let i=o,a=!1;3===o.rank&&(a=!0,i=mD(o,[1,o.shape[0],o.shape[1],o.shape[2]])),oO(4===i.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${i.rank}.`)),dD("avgPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s};let l=VI.runKernel("AvgPool",u,c);return l=ER(l,o.dtype),a?mD(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gD=jM({avgPool3d_:function(t,e,n,r,s,o="NDHWC"){const i=WM(t,"x","avgPool3d","float32");let a=i,u=!1;4===i.rank&&(u=!0,a=mD(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),oO(5===a.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`)),oO("NDHWC"===o,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),dD("avgPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o};let f=VI.runKernel("AvgPool3D",c,l);return f=ER(f,a.dtype),u?mD(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bD=jM({concat_:function(t,e=0){oO(t.length>=1,(()=>"Pass at least one tensor to concat"));const n=UM(t,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((t=>{if("complex64"!==t.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${t.dtype}. `)})),1===n.length)return SR(n[0]);const r=n,s={axis:e};return VI.runKernel("Concat",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wD=jM({sigmoid_:function(t){const e={x:WM(t,"x","sigmoid","float32")};return VI.runKernel("Sigmoid",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vD=jM({slice_:function(t,e,n){const r=WM(t,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const s={x:r},o={begin:e,size:n};return VI.runKernel("Slice",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xD=jM({tanh_:function(t){const e={x:WM(t,"x","tanh","float32")};return VI.runKernel("Tanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ND=jM({batchToSpaceND_:function(t,e,n){const r=WM(t,"x","batchToSpaceND"),s=e.reduce(((t,e)=>t*e));oO(r.rank>=1+e.length,(()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`)),oO(n.length===e.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`)),oO(r.shape[0]%s==0,(()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${s}`));const o={x:r},i={blockShape:e,crops:n};return VI.runKernel("BatchToSpaceND",o,i)}});const $D=jM({batchNorm_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s,o){null==o&&(o=.001);const i=WM(t,"x","batchNorm"),a=WM(e,"mean","batchNorm"),u=WM(n,"variance","batchNorm");let c,l;null!=s&&(c=WM(s,"scale","batchNorm")),null!=r&&(l=WM(r,"offset","batchNorm")),oO(a.rank===u.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),oO(null==l||a.rank===l.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),oO(null==c||a.rank===c.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const f=function(t){let e;return e=0===t.rank||1===t.rank?mD(t,[1,1,1,t.size]):2===t.rank?mD(t,[1,1,t.shape[0],t.shape[1]]):3===t.rank?mD(t,[1,t.shape[0],t.shape[1],t.shape[2]]):t,e}(i),h={x:f,scale:c,offset:l,mean:a,variance:u},p={varianceEpsilon:o},d=VI.runKernel("FusedBatchNorm",h,p);return mD(d,i.shape)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ED=jM({bincount_:function(t,e,n){const r=WM(t,"x","bincount"),s=WM(e,"weights","bincount");oO("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),oO(n>=0,(()=>`size must be non-negative, but got ${n}.`)),oO(s.size===r.size||0===s.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${s.shape}.`));const o={x:r,weights:s},i={size:n};return VI.runKernel("Bincount",o,i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SD=jM({broadcastArgs_:function(t,e){const n=WM(t,"s0","broadcastArgs","int32"),r=WM(e,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(1!==r.rank)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const s={s0:n,s1:r};return VI.runKernel("BroadcastArgs",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _D=jM({broadcastTo_:function(t,e){let n=WM(t,"broadcastTo","x");const r=n.shape;if(e.some((t=>!(t>0)||t%1!=0)))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const t=n.shape.slice();for(;t.length<e.length;)t.unshift(1);n=mD(n,t)}const s=n.shape,o=Array.from(e);for(let t=e.length-1;t>=0;t--)if(s[t]===e[t])o[t]=1;else if(1!==n.shape[t])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);const i=o.map(((t,e)=>t>1?e:-1)).filter((t=>t>=0));if(0===i.length)return SR(n);const a={x:n},u={reps:o};return VI.runKernel("Tile",a,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TD=jM({ceil_:function(t){const e={x:WM(t,"x","ceil","float32")};return VI.runKernel("Ceil",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kD=jM({clipByValue_:function(t,e,n){const r=WM(t,"x","clipByValue");oO(e<=n,(()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`));const s={x:r},o={clipValueMin:e,clipValueMax:n};return VI.runKernel("ClipByValue",s,o)}});const AD=jM({concat2d_:function(t,e){return bD(t,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CD=jM({conv2d_:function(t,e,n,r,s="NHWC",o=[1,1],i){const a=WM(t,"x","conv2d","float32"),u=WM(e,"filter","conv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=mD(a,[1,a.shape[0],a.shape[1],a.shape[2]])),oO(4===c.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`)),oO(4===u.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`)),dD("conv2d",r,i);const f="NHWC"===s?c.shape[3]:c.shape[1];oO(f===u.shape[2],(()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`)),oO(pD(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const h={x:c,filter:u},p={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},d=VI.runKernel("Conv2D",h,p);return l?mD(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});const OD=jM({conv1d_:function(t,e,n,r,s="NWC",o=1,i){const a=WM(t,"x","conv1d"),u=WM(e,"filter","conv1d");let c=a,l=!1;2===a.rank&&(l=!0,c=mD(a,[1,a.shape[0],a.shape[1]])),oO(3===c.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`)),oO(3===u.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`)),dD("conv1d",r,i),oO(c.shape[2]===u.shape[1],(()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`)),oO(pD(n,o),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${o}'`)),oO("NWC"===s,(()=>`Error in conv1d: got dataFormat of ${s} but only NWC is currently supported.`));const f=mD(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=mD(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=CD(h,f,[1,n],r,"NHWC",[1,o],i);return mD(p,l?[p.shape[2],p.shape[3]]:[p.shape[0],p.shape[2],p.shape[3]])}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ID=jM({conv2DBackpropInput_:function(t,e,n,r,s,o="NHWC",i){oO(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let a=t,u=e,c=!1;3===e.rank&&(c=!0,u=mD(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),oO(4===a.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`)),oO(4===u.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`)),oO(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const l="NHWC"===o?a[3]:a[1],f="NHWC"===o?u.shape[3]:u.shape[1];oO(l===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[2]}.`)),oO(f===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${n.shape[3]}.`)),dD("conv2dDerInput",s,i);const h={dy:u,filter:n},p={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,inputShape:a},d=VI.runKernel("Conv2DBackpropInput",h,p);return c?mD(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});const MD=jM({conv2dTranspose_:function(t,e,n,r,s,o){const i=WM(t,"x","conv2dTranspose"),a=WM(e,"filter","conv2dTranspose");return ID(n,i,a,r,s,"NHWC",o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RD=jM({conv3d_:function(t,e,n,r,s="NDHWC",o=[1,1,1]){const i=WM(t,"x","conv3d"),a=WM(e,"filter","conv3d");let u=i,c=!1;4===i.rank&&(c=!0,u=mD(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),oO(5===u.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`)),oO(5===a.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`)),oO(u.shape[4]===a.shape[3],(()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${a.shape[3]}.`)),oO(pD(n,o),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),oO("NDHWC"===s,(()=>`Error in conv3d: got dataFormat of ${s} but only NDHWC is currently supported.`));const l={x:u,filter:a},f={strides:n,pad:r,dataFormat:s,dilations:o},h=VI.runKernel("Conv3D",l,f);return c?mD(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DD=jM({cos_:function(t){const e={x:WM(t,"x","cos","float32")};return VI.runKernel("Cos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FD=jM({cosh_:function(t){const e={x:WM(t,"x","cosh","float32")};return VI.runKernel("Cosh",e)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LD=jM({cumprod_:function(t,e=0,n=!1,r=!1){const s={x:WM(t,"x","cumprod")},o={axis:e,exclusive:n,reverse:r};return VI.runKernel("Cumprod",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PD=jM({cumsum_:function(t,e=0,n=!1,r=!1){const s={x:WM(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:r};return VI.runKernel("Cumsum",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BD=jM({denseBincount_:function(t,e,n,r=!1){const s=WM(t,"x","denseBincount"),o=WM(e,"weights","denseBincount");oO("int32"===s.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${s.dtype}`)),oO(s.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${s.rank}.`)),oO(n>=0,(()=>`size must be non-negative, but got ${n}.`)),oO(o.size===s.size||0===o.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${s.shape}, weights shape: ${o.shape}.`));const i={x:s,weights:o},a={size:n,binaryOutput:r};return VI.runKernel("DenseBincount",i,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VD=jM({depthToSpace_:function(t,e,n="NHWC"){const r=WM(t,"x","depthToSpace","float32"),s="NHWC"===n?r.shape[1]:r.shape[2],o="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];oO(e>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`)),oO(s*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${s} and ${e}  for depthToSpace with input shape\n    ${r.shape}`)),oO(o*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${o} and ${e} for depthToSpace with input shape\n        ${r.shape}`)),oO(i%(e*e)==0,(()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${r.shape}`));const a={x:r},u={blockSize:e,dataFormat:n};return VI.runKernel("DepthToSpace",a,u)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zD=jM({depthwiseConv2d_:function(t,e,n,r,s="NHWC",o=[1,1],i){const a=WM(t,"x","depthwiseConv2d","float32"),u=WM(e,"filter","depthwiseConv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=mD(a,[1,a.shape[0],a.shape[1],a.shape[2]])),oO(4===c.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`)),oO(4===u.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`)),oO(c.shape[3]===u.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`)),dD("depthwiseConv2d",r,i);const f={x:c,filter:u},h={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},p=VI.runKernel("DepthwiseConv2dNative",f,h);return l?mD(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WD=jM({dilation2d_:function(t,e,n,r,s=[1,1],o="NHWC"){const i=WM(t,"x","dilation2d"),a=WM(e,"filter","dilation2d");oO(3===i.rank||4===i.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`)),oO(3===a.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`)),oO("NHWC"===o,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`));let u=i,c=!1;3===i.rank&&(u=mD(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=!0);const l={x:u,filter:a},f={strides:n,pad:r,dilations:s},h=VI.runKernel("Dilation2D",l,f);return c?mD(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UD=jM({equal_:function(t,e){let n=WM(t,"a","equal","string_or_numeric"),r=WM(e,"b","equal","string_or_numeric");[n,r]=MI(n,r),zR(n.shape,r.shape);const s={a:n,b:r};return VI.runKernel("Equal",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jD=jM({where_:function(t,e,n){const r=WM(e,"a","where"),s=WM(n,"b","where"),o=WM(t,"condition","where","bool"),i=zR(zR(o.shape,r.shape),s.shape),a={condition:_D(o,i),t:_D(r,i),e:_D(s,i)};return VI.runKernel("Select",a)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GD=jM({zerosLike_:function(t){const e={x:WM(t,"x","zerosLike")};return VI.runKernel("ZerosLike",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qD=jM({divNoNan_:function(t,e){let n=WM(t,"a","div"),r=WM(e,"b","div");[n,r]=MI(n,r);const s=HR(n,r),o=GD(s),i=UD(r,o);return jD(i,o,s)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HD=jM({einsum_:function(t,...e){const n=e.map(((t,e)=>WM(t,`tensors${e}`,"einsum"))),r={equation:t};return VI.runKernel("Einsum",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KD=jM({elu_:function(t){const e={x:WM(t,"x","elu","float32")};return VI.runKernel("Elu",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XD=jM({erf_:function(t){let e=WM(t,"x","erf");oO("int32"===e.dtype||"float32"===e.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===e.dtype&&(e=ER(e,"float32"));const n={x:e};return VI.runKernel("Erf",n)}});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JD(t,e){return function(t,e,n){const r=t.length+e.length,s=[];let o=0,i=0;for(let a=0;a<r;a++)-1===n.indexOf(a)?s.push(t[o++]):s.push(e[i++]);return s}(t,e.map((t=>1)),e)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YD=jM({max_:function(t,e=null,n=!1){const r={x:WM(t,"x","max")},s={reductionIndices:e,keepDims:n};return VI.runKernel("Max",r,s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZD=jM({min_:function(t,e=null,n=!1){const r={x:WM(t,"x","min")},s={axis:e,keepDims:n};return VI.runKernel("Min",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QD=jM({pow_:function(t,e){let n=WM(t,"base","pow"),r=WM(e,"exp","pow");[n,r]=MI(n,r);const s={a:n,b:r};return VI.runKernel("Pow",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tF(t,e){if((dO(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&dO(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return qM(t,[],[],e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eF=jM({sqrt_:function(t){const e={x:WM(t,"x","sqrt","float32")};return VI.runKernel("Sqrt",e)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nF=jM({square_:function(t){const e=WM(t,"x","square");return VI.runKernel("Square",{x:e},{})}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rF=jM({sum_:function(t,e=null,n=!1){let r=WM(t,"x","sum");"bool"===r.dtype&&(r=ER(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return VI.runKernel("Sum",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sF(t,e,n=null){if(0===t.rank)return XR(t);if(1!==t.rank&&null===n)return sF(mD(t,[-1]),e,n);if(1===t.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===e)return rF(XR(t),n);if(e===1/0)return YD(XR(t),n);if(e===-1/0)return ZD(XR(t),n);if("euclidean"===e||2===e)return eF(rF(QD(XR(t),tF(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&2===n.length){if(1===e)return YD(rF(XR(t),n[0]),n[1]-1);if(e===1/0)return YD(rF(XR(t),n[1]),n[0]);if(e===-1/0)return ZD(rF(XR(t),n[1]),n[0]);if("fro"===e||"euclidean"===e)return eF(rF(nF(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const oF=jM({norm_:function(t,e="euclidean",n=null,r=!1){const s=sF(t=WM(t,"x","norm"),e,n);let o=s.shape;if(r){const e=pO(n,t.shape);o=JD(s.shape,e)}return mD(s,o)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iF=jM({euclideanNorm_:function(t,e=null,n=!1){return oF(t,"euclidean",e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aF=jM({exp_:function(t){const e={x:WM(t,"x","exp")};return VI.runKernel("Exp",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uF=jM({expandDims_:function(t,e=0){const n=WM(t,"x","expandDims","string_or_numeric");oO(e<=n.rank,(()=>"Axis must be <= rank of the tensor"));const r={input:n},s={dim:e};return VI.runKernel("ExpandDims",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cF=jM({expm1_:function(t){const e={x:WM(t,"x","expm1")};return VI.runKernel("Expm1",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lF=jM({tile_:function(t,e){const n=WM(t,"x","tile","string_or_numeric");oO(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`));const r={x:n},s={reps:e};return VI.runKernel("Tile",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fF=jM({eye_:function(t,e,n,r="float32"){null==e&&(e=t);const s=$R([t,e],r),o=t<=e?t:e;for(let t=0;t<o;++t)s.set(1,t,t);const i=mD(s.toTensor(),[t,e]);if(null==n)return i;if(1===n.length)return lF(uF(i,0),[n[0],1,1]);if(2===n.length)return lF(uF(uF(i,0),0),[n[0],n[1],1,1]);if(3===n.length)return lF(uF(uF(uF(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hF(t,e,n){const r={shape:t,value:e,dtype:n};return VI.runKernel("Fill",{},r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pF=jM({floor_:function(t){const e={x:WM(t,"x","floor","float32")};return VI.runKernel("Floor",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dF=jM({gather_:function(t,e,n=0,r=0){const s={x:WM(t,"x","gather"),indices:WM(e,"indices","gather","int32")},o={axis:n,batchDims:r};return VI.runKernel("GatherV2",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mF=jM({greater_:function(t,e){let n=WM(t,"a","greater","string_or_numeric"),r=WM(e,"b","greater","string_or_numeric");[n,r]=MI(n,r),zR(n.shape,r.shape);const s={a:n,b:r};return VI.runKernel("Greater",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yF=jM({greaterEqual_:function(t,e){let n=WM(t,"a","greaterEqual","string_or_numeric"),r=WM(e,"b","greaterEqual","string_or_numeric");[n,r]=MI(n,r),zR(n.shape,r.shape);const s={a:n,b:r};return VI.runKernel("GreaterEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gF=jM({isNaN_:function(t){const e={x:WM(t,"x","isNaN")};return VI.runKernel("IsNan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bF=jM({leakyRelu_:function(t,e=.2){const n={x:WM(t,"x","leakyRelu")},r={alpha:e};return VI.runKernel("LeakyRelu",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wF=jM({less_:function(t,e){let n=WM(t,"a","less","string_or_numeric"),r=WM(e,"b","less","string_or_numeric");[n,r]=MI(n,r),zR(n.shape,r.shape);const s={a:n,b:r};return VI.runKernel("Less",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vF=jM({lessEqual_:function(t,e){let n=WM(t,"a","lessEqual","string_or_numeric"),r=WM(e,"b","lessEqual","string_or_numeric");[n,r]=MI(n,r),zR(n.shape,r.shape);const s={a:n,b:r};return VI.runKernel("LessEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xF(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:t,stop:e,num:n};return VI.runKernel("LinSpace",{},r)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NF=jM({localResponseNormalization_:function(t,e=5,n=1,r=1,s=.5){const o=WM(t,"x","localResponseNormalization");oO(4===o.rank||3===o.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${o.rank}.`)),oO(fO(e),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`));let i=o,a=!1;3===o.rank&&(a=!0,i=mD(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const u={x:i},c={depthRadius:e,bias:n,alpha:r,beta:s},l=VI.runKernel("LRN",u,c);return a?mD(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $F=jM({log_:function(t){const e={x:WM(t,"x","log","float32")};return VI.runKernel("Log",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EF=jM({log1p_:function(t){const e={x:WM(t,"x","log1p")};return VI.runKernel("Log1p",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SF(t){return VI.customGrad(t)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _F=jM({softplus_:function(t){const e={x:WM(t,"x","softplus")};return VI.runKernel("Softplus",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TF=jM({sub_:function(t,e){let n=WM(t,"a","sub"),r=WM(e,"b","sub");[n,r]=MI(n,r);const s={a:n,b:r};return VI.runKernel("Sub",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kF=jM({logSoftmax_:function(t,e=-1){const n=WM(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);const r=SF(((t,n)=>{const r=YD(t,e,!0),s=TF(t,r),o=TF(ER(s,"float32"),$F(rF(aF(s),e,!0)));n([o]);return{value:o,gradFunc:(t,n)=>{const[r]=n,s=aF(r);return TF(t,KR(rF(t,e,!0),s))}}}));return r(n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AF=jM({logSumExp_:function(t,e=null,n=!1){const r=WM(t,"x","logSumExp"),s=pO(e,r.shape),o=YD(r,s,!0),i=TF(r,o),a=aF(i),u=rF(a,s),c=$F(u),l=GR(mD(o,c.shape),c);if(n){const t=JD(l.shape,s);return mD(l,t)}return l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CF=jM({logicalAnd_:function(t,e){const n=WM(t,"a","logicalAnd","bool"),r=WM(e,"b","logicalAnd","bool");zR(n.shape,r.shape);const s={a:n,b:r};return VI.runKernel("LogicalAnd",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OF=jM({logicalNot_:function(t){const e={x:WM(t,"x","logicalNot","bool")};return VI.runKernel("LogicalNot",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IF=jM({logicalOr_:function(t,e){const n=WM(t,"a","logicalOr","bool"),r=WM(e,"b","logicalOr","bool");zR(n.shape,r.shape);const s={a:n,b:r};return VI.runKernel("LogicalOr",s)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MF=jM({searchSorted_:function(t,e,n="left"){const r=WM(t,"sortedSequence","searchSorted"),s=WM(e,"values","searchSorted"),o=r.shape[r.shape.length-1],i=s.shape[s.shape.length-1],a=mD(r,[-1,o]),u=mD(s,[-1,i]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(cO(u.shape)>=2147483648)throw new Error("values tensor size must less than 2147483648");if(a.shape[1]>=2147483648)throw new Error(`trailing dim_size must less than 2147483648 for int32 output type, was ${a.shape[1]}`);const c={sortedSequence:a,values:u},l={side:n};return VI.runKernel("SearchSorted",c,l)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RF(t,e){return MF(t,e,"left")}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DF=jM({maxPool_:function(t,e,n,r,s){const o=WM(t,"x","maxPool");let i=o,a=!1;3===o.rank&&(a=!0,i=mD(o,[1,o.shape[0],o.shape[1],o.shape[2]])),oO(4===i.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${i.rank}.`)),oO(pD(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),dD("maxPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s},l=VI.runKernel("MaxPool",u,c);return a?mD(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FF=jM({maxPool3d_:function(t,e=[1,1,1],n,r,s,o="NDHWC"){const i=WM(t,"x","maxPool3d");let a=i,u=!1;4===i.rank&&(u=!0,a=mD(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),oO(5===a.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`)),oO("NDHWC"===o,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),dD("maxPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o},f=VI.runKernel("MaxPool3D",c,l);return u?mD(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LF=jM({maxPoolWithArgmax_:function(t,e,n,r,s=!1){const o={x:WM(t,"x","maxPoolWithArgmax")},i={filterSize:e,strides:n,pad:r,includeBatchInIndex:s},a=VI.runKernel("MaxPoolWithArgmax",o,i);return{result:a[0],indexes:a[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PF=jM({maximum_:function(t,e){let n=WM(t,"a","maximum"),r=WM(e,"b","maximum");[n,r]=MI(n,r),"bool"===n.dtype&&(n=ER(n,"int32"),r=ER(r,"int32")),zR(n.shape,r.shape);const s={a:n,b:r};return VI.runKernel("Maximum",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BF=jM({mean_:function(t,e=null,n=!1){const r={x:WM(t,"x","mean")},s={axis:e,keepDims:n};return VI.runKernel("Mean",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VF(t,e="float32"){if("complex64"===e){const e=VF(t,"float32"),n=VF(t,"float32");return GM(e,n)}const n=$O(cO(t),e);return VI.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zF(t,e="float32"){if("complex64"===e){const e=zF(t,"float32"),n=VF(t,"float32");return GM(e,n)}const n=NO(cO(t),e);return VI.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WF=jM({minimum_:function(t,e){let n=WM(t,"a","minimum"),r=WM(e,"b","minimum");[n,r]=MI(n,r),"bool"===n.dtype&&(n=ER(n,"int32"),r=ER(r,"int32")),zR(n.shape,r.shape);const s={a:n,b:r};return VI.runKernel("Minimum",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UF=jM({mirrorPad_:function(t,e,n){oO("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const r=WM(t,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");oO(e.length===r.rank,(()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`));const s="reflect"===n?1:0;for(let t=0;t<r.rank;t++)oO(2===e[t].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),oO(e[t][0]>=0&&e[t][0]<=r.shape[t]-s&&e[t][1]>=0&&e[t][1]<=r.shape[t]-s,(()=>`Padding in dimension ${t} cannot be greater than or equal to ${r.shape[t]-s} or less than 0 for input of shape ${r.shape}`));const o={paddings:e,mode:n},i={x:r};return VI.runKernel("MirrorPad",i,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jF=jM({mod_:function(t,e){let n=WM(t,"a","mod"),r=WM(e,"b","mod");[n,r]=MI(n,r);const s={a:n,b:r};return VI.runKernel("Mod",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GF=jM({multinomial_:function(t,e,n,r=!1){const s=WM(t,"logits","multinomial"),o=s.size,i=s.rank;if(o<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${o}.`);if(i>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${i}`);n=n||Math.random();const a={logits:1===i?mD(s,[1,-1]):s},u={numSamples:e,seed:n,normalized:r},c=VI.runKernel("Multinomial",a,u);return 1===i?mD(c,[c.size]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qF=jM({notEqual_:function(t,e){let n=WM(t,"a","notEqual","string_or_numeric"),r=WM(e,"b","notEqual","string_or_numeric");[n,r]=MI(n,r),zR(n.shape,r.shape);const s={a:n,b:r};return VI.runKernel("NotEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HF=jM({onesLike_:function(t){const e={x:WM(t,"x","onesLike")};return VI.runKernel("OnesLike",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KF=jM({pad_:function(t,e,n=0){const r=WM(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:n},o={x:r};return VI.runKernel("PadV2",o,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XF=jM({spaceToBatchND_:function(t,e,n){const r=WM(t,"x","spaceToBatchND");oO(r.rank>=1+e.length,(()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`)),oO(n.length===e.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`)),oO(r.shape.reduce(((t,r,s)=>s>0&&s<=e.length?t&&(r+n[s-1][0]+n[s-1][1])%e[s-1]==0:t),!0),(()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`));const s={x:r},o={blockShape:e,paddings:n};return VI.runKernel("SpaceToBatchND",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JF=jM({prelu_:function(t,e){const n={x:WM(t,"x","prelu"),alpha:WM(e,"alpha","prelu")};return VI.runKernel("Prelu",n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YF=jM({prod_:function(t,e=null,n=!1){let r=WM(t,"x","prod");"bool"===r.dtype&&(r=ER(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return VI.runKernel("Prod",s,o)}});var ZF={exports:{}};!function(t,e,n){function r(t){var e=this,n=function(){var t=4022871197,e=function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)};return e}();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}function s(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var n=new r(t),o=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.alea=o}(0,ZF,!1);var QF={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor128=o}(0,QF,!1);var tL={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorwow=o}(0,tL,!1);var eL={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,s=e.i;return t=r[s],n=(t^=t>>>7)^t<<24,n^=(t=r[s+1&7])^t>>>10,n^=(t=r[s+3&7])^t>>>3,n^=(t=r[s+4&7])^t<<7,t=r[s+7&7],n^=(t^=t<<13)^t<<9,r[s]=n,e.i=s+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function s(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.x&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorshift7=o}(0,eL,!1);var nL={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,s=e.X,o=e.i;return e.w=r=r+1640531527|0,n=s[o+34&127],t=s[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=s[o]=n^t,e.i=o,n+(r^r>>>16)|0},function(t,e){var n,r,s,o,i,a=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),s=0,o=-32;o<u;++o)e&&(r^=e.charCodeAt((o+32)%e.length)),0===o&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(i=i+1640531527|0,s=0==(n=a[127&o]^=r+i)?s+1:0);for(s>=128&&(a[127&(e&&e.length||0)]=-1),s=127,o=512;o>0;--o)r=a[s+34&127],n=a[s=s+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,a[s]=r^n;t.w=i,t.X=a,t.i=s}(e,t)}function s(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.X&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor4096=o}(0,nL,!1);var rL={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,s=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^s,s=s-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^s,e.a=s-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.tychei=o}(0,rL,!1);var sL={exports:{}};!function(t){!function(e,n){var r,s=this,o=256,i=n.pow(o,6),a=n.pow(2,52),u=2*a,c=255;function l(t,c,l){var y=[],g=d(p((c=1==c?{entropy:!0}:c||{}).entropy?[t,m(e)]:null==t?function(){try{var t;return r&&(t=r.randomBytes)?t=t(o):(t=new Uint8Array(o),(s.crypto||s.msCrypto).getRandomValues(t)),m(t)}catch(t){var n=s.navigator,i=n&&n.plugins;return[+new Date,s,i,s.screen,m(e)]}}():t,3),y),b=new f(y),w=function(){for(var t=b.g(6),e=i,n=0;t<a;)t=(t+n)*o,e*=o,n=b.g(1);for(;t>=u;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,d(m(b.S),e),(c.pass||l||function(t,e,r,s){return s&&(s.S&&h(s,b),t.state=function(){return h(b,{})}),r?(n.random=t,e):t})(w,g,"global"in c?c.global:this==n,c.state)}function f(t){var e,n=t.length,r=this,s=0,i=r.i=r.j=0,a=r.S=[];for(n||(t=[n++]);s<o;)a[s]=s++;for(s=0;s<o;s++)a[s]=a[i=c&i+t[s%n]+(e=a[s])],a[i]=e;(r.g=function(t){for(var e,n=0,s=r.i,i=r.j,a=r.S;t--;)e=a[s=c&s+1],n=n*o+a[c&(a[s]=a[i=c&i+e])+(a[i]=e)];return r.i=s,r.j=i,n})(o)}function h(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function p(t,e){var n,r=[],s=typeof t;if(e&&"object"==s)for(n in t)try{r.push(p(t[n],e-1))}catch(t){}return r.length?r:"string"==s?t:t+"\0"}function d(t,e){for(var n,r=t+"",s=0;s<r.length;)e[c&s]=c&(n^=19*e[c&s])+r.charCodeAt(s++);return m(e)}function m(t){return String.fromCharCode.apply(0,t)}if(n.seedrandom=l,d(n.random(),e),t.exports){t.exports=l;try{r=require("crypto")}catch(t){}}}([],Math)}(sL);var oL=ZF.exports,iL=QF.exports,aL=tL.exports,uL=eL.exports,cL=nL.exports,lL=rL.exports,fL=sL.exports;fL.alea=oL,fL.xor128=iL,fL.xorwow=aL,fL.xorshift7=uL,fL.xor4096=cL,fL.tychei=lL;var hL=fL;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pL{constructor(t,e,n,r,s){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const o=s||Math.random();this.random=hL.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const t=this.nextVal;return this.nextVal=NaN,t}let t,e,n=!1;for(;!n;){let r,s,o;do{r=2*this.random()-1,s=2*this.random()-1,o=r*r+s*s}while(o>=1||0===o);const i=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*r*i,e=this.mean+this.stdDev*s*i,this.truncated&&!this.isValidTruncated(t)||(n=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class dL{constructor(t=0,e=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=hL.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mL=jM({randomUniform_:function(t,e=0,n=1,r="float32",s){const o=$R(t,r),i=new dL(e,n,null,s);for(let t=0;t<o.values.length;t++)o.values[t]=i.nextValue();return o.toTensor()}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yL(t,e,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");const s={start:t,stop:e,step:n,dtype:r};return VI.runKernel("Range",{},s)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gL=jM({reciprocal_:function(t){const e={x:WM(t,"x","reciprocal")};return VI.runKernel("Reciprocal",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bL=jM({relu_:function(t){const e={x:WM(t,"x","relu")};return VI.runKernel("Relu",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wL=jM({relu6_:function(t){const e={x:WM(t,"x","relu6")};return VI.runKernel("Relu6",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vL=jM({reverse_:function(t,e){const n={x:WM(t,"x","reverse")},r={dims:e};return VI.runKernel("Reverse",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xL=jM({round_:function(t){const e={x:WM(t,"x","round")};return VI.runKernel("Round",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NL=jM({rsqrt_:function(t){const e={x:WM(t,"x","rsqrt","float32")};return VI.runKernel("Rsqrt",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $L=jM({selu_:function(t){const e={x:WM(t,"x","selu")};return VI.runKernel("Selu",e)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EL=async function(t,e){const n=WM(t,"x","setdiff1d"),r=WM(e,"y","setdiff1d");oO(n.dtype===r.dtype,(()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`)),oO(1===n.rank,(()=>`x should be 1D tensor, but got x (${n.shape}).`)),oO(1===r.rank,(()=>`y should be 1D tensor, but got y (${r.shape}).`));const s=await n.data(),o=await r.data(),i=new Set(o);let a=0;for(let t=0;t<s.length;t++)i.has(s[t])||a++;const u=new NI([a],n.dtype),c=new NI([a],"int32");for(let t=0,e=0;t<s.length;t++)i.has(s[t])||(u.values[e]=s[t],c.values[e]=t,e++);return[u.toTensor(),c.toTensor()]};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SL=jM({sign_:function(t){const e={x:WM(t,"x","sign")};return VI.runKernel("Sign",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _L=jM({sin_:function(t){const e={x:WM(t,"x","sin","float32")};return VI.runKernel("Sin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TL=jM({sinh_:function(t){const e={x:WM(t,"x","sinh")};return VI.runKernel("Sinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kL=jM({softmax_:function(t,e=-1){const n=WM(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const r={logits:n},s={dim:e};return VI.runKernel("Softmax",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AL=jM({fft_:function(t){oO("complex64"===t.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`));const e={input:t};return VI.runKernel("FFT",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CL=jM({ifft_:function(t){oO("complex64"===t.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`));const e={input:t};return VI.runKernel("IFFT",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OL=jM({irfft_:function(t){const e=t.shape[t.shape.length-1],n=t.size/e;let r;if(e<=2){const s=mD(t,[n,e]);r=CL(s)}else{const s=[n,2*(e-1)],o=mD(BR(t),[n,e]),i=mD(LR(t),[n,e]),a=vL(vD(o,[0,1],[n,e-2]),1),u=KR(vL(vD(i,[0,1],[n,e-2]),1),tF(-1)),c=bD([o,a],1),l=bD([i,u],1),f=mD(GM(c,l),[s[0],s[1]]);r=CL(f)}if(r=BR(r),3===t.rank&&0!==t.shape[0]){const e=r,n=t.shape[0];r=mD(r,[n,r.shape[0]/n,r.shape[1]]),e.dispose()}return r}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IL=jM({split_:function(t,e,n=0){const r={x:WM(t,"x","split")},s={numOrSizeSplits:e,axis:n};return VI.runKernel("SplitV",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ML=jM({rfft_:function(t,e){oO("float32"===t.dtype,(()=>`The dtype for rfft() must be real value but got ${t.dtype}`));let n=t.shape[t.shape.length-1];const r=t.size/n;let s;if(null!=e&&e<n){const r=t.shape.map((t=>0)),o=t.shape.map((t=>t));o[t.shape.length-1]=e,s=vD(t,r,o),n=e}else if(null!=e&&e>n){const r=t.shape.map((t=>t));r[t.shape.length-1]=e-n,s=bD([t,VF(r)],t.shape.length-1),n=e}else s=t;const o=GD(s),i=mD(GM(s,o),[r,n]),a=AL(i),u=Math.floor(n/2)+1,c=BR(a),l=LR(a),f=IL(c,[u,n-u],c.shape.length-1),h=IL(l,[u,n-u],l.shape.length-1),p=s.shape.slice();return p[s.shape.length-1]=u,mD(GM(f[0],h[0]),p)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RL=jM({squaredDifference_:function(t,e){let n=WM(t,"a","squaredDifference"),r=WM(e,"b","squaredDifference");[n,r]=MI(n,r),zR(n.shape,r.shape);const s={a:n,b:r};return VI.runKernel("SquaredDifference",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DL=jM({squeeze_:function(t,e){const n=WM(t,"x","squeeze");return mD(n,function(t,e){const n=[],r=[],s=null!=e&&Array.isArray(e)&&0===e.length,o=null==e||s?null:pO(e,t).sort();let i=0;for(let e=0;e<t.length;++e){if(null!=o){if(o[i]===e&&1!==t[e])throw new Error(`Can't squeeze axis ${e} since its dim '${t[e]}' is not 1`);(null==o[i]||o[i]>e)&&1===t[e]&&(n.push(t[e]),r.push(e)),o[i]<=e&&i++}1!==t[e]&&(n.push(t[e]),r.push(e))}return{newShape:n,keptDims:r}}(n.shape,e).newShape)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FL=jM({stack_:function(t,e=0){const n=UM(t,"tensors","stack","string_or_numeric");oO(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&oO(e<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const r=n,s={axis:e};return VI.runKernel("Pack",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LL=jM({step_:function(t,e=0){const n={x:WM(t,"x","step")},r={alpha:e};return VI.runKernel("Step",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PL=jM({stridedSlice_:function(t,e,n,r,s=0,o=0,i=0,a=0,u=0){const c={x:WM(t,"x","stridedSlice","string_or_numeric")},l={begin:e,end:n,strides:r,beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};return VI.runKernel("StridedSlice",c,l)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BL=jM({tan_:function(t){const e={x:WM(t,"x","tan","float32")};return VI.runKernel("Tan",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VL(t,e){aO(t);const n=BM(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return qM(t,null,n,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zL(t,e,n){if(aO(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");const r=BM(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return qM(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WL=jM({topk_:function(t,e=1,n=!0){const r=WM(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const s=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const o={x:r},i={k:e,sorted:n},[a,u]=VI.runKernel("TopK",o,i);return{values:a,indices:u}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UL=jM({truncatedNormal_:function(t,e=0,n=1,r,s){if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const o=new pL(e,n,r,!0,s),i=$R(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jL=jM({unique_:function(t,e=0){const n=WM(t,"x","unique","string_or_numeric");oO(n.rank>0,(()=>"The input tensor must be at least 1D"));const r={x:n},s={axis:e},[o,i]=VI.runKernel("Unique",r,s);return{values:o,indices:i}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GL=jM({unstack_:function(t,e=0){const n=WM(t,"x","unstack","string_or_numeric");oO(e>=-n.shape.length&&e<n.shape.length,(()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`));const r={value:n},s={axis:e};return VI.runKernel("Unpack",r,s)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qL(t,e){return MF(t,e,"right")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HL=
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
async function(t){const e=WM(t,"condition","whereAsync","bool"),n=await e.data(),r=function(t,e){const n=[];for(let t=0;t<e.length;t++)e[t]&&n.push(t);const r=$R(t,"int32"),s=$R([n.length,t.length],"int32");for(let e=0;e<n.length;e++){const o=r.indexToLoc(n[e]),i=e*t.length;s.values.set(o,i)}return s.toTensor()}(e.shape,n);return t!==e&&e.dispose(),r};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KL=jM({scatterND_:function(t,e,n){const r=WM(t,"indices","scatterND","int32"),s=WM(e,"updates","scatterND");jR(s,r,n);const o={indices:r,updates:s},i={shape:n};return VI.runKernel("ScatterNd",o,i)}});const XL=jM({sparseToDense_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=0){const s=WM(t,"sparseIndices","sparseToDense","int32"),o=WM(e,"sparseValues","sparseToDense","string_or_numeric"),i=WM(r,"defaultValue","sparseToDense",o.dtype);!function(t,e,n,r){if("int32"!==t.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const s=t.rank>0?t.shape[0]:1,o=t.rank>1?t.shape[1]:1;if(n.length!==o)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${o}.`);const i=e.size;if(0!==e.rank&&(1!==e.rank||i!==s))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${s}]`);if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(s,o,n,i);const a={sparseIndices:s,sparseValues:o,defaultValue:i},u={outputShape:n};return VI.runKernel("SparseToDense",a,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JL=jM({gatherND_:function(t,e){const n=WM(e,"indices","gatherND","int32"),r={params:WM(t,"x","gatherND","string_or_numeric"),indices:n};return VI.runKernel("GatherNd",r)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YL(t,e,n){const r=1-t%2,s=new Float32Array(t);for(let o=0;o<t;++o){const i=2*Math.PI*o/(t+r-1);s[o]=e-n*Math.cos(i)}return VL(s,"float32")}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZL=jM({conv2DBackpropFilter_:function(t,e,n,r,s,o="NHWC",i){let a=t;3===t.rank&&(a=mD(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=mD(e,[1,e.shape[0],e.shape[1],e.shape[2]])),oO(4===a.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`)),oO(4===u.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`)),oO(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const c="NHWC"===o?a.shape[3]:a.shape[1],l="NHWC"===o?u.shape[3]:u.shape[1];oO(c===n[2],(()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`)),oO(l===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${l}) must match output depth for filter (${n[3]}).`)),dD("conv2dDerFilter",s,i);const f={x:a,dy:u},h={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,filterShape:n};return VI.runKernel("Conv2DBackpropFilter",f,h)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QL(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return KR(t,LL(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function tP(t,e){let n=e;const r=function(t,e){const n=[];for(let r=0;r<e.length;r++){const s=t[t.length-r-1],o=e.length-r-1,i=e[o];(null==s||1===s&&i>1)&&n.unshift(o)}return n}(t.shape,e.shape);return r.length>0&&(n=rF(n,r)),mD(n,t.shape)}function eP(t,e,n,r){if("linear"===e)return t;if("relu"===e)return bL(t);if("elu"===e)return KD(t);if("relu6"===e)return wL(t);if("prelu"===e)return JF(t,n);if("leakyrelu"===e)return bF(t,r);if("sigmoid"===e)return wD(t);throw new Error(`Unknown fused activation ${e}.`)}const nP=(t,e)=>!(t>0)||"linear"===e;
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rP=jM({fusedConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(u=u||"linear",!1===nP(VI.state.gradientDepth,u)){oO("NHWC"===s,(()=>`Error in fused conv2d: got dataFormat of ${s} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`));let f=CD(t,e,n,r,s,o,i);return null!=a&&(f=GR(f,a)),eP(f,u,c,l)}const f=WM(t,"x","conv2d","float32"),h=WM(e,"filter","conv2d","float32");let p=f,d=!1;3===f.rank&&(d=!0,p=mD(f,[1,f.shape[0],f.shape[1],f.shape[2]])),oO(4===p.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`)),oO(4===h.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`)),dD("fused conv2d",r,i);const m="NHWC"===s?p.shape[3]:p.shape[1];oO(h.shape[2]===m,(()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${h.shape[2]}.`)),oO(pD(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const y=uD(p.shape,h.shape,n,o,r,i);let g,b;if(null!=a&&(g=WM(a,"bias","fused conv2d"),[g]=MI(g,f),"NHWC"===s?zR(y.outShape,g.shape):(oO(g.shape.length<=1,(()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${g.shape.length}.`)),oO(0===g.shape.length||g.shape[0]===y.outChannels||1===g.shape[0],(()=>`Error in fused conv2d: bias shape (${g.shape}) is not compatible with the number of output channels (${y.outChannels})`)))),null!=c){const t=c.shape;if(oO(t.length<=1||3===t.length,(()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${t.length}.`)),1===t.length)oO(1===t[0]||t[0]===y.outChannels,(()=>`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the number of output channels (${y.outChannels}).`));else if(3===t.length)try{zR(t,y.outShape)}catch(e){const n=`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the output shape of the conv2d (${y.outShape}).`;throw Error(n)}b=WM(c,"prelu weights","fused conv2d")}const w=(t,e)=>{oO("NHWC"===s,(()=>`Error in gradient of fused conv2D: got dataFormat of ${s} but only NHWC is currently supported.`));const[i,a,c,l]=e,f=QL(t,c,u);oO(hD(o),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`));const h=[ID(a.shape,f,i,n,r),ZL(a,f,i.shape,n,r)];if(null!=l){const t=tP(l,f);h.push(t)}return h},v={x:p,filter:h,bias:g,preluActivationWeights:b},x={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=SF(((t,e,n)=>{let r=VI.runKernel("FusedConv2D",v,x);return n([e,t,r]),d&&(r=mD(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:w}}));return t(p,h)}{const t=SF(((t,e,n,r)=>{let s=VI.runKernel("FusedConv2D",v,x);return r([e,t,s,n]),d&&(s=mD(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:w}}));return t(p,h,g)}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sP=jM({depthwiseConv2dNativeBackpropFilter_:function(t,e,n,r,s,o=[1,1],i){let a=t;3===t.rank&&(a=mD(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=mD(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:u},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,filterShape:n};return VI.runKernel("DepthwiseConv2dNativeBackpropFilter",c,l)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oP=jM({depthwiseConv2dNativeBackpropInput_:function(t,e,n,r,s,o=[1,1],i){let a=e,u=!1;3===e.rank&&(u=!0,a=mD(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,inputShape:t},f=VI.runKernel("DepthwiseConv2dNativeBackpropInput",c,l);return u?mD(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iP=jM({fusedDepthwiseConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(!1===nP(VI.state.gradientDepth,u)){let f=zD(t,e,n,r,s,o,i);return null!=a&&(f=GR(f,a)),eP(f,u,c,l)}const f=WM(t,"x","depthwiseConv2d","float32"),h=WM(e,"filter","depthwiseConv2d","float32");let p=f,d=!1;3===f.rank&&(d=!0,p=mD(f,[1,f.shape[0],f.shape[1],f.shape[2]])),oO(4===p.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`)),oO(4===h.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`)),oO(p.shape[3]===h.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${p.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`)),null==o&&(o=[1,1]),oO(pD(n,o),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),dD("fused depthwiseConv2d",r,i);const m=uD(p.shape,h.shape,n,o,r,i,!0);let y,g;null!=a&&(y=WM(a,"bias","fused conv2d"),[y]=MI(y,f),zR(m.outShape,y.shape)),null!=c&&(g=WM(c,"prelu weights","fused depthwiseConv2d"));const b=(t,e)=>{oO(hD(o),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`));const[s,a,c,l]=e,f=QL(t,c,u),h=oP(a.shape,f,s,n,r,o,i),p=sP(a,f,s.shape,n,r,o,i);if(null!=l){return[h,p,tP(y,f)]}return[h,p]},w={x:p,filter:h,bias:y,preluActivationWeights:g},v={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=SF(((t,e,n)=>{let r=VI.runKernel("FusedDepthwiseConv2D",w,v);return n([e,t,r]),d&&(r=mD(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}}));return t(p,h)}{const t=SF(((t,e,n,r)=>{let s=VI.runKernel("FusedDepthwiseConv2D",w,v);return r([e,t,s,n]),d&&(s=mD(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:b}}));return t(p,h,y)}}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aP=jM({fusedMatMul_:function({a:t,b:e,transposeA:n=!1,transposeB:r=!1,bias:s,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a}){if(!1===nP(VI.state.gradientDepth,o)){let u=MR(t,e,n,r);return null!=s&&(u=GR(u,s)),eP(u,o,i,a)}let u=WM(t,"a","fused matMul"),c=WM(e,"b","fused matMul");[u,c]=MI(u,c);const l=n?u.shape[u.rank-2]:u.shape[u.rank-1],f=r?c.shape[c.rank-1]:c.shape[c.rank-2],h=n?u.shape[u.rank-1]:u.shape[u.rank-2],p=r?c.shape[c.rank-2]:c.shape[c.rank-1],d=u.shape.slice(0,-2),m=c.shape.slice(0,-2),y=cO(d),g=cO(m);oO(l===f,(()=>`Error in fused matMul: inner shapes (${l}) and (${f}) of Tensors with shapes ${u.shape} and ${c.shape} and transposeA=${n} and transposeB=${r} must match.`));const b=zR(u.shape.slice(0,-2),c.shape.slice(0,-2)).concat([h,p]),w=mD(u,n?[y,l,h]:[y,h,l]),v=mD(c,r?[g,p,f]:[g,f,p]);let x,N;null!=s&&(x=WM(s,"bias","fused matMul"),[x]=MI(x,u),zR(b,x.shape)),null!=i&&(N=WM(i,"prelu weights","fused matMul"));const $=(t,e)=>{const[i,a,u,c]=e,l=QL(mD(t,u.shape),u,o);let f,h;if(n||r?!n&&r?(f=MR(l,a,!1,!1),h=MR(l,i,!0,!1)):n&&!r?(f=MR(a,l,!1,!0),h=MR(i,l,!1,!1)):(f=MR(a,l,!0,!0),h=MR(l,i,!0,!0)):(f=MR(l,a,!1,!0),h=MR(i,l,!0,!1)),null!=s){return[f,h,tP(c,l)]}return[f,h]},E={a:w,b:v,bias:x,preluActivationWeights:N},S={transposeA:n,transposeB:r,activation:o,leakyreluAlpha:a};if(null==s){const t=SF(((t,e,n)=>{const r=VI.runKernel("_FusedMatMul",E,S);return n([t,e,r]),{value:mD(r,b),gradFunc:$}}));return t(w,v)}{const t=SF(((t,e,n,r)=>{const s=VI.runKernel("_FusedMatMul",E,S);return r([t,e,s,n]),{value:mD(s,b),gradFunc:$}}));return t(w,v,x)}}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */jM({hammingWindow_:function(t){return YL(t,.54,.46)}});const uP=jM({hannWindow_:
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){return YL(t,.5,.5)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cP=jM({frame_:function(t,e,n,r=!1,s=0){let o=0;const i=[];for(;o+e<=t.size;)i.push(vD(t,o,e)),o+=n;if(r)for(;o<t.size;){const r=o+e-t.size,a=bD([vD(t,o,e-r),hF([r],s)]);i.push(a),o+=n}return 0===i.length?zL([],[0,e]):mD(bD(i),[i.length,e])}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */jM({stft_:function(t,e,n,r,s=uP){var o;null==r&&(o=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));const i=cP(t,e,n),a=KR(i,s(e));return ML(a,r)}});const lP=jM({cropAndResize_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s="bilinear",o=0){const i=WM(t,"image","cropAndResize"),a=WM(e,"boxes","cropAndResize","float32"),u=WM(n,"boxInd","cropAndResize","int32"),c=a.shape[0];oO(4===i.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`)),oO(2===a.rank&&4===a.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`)),oO(1===u.rank&&u.shape[0]===c,(()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`)),oO(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),oO(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),oO("bilinear"===s||"nearest"===s,(()=>`method must be bilinear or nearest, but was ${s}`));const l={image:i,boxes:a,boxInd:u},f={method:s,extrapolationValue:o,cropSize:r};return VI.runKernel("CropAndResize",l,f)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fP=jM({flipLeftRight_:function(t){const e=WM(t,"image","flipLeftRight","float32");oO(4===e.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`));const n={image:e};return VI.runKernel("FlipLeftRight",n,{})}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hP=jM({grayscaleToRGB_:function(t){const e=WM(t,"image","grayscaleToRGB"),n=e.rank-1,r=e.shape[n];oO(e.rank>=2,(()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`)),oO(1===r,(()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`));const s=new Array(e.rank);return s.fill(1,0,n),s[n]=3,lF(e,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pP=jM({rotateWithOffset_:function(t,e,n=0,r=.5){const s=WM(t,"image","rotateWithOffset","float32");oO(4===s.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${s.rank}.`));const o={image:s},i={radians:e,fillValue:n,center:r};return VI.runKernel("RotateWithOffset",o,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dP(t,e,n,r,s,o){null==r&&(r=.5),null==s&&(s=Number.NEGATIVE_INFINITY),null==o&&(o=0);const i=t.shape[0];return n=Math.min(n,i),oO(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),oO(2===t.rank,(()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`)),oO(4===t.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`)),oO(1===e.rank,(()=>"scores must be a 1D tensor")),oO(e.shape[0]===i,(()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`)),oO(0<=o&&o<=1,(()=>`softNmsSigma must be in [0, 1], but was '${o}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:s,softNmsSigma:o}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mP=jM({nonMaxSuppression_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const o=WM(t,"boxes","nonMaxSuppression","float32"),i=WM(e,"scores","nonMaxSuppression","float32"),a=dP(o,i,n,r,s),u={maxOutputSize:n=a.maxOutputSize,iouThreshold:r=a.iouThreshold,scoreThreshold:s=a.scoreThreshold};return VI.runKernel("NonMaxSuppressionV3",{boxes:o,scores:i},u)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yP(t,e,n){const r=function(t,e,n){return function(t,e,n){let r=0,s=t.length,o=0,i=!1;for(;r<s;){o=r+(s-r>>>1);const a=n(e,t[o]);a>0?r=o+1:(s=o,i=!a)}return i?r:-r-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e,n||gP)}(t,e,n),s=r<0?-(r+1):r;t.splice(s,0,e)}function gP(t,e){return t>e?1:t<e?-1:0}function bP(t,e,n,r,s,o,i=!1,a=!1,u=!1){const c=[];for(let t=0;t<e.length;t++)e[t]>s&&c.push({score:e[t],boxIndex:t,suppressBeginIndex:0});c.sort(xP);const l=o>0?-.5/o:0,f=[],h=[];for(;f.length<n&&c.length>0;){const e=c.pop(),{score:n,boxIndex:o,suppressBeginIndex:i}=e;if(n<s)break;let a=!1;for(let n=f.length-1;n>=i;--n){const i=wP(t,o,f[n]);if(i>=r){a=!0;break}if(e.score=e.score*vP(r,l,i),e.score<=s)break}e.suppressBeginIndex=f.length,a||(e.score===n?(f.push(o),h.push(e.score)):e.score>s&&yP(c,e,xP))}const p=f.length,d=n-p;a&&d>0&&(f.push(...new Array(d).fill(0)),h.push(...new Array(d).fill(0)));const m={selectedIndices:f};return i&&(m.selectedScores=h),u&&(m.validOutputs=p),m}function wP(t,e,n){const r=t.subarray(4*e,4*e+4),s=t.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(s[0],s[2]),l=Math.min(s[1],s[3]),f=Math.max(s[0],s[2]),h=Math.max(s[1],s[3]),p=(a-o)*(u-i),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;const m=Math.max(o,c),y=Math.max(i,l),g=Math.min(a,f),b=Math.min(u,h),w=Math.max(g-m,0)*Math.max(b-y,0);return w/(p+d-w)}function vP(t,e,n){const r=Math.exp(e*n*n);return n<=t?r:0}function xP(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NP=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const o=WM(t,"boxes","nonMaxSuppressionAsync"),i=WM(e,"scores","nonMaxSuppressionAsync"),a=dP(o,i,n,r,s);n=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;const u=await Promise.all([o.data(),i.data()]),c=u[0],l=u[1],{selectedIndices:f}=function(t,e,n,r,s){return bP(t,e,n,r,s,0)}(c,l,n,r,s);return o!==t&&o.dispose(),i!==e&&i.dispose(),VL(f,"int32")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $P=jM({nonMaxSuppressionWithScore_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=WM(t,"boxes","nonMaxSuppression"),a=WM(e,"scores","nonMaxSuppression"),u=dP(i,a,n,r,s,o),c={boxes:i,scores:a},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:s=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},f=VI.runKernel("NonMaxSuppressionV5",c,l);return{selectedIndices:f[0],selectedScores:f[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EP=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=WM(t,"boxes","nonMaxSuppressionAsync"),a=WM(e,"scores","nonMaxSuppressionAsync"),u=dP(i,a,n,r,s,o);n=u.maxOutputSize,r=u.iouThreshold,s=u.scoreThreshold,o=u.softNmsSigma;const c=await Promise.all([i.data(),a.data()]),l=c[0],f=c[1],{selectedIndices:h,selectedScores:p}=function(t,e,n,r,s,o){return bP(t,e,n,r,s,o,!0)}(l,f,n,r,s,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:VL(h,"int32"),selectedScores:VL(p)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SP=jM({nonMaxSuppressionPadded_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=WM(t,"boxes","nonMaxSuppression"),a=WM(e,"scores","nonMaxSuppression"),u=dP(i,a,n,r,s,null),c={boxes:i,scores:a},l={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:o},f=VI.runKernel("NonMaxSuppressionV4",c,l);return{selectedIndices:f[0],validOutputs:f[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _P=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=WM(t,"boxes","nonMaxSuppressionAsync"),a=WM(e,"scores","nonMaxSuppressionAsync"),u=dP(i,a,n,r,s,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[h,p]=await Promise.all([i.data(),a.data()]),{selectedIndices:d,validOutputs:m}=function(t,e,n,r,s,o){return bP(t,e,n,r,s,0,!1,o,!0)}(h,p,c,l,f,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:VL(d,"int32"),validOutputs:tF(m,"int32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TP=jM({resizeBilinear_:function(t,e,n=!1,r=!1){const s=WM(t,"images","resizeBilinear");oO(3===s.rank||4===s.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${s.rank}.`)),oO(2===e.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`)),oO(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=mD(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=VI.runKernel("ResizeBilinear",a,u);return i?mD(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kP=jM({resizeNearestNeighbor_:function(t,e,n=!1,r=!1){const s=WM(t,"images","resizeNearestNeighbor");oO(3===s.rank||4===s.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${s.rank}.`)),oO(2===e.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`)),oO("float32"===s.dtype||"int32"===s.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),oO(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=mD(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=VI.runKernel("ResizeNearestNeighbor",a,u);return i?mD(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AP=jM({threshold_:function(t,e="binary",n=!1,r=.5){const s=WM(t,"image","threshold"),o=s.shape[0]*s.shape[1];let i,a,u,c,l=KR(VL([r]),255);if(oO(3===s.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${s.rank}.`)),oO(3===s.shape[2]||1===s.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${s.shape[2]}.`)),oO("int32"===s.dtype||"float32"===s.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${s.dtype}.`)),oO("otsu"===e||"binary"===e,(()=>`Method must be binary or otsu, but was ${e}`)),3===s.shape[2]){[i,a,u]=IL(s,[1,1,1],-1);const t=KR(i,.2989),e=KR(a,.587),n=KR(u,.114);c=GR(GR(t,e),n)}else c=t;if("otsu"===e){l=function(t,e){let n,r,s,o,i,a,u=VL([-1]),c=VL([0]),l=VL([0]);for(let f=0;f<t.size-1;f++){n=vD(t,0,f+1),r=vD(t,f+1),i=HR(rF(n),e),a=HR(rF(r),e);const h=rF(KR(n,yL(0,n.size)));s=HR(h,rF(n));const p=hF(r.shape,n.size),d=GR(yL(0,r.size),p),m=KR(r,d);o=HR(rF(m),rF(r));const y=TF(s,o),g=TF(s,o),b=KR(i,a);l=KR(KR(b,y),g);const w=mF(l,c);c=jD(w,l,c),u=jD(w,VL([f]),u)}return u}(ED(ER(xL(c),"int32"),HM([]),256),o)}const f=n?vF(c,l):mF(c,l);return ER(KR(f,255),"int32")}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CP=jM({transform_:function(t,e,n="nearest",r="constant",s=0,o){const i=WM(t,"image","transform","float32"),a=WM(e,"transforms","transform","float32");oO(4===i.rank,(()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`)),oO(2===a.rank&&(a.shape[0]===i.shape[0]||1===a.shape[0])&&8===a.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),oO(null==o||2===o.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`));const u={image:i,transforms:a},c={interpolation:n,fillMode:r,fillValue:s,outputShape:o};return VI.runKernel("Transform",u,c)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OP(t,e=!1){return VI.tidy((()=>{oO(2===t.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`));const n=t.shape[0],r=t.shape[1];let s=fF(n),o=SR(t);const i=zL([[1]],[1,1]);let a=SR(i);const u=n>=r?r:n;for(let t=0;t<u;++t){const e=o,u=a,c=s;[a,o,s]=VI.tidy((()=>{const e=vD(o,[t,t],[n-t,1]),u=oF(e),c=vD(o,[t,t],[1,1]),l=jD(mF(c,0),zL([[-1]]),zL([[1]])),f=TF(c,KR(l,u)),h=HR(e,f);a=1===h.shape[0]?SR(i):bD([i,vD(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);const p=PR(HR(MR(l,f),u)),d=vD(o,[t,0],[n-t,r]),m=KR(p,a),y=VR(a);if(0===t)o=TF(d,MR(m,MR(y,d)));else{const e=TF(d,MR(m,MR(y,d)));o=bD([vD(o,[0,0],[t,r]),e],0)}const g=VR(m),b=vD(s,[0,t],[n,s.shape[1]-t]);if(0===t)s=TF(b,MR(MR(b,a),g));else{const e=TF(b,MR(MR(b,a),g));s=bD([vD(s,[0,0],[n,t]),e],1)}return[a,o,s]})),RI([e,u,c]).forEach((t=>t.dispose()))}return!e&&n>r&&(s=vD(s,[0,0],[n,r]),o=vD(o,[0,0],[r,r])),[s,o]}))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var IP;jM({bandPart_:function(t,e,n){oO(e%1==0,(()=>`bandPart(): numLower must be an integer, got ${e}.`)),oO(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`));const r=WM(t,"a","bandPart");oO(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));const s=r.shape,[o,i]=r.shape.slice(-2);if(!(e<=o))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`);if(!(n<=i))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${i}).`);e<0&&(e=o),n<0&&(n=i);const a=mD(yL(0,o,1,"int32"),[-1,1]),u=yL(0,i,1,"int32"),c=TF(a,u),l=CF(vF(c,tF(+e,"int32")),yF(c,tF(-n,"int32"))),f=VF([o,i],r.dtype);return mD(FL(GL(mD(r,[-1,o,i])).map((t=>jD(l,t,f)))),s)}}),jM({gramSchmidt_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){let e;if(Array.isArray(t)){e=!1,oO(null!=t&&t.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=t[0].shape[0];for(let e=1;e<t.length;++e)oO(t[e].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[e].shape[0]} vs. ${n})`))}else e=!0,t=IL(t,t.shape[0],0).map((t=>DL(t,[0])));oO(t.length<=t[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`));const n=[],r=t;for(let e=0;e<t.length;++e)n.push(VI.tidy((()=>{let t=r[e];if(e>0)for(let r=0;r<e;++r){const e=KR(rF(KR(n[r],t)),n[r]);t=TF(t,e)}return HR(t,oF(t,"euclidean"))})));return e?FL(n,0):n}}),jM({qr_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=!1){if(oO(t.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`)),2===t.rank)return OP(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce(((t,e)=>t*e)),r=GL(mD(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),s=[],o=[];r.forEach((t=>{const[n,r]=OP(t,e);s.push(n),o.push(r)}));return[mD(FL(s,0),t.shape),mD(FL(o,0),t.shape)]}}}),function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(IP||(IP={}));const MP=jM({computeWeightedLoss_:function(t,e,n=IP.SUM_BY_NONZERO_WEIGHTS){const r=WM(t,"losses","computeWeightedLoss");let s=null;null!=e&&(s=WM(e,"weights","computeWeightedLoss"));const o=null==s?r:KR(r,s);if(n===IP.NONE)return o;if(n===IP.SUM)return rF(o);if(n===IP.MEAN){if(null==s)return BF(o);{const t=r.size/s.size,e=HR(rF(o),rF(s));return t>1?HR(e,tF(t)):e}}if(n===IP.SUM_BY_NONZERO_WEIGHTS){if(null==s)return HR(rF(o),tF(r.size));{const t=KR(s,zF(r.shape)),e=ER(rF(qF(t,tF(0))),"float32");return HR(rF(o),e)}}throw Error(`Unknown reduction: ${n}`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */jM({absoluteDifference_:function(t,e,n,r=IP.SUM_BY_NONZERO_WEIGHTS){const s=WM(t,"labels","absoluteDifference"),o=WM(e,"predictions","absoluteDifference");let i=null;null!=n&&(i=WM(n,"weights","absoluteDifference")),iO(s.shape,o.shape,"Error in absoluteDifference: ");const a=XR(TF(s,o));return MP(a,i,r)}}),jM({cosineDistance_:function(t,e,n,r,s=IP.SUM_BY_NONZERO_WEIGHTS){const o=WM(t,"labels","cosineDistance"),i=WM(e,"predictions","cosineDistance");let a=null;null!=r&&(a=WM(r,"weights","cosineDistance")),iO(o.shape,i.shape,"Error in cosineDistance: ");const u=tF(1),c=TF(u,rF(KR(o,i),n,!0));return MP(c,a,s)}}),jM({hingeLoss_:function(t,e,n,r=IP.SUM_BY_NONZERO_WEIGHTS){let s=WM(t,"labels","hingeLoss");const o=WM(e,"predictions","hingeLoss");let i=null;null!=n&&(i=WM(n,"weights","hingeLoss")),iO(s.shape,o.shape,"Error in hingeLoss: ");const a=tF(1);s=TF(KR(tF(2),s),a);const u=bL(TF(a,KR(s,o)));return MP(u,i,r)}}),jM({huberLoss_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=1,s=IP.SUM_BY_NONZERO_WEIGHTS){const o=WM(t,"labels","huberLoss"),i=WM(e,"predictions","huberLoss");let a=null;null!=n&&(a=WM(n,"weights","huberLoss")),iO(o.shape,i.shape,"Error in huberLoss: ");const u=tF(r),c=XR(TF(i,o)),l=WF(c,u),f=TF(c,l),h=GR(KR(tF(.5),nF(l)),KR(u,f));return MP(h,a,s)}}),jM({logLoss_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=1e-7,s=IP.SUM_BY_NONZERO_WEIGHTS){const o=WM(t,"labels","logLoss"),i=WM(e,"predictions","logLoss");let a=null;null!=n&&(a=WM(n,"weights","logLoss")),iO(o.shape,i.shape,"Error in logLoss: ");const u=tF(1),c=tF(r),l=PR(KR(o,$F(GR(i,c)))),f=KR(TF(u,o),$F(GR(TF(u,i),c))),h=TF(l,f);return MP(h,a,s)}}),jM({meanSquaredError_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=IP.SUM_BY_NONZERO_WEIGHTS){const s=WM(t,"labels","meanSquaredError"),o=WM(e,"predictions","meanSquaredError");let i=null;null!=n&&(i=WM(n,"weights","meanSquaredError")),iO(s.shape,o.shape,"Error in meanSquaredError: ");const a=RL(s,o);return MP(a,i,r)}}),jM({sigmoidCrossEntropy_:function(t,e,n,r=0,s=IP.SUM_BY_NONZERO_WEIGHTS){let o=WM(t,"multiClassLabels","sigmoidCrossEntropy");const i=WM(e,"logits","sigmoidCrossEntropy");let a=null;if(null!=n&&(a=WM(n,"weights","sigmoidCrossEntropy")),iO(o.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){const t=tF(r),e=tF(1),n=tF(.5);o=GR(KR(o,TF(e,t)),KR(n,t))}const u=
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=WM(t,"labels","sigmoidCrossEntropyWithLogits"),r=WM(e,"logits","sigmoidCrossEntropyWithLogits");iO(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const s=bL(r),o=KR(r,n),i=EF(aF(PR(XR(r))));return GR(TF(s,o),i)}(o,i);return MP(u,a,s)}}),jM({softmaxCrossEntropy_:function(t,e,n,r=0,s=IP.SUM_BY_NONZERO_WEIGHTS){let o=WM(t,"onehotLabels","softmaxCrossEntropy");const i=WM(e,"logits","softmaxCrossEntropy");let a=null;if(null!=n&&(a=WM(n,"weights","softmaxCrossEntropy")),iO(o.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){const t=tF(r),e=tF(1),n=tF(o.shape[1]);o=GR(KR(o,TF(e,t)),HR(t,n))}const u=
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n=-1){if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);const r=SF(((t,e,r)=>{const s=AF(e,[n],!0),o=TF(ER(e,"float32"),s);r([t,o]);const i=PR(KR(o,t));return{value:rF(i,[n]),gradFunc:(t,e)=>{const[r,s]=e,o=JD(t.shape,[n]);return[KR(mD(t,o),TF(ER(r,"float32"),aF(s))),KR(mD(t,o),TF(aF(s),ER(r,"float32")))]}}}));return r(t,e)}(o,i);return MP(u,a,s)}});const RP=jM({sparseFillEmptyRows_:
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const s=WM(t,"indices","sparseFillEmptyRows","int32"),o=WM(e,"values","sparseFillEmptyRows"),i=WM(n,"denseShape","sparseFillEmptyRows","int32"),a=WM(r,"defaultValue","sparseFillEmptyRows",o.dtype);if(2!==s.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${s.shape}`);if(1!==o.rank)throw new Error(`Values should be Tensor1D but received shape ${o.shape}`);if(1!==i.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${i.shape}`);if(0!==a.rank)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const u={indices:s,values:o,denseShape:i,defaultValue:a},c=VI.runKernel("SparseFillEmptyRows",u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DP=jM({sparseReshape_:function(t,e,n){const r=WM(t,"inputIndices","sparseReshape","int32"),s=WM(e,"inputShape","sparseReshape","int32"),o=WM(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==s.rank)throw new Error(`Input shape should be Tensor1D but received shape ${s.shape}`);if(1!==o.rank)throw new Error(`New shape should be Tensor1D but received shape ${o.shape}`);const i={inputIndices:r,inputShape:s,newShape:o},a=VI.runKernel("SparseReshape",i);return{outputIndices:a[0],outputShape:a[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FP=jM({sparseSegmentMean_:function(t,e,n){const r=WM(t,"data","sparseSegmentMean"),s=WM(e,"indices","sparseSegmentMean","int32"),o=WM(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return VI.runKernel("SparseSegmentMean",i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LP=jM({sparseSegmentSum_:function(t,e,n){const r=WM(t,"data","sparseSegmentSum"),s=WM(e,"indices","sparseSegmentSum","int32"),o=WM(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return VI.runKernel("SparseSegmentSum",i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PP=jM({stringNGrams_:function(t,e,n,r,s,o,i,a){const u=WM(t,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error(`Data must be a vector, saw: ${u.shape}`);const c=WM(e,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");const l={separator:n,nGramWidths:r,leftPad:s,rightPad:o,padWidth:i,preserveShortSequences:a},f={data:u,dataSplits:c},h=VI.runKernel("StringNGrams",f,l);return{nGrams:h[0],nGramsSplits:h[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BP=jM({stringSplit_:function(t,e,n=!0){const r=WM(t,"input","stringSplit","string"),s=WM(e,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(0!==s.rank)throw new Error(`Delimiter should be a scalar but received shape ${s.shape}`);const o={skipEmpty:n},i={input:r,delimiter:s},a=VI.runKernel("StringSplit",i,o);return{indices:a[0],values:a[1],shape:a[2]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VP=jM({stringToHashBucketFast_:function(t,e){const n=WM(t,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const s={input:n};return VI.runKernel("StringToHashBucketFast",s,r)}}),zP={flipLeftRight:fP,grayscaleToRGB:hP,resizeNearestNeighbor:kP,resizeBilinear:TP,rotateWithOffset:pP,cropAndResize:lP,nonMaxSuppression:mP,nonMaxSuppressionAsync:NP,nonMaxSuppressionWithScore:$P,nonMaxSuppressionWithScoreAsync:EP,nonMaxSuppressionPadded:SP,nonMaxSuppressionPaddedAsync:_P,threshold:AP,transform:CP},WP={sparseFillEmptyRows:RP,sparseReshape:DP,sparseSegmentMean:FP,sparseSegmentSum:LP},UP={stringNGrams:PP,stringSplit:BP,stringToHashBucketFast:VP};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
var jP,GP;kO().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"}(jP||(jP={})),function(t){var e;(e=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(GP||(GP={}));
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const qP={};function HP(t){return qP[t]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KP(t,e,n,r,s){const o=e.inputParams[t];if(o&&void 0!==o.inputIndexStart){const t=o.inputIndexStart,i=0===o.inputIndexEnd?void 0:void 0===o.inputIndexEnd?t+1:o.inputIndexEnd;if("tensor"===o.type)return XP(e.inputNames[o.inputIndexStart],n,r,s);if("tensors"===o.type){return e.inputNames.slice(t,i).map((t=>XP(t,n,r,s)))}const a=XP(e.inputNames.slice(t)[0],n,r,s),u=a.dataSync();return"number"===o.type?u[0]:xO(a.shape,u)}const i=e.attrParams[t];return i&&i.value}function XP(t,e,n,r){const[s,o]=ZP(t);if(null!=r){const t=r.getHashTableHandleByName(s);if(null!=t)return t}const i=n.currentContextIds.find((t=>!!e[YP(s,t)]));return void 0!==i?e[YP(s,i)][o]:void 0}function JP(t,e){const[n,r,s]=ZP(t);return[YP(n,e&&e.currentContextId),r,s]}function YP(t,e){return e?`${t}-${e}`:t}function ZP(t){const e=t.split(":");if(1===e.length)return[t,0,void 0];const n=e[0],r=3===e.length?e[1]:void 0;return[n,Number(e[e.length-1]),r]}function QP(t,e,n){let r=KP("pad",t,e,n);if("explicit"===r){r=KP("explicitPaddings",t,e,n);const s=[[0,0],[0,0],[0,0],[0,0]];for(let t=0;t<4;t++)s[t][0]=r[2*t],s[t][1]=r[2*t+1];return s}return r}function tB(t){return t.kept?t:SR(t)}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var eB=Object.freeze({__proto__:null,json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var nB=Object.freeze({__proto__:null,json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var rB=Object.freeze({__proto__:null,json:[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var sB=Object.freeze({__proto__:null,json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var oB=Object.freeze({__proto__:null,json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var iB=Object.freeze({__proto__:null,json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var aB=Object.freeze({__proto__:null,json:[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var uB=Object.freeze({__proto__:null,json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var cB=Object.freeze({__proto__:null,json:[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var lB=Object.freeze({__proto__:null,json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var fB=Object.freeze({__proto__:null,json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var hB=Object.freeze({__proto__:null,json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var pB=Object.freeze({__proto__:null,json:[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var dB=Object.freeze({__proto__:null,json:[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var mB=Object.freeze({__proto__:null,json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var yB=Object.freeze({__proto__:null,json:[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var gB=Object.freeze({__proto__:null,json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var bB=Object.freeze({__proto__:null,json:[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var wB=Object.freeze({__proto__:null,json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}]});class vB{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const t=[].concat(...[eB,nB,rB,sB,oB,iB,aB,uB,cB,lB,fB,hB,pB,dB,mB,yB,gB,bB,wB].map((t=>t.json)));this.opMappers=t.reduce(((t,e)=>(t[e.tfOpName]=e,t)),{})}transformGraph(t,e={}){const n=t.node,r=[],s=[],o=[],i=n.reduce(((t,e)=>(t[e.name]=this.mapNode(e),e.op.startsWith("Placeholder")?r.push(t[e.name]):"Const"===e.op?s.push(t[e.name]):null!=e.input&&0!==e.input.length||o.push(t[e.name]),t)),{});let a=[];const u=[];let c={},l={};null!=e&&(c=this.mapSignatureEntries(e.inputs),l=this.mapSignatureEntries(e.outputs));const f=Object.keys(i);f.forEach((t=>{const e=i[t];e.inputNames.forEach(((t,n)=>{const[r,,s]=JP(t),o=i[r];if(null!=o.outputs){const t=o.outputs.indexOf(s);if(-1!==t){const s=`${r}:${t}`;e.inputNames[n]=s}}e.inputs.push(o),o.children.push(e)}))})),0===Object.keys(l).length?f.forEach((t=>{const e=i[t];0===e.children.length&&u.push(e)})):Object.keys(l).forEach((t=>{const[e]=JP(t),n=i[e];null!=n&&(n.signatureKey=l[t],u.push(n))})),Object.keys(c).length>0?Object.keys(c).forEach((t=>{const[e]=JP(t),n=i[e];n&&(n.signatureKey=c[t],a.push(n))})):a=r;let h={};null!=t.library&&null!=t.library.function&&(h=t.library.function.reduce(((t,e)=>(t[e.signature.name]=this.mapFunction(e),t)),{}));const p={nodes:i,inputs:a,outputs:u,weights:s,placeholders:r,signature:e,functions:h};return o.length>0&&(p.initNodes=o),p}mapSignatureEntries(t){return Object.keys(t||{}).reduce(((e,n)=>(e[t[n].name]=n,e)),{})}mapNode(t){const e=HP(t.op)||this.opMappers[t.op]||{};null==t.attr&&(t.attr={});const n={name:t.name,op:t.op,category:e.category,inputNames:(t.input||[]).map((t=>t.startsWith("^")?t.slice(1):t)),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr,outputs:e.outputs};return null!=e.inputs&&(n.inputParams=e.inputs.reduce(((t,e)=>(t[e.name]={type:e.type,inputIndexStart:e.start,inputIndexEnd:e.end},t)),{})),null!=e.attrs&&(n.attrParams=e.attrs.reduce(((e,n)=>{const r=n.type;let s;switch(n.type){case"string":s=NB(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=NB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":s=IB(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=IB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":s=EB(t.attr,n.tfName,n.defaultValue||0),void 0===s&&n.tfDeprecatedName&&(s=EB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":s=OB(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=OB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":s=$B(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=$B(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":s=RB(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=RB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":s=CB(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=CB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":s=MB(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=MB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":s=TB(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=TB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":s=kB(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=kB(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":s=_B(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=_B(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${n.type} for op: ${t.op}`)}return e[n.name]={value:s,type:r},e}),{})),n}mapFunction(t){const e=t.nodeDef,n=[];let r={};null!=e&&(r=e.reduce(((t,e)=>(t[e.name]=this.mapNode(e),"Const"===e.op&&n.push(t[e.name]),t)),{}));const s=[],o=[];t.signature.inputArg.forEach((t=>{const[e]=JP(t.name),n={name:e,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:SB(t.type),type:"dtype"}},children:[]};n.signatureKey=t.name,s.push(n),r[e]=n}));Object.keys(r).forEach((t=>{const e=r[t];e.inputNames.forEach(((t,n)=>{const[s,,o]=JP(t),i=r[s];if(null!=i.outputs){const t=i.outputs.indexOf(o);if(-1!==t){const r=`${s}:${t}`;e.inputNames[n]=r}}e.inputs.push(i),i.children.push(e)}))}));const i=t.ret;t.signature.outputArg.forEach((t=>{const[e,n]=JP(i[t.name]),s=r[e];null!=s&&(s.defaultOutput=n,o.push(s))}));const a=this.mapArgsToSignature(t);return{nodes:r,inputs:s,outputs:o,weights:n,placeholders:[],signature:a}}mapArgsToSignature(t){return{methodName:t.signature.name,inputs:t.signature.inputArg.reduce(((t,e)=>(t[e.name]=this.mapArgToTensorInfo(e),t)),{}),outputs:t.signature.outputArg.reduce(((e,n)=>(e[n.name]=this.mapArgToTensorInfo(n,t.ret),e)),{})}}mapArgToTensorInfo(t,e){let n=t.name;return null!=e&&(n=e[n]),{name:n,dtype:t.type}}}function xB(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):function(t){const e=kO().global;return void 0!==e.atob?e.atob(t):new nM(t,"base64").toString()}(t);return e?n:n.toLowerCase()}function NB(t,e,n,r=!1){const s=t[e];return null!=s?xB(s.s,r):n}function $B(t,e,n){const r=t[e];return r?r.b:n}function EB(t,e,n){const r=t[e]||{},s=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof s?s:parseInt(s,10)}function SB(t){switch("string"==typeof t&&(t=jP[t]),t){case jP.DT_FLOAT:case jP.DT_HALF:return"float32";case jP.DT_INT32:case jP.DT_INT64:case jP.DT_INT8:case jP.DT_UINT8:return"int32";case jP.DT_BOOL:return"bool";case jP.DT_DOUBLE:return"float32";case jP.DT_STRING:return"string";default:return null}}function _B(t,e,n){const r=t[e];return r&&r.func?r.func.name:n}function TB(t,e,n){const r=t[e];return r&&r.type?SB(r.type):n}function kB(t,e,n){const r=t[e];return r&&r.list&&r.list.type?r.list.type.map((t=>SB(t))):n}function AB(t){if(!t.unknownRank)return null!=t.dim?t.dim.map((t=>"number"==typeof t.size?t.size:parseInt(t.size,10))):[]}function CB(t,e,n){const r=t[e];return r&&r.shape?AB(r.shape):n}function OB(t,e,n){const r=t[e];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((t=>"number"==typeof t?t:parseInt(t,10))):n}function IB(t,e,n,r=!1){const s=t[e];return s&&s.list&&s.list.s?s.list.s.map((t=>xB(t,r))):n}function MB(t,e,n){const r=t[e];return r&&r.list&&r.list.shape?r.list.shape.map((t=>AB(t))):n}function RB(t,e,n){const r=t[e];return r&&r.list&&r.list.b?r.list.b:n}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DB{constructor(t,e,n){this.node=t,this.tensorMap=e,this.context=n,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((t=>this.getInput(t))),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce(((t,e)=>(t[e]=this.getAttr(e),t)),{}))}getInput(t){return XP(t,this.tensorMap,this.context)}getAttr(t,e){const n=this.node.rawAttrs[t];if(null!=n.tensor)return XP(t,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return EB(this.node.rawAttrs,t,e);if(null!=n.s)return NB(this.node.rawAttrs,t,e);if(null!=n.b)return $B(this.node.rawAttrs,t,e);if(null!=n.shape)return CB(this.node.rawAttrs,t,e);if(null!=n.type)return TB(this.node.rawAttrs,t,e);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return OB(this.node.rawAttrs,t,e);if(null!=n.list.s)return IB(this.node.rawAttrs,t,e);if(null!=n.list.shape)return MB(this.node.rawAttrs,t,e);if(null!=n.list.b)return RB(this.node.rawAttrs,t,e);if(null!=n.list.type)return kB(this.node.rawAttrs,t,e)}return e}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function FB(t,e,n=""){if("number"!=typeof t&&"number"!=typeof e){oO(t.length===e.length,(()=>n+` Shapes ${t} and ${e} must match`));for(let r=0;r<t.length;r++){const s=t[r],o=e[r];oO(s<0||o<0||s===o,(()=>n+` Shapes ${t} and ${e} must match`))}}}function LB(t){return"number"!=typeof t&&!t.some((t=>t<0))}function PB(t,e,n){let r=BB(t,n);const s=!LB(r);if(s&&0===e.length)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(s&&e.forEach((t=>{r=BB(t.shape,r)})),!LB(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function BB(t,e){if("number"==typeof t)return e;if("number"==typeof e)return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let r=0;r<t.length;++r){const s=t[r],o=e[r];if(s>=0&&o>=0&&s!==o)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[r]=s>=0?s:o}return n}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VB{constructor(t,e,n,r,s,o,i){this.name=t,this.dtype=e,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=s,this.dynamicSize=o,this.clearAfterRead=i,this.tensors=[],this.closed_=!1,this.idTensor=tF(0),FR(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.tensor.id)||e.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||t>=this.size())throw new Error(`Tried to read from index ${t}, but array size is: ${this.size()}`);const e=this.tensors[t];if(e.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${t} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor}readMany(t){return t.map((t=>this.read(t)))}write(t,e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error(`Tried to write to index ${t}, but array is not resizeable and size is: ${this.maxSize}`);const n=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t},\n          because the value dtype is ${e.dtype}, but TensorArray dtype is ${this.dtype}.`);if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=e.shape),FB(this.elementShape,e.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${t}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been written.`);n.tensor=e,FR(e),n.written=!0,this.tensors[t]=n}writeMany(t,e){if(t.length!==e.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${t.length} is not the same as tensors size: ${e.length}.`);t.forEach(((t,n)=>this.write(t,e[n])))}gather(t,e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${e}`);if(t)t=t.slice(0,this.size());else{t=[];for(let e=0;e<this.size();e++)t.push(e)}if(0===t.length)return HM([],[0].concat(this.elementShape));const n=this.readMany(t);return FB(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),FL(n,0)}concat(t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${t}`);if(0===this.size())return HM([],[0].concat(this.elementShape));const e=[];for(let t=0;t<this.size();t++)e.push(t);const n=this.readMany(e);return FB(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),bD(n,0)}scatter(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);const n=Math.max(...t);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(t,GL(e,0))}split(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);let n=0;const r=t.map((t=>(n+=t,n)));if(n!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${n}, and tensor's shape is: ${e.shape}`);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${t.length}), and the TensorArray is not marked as dynamically resizeable`);const s=0===n?0:e.size/n,o=[];DR((()=>{e=mD(e,[1,n,s]);for(let n=0;n<t.length;++n){const i=[0,0===n?0:r[n-1],0],a=[1,t[n],s];o[n]=mD(vD(e,i,a),this.elementShape)}return o}));const i=[];for(let e=0;e<t.length;e++)i[e]=e;this.writeMany(i,o)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zB{constructor(t,e,n,r=-1){this.tensors=t,this.elementShape=e,this.elementDtype=n,null!=t&&t.forEach((t=>{if(n!==t.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${t.dtype}`);FB(e,t.shape,"TensorList shape mismatch: "),FR(t)})),this.idTensor=tF(0),this.maxNumElements=r,FR(this.idTensor)}get id(){return this.idTensor.id}copy(){return new zB([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.id)||e.dispose()})),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,e,n=-1){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(-1!==n&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);FB(t,this.elementShape,"TensorList shape mismatch: ");const r=PB(this.elementShape,this.tensors,t);return DR((()=>{const t=this.tensors.map((t=>mD(t,r)));return FL(t,0)}))}popBack(t,e){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=PB(this.elementShape,this.tensors,t),r=this.tensors.pop();return FB(r.shape,t,"TensorList shape mismatch: "),mD(r,n)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(FB(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");FR(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);const e=new zB([],this.elementShape,this.elementDtype,this.maxNumElements);e.tensors.length=t;for(let n=0;n<Math.min(this.tensors.length,t);++n)e.tensors[n]=this.tensors[n];return e}getItem(t,e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(null==this.tensors[t])throw new Error(`element at index ${t} is null.`);FB(this.tensors[t].shape,e,"TensorList shape mismatch: ");const r=PB(this.elementShape,this.tensors,e);return mD(this.tensors[t],r)}setItem(t,e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(t<0||-1!==this.maxNumElements&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);FB(this.elementShape,e.shape,"TensorList shape mismatch: "),FR(e),this.tensors[t]=e}gather(t,e,n){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);FB(this.elementShape,n,"TensorList shape mismatch: "),t=t.slice(0,this.size());const r=PB(this.elementShape,this.tensors,n);return 0===t.length?HM([],[0].concat(r)):DR((()=>{const e=t.map((t=>mD(this.tensors[t],r)));return FL(e,0)}))}concat(t,e){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);FB(this.elementShape,e,"TensorList shape mismatch: ");const n=PB(this.elementShape,this.tensors,e);return 0===this.size()?HM([],[0].concat(n)):DR((()=>{const t=this.tensors.map((t=>mD(t,n)));return bD(t,0)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const WB=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const r=KP("thenBranch",t,e,n),s=KP("elseBranch",t,e,n),o=KP("cond",t,e,n),i=KP("args",t,e,n);return(await o.data())[0]?n.functionMap[r].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap):n.functionMap[s].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=KP("body",t,e,n),s=KP("cond",t,e,n),o=KP("args",t,e,n),i=await n.functionMap[s].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap),a=o.map((t=>t.id));let u=await i[0].data();i.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||t.dispose()}));let c=o;for(;u[0];){const t=c;c=await n.functionMap[r].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);const e=c.map((t=>t.id));t.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}));const o=await n.functionMap[s].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);u=await o[0].data(),o.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}))}return c}case"LoopCond":return[tB(KP("pred",t,e,n))];case"Switch":{const r=KP("pred",t,e,n);let s=KP("data",t,e,n);return s.kept||(s=tB(s)),(await r.data())[0]?[void 0,s]:[s,void 0]}case"Merge":{const r=t.inputNames.find((t=>void 0!==XP(t,e,n)));if(r){return[tB(XP(r,e,n))]}return}case"Enter":{const r=KP("frameName",t,e,n),s=KP("tensor",t,e,n);return n.enterFrame(r),[tB(s)]}case"Exit":{const r=KP("tensor",t,e,n);return n.exitFrame(),[tB(r)]}case"NextIteration":{const r=KP("tensor",t,e,n);return n.nextIteration(),[tB(r)]}case"TensorArrayV3":{const r=KP("size",t,e,n),s=KP("dtype",t,e,n),o=KP("elementShape",t,e,n),i=KP("dynamicSize",t,e,n),a=KP("clearAfterRead",t,e,n),u=KP("identicalElementShapes",t,e,n),c=KP("name",t,e,n),l=new VB(c,s,r,o,u,i,a);return n.addTensorArray(l),[l.idTensor,tF(1)]}case"TensorArrayWriteV3":{const r=KP("tensorArrayId",t,e,n),s=KP("index",t,e,n),o=KP("tensor",t,e,n),i=n.getTensorArray(r.id);return i.write(s,o),[i.idTensor]}case"TensorArrayReadV3":{const r=KP("tensorArrayId",t,e,n),s=KP("index",t,e,n);return[n.getTensorArray(r.id).read(s)]}case"TensorArrayGatherV3":{const r=KP("tensorArrayId",t,e,n),s=KP("indices",t,e,n),o=KP("dtype",t,e,n);return[n.getTensorArray(r.id).gather(s,o)]}case"TensorArrayScatterV3":{const r=KP("tensorArrayId",t,e,n),s=KP("indices",t,e,n),o=KP("tensor",t,e,n),i=n.getTensorArray(r.id);return i.scatter(s,o),[i.idTensor]}case"TensorArrayConcatV3":{const r=KP("tensorArrayId",t,e,n),s=n.getTensorArray(r.id),o=KP("dtype",t,e,n);return[s.concat(o)]}case"TensorArraySplitV3":{const r=KP("tensorArrayId",t,e,n),s=KP("tensor",t,e,n),o=KP("lengths",t,e,n),i=n.getTensorArray(r.id);return i.split(o,s),[i.idTensor]}case"TensorArraySizeV3":{const r=KP("tensorArrayId",t,e,n);return[tF(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{const r=KP("tensorArrayId",t,e,n),s=n.getTensorArray(r.id);return s.clearAndClose(),[s.idTensor]}case"TensorListSetItem":{const r=KP("tensorListId",t,e,n),s=KP("index",t,e,n),o=KP("tensor",t,e,n),i=n.getTensorList(r.id);return i.setItem(s,o),[i.idTensor]}case"TensorListGetItem":{const r=KP("tensorListId",t,e,n),s=KP("index",t,e,n),o=KP("elementShape",t,e,n),i=KP("elementDType",t,e,n);return[n.getTensorList(r.id).getItem(s,o,i)]}case"TensorListScatterV2":case"TensorListScatter":{const r=KP("indices",t,e,n),s=function(t,e,n,r){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const s=Math.max(...e);if(null!=r&&-1!==r&&s>=r)throw new Error(`Max index must be < array size (${s}  vs. ${r})`);const o=new zB([],n,t.dtype,r),i=GL(t,0);return e.forEach(((t,e)=>{o.setItem(t,i[e])})),o}(KP("tensor",t,e,n),r,KP("elementShape",t,e,n),KP("numElements",t,e,n));return n.addTensorList(s),[s.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=KP("elementShape",t,e,n),s=KP("elementDType",t,e,n);let o;o="TensorListReserve"===t.op?"numElements":"maxNumElements";const i=function(t,e,n){return new zB([],t,e,n)}(r,s,KP(o,t,e,n));return n.addTensorList(i),[i.idTensor]}case"TensorListGather":{const r=KP("tensorListId",t,e,n),s=KP("indices",t,e,n),o=KP("elementShape",t,e,n),i=KP("elementDType",t,e,n);return[n.getTensorList(r.id).gather(s,i,o)]}case"TensorListStack":{const r=KP("tensorListId",t,e,n),s=KP("elementShape",t,e,n),o=KP("elementDType",t,e,n),i=KP("numElements",t,e,n);return[n.getTensorList(r.id).stack(s,o,i)]}case"TensorListFromTensor":{const r=function(t,e,n){const r=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);FB(t.shape.slice(1),e,"TensorList shape mismatch: ");const s=GL(t);return new zB(s,e,r)}(KP("tensor",t,e,n),KP("elementShape",t,e,n),KP("elementDType",t,e,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const r=KP("tensorListId",t,e,n),s=n.getTensorList(r.id),o=KP("dtype",t,e,n),i=KP("elementShape",t,e,n);return[s.concat(o,i)]}case"TensorListPushBack":{const r=KP("tensorListId",t,e,n),s=KP("tensor",t,e,n),o=n.getTensorList(r.id);return o.pushBack(s),[o.idTensor]}case"TensorListPopBack":{const r=KP("tensorListId",t,e,n),s=KP("elementShape",t,e,n),o=KP("elementDType",t,e,n);return[n.getTensorList(r.id).popBack(s,o)]}case"TensorListSplit":{const r=KP("tensor",t,e,n),s=KP("elementShape",t,e,n),o=function(t,e,n){let r=0;const s=e.map((t=>(r+=t,r)));if(r!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${r}, and tensor's shape is: ${t.shape}`);const o=BB(t.shape.slice(1),n),i=0===r?0:t.size/r,a=DR((()=>{const n=[];t=mD(t,[1,r,i]);for(let r=0;r<e.length;++r){const a=[0,0===r?0:s[r-1],0],u=[1,e[r],i];n[r]=mD(vD(t,a,u),o)}return t.dispose(),n})),u=new zB([],n,t.dtype,e.length);for(let t=0;t<a.length;t++)u.setItem(t,a[t]);return u}(r,KP("lengths",t,e,n),s);return n.addTensorList(o),[o.idTensor]}case"TensorListLength":{const r=KP("tensorListId",t,e,n);return[tF(n.getTensorList(r.id).size(),"int32")]}case"TensorListResize":{const r=KP("tensorListId",t,e,n),s=KP("size",t,e,n),o=n.getTensorList(r.id).resize(s);return n.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UB(t,e,n){const[r,s]=KP("fusedOps",t,e,n),o="biasadd"===r,i=!o,a="prelu"===s,u="fusedbatchnorm"===r,c=KP("numArgs",t,e,n);if(o){if(a&&2!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&o&&1!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(u)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const l=KP("strides",t,e,n),f=QP(t,e,n),h=KP("dataFormat",t,e,n).toUpperCase(),p=KP("dilations",t,e,n);let[d,m]=KP("args",t,e,n);i&&(m=d,d=void 0);return{stride:l,pad:f,dataFormat:h,dilations:p,biasArg:d,preluArg:m,activationFunc:s,leakyreluAlpha:KP("leakyreluAlpha",t,e,n)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function jB(t,e,n){return{boxes:KP("boxes",t,e,n),scores:KP("scores",t,e,n),maxOutputSize:KP("maxOutputSize",t,e,n),iouThreshold:KP("iouThreshold",t,e,n),scoreThreshold:KP("scoreThreshold",t,e,n),softNmsSigma:KP("softNmsSigma",t,e,n)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class GB{constructor(t,e){this.keyDType=t,this.valueDType=e,this.handle=tF(0),this.tensorMap=new Map,FR(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return tF(this.size(),"int32")}async import(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),DR((()=>{const t=GL(e),r=n.length,s=t.length;oO(r===s,(()=>`The number of elements doesn't match, keys has ${r} elements, the values has ${s} elements.`));for(let e=0;e<r;e++){const r=n[e],s=t[e];FR(s),this.tensorMap.set(r,s)}return this.handle}))}async find(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return DR((()=>{const t=[];for(let r=0;r<n.length;r++){const s=n[r],o=this.findWithDefault(s,e);t.push(o)}return FL(t)}))}findWithDefault(t,e){const n=this.tensorMap.get(t);return null!=n?n:e}checkKeyAndValueTensor(t,e){if(t.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${t.dtype}`);if(e.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${e.dtype}`)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function qB(t,e,n,r){const s=((t,e,n)=>{switch(t.category){case"arithmetic":return DR((()=>((t,e,n)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[GR(KP("a",t,e,n),KP("b",t,e,n))];case"AddN":return[ZR(KP("tensors",t,e,n))];case"FloorMod":case"Mod":return[jF(KP("a",t,e,n),KP("b",t,e,n))];case"Mul":return[KR(KP("a",t,e,n),KP("b",t,e,n))];case"RealDiv":case"Div":return[HR(KP("a",t,e,n),KP("b",t,e,n))];case"DivNoNan":return[qD(KP("a",t,e,n),KP("b",t,e,n))];case"FloorDiv":return[qR(KP("a",t,e,n),KP("b",t,e,n))];case"Sub":return[TF(KP("a",t,e,n),KP("b",t,e,n))];case"Minimum":return[WF(KP("a",t,e,n),KP("b",t,e,n))];case"Maximum":return[PF(KP("a",t,e,n),KP("b",t,e,n))];case"Pow":return[QD(KP("a",t,e,n),KP("b",t,e,n))];case"SquaredDifference":return[RL(KP("a",t,e,n),KP("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"basic_math":return DR((()=>((t,e,n)=>{switch(t.op){case"Abs":case"ComplexAbs":return[XR(KP("x",t,e,n))];case"Acos":return[JR(KP("x",t,e,n))];case"Acosh":return[YR(KP("x",t,e,n))];case"Asin":return[rD(KP("x",t,e,n))];case"Asinh":return[sD(KP("x",t,e,n))];case"Atan":return[oD(KP("x",t,e,n))];case"Atan2":return[iD(KP("x",t,e,n),KP("y",t,e,n))];case"Atanh":return[aD(KP("x",t,e,n))];case"Ceil":return[TD(KP("x",t,e,n))];case"Complex":return[GM(KP("real",t,e,n),KP("imag",t,e,n))];case"Cos":return[DD(KP("x",t,e,n))];case"Cosh":return[FD(KP("x",t,e,n))];case"Elu":return[KD(KP("x",t,e,n))];case"Erf":return[XD(KP("x",t,e,n))];case"Exp":return[aF(KP("x",t,e,n))];case"Expm1":return[cF(KP("x",t,e,n))];case"Floor":return[pF(KP("x",t,e,n))];case"Log":return[$F(KP("x",t,e,n))];case"Log1p":return[EF(KP("x",t,e,n))];case"Imag":return[LR(KP("x",t,e,n))];case"Neg":return[PR(KP("x",t,e,n))];case"Reciprocal":return[gL(KP("x",t,e,n))];case"Real":return[BR(KP("x",t,e,n))];case"Relu":return[bL(KP("x",t,e,n))];case"Round":return[xL(KP("x",t,e,n))];case"Selu":return[$L(KP("x",t,e,n))];case"Sigmoid":return[wD(KP("x",t,e,n))];case"Sin":return[_L(KP("x",t,e,n))];case"Sign":return[SL(KP("x",t,e,n))];case"Sinh":return[TL(KP("x",t,e,n))];case"Softplus":return[_F(KP("x",t,e,n))];case"Sqrt":return[eF(KP("x",t,e,n))];case"Square":return[nF(KP("x",t,e,n))];case"Tanh":return[xD(KP("x",t,e,n))];case"Tan":return[BL(KP("x",t,e,n))];case"ClipByValue":return[kD(KP("x",t,e,n),KP("clipValueMin",t,e,n),KP("clipValueMax",t,e,n))];case"Relu6":return[wL(KP("x",t,e,n))];case"Rsqrt":return[NL(XP(t.inputNames[0],e,n))];case"Prod":return[YF(KP("x",t,e,n),KP("axes",t,e,n))];case"LeakyRelu":return[bF(KP("x",t,e,n),KP("alpha",t,e,n))];case"Prelu":return[JF(KP("x",t,e,n),KP("alpha",t,e,n))];case"IsNan":return[gF(XP(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"control":return WB(t,e,n);case"convolution":return DR((()=>((t,e,n)=>{switch(t.op){case"Conv1D":{const r=KP("stride",t,e,n),s=KP("pad",t,e,n),o=KP("dataFormat",t,e,n).toUpperCase(),i=KP("dilation",t,e,n);return[OD(KP("x",t,e,n),KP("filter",t,e,n),r,s,o,i)]}case"Conv2D":{const r=KP("strides",t,e,n),s=QP(t,e,n),o=KP("dataFormat",t,e,n).toUpperCase(),i=KP("dilations",t,e,n);return[CD(KP("x",t,e,n),KP("filter",t,e,n),[r[1],r[2]],s,o,[i[1],i[2]])]}case"_FusedConv2D":{const{stride:r,pad:s,dataFormat:o,dilations:i,biasArg:a,preluArg:u,activationFunc:c,leakyreluAlpha:l}=UB(t,e,n);return[rP({x:KP("x",t,e,n),filter:KP("filter",t,e,n),strides:[r[1],r[2]],pad:s,dataFormat:o,dilations:[i[1],i[2]],bias:a,activation:c,preluActivationWeights:u,leakyreluAlpha:l})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:s,dataFormat:o,dilations:i,biasArg:a,preluArg:u,activationFunc:c,leakyreluAlpha:l}=UB(t,e,n);return[iP({x:KP("x",t,e,n),filter:KP("filter",t,e,n),strides:[r[1],r[2]],pad:s,dataFormat:o,dilations:[i[1],i[2]],bias:a,activation:c,preluActivationWeights:u,leakyreluAlpha:l})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=KP("outputShape",t,e,n),s=KP("strides",t,e,n),o=QP(t,e,n);return[MD(KP("x",t,e,n),KP("filter",t,e,n),r,[s[1],s[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=KP("strides",t,e,n),s=QP(t,e,n),o=KP("dilations",t,e,n),i=KP("dataFormat",t,e,n).toUpperCase();return[zD(KP("input",t,e,n),KP("filter",t,e,n),[r[1],r[2]],s,i,[o[1],o[2]])]}case"Conv3D":{const r=KP("strides",t,e,n),s=KP("pad",t,e,n),o=KP("dataFormat",t,e,n).toUpperCase(),i=KP("dilations",t,e,n);return[RD(KP("x",t,e,n),KP("filter",t,e,n),[r[1],r[2],r[3]],s,o,[i[1],i[2],i[3]])]}case"AvgPool":{const r=KP("strides",t,e,n),s=KP("pad",t,e,n),o=KP("kernelSize",t,e,n);return[yD(KP("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s)]}case"MaxPool":{const r=KP("strides",t,e,n),s=KP("pad",t,e,n),o=KP("kernelSize",t,e,n);return[DF(KP("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s)]}case"MaxPoolWithArgmax":{const r=KP("strides",t,e,n),s=KP("pad",t,e,n),o=KP("kernelSize",t,e,n),i=KP("includeBatchInIndex",t,e,n),{result:a,indexes:u}=LF(KP("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s,i);return[a,u]}case"AvgPool3D":{const r=KP("strides",t,e,n),s=KP("pad",t,e,n),o=KP("kernelSize",t,e,n);return[gD(KP("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],s)]}case"MaxPool3D":{const r=KP("strides",t,e,n),s=KP("pad",t,e,n),o=KP("kernelSize",t,e,n);return[FF(KP("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],s)]}case"Dilation2D":{const r=KP("strides",t,e,n),s=KP("pad",t,e,n),o=KP("dilations",t,e,n),i=r[1],a=r[2],u=o[1],c=o[2];return[WD(KP("x",t,e,n),KP("filter",t,e,n),[i,a],s,[u,c],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"creation":return DR((()=>((t,e,n)=>{switch(t.op){case"Fill":{const r=KP("shape",t,e,n),s=KP("dtype",t,e,n);return[hF(r,KP("value",t,e,n),s)]}case"LinSpace":return[xF(KP("start",t,e,n),KP("stop",t,e,n),KP("num",t,e,n))];case"Multinomial":{const r=KP("logits",t,e,n),s=KP("numSamples",t,e,n),o=KP("seed",t,e,n);return[GF(r,s,o)]}case"OneHot":{const r=KP("indices",t,e,n),s=KP("depth",t,e,n),o=KP("onValue",t,e,n),i=KP("offValue",t,e,n);return[RR(r,s,o,i)]}case"Ones":return[zF(KP("shape",t,e,n),KP("dtype",t,e,n))];case"OnesLike":return[HF(KP("x",t,e,n))];case"RandomUniform":return[mL(KP("shape",t,e,n),KP("minval",t,e,n),KP("maxval",t,e,n),KP("dtype",t,e,n))];case"Range":return[yL(KP("start",t,e,n),KP("stop",t,e,n),KP("step",t,e,n),KP("dtype",t,e,n))];case"TruncatedNormal":{const r=KP("shape",t,e,n),s=KP("mean",t,e,n),o=KP("stdDev",t,e,n),i=KP("seed",t,e,n);return[UL(r,s,o,KP("dtype",t,e,n),i)]}case"Zeros":return[VF(KP("shape",t,e,n),KP("dtype",t,e,n))];case"ZerosLike":return[GD(KP("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"dynamic":return(async(t,e,n)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a,softNmsSigma:u}=jB(t,e,n),c=await zP.nonMaxSuppressionWithScoreAsync(r,s,o,i,a,u);return[c.selectedIndices,c.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a}=jB(t,e,n),u=KP("padToMaxOutputSize",t,e,n),c=await zP.nonMaxSuppressionPaddedAsync(r,s,o,i,a,u);return[c.selectedIndices,c.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a}=jB(t,e,n);return[await zP.nonMaxSuppressionAsync(r,s,o,i,a)]}case"Where":{const r=ER(KP("condition",t,e,n),"bool"),s=[await HL(r)];return r.dispose(),s}case"ListDiff":return EL(KP("x",t,e,n),KP("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n);case"evaluation":return DR((()=>((t,e,n)=>{switch(t.op){case"LowerBound":return[RF(KP("sortedSequence",t,e,n),KP("values",t,e,n))];case"TopKV2":{const r=KP("x",t,e,n),s=KP("k",t,e,n),o=KP("sorted",t,e,n),i=WL(r,s,o);return[i.values,i.indices]}case"UpperBound":return[qL(KP("sortedSequence",t,e,n),KP("values",t,e,n))];case"Unique":{const r=KP("x",t,e,n),s=jL(r);return[s.values,s.indices]}case"UniqueV2":{const r=KP("x",t,e,n),s=KP("axis",t,e,n),o=jL(r,s);return[o.values,o.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"image":return DR((()=>((t,e,n)=>{switch(t.op){case"ResizeBilinear":{const r=KP("images",t,e,n),s=KP("size",t,e,n),o=KP("alignCorners",t,e,n),i=KP("halfPixelCenters",t,e,n);return[zP.resizeBilinear(r,[s[0],s[1]],o,i)]}case"ResizeNearestNeighbor":{const r=KP("images",t,e,n),s=KP("size",t,e,n),o=KP("alignCorners",t,e,n),i=KP("halfPixelCenters",t,e,n);return[zP.resizeNearestNeighbor(r,[s[0],s[1]],o,i)]}case"CropAndResize":{const r=KP("image",t,e,n),s=KP("boxes",t,e,n),o=KP("boxInd",t,e,n),i=KP("cropSize",t,e,n),a=KP("method",t,e,n),u=KP("extrapolationValue",t,e,n);return[zP.cropAndResize(r,s,o,i,a,u)]}case"ImageProjectiveTransformV3":{const r=KP("images",t,e,n),s=KP("transforms",t,e,n),o=KP("outputShape",t,e,n),i=KP("fillValue",t,e,n),a=KP("interpolation",t,e,n),u=KP("fillMode",t,e,n);return[zP.transform(r,s,a.toLowerCase(),u.toLowerCase(),i,o)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"graph":return DR((()=>((t,e,n)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const r=KP("default",t,e,n);return[XP(t.name,e,n)||r];case"Placeholder":return[XP(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[tB(KP("x",t,e,n))];case"IdentityN":return KP("x",t,e,n).map((t=>tB(t)));case"Shape":return[VL(KP("x",t,e,n).shape,"int32")];case"ShapeN":return KP("x",t,e,n).map((t=>VL(t.shape)));case"Size":return[tF(KP("x",t,e,n).size,"int32")];case"Rank":return[tF(KP("x",t,e,n).rank,"int32")];case"NoOp":return[tF(1)];case"Print":const s=KP("x",t,e,n),o=KP("data",t,e,n),i=KP("message",t,e,n),a=KP("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(i);for(let t=0;t<o.length;t++)console.log(Array.prototype.slice.call(o[t].dataSync()).slice(0,a));return[s];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"logical":return DR((()=>((t,e,n)=>{switch(t.op){case"Equal":return[UD(KP("a",t,e,n),KP("b",t,e,n))];case"NotEqual":return[qF(KP("a",t,e,n),KP("b",t,e,n))];case"Greater":return[mF(KP("a",t,e,n),KP("b",t,e,n))];case"GreaterEqual":return[yF(KP("a",t,e,n),KP("b",t,e,n))];case"Less":return[wF(KP("a",t,e,n),KP("b",t,e,n))];case"LessEqual":return[vF(KP("a",t,e,n),KP("b",t,e,n))];case"LogicalAnd":return[CF(KP("a",t,e,n),KP("b",t,e,n))];case"LogicalNot":return[OF(KP("a",t,e,n))];case"LogicalOr":return[IF(KP("a",t,e,n),KP("b",t,e,n))];case"Select":case"SelectV2":return[jD(KP("condition",t,e,n),KP("a",t,e,n),KP("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"matrices":return DR((()=>((t,e,n)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[MR(KP("a",t,e,n),KP("b",t,e,n),KP("transposeA",t,e,n),KP("transposeB",t,e,n))];case"Einsum":return[HD(KP("equation",t,e,n),...KP("tensors",t,e,n))];case"Transpose":return[VR(KP("x",t,e,n),KP("perm",t,e,n))];case"_FusedMatMul":const[r,s]=KP("fusedOps",t,e,n),o="biasadd"===r,i="prelu"===s,a=KP("numArgs",t,e,n),u=KP("leakyreluAlpha",t,e,n);if(o){if(i&&2!==a)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!i&&1!==a)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[c,l]=KP("args",t,e,n);return[aP({a:KP("a",t,e,n),b:KP("b",t,e,n),transposeA:KP("transposeA",t,e,n),transposeB:KP("transposeB",t,e,n),bias:c,activation:s,preluActivationWeights:l,leakyreluAlpha:u})];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"normalization":return DR((()=>((t,e,n)=>{switch(t.op){case"EuclideanNorm":return[iF(KP("x",t,e,n),KP("axis",t,e,n),KP("keepDims",t,e,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[$D(KP("x",t,e,n),KP("mean",t,e,n),KP("variance",t,e,n),KP("offset",t,e,n),KP("scale",t,e,n),KP("epsilon",t,e,n))];case"LRN":return[NF(KP("x",t,e,n),KP("radius",t,e,n),KP("bias",t,e,n),KP("alpha",t,e,n),KP("beta",t,e,n))];case"Softmax":return[kL(KP("x",t,e,n))];case"LogSoftmax":return[kF(KP("x",t,e,n))];case"SparseToDense":return[XL(KP("sparseIndices",t,e,n),KP("outputShape",t,e,n),KP("sparseValues",t,e,n),KP("defaultValue",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"reduction":return DR((()=>((t,e,n)=>{switch(t.op){case"Max":{const r=KP("axis",t,e,n),s=KP("keepDims",t,e,n);return[YD(KP("x",t,e,n),r,s)]}case"Mean":{const r=KP("axis",t,e,n),s=KP("keepDims",t,e,n);return[BF(KP("x",t,e,n),r,s)]}case"Min":{const r=KP("axis",t,e,n),s=KP("keepDims",t,e,n);return[ZD(KP("x",t,e,n),r,s)]}case"Sum":{const r=KP("axis",t,e,n),s=KP("keepDims",t,e,n);return[rF(KP("x",t,e,n),r,s)]}case"All":{const r=KP("axis",t,e,n),s=KP("keepDims",t,e,n);return[QR(KP("x",t,e,n),r,s)]}case"Any":{const r=KP("axis",t,e,n),s=KP("keepDims",t,e,n);return[tD(KP("x",t,e,n),r,s)]}case"ArgMax":{const r=KP("axis",t,e,n);return[eD(KP("x",t,e,n),r)]}case"ArgMin":{const r=KP("axis",t,e,n);return[nD(KP("x",t,e,n),r)]}case"Prod":{const r=KP("axis",t,e,n),s=KP("keepDims",t,e,n);return[YF(KP("x",t,e,n),r,s)]}case"Cumprod":{const r=KP("axis",t,e,n),s=KP("exclusive",t,e,n),o=KP("reverse",t,e,n);return[LD(KP("x",t,e,n),r,s,o)]}case"Cumsum":{const r=KP("axis",t,e,n),s=KP("exclusive",t,e,n),o=KP("reverse",t,e,n);return[PD(KP("x",t,e,n),r,s,o)]}case"Bincount":const r=KP("x",t,e,n),s=KP("weights",t,e,n),o=KP("size",t,e,n);return[ED(r,s,o)];case"DenseBincount":{const r=KP("x",t,e,n),s=KP("weights",t,e,n),o=KP("size",t,e,n),i=KP("binaryOutput",t,e,n);return[BD(r,s,o,i)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"slice_join":return DR((()=>((t,e,n)=>{switch(t.op){case"ConcatV2":case"Concat":{const r=KP("n",t,e,n),s=KP("axis",t,e,n);let o=KP("tensors",t,e,n);return o=o.slice(0,r),[bD(o,s)]}case"Gather":{const r=KP("x",t,e,n),s=KP("indices",t,e,n);return[dF(r,ER(s,"int32"),0)]}case"GatherV2":{const r=KP("axis",t,e,n),s=KP("batchDims",t,e,n),o=KP("x",t,e,n),i=KP("indices",t,e,n);return[dF(o,ER(i,"int32"),r,s)]}case"Reverse":{const r=KP("dims",t,e,n),s=[];for(let t=0;t<r.length;t++)r[t]&&s.push(t);const o=KP("x",t,e,n);return[vL(o,s)]}case"ReverseV2":{const r=KP("axis",t,e,n),s=KP("x",t,e,n);return[vL(s,r)]}case"Slice":{const r=KP("begin",t,e,n),s=KP("size",t,e,n);return[vD(KP("x",t,e,n),r,s)]}case"StridedSlice":{const r=KP("begin",t,e,n),s=KP("end",t,e,n),o=KP("strides",t,e,n),i=KP("beginMask",t,e,n),a=KP("endMask",t,e,n),u=KP("ellipsisMask",t,e,n),c=KP("newAxisMask",t,e,n),l=KP("shrinkAxisMask",t,e,n),f=KP("x",t,e,n);return[PL(f,r,s,o,i,a,u,c,l)]}case"Pack":return DR((()=>{const r=KP("axis",t,e,n),s=KP("tensors",t,e,n),o=s[0].shape,i=DL(s[0]).shape,a=s.map((t=>{const e=lO(t.shape,o);if(!e&&!lO(DL(t).shape,i))throw new Error("the input tensors shape does not match");return e?t:mD(t,o)}));return[FL(a,r)]}));case"Unpack":{const r=KP("axis",t,e,n),s=KP("tensor",t,e,n);return GL(s,r)}case"Tile":{const r=KP("reps",t,e,n);return[lF(KP("x",t,e,n),r)]}case"Split":case"SplitV":{const r=KP("axis",t,e,n),s=KP("numOrSizeSplits",t,e,n),o=KP("x",t,e,n);return IL(o,s,r)}case"ScatterNd":{const r=KP("indices",t,e,n),s=KP("values",t,e,n),o=KP("shape",t,e,n);return[KL(r,s,o)]}case"GatherNd":{const r=KP("x",t,e,n),s=KP("indices",t,e,n);return[JL(r,s)]}case"SparseToDense":{const r=KP("sparseIndices",t,e,n),s=KP("outputShape",t,e,n),o=KP("sparseValues",t,e,n),i=KP("defaultValue",t,e,n);return[XL(r,o,s,o.dtype===i.dtype?i:ER(i,o.dtype))]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"sparse":return DR((()=>((t,e,n)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:s,emptyRowIndicator:o,reverseIndexMap:i}=WP.sparseFillEmptyRows(KP("indices",t,e,n),KP("values",t,e,n),KP("denseShape",t,e,n),KP("defaultValue",t,e,n));return[r,s,o,i]}case"SparseReshape":{const{outputIndices:r,outputShape:s}=WP.sparseReshape(KP("inputIndices",t,e,n),KP("inputShape",t,e,n),KP("newShape",t,e,n));return[r,s]}case"SparseSegmentMean":return[WP.sparseSegmentMean(KP("data",t,e,n),KP("indices",t,e,n),KP("segmentIds",t,e,n))];case"SparseSegmentSum":return[WP.sparseSegmentSum(KP("data",t,e,n),KP("indices",t,e,n),KP("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"spectral":return DR((()=>((t,e,n)=>{switch(t.op){case"FFT":return[AL(KP("x",t,e,n))];case"IFFT":return[CL(KP("x",t,e,n))];case"RFFT":return[ML(KP("x",t,e,n))];case"IRFFT":return[OL(KP("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"string":return DR((()=>((t,e,n)=>{switch(t.op){case"StringNGrams":{const{nGrams:r,nGramsSplits:s}=UP.stringNGrams(KP("data",t,e,n),KP("dataSplits",t,e,n),KP("separator",t,e,n),KP("nGramWidths",t,e,n),KP("leftPad",t,e,n),KP("rightPad",t,e,n),KP("padWidth",t,e,n),KP("preserveShortSequences",t,e,n));return[r,s]}case"StringSplit":{const{indices:r,values:s,shape:o}=UP.stringSplit(KP("input",t,e,n),KP("delimiter",t,e,n),KP("skipEmpty",t,e,n));return[r,s,o]}case"StringToHashBucketFast":return[UP.stringToHashBucketFast(KP("input",t,e,n),KP("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"transformation":return DR((()=>((t,e,n)=>{switch(t.op){case"Cast":return[ER(KP("x",t,e,n),KP("dtype",t,e,n))];case"ExpandDims":{const r=KP("axis",t,e,n);return[uF(KP("x",t,e,n),r)]}case"Squeeze":{const r=KP("axis",t,e,n);return[DL(KP("x",t,e,n),r)]}case"Reshape":return[mD(KP("x",t,e,n),KP("shape",t,e,n))];case"MirrorPad":return[UF(KP("x",t,e,n),KP("padding",t,e,n),KP("mode",t,e,n))];case"PadV2":case"Pad":return[KF(KP("x",t,e,n),KP("padding",t,e,n),KP("constantValue",t,e,n))];case"SpaceToBatchND":{const r=KP("blockShape",t,e,n),s=KP("paddings",t,e,n);return[XF(KP("x",t,e,n),r,s)]}case"BatchToSpaceND":{const r=KP("blockShape",t,e,n),s=KP("crops",t,e,n);return[ND(KP("x",t,e,n),r,s)]}case"DepthToSpace":{const r=KP("blockSize",t,e,n),s=KP("dataFormat",t,e,n).toUpperCase();return[VD(KP("x",t,e,n),r,s)]}case"BroadcastTo":return[_D(KP("x",t,e,n),KP("shape",t,e,n))];case"BroadcastArgs":return[SD(KP("s0",t,e,n),KP("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"hash_table":return(async(t,e,n,r)=>{switch(t.op){case"HashTable":case"HashTableV2":{const s=KP("keyDType",t,e,n),o=KP("valueDType",t,e,n),i=new GB(s,o);return r.addHashTable(t.name,i),[i.handle]}case"LookupTableImport":case"LookupTableImportV2":{const s=KP("tableHandle",t,e,n,r),o=KP("keys",t,e,n),i=KP("values",t,e,n),a=r.getHashTableById(s.id);return[await a.import(o,i)]}case"LookupTableFind":case"LookupTableFindV2":{const s=KP("tableHandle",t,e,n,r),o=KP("keys",t,e,n),i=KP("defaultValue",t,e,n),a=r.getHashTableById(s.id);return[await a.find(o,i)]}case"LookupTableSize":case"LookupTableSizeV2":{const s=KP("tableHandle",t,e,n,r);return[r.getHashTableById(s.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n,r);case"custom":const s=HP(t.op);if(s&&s.customExecutor)return s.customExecutor(new DB(t,e,n));throw TypeError(`Custom op ${t.op} is not registered.`);default:throw TypeError(`Unknown op '${t.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return SO(s)?s.then((t=>[].concat(t))):[].concat(s)}class HB{constructor(t={},e={},n={},r={}){this.weightMap=t,this.tensorArrayMap=e,this.tensorListMap=n,this.functionMap=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(t,e){return{id:t,frameName:e,iterationId:0}}set currentContext(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const t=[];for(let e=0;e<this.contexts.length-1;e++){const n=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(n))}t.push(""),this._currentContextIds=t}contextIdforContexts(t){return t?t.map((t=>0===t.id&&0===t.iterationId?"":`${t.frameName}-${t.iterationId}`)).join("/"):""}enterFrame(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(t){return this.weightMap[t]}addTensorArray(t){this.tensorArrayMap[t.id]=t}getTensorArray(t){return this.tensorArrayMap[t]}addTensorList(t){this.tensorListMap[t.id]=t}getTensorList(t){return this.tensorListMap[t]}dispose(t){for(const e in this.tensorArrayMap)this.tensorArrayMap[e].clearAndClose(t);for(const e in this.tensorListMap)this.tensorListMap[e].clearAndClose(t)}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KB(t,e,n,r){const s=new Set,o=[];let i=null,a=null;const u=new Set,c=Object.keys(t).map((t=>ZP(t)[0]));let l=[];null!=r&&(l=r.map((t=>ZP(t.name)[0])));const f=[...e];for(;f.length>0;){const t=f.pop();(ZB(t)||QB(t)||tV(t))&&null==i&&(i=t,a=i.children.map((t=>t.name)).filter((t=>s.has(t)))),s.add(t.name),null==n[t.name]&&(-1===c.indexOf(t.name)&&-1===l.indexOf(t.name)&&(0!==t.inputs.length?t.inputs.forEach((t=>{u.has(t.name)||(u.add(t.name),f.push(t))})):o.push(t.name)))}return{inputs:t,outputs:e,usedNodes:s,missingInputs:o,dynamicNode:i,syncInputs:a}}const XB=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],JB=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],YB=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function ZB(t){return XB.indexOf(t.op)>=0}function QB(t){return JB.indexOf(t.op)>=0}function tV(t){return YB.indexOf(t.op)>=0}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eV{constructor(t,e){this.graph=t,this.parent=e,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((e=>{this._functionExecutorMap[e]=new eV(t.functions[e],this)}))}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){const e=Object.keys(t).map((e=>t[e].map((t=>t.id))));this._weightIds=[].concat(...e),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get outputs(){return this._outputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get inputNodes(){return this._inputs.map((t=>t.signatureKey||t.name))}get outputNodes(){return this._outputs.map((t=>{const e=t.signatureKey||t.name;return t.defaultOutput?`${e}:${t.defaultOutput}`:e}))}get functions(){return Object.keys(this._functions).reduce(((t,e)=>(t[e]=this._functions[e].signature,t)),{})}getCompilationKey(t,e){const n=t.map((t=>t.name)).sort(),r=e.map((t=>t.name)).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}compile(t,e){const n=KB(t,e,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:s,syncInputs:o}=n;if(null!=s)throw new Error(`This execution contains the node '${s.name}', which has the dynamic op '${s.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(r.length>0){const n=e.map((t=>t.name)),s=Object.keys(t);throw new Error(`Cannot compute the outputs [${n}] from the provided inputs [${s}]. Missing the following inputs: [${r}]`)}return function(t,e,n){const{usedNodes:r,inputs:s}=n,o=[],i=Object.keys(s).map((t=>ZP(t)[0])).map((e=>t.nodes[e])),a=t.initNodes;i.forEach((t=>{r.has(t.name)&&o.push(t)})),t.weights.forEach((t=>{r.has(t.name)&&o.push(t)})),null!=a&&a.forEach((t=>{r.has(t.name)&&o.push(t)}));const u=new Set,c=[];for(;o.length>0;){const t=o.pop();u.add(t.name),e[t.name]||c.push(t),t.children.forEach((t=>{!u.has(t.name)&&r.has(t.name)&&t.inputs.every((t=>u.has(t.name)))&&o.push(t)}))}return c}(this.graph,this.weightMap,n)}execute(t,e){t=this.mapInputs(t);const n=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e);const r=n.map((t=>this.graph.nodes[ZP(t)[0]])),s=e.map((t=>ZP(t)[0]));let o=s.map((t=>this.graph.nodes[t]));this.resetIntermediateTensors(),0===o.length&&(o=this._outputs);const i=this.getCompilationKey(r,o);let a=this.compiledMap.get(i);null==a&&(a=this.compile(t,o),this.compiledMap.set(i,a));const u={},c={};return DR((()=>{const n=new HB(this.weightMap,u,c,this.functionExecutorMap),r=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,s]=ZP(e),o=[];o[s]=t[e],r[n]=o}));const o=this.getFrozenTensorIds(r),i={};for(let t=0;t<a.length;t++){const e=a[t];if(!r[e.name]){const t=qB(e,r,n,this._resourceManager);if(SO(t))throw new Error(`The execution of the op '${e.op}' returned a promise. Please use model.executeAsync() instead.`);r[e.name]=t,this.checkTensorForDisposal(e.name,e,r,n,o,s,i)}}return null==this.parent&&n.dispose(o),e.map((t=>XP(t,r,n)))}))}getFrozenTensorIds(t){const e=[].concat.apply([],Object.keys(t).map((e=>t[e])).map((t=>t.map((t=>t.id)))));return new Set(e)}checkTensorForDisposal(t,e,n,r,s,o,i){"control"!==e.category&&-1===o.indexOf(t)&&(n[t].forEach((t=>{null!=t&&(i[t.id]=(i[t.id]||0)+e.children.length)})),e.inputs.forEach((t=>{if("control"!==t.category){const o=function(t,e,n){return e[YP(t,n.currentContextId)]}(t.name,n,r);null!=o&&o.forEach((t=>{if(t&&!t.kept&&!s.has(t.id)){const n=i[t.id];if(1===n){if(this.keepTensorForDebug){const[n,s]=JP(e.name,r);this.intermediateTensors[n]||(this.intermediateTensors[n]=[]),this.intermediateTensors[n][s]=t}else t.dispose();delete i[t.id]}else null!=n&&i[t.id]--}}))}})))}async executeAsync(t,e){return this._executeAsync(t,e)}disposeIntermediateTensors(){this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach((t=>this.intermediateTensors[t].forEach((t=>t.dispose())))),this.disposeTensorsMap())}disposeTensorsMap(){this.tensorsMap&&Object.keys(this.tensorsMap).forEach((t=>{this.tensorsMap[t].forEach((t=>{!t||t.kept||t.isDisposed||this.keepIds.has(t.id)||t.dispose()}))}))}getIntermediateTensors(){return this.tensorsMap}resetIntermediateTensors(){for(const t in this.intermediateTensors)this.intermediateTensors[t].forEach((t=>t.dispose())),delete this.intermediateTensors[t]}async _executeAsync(t,e,n=!1,r={},s={}){n||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e));try{this.keepTensorForDebug=kO().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(t){console.warn(t.message)}this.resetIntermediateTensors();const o=new HB(this.weightMap,r,s,this.functionExecutorMap);this.tensorsMap=await this.executeWithControlFlow(t,o,e,n);const i=e.map((t=>XP(t,this.tensorsMap,o))),a=i.map((t=>t.id)),u=Object.keys(t).map((e=>t[e].id));return this.keepIds=new Set([...a,...u,...this.weightIds]),this.keepTensorForDebug||this.disposeTensorsMap(),null==this.parent&&o.dispose(this.keepIds),i}async executeFunctionAsync(t,e,n){const r=t.reduce(((t,e,n)=>(t[this.inputs[n].name]=e,t)),{});return this._executeAsync(r,this.outputNodes,!0,e,n)}async executeWithControlFlow(t,e,n,r){const s=Object.keys(t),o=s.map((t=>this.graph.nodes[ZP(t)[0]])),i=n.map((t=>ZP(t)[0]));let a=i.map((t=>this.graph.nodes[t]));0===a.length&&(a=this._outputs);const{usedNodes:u,missingInputs:c,dynamicNode:l,syncInputs:f}=KB(t,a,this.weightMap,this._initNodes),h=[...o,...this.graph.weights,...this._initNodes||[]].map((t=>({node:t,contexts:e.currentContext}))),p=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,r]=ZP(e),s=[];s[r]=t[e],p[n]=s}));const d={},m=this.getFrozenTensorIds(p),y={};for(;h.length>0;){const t=this.processStack(o,h,e,p,y,m,i,d,u);await Promise.all(t)}null!=l||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const g=a.filter((t=>!ZB(t)&&!XP(t.name,p,e))).map((t=>t.name));if(g.length>0){let t="";throw null!=l&&(t=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${f}]`),new Error(`Cannot compute the outputs [${g}] from the provided inputs [${s}]. Consider providing the following inputs: [${c}]. ${t}`)}return p}processStack(t,e,n,r,s,o,i,a,u){const c=[];for(;e.length>0;){const t=e.pop();n.currentContext=t.contexts;let l="";if("Enter"===t.node.op&&KP("isConstant",t.node,r,n)&&([l]=JP(t.node.name,n)),null==r[t.node.name]){const f=qB(t.node,r,n,this._resourceManager);l||([l]=JP(t.node.name,n));const h=n.currentContext;SO(f)?c.push(f.then((c=>(r[l]=c,n.currentContext=h,this.checkTensorForDisposal(l,t.node,r,n,o,i,a),this.processChildNodes(t.node,e,n,r,s,u),c)))):(r[l]=f,this.checkTensorForDisposal(l,t.node,r,n,o,i,a),this.processChildNodes(t.node,e,n,r,s,u))}else this.processChildNodes(t.node,e,n,r,s,u)}return c}processChildNodes(t,e,n,r,s,o){t.children.forEach((t=>{const[i]=JP(t.name,n);!s[i]&&o.has(t.name)&&("Merge"===t.op?t.inputNames.some((t=>!!XP(t,r,n)))&&(s[i]=!0,e.push({contexts:n.currentContext,node:t})):t.inputNames.every((t=>!!XP(t,r,n)))&&(s[i]=!0,e.push({contexts:n.currentContext,node:t})))}))}dispose(){Object.keys(this.weightMap).forEach((t=>this.weightMap[t].forEach((t=>t.dispose()))))}checkInputShapeAndType(t){Object.keys(t).forEach((e=>{const n=t[e],[r]=ZP(e),s=this.graph.nodes[r];if(s.attrParams.shape&&s.attrParams.shape.value){const t=s.attrParams.shape.value,e=t.length===n.shape.length&&n.shape.every(((e,n)=>-1===t[n]||t[n]===e));oO(e,(()=>`The shape of dict['${s.name}'] provided in model.execute(dict) must be [${t}], but was [${n.shape}]`))}s.attrParams.dtype&&s.attrParams.dtype.value&&oO(n.dtype===s.attrParams.dtype.value,(()=>`The dtype of dict['${s.name}'] provided in model.execute(dict) must be ${s.attrParams.dtype.value}, but was ${n.dtype}`))}))}mapInputs(t){const e={};for(const n in t)if(null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]){e[this._signature.inputs[n].name]=t[n]}else e[n]=t[n];return e}checkInputs(t){const e=Object.keys(t).filter((t=>{const[e]=ZP(t);return null==this.graph.nodes[e]}));if(e.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${e}] that are not part of graph`)}mapOutputs(t){return t.map((t=>{if(null!=this._signature&&null!=this._signature.outputs&&null!=this._signature.outputs[t]){return this._signature.outputs[t].name}return t}),{})}checkOutputs(t){t.forEach((t=>{const[e]=ZP(t);if(!this.graph.nodes[e])throw new Error(`The output '${t}' is not found in the graph`)}))}}class nV{constructor(t={},e={}){this.hashTableNameToHandle=t,this.hashTableMap=e}addHashTable(t,e){this.hashTableNameToHandle[t]=e.handle,this.hashTableMap[e.id]=e}getHashTableHandleByName(t){return this.hashTableNameToHandle[t]}getHashTableById(t){return this.hashTableMap[t]}dispose(){for(const t in this.hashTableMap)this.hashTableMap[t].clearAndClose(),delete this.hashTableMap[t];for(const t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rV{constructor(t,e={}){this.modelUrl=t,this.loadOptions=e,this.version="n/a",null==e&&(this.loadOptions={}),this.resourceManager=new nV}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}findIOHandler(){const t=this.modelUrl;if(null!=t.load)this.handler=t;else if(null!=this.loadOptions.requestInit)this.handler=IR(t,this.loadOptions);else{const r=(e=t,n=this.loadOptions,tR.getLoadHandlers(e,n));if(0===r.length)r.push(IR(t,this.loadOptions));else if(r.length>1)throw new Error(`Found more than one (${r.length}) load handlers for URL '${[t]}'`);this.handler=r[0]}var e,n;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */}load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const t=this.handler.load();return SO(t)?t.then((t=>this.loadSync(t))):this.loadSync(t)}loadSync(t){this.artifacts=t;const e=this.artifacts.modelTopology;let n;n=null!=this.artifacts.userDefinedMetadata&&null!=this.artifacts.userDefinedMetadata.signature?this.artifacts.userDefinedMetadata.signature:this.artifacts.signature,this.signature=n,this.version=`${e.versions.producer}.${e.versions.minConsumer}`;const r=function(t,e){const n={};let r,s=0;for(const o of e){const e=o.name,i=o.dtype,a=o.shape,u=cO(a);let c;if("quantization"in o){const n=o.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error(`Weight ${o.name} with quantization ${n.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==n.dtype)throw new Error(`Weight ${o.name} has unknown quantization dtype ${n.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==i)throw new Error(`Weight ${o.name} is quantized with ${n.dtype} which only supports weights of type float32 not ${i}.`)}const a=KM[n.dtype],l=t.slice(s,s+u*a),f="uint8"===n.dtype?new Uint8Array(l):new Uint16Array(l);if("float32"===i)if("uint8"===n.dtype||"uint16"===n.dtype){c=new Float32Array(f.length);for(let t=0;t<f.length;t++){const e=f[t];c[t]=e*n.scale+n.min}}else{if("float16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type float32.`);void 0===r&&(r=QM()),c=r(f)}else{if("int32"!==i)throw new Error(`Unsupported dtype in weight '${e}': ${i}`);if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type int32.`);c=new Int32Array(f.length);for(let t=0;t<f.length;t++){const e=f[t];c[t]=Math.round(e*n.scale+n.min)}}s+=u*a}else if("string"===i){const e=cO(o.shape);c=[];for(let n=0;n<e;n++){const e=new Uint32Array(t.slice(s,s+4))[0];s+=4;const n=new Uint8Array(t.slice(s,s+e));c.push(n),s+=e}}else{const r=KM[i],o=t.slice(s,s+u*r);if("float32"===i)c=new Float32Array(o);else if("int32"===i)c=new Int32Array(o);else if("bool"===i)c=new Uint8Array(o);else{if("complex64"!==i)throw new Error(`Unsupported dtype in weight '${e}': ${i}`);{c=new Float32Array(o);const t=new Float32Array(c.length/2),r=new Float32Array(c.length/2);for(let e=0;e<t.length;e++)t[e]=c[2*e],r[e]=c[2*e+1];const s=HM(t,a,"float32"),i=HM(r,a,"float32");n[e]=GM(s,i),s.dispose(),i.dispose()}}s+=u*r}"complex64"!==i&&(n[e]=HM(c,a,i))}return n}(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new eV(vB.Instance.transformGraph(e,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=t.modelInitializer&&null!=t.modelInitializer.node){const e=vB.Instance.transformGraph(t.modelInitializer);this.initializer=new eV(e),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(t,e){if("string"==typeof t){const e=(n=t,tR.getSaveHandlers(n));if(0===e.length)throw new Error(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new Error(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}var n;if(null==t.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return t.save(this.artifacts)}predict(t,e){return this.execute(t,this.outputNodes)}normalizeInputs(t){if(!(t instanceof SI||Array.isArray(t)))return t;if((t=Array.isArray(t)?t:[t]).length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${t.length} input tensors.`);return this.inputNodes.reduce(((e,n,r)=>(e[n]=t[r],e)),{})}normalizeOutputs(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]}execute(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=this.executor.execute(t,e);return n.length>1?n:n[0]}async executeAsync(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=await this.executor.executeAsync(t,e);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(t){return Object.keys(t).reduce(((e,n)=>(e[n]=[t[n]],e)),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}async function sV(t,e={}){if(null==t)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==e&&(e={}),e.fromTFHub&&"string"==typeof t&&(t=function(t){t.endsWith("/")||(t+="/");return`${t}model.json?tfjs-format=file`}
/**
    * @license
    * Copyright 2021 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */(t));const n=new rV(t,e);return await n.load(),n}var oV=function(){return(oV=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)};function iV(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}u((r=r.apply(t,e||[])).next())}))}function aV(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((s=(s=i.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function uV(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}u((r=r.apply(t,e||[])).next())}))}function cV(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=(s=i.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var lV=function(t){return{startEndTensor:t,startPoint:vD(t,[0,0],[-1,2]),endPoint:vD(t,[0,2],[-1,2])}},fV={strides:[8,16],anchors:[2,6]};function hV(t,e){var n,r,s;if(t.topLeft instanceof SI&&t.bottomRight instanceof SI){var o=DR((function(){return[bD([vD(TF(e-1,t.topLeft),0,1),vD(t.topLeft,1,1)]),bD([TF(e-1,vD(t.bottomRight,0,1)),vD(t.bottomRight,1,1)])]}));n=o[0],r=o[1],null!=t.landmarks&&(s=DR((function(){var n=TF(VL([e-1,0]),t.landmarks),r=VL([1,-1]);return KR(n,r)})))}else{var i=t.topLeft,a=i[0],u=i[1],c=t.bottomRight,l=c[0],f=c[1];n=[e-1-a,u],r=[e-1-l,f],null!=t.landmarks&&(s=t.landmarks.map((function(t){return[e-1-t[0],t[1]]})))}var h={topLeft:n,bottomRight:r};return null!=s&&(h.landmarks=s),null!=t.probability&&(h.probability=t.probability instanceof SI?t.probability.clone():t.probability),h}function pV(t,e){return DR((function(){var n;return n=t.hasOwnProperty("box")?t.box:t,DL(function(t,e){var n=KR(t.startPoint,e),r=KR(t.endPoint,e),s=AD([n,r],1);return lV(s)}(n,e).startEndTensor)}))}var dV=function(){function t(t,e,n,r,s,o){this.blazeFaceModel=t,this.width=e,this.height=n,this.maxFaces=r,this.anchorsData=function(t,e,n){for(var r=[],s=0;s<n.strides.length;s++)for(var o=n.strides[s],i=Math.floor((e+o-1)/o),a=Math.floor((t+o-1)/o),u=n.anchors[s],c=0;c<i;c++)for(var l=o*(c+.5),f=0;f<a;f++)for(var h=o*(f+.5),p=0;p<u;p++)r.push([h,l]);return r}(e,n,fV),this.anchors=zL(this.anchorsData),this.inputSizeData=[e,n],this.inputSize=VL([e,n]),this.iouThreshold=s,this.scoreThreshold=o}return t.prototype.getBoundingBoxes=function(t,e,n){return void 0===n&&(n=!0),uV(this,void 0,void 0,(function(){var r,s,o,i,a,u,c,l,f,h,p,d,m,y,g=this;return cV(this,(function(b){switch(b.label){case 0:return r=DR((function(){var e=zP.resizeBilinear(t,[g.width,g.height]),n=KR(TF(HR(e,255),.5),2),r=g.blazeFaceModel.predict(n),s=DL(r),o=function(t,e,n){var r=vD(t,[0,1],[-1,2]),s=GR(r,e),o=vD(t,[0,3],[-1,2]),i=HR(o,n),a=HR(s,n),u=HR(i,2),c=TF(a,u),l=GR(a,u),f=KR(c,n),h=KR(l,n);return AD([f,h],1)}(s,g.anchors,g.inputSize),i=vD(s,[0,0],[-1,1]);return[s,o,DL(wD(i))]})),s=r[0],o=r[1],i=r[2],a=console.warn,console.warn=function(){},u=zP.nonMaxSuppression(o,i,this.maxFaces,this.iouThreshold,this.scoreThreshold),console.warn=a,[4,u.array()];case 1:return c=b.sent(),u.dispose(),l=c.map((function(t){return vD(o,[t,0],[1,-1])})),e?[3,3]:[4,Promise.all(l.map((function(t){return uV(g,void 0,void 0,(function(){var e;return cV(this,(function(n){switch(n.label){case 0:return[4,t.array()];case 1:return e=n.sent(),t.dispose(),[2,e]}}))}))})))];case 2:l=b.sent(),b.label=3;case 3:for(f=t.shape[1],h=t.shape[2],p=e?HR([h,f],this.inputSize):[h/this.inputSizeData[0],f/this.inputSizeData[1]],d=[],m=function(t){var r=l[t],o=DR((function(){var o=lV(r instanceof SI?r:zL(r));if(!n)return o;var a,u=c[t];return a=e?vD(g.anchors,[u,0],[1,2]):g.anchorsData[u],{box:o,landmarks:mD(DL(vD(s,[u,5],[1,-1])),[6,-1]),probability:vD(i,[u],[1]),anchor:a}}));d.push(o)},y=0;y<l.length;y++)m(y);return o.dispose(),i.dispose(),s.dispose(),[2,{boxes:d,scaleFactor:p}]}}))}))},t.prototype.estimateFaces=function(t,e,n,r){return void 0===e&&(e=!1),void 0===n&&(n=!1),void 0===r&&(r=!0),uV(this,void 0,void 0,(function(){var s,o,i,a,u,c,l=this;return cV(this,(function(f){switch(f.label){case 0:return s=function(t){return t instanceof SI?[t.shape[0],t.shape[1]]:[t.height,t.width]}(t),o=s[1],i=DR((function(){return t instanceof SI||(t=UR(t)),uF(ER(t,"float32"),0)})),[4,this.getBoundingBoxes(i,e,r)];case 1:return a=f.sent(),u=a.boxes,c=a.scaleFactor,i.dispose(),e?[2,u.map((function(t){var e=pV(t,c),s={topLeft:vD(e,[0],[2]),bottomRight:vD(e,[2],[2])};if(r){var i=t,a=i.landmarks,u=i.probability,l=i.anchor,f=KR(GR(a,l),c);s.landmarks=f,s.probability=u}return n&&(s=hV(s,o)),s}))]:[2,Promise.all(u.map((function(t){return uV(l,void 0,void 0,(function(){var e,s,i,a,u,l,f,h,p,d,m,y=this;return cV(this,(function(g){switch(g.label){case 0:return e=pV(t,c),r?[3,2]:[4,e.array()];case 1:return u=g.sent(),s={topLeft:u.slice(0,2),bottomRight:u.slice(2)},[3,4];case 2:return[4,Promise.all([t.landmarks,e,t.probability].map((function(t){return uV(y,void 0,void 0,(function(){return cV(this,(function(e){return[2,t.array()]}))}))})))];case 3:i=g.sent(),a=i[0],u=i[1],l=i[2],f=t.anchor,p=(h=c)[0],d=h[1],m=a.map((function(t){return[(t[0]+f[0])*p,(t[1]+f[1])*d]})),s={topLeft:u.slice(0,2),bottomRight:u.slice(2),landmarks:m,probability:l},function(t){t.startEndTensor.dispose(),t.startPoint.dispose(),t.endPoint.dispose()}(t.box),t.landmarks.dispose(),t.probability.dispose(),g.label=4;case 4:return e.dispose(),n&&(s=hV(s,o)),[2,s]}}))}))})))]}}))}))},t}();function mV(t){var e=void 0===t?{}:t,n=e.maxFaces,r=void 0===n?10:n,s=e.inputWidth,o=void 0===s?128:s,i=e.inputHeight,a=void 0===i?128:i,u=e.iouThreshold,c=void 0===u?.3:u,l=e.scoreThreshold,f=void 0===l?.75:l,h=e.modelUrl;return uV(this,void 0,void 0,(function(){var t;return cV(this,(function(e){switch(e.label){case 0:return null==h?[3,2]:[4,sV(h)];case 1:return t=e.sent(),[3,4];case 2:return[4,sV("https://tfhub.dev/tensorflow/tfjs-model/blazeface/1/default/1",{fromTFHub:!0})];case 3:t=e.sent(),e.label=4;case 4:return[2,new dV(t,o,a,r,c,f)]}}))}))}var yV={silhouette:[10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109],lipsUpperOuter:[61,185,40,39,37,0,267,269,270,409,291],lipsLowerOuter:[146,91,181,84,17,314,405,321,375,291],lipsUpperInner:[78,191,80,81,82,13,312,311,310,415,308],lipsLowerInner:[78,95,88,178,87,14,317,402,318,324,308],rightEyeUpper0:[246,161,160,159,158,157,173],rightEyeLower0:[33,7,163,144,145,153,154,155,133],rightEyeUpper1:[247,30,29,27,28,56,190],rightEyeLower1:[130,25,110,24,23,22,26,112,243],rightEyeUpper2:[113,225,224,223,222,221,189],rightEyeLower2:[226,31,228,229,230,231,232,233,244],rightEyeLower3:[143,111,117,118,119,120,121,128,245],rightEyebrowUpper:[156,70,63,105,66,107,55,193],rightEyebrowLower:[35,124,46,53,52,65],rightEyeIris:[473,474,475,476,477],leftEyeUpper0:[466,388,387,386,385,384,398],leftEyeLower0:[263,249,390,373,374,380,381,382,362],leftEyeUpper1:[467,260,259,257,258,286,414],leftEyeLower1:[359,255,339,254,253,252,256,341,463],leftEyeUpper2:[342,445,444,443,442,441,413],leftEyeLower2:[446,261,448,449,450,451,452,453,464],leftEyeLower3:[372,340,346,347,348,349,350,357,465],leftEyebrowUpper:[383,300,293,334,296,336,285,417],leftEyebrowLower:[265,353,276,283,282,295],leftEyeIris:[468,469,470,471,472],midwayBetweenEyes:[168],noseTip:[1],noseBottom:[2],noseRightCorner:[98],noseLeftCorner:[327],rightCheek:[205],leftCheek:[425]};function gV(t){return[Math.abs(t.endPoint[0]-t.startPoint[0]),Math.abs(t.endPoint[1]-t.startPoint[1])]}function bV(t){return[t.startPoint[0]+(t.endPoint[0]-t.startPoint[0])/2,t.startPoint[1]+(t.endPoint[1]-t.startPoint[1])/2]}function wV(t,e){void 0===e&&(e=1.5);var n=bV(t),r=gV(t),s=[e*r[0]/2,e*r[1]/2];return{startPoint:[n[0]-s[0],n[1]-s[1]],endPoint:[n[0]+s[0],n[1]+s[1]],landmarks:t.landmarks}}function vV(t){var e=bV(t),n=gV(t),r=Math.max.apply(Math,n)/2;return{startPoint:[e[0]-r,e[1]-r],endPoint:[e[0]+r,e[1]+r],landmarks:t.landmarks}}var xV=[[1,0,0],[0,1,0],[0,0,1]];function NV(t,e){return[[1,0,t],[0,1,e],[0,0,1]]}function $V(t,e){for(var n=0,r=0;r<t.length;r++)n+=t[r]*e[r];return n}function EV(t,e){for(var n=[],r=0;r<t.length;r++)n.push(t[r][e]);return n}function SV(t,e){for(var n=[],r=t.length,s=0;s<r;s++){n.push([]);for(var o=0;o<r;o++)n[s].push($V(t[s],EV(e,o)))}return n}function _V(t,e){var n=Math.cos(t),r=Math.sin(t),s=[[n,-r,0],[r,n,0],[0,0,1]],o=SV(NV(e[0],e[1]),s);return SV(o,NV(-e[0],-e[1]))}var TV=[13,yV.midwayBetweenEyes[0]],kV=[3,2],AV=yV.leftEyeLower0,CV=[AV[0],AV[AV.length-1]],OV=yV.rightEyeLower0,IV=[OV[0],OV[OV.length-1]],MV=[{key:"EyeUpper0",indices:[9,10,11,12,13,14,15]},{key:"EyeUpper1",indices:[25,26,27,28,29,30,31]},{key:"EyeUpper2",indices:[41,42,43,44,45,46,47]},{key:"EyeLower0",indices:[0,1,2,3,4,5,6,7,8]},{key:"EyeLower1",indices:[16,17,18,19,20,21,22,23,24]},{key:"EyeLower2",indices:[32,33,34,35,36,37,38,39,40]},{key:"EyeLower3",indices:[54,55,56,57,58,59,60,61,62]},{key:"EyebrowUpper",indices:[63,64,65,66,67,68,69,70]},{key:"EyebrowLower",indices:[48,49,50,51,52,53]}];function RV(t,e,n,r){for(var s=0;s<MV.length;s++){var o=MV[s],i=o.key,a=o.indices,u=yV[""+n+i];if(null==r||r.includes(i))for(var c=0;c<a.length;c++){var l=a[c];t[u[c]]=[e[l][0],e[l][1],(e[l][2]+t[u[c]][2])/2]}}}var DV=function(){function t(t,e,n,r,s,o,i){this.regionsOfInterest=[],this.runsWithoutFaceDetector=0,this.boundingBoxDetector=t,this.meshDetector=e,this.irisModel=i,this.meshWidth=n,this.meshHeight=r,this.maxContinuousChecks=s,this.maxFaces=o}return t.prototype.transformRawCoords=function(t,e,n,r){var s,o,i,a,u=this,c=gV({startPoint:e.startPoint,endPoint:e.endPoint}),l=[c[0]/this.meshWidth,c[1]/this.meshHeight],f=t.map((function(t){return[l[0]*(t[0]-u.meshWidth/2),l[1]*(t[1]-u.meshHeight/2),t[2]]})),h=_V(n,[0,0]),p=f.map((function(t){return function(t,e){return[$V(t,e[0]),$V(t,e[1])]}(t,h).concat([t[2]])})),d=(o=[[(s=r)[0][0],s[1][0]],[s[0][1],s[1][1]]],i=[s[0][2],s[1][2]],a=[-$V(o[0],i),-$V(o[1],i)],[o[0].concat(a[0]),o[1].concat(a[1]),[0,0,1]]),m=bV({startPoint:e.startPoint,endPoint:e.endPoint}).concat([1]),y=[$V(m,d[0]),$V(m,d[1])];return p.map((function(t){return[t[0]+y[0],t[1]+y[1],t[2]]}))},t.prototype.getLeftToRightEyeDepthDifference=function(t){return t[CV[0]][2]-t[IV[0]][2]},t.prototype.getEyeBox=function(t,e,n,r,s){void 0===s&&(s=!1);var o=vV(wV(this.calculateLandmarksBoundingBox([t[n],t[r]]),2.3)),i=gV(o),a=zP.cropAndResize(e,[[o.startPoint[1]/this.meshHeight,o.startPoint[0]/this.meshWidth,o.endPoint[1]/this.meshHeight,o.endPoint[0]/this.meshWidth]],[0],[64,64]);return s&&(a=zP.flipLeftRight(a)),{box:o,boxSize:i,crop:a}},t.prototype.getEyeCoords=function(t,e,n,r){void 0===r&&(r=!1);for(var s=[],o=0;o<76;o++){var i=t[3*o],a=t[3*o+1],u=t[3*o+2];s.push([(r?1-i/64:i/64)*n[0]+e.startPoint[0],a/64*n[1]+e.startPoint[1],u])}return{rawCoords:s,iris:s.slice(71)}},t.prototype.getAdjustedIrisCoords=function(t,e,n){var r=t[yV[n+"EyeUpper0"][3]][2],s=t[yV[n+"EyeLower0"][4]][2],o=(r+s)/2;return e.map((function(t,e){var n=o;return 2===e?n=r:4===e&&(n=s),[t[0],t[1],n]}))},t.prototype.predict=function(t,e){return iV(this,void 0,void 0,(function(){var n,r,s,o,i=this;return aV(this,(function(a){switch(a.label){case 0:return this.shouldUpdateRegionsOfInterest()?[4,this.boundingBoxDetector.getBoundingBoxes(t,!1,!0)]:[3,2];case 1:return n=a.sent(),r=n.boxes,s=n.scaleFactor,0===r.length?(this.regionsOfInterest=[],[2,null]):(o=r.map((function(t){var e,n,r={startPoint:DL(t.box.startPoint).arraySync(),endPoint:DL(t.box.endPoint).arraySync()},o=vV(wV((n=s,{startPoint:[(e=r).startPoint[0]*n[0],e.startPoint[1]*n[1]],endPoint:[e.endPoint[0]*n[0],e.endPoint[1]*n[1]]})));return oV({},o,{landmarks:t.landmarks.arraySync()})})),r.forEach((function(t){null!=t&&null!=t.startPoint&&(t.startEndTensor.dispose(),t.startPoint.dispose(),t.endPoint.dispose())})),this.updateRegionsOfInterest(o),this.runsWithoutFaceDetector=0,[3,3]);case 2:this.runsWithoutFaceDetector++,a.label=3;case 3:return[2,DR((function(){return i.regionsOfInterest.map((function(n,r){var s,o=n.landmarks.length>=468,a=TV[0],u=TV[1];!1===o&&(a=kV[0],u=kV[1]),s=function(t,e){var n;return(n=Math.PI/2-Math.atan2(-(e[1]-t[1]),e[0]-t[0]))-2*Math.PI*Math.floor((n+Math.PI)/(2*Math.PI))}(n.landmarks[a],n.landmarks[u]);var c=bV({startPoint:n.startPoint,endPoint:n.endPoint}),l=[c[0]/t.shape[2],c[1]/t.shape[1]],f=t,h=xV;0!==s&&(f=zP.rotateWithOffset(t,s,0,l),h=_V(-s,c));var p={startPoint:n.startPoint,endPoint:n.endPoint},d=HR(function(t,e,n){var r=e.shape[1],s=e.shape[2],o=[[t.startPoint[1]/r,t.startPoint[0]/s,t.endPoint[1]/r,t.endPoint[0]/s]];return zP.cropAndResize(e,o,[0],n,"bilinear",0)}(p,f,[i.meshHeight,i.meshWidth]),255),m=i.meshDetector.predict(d),y=m[1],g=m[2],b=mD(g,[-1,3]).arraySync();if(e){var w=i.getEyeBox(b,d,CV[0],CV[1],!0),v=w.box,x=w.boxSize,N=w.crop,$=i.getEyeBox(b,d,IV[0],IV[1]),E=$.box,S=$.boxSize,_=$.crop,T=i.irisModel.predict(bD([N,_])).dataSync(),k=T.slice(0,228),A=i.getEyeCoords(k,v,x,!0),C=A.rawCoords,O=A.iris,I=T.slice(228),M=i.getEyeCoords(I,E,S),R=M.rawCoords,D=M.iris,F=i.getLeftToRightEyeDepthDifference(b);Math.abs(F)<30?(RV(b,C,"left"),RV(b,R,"right")):F<1?RV(b,C,"left",["EyeUpper0","EyeLower0"]):RV(b,R,"right",["EyeUpper0","EyeLower0"]);var L=i.getAdjustedIrisCoords(b,O,"left"),P=i.getAdjustedIrisCoords(b,D,"right");b=b.concat(L).concat(P)}var B=i.transformRawCoords(b,n,s,h),V=zL(B),z=wV(i.calculateLandmarksBoundingBox(B)),W=vV(z);return i.regionsOfInterest[r]=oV({},W,{landmarks:V.arraySync()}),{coords:zL(b,[b.length,3]),scaledCoords:V,box:z,flag:DL(y)}}))}))]}}))}))},t.prototype.updateRegionsOfInterest=function(t){for(var e=0;e<t.length;e++){var n=t[e],r=this.regionsOfInterest[e],s=0;if(r&&r.startPoint){var o=n.startPoint,i=o[0],a=o[1],u=n.endPoint,c=u[0],l=u[1],f=r.startPoint,h=f[0],p=f[1],d=r.endPoint,m=d[0],y=d[1],g=Math.max(i,h),b=Math.max(a,p),w=(Math.min(c,m)-g)*(Math.min(l,y)-b);s=w/((c-i)*(l-a)+(m-h)*(y-a)-w)}s<.25&&(this.regionsOfInterest[e]=n)}this.regionsOfInterest=this.regionsOfInterest.slice(0,t.length)},t.prototype.clearRegionOfInterest=function(t){null!=this.regionsOfInterest[t]&&(this.regionsOfInterest=this.regionsOfInterest.slice(0,t).concat(this.regionsOfInterest.slice(t+1)))},t.prototype.shouldUpdateRegionsOfInterest=function(){var t=this.regionsOfInterest.length,e=0===t;return 1===this.maxFaces||e?e:t!==this.maxFaces&&this.runsWithoutFaceDetector>=this.maxContinuousChecks},t.prototype.calculateLandmarksBoundingBox=function(t){var e=t.map((function(t){return t[0]})),n=t.map((function(t){return t[1]}));return{startPoint:[Math.min.apply(Math,e),Math.min.apply(Math,n)],endPoint:[Math.max.apply(Math,e),Math.max.apply(Math,n)]}},t}(),FV=[[.499976992607117,.652534008026123],[.500025987625122,.547487020492554],[.499974012374878,.602371990680695],[.482113003730774,.471979022026062],[.500150978565216,.527155995368958],[.499909996986389,.498252987861633],[.499523013830185,.40106201171875],[.289712011814117,.380764007568359],[.499954998493195,.312398016452789],[.499987006187439,.269918978214264],[.500023007392883,.107050001621246],[.500023007392883,.666234016418457],[.5000159740448,.679224014282227],[.500023007392883,.692348003387451],[.499976992607117,.695277988910675],[.499976992607117,.70593398809433],[.499976992607117,.719385027885437],[.499976992607117,.737019002437592],[.499967992305756,.781370997428894],[.499816000461578,.562981009483337],[.473773002624512,.573909997940063],[.104906998574734,.254140973091125],[.365929991006851,.409575998783112],[.338757991790771,.41302502155304],[.311120003461838,.409460008144379],[.274657994508743,.389131009578705],[.393361985683441,.403706014156342],[.345234006643295,.344011008739471],[.370094001293182,.346076011657715],[.319321990013123,.347265005111694],[.297903001308441,.353591024875641],[.24779200553894,.410809993743896],[.396889001131058,.842755019664764],[.280097991228104,.375599980354309],[.106310002505779,.399955987930298],[.2099249958992,.391353011131287],[.355807989835739,.534406006336212],[.471751004457474,.65040397644043],[.474155008792877,.680191993713379],[.439785003662109,.657229006290436],[.414617002010345,.66654098033905],[.450374007225037,.680860996246338],[.428770989179611,.682690978050232],[.374971002340317,.727805018424988],[.486716985702515,.547628998756409],[.485300987958908,.527395009994507],[.257764995098114,.314490020275116],[.401223003864288,.455172002315521],[.429818987846375,.548614978790283],[.421351999044418,.533740997314453],[.276895999908447,.532056987285614],[.483370006084442,.499586999416351],[.33721199631691,.282882988452911],[.296391993761063,.293242990970612],[.169294998049736,.193813979625702],[.447580009698868,.302609980106354],[.392390012741089,.353887975215912],[.354490011930466,.696784019470215],[.067304998636246,.730105042457581],[.442739009857178,.572826027870178],[.457098007202148,.584792017936707],[.381974011659622,.694710969924927],[.392388999462128,.694203019142151],[.277076005935669,.271932005882263],[.422551989555359,.563233017921448],[.385919004678726,.281364023685455],[.383103013038635,.255840003490448],[.331431001424789,.119714021682739],[.229923993349075,.232002973556519],[.364500999450684,.189113974571228],[.229622006416321,.299540996551514],[.173287004232407,.278747975826263],[.472878992557526,.666198015213013],[.446828007698059,.668527007102966],[.422762006521225,.673889994621277],[.445307999849319,.580065965652466],[.388103008270264,.693961024284363],[.403039008378983,.706539988517761],[.403629004955292,.693953037261963],[.460041999816895,.557139039039612],[.431158006191254,.692366003990173],[.452181994915009,.692366003990173],[.475387006998062,.692366003990173],[.465828001499176,.779190003871918],[.472328990697861,.736225962638855],[.473087012767792,.717857003211975],[.473122000694275,.704625964164734],[.473033010959625,.695277988910675],[.427942007780075,.695277988910675],[.426479011774063,.703539967536926],[.423162013292313,.711845993995667],[.4183090031147,.720062971115112],[.390094995498657,.639572978019714],[.013953999616206,.560034036636353],[.499913990497589,.58014702796936],[.413199990987778,.69539999961853],[.409626007080078,.701822996139526],[.468080013990402,.601534962654114],[.422728985548019,.585985004901886],[.463079988956451,.593783974647522],[.37211999297142,.47341400384903],[.334562003612518,.496073007583618],[.411671012639999,.546965003013611],[.242175996303558,.14767599105835],[.290776997804642,.201445996761322],[.327338010072708,.256527006626129],[.399509996175766,.748921036720276],[.441727995872498,.261676013469696],[.429764986038208,.187834024429321],[.412198007106781,.108901023864746],[.288955003023148,.398952007293701],[.218936994671822,.435410976409912],[.41278201341629,.398970007896423],[.257135003805161,.355440020561218],[.427684992551804,.437960982322693],[.448339998722076,.536936044692993],[.178560003638268,.45755398273468],[.247308000922203,.457193970680237],[.286267012357712,.467674970626831],[.332827985286713,.460712015628815],[.368755996227264,.447206974029541],[.398963987827301,.432654976844788],[.476410001516342,.405806005001068],[.189241006970406,.523923993110657],[.228962004184723,.348950982093811],[.490725994110107,.562400996685028],[.404670000076294,.485132992267609],[.019469000399113,.401564002037048],[.426243007183075,.420431017875671],[.396993011236191,.548797011375427],[.266469985246658,.376977026462555],[.439121007919312,.51895797252655],[.032313998788595,.644356966018677],[.419054001569748,.387154996395111],[.462783008813858,.505746960639954],[.238978996872902,.779744982719421],[.198220998048782,.831938028335571],[.107550002634525,.540755033493042],[.183610007166862,.740257024765015],[.134409993886948,.333683013916016],[.385764002799988,.883153975009918],[.490967005491257,.579378008842468],[.382384985685349,.508572995662689],[.174399003386497,.397670984268188],[.318785011768341,.39623498916626],[.343364000320435,.400596976280212],[.396100014448166,.710216999053955],[.187885001301765,.588537991046906],[.430987000465393,.944064974784851],[.318993002176285,.898285031318665],[.266247987747192,.869701027870178],[.500023007392883,.190576016902924],[.499976992607117,.954452991485596],[.366169989109039,.398822009563446],[.393207013607025,.39553701877594],[.410373002290726,.391080021858215],[.194993004202843,.342101991176605],[.388664990663528,.362284004688263],[.365961998701096,.355970978736877],[.343364000320435,.355356991291046],[.318785011768341,.35834002494812],[.301414996385574,.363156020641327],[.058132998645306,.319076001644135],[.301414996385574,.387449026107788],[.499987989664078,.618434011936188],[.415838003158569,.624195992946625],[.445681989192963,.566076993942261],[.465844005346298,.620640993118286],[.49992299079895,.351523995399475],[.288718998432159,.819945991039276],[.335278987884521,.852819979190826],[.440512001514435,.902418971061707],[.128294005990028,.791940987110138],[.408771991729736,.373893976211548],[.455606997013092,.451801002025604],[.499877005815506,.908990025520325],[.375436991453171,.924192011356354],[.11421000212431,.615022003650665],[.448662012815475,.695277988910675],[.4480200111866,.704632043838501],[.447111994028091,.715808033943176],[.444831997156143,.730794012546539],[.430011987686157,.766808986663818],[.406787008047104,.685672998428345],[.400738000869751,.681069016456604],[.392399996519089,.677703022956848],[.367855995893478,.663918972015381],[.247923001646996,.601333022117615],[.452769994735718,.420849978923798],[.43639200925827,.359887003898621],[.416164010763168,.368713974952698],[.413385987281799,.692366003990173],[.228018000721931,.683571994304657],[.468268007040024,.352671027183533],[.411361992359161,.804327011108398],[.499989002943039,.469825029373169],[.479153990745544,.442654013633728],[.499974012374878,.439637005329132],[.432112008333206,.493588984012604],[.499886006116867,.866917014122009],[.49991300702095,.821729004383087],[.456548988819122,.819200992584229],[.344549000263214,.745438992977142],[.37890899181366,.574010014533997],[.374292999505997,.780184984207153],[.319687992334366,.570737957954407],[.357154995203018,.604269981384277],[.295284003019333,.621580958366394],[.447750002145767,.862477004528046],[.410986006259918,.508723020553589],[.31395098567009,.775308012962341],[.354128003120422,.812552988529205],[.324548006057739,.703992962837219],[.189096003770828,.646299958229065],[.279776990413666,.71465802192688],[.1338230073452,.682700991630554],[.336768001317978,.644733011722565],[.429883986711502,.466521978378296],[.455527991056442,.548622965812683],[.437114000320435,.558896005153656],[.467287987470627,.529924988746643],[.414712011814117,.335219979286194],[.37704598903656,.322777986526489],[.344107985496521,.320150971412659],[.312875986099243,.32233202457428],[.283526003360748,.333190023899078],[.241245999932289,.382785975933075],[.102986000478268,.468762993812561],[.267612010240555,.424560010433197],[.297879010438919,.433175981044769],[.333433985710144,.433878004550934],[.366427004337311,.426115989685059],[.396012008190155,.416696012020111],[.420121014118195,.41022801399231],[.007561000064015,.480777025222778],[.432949006557465,.569517970085144],[.458638995885849,.479089021682739],[.473466008901596,.545744001865387],[.476087987422943,.563830018043518],[.468472003936768,.555056989192963],[.433990985155106,.582361996173859],[.483518004417419,.562983989715576],[.482482999563217,.57784903049469],[.42645001411438,.389798998832703],[.438998997211456,.39649498462677],[.450067013502121,.400434017181396],[.289712011814117,.368252992630005],[.276670008897781,.363372981548309],[.517862021923065,.471948027610779],[.710287988185883,.380764007568359],[.526226997375488,.573909997940063],[.895093023777008,.254140973091125],[.634069979190826,.409575998783112],[.661242008209229,.41302502155304],[.688880026340485,.409460008144379],[.725341975688934,.389131009578705],[.606630027294159,.40370500087738],[.654766023159027,.344011008739471],[.629905998706818,.346076011657715],[.680678009986877,.347265005111694],[.702096998691559,.353591024875641],[.75221198797226,.410804986953735],[.602918028831482,.842862963676453],[.719901978969574,.375599980354309],[.893692970275879,.399959981441498],[.790081977844238,.391354024410248],[.643998026847839,.534487962722778],[.528249025344849,.65040397644043],[.525849997997284,.680191040039062],[.560214996337891,.657229006290436],[.585384011268616,.66654098033905],[.549625992774963,.680860996246338],[.57122802734375,.682691991329193],[.624852001667023,.72809898853302],[.513050019741058,.547281980514526],[.51509702205658,.527251958847046],[.742246985435486,.314507007598877],[.598631024360657,.454979002475739],[.570338010787964,.548575043678284],[.578631997108459,.533622980117798],[.723087012767792,.532054007053375],[.516445994377136,.499638974666595],[.662801027297974,.282917976379395],[.70362401008606,.293271005153656],[.830704987049103,.193813979625702],[.552385985851288,.302568018436432],[.607609987258911,.353887975215912],[.645429015159607,.696707010269165],[.932694971561432,.730105042457581],[.557260990142822,.572826027870178],[.542901992797852,.584792017936707],[.6180260181427,.694710969924927],[.607590973377228,.694203019142151],[.722943007946014,.271963000297546],[.577413976192474,.563166975975037],[.614082992076874,.281386971473694],[.616907000541687,.255886018276215],[.668509006500244,.119913995265961],[.770092010498047,.232020974159241],[.635536015033722,.189248979091644],[.77039098739624,.299556016921997],[.826722025871277,.278755009174347],[.527121007442474,.666198015213013],[.553171992301941,.668527007102966],[.577238023281097,.673889994621277],[.554691970348358,.580065965652466],[.611896991729736,.693961024284363],[.59696102142334,.706539988517761],[.596370995044708,.693953037261963],[.539958000183105,.557139039039612],[.568841993808746,.692366003990173],[.547818005084991,.692366003990173],[.52461302280426,.692366003990173],[.534089982509613,.779141008853912],[.527670979499817,.736225962638855],[.526912987232208,.717857003211975],[.526877999305725,.704625964164734],[.526966989040375,.695277988910675],[.572058022022247,.695277988910675],[.573521018028259,.703539967536926],[.57683801651001,.711845993995667],[.581691026687622,.720062971115112],[.609944999217987,.639909982681274],[.986046016216278,.560034036636353],[.5867999792099,.69539999961853],[.590372025966644,.701822996139526],[.531915009021759,.601536989212036],[.577268004417419,.585934996604919],[.536915004253387,.593786001205444],[.627542972564697,.473352015018463],[.665585994720459,.495950996875763],[.588353991508484,.546862006187439],[.757824003696442,.14767599105835],[.709249973297119,.201507985591888],[.672684013843536,.256581008434296],[.600408971309662,.74900496006012],[.55826598405838,.261672019958496],[.570303976535797,.187870979309082],[.588165998458862,.109044015407562],[.711045026779175,.398952007293701],[.781069993972778,.435405015945435],[.587247014045715,.398931980133057],[.742869973182678,.355445981025696],[.572156012058258,.437651991844177],[.55186802148819,.536570012569427],[.821442008018494,.457556009292603],[.752701997756958,.457181990146637],[.71375697851181,.467626988887787],[.66711300611496,.460672974586487],[.631101012229919,.447153985500336],[.6008620262146,.432473003864288],[.523481011390686,.405627012252808],[.810747981071472,.523926019668579],[.771045982837677,.348959028720856],[.509127020835876,.562718033790588],[.595292985439301,.485023975372314],[.980530977249146,.401564002037048],[.573499977588654,.420000016689301],[.602994978427887,.548687994480133],[.733529984951019,.376977026462555],[.560611009597778,.519016981124878],[.967685997486115,.644356966018677],[.580985009670258,.387160003185272],[.537728011608124,.505385041236877],[.760966002941132,.779752969741821],[.801778972148895,.831938028335571],[.892440974712372,.54076099395752],[.816350996494293,.740260004997253],[.865594983100891,.333687007427216],[.614073991775513,.883246004581451],[.508952975273132,.579437971115112],[.617941975593567,.508316040039062],[.825608015060425,.397674977779388],[.681214988231659,.39623498916626],[.656635999679565,.400596976280212],[.603900015354156,.710216999053955],[.81208598613739,.588539004325867],[.56801301240921,.944564998149872],[.681007981300354,.898285031318665],[.733752012252808,.869701027870178],[.633830010890961,.398822009563446],[.606792986392975,.39553701877594],[.589659988880157,.391062021255493],[.805015981197357,.342108011245728],[.611334979534149,.362284004688263],[.634037971496582,.355970978736877],[.656635999679565,.355356991291046],[.681214988231659,.35834002494812],[.698584973812103,.363156020641327],[.941866993904114,.319076001644135],[.698584973812103,.387449026107788],[.584177017211914,.624107003211975],[.554318010807037,.566076993942261],[.534153997898102,.62064003944397],[.711217999458313,.819975018501282],[.664629995822906,.852871000766754],[.559099972248077,.902631998062134],[.871706008911133,.791940987110138],[.591234028339386,.373893976211548],[.544341027736664,.451583981513977],[.624562978744507,.924192011356354],[.88577002286911,.615028977394104],[.551338016986847,.695277988910675],[.551980018615723,.704632043838501],[.552887976169586,.715808033943176],[.555167973041534,.730794012546539],[.569944024085999,.767035007476807],[.593203008174896,.685675978660583],[.599261999130249,.681069016456604],[.607599973678589,.677703022956848],[.631937980651855,.663500010967255],[.752032995223999,.601315021514893],[.547226011753082,.420395016670227],[.563543975353241,.359827995300293],[.583841025829315,.368713974952698],[.586614012718201,.692366003990173],[.771915018558502,.683578014373779],[.531597018241882,.352482974529266],[.588370978832245,.804440975189209],[.52079701423645,.442565023899078],[.567984998226166,.493479013442993],[.543282985687256,.819254994392395],[.655317008495331,.745514988899231],[.621008992195129,.574018001556396],[.625559985637665,.78031200170517],[.680198013782501,.570719003677368],[.64276397228241,.604337990283966],[.704662978649139,.621529996395111],[.552012026309967,.862591981887817],[.589071989059448,.508637011051178],[.685944974422455,.775357007980347],[.645735025405884,.812640011310577],[.675342977046967,.703978002071381],[.810858011245728,.646304965019226],[.72012197971344,.714666962623596],[.866151988506317,.682704985141754],[.663187026977539,.644596993923187],[.570082008838654,.466325998306274],[.544561982154846,.548375964164734],[.562758982181549,.558784961700439],[.531987011432648,.530140042304993],[.585271000862122,.335177004337311],[.622952997684479,.32277899980545],[.655896008014679,.320163011550903],[.687132000923157,.322345972061157],[.716481983661652,.333200991153717],[.758756995201111,.382786989212036],[.897013008594513,.468769013881683],[.732392013072968,.424547016620636],[.70211398601532,.433162987232208],[.66652500629425,.433866024017334],[.633504986763,.426087975502014],[.603875994682312,.416586995124817],[.579657971858978,.409945011138916],[.992439985275269,.480777025222778],[.567192018032074,.569419980049133],[.54136598110199,.478899002075195],[.526564002037048,.546118021011353],[.523913025856018,.563830018043518],[.531529009342194,.555056989192963],[.566035985946655,.582329034805298],[.51631098985672,.563053965568542],[.5174720287323,.577877044677734],[.573594987392426,.389806985855103],[.560697972774506,.395331978797913],[.549755990505219,.399751007556915],[.710287988185883,.368252992630005],[.723330020904541,.363372981548309]];function LV(t){return iV(this,void 0,void 0,(function(){var e,n,r,s,o,i,a,u,c,l,f,h,p,d,m,y;return aV(this,(function(g){switch(g.label){case 0:return e=t.maxContinuousChecks,n=void 0===e?5:e,r=t.detectionConfidence,s=void 0===r?.9:r,o=t.maxFaces,i=void 0===o?10:o,a=t.iouThreshold,u=void 0===a?.3:a,c=t.scoreThreshold,l=void 0===c?.75:c,f=t.shouldLoadIrisModel,h=void 0===f||f,p=t.modelUrl,d=t.detectorModelUrl,m=t.irisModelUrl,h?[4,Promise.all([PV(d,i,u,l),BV(p),VV(m)])]:[3,2];case 1:return y=g.sent(),[3,4];case 2:return[4,Promise.all([PV(d,i,u,l),BV(p)])];case 3:y=g.sent(),g.label=4;case 4:return[2,new UV(y[0],y[1],n,s,i,h?y[2]:null)]}}))}))}function PV(t,e,n,r){return iV(this,void 0,void 0,(function(){return aV(this,(function(s){return[2,mV({modelUrl:t,maxFaces:e,iouThreshold:n,scoreThreshold:r})]}))}))}function BV(t){return iV(this,void 0,void 0,(function(){return aV(this,(function(e){return null!=t?[2,sV(t)]:[2,sV("https://tfhub.dev/mediapipe/tfjs-model/facemesh/1/default/1",{fromTFHub:!0})]}))}))}function VV(t){return iV(this,void 0,void 0,(function(){return aV(this,(function(e){return null!=t?[2,sV(t)]:[2,sV("https://tfhub.dev/mediapipe/tfjs-model/iris/1/default/2",{fromTFHub:!0})]}))}))}function zV(t,e){if(t.mesh instanceof SI){var n=DR((function(){var n=VL([e-1,0,0]),r=VL([1,-1,1]);return DR((function(){return[bD([TF(e-1,vD(t.boundingBox.topLeft,0,1)),vD(t.boundingBox.topLeft,1,1)]),bD([TF(e-1,vD(t.boundingBox.bottomRight,0,1)),vD(t.boundingBox.bottomRight,1,1)]),KR(TF(n,t.mesh),r),KR(TF(n,t.scaledMesh),r)]}))})),r=n[0],s=n[1],o=n[2],i=n[3];return Object.assign({},t,{boundingBox:{topLeft:r,bottomRight:s},mesh:o,scaledMesh:i})}return Object.assign({},t,{boundingBox:{topLeft:[e-1-t.boundingBox.topLeft[0],t.boundingBox.topLeft[1]],bottomRight:[e-1-t.boundingBox.bottomRight[0],t.boundingBox.bottomRight[1]]},mesh:t.mesh.map((function(t){var n=t.slice(0);return n[0]=e-1-t[0],n})),scaledMesh:t.scaledMesh.map((function(t){var n=t.slice(0);return n[0]=e-1-t[0],n}))})}var WV,UV=function(){function t(t,e,n,r,s,o){this.kind="MediaPipeFaceMesh",this.pipeline=new DV(t,e,192,192,n,s,o),this.detectionConfidence=r}return t.getAnnotations=function(){return yV},t.getUVCoords=function(){return FV},t.prototype.estimateFaces=function(t){return iV(this,void 0,void 0,(function(){var e,n,r,s,o,i,a,u,c,l,f,h,p=this;return aV(this,(function(d){switch(d.label){case 0:if(e=t.returnTensors,n=void 0!==e&&e,r=t.flipHorizontal,s=void 0!==r&&r,o=t.predictIrises,i=void 0===o||o,a=t.input,i&&null==this.pipeline.irisModel)throw new Error("The iris model was not loaded as part of facemesh. Please initialize the model with facemesh.load({shouldLoadIrisModel: true}).");return u=function(t){return t instanceof SI?[t.shape[0],t.shape[1]]:[t.height,t.width]}(a),c=u[1],l=DR((function(){return a instanceof SI||(a=UR(a)),uF(ER(a,"float32"),0)})),"webgl"!==VI.backendName?[3,2]:(h=kO().get("WEBGL_PACK_DEPTHWISECONV"),kO().set("WEBGL_PACK_DEPTHWISECONV",!0),[4,this.pipeline.predict(l,i)]);case 1:return f=d.sent(),kO().set("WEBGL_PACK_DEPTHWISECONV",h),[3,4];case 2:return[4,this.pipeline.predict(l,i)];case 3:f=d.sent(),d.label=4;case 4:return l.dispose(),null!=f&&f.length>0?[2,Promise.all(f.map((function(t,e){return iV(p,void 0,void 0,(function(){var r,o,a,u,l,f,h,p,d,m,y,g,b,w,v=this;return aV(this,(function(x){switch(x.label){case 0:return r=t.coords,o=t.scaledCoords,a=t.box,u=t.flag,l=[u],n||(l=l.concat([r,o])),[4,Promise.all(l.map((function(t){return iV(v,void 0,void 0,(function(){return aV(this,(function(e){return[2,t.array()]}))}))})))];case 1:if(f=x.sent(),h=f[0],u.dispose(),h<this.detectionConfidence&&this.pipeline.clearRegionOfInterest(e),n)return p={kind:"MediaPipePredictionTensors",faceInViewConfidence:h,mesh:r,scaledMesh:o,boundingBox:{topLeft:VL(a.startPoint),bottomRight:VL(a.endPoint)}},s?[2,zV(p,c)]:[2,p];for(w in d=f.slice(1),m=d[0],y=d[1],o.dispose(),r.dispose(),g={kind:"MediaPipePredictionValues",faceInViewConfidence:h,boundingBox:{topLeft:a.startPoint,bottomRight:a.endPoint},mesh:m,scaledMesh:y},s&&(g=zV(g,c)),b={},yV)(i||!1===w.includes("Iris"))&&(b[w]=yV[w].map((function(t){return g.scaledMesh[t]})));return g.annotations=b,[2,g]}}))}))})))]:[2,[]]}}))}))},t}();(WV||(WV={})).mediapipeFacemesh="mediapipe-facemesh";var jV=Object.freeze({__proto__:null,get SupportedPackages(){return WV},load:function(t,e){return void 0===t&&(t=WV.mediapipeFacemesh),void 0===e&&(e={}),iV(this,void 0,void 0,(function(){return aV(this,(function(n){if(t===WV.mediapipeFacemesh)return[2,LV(e)];throw new Error(t+" is not a valid package name.")}))}))}});let GV;class qV extends o{get poseType(){return"facelandmark"}get parts(){return["silhouette","lipsUpperOuter","lipsLowerOuter","lipsUpperInner","lipsLowerInner","rightEyeUpper0","rightEyeLower0","rightEyeUpper1","rightEyeLower1","rightEyeUpper2","rightEyeLower2","rightEyeLower3","rightEyebrowUpper","rightEyebrowLower","rightEyeIris","leftEyeUpper0","leftEyeLower0","leftEyeUpper1","leftEyeLower1","leftEyeUpper2","leftEyeLower2","leftEyeLower3","leftEyebrowUpper","leftEyebrowLower","leftEyeIris","midwayBetweenEyes","noseTip","noseBottom","noseRightCorner","noseLeftCorner","rightCheek","leftCheek"]}static get observedAttributes(){return super.observedAttributes.concat("maximumFaces","includeMeshPoints")}async onMetadata(){super.onMetadata(),await async function(){GV=await jV.load(jV.SupportedPackages.mediapipeFacemesh)}(),this.poseDetectionFrame()}async poseDetectionFrame(){const t=this.hasAttribute("maximumFaces")?Number(this.getAttribute("maximumFaces")):1;if((this.isPlaying||this.forceOneTimePoseProcess)&&this.videoEl.readyState>1){const e=await(async(t,e=0,n)=>{var r;const s=[];if(GV){const o=await GV.estimateFaces({input:t.videoElement}),i=Math.min(o.length,n.maximumFaces||1);for(let a=0;a<i;a++){const i=o[a];if(n.minConfidence<=i.faceInViewConfidence){const o=i.scaledMesh.slice(),u={time:Date.now()-e,pose:a,points:[],score:i.faceInViewConfidence,aspectRatio:t.aspectRatio};if(Object.keys(i.annotations).forEach((e=>{var r;const s=i.annotations[e],a={name:e,positions:[]};for(let e=0;e<s.length;e++){const i=s[e];if(null===(r=a.positions)||void 0===r||r.push([i[0]/t.naturalSize.width,i[1]/t.naturalSize.height,i[2]]),n.includeMeshPoints){const t=o.findIndex((t=>i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]));-1!==t&&o.splice(t,1)}}a.positions&&a.positions.length>0&&u.points.push(a)})),n.includeMeshPoints){const e={positions:[]};for(let n=0;n<o.length;n++){const s=o[n];null===(r=e.positions)||void 0===r||r.push([s[0]/t.naturalSize.width,s[1]/t.naturalSize.height,s[2]])}e.positions&&e.positions.length>0&&u.points.push(e)}s.push(u)}}}return s})(this,this.recordingStartTime,{maximumFaces:t,minConfidence:this.minConfidence/100,includeMeshPoints:this.hasAttribute("includeMeshPoints")});this.onPoseFrame(e),this.forceOneTimePoseProcess=!1}requestAnimationFrame((()=>this.poseDetectionFrame()))}}function HV(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(n){if("default"!==n&&!(n in t)){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}))})),Object.freeze(t)}customElements.define("facelandmark-video",qV);"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function KV(t){return t&&t.q&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function XV(t){if(t.q)return t;var e=Object.defineProperty({},"q",{value:!0});return Object.keys(t).forEach((function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})})),e}var JV={exports:{}},YV="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};(function(){var t;function e(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}var n="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t};var r=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof YV&&YV];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function s(t,e){if(e)t:{var s=r;t=t.split(".");for(var o=0;o<t.length-1;o++){var i=t[o];if(!(i in s))break t;s=s[i]}(e=e(o=s[t=t[t.length-1]]))!=o&&null!=e&&n(s,t,{configurable:!0,writable:!0,value:e})}}function o(t){return(t={next:t})[Symbol.iterator]=function(){return this},t}function i(t){var n="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return n?n.call(t):{next:e(t)}}function a(t){if(!(t instanceof Array)){t=i(t);for(var e,n=[];!(e=t.next()).done;)n.push(e.value);t=n}return t}s("Symbol",(function(t){function e(t,e){this.g=t,n(this,"description",{configurable:!0,writable:!0,value:e})}if(t)return t;e.prototype.toString=function(){return this.g};var r="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",s=0;return function t(n){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new e(r+(n||"")+"_"+s++,n)}})),s("Symbol.iterator",(function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var s="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),i=0;i<s.length;i++){var a=r[s[i]];"function"==typeof a&&"function"!=typeof a.prototype[t]&&n(a.prototype,t,{configurable:!0,writable:!0,value:function(){return o(e(this))}})}return t}));var u,c="function"==typeof Object.create?Object.create:function(t){function e(){}return e.prototype=t,new e};if("function"==typeof Object.setPrototypeOf)u=Object.setPrototypeOf;else{var l;t:{var f={};try{f.__proto__={a:!0},l=f.a;break t}catch(t){}l=!1}u=l?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var h=u;function p(t,e){if(t.prototype=c(e.prototype),t.prototype.constructor=t,h)h(t,e);else for(var n in e)if("prototype"!=n)if(Object.defineProperties){var r=Object.getOwnPropertyDescriptor(e,n);r&&Object.defineProperty(t,n,r)}else t[n]=e[n];t.ea=e.prototype}function d(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.s=this.m=0,this.j=null}function m(t){if(t.l)throw new TypeError("Generator is already running");t.l=!0}function y(t,e){t.j={U:e,V:!0},t.g=t.m||t.s}function g(t,e,n){return t.g=n,{value:e}}function b(t){this.g=new d,this.h=t}function w(t,e,n,r){try{var s=e.call(t.g.i,n);if(!(s instanceof Object))throw new TypeError("Iterator result "+s+" is not an object");if(!s.done)return t.g.l=!1,s;var o=s.value}catch(e){return t.g.i=null,y(t.g,e),v(t)}return t.g.i=null,r.call(t.g,o),v(t)}function v(t){for(;t.g.g;)try{var e=t.h(t.g);if(e)return t.g.l=!1,{value:e.value,done:!1}}catch(e){t.g.h=void 0,y(t.g,e)}if(t.g.l=!1,t.g.j){if(e=t.g.j,t.g.j=null,e.V)throw e.U;return{value:e.return,done:!0}}return{value:void 0,done:!0}}function x(t){this.next=function(e){return m(t.g),t.g.i?e=w(t,t.g.i.next,e,t.g.o):(t.g.o(e),e=v(t)),e},this.throw=function(e){return m(t.g),t.g.i?e=w(t,t.g.i.throw,e,t.g.o):(y(t.g,e),e=v(t)),e},this.return=function(e){return function(t,e){m(t.g);var n=t.g.i;return n?w(t,"return"in n?n.return:function(t){return{value:t,done:!0}},e,t.g.return):(t.g.return(e),v(t))}(t,e)},this[Symbol.iterator]=function(){return this}}function N(t,e){return e=new x(new b(e)),h&&t.prototype&&h(e,t.prototype),e}d.prototype.o=function(t){this.h=t},d.prototype.return=function(t){this.j={return:t},this.g=this.s};var $="function"==typeof Object.assign?Object.assign:function(t,e){for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r)for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t};s("Object.assign",(function(t){return t||$})),s("Promise",(function(t){function e(t){this.h=0,this.i=void 0,this.g=[],this.o=!1;var e=this.j();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function n(){this.g=null}function s(t){return t instanceof e?t:new e((function(e){e(t)}))}if(t)return t;n.prototype.h=function(t){if(null==this.g){this.g=[];var e=this;this.i((function(){e.l()}))}this.g.push(t)};var o=r.setTimeout;n.prototype.i=function(t){o(t,0)},n.prototype.l=function(){for(;this.g&&this.g.length;){var t=this.g;this.g=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.j(t)}}}this.g=null},n.prototype.j=function(t){this.i((function(){throw t}))},e.prototype.j=function(){function t(t){return function(r){n||(n=!0,t.call(e,r))}}var e=this,n=!1;return{resolve:t(this.C),reject:t(this.l)}},e.prototype.C=function(t){if(t===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.F(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.u(t):this.m(t)}},e.prototype.u=function(t){var e=void 0;try{e=t.then}catch(t){return void this.l(t)}"function"==typeof e?this.G(e,t):this.m(t)},e.prototype.l=function(t){this.s(2,t)},e.prototype.m=function(t){this.s(1,t)},e.prototype.s=function(t,e){if(0!=this.h)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.h);this.h=t,this.i=e,2===this.h&&this.D(),this.A()},e.prototype.D=function(){var t=this;o((function(){if(t.B()){var e=r.console;void 0!==e&&e.error(t.i)}}),1)},e.prototype.B=function(){if(this.o)return!1;var t=r.CustomEvent,e=r.Event,n=r.dispatchEvent;return void 0===n||("function"==typeof t?t=new t("unhandledrejection",{cancelable:!0}):"function"==typeof e?t=new e("unhandledrejection",{cancelable:!0}):(t=r.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,t),t.promise=this,t.reason=this.i,n(t))},e.prototype.A=function(){if(null!=this.g){for(var t=0;t<this.g.length;++t)a.h(this.g[t]);this.g=null}};var a=new n;return e.prototype.F=function(t){var e=this.j();t.J(e.resolve,e.reject)},e.prototype.G=function(t,e){var n=this.j();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},e.prototype.then=function(t,n){function r(t,e){return"function"==typeof t?function(e){try{s(t(e))}catch(t){o(t)}}:e}var s,o,i=new e((function(t,e){s=t,o=e}));return this.J(r(t,s),r(n,o)),i},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.J=function(t,e){function n(){switch(r.h){case 1:t(r.i);break;case 2:e(r.i);break;default:throw Error("Unexpected state: "+r.h)}}var r=this;null==this.g?a.h(n):this.g.push(n),this.o=!0},e.resolve=s,e.reject=function(t){return new e((function(e,n){n(t)}))},e.race=function(t){return new e((function(e,n){for(var r=i(t),o=r.next();!o.done;o=r.next())s(o.value).J(e,n)}))},e.all=function(t){var n=i(t),r=n.next();return r.done?s([]):new e((function(t,e){function o(e){return function(n){i[e]=n,0==--a&&t(i)}}var i=[],a=0;do{i.push(void 0),a++,s(r.value).J(o(i.length-1),e),r=n.next()}while(!r.done)}))},e})),s("Object.is",(function(t){return t||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}})),s("Array.prototype.includes",(function(t){return t||function(t,e){var n=this;n instanceof String&&(n=String(n));var r=n.length;for(0>(e=e||0)&&(e=Math.max(e+r,0));e<r;e++){var s=n[e];if(s===t||Object.is(s,t))return!0}return!1}})),s("String.prototype.includes",(function(t){return t||function(t,e){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==this.indexOf(t,e||0)}})),s("Array.prototype.keys",(function(t){return t||function(){return function(t,e){t instanceof String&&(t+="");var n=0,r=!1,s={next:function(){if(!r&&n<t.length){var s=n++;return{value:e(s,t[s]),done:!1}}return r=!0,{done:!0,value:void 0}}};return s[Symbol.iterator]=function(){return s},s}(this,(function(t){return t}))}}));var E=this||self;function S(t,e){t=t.split(".");var n,r=E;t[0]in r||void 0===r.execScript||r.execScript("var "+t[0]);for(;t.length&&(n=t.shift());)t.length||void 0===e?r=r[n]&&r[n]!==Object.prototype[n]?r[n]:r[n]={}:r[n]=e}function _(t,e){return e=String.fromCharCode.apply(null,e),null==t?e:t+e}var T,k,A="undefined"!=typeof TextDecoder,C="undefined"!=typeof TextEncoder;function O(t){if(C)t=(k||(k=new TextEncoder)).encode(t);else{var e=void 0;e=void 0!==e&&e;for(var n=0,r=new Uint8Array(3*t.length),s=0;s<t.length;s++){var o=t.charCodeAt(s);if(128>o)r[n++]=o;else{if(2048>o)r[n++]=o>>6|192;else{if(55296<=o&&57343>=o){if(56319>=o&&s<t.length){var i=t.charCodeAt(++s);if(56320<=i&&57343>=i){o=1024*(o-55296)+i-56320+65536,r[n++]=o>>18|240,r[n++]=o>>12&63|128,r[n++]=o>>6&63|128,r[n++]=63&o|128;continue}s--}if(e)throw Error("Found an unpaired surrogate");o=65533}r[n++]=o>>12|224,r[n++]=o>>6&63|128}r[n++]=63&o|128}}t=r.subarray(0,n)}return t}var I={},M=null;function R(t,e){void 0===e&&(e=0),F(),e=I[e];for(var n=Array(Math.floor(t.length/3)),r=e[64]||"",s=0,o=0;s<t.length-2;s+=3){var i=t[s],a=t[s+1],u=t[s+2],c=e[i>>2];i=e[(3&i)<<4|a>>4],a=e[(15&a)<<2|u>>6],u=e[63&u],n[o++]=c+i+a+u}switch(c=0,u=r,t.length-s){case 2:u=e[(15&(c=t[s+1]))<<2]||r;case 1:t=t[s],n[o]=e[t>>2]+e[(3&t)<<4|c>>4]+u+r}return n.join("")}function D(t){var e=t.length,n=3*e/4;n%3?n=Math.floor(n):-1!="=.".indexOf(t[e-1])&&(n=-1!="=.".indexOf(t[e-2])?n-2:n-1);var r=new Uint8Array(n),s=0;return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),s=M[n];if(null!=s)return s;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}F();for(var r=0;;){var s=n(-1),o=n(0),i=n(64),a=n(64);if(64===a&&-1===s)break;e(s<<2|o>>4),64!=i&&(e(o<<4&240|i>>2),64!=a&&e(i<<6&192|a))}}(t,(function(t){r[s++]=t})),r.subarray(0,s)}function F(){if(!M){M={};for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++){var r=t.concat(e[n].split(""));I[n]=r;for(var s=0;s<r.length;s++){var o=r[s];void 0===M[o]&&(M[o]=s)}}}}var L,P="function"==typeof Uint8Array.prototype.slice;function B(t,e,n){return e===n?L||(L=new Uint8Array(0)):P?t.slice(e,n):new Uint8Array(t.subarray(e,n))}var V=0;function z(t,e){e=void 0!==(e=void 0===e?{}:e).v&&e.v,this.h=null,this.g=this.i=this.j=0,this.l=!1,this.v=e,t&&W(this,t)}function W(t,e){e=e.constructor===Uint8Array?e:e.constructor===ArrayBuffer||e.constructor===Array?new Uint8Array(e):e.constructor===String?D(e):e instanceof Uint8Array?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(0),t.h=e,t.j=0,t.i=t.h.length,t.g=t.j}function U(t){var e=t.h,n=e[t.g],r=127&n;return 128>n?(t.g+=1,r):(r|=(127&(n=e[t.g+1]))<<7,128>n?(t.g+=2,r):(r|=(127&(n=e[t.g+2]))<<14,128>n?(t.g+=3,r):(r|=(127&(n=e[t.g+3]))<<21,128>n?(t.g+=4,r):(r|=(15&(n=e[t.g+4]))<<28,128>n?(t.g+=5,r>>>0):(t.g+=5,128<=e[t.g++]&&128<=e[t.g++]&&128<=e[t.g++]&&128<=e[t.g++]&&t.g++,r)))))}function j(t){var e=t.h[t.g],n=t.h[t.g+1],r=t.h[t.g+2],s=t.h[t.g+3];return t.g+=4,t=2*((n=(e<<0|n<<8|r<<16|s<<24)>>>0)>>31)+1,e=n>>>23&255,n&=8388607,255==e?n?NaN:1/0*t:0==e?t*Math.pow(2,-149)*n:t*Math.pow(2,e-150)*(n+Math.pow(2,23))}z.prototype.reset=function(){this.g=this.j};var G=[];function q(){this.g=new Uint8Array(64),this.h=0}function H(t,e){for(;127<e;)t.push(127&e|128),e>>>=7;t.push(e)}function K(t){var e={},n=void 0!==e.N&&e.N;this.o={v:void 0!==e.v&&e.v},this.N=n,e=this.o,G.length?(n=G.pop(),e&&(n.v=e.v),t&&W(n,t),t=n):t=new z(t,e),this.g=t,this.m=this.g.g,this.h=this.i=this.l=-1,this.j=!1}function X(t){var e=t.g;if((e=e.g==e.i)||(e=t.j)||(e=(e=t.g).l||0>e.g||e.g>e.i),e)return!1;t.m=t.g.g;var n=7&(e=U(t.g));return 0!=n&&5!=n&&1!=n&&2!=n&&3!=n&&4!=n?(t.j=!0,!1):(t.i=e,t.l=e>>>3,t.h=n,!0)}function J(t){switch(t.h){case 0:if(0!=t.h)J(t);else{for(t=t.g;128&t.h[t.g];)t.g++;t.g++}break;case 1:1!=t.h?J(t):(t=t.g).g+=8;break;case 2:if(2!=t.h)J(t);else{var e=U(t.g);(t=t.g).g+=e}break;case 5:5!=t.h?J(t):(t=t.g).g+=4;break;case 3:for(e=t.l;;){if(!X(t)){t.j=!0;break}if(4==t.h){t.l!=e&&(t.j=!0);break}J(t)}break;default:t.j=!0}}function Y(t,e,n){var r=t.g.i,s=U(t.g),o=t.g.g+s;if(t.g.i=o,n(e,t),0!==(n=o-t.g.g))throw Error("Message parsing ended unexpectedly. Expected to read "+s+" bytes, instead read "+(s-n)+" bytes, either the data ended unexpectedly or the message misreported its own length");return t.g.g=o,t.g.i=r,e}function Z(t){var e,n=U(t.g),r=(t=t.g).g;if(t.g+=n,t=t.h,A)(e=T)||(e=T=new TextDecoder("utf-8",{fatal:!1})),e=e.decode(t.subarray(r,r+n));else{n=r+n;for(var s,o,i,a=[],u=null;r<n;)128>(s=t[r++])?a.push(s):224>s?r>=n?a.push(65533):(o=t[r++],194>s||128!=(192&o)?(r--,a.push(65533)):a.push((31&s)<<6|63&o)):240>s?r>=n-1?a.push(65533):128!=(192&(o=t[r++]))||224===s&&160>o||237===s&&160<=o||128!=(192&(e=t[r++]))?(r--,a.push(65533)):a.push((15&s)<<12|(63&o)<<6|63&e):244>=s?r>=n-2?a.push(65533):128!=(192&(o=t[r++]))||0!=o-144+(s<<28)>>30||128!=(192&(e=t[r++]))||128!=(192&(i=t[r++]))?(r--,a.push(65533)):(s=(7&s)<<18|(63&o)<<12|(63&e)<<6|63&i,s-=65536,a.push(55296+(s>>10&1023),56320+(1023&s))):a.push(65533),8192<=a.length&&(u=_(u,a),a.length=0);e=_(u,a)}return e}function Q(){this.h=[],this.i=0,this.g=new q}function tt(t,e){0!==e.length&&(t.h.push(e),t.i+=e.length)}function et(t){var e=t.i+t.g.length();if(0===e)return new Uint8Array(0);e=new Uint8Array(e);for(var n=t.h,r=n.length,s=0,o=0;o<r;o++){var i=n[o];0!==i.length&&(e.set(i,s),s+=i.length)}return 0!==(r=(n=t.g).h)&&(e.set(n.g.subarray(0,r),s),n.h=0),t.h=[e],e}function nt(t,e,n){if(null!=n){H(t.g,8*e+5),t=t.g;var r=n;0===(r=(n=0>r?1:0)?-r:r)?0<1/r?V=0:(0,V=2147483648):isNaN(r)?(0,V=2147483647):34028234663852886e22<r?(0,V=(n<<31|2139095040)>>>0):11754943508222875e-54>r?(r=Math.round(r/Math.pow(2,-149)),0,V=(n<<31|r)>>>0):(e=Math.floor(Math.log(r)/Math.LN2),r*=Math.pow(2,-e),16777216<=(r=Math.round(8388608*r))&&++e,0,V=(n<<31|e+127<<23|8388607&r)>>>0),n=V,t.push(n>>>0&255),t.push(n>>>8&255),t.push(n>>>16&255),t.push(n>>>24&255)}}q.prototype.push=function(t){if(!(this.h+1<this.g.length)){var e=this.g;this.g=new Uint8Array(Math.ceil(1+2*this.g.length)),this.g.set(e)}this.g[this.h++]=t},q.prototype.length=function(){return this.h},q.prototype.end=function(){var t=this.g,e=this.h;return this.h=0,B(t,0,e)},K.prototype.reset=function(){this.g.reset(),this.h=this.l=-1};var rt="function"==typeof Uint8Array;function st(t,e,n){if(null!=t)return"object"==typeof t?rt&&t instanceof Uint8Array?n(t):ot(t,e,n):e(t)}function ot(t,e,n){if(Array.isArray(t)){for(var r=Array(t.length),s=0;s<t.length;s++)r[s]=st(t[s],e,n);return Array.isArray(t)&&t.W&&ct(r),r}for(s in r={},t)r[s]=st(t[s],e,n);return r}function it(t){return"number"==typeof t?isFinite(t)?t:String(t):t}var at,ut={W:{value:!0,configurable:!0}};function ct(t){return Array.isArray(t)&&!Object.isFrozen(t)&&Object.defineProperties(t,ut),t}function lt(t,e,n){var r=at;if(at=null,t||(t=r),r=this.constructor.ca,t||(t=r?[r]:[]),this.j=r?0:-1,this.i=null,this.g=t,t=(r=this.g.length)-1,!r||(null===(r=this.g[t])||"object"!=typeof r||Array.isArray(r)||rt&&r instanceof Uint8Array)?void 0!==e&&-1<e?(this.l=Math.max(e,t+1-this.j),this.h=null):this.l=Number.MAX_VALUE:(this.l=t-this.j,this.h=r),n)for(e=0;e<n.length;e++)(t=n[e])<this.l?(t+=this.j,(r=this.g[t])?ct(r):this.g[t]=ft):(ht(this),(r=this.h[t])?ct(r):this.h[t]=ft)}var ft=Object.freeze(ct([]));function ht(t){var e=t.l+t.j;t.g[e]||(t.h=t.g[e]={})}function pt(t,e,n){return-1===e?null:void 0!==n&&n||e>=t.l?t.h?t.h[e]:void 0:t.g[e+t.j]}function dt(t){var e=void 0!==e&&e,n=pt(t,1,e);return null==n&&(n=ft),n===ft&&yt(t,1,n=ct([]),e),n}function mt(t,e,n){return null==(t=null==(t=pt(t,e))?t:+t)?void 0===n?0:n:t}function yt(t,e,n,r){void 0!==r&&r||e>=t.l?(ht(t),t.h[e]=n):t.g[e+t.j]=n}function gt(t,e){t.i||(t.i={});var n=t.i[1];if(!n){var r=dt(t);n=[];for(var s=0;s<r.length;s++)n[s]=new e(r[s]);t.i[1]=n}return n}function bt(t,e,n,r){var s=gt(t,n);e=e||new n,t=dt(t),null!=r?(s.splice(r,0,e),t.splice(r,0,wt(e))):(s.push(e),t.push(wt(e)))}function wt(t,e){if(t.i)for(var n in t.i){var r=t.i[n];if(Array.isArray(r))for(var s=0;s<r.length;s++)r[s]&&wt(r[s]);else r&&wt(r)}return t.g}function vt(t,e){return null==(t=pt(t,e))?0:t}function xt(t,e){return null==(t=pt(t,e))?"":t}function Nt(t,e){if(t=t.m){tt(e,e.g.end());for(var n=0;n<t.length;n++)tt(e,t[n])}}function $t(t,e){if(4==e.h)return!1;var n=e.m;return J(e),e.N||(e=B(e.g.h,n,e.g.g),(n=t.m)?n.push(e):t.m=[e]),!0}function Et(t,e){var n=void 0;return new(n||(n=Promise))((function(r,s){function o(t){try{a(e.next(t))}catch(t){s(t)}}function i(t){try{a(e.throw(t))}catch(t){s(t)}}function a(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(o,i)}a((e=e.apply(t,void 0)).next())}))}function St(t){lt.call(this,t)}function _t(t,e){for(;X(e);)switch(e.i){case 8:var n=U(e.g);yt(t,1,n);break;case 21:yt(t,2,n=j(e.g));break;case 26:yt(t,3,n=Z(e));break;case 34:yt(t,4,n=Z(e));break;default:if(!$t(t,e))return t}return t}function Tt(t){lt.call(this,t,-1,kt)}lt.prototype.toJSON=function(){return ot(wt(this),it,R)},lt.prototype.toString=function(){return wt(this).toString()},p(St,lt),p(Tt,lt),Tt.prototype.addClassification=function(t,e){return bt(this,t,St,e),this};var kt=[1];function At(t){lt.call(this,t)}function Ct(t,e){for(;X(e);)switch(e.i){case 13:var n=j(e.g);yt(t,1,n);break;case 21:yt(t,2,n=j(e.g));break;case 29:yt(t,3,n=j(e.g));break;case 37:yt(t,4,n=j(e.g));break;case 45:yt(t,5,n=j(e.g));break;default:if(!$t(t,e))return t}return t}function Ot(t){lt.call(this,t,-1,It)}p(At,lt),p(Ot,lt);var It=[1];function Mt(t){lt.call(this,t)}function Rt(t,e,n){if(n=t.createShader(0===n?t.VERTEX_SHADER:t.FRAGMENT_SHADER),t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw Error("Could not compile WebGL shader.\n\n"+t.getShaderInfoLog(n));return n}function Dt(t){return gt(t,St).map((function(t){return{index:vt(t,1),Y:mt(t,2),label:null!=pt(t,3)?xt(t,3):void 0,displayName:null!=pt(t,4)?xt(t,4):void 0}}))}function Ft(t){return{x:mt(t,1),y:mt(t,2),z:mt(t,3),visibility:null!=pt(t,4)?mt(t,4):void 0}}function Lt(t){t:{var e=new Ot;for(t=new K(t);X(t);)if(10===t.i){bt(e,Y(t,new At,Ct),At,void 0)}else if(!$t(e,t))break t}return gt(e,At).map(Ft)}function Pt(t,e){this.h=t,this.g=e,this.l=0}function Bt(t,e,n){return function(t,e){var n=t.g;if(void 0===t.m){var r=Rt(n,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",0),s=Rt(n,"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D sampler0;\n  void main(){\n    gl_FragColor = texture2D(sampler0, vTex);\n  }",1),o=n.createProgram();if(n.attachShader(o,r),n.attachShader(o,s),n.linkProgram(o),!n.getProgramParameter(o,n.LINK_STATUS))throw Error("Could not compile WebGL program.\n\n"+n.getProgramInfoLog(o));r=t.m=o,n.useProgram(r),s=n.getUniformLocation(r,"sampler0"),t.j={I:n.getAttribLocation(r,"aVertex"),H:n.getAttribLocation(r,"aTex"),da:s},t.s=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,t.s),n.enableVertexAttribArray(t.j.I),n.vertexAttribPointer(t.j.I,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),t.o=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,t.o),n.enableVertexAttribArray(t.j.H),n.vertexAttribPointer(t.j.H,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.uniform1i(s,0)}r=t.j,n.useProgram(t.m),n.canvas.width=e.width,n.canvas.height=e.height,n.viewport(0,0,e.width,e.height),n.activeTexture(n.TEXTURE0),t.h.bindTexture2d(e.glName),n.enableVertexAttribArray(r.I),n.bindBuffer(n.ARRAY_BUFFER,t.s),n.vertexAttribPointer(r.I,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.H),n.bindBuffer(n.ARRAY_BUFFER,t.o),n.vertexAttribPointer(r.H,2,n.FLOAT,!1,0,0),n.bindFramebuffer(n.DRAW_FRAMEBUFFER?n.DRAW_FRAMEBUFFER:n.FRAMEBUFFER,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.colorMask(!0,!0,!0,!0),n.drawArrays(n.TRIANGLE_FAN,0,4),n.disableVertexAttribArray(r.I),n.disableVertexAttribArray(r.H),n.bindBuffer(n.ARRAY_BUFFER,null),t.h.bindTexture2d(0)}(t,e),"function"==typeof t.g.canvas.transferToImageBitmap?Promise.resolve(t.g.canvas.transferToImageBitmap()):n?Promise.resolve(t.g.canvas):"function"==typeof createImageBitmap?createImageBitmap(t.g.canvas):(void 0===t.i&&(t.i=document.createElement("canvas")),new Promise((function(e){t.i.height=t.g.canvas.height,t.i.width=t.g.canvas.width,t.i.getContext("2d",{}).drawImage(t.g.canvas,0,0,t.g.canvas.width,t.g.canvas.height),e(t.i)})))}function Vt(t){this.g=t}p(Mt,lt);var zt=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Wt(t,e){return e+t}function Ut(t,e){window[t]=e}function jt(t){if(this.g=t,this.listeners={},this.j={},this.F={},this.m={},this.s={},this.G=this.o=this.R=!0,this.C=Promise.resolve(),this.P="",this.B={},this.locateFile=t&&t.locateFile||Wt,"object"==typeof window)var e=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else{if("undefined"==typeof location)throw Error("solutions can only be loaded on a web page or in a web worker");e=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"}if(this.S=e,t.options)for(var n=(e=i(Object.keys(t.options))).next();!n.done;n=e.next()){n=n.value;var r=t.options[n].default;void 0!==r&&(this.j[n]="function"==typeof r?r():r)}}function Gt(t){return Et(t,(function t(){var e,n,r,s,o,i,u,c,l,f,h,p=this;return N(t,(function(t){switch(t.g){case 1:return e=p,p.R?(n=function(t,e){return void 0===t.g.files?[]:"function"==typeof t.g.files?t.g.files(e):t.g.files}(p,p.j),g(t,function(){return Et(this,(function t(){return N(t,(function(t){switch(t.g){case 1:return t.m=2,g(t,WebAssembly.instantiate(zt),4);case 4:t.g=3,t.m=0;break;case 2:return t.m=0,t.j=null,t.return(!1);case 3:return t.return(!0)}}))}))}(),2)):t.return();case 2:if(r=t.h,"object"==typeof window)return Ut("createMediapipeSolutionsWasm",{locateFile:p.locateFile}),Ut("createMediapipeSolutionsPackedAssets",{locateFile:p.locateFile}),i=n.filter((function(t){return void 0!==t.data})),u=n.filter((function(t){return void 0===t.data})),c=Promise.all(i.map((function(t){var n=qt(e,t.url);if(void 0!==t.path){var r=t.path;n=n.then((function(t){return e.overrideFile(r,t),Promise.resolve(t)}))}return n}))),l=Promise.all(u.map((function(t){return void 0===t.simd||t.simd&&r||!t.simd&&!r?function(t){var e=document.createElement("script");return e.setAttribute("src",t),e.setAttribute("crossorigin","anonymous"),new Promise((function(t){e.addEventListener("load",(function(){t()}),!1),e.addEventListener("error",(function(){t()}),!1),document.body.appendChild(e)}))}(e.locateFile(t.url,e.S)):Promise.resolve()}))).then((function(){return Et(e,(function t(){var e,n,r=this;return N(t,(function(t){if(1==t.g)return e=window.createMediapipeSolutionsWasm,n=window.createMediapipeSolutionsPackedAssets,g(t,e(n),2);r.h=t.h,t.g=0}))}))})),f=Et(e,(function t(){var e=this;return N(t,(function(t){return e.g.graph&&e.g.graph.url?t=g(t,qt(e,e.g.graph.url),0):(t.g=0,t=void 0),t}))})),g(t,Promise.all([l,c,f]),7);if("function"!=typeof importScripts)throw Error("solutions can only be loaded on a web page or in a web worker");return s=n.filter((function(t){return void 0===t.simd||t.simd&&r||!t.simd&&!r})).map((function(t){return e.locateFile(t.url,e.S)})),importScripts.apply(null,a(s)),g(t,createMediapipeSolutionsWasm(Module),6);case 6:p.h=t.h,p.l=new OffscreenCanvas(1,1),p.h.canvas=p.l,o=p.h.GL.createContext(p.l,{antialias:!1,alpha:!1,ba:"undefined"!=typeof WebGL2RenderingContext?2:1}),p.h.GL.makeContextCurrent(o),t.g=4;break;case 7:if(p.l=document.createElement("canvas"),!(h=p.l.getContext("webgl2",{}))&&!(h=p.l.getContext("webgl",{})))return alert("Failed to create WebGL canvas context when passing video frame."),t.return();p.D=h,p.h.canvas=p.l,p.h.createContext(p.l,!0,!0,{});case 4:p.i=new p.h.SolutionWasm,p.R=!1,t.g=0}}))}))}function qt(t,e){return Et(t,(function t(){var n,r,s=this;return N(t,(function(t){return e in s.F?t.return(s.F[e]):(n=s.locateFile(e,""),r=fetch(n).then((function(t){return t.arrayBuffer()})),s.F[e]=r,t.return(r))}))}))}function Ht(t,e,n){return Et(t,(function t(){var r,s,o,a,u,c,l,f,h,p,d,m,y,b,w=this;return N(t,(function(t){switch(t.g){case 1:if(!n)return t.return(e);for(r={},s=0,o=i(Object.keys(n)),a=o.next();!a.done;a=o.next())u=a.value,"string"!=typeof(c=n[u])&&"texture"===c.type&&void 0!==e[c.stream]&&++s;1<s&&(w.G=!1),l=i(Object.keys(n)),a=l.next();case 2:if(a.done){t.g=4;break}if(f=a.value,"string"==typeof(h=n[f]))return y=r,b=f,g(t,function(t,e,n){return Et(t,(function t(){var r,s=this;return N(t,(function(t){return"number"==typeof n||n instanceof Uint8Array||n instanceof s.h.Uint8BlobList?t.return(n):n instanceof s.h.Texture2dDataOut?((r=s.s[e])||(r=new Pt(s.h,s.D),s.s[e]=r),t.return(Bt(r,n,s.G))):t.return(void 0)}))}))}(w,f,e[h]),14);if(p=e[h.stream],"detection_list"===h.type){if(p){for(var v=p.getRectList(),x=p.getLandmarksList(),$=p.getClassificationsList(),E=[],S=0;S<v.size();++S){var _=v.get(S);t:{var T=new Mt;for(_=new K(_);X(_);)switch(_.i){case 13:var k=j(_.g);yt(T,1,k);break;case 21:yt(T,2,k=j(_.g));break;case 29:yt(T,3,k=j(_.g));break;case 37:yt(T,4,k=j(_.g));break;case 45:yt(T,5,k=j(_.g));break;case 48:for(var A=_.g,C=128,O=0,I=k=0;4>I&&128<=C;I++)O|=(127&(C=A.h[A.g++]))<<7*I;if(128<=C&&(O|=(127&(C=A.h[A.g++]))<<28,k|=(127&C)>>4),128<=C)for(I=0;5>I&&128<=C;I++)k|=(127&(C=A.h[A.g++]))<<7*I+3;128>C?(A=O>>>0,(k=2147483648&(C=k>>>0))&&(C=~C>>>0,0==(A=1+~A>>>0)&&(C=C+1>>>0)),A=4294967296*C+(A>>>0),k=k?-A:A):(A.l=!0,k=void 0),yt(T,6,k);break;default:if(!$t(T,_))break t}}T={Z:mt(T,1),$:mt(T,2),height:mt(T,3),width:mt(T,4),rotation:mt(T,5,0),X:vt(T,6)},_=Lt(x.get(S)),A=$.get(S);t:for(k=new Tt,A=new K(A);X(A);)if(10===A.i)k.addClassification(Y(A,new St,_t));else if(!$t(k,A))break t;T={T,O:_,M:Dt(k)},E.push(T)}v=E}else v=[];r[f]=v,t.g=7;break}if("proto_list"===h.type){if(p){for(v=Array(p.size()),x=0;x<p.size();x++)v[x]=p.get(x);p.delete()}else v=[];r[f]=v,t.g=7;break}if(void 0===p){t.g=3;break}if("float_list"===h.type){r[f]=p,t.g=7;break}if("proto"===h.type){r[f]=p,t.g=7;break}if("texture"!==h.type)throw Error("Unknown output config type: '"+h.type+"'");return(d=w.s[f])||(d=new Pt(w.h,w.D),w.s[f]=d),g(t,Bt(d,p,w.G),13);case 13:m=t.h,r[f]=m;case 7:h.transform&&r[f]&&(r[f]=h.transform(r[f])),t.g=3;break;case 14:y[b]=t.h;case 3:a=l.next(),t.g=2;break;case 4:return t.return(r)}}))}))}function Kt(t,e){for(var n=e.name||"$",r=[].concat(a(e.wants)),s=new t.h.StringList,o=i(e.wants),u=o.next();!u.done;u=o.next())s.push_back(u.value);o=t.h.PacketListener.implement({onResults:function(s){for(var o={},i=0;i<e.wants.length;++i)o[r[i]]=s.get(i);var a=t.listeners[n];a&&(t.C=Ht(t,o,e.outs).then((function(n){n=a(n);for(var s=0;s<e.wants.length;++s){var i=o[r[s]];"object"==typeof i&&i.hasOwnProperty&&i.hasOwnProperty("delete")&&i.delete()}n&&(t.C=n)})))}}),t.i.attachMultiListener(s,o),s.delete()}function Xt(t){switch(void 0===t&&(t=0),t){case 1:return"pose_landmark_full.tflite";case 2:return"pose_landmark_heavy.tflite";default:return"pose_landmark_lite.tflite"}}function Jt(t){var e=this;t=t||{},this.g=new jt({locateFile:t.locateFile,files:function(t){return[{url:"pose_solution_packed_assets_loader.js"},{simd:!1,url:"pose_solution_wasm_bin.js"},{simd:!0,url:"pose_solution_simd_wasm_bin.js"},{data:!0,url:Xt(t.modelComplexity)}]},graph:{url:"pose_web.binarypb"},listeners:[{wants:["pose_landmarks","world_landmarks","segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},poseLandmarks:{type:"proto",stream:"pose_landmarks",transform:Lt},poseWorldLandmarks:{type:"proto",stream:"world_landmarks",transform:Lt},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(t){return Et(e,(function e(){var n,r,s,o=this;return N(e,(function(e){return 1==e.g?(n=Xt(t),r="third_party/mediapipe/modules/pose_landmark/"+n,g(e,qt(o.g,n),2)):(s=e.h,o.g.overrideFile(r,s),e.return(!0))}))}))}},smoothLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothLandmarks",fieldName:"bool_value"}},enableSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorEnableSegmentation",fieldName:"bool_value"}},smoothSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothSegmentation",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"poselandmarkgpu__posedetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"poselandmarkgpu__poselandmarkbyroigpu__tensorstoposelandmarksandsegmentation__ThresholdingCalculator",fieldName:"threshold"}}}})}(t=jt.prototype).close=function(){return this.i&&this.i.delete(),Promise.resolve()},t.reset=function(){return Et(this,(function t(){var e=this;return N(t,(function(t){e.i&&(e.i.reset(),e.m={},e.s={}),t.g=0}))}))},t.setOptions=function(t,e){var n=this;if(e=e||this.g.options){for(var r=[],s=[],o={},a=i(Object.keys(t)),u=a.next();!u.done;o={K:o.K,L:o.L},u=a.next()){var c=u.value;c in this.j&&this.j[c]===t[c]||(this.j[c]=t[c],void 0!==(u=e[c])&&(u.onChange&&(o.K=u.onChange,o.L=t[c],r.push(function(t){return function(){return Et(n,(function e(){var n=this;return N(e,(function(e){if(1==e.g)return g(e,t.K(t.L),2);!0===e.h&&(n.o=!0),e.g=0}))}))}}(o))),u.graphOptionXref&&(c={valueNumber:1===u.type?t[c]:0,valueBoolean:0===u.type&&t[c],valueString:2===u.type?t[c]:""},u=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),u.graphOptionXref),c),s.push(u))))}0===r.length&&0===s.length||(this.o=!0,this.A=(void 0===this.A?[]:this.A).concat(s),this.u=(void 0===this.u?[]:this.u).concat(r))}},t.initialize=function(){return Et(this,(function t(){var e=this;return N(t,(function(t){return 1==t.g?g(t,Gt(e),2):3!=t.g?g(t,function(t){return Et(t,(function t(){var e,n,r,s,o,a,u,c,l=this;return N(t,(function(t){if(1==t.g)return l.g.graph&&l.g.graph.url&&l.P===l.g.graph.url?t.return():(l.o=!0,l.g.graph&&l.g.graph.url?(l.P=l.g.graph.url,g(t,qt(l,l.g.graph.url),3)):void(t.g=2));for(2!=t.g&&(e=t.h,l.i.loadGraph(e)),n=i(Object.keys(l.B)),r=n.next();!r.done;r=n.next())s=r.value,l.i.overrideFile(s,l.B[s]);if(l.B={},l.g.listeners)for(o=i(l.g.listeners),a=o.next();!a.done;a=o.next())u=a.value,Kt(l,u);c=l.j,l.j={},l.setOptions(c),t.g=0}))}))}(e),3):g(t,function(t){return Et(t,(function t(){var e,n,r,s,o,a,u=this;return N(t,(function(t){switch(t.g){case 1:if(!u.o)return t.return();if(!u.u){t.g=2;break}e=i(u.u),n=e.next();case 3:if(n.done){t.g=5;break}return g(t,(0,n.value)(),4);case 4:n=e.next(),t.g=3;break;case 5:u.u=void 0;case 2:if(u.A){for(r=new u.h.GraphOptionChangeRequestList,s=i(u.A),o=s.next();!o.done;o=s.next())a=o.value,r.push_back(a);u.i.changeOptions(r),r.delete(),u.A=void 0}u.o=!1,t.g=0}}))}))}(e),0)}))}))},t.overrideFile=function(t,e){this.i?this.i.overrideFile(t,e):this.B[t]=e},t.clearOverriddenFiles=function(){this.B={},this.i&&this.i.clearOverriddenFiles()},t.send=function(t,e){return Et(this,(function n(){var r,s,o,a,u,c,l,f,h,p=this;return N(n,(function(n){switch(n.g){case 1:return p.g.inputs?(r=1e3*(null==e?performance.now():e),g(n,p.C,2)):n.return();case 2:return g(n,p.initialize(),3);case 3:for(s=new p.h.PacketDataList,o=i(Object.keys(t)),a=o.next();!a.done;a=o.next())if(u=a.value,c=p.g.inputs[u]){t:{var d=p,m=t[u];switch(c.type){case"video":var y=d.m[c.stream];if(y||(y=new Pt(d.h,d.D),d.m[c.stream]=y),0===(d=y).l&&(d.l=d.h.createTexture()),"undefined"!=typeof HTMLVideoElement&&m instanceof HTMLVideoElement){var b=m.videoWidth;y=m.videoHeight}else"undefined"!=typeof HTMLImageElement&&m instanceof HTMLImageElement?(b=m.naturalWidth,y=m.naturalHeight):(b=m.width,y=m.height);y={glName:d.l,width:b,height:y},(b=d.g).canvas.width=y.width,b.canvas.height=y.height,b.activeTexture(b.TEXTURE0),d.h.bindTexture2d(d.l),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,m),d.h.bindTexture2d(0),d=y;break t;case"detections":for((y=d.m[c.stream])||(y=new Vt(d.h),d.m[c.stream]=y),(d=y).data||(d.data=new d.g.DetectionListData),d.data.reset(m.length),y=0;y<m.length;++y){b=m[y];var w=d.data,v=w.setBoundingBox,x=y,N=b.T,$=new Mt;yt($,1,N.Z),yt($,2,N.$),yt($,3,N.height),yt($,4,N.width),yt($,5,N.rotation),yt($,6,N.X);var E=N=new Q;nt(E,1,pt($,1)),nt(E,2,pt($,2)),nt(E,3,pt($,3)),nt(E,4,pt($,4)),nt(E,5,pt($,5));var S=pt($,6);if(null!=S&&null!=S){H(E.g,48);var _=E.g,T=S;S=0>T;var k=(T=Math.abs(T))>>>0;for(T=Math.floor((T-k)/4294967296),T>>>=0,S&&(T=~T>>>0,4294967295<(k=1+(~k>>>0))&&(k=0,4294967295<++T&&(T=0))),S=V=k,k=T;0<k||127<S;)_.push(127&S|128),S=(S>>>7|k<<25)>>>0,k>>>=7;_.push(S)}if(Nt($,E),N=et(N),v.call(w,x,N),b.O)for(w=0;w<b.O.length;++w)E=!!($=b.O[w]).visibility,x=(v=d.data).addNormalizedLandmark,N=y,$=Object.assign(Object.assign({},$),{visibility:E?$.visibility:0}),yt(E=new At,1,$.x),yt(E,2,$.y),yt(E,3,$.z),$.visibility&&yt(E,4,$.visibility),nt(_=$=new Q,1,pt(E,1)),nt(_,2,pt(E,2)),nt(_,3,pt(E,3)),nt(_,4,pt(E,4)),nt(_,5,pt(E,5)),Nt(E,_),$=et($),x.call(v,N,$);if(b.M)for(w=0;w<b.M.length;++w){if(x=(v=d.data).addClassification,N=y,$=b.M[w],yt(E=new St,2,$.Y),$.index&&yt(E,1,$.index),$.label&&yt(E,3,$.label),$.displayName&&yt(E,4,$.displayName),_=$=new Q,null!=(k=pt(E,1))&&null!=k)if(H(_.g,8),S=_.g,0<=k)H(S,k);else{for(T=0;9>T;T++)S.push(127&k|128),k>>=7;S.push(1)}nt(_,2,pt(E,2)),null!=(S=pt(E,3))&&(S=O(S),H(_.g,26),H(_.g,S.length),tt(_,_.g.end()),tt(_,S)),null!=(S=pt(E,4))&&(S=O(S),H(_.g,34),H(_.g,S.length),tt(_,_.g.end()),tt(_,S)),Nt(E,_),$=et($),x.call(v,N,$)}}d=d.data;break t;default:d={}}}switch(l=d,f=c.stream,c.type){case"video":s.pushTexture2d(Object.assign(Object.assign({},l),{stream:f,timestamp:r}));break;case"detections":(h=l).stream=f,h.timestamp=r,s.pushDetectionList(h);break;default:throw Error("Unknown input config type: '"+c.type+"'")}}return p.i.send(s),g(n,p.C,4);case 4:s.delete(),n.g=0}}))}))},t.onResults=function(t,e){this.listeners[e||"$"]=t},S("Solution",jt),S("OptionType",{BOOL:0,NUMBER:1,aa:2,0:"BOOL",1:"NUMBER",2:"STRING"}),(t=Jt.prototype).reset=function(){this.g.reset()},t.close=function(){return this.g.close(),Promise.resolve()},t.onResults=function(t){this.g.onResults(t)},t.initialize=function(){return Et(this,(function t(){var e=this;return N(t,(function(t){return g(t,e.g.initialize(),0)}))}))},t.send=function(t,e){return Et(this,(function n(){var r=this;return N(n,(function(n){return g(n,r.g.send(t,e),0)}))}))},t.setOptions=function(t){this.g.setOptions(t)},S("Pose",Jt),S("POSE_CONNECTIONS",[[0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]]),S("POSE_LANDMARKS",{NOSE:0,LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,LEFT_EAR:7,RIGHT_EAR:8,LEFT_RIGHT:9,RIGHT_LEFT:10,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32}),S("POSE_LANDMARKS_LEFT",{LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,LEFT_EAR:7,LEFT_RIGHT:9,LEFT_SHOULDER:11,LEFT_ELBOW:13,LEFT_WRIST:15,LEFT_PINKY:17,LEFT_INDEX:19,LEFT_THUMB:21,LEFT_HIP:23,LEFT_KNEE:25,LEFT_ANKLE:27,LEFT_HEEL:29,LEFT_FOOT_INDEX:31}),S("POSE_LANDMARKS_RIGHT",{RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,RIGHT_EAR:8,RIGHT_LEFT:10,RIGHT_SHOULDER:12,RIGHT_ELBOW:14,RIGHT_WRIST:16,RIGHT_PINKY:18,RIGHT_INDEX:20,RIGHT_THUMB:22,RIGHT_HIP:24,RIGHT_KNEE:26,RIGHT_ANKLE:28,RIGHT_HEEL:30,RIGHT_FOOT_INDEX:32}),S("POSE_LANDMARKS_NEUTRAL",{NOSE:0}),S("VERSION","0.4.1633558788")}).call(window);class ZV{refCount(t){return QV("refCount")}incRef(t){return QV("incRef")}timerAvailable(){return!0}time(t){return QV("time")}read(t){return QV("read")}readSync(t){return QV("readSync")}readToGPU(t,e){return QV("readToGPU")}numDataIds(){return QV("numDataIds")}disposeData(t,e){return QV("disposeData")}write(t,e,n){return QV("write")}move(t,e,n,r,s){return QV("move")}memory(){return QV("memory")}floatPrecision(){return QV("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return QV("dispose")}}function QV(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tz(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,nz(t,e,n)}function ez(t,e,n){return Math.max(t,Math.min(e,n))}function nz(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function rz(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function sz(t,e,n=""){rz(uz(t,e),(()=>n+` Shapes ${t} and ${e} must match`))}function oz(t){rz(null!=t,(()=>"The input to the tensor constructor must be a non-null value."))}function iz(t,e=[],n=!1){if(null==e&&(e=[]),Array.isArray(t)||gz(t)&&!n)for(let r=0;r<t.length;++r)iz(t[r],e,n);else e.push(t);return e}function az(t){if(0===t.length)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function uz(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function cz(t){return t%1==0}function lz(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function fz(t,e){const n=e.length;return t=null==t?e.map(((t,e)=>e)):[].concat(t),rz(t.every((t=>t>=-n&&t<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`)),rz(t.every((t=>cz(t))),(()=>`All values in axis param must be integers but got axis ${t}`)),t.map((t=>t<0?n+t:t))}function hz(t,e){const n=[],r=[],s=null!=e&&Array.isArray(e)&&0===e.length,o=null==e||s?null:fz(e,t).sort();let i=0;for(let e=0;e<t.length;++e){if(null!=o){if(o[i]===e&&1!==t[e])throw new Error(`Can't squeeze axis ${e} since its dim '${t[e]}' is not 1`);(null==o[i]||o[i]>e)&&1===t[e]&&(n.push(t[e]),r.push(e)),o[i]<=e&&i++}1!==t[e]&&(n.push(t[e]),r.push(e))}return{newShape:n,keptDims:r}}function pz(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error(`Unknown data type ${t}`);n=new Uint8Array(e)}return n}function dz(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error(`Unknown data type ${t}`);n=new Array(e)}return n}function mz(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function yz(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function gz(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function bz(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error(`Unknown dtype ${t}`)}function wz(t){if(null==t)return 0;let e=0;return t.forEach((t=>e+=t.length)),e}function vz(t){return"string"==typeof t||t instanceof String}function xz(t){return"boolean"==typeof t}function Nz(t){return"number"==typeof t}function $z(t){return Array.isArray(t)?$z(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":Nz(t)?"float32":vz(t)?"string":xz(t)?"bool":"float32"}function Ez(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Sz(t,e){for(let n=e;n<t;++n)if(t%n==0)return n;return t}function _z(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function Tz(t,e,n,r=!1){const s=new Array;if(1===e.length){const o=e[0]*(r?2:1);for(let e=0;e<o;e++)s[e]=n[t+e]}else{const o=e[0],i=e.slice(1),a=i.reduce(((t,e)=>t*e))*(r?2:1);for(let e=0;e<o;e++)s[e]=Tz(t+e*a,i,n,r)}return s}function kz(t,e,n=!1){if(0===t.length)return e[0];const r=t.reduce(((t,e)=>t*e))*(n?2:1);if(0===r)return[];if(r!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return Tz(0,t,e,n)}function Az(t,e){const n=Cz(t,e);for(let t=0;t<n.length;t++)n[t]=1;return n}function Cz(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function Oz(t){t.forEach((e=>{rz(Number.isInteger(e)&&e>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`))}))}function Iz(t){return t&&t.then&&"function"==typeof t.then}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mz{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Rz,this.populateURLFlags()}setPlatform(t,e){null!=this.platform&&(Dz().getBool("IS_TEST")||Dz().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=e}registerFlag(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){const e=this.urlFlags[t];Dz().getBool("IS_TEST")||Dz().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${e}.`),this.set(t,e)}}async getAsync(t){return t in this.flags||(this.flags[t]=await this.evaluateFlag(t)),this.flags[t]}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(Iz(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(null==this.flagRegistry[t])throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(null==this.flagRegistry[t])throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const t=this.getQueryParams(this.global.location.search);if("tfjsflags"in t){t.tfjsflags.split(",").forEach((t=>{const[e,n]=t.split(":");this.urlFlags[e]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}(e,n)}))}}}function Rz(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((t,...n)=>(function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")))),e}function Dz(){return Fz}let Fz=null;var Lz="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function Pz(){throw new Error("setTimeout has not been defined")}function Bz(){throw new Error("clearTimeout has not been defined")}var Vz=Pz,zz=Bz;function Wz(t){if(Vz===setTimeout)return setTimeout(t,0);if((Vz===Pz||!Vz)&&setTimeout)return Vz=setTimeout,setTimeout(t,0);try{return Vz(t,0)}catch(e){try{return Vz.call(null,t,0)}catch(e){return Vz.call(this,t,0)}}}"function"==typeof Lz.setTimeout&&(Vz=setTimeout),"function"==typeof Lz.clearTimeout&&(zz=clearTimeout);var Uz,jz=[],Gz=!1,qz=-1;function Hz(){Gz&&Uz&&(Gz=!1,Uz.length?jz=Uz.concat(jz):qz=-1,jz.length&&Kz())}function Kz(){if(!Gz){var t=Wz(Hz);Gz=!0;for(var e=jz.length;e;){for(Uz=jz,jz=[];++qz<e;)Uz&&Uz[qz].run();qz=-1,e=jz.length}Uz=null,Gz=!1,function(t){if(zz===clearTimeout)return clearTimeout(t);if((zz===Bz||!zz)&&clearTimeout)return zz=clearTimeout,clearTimeout(t);try{zz(t)}catch(e){try{return zz.call(null,t)}catch(e){return zz.call(this,t)}}}(t)}}function Xz(t,e){this.fun=t,this.array=e}Xz.prototype.run=function(){this.fun.apply(null,this.array)};function Jz(){}var Yz=Jz,Zz=Jz,Qz=Jz,tW=Jz,eW=Jz,nW=Jz,rW=Jz;var sW=Lz.performance||{},oW=sW.now||sW.mozNow||sW.msNow||sW.oNow||sW.webkitNow||function(){return(new Date).getTime()};var iW=new Date;var aW={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];jz.push(new Xz(t,e)),1!==jz.length||Gz||Wz(Kz)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:Yz,addListener:Zz,once:Qz,off:tW,removeListener:eW,removeAllListeners:nW,emit:rW,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*oW.call(sW),n=Math.floor(e),r=Math.floor(e%1*1e9);return t&&(n-=t[0],(r-=t[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-iW)/1e3}},uW=aW;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
let cW;function lW(){if(null==cW){let t;if("undefined"!=typeof window)t=window;else if(void 0!==Lz)t=Lz;else if(void 0!==uW)t=uW;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}cW=t}return cW}function fW(t,e){const n=function(){const t=lW();return null==t._tfGlobals&&(t._tfGlobals=new Map),t._tfGlobals}();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function hW(...t){Dz().getBool("IS_TEST")||Dz().getBool("PROD")||console.warn(...t)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const pW=fW("kernelRegistry",(()=>new Map)),dW=fW("gradRegistry",(()=>new Map));function mW(t,e){const n=wW(t,e);return pW.get(n)}function yW(t){return dW.get(t)}function gW(t){const e=pW.entries(),n=[];for(;;){const{done:r,value:s}=e.next();if(r)break;const[o,i]=s,[a]=o.split("_");a===t&&n.push(i)}return n}function bW(t){const{kernelName:e,backendName:n}=t,r=wW(e,n);pW.has(r)&&hW(`The kernel '${e}' for backend '${n}' is already registered`),pW.set(r,t)}function wW(t,e){return`${e}_${t}`}var vW=NW,xW=null;try{xW=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(Wot){}function NW(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function $W(t){return!0===(t&&t._)}NW.prototype._,Object.defineProperty(NW.prototype,"_",{value:!0}),NW.isLong=$W;var EW={},SW={};function _W(t,e){var n,r,s;return e?(s=0<=(t>>>=0)&&t<256)&&(r=SW[t])?r:(n=kW(t,(0|t)<0?-1:0,!0),s&&(SW[t]=n),n):(s=-128<=(t|=0)&&t<128)&&(r=EW[t])?r:(n=kW(t,t<0?-1:0,!1),s&&(EW[t]=n),n)}function TW(t,e){if(isNaN(t))return e?LW:FW;if(e){if(t<0)return LW;if(t>=MW)return WW}else{if(t<=-RW)return UW;if(t+1>=RW)return zW}return t<0?TW(-t,e).neg():kW(t%IW|0,t/IW|0,e)}function kW(t,e,n){return new NW(t,e,n)}NW.fromInt=_W,NW.fromNumber=TW,NW.fromBits=kW;var AW=Math.pow;function CW(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return FW;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return CW(t.substring(1),e,n).neg();for(var s=TW(AW(n,8)),o=FW,i=0;i<t.length;i+=8){var a=Math.min(8,t.length-i),u=parseInt(t.substring(i,i+a),n);if(a<8){var c=TW(AW(n,a));o=o.mul(c).add(TW(u))}else o=(o=o.mul(s)).add(TW(u))}return o.unsigned=e,o}function OW(t,e){return"number"==typeof t?TW(t,e):"string"==typeof t?CW(t,e):kW(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}NW.fromString=CW,NW.fromValue=OW;var IW=4294967296,MW=IW*IW,RW=MW/2,DW=_W(1<<24),FW=_W(0);NW.ZERO=FW;var LW=_W(0,!0);NW.UZERO=LW;var PW=_W(1);NW.ONE=PW;var BW=_W(1,!0);NW.UONE=BW;var VW=_W(-1);NW.NEG_ONE=VW;var zW=kW(-1,2147483647,!1);NW.MAX_VALUE=zW;var WW=kW(-1,-1,!0);NW.MAX_UNSIGNED_VALUE=WW;var UW=kW(0,-2147483648,!1);NW.MIN_VALUE=UW;var jW=NW.prototype;jW.toInt=function(){return this.unsigned?this.low>>>0:this.low},jW.toNumber=function(){return this.unsigned?(this.high>>>0)*IW+(this.low>>>0):this.high*IW+(this.low>>>0)},jW.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(UW)){var e=TW(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var s=TW(AW(t,6),this.unsigned),o=this,i="";;){var a=o.div(s),u=(o.sub(a.mul(s)).toInt()>>>0).toString(t);if((o=a).isZero())return u+i;for(;u.length<6;)u="0"+u;i=""+u+i}},jW.getHighBits=function(){return this.high},jW.getHighBitsUnsigned=function(){return this.high>>>0},jW.getLowBits=function(){return this.low},jW.getLowBitsUnsigned=function(){return this.low>>>0},jW.getNumBitsAbs=function(){if(this.isNegative())return this.eq(UW)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},jW.isZero=function(){return 0===this.high&&0===this.low},jW.eqz=jW.isZero,jW.isNegative=function(){return!this.unsigned&&this.high<0},jW.isPositive=function(){return this.unsigned||this.high>=0},jW.isOdd=function(){return 1==(1&this.low)},jW.isEven=function(){return 0==(1&this.low)},jW.equals=function(t){return $W(t)||(t=OW(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},jW.eq=jW.equals,jW.notEquals=function(t){return!this.eq(t)},jW.neq=jW.notEquals,jW.ne=jW.notEquals,jW.lessThan=function(t){return this.comp(t)<0},jW.lt=jW.lessThan,jW.lessThanOrEqual=function(t){return this.comp(t)<=0},jW.lte=jW.lessThanOrEqual,jW.le=jW.lessThanOrEqual,jW.greaterThan=function(t){return this.comp(t)>0},jW.gt=jW.greaterThan,jW.greaterThanOrEqual=function(t){return this.comp(t)>=0},jW.gte=jW.greaterThanOrEqual,jW.ge=jW.greaterThanOrEqual,jW.compare=function(t){if($W(t)||(t=OW(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},jW.comp=jW.compare,jW.negate=function(){return!this.unsigned&&this.eq(UW)?UW:this.not().add(PW)},jW.neg=jW.negate,jW.add=function(t){$W(t)||(t=OW(t));var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,o=t.high>>>16,i=65535&t.high,a=t.low>>>16,u=0,c=0,l=0,f=0;return l+=(f+=s+(65535&t.low))>>>16,c+=(l+=r+a)>>>16,u+=(c+=n+i)>>>16,u+=e+o,kW((l&=65535)<<16|(f&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},jW.subtract=function(t){return $W(t)||(t=OW(t)),this.add(t.neg())},jW.sub=jW.subtract,jW.multiply=function(t){if(this.isZero())return FW;if($W(t)||(t=OW(t)),xW)return kW(xW.mul(this.low,this.high,t.low,t.high),xW.get_high(),this.unsigned);if(t.isZero())return FW;if(this.eq(UW))return t.isOdd()?UW:FW;if(t.eq(UW))return this.isOdd()?UW:FW;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(DW)&&t.lt(DW))return TW(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,o=t.high>>>16,i=65535&t.high,a=t.low>>>16,u=65535&t.low,c=0,l=0,f=0,h=0;return f+=(h+=s*u)>>>16,l+=(f+=r*u)>>>16,f&=65535,l+=(f+=s*a)>>>16,c+=(l+=n*u)>>>16,l&=65535,c+=(l+=r*a)>>>16,l&=65535,c+=(l+=s*i)>>>16,c+=e*u+n*a+r*i+s*o,kW((f&=65535)<<16|(h&=65535),(c&=65535)<<16|(l&=65535),this.unsigned)},jW.mul=jW.multiply,jW.divide=function(t){if($W(t)||(t=OW(t)),t.isZero())throw Error("division by zero");var e,n,r;if(xW)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?kW((this.unsigned?xW.div_u:xW.div_s)(this.low,this.high,t.low,t.high),xW.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?LW:FW;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return LW;if(t.gt(this.shru(1)))return BW;r=LW}else{if(this.eq(UW))return t.eq(PW)||t.eq(VW)?UW:t.eq(UW)?PW:(e=this.shr(1).div(t).shl(1)).eq(FW)?t.isNegative()?PW:VW:(n=this.sub(t.mul(e)),r=e.add(n.div(t)));if(t.eq(UW))return this.unsigned?LW:FW;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=FW}for(n=this;n.gte(t);){e=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(e)/Math.LN2),o=s<=48?1:AW(2,s-48),i=TW(e),a=i.mul(t);a.isNegative()||a.gt(n);)a=(i=TW(e-=o,this.unsigned)).mul(t);i.isZero()&&(i=PW),r=r.add(i),n=n.sub(a)}return r},jW.div=jW.divide,jW.modulo=function(t){return $W(t)||(t=OW(t)),xW?kW((this.unsigned?xW.rem_u:xW.rem_s)(this.low,this.high,t.low,t.high),xW.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},jW.mod=jW.modulo,jW.rem=jW.modulo,jW.not=function(){return kW(~this.low,~this.high,this.unsigned)},jW.and=function(t){return $W(t)||(t=OW(t)),kW(this.low&t.low,this.high&t.high,this.unsigned)},jW.or=function(t){return $W(t)||(t=OW(t)),kW(this.low|t.low,this.high|t.high,this.unsigned)},jW.xor=function(t){return $W(t)||(t=OW(t)),kW(this.low^t.low,this.high^t.high,this.unsigned)},jW.shiftLeft=function(t){return $W(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?kW(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):kW(0,this.low<<t-32,this.unsigned)},jW.shl=jW.shiftLeft,jW.shiftRight=function(t){return $W(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?kW(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):kW(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},jW.shr=jW.shiftRight,jW.shiftRightUnsigned=function(t){if($W(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?kW(this.low>>>t|e<<32-t,e>>>t,this.unsigned):kW(32===t?e:e>>>t-32,0,this.unsigned)},jW.shru=jW.shiftRightUnsigned,jW.shr_u=jW.shiftRightUnsigned,jW.toSigned=function(){return this.unsigned?kW(this.low,this.high,!1):this},jW.toUnsigned=function(){return this.unsigned?this:kW(this.low,this.high,!0)},jW.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},jW.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},jW.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},NW.fromBytes=function(t,e,n){return n?NW.fromBytesLE(t,e):NW.fromBytesBE(t,e)},NW.fromBytesLE=function(t,e){return new NW(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},NW.fromBytesBE=function(t,e){return new NW(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const GW=vW||HV({__proto__:null,default:vW},[vW]);function qW(t){return GW.fromString(t,!0,16)}const HW=qW("c3a5c85c97cb3127"),KW=qW("b492b66fbe98f273"),XW=qW("9ae16a3b2f90404f");function JW(t){return t.xor(t.shru(47))}function YW(t,e,n){const r=t.slice(e,e+n);return GW.fromBytes(Array.from(r),!0,!0)}function ZW(t,e){return YW(t,e,8)}function QW(t,e){return YW(t,e,4)}function tU(t,e){return 0===e?t:t.shru(e).or(t.shl(64-e))}function eU(t,e,n=qW("9ddfea08eb382d69")){let r=t.xor(e).mul(n);r=r.xor(r.shru(47));let s=e.xor(r).mul(n);return s=s.xor(s.shru(47)),s=s.mul(n),s}function nU(t,e,n,r){return function(t,e,n,r,s,o){s=s.add(t),o=tU(o.add(s).add(r),21);const i=s;return s=(s=s.add(e)).add(n),o=o.add(tU(s,44)),[s.add(r),o.add(i)]}(ZW(t,e),ZW(t,e+8),ZW(t,e+16),ZW(t,e+24),n,r)}function rU(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=iz(t)),Dz().getBool("DEBUG")&&mz(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){const e=new Uint8Array(t.length);for(let n=0;n<e.length;++n)0!==Math.round(t[n])&&(e[n]=1);return e}throw new Error(`Unknown data type ${e}`)}function sU(){return Dz().platform.now()}function oU(t,e="utf-8"){return e=e||"utf-8",Dz().platform.encode(t,e)}function iU(t,e="utf-8"){return e=e||"utf-8",Dz().platform.decode(t,e)}var aU=Object.freeze({__proto__:null,createScalarValue:
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){return"string"===e?oU(t):rU([t],e)},toTypedArray:rU,now:sU,fetch:function(t,e){return Dz().platform.fetch(t,e)},encodeString:oU,decodeString:iU,shuffle:tz,shuffleCombo:function(t,e){if(t.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${e.length}`);let n=t.length,r=0;for(;n>0;)r=Math.random()*n|0,n--,nz(t,n,r),nz(e,n,r)},clamp:ez,nearestLargerEven:function(t){return t%2==0?t:t+1},swap:nz,sum:function(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e},randUniform:function(t,e){const n=Math.random();return e*n+(1-n)*t},distSquared:function(t,e){let n=0;for(let r=0;r<t.length;r++){const s=Number(t[r])-Number(e[r]);n+=s*s}return n},assert:rz,assertShapesMatch:sz,assertNonNull:oz,flatten:iz,sizeFromShape:az,isScalarShape:function(t){return 0===t.length},arraysEqual:uz,isInt:cz,tanh:function(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{const e=Math.exp(2*t);return(e-1)/(e+1)}},sizeToSquarishShape:function(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]},createShuffledIndices:function(t){const e=new Uint32Array(t);for(let n=0;n<t;++n)e[n]=n;return tz(e),e},rightPad:lz,repeatedTry:function(t,e=(t=>0),n){return new Promise(((r,s)=>{let o=0;const i=()=>{if(t())return void r();o++;const a=e(o);null!=n&&o>=n?s():setTimeout(i,a)};i()}))},inferFromImplicitShape:function(t,e){let n=1,r=-1;for(let e=0;e<t.length;++e)if(t[e]>=0)n*=t[e];else if(-1===t[e]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${e}`);r=e}else if(t[e]<0)throw Error(`Shapes can not be < 0. Found ${t[e]} at dim ${e}`);if(-1===r){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(0===n)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const s=t.slice();return s[r]=e/n,s},parseAxisParam:fz,squeezeShape:hz,getTypedArrayFromDType:pz,getArrayFromDType:dz,checkConversionForErrors:mz,isValidDtype:yz,hasEncodingLoss:function(t,e){return"complex64"!==e&&(("float32"!==e||"complex64"===t)&&(("int32"!==e||"float32"===t||"complex64"===t)&&("bool"!==e||"bool"!==t)))},isTypedArray:gz,bytesPerElement:bz,bytesFromStringArray:wz,isString:vz,isBoolean:xz,isNumber:Nz,inferDtype:$z,isFunction:Ez,nearestDivisor:Sz,computeStrides:_z,toNestedArray:kz,makeOnesTypedArray:Az,makeZerosTypedArray:Cz,makeZerosNestedTypedArray:function(t,e){const n=t.reduce(((t,e)=>t*e),1);if(null==e||"float32"===e)return kz(t,new Float32Array(n));if("int32"===e)return kz(t,new Int32Array(n));if("bool"===e)return kz(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)},assertNonNegativeIntegerDimensions:Oz,locToIndex:function(t,e,n){if(0===e)return 0;if(1===e)return t[0];let r=t[t.length-1];for(let e=0;e<t.length-1;++e)r+=n[e]*t[e];return r},indexToLoc:function(t,e,n){if(0===e)return[];if(1===e)return[t];const r=new Array(e);for(let e=0;e<r.length-1;++e)r[e]=Math.floor(t/n[e]),t-=r[e]*n[e];return r[r.length-1]=t,r},isPromise:Iz,hexToLong:qW,fingerPrint64:function(t,e=t.length){const n=GW.fromNumber(81,!0);if(e<=32)return e<=16?function(t,e=t.length){if(e>=8){const n=XW.add(2*e),r=ZW(t,0).add(XW),s=ZW(t,e-8);return eU(tU(s,37).mul(n).add(r),tU(r,25).add(s).mul(n),n)}if(e>=4){const n=XW.add(2*e);return eU(QW(t,0).shl(3).add(e),QW(t,e-4),n)}if(e>0){const n=t[0]+(t[e>>1]<<8),r=e+(t[e-1]<<2);return JW(XW.mul(n).xor(HW.mul(r))).mul(XW)}return XW}(t,e):function(t,e=t.length){const n=XW.add(2*e),r=ZW(t,0).mul(KW),s=ZW(t,8),o=ZW(t,e-8).mul(n),i=ZW(t,e-16).mul(XW);return eU(tU(r.add(s),43).add(tU(o,30)).add(i),r.add(tU(s.add(XW),18)).add(o),n)}(t,e);if(e<=64)return function(t,e=t.length){const n=XW.add(2*e),r=ZW(t,0).mul(XW),s=ZW(t,8),o=ZW(t,e-8).mul(n),i=ZW(t,e-16).mul(XW),a=tU(r.add(s),43).add(tU(o,30)).add(i),u=eU(a,r.add(tU(s.add(XW),18)).add(o),n),c=ZW(t,16).mul(n),l=ZW(t,24),f=a.add(ZW(t,e-32)).mul(n),h=u.add(ZW(t,e-24)).mul(n);return eU(tU(c.add(l),43).add(tU(f,30)).add(h),c.add(tU(l.add(r),18)).add(f),n)}(t,e);let r=n,s=n.mul(KW).add(113),o=JW(s.mul(XW).add(113)).mul(XW),i=[GW.UZERO,GW.UZERO],a=[GW.UZERO,GW.UZERO];r=r.mul(XW).add(ZW(t,0));let u=0;const c=64*(e-1>>6),l=c+(e-1&63)-63;do{r=tU(r.add(s).add(i[0]).add(ZW(t,u+8)),37).mul(KW),s=tU(s.add(i[1]).add(ZW(t,u+48)),42).mul(KW),r=r.xor(a[1]),s=s.add(i[0]).add(ZW(t,u+40)),o=tU(o.add(a[0]),33).mul(KW),i=nU(t,u,i[1].mul(KW),r.add(a[0])),a=nU(t,u+32,o.add(a[1]),s.add(ZW(t,u+16))),[o,r]=[r,o],u+=64}while(u!==c);const f=KW.add(o.and(255).shl(1));return u=l,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),r=tU(r.add(s).add(i[0]).add(ZW(t,u+8)),37).mul(f),s=tU(s.add(i[1]).add(ZW(t,u+48)),42).mul(f),r=r.xor(a[1].mul(9)),s=s.add(i[0].mul(9).add(ZW(t,u+40))),o=tU(o.add(a[0]),33).mul(f),i=nU(t,u,i[1].mul(f),r.add(a[0])),a=nU(t,u+32,o.add(a[1]),s.add(ZW(t,u+16))),[o,r]=[r,o],eU(eU(i[0],a[0],f).add(JW(s).mul(HW)).add(o),eU(i[1],a[1],f).add(r),f)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uU{constructor(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new lU)}profileKernel(t,e,n){let r;const s=()=>{r=n()};let o;const i=sU();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(s);else{s();for(const t of r)t.dataSync();o=Promise.resolve({kernelMs:sU()-i})}if(Dz().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let e=0;e<r.length;e++){const n=r[e];n.data().then((e=>{cU(e,n.dtype,t)}))}return{kernelName:t,outputs:r,inputs:e,timeMs:o.then((t=>t.kernelMs)),extraInfo:o.then((t=>null!=t.getExtraProfileInfo?t.getExtraProfileInfo():""))}}logKernelProfile(t){const{kernelName:e,outputs:n,timeMs:r,inputs:s,extraInfo:o}=t;n.forEach((t=>{Promise.all([t.data(),r,o]).then((n=>{this.logger.logKernelProfile(e,t,n[0],n[1],s,n[2])}))}))}}function cU(t,e,n){if("float32"!==e)return!1;for(let e=0;e<t.length;e++){const r=t[e];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class lU{logKernelProfile(t,e,n,r,s,o){const i="number"==typeof r?lz(`${r}ms`,9):r.error,a=lz(t,25),u=e.rank,c=e.size,l=lz(e.shape.toString(),14);let f="";for(const t in s){const n=s[t];if(null!=n){const r=n.shape||e.shape,s=r.length;f+=`${t}: ${s}D ${s>0?r:""} `}}console.log(`%c${a}\t%c${i}\t%c${u}D ${l}\t%c${c}\t%c${f}\t%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fU(t,e,n,r){const s=_z(e),o=function(t,e,n,r){const s=az(e),o=r[r.length-1],i=new Array(o).fill(0),a=e.length,u="complex64"===n?mU(t):t;if(a>1)for(let t=0;t<s/o;t++){const e=t*o;for(let t=0;t<o;t++)i[t]=Math.max(i[t],hU(u[e+t],0,n).length)}return i}(t,e,n,s),i=e.length,a=dU(t,e,n,s,o),u=["Tensor"];return r&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${i}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(a.map((t=>"    "+t)).join("\n")),u.join("\n")}function hU(t,e,n){let r;return r=Array.isArray(t)?`${parseFloat(t[0].toFixed(7))} + ${parseFloat(t[1].toFixed(7))}j`:vz(t)?`'${t}'`:"bool"===n?pU(t):parseFloat(t.toFixed(7)).toString(),lz(r,e)}function pU(t){return 0===t?"false":"true"}function dU(t,e,n,r,s,o=!0){const i="complex64"===n?2:1,a=e[0],u=e.length;if(0===u){if("complex64"===n){return[hU(mU(t)[0],0,n)]}return"bool"===n?[pU(t[0])]:[t[0].toString()]}if(1===u){if(a>20){const e=3*i;let r=Array.from(t.slice(0,e)),o=Array.from(t.slice((a-3)*i,a*i));return"complex64"===n&&(r=mU(r),o=mU(o)),["["+r.map(((t,e)=>hU(t,s[e],n))).join(", ")+", ..., "+o.map(((t,e)=>hU(t,s[a-3+e],n))).join(", ")+"]"]}return["["+("complex64"===n?mU(t):Array.from(t)).map(((t,e)=>hU(t,s[e],n))).join(", ")+"]"]}const c=e.slice(1),l=r.slice(1),f=r[0]*i,h=[];if(a>20){for(let e=0;e<3;e++){const r=e*f,o=r+f;h.push(...dU(t.slice(r,o),c,n,l,s,!1))}h.push("...");for(let e=a-3;e<a;e++){const r=e*f,o=r+f;h.push(...dU(t.slice(r,o),c,n,l,s,e===a-1))}}else for(let e=0;e<a;e++){const r=e*f,o=r+f;h.push(...dU(t.slice(r,o),c,n,l,s,e===a-1))}const p=2===u?",":"";h[0]="["+h[0]+p;for(let t=1;t<h.length-1;t++)h[t]=" "+h[t]+p;let d=",\n";for(let t=2;t<u;t++)d+="\n";return h[h.length-1]=" "+h[h.length-1]+"]"+(o?"":d),h}function mU(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yU{constructor(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=az(t),null!=n){const t=n.length;rz(t===this.size,(()=>`Length of values '${t}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||dz(e,this.size),this.strides=_z(t)}set(t,...e){0===e.length&&(e=[0]),rz(e.length===this.rank,(()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`));const n=this.locToIndex(e);this.values[n]=t}get(...t){0===t.length&&(t=[0]);let e=0;for(const n of t){if(n<0||n>=this.shape[e]){const e=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(e)}e++}let n=t[t.length-1];for(let e=0;e<t.length-1;++e)n+=this.strides[e]*t[e];return this.values[n]}locToIndex(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];let e=t[t.length-1];for(let n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e}indexToLoc(t){if(0===this.rank)return[];if(1===this.rank)return[t];const e=new Array(this.shape.length);for(let n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return gU().makeTensor(this.values,this.shape,this.dtype)}}let gU=null,bU=null;class wU{constructor(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=az(t),this.strides=_z(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return bU.buffer(this.shape,this.dtype,t)}bufferSync(){return bU.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return kz(this.shape,t,"complex64"===this.dtype)}arraySync(){return kz(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const t=gU().read(this.dataId);if("string"===this.dtype){const e=await t;try{return e.map((t=>iU(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),gU().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=gU().readSync(this.dataId);if("string"===this.dtype)try{return t.map((t=>iU(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await gU().read(this.dataId);return"string"===this.dtype?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(gU().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return bU.print(this,t)}clone(){return this.throwIfDisposed(),bU.clone(this)}toString(t=!1){return fU(this.dataSync(),this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),bU.cast(this,t)}variable(t=!0,e,n){return this.throwIfDisposed(),gU().makeVariable(this,t,e,n)}}Object.defineProperty(wU,Symbol.hasInstance,{value:t=>!!t&&null!=t.data&&null!=t.dataSync&&null!=t.throwIfDisposed}),fW("Tensor",(()=>wU));class vU extends wU{constructor(t,e,n,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=e,this.name=n}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!uz(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);gU().disposeTensor(this),this.dataId=t.dataId,gU().incRef(this,null)}dispose(){gU().disposeVariable(this),this.isDisposedInternal=!0}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var xU,NU,$U,EU,SU;Object.defineProperty(vU,Symbol.hasInstance,{value:t=>t instanceof wU&&null!=t.assign&&t.assign instanceof Function}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(xU||(xU={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(NU||(NU={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}($U||($U={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(EU||(EU={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(SU||(SU={}));const _U={float32:EU,int32:NU,bool:$U,complex64:SU};function TU(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return _U[t][e]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function kU(t,e){if(t.dtype===e.dtype)return[t,e];const n=TU(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function AU(t,e){rz(t.dtype===e.dtype,(()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`))}function CU(t){const e=[];return OU(t,e,new Set),e}function OU(t,e,n){if(null==t)return;if(t instanceof wU)return void e.push(t);if(r=t,!Array.isArray(r)&&"object"!=typeof r)return;var r;const s=t;for(const t in s){const r=s[t];n.has(r)||(n.add(r),OU(r,e,n))}}var IU=Object.freeze({__proto__:null,makeTypesMatch:kU,assertTypesMatch:AU,isTensorInList:function(t,e){return e.some((e=>e.id===t.id))},getTensorsInContainer:CU});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MU(t){return null!=t.kernelName}class RU{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((t=>t.name))))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class DU{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new RU}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;{const{asyncInit:e}=this.initializeBackend(t);if(e)return null}}return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,n=1){return t in this.registryFactory?(hW(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:n},!0)}async setBackend(t){if(null==this.registryFactory[t])throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,null==this.registry[t]){this.backendInstance=null;const{success:e,asyncInit:n}=this.initializeBackend(t);if(!(n?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new uU(this.backendInstance),!0}setupRegisteredKernels(){gW(this.backendName).forEach((t=>{null!=t.setupFunc&&t.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(t){gW(t).forEach((e=>{null!=e.disposeFunc&&e.disposeFunc(this.registry[t])}))}initializeBackend(t){const e=this.registryFactory[t];if(null==e)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const n=e.factory();if(!n||n instanceof ZV||"function"!=typeof n.then)return this.registry[t]=n,{success:!0,asyncInit:!1};{const e=++this.pendingBackendInitId,r=n.then((n=>!(e<this.pendingBackendInitId)&&(this.registry[t]=n,this.pendingBackendInit=null,!0))).catch((n=>(e<this.pendingBackendInitId||(this.pendingBackendInit=null,hW(`Initialization of backend ${t} failed`),hW(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(e){return hW(`Initialization of backend ${t} failed`),hW(e.stack||e.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority))}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e],{success:r,asyncInit:s}=this.initializeBackend(n);if(s||r)return{name:n,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const n=this.state.tensorInfo.get(e),r=n.backend,s=this.readSync(e),o=r.refCount(e);r.disposeData(e,!0),n.backend=t,t.move(e,s,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let n,r=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=e(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(t,e,n){t();try{const t=n();return e(),t}catch(t){throw e(),t}}nextTensorId(){return DU.nextTensorId++}nextVariableId(){return DU.nextVariableId++}clone(t){const e=LU.runKernel("Identity",{x:t}),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(t=>({x:()=>{const e={x:t},n={dtype:"float32"};return LU.runKernel("Cast",e,n)}})),[],{}),e}runKernel(t,e,n){null==this.backendName&&this.backend;if(!(null!=mW(t,this.backendName)))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,n){const r=this.backend.numDataIds();let s=0;n.forEach((t=>{s+="complex64"===t.dtype?3:1}));const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=r-e-s-o;if(i>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${i} data ids) after running '${t}'`)}runKernelFunc(t){let e,n=[];const r=this.isTapeOn(),s=this.state.numBytes,o=this.state.numTensors;let i,a;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const u=MU(t)?t.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(MU(t)){const{kernelName:e,inputs:s,attrs:o}=t;null==this.backendName&&this.backend;const u=mW(e,this.backendName);rz(null!=u,(()=>`Cannot find registered kernel '${e}' for backend '${this.backendName}'`)),i=()=>{const t=this.backend.numDataIds();a=u.kernelFunc({inputs:s,attrs:o,backend:this.backend});const i=Array.isArray(a)?a:[a];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(e,t,i);const c=i.map((t=>null!=t.rank?t:this.makeTensorFromTensorInfo(t)));if(r){const t=this.getTensorsForGradient(e,s,c);n=this.saveTensorsForBackwardMode(t)}return c}}else{const{forwardFunc:e}=t,s=t=>{r&&(n=t.map((t=>this.keep(this.clone(t)))))};i=()=>{const t=this.backend.numDataIds();a=this.tidy((()=>e(this.backend,s)));const n=Array.isArray(a)?a:[a];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,t,n),n}}const{inputs:c,attrs:l}=t,f=MU(t)?null:t.backwardsFunc;let h;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(h=this.profiler.profileKernel(u,c,(()=>i())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(h),e=h.outputs):e=i()})),r&&this.addTapeNode(u,c,e,f,n,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map((t=>null!=c[t]?c[t].shape:null)),outputShapes:e.map((t=>t.shape)),kernelTimeMs:h.timeMs,extraInfo:h.extraInfo}),Array.isArray(a)?e:e[0]}saveTensorsForBackwardMode(t){const e=t.map((t=>this.keep(this.clone(t))));return e}getTensorsForGradient(t,e,n){const r=yW(t);if(null!=r){const t=r.inputsToSave||[],s=r.outputsToSave||[];let o;r.saveAllInputs?(rz(Array.isArray(e),(()=>"saveAllInputs is true, expected inputs to be an array.")),o=Object.keys(e).map((t=>e[t]))):o=t.map((t=>e[t]));const i=n.filter(((t,e)=>s[e]));return o.concat(i)}return[]}makeTensor(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let s=t;"string"===n&&vz(t[0])&&(s=t.map((t=>oU(t))));const o=r.write(s,e,n),i=new wU(e,n,o,this.nextTensorId());if(this.trackTensor(i,r),"string"===n){const t=this.state.tensorInfo.get(o),e=wz(s);this.state.numBytes+=e-t.bytes,t.bytes=e}return i}makeTensorFromDataId(t,e,n,r){const s={dataId:t,shape:e,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(s,r)}makeTensorFromTensorInfo(t,e){const{dataId:n,shape:r,dtype:s}=t,o=new wU(r,s,n,this.nextTensorId());return this.trackTensor(o,e),o}makeVariable(t,e=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.cast(r));const s=new vU(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[s.name])throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(t,e){this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*bz(t.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n})),t instanceof vU||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,"string"===t.dtype&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),"complex64"!==t.dtype&&"string"!==t.dtype){const e=t.size*bz(t.dtype);this.state.numBytes-=e}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((t=>t.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const t of this.state.activeProfile.kernels)t.kernelTimeMs=await t.kernelTimeMs,t.extraInfo=await t.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(t,e,n,r,s,o){const i={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:s},a=yW(t);null!=a&&(r=a.gradFunc),null!=r&&(i.gradient=t=>(t=t.map(((t,e)=>{if(null==t){const t=n[e],r=Cz(t.size,t.dtype);return this.makeTensor(r,t.shape,t.dtype)}return t})),r(t.length>1?t:t[0],s,o))),this.state.activeTape.push(i)}keep(t){return t.kept=!0,t}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=CU(t),n=new Set(e.map((t=>t.id)));for(let t=0;t<this.state.activeScope.track.length;t++){const e=this.state.activeScope.track[t];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach((t=>{t.kept||t.scopeId!==r.id||this.track(t)}))}gradients(t,e,n,r=!1){if(rz(e.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const s=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",t)));rz(s instanceof wU,(()=>"The result y returned by f() must be a tensor."));const o=function(t,e,n){const r={},s={};for(let t=0;t<e.length;t++)r[e[t].id]=!0;for(let n=0;n<t.length;n++){const o=t[n],i=o.inputs;for(const t in i){const n=i[t];let a=!1;for(let t=0;t<e.length;t++)if(r[n.id]){o.outputs.forEach((t=>r[t.id]=!0)),a=!0,s[o.id]=!0;break}if(a)break}}const o={};o[n.id]=!0;const i={};for(let e=t.length-1;e>=0;e--){const n=t[e],r=n.inputs;for(let t=0;t<n.outputs.length;t++)if(o[n.outputs[t].id]){for(const t in r)o[r[t].id]=!0,i[n.id]=!0;break}}const a=[];for(let e=0;e<t.length;e++){const n=t[e];if(s[n.id]&&i[n.id]){const t={};for(const e in n.inputs){const s=n.inputs[e];r[s.id]&&(t[e]=s)}const e=Object.assign({},n);e.inputs=t,e.outputs=n.outputs,a.push(e)}}return a}(this.state.activeTape,e,s);if(!r&&0===o.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const t={};t[s.id]=null==n?function(t){const e=Az(az(t),"float32");return LU.makeTensor(e,t,"float32")}(s.shape):n,function(t,e,n,r){for(let s=e.length-1;s>=0;s--){const o=e[s],i=[];if(o.outputs.forEach((e=>{const n=t[e.id];null!=n?i.push(n):i.push(null)})),null==o.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const e in o.inputs){if(!(e in a))throw new Error(`Cannot backprop through input ${e}. Available gradients found: ${Object.keys(a)}.`);const s=n((()=>a[e]()));if("float32"!==s.dtype)throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${e} must have 'float32' dtype, but has '${s.dtype}'`);const i=o.inputs[e];if(!uz(s.shape,i.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${e}' has shape '${s.shape}', which does not match the shape of the input '${i.shape}'`);if(null==t[i.id])t[i.id]=s;else{const e=t[i.id];t[i.id]=r(e,s),e.dispose()}}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,o,(t=>this.tidy(t)),PU);const r=e.map((e=>t[e.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((t=>{for(const e of t.saved)e.dispose()})),this.state.activeTape=null),{value:s,grads:r}}))}customGrad(t){return rz(Ez(t),(()=>"The f passed in customGrad(f) must be a function.")),(...e)=>{let n;rz(e.every((t=>t instanceof wU)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};e.forEach(((t,e)=>{r[e]=t}));return this.runKernelFunc({forwardFunc:(r,s)=>(n=t(...e,s),rz(n.value instanceof wU,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),rz(Ez(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(t,r)=>{const s=n.gradFunc(t,r),o=Array.isArray(s)?s:[s];rz(o.length===e.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),rz(o.every((t=>t instanceof wU)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const i={};return o.forEach(((t,e)=>{i[e]=()=>t})),i},inputs:r})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)}async time(t){const e=sU(),n=await this.backend.time(t);return n.wallMs=sU()-e,n}track(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new RU;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function FU(){const t=lW();if(null==t._tfengine){const e=new Mz(t);t._tfengine=new DU(e)}var e;return e=t._tfengine.ENV,Fz=e,gU=()=>t._tfengine,t._tfengine}DU.nextTensorId=0,DU.nextVariableId=0;const LU=FU();function PU(t,e){const n={a:t,b:e};return LU.runKernel("Add",n)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let BU;function VU(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var zU=Object.freeze({__proto__:null,mockIsMobile:function(t){BU=t},isMobile:function(t){if(void 0!==BU)return BU;if(t||"undefined"!=typeof navigator&&null!=navigator){if(t||(t=navigator),"ReactNative"===t.product)return!0;const e=t.userAgent||t.vendor||("undefined"!=typeof window?window.opera:"");if(!e){const e=t;return e.userAgentData&&e.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1},isBrowser:VU});const WU=Dz();WU.registerFlag("DEBUG",(()=>!1),(t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),WU.registerFlag("IS_BROWSER",(()=>VU())),WU.registerFlag("IS_NODE",(()=>void 0!==uW&&void 0!==uW.versions&&void 0!==uW.versions.node)),WU.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),WU.registerFlag("PROD",(()=>!1)),WU.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>WU.getBool("DEBUG"))),WU.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),WU.registerFlag("IS_TEST",(()=>!1)),WU.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>!0)),WU.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),WU.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));var UU=[],jU=[],GU="undefined"!=typeof Uint8Array?Uint8Array:Array,qU=!1;function HU(){qU=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,n=t.length;e<n;++e)UU[e]=t[e],jU[t.charCodeAt(e)]=e;jU["-".charCodeAt(0)]=62,jU["_".charCodeAt(0)]=63}function KU(t,e,n){for(var r,s,o=[],i=e;i<n;i+=3)r=(t[i]<<16)+(t[i+1]<<8)+t[i+2],o.push(UU[(s=r)>>18&63]+UU[s>>12&63]+UU[s>>6&63]+UU[63&s]);return o.join("")}function XU(t){var e;qU||HU();for(var n=t.length,r=n%3,s="",o=[],i=16383,a=0,u=n-r;a<u;a+=i)o.push(KU(t,a,a+i>u?u:a+i));return 1===r?(e=t[n-1],s+=UU[e>>2],s+=UU[e<<4&63],s+="=="):2===r&&(e=(t[n-2]<<8)+t[n-1],s+=UU[e>>10],s+=UU[e>>4&63],s+=UU[e<<2&63],s+="="),o.push(s),o.join("")}function JU(t,e,n,r,s){var o,i,a=8*s-r-1,u=(1<<a)-1,c=u>>1,l=-7,f=n?s-1:0,h=n?-1:1,p=t[e+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+t[e+f],f+=h,l-=8);for(i=o&(1<<-l)-1,o>>=-l,l+=r;l>0;i=256*i+t[e+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return i?NaN:1/0*(p?-1:1);i+=Math.pow(2,r),o-=c}return(p?-1:1)*i*Math.pow(2,o-r)}function YU(t,e,n,r,s,o){var i,a,u,c=8*o-s-1,l=(1<<c)-1,f=l>>1,h=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,i=l):(i=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-i))<1&&(i--,u*=2),(e+=i+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(i++,u/=2),i+f>=l?(a=0,i=l):i+f>=1?(a=(e*u-1)*Math.pow(2,s),i+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,s),i=0));s>=8;t[n+p]=255&a,p+=d,a/=256,s-=8);for(i=i<<s|a,c+=s;c>0;t[n+p]=255&i,p+=d,i/=256,c-=8);t[n+p-d]|=128*m}var ZU={}.toString,QU=Array.isArray||function(t){return"[object Array]"==ZU.call(t)};function tj(){return nj.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function ej(t,e){if(tj()<e)throw new RangeError("Invalid typed array length");return nj.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=nj.prototype:(null===t&&(t=new nj(e)),t.length=e),t}function nj(t,e,n){if(!(nj.TYPED_ARRAY_SUPPORT||this instanceof nj))return new nj(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return oj(this,t)}return rj(this,t,e,n)}function rj(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);nj.TYPED_ARRAY_SUPPORT?(t=e).__proto__=nj.prototype:t=ij(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!nj.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|cj(e,n),s=(t=ej(t,r)).write(e,n);s!==r&&(t=t.slice(0,s));return t}(t,e,n):function(t,e){if(uj(e)){var n=0|aj(e.length);return 0===(t=ej(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?ej(t,0):ij(t,e);if("Buffer"===e.type&&QU(e.data))return ij(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function sj(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function oj(t,e){if(sj(e),t=ej(t,e<0?0:0|aj(e)),!nj.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function ij(t,e){var n=e.length<0?0:0|aj(e.length);t=ej(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function aj(t){if(t>=tj())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+tj().toString(16)+" bytes");return 0|t}function uj(t){return!(null==t||!t._isBuffer)}function cj(t,e){if(uj(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return Dj(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Fj(t).length;default:if(r)return Dj(t).length;e=(""+e).toLowerCase(),r=!0}}function lj(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return Ej(this,e,n);case"utf8":case"utf-8":return xj(this,e,n);case"ascii":return Nj(this,e,n);case"latin1":case"binary":return $j(this,e,n);case"base64":return vj(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Sj(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function fj(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function hj(t,e,n,r,s){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=s?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(s)return-1;n=t.length-1}else if(n<0){if(!s)return-1;n=0}if("string"==typeof e&&(e=nj.from(e,r)),uj(e))return 0===e.length?-1:pj(t,e,n,r,s);if("number"==typeof e)return e&=255,nj.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):pj(t,[e],n,r,s);throw new TypeError("val must be string, number or Buffer")}function pj(t,e,n,r,s){var o,i=1,a=t.length,u=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;i=2,a/=2,u/=2,n/=2}function c(t,e){return 1===i?t[e]:t.readUInt16BE(e*i)}if(s){var l=-1;for(o=n;o<a;o++)if(c(t,o)===c(e,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*i}else-1!==l&&(o-=o-l),l=-1}else for(n+u>a&&(n=a-u),o=n;o>=0;o--){for(var f=!0,h=0;h<u;h++)if(c(t,o+h)!==c(e,h)){f=!1;break}if(f)return o}return-1}function dj(t,e,n,r){n=Number(n)||0;var s=t.length-n;r?(r=Number(r))>s&&(r=s):r=s;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var i=0;i<r;++i){var a=parseInt(e.substr(2*i,2),16);if(isNaN(a))return i;t[n+i]=a}return i}function mj(t,e,n,r){return Lj(Dj(e,t.length-n),t,n,r)}function yj(t,e,n,r){return Lj(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function gj(t,e,n,r){return yj(t,e,n,r)}function bj(t,e,n,r){return Lj(Fj(e),t,n,r)}function wj(t,e,n,r){return Lj(function(t,e){for(var n,r,s,o=[],i=0;i<t.length&&!((e-=2)<0);++i)r=(n=t.charCodeAt(i))>>8,s=n%256,o.push(s),o.push(r);return o}(e,t.length-n),t,n,r)}function vj(t,e,n){return 0===e&&n===t.length?XU(t):XU(t.slice(e,n))}function xj(t,e,n){n=Math.min(t.length,n);for(var r=[],s=e;s<n;){var o,i,a,u,c=t[s],l=null,f=c>239?4:c>223?3:c>191?2:1;if(s+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=t[s+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=t[s+1],i=t[s+2],128==(192&o)&&128==(192&i)&&(u=(15&c)<<12|(63&o)<<6|63&i)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=t[s+1],i=t[s+2],a=t[s+3],128==(192&o)&&128==(192&i)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&i)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),s+=f}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=4096));return n}(r)}nj.TYPED_ARRAY_SUPPORT=void 0===Lz.TYPED_ARRAY_SUPPORT||Lz.TYPED_ARRAY_SUPPORT,tj(),nj.poolSize=8192,nj._augment=function(t){return t.__proto__=nj.prototype,t},nj.from=function(t,e,n){return rj(null,t,e,n)},nj.TYPED_ARRAY_SUPPORT&&(nj.prototype.__proto__=Uint8Array.prototype,nj.__proto__=Uint8Array),nj.alloc=function(t,e,n){return function(t,e,n,r){return sj(e),e<=0?ej(t,e):void 0!==n?"string"==typeof r?ej(t,e).fill(n,r):ej(t,e).fill(n):ej(t,e)}(null,t,e,n)},nj.allocUnsafe=function(t){return oj(null,t)},nj.allocUnsafeSlow=function(t){return oj(null,t)},nj.isBuffer=function(t){return null!=t&&(!!t._isBuffer||Pj(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&Pj(t.slice(0,0))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t))},nj.compare=function(t,e){if(!uj(t)||!uj(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,s=0,o=Math.min(n,r);s<o;++s)if(t[s]!==e[s]){n=t[s],r=e[s];break}return n<r?-1:r<n?1:0},nj.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},nj.concat=function(t,e){if(!QU(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return nj.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=nj.allocUnsafe(e),s=0;for(n=0;n<t.length;++n){var o=t[n];if(!uj(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,s),s+=o.length}return r},nj.byteLength=cj,nj.prototype._isBuffer=!0,nj.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)fj(this,e,e+1);return this},nj.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)fj(this,e,e+3),fj(this,e+1,e+2);return this},nj.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)fj(this,e,e+7),fj(this,e+1,e+6),fj(this,e+2,e+5),fj(this,e+3,e+4);return this},nj.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?xj(this,0,t):lj.apply(this,arguments)},nj.prototype.equals=function(t){if(!uj(t))throw new TypeError("Argument must be a Buffer");return this===t||0===nj.compare(this,t)},nj.prototype.inspect=function(){var t="";return this.length>0&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(t+=" ... ")),"<Buffer "+t+">"},nj.prototype.compare=function(t,e,n,r,s){if(!uj(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===s&&(s=this.length),e<0||n>t.length||r<0||s>this.length)throw new RangeError("out of range index");if(r>=s&&e>=n)return 0;if(r>=s)return-1;if(e>=n)return 1;if(this===t)return 0;for(var o=(s>>>=0)-(r>>>=0),i=(n>>>=0)-(e>>>=0),a=Math.min(o,i),u=this.slice(r,s),c=t.slice(e,n),l=0;l<a;++l)if(u[l]!==c[l]){o=u[l],i=c[l];break}return o<i?-1:i<o?1:0},nj.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},nj.prototype.indexOf=function(t,e,n){return hj(this,t,e,n,!0)},nj.prototype.lastIndexOf=function(t,e,n){return hj(this,t,e,n,!1)},nj.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var s=this.length-e;if((void 0===n||n>s)&&(n=s),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return dj(this,t,e,n);case"utf8":case"utf-8":return mj(this,t,e,n);case"ascii":return yj(this,t,e,n);case"latin1":case"binary":return gj(this,t,e,n);case"base64":return bj(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return wj(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},nj.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Nj(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(127&t[s]);return r}function $j(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(t[s]);return r}function Ej(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var s="",o=e;o<n;++o)s+=Rj(t[o]);return s}function Sj(t,e,n){for(var r=t.slice(e,n),s="",o=0;o<r.length;o+=2)s+=String.fromCharCode(r[o]+256*r[o+1]);return s}function _j(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function Tj(t,e,n,r,s,o){if(!uj(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function kj(t,e,n,r){e<0&&(e=65535+e+1);for(var s=0,o=Math.min(t.length-n,2);s<o;++s)t[n+s]=(e&255<<8*(r?s:1-s))>>>8*(r?s:1-s)}function Aj(t,e,n,r){e<0&&(e=4294967295+e+1);for(var s=0,o=Math.min(t.length-n,4);s<o;++s)t[n+s]=e>>>8*(r?s:3-s)&255}function Cj(t,e,n,r,s,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function Oj(t,e,n,r,s){return s||Cj(t,0,n,4),YU(t,e,n,r,23,4),n+4}function Ij(t,e,n,r,s){return s||Cj(t,0,n,8),YU(t,e,n,r,52,8),n+8}nj.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),nj.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=nj.prototype;else{var s=e-t;n=new nj(s,void 0);for(var o=0;o<s;++o)n[o]=this[o+t]}return n},nj.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||_j(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r},nj.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||_j(t,e,this.length);for(var r=this[t+--e],s=1;e>0&&(s*=256);)r+=this[t+--e]*s;return r},nj.prototype.readUInt8=function(t,e){return e||_j(t,1,this.length),this[t]},nj.prototype.readUInt16LE=function(t,e){return e||_j(t,2,this.length),this[t]|this[t+1]<<8},nj.prototype.readUInt16BE=function(t,e){return e||_j(t,2,this.length),this[t]<<8|this[t+1]},nj.prototype.readUInt32LE=function(t,e){return e||_j(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},nj.prototype.readUInt32BE=function(t,e){return e||_j(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},nj.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||_j(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r>=(s*=128)&&(r-=Math.pow(2,8*e)),r},nj.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||_j(t,e,this.length);for(var r=e,s=1,o=this[t+--r];r>0&&(s*=256);)o+=this[t+--r]*s;return o>=(s*=128)&&(o-=Math.pow(2,8*e)),o},nj.prototype.readInt8=function(t,e){return e||_j(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},nj.prototype.readInt16LE=function(t,e){e||_j(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},nj.prototype.readInt16BE=function(t,e){e||_j(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},nj.prototype.readInt32LE=function(t,e){return e||_j(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},nj.prototype.readInt32BE=function(t,e){return e||_j(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},nj.prototype.readFloatLE=function(t,e){return e||_j(t,4,this.length),JU(this,t,!0,23,4)},nj.prototype.readFloatBE=function(t,e){return e||_j(t,4,this.length),JU(this,t,!1,23,4)},nj.prototype.readDoubleLE=function(t,e){return e||_j(t,8,this.length),JU(this,t,!0,52,8)},nj.prototype.readDoubleBE=function(t,e){return e||_j(t,8,this.length),JU(this,t,!1,52,8)},nj.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||Tj(this,t,e,n,Math.pow(2,8*n)-1,0);var s=1,o=0;for(this[e]=255&t;++o<n&&(s*=256);)this[e+o]=t/s&255;return e+n},nj.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||Tj(this,t,e,n,Math.pow(2,8*n)-1,0);var s=n-1,o=1;for(this[e+s]=255&t;--s>=0&&(o*=256);)this[e+s]=t/o&255;return e+n},nj.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||Tj(this,t,e,1,255,0),nj.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},nj.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||Tj(this,t,e,2,65535,0),nj.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):kj(this,t,e,!0),e+2},nj.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||Tj(this,t,e,2,65535,0),nj.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):kj(this,t,e,!1),e+2},nj.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||Tj(this,t,e,4,4294967295,0),nj.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):Aj(this,t,e,!0),e+4},nj.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||Tj(this,t,e,4,4294967295,0),nj.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Aj(this,t,e,!1),e+4},nj.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);Tj(this,t,e,n,s-1,-s)}var o=0,i=1,a=0;for(this[e]=255&t;++o<n&&(i*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},nj.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);Tj(this,t,e,n,s-1,-s)}var o=n-1,i=1,a=0;for(this[e+o]=255&t;--o>=0&&(i*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},nj.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||Tj(this,t,e,1,127,-128),nj.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},nj.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||Tj(this,t,e,2,32767,-32768),nj.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):kj(this,t,e,!0),e+2},nj.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||Tj(this,t,e,2,32767,-32768),nj.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):kj(this,t,e,!1),e+2},nj.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||Tj(this,t,e,4,2147483647,-2147483648),nj.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):Aj(this,t,e,!0),e+4},nj.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||Tj(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),nj.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Aj(this,t,e,!1),e+4},nj.prototype.writeFloatLE=function(t,e,n){return Oj(this,t,e,!0,n)},nj.prototype.writeFloatBE=function(t,e,n){return Oj(this,t,e,!1,n)},nj.prototype.writeDoubleLE=function(t,e,n){return Ij(this,t,e,!0,n)},nj.prototype.writeDoubleBE=function(t,e,n){return Ij(this,t,e,!1,n)},nj.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var s,o=r-n;if(this===t&&n<e&&e<r)for(s=o-1;s>=0;--s)t[s+e]=this[s+n];else if(o<1e3||!nj.TYPED_ARRAY_SUPPORT)for(s=0;s<o;++s)t[s+e]=this[s+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},nj.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var s=t.charCodeAt(0);s<256&&(t=s)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!nj.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var i=uj(t)?t:Dj(new nj(t,r).toString()),a=i.length;for(o=0;o<n-e;++o)this[o+e]=i[o%a]}return this};var Mj=/[^+\/0-9A-Za-z-_]/g;function Rj(t){return t<16?"0"+t.toString(16):t.toString(16)}function Dj(t,e){var n;e=e||1/0;for(var r=t.length,s=null,o=[],i=0;i<r;++i){if((n=t.charCodeAt(i))>55295&&n<57344){if(!s){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(i+1===r){(e-=3)>-1&&o.push(239,191,189);continue}s=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),s=n;continue}n=65536+(s-55296<<10|n-56320)}else s&&(e-=3)>-1&&o.push(239,191,189);if(s=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function Fj(t){return function(t){var e,n,r,s,o,i;qU||HU();var a=t.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===t[a-2]?2:"="===t[a-1]?1:0,i=new GU(3*a/4-o),r=o>0?a-4:a;var u=0;for(e=0,n=0;e<r;e+=4,n+=3)s=jU[t.charCodeAt(e)]<<18|jU[t.charCodeAt(e+1)]<<12|jU[t.charCodeAt(e+2)]<<6|jU[t.charCodeAt(e+3)],i[u++]=s>>16&255,i[u++]=s>>8&255,i[u++]=255&s;return 2===o?(s=jU[t.charCodeAt(e)]<<2|jU[t.charCodeAt(e+1)]>>4,i[u++]=255&s):1===o&&(s=jU[t.charCodeAt(e)]<<10|jU[t.charCodeAt(e+1)]<<4|jU[t.charCodeAt(e+2)]>>2,i[u++]=s>>8&255,i[u++]=255&s),i}(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(Mj,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function Lj(t,e,n,r){for(var s=0;s<r&&!(s+n>=e.length||s>=t.length);++s)e[s+n]=t[s];return s}function Pj(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function Bj(t,e){let n=t;if(gz(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||gz(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&Dz().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Vj(t,r,[]),r}function Vj(t,e,n){if(n=n||[],!Array.isArray(t)&&!gz(t))return void rz(0===e.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`));rz(e.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`)),rz(t.length===e[0],(()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`));const r=e.slice(1);for(let e=0;e<t.length;++e)Vj(t[e],r,n.concat(e))}function zj(t,e,n,r){if("string_or_numeric"!==t){if(null==t)throw new Error("Expected dtype cannot be null.");if("numeric"!==t&&t!==e||"numeric"===t&&"string"===e)throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}}function Wj(t,e,n,r="numeric"){if(t instanceof wU)return zj(r,t.dtype,e,n),t;let s=$z(t);if("string"!==s&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),zj(r,s,e,n),null==t||!gz(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){const r=null==t?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const o=Bj(t,s);gz(t)||Array.isArray(t)||(t=[t]);const i="string"!==s?rU(t,s):iz(t,[],!0);return LU.makeTensor(i,o,s)}function Uj(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map(((t,s)=>Wj(t,`${e}[${s}]`,n,r)))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jj(t){const e=Object.keys(t);if(1!==e.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const s=(...t)=>{LU.startScope(n);try{const e=r(...t);return Iz(e)&&console.error("Cannot return a Promise inside of tidy."),LU.endScope(e),e}catch(t){throw LU.endScope(null),t}};return Object.defineProperty(s,"name",{value:n,configurable:!0}),s}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gj=jj({complex_:function(t,e){const n=Wj(t,"real","complex"),r=Wj(e,"imag","complex");sz(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const s={real:n,imag:r};return LU.runKernel("Complex",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qj(t,e,n,r){if(null==r&&(r=$z(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!gz(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){Oz(e);const t=az(e),r=az(n);rz(t===r,(()=>`Based on the provided shape, [${e}], the tensor should have ${t} values but has ${r}`));for(let t=0;t<n.length;++t){const r=n[t],s=t!==n.length-1||r!==az(e.slice(t));rz(n[t]===e[t]||!s,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `))}}return gz(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?rU(t,r):iz(t,[],!0),LU.makeTensor(t,e,r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hj(t,e,n){return qj(t,e,Bj(t,n),n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kj={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};function Xj(t,e){const n={};let r,s=0;for(const o of e){const e=o.name,i=o.dtype,a=o.shape,u=az(a);let c;if("quantization"in o){const n=o.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error(`Weight ${o.name} with quantization ${n.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==n.dtype)throw new Error(`Weight ${o.name} has unknown quantization dtype ${n.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==i)throw new Error(`Weight ${o.name} is quantized with ${n.dtype} which only supports weights of type float32 not ${i}.`)}const a=Kj[n.dtype],l=t.slice(s,s+u*a),f="uint8"===n.dtype?new Uint8Array(l):new Uint16Array(l);if("float32"===i)if("uint8"===n.dtype||"uint16"===n.dtype){c=new Float32Array(f.length);for(let t=0;t<f.length;t++){const e=f[t];c[t]=e*n.scale+n.min}}else{if("float16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type float32.`);void 0===r&&(r=sG()),c=r(f)}else{if("int32"!==i)throw new Error(`Unsupported dtype in weight '${e}': ${i}`);if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type int32.`);c=new Int32Array(f.length);for(let t=0;t<f.length;t++){const e=f[t];c[t]=Math.round(e*n.scale+n.min)}}s+=u*a}else if("string"===i){const e=az(o.shape);c=[];for(let n=0;n<e;n++){const e=new Uint32Array(t.slice(s,s+4))[0];s+=4;const n=new Uint8Array(t.slice(s,s+e));c.push(n),s+=e}}else{const r=Kj[i],o=t.slice(s,s+u*r);if("float32"===i)c=new Float32Array(o);else if("int32"===i)c=new Int32Array(o);else if("bool"===i)c=new Uint8Array(o);else{if("complex64"!==i)throw new Error(`Unsupported dtype in weight '${e}': ${i}`);{c=new Float32Array(o);const t=new Float32Array(c.length/2),r=new Float32Array(c.length/2);for(let e=0;e<t.length;e++)t[e]=c[2*e],r[e]=c[2*e+1];const s=Hj(t,a,"float32"),i=Hj(r,a,"float32");n[e]=Gj(s,i),s.dispose(),i.dispose()}}s+=u*r}"complex64"!==i&&(n[e]=Hj(c,a,i))}return n}function Jj(t){if(null===t)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach((t=>{if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${t.constructor.name}`)}));const r=new Uint8Array(e);let s=0;return n.forEach((t=>{r.set(new Uint8Array(t.buffer),s),s+=t.byteLength})),r.buffer}const Yj="undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa;function Zj(t){return Yj?nj.byteLength(t):new Blob([t]).size}function Qj(t){if(1===t.length)return t[0];let e=0;t.forEach((t=>{e+=t.byteLength}));const n=new Uint8Array(e);let r=0;return t.forEach((t=>{n.set(new Uint8Array(t),r),r+=t.byteLength})),n.buffer}function tG(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);const e=t.split("/");return e[e.length-1]}function eG(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),n}async function nG(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),null!=t.weightsManifest){const[r,s]=await e(t.weightsManifest);n.weightSpecs=r,n.weightData=s}return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),n}function rG(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:Zj(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:Zj(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}function sG(){const t=function(){const t=t=>{let e=t<<13,n=0;for(;0==(8388608&e);)n-=8388608,e<<=1;return e&=-8388609,n+=947912704,e|n},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}(),e=function(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}(),n=function(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}();return r=>{const s=new ArrayBuffer(4*r.length),o=new Uint32Array(s);for(let s=0;s<r.length;s++){const i=r[s],a=t[n[i>>10]+(1023&i)]+e[i>>10];o[s]=a}return new Float32Array(s)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oG{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==oG.instance&&(oG.instance=new oG),oG.instance}static registerSaveRouter(t){oG.getInstance().saveRouters.push(t)}static registerLoadRouter(t){oG.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return oG.getHandlers(t,"save")}static getLoadHandlers(t,e){return oG.getHandlers(t,"load",e)}static getHandlers(t,e,n){const r=[];return("load"===e?oG.getInstance().loadRouters:oG.getInstance().saveRouters).forEach((e=>{const s=e(t,n);null!==s&&r.push(s)})),r}}const iG=t=>oG.getSaveHandlers(t),aG=(t,e)=>oG.getLoadHandlers(t,e)
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */;function uG(){if(!Dz().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t="undefined"==typeof window?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function cG(t){const e=t.result;e.createObjectStore("models_store",{keyPath:"modelPath"}),e.createObjectStore("model_info_store",{keyPath:"modelPath"})}class lG{constructor(t){if(this.indexedDB=uG(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise(((t,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>cG(r),r.onsuccess=()=>{const s=r.result;if(null==e){const e=s.transaction("models_store","readonly"),r=e.objectStore("models_store").get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return s.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));t(r.result.modelArtifacts)},r.onerror=t=>(s.close(),n(r.error)),e.oncomplete=()=>s.close()}else{const r=rG(e),o=s.transaction("model_info_store","readwrite");let i=o.objectStore("model_info_store");const a=i.put({modelPath:this.modelPath,modelArtifactsInfo:r});let u;a.onsuccess=()=>{u=s.transaction("models_store","readwrite");const a=u.objectStore("models_store").put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:r});a.onsuccess=()=>t({modelArtifactsInfo:r}),a.onerror=t=>{i=o.objectStore("model_info_store");const e=i.delete(this.modelPath);e.onsuccess=()=>(s.close(),n(a.error)),e.onerror=t=>(s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}}},r.onerror=t=>n(r.error)}))}}lG.URL_SCHEME="indexeddb://";const fG=t=>{return Dz().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(lG.URL_SCHEME)?(e=t.slice(lG.URL_SCHEME.length),new lG(e)):null;var e};oG.registerSaveRouter(fG),oG.registerLoadRouter(fG);class hG{constructor(){this.indexedDB=uG()}async listModels(){return new Promise(((t,e)=>{const n=this.indexedDB.open("tensorflowjs",1);n.onupgradeneeded=()=>cG(n),n.onsuccess=()=>{const r=n.result,s=r.transaction("model_info_store","readonly"),o=s.objectStore("model_info_store").getAll();o.onsuccess=()=>{const e={};for(const t of o.result)e[t.modelPath]=t.modelArtifactsInfo;t(e)},o.onerror=t=>(r.close(),e(o.error)),s.oncomplete=()=>r.close()},n.onerror=t=>e(n.error)}))}async removeModel(t){var e;return t=(e=t).startsWith(lG.URL_SCHEME)?e.slice(lG.URL_SCHEME.length):e,new Promise(((e,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>cG(r),r.onsuccess=()=>{const s=r.result,o=s.transaction("model_info_store","readwrite"),i=o.objectStore("model_info_store"),a=i.get(t);let u;a.onsuccess=()=>{if(null==a.result)return s.close(),n(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const r=i.delete(t),o=()=>{u=s.transaction("models_store","readwrite");const r=u.objectStore("models_store").delete(t);r.onsuccess=()=>e(a.result.modelArtifactsInfo),r.onerror=t=>n(a.error)};r.onsuccess=o,r.onerror=t=>(o(),s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}},r.onerror=t=>n(r.error)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pG="tensorflowjs_models",dG="info",mG="model_topology",yG="weight_specs",gG="weight_data",bG="model_metadata";function wG(t){return{info:[pG,t,dG].join("/"),topology:[pG,t,mG].join("/"),weightSpecs:[pG,t,yG].join("/"),weightData:[pG,t,gG].join("/"),modelMetadata:[pG,t,bG].join("/")}}function vG(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function xG(t){const e=t.split("/");if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join("/")}class NG{constructor(t){if(!Dz().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=wG(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=rG(t);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(Yj)return nj.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let t=0,r=e.length;t<r;t++)n+=String.fromCharCode(e[t]);return btoa(n)}(t.weightData));const s={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:r}}catch(t){throw vG(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(null==t)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=r;const s=this.LS.getItem(this.keys.modelMetadata);if(null!=s){const t=JSON.parse(s);e.format=t.format,e.generatedBy=t.generatedBy,e.convertedBy=t.convertedBy,null!=t.signature&&(e.signature=t.signature),null!=t.userDefinedMetadata&&(e.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(e.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(e.trainingConfig=t.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(null==o)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=function(t){if(Yj){const e=nj.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;++t)n.set([e.charCodeAt(t)],t);return n.buffer}(o),e}}NG.URL_SCHEME="localstorage://";const $G=t=>{return Dz().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(NG.URL_SCHEME)?(e=t.slice(NG.URL_SCHEME.length),new NG(e)):null;var e};oG.registerSaveRouter($G),oG.registerLoadRouter($G);class EG{constructor(){rz(Dz().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),rz("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const t={},e=pG+"/",n="/"+dG;for(let r=0;r<this.LS.length;++r){const s=this.LS.key(r);if(s.startsWith(e)&&s.endsWith(n)){t[xG(s)]=JSON.parse(this.LS.getItem(s))}}return t}async removeModel(t){var e;const n=wG(t=(e=t).startsWith(NG.URL_SCHEME)?e.slice(NG.URL_SCHEME.length):e);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(n.info));return vG(n),r}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SG{constructor(){this.managers={}}static getInstance(){return null==SG.instance&&(SG.instance=new SG),SG.instance}static registerManager(t,e){rz(null!=t,(()=>"scheme must not be undefined or null.")),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),rz(t.length>0,(()=>"scheme must not be an empty string."));const n=SG.getInstance();rz(null==n.managers[t],(()=>`A model store manager is already registered for scheme '${t}'.`)),n.managers[t]=e}static getManager(t){const e=this.getInstance().managers[t];if(null==e)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}}function _G(t){if(-1===t.indexOf("://"))throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${SG.getSchemes().join(",")}`);return{scheme:t.split("://")[0],path:t.split("://")[1]}}async function TG(t,e,n=!1){rz(t!==e,(()=>`Old path and new path are the same: '${t}'`));const r=oG.getLoadHandlers(t);rz(r.length>0,(()=>`Copying failed because no load handler is found for source URL ${t}.`)),rz(r.length<2,(()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${t}.`));const s=r[0],o=oG.getSaveHandlers(e);rz(o.length>0,(()=>`Copying failed because no save handler is found for destination URL ${e}.`)),rz(o.length<2,(()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${e}.`));const i=o[0],a=_G(t).scheme,u=_G(t).path,c=a===_G(t).scheme,l=await s.load();n&&c&&await SG.getManager(a).removeModel(u);const f=await i.save(l);return n&&!c&&await SG.getManager(a).removeModel(u),f.modelArtifactsInfo}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class kG{fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}}if(Dz().get("IS_BROWSER")){Dz().setPlatform("browser",new kG);try{SG.registerManager(NG.URL_SCHEME,new EG)}catch(t){}try{SG.registerManager(lG.URL_SCHEME,new hG)}catch(t){}}const AG=()=>require("node-fetch");let CG;class OG{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return null!=Dz().global.fetch?Dz().global.fetch(t,e):(null==CG&&(CG=AG()),CG(t,e))}now(){const t=uW.hrtime();return 1e3*t[0]+t[1]/1e6}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)}}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function IG(t,e="float32",n){return e=e||"float32",Oz(t),new yU(t,e,n)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Dz().get("IS_NODE")&&!Dz().get("IS_BROWSER")&&Dz().setPlatform("node",new OG);const MG=jj({cast_:function(t,e){const n=Wj(t,"x","cast");if(!yz(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},s={dtype:e};return LU.runKernel("Cast",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RG=jj({clone_:function(t){const e={x:Wj(t,"x","clone","string_or_numeric")};return LU.runKernel("Identity",e)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DG(t,e=!1){console.log(t.toString(e))}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */FU();!function(t){bU=t}({buffer:IG,cast:MG,clone:RG,print:DG});function FG(t){return new Promise((t=>setTimeout(t))).then(t)}class LG{constructor(t){if(!Dz().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(LG.URL_SCHEME)&&(t=t.slice(LG.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}async save(t){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n=eG(t,[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]),r=window.URL.createObjectURL(new Blob([JSON.stringify(n)],{type:"application/json"})),s=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(s.download=this.modelJsonFileName,s.href=r,await FG((()=>s.dispatchEvent(new MouseEvent("click")))),null!=t.weightData){const t=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;t.download=this.weightDataFileName,t.href=e,await FG((()=>t.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:rG(t)}}}}LG.URL_SCHEME="downloads://";class PG{constructor(t){if(null==t||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.jsonFile=t[0],this.weightsFiles=t.slice(1)}async load(){return new Promise(((t,e)=>{const n=new FileReader;n.onload=n=>{const r=JSON.parse(n.target.result),s=r.modelTopology;if(null==s)return void e(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));if(null==r.weightsManifest)return void e(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));if(0===this.weightsFiles.length)return void t({modelTopology:s});const o=nG(r,(t=>this.loadWeights(t)));t(o)},n.onerror=t=>e(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),n.readAsText(this.jsonFile)}))}loadWeights(t){const e=[],n=[];for(const r of t)e.push(...r.weights),n.push(...r.paths);const r=this.checkManifestAndWeightFiles(t),s=n.map((t=>this.loadWeightsFile(t,r[t])));return Promise.all(s).then((t=>[e,Qj(t)]))}loadWeightsFile(t,e){return new Promise(((n,r)=>{const s=new FileReader;s.onload=t=>{const e=t.target.result;n(e)},s.onerror=e=>r(`Failed to weights data from file of path '${t}'.`),s.readAsArrayBuffer(e)}))}checkManifestAndWeightFiles(t){const e=[],n=this.weightsFiles.map((t=>tG(t.name))),r={};for(const s of t)s.paths.forEach((t=>{const s=tG(t);if(-1!==e.indexOf(s))throw new Error(`Duplicate file basename found in weights manifest: '${s}'`);if(e.push(s),-1===n.indexOf(s))throw new Error(`Weight file with basename '${s}' is not provided.`);r[t]=this.weightsFiles[n.indexOf(s)]}));if(e.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${e.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function BG(t,e,n,r){!function(t){rz(null!=t&&Array.isArray(t)&&t.length>0,(()=>"promises must be a none empty array"))}(t),function(t,e){rz(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${t}`)),rz(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${e}`)),rz(e>=t,(()=>`startFraction must be no more than endFraction, but got startFraction ${t} and endFraction ${e}`))}(n=null==n?0:n,r=null==r?1:r);let s=0;return Promise.all(t.map((o=>(o.then((o=>{const i=n+ ++s/t.length*(r-n);return e(i),o})),o))))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function VG(t,e){null==e&&(e={});const n=null==e.fetchFunc?Dz().platform.fetch:e.fetchFunc,r=t.map((t=>n(t,e.requestInit,{isBinary:!0}))),s=(null==e.onProgress?await Promise.all(r):await BG(r,e.onProgress,0,.5)).map((t=>t.arrayBuffer()));return null==e.onProgress?await Promise.all(s):await BG(s,e.onProgress,.5,1)}function zG(t){return async(e,n="",r)=>{const s=e.map((()=>!1)),o={},i=null!=r?r.map((()=>!1)):[],a=[];if(e.forEach(((t,e)=>{let n=0;t.weights.forEach((t=>{const u="quantization"in t?t.quantization.dtype:t.dtype,c=Kj[u]*az(t.shape),l=()=>{s[e]=!0,null==o[e]&&(o[e]=[]),o[e].push({manifestEntry:t,groupOffset:n,sizeBytes:c})};null!=r?r.forEach(((e,n)=>{e===t.name&&(l(),i[n]=!0)})):l(),a.push(t.name),n+=c}))})),!i.every((t=>t))){const t=r.filter(((t,e)=>!i[e]));throw new Error(`Could not find weights in manifest with names: ${t.join(", ")}. \nManifest JSON has weights with names: ${a.join(", ")}.`)}const u=s.reduce(((t,e,n)=>(e&&t.push(n),t)),[]),c=[];u.forEach((t=>{e[t].paths.forEach((t=>{const e=n+(n.endsWith("/")?"":"/")+t;c.push(e)}))}));const l=await t(c),f={};let h=0;return u.forEach((t=>{const n=e[t].paths.length;let r=0;for(let t=0;t<n;t++)r+=l[h+t].byteLength;const s=new ArrayBuffer(r),i=new Uint8Array(s);let a=0;for(let t=0;t<n;t++){const e=new Uint8Array(l[h+t]);i.set(e,a),a+=e.byteLength}o[t].forEach((t=>{const e=Xj(s.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(const t in e)f[t]=e[t]})),h+=n})),f}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oG.registerSaveRouter((t=>Dz().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(LG.URL_SCHEME)?function(t="model"){return new LG(t)}(t.slice(LG.URL_SCHEME.length)):null));class WG{constructor(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,this.weightUrlConverter=e.weightUrlConverter,null!=e.fetchFunc?(rz("function"==typeof e.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=e.fetchFunc):this.fetch=Dz().platform.fetch,rz(null!=t&&t.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(t)&&rz(2===t.length,(()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`)),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData;const n=eG(t,[{paths:["./model.weights.bin"],weights:t.weightSpecs}]);e.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin");const r=await this.fetch(this.path,e);if(r.ok)return{modelArtifactsInfo:rG(t),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let e;try{e=await t.json()}catch(t){let e=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=e.modelTopology,r=e.weightsManifest;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return nG(e,(t=>this.loadWeights(t)))}async loadWeights(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),r=t.substring(0,e),s=n>e?t.substring(n):"";return[r+"/",s]}(e),s=this.weightPathPrefix||n,o=[];for(const e of t)o.push(...e.weights);const i=[],a=[];for(const e of t)for(const t of e.paths)null!=this.weightUrlConverter?a.push(this.weightUrlConverter(t)):i.push(s+t+r);this.weightUrlConverter&&i.push(...await Promise.all(a));return[o,Qj(await VG(i,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress}))]}}function UG(t){return null!=t.match(WG.URL_SCHEME_REGEX)}WG.URL_SCHEME_REGEX=/^https?:\/\//;const jG=(t,e)=>{if("undefined"==typeof fetch&&(null==e||null==e.fetchFunc))return null;{let n=!0;if(n=Array.isArray(t)?t.every((t=>UG(t))):UG(t),n)return GG(t,e)}return null};function GG(t,e){return new WG(t,e)}function qG(t,e){return GG(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oG.registerSaveRouter(jG),oG.registerLoadRouter(jG);class HG{constructor(t){this.modelArtifacts=t}load(){return this.modelArtifacts}}class KG{constructor(t){this.saveHandler=t}save(t){return this.saveHandler(t)}}class XG{constructor(t){t.load&&(this.load=()=>Promise.resolve(t.load())),t.save&&(this.save=e=>Promise.resolve(t.save(e)))}}function JG(t,e,n,r){if(1===arguments.length){return null!=t.modelTopology||null!=t.weightSpecs?new HG(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new HG({modelTopology:t}))}return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new HG({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r})}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var YG=Object.freeze({__proto__:null,browserFiles:function(t){return new PG(t)},browserHTTPRequest:qG,concatenateArrayBuffers:Qj,decodeWeights:Xj,encodeWeights:async function(t,e){const n=[],r=[],s=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);for(let o=0;o<s.length;++o){const i=s[o],a=Array.isArray(t)?t[o].tensor:t[i];if("float32"!==a.dtype&&"int32"!==a.dtype&&"bool"!==a.dtype&&"string"!==a.dtype&&"complex64"!==a.dtype)throw new Error(`Unsupported dtype in weight '${i}': ${a.dtype}`);const u={name:i,shape:a.shape,dtype:a.dtype};if("string"===a.dtype){const t=new Promise((async t=>{const e=await a.bytes(),n=e.reduce(((t,e)=>t+e.length),0)+4*e.length,r=new Uint8Array(n);let s=0;for(let t=0;t<e.length;t++){const n=e[t],o=new Uint8Array(new Uint32Array([n.length]).buffer);r.set(o,s),s+=4,r.set(n,s),s+=n.length}t(r)}));r.push(t)}else r.push(a.data());null!=e&&(u.group=e),n.push(u)}return{data:Jj(await Promise.all(r)),specs:n}},fromMemory:function(t,e,n,r){const s=arguments;return new XG(JG(...s))},fromMemorySync:JG,getLoadHandlers:aG,getModelArtifactsForJSON:nG,getModelArtifactsInfoForJSON:rG,getSaveHandlers:iG,http:GG,isHTTPScheme:UG,loadWeights:async function(t,e="",n,r){return zG((t=>VG(t,{requestInit:r})))(t,e,n)},registerLoadRouter:t=>oG.registerLoadRouter(t),registerSaveRouter:t=>oG.registerSaveRouter(t),weightsLoaderFactory:zG,withSaveHandler:function(t){return new KG(t)},withSaveHandlerSync:function(t){return new KG(t)},copyModel:async function(t,e){return TG(t,e,!1)},listModels:async function(){const t=SG.getSchemes(),e={};for(const n of t){const t=await SG.getManager(n).listModels();for(const r in t){e[n+"://"+r]=t[r]}}return e},moveModel:async function(t,e){return TG(t,e,!0)},removeModel:async function(t){const e=_G(t);return SG.getManager(e.scheme).removeModel(e.path)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZG=jj({matMul_:function(t,e,n=!1,r=!1){let s=Wj(t,"a","matMul"),o=Wj(e,"b","matMul");[s,o]=kU(s,o);const i={a:s,b:o},a={transposeA:n,transposeB:r};return LU.runKernel("BatchMatMul",i,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QG=jj({oneHot_:function(t,e,n=1,r=0){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const s={indices:Wj(t,"indices","oneHot","int32")},o={depth:e,onValue:n,offValue:r};return LU.runKernel("OneHot",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tq(t,e){return LU.tidy(t,e)}function eq(t){CU(t).forEach((t=>t.dispose()))}function nq(t){return LU.keep(t)}const rq=jj({imag_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={input:Wj(t,"input","imag")};return LU.runKernel("Imag",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sq=jj({neg_:function(t){const e={x:Wj(t,"x","neg")};return LU.runKernel("Neg",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oq=jj({real_:function(t){const e={input:Wj(t,"input","real")};return LU.runKernel("Real",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iq=jj({transpose_:function(t,e,n){const r=Wj(t,"x","transpose");if(null==e&&(e=r.shape.map(((t,e)=>e)).reverse()),rz(r.rank===e.length,(()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`)),e.forEach((t=>{rz(t>=0&&t<r.rank,(()=>"All entries in 'perm' must be between 0 and "+(r.rank-1)+` but got ${e}`))})),r.rank<=1)return r.clone();const s={x:r},o={perm:e};return"complex64"===r.dtype?tq((()=>{let t=oq(r),e=rq(r);return t=LU.runKernel("Transpose",{x:t},o),e=LU.runKernel("Transpose",{x:e},o),n&&(e=sq(e)),Gj(t,e)})):LU.runKernel("Transpose",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aq=jj({confusionMatrix_:function(t,e,n){const r=Wj(t,"labels","confusionMatrix"),s=Wj(e,"predictions","confusionMatrix");rz(null==n||n>0&&Number.isInteger(n),(()=>`If provided, numClasses must be a positive integer, but got ${n}`)),rz(1===r.rank,(()=>`Expected the rank of labels to be 1, but got ${r.rank}`)),rz(1===s.rank,(()=>`Expected the rank of predictions to be 1, but got ${s.rank}`)),rz(r.shape[0]===s.shape[0],(()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${s.shape[0]}. Labels and predictions should have the same number of elements.`)),rz(n>0&&Number.isInteger(n),(()=>`numClasses is required to be a positive integer, but got ${n}`));const o=QG(MG(r,"int32"),n),i=QG(MG(s,"int32"),n),a=iq(o),u=ZG(a,i);return MG(u,"int32")}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var uq=Object.freeze({__proto__:null,confusionMatrix:aq});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cq(t,e){const n=t.length,r=[];for(let s=0;s<n;s++){const o=n-1-s,i=t[o]||1;(e[e.length-1-s]||1)>1&&1===i&&r.unshift(o)}return r}function lq(t,e){const n=[];for(let r=0;r<e.length;r++){const s=t[t.length-r-1],o=e.length-r-1,i=e[o];(null==s||1===s&&i>1)&&n.unshift(o)}return n}function fq(t,e){const n=[],r=Math.max(t.length,e.length);for(let s=0;s<r;s++){let r=t[t.length-s-1];null==r&&(r=1);let o=e[e.length-s-1];if(null==o&&(o=1),1===r)n.unshift(o);else if(1===o)n.unshift(r);else{if(r!==o){throw Error(`Operands could not be broadcast together with shapes ${t} and ${e}.`)}n.unshift(r)}}return n}var hq=Object.freeze({__proto__:null,getBroadcastDims:cq,getReductionAxes:lq,assertAndGetBroadcastShape:fq});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pq(t,e,n){if(oz(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");const r=Bj(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return qj(t,e,r,n)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let dq;function mq(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,s=!1,o=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)s=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)o=!0;else if(null!=t.getContext)i=!0;else{if(!("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);a=!0}if(s){const e=2;if(s&&t.readyState<e)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=mW("FromPixels",LU.backendName)){const n={pixels:t},r={numChannels:e};return LU.runKernel("FromPixels",n,r)}const[u,c]=s?[t.videoWidth,t.videoHeight]:[t.width,t.height];let l,f;if(i)l=t.getContext("2d").getImageData(0,0,u,c).data;else if(r||n)l=t.data;else if(o||s||a){if(null==dq)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");dq=new OffscreenCanvas(1,1).getContext("2d")}else dq=document.createElement("canvas").getContext("2d");dq.canvas.width=u,dq.canvas.height=c,dq.drawImage(t,0,0,u,c),l=dq.getImageData(0,0,u,c).data}if(4===e)f=new Int32Array(l);else{const t=u*c;f=new Int32Array(t*e);for(let n=0;n<t;n++)for(let t=0;t<e;++t)f[n*e+t]=l[4*n+t]}return pq(f,[c,u,e],"int32")}function yq(t){return"undefined"!=typeof window&&"undefined"!=typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(t instanceof ImageBitmap)&&function(t){return null!=t&&0!==t.width&&0!==t.height}(t)&&!function(t){return null!=t&&t.data instanceof Uint8Array}(t)}const gq=jj({fromPixels_:mq});var bq=Object.freeze({__proto__:null,fromPixelsAsync:async function(t,e=3){let n=null;if(Dz().getBool("WRAP_TO_IMAGEBITMAP")&&yq(t)){let e;try{e=await createImageBitmap(t,{premultiplyAlpha:"none"})}catch(t){e=null}n=null!=e&&e.width===t.width&&e.height===t.height?e:t}else n=t;return mq(n,e)},toPixels:async function(t,e){let n=Wj(t,"img","toPixels");if(!(t instanceof wU)){const t=n;n=MG(t,"int32"),t.dispose()}if(2!==n.rank&&3!==n.rank)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const[r,s]=n.shape.slice(0,2),o=2===n.rank?1:n.shape[2];if(o>4||2===o)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${o}`);if("float32"!==n.dtype&&"int32"!==n.dtype)throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`);const i=await n.data(),a="float32"===n.dtype?255:1,u=new Uint8ClampedArray(s*r*4);for(let t=0;t<r*s;++t){const e=[0,0,0,255];for(let r=0;r<o;r++){const s=i[t*o+r];if("float32"===n.dtype){if(s<0||s>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${s}.`)}else if("int32"===n.dtype&&(s<0||s>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${s}.`);1===o?(e[0]=s*a,e[1]=s*a,e[2]=s*a):e[r]=s*a}const r=4*t;u[r+0]=Math.round(e[0]),u[r+1]=Math.round(e[1]),u[r+2]=Math.round(e[2]),u[r+3]=Math.round(e[3])}if(null!=e){e.width=s,e.height=r;const t=e.getContext("2d"),n=new ImageData(u,s,r);t.putImageData(n,0,0)}return n!==t&&n.dispose(),u},fromPixels:gq});function wq(t,e){const n=t.shape.length,r=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==e.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${n}`);if(0===az(t.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const s=e.shape,o=s[s.length-1];let i=1;for(let t=0;t<s.length-1;++t)i*=s[t];const a=t.shape,u=s.slice();u.pop();let c=1;for(let t=o;t<n;++t)c*=a[t],u.push(a[t]);const l=[..._z(t.shape).map((t=>t/c)),1].slice(0,o);return[u,i,c,l]}var vq=Object.freeze({__proto__:null,prepareAndValidate:wq});function xq(t,e,n){const r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${s}.`;if(n.rank<s)throw new Error(o+` update.rank < ${s}. `);if(t.length<r+(n.rank-s))throw new Error(o+` Output shape length < ${r+(n.rank-s)}`);if(n.rank!==s+t.length-r)throw new Error(o+" update.rank != "+(s+t.length-r));for(let t=0;t<s;++t)if(n.shape[t]!==e.shape[t])throw new Error(o+` updates.shape[${t}] (${n.shape[t]}) != indices.shape[${t}] (${e.shape[t]}).`);for(let e=0;e<n.rank-s;++e)if(n.shape[e+s]!==t[e+r])throw new Error(o+` updates.shape[${e+s}] (${n.shape[e+s]}) != shape[${e+s}] (${t[e+s]})`)}function Nq(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if("int32"!==e.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===e.size)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(0===t.size)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}xq(n,e,t)}function $q(t,e,n){const r=e.shape.length,s=r>1?e.shape[r-1]:1,o=n.length;let i=1;for(let t=s;t<o;++t)i*=n[t];const a=s<1?1:s;return{sliceRank:s,numUpdates:az(e.shape)/a,sliceSize:i,strides:[..._z(n.slice(0,s)),1],outputSize:az(n)}}var Eq=Object.freeze({__proto__:null,validateUpdateShape:xq,validateInput:Nq,calculateShapes:$q});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sq(t,e,n,r){const s=[...t];for(let t=s.length;t<r.length;t++)s.push(1);for(let t=0;t<n;t++)0===t?s[e]=1:(s.splice(e,0,1),s.pop());return s}function _q(t,e,n){return n<=t?n:n-(e-1)}function Tq(t,e){const n=[];for(let r=0;r<t;r++)n.push(e+r);return n}function kq(t,e,n,r,s){const o=[...s],i=Tq(n,e);for(let s=0;s<o.length;s++)if(i.indexOf(s)>-1)o[s]=0;else{const i=_q(e,n,s);let a=r[i];t&1<<i&&(a=0),o[s]=a}return o}function Aq(t,e,n,r,s){const o=[...s],i=Tq(n,e);for(let s=0;s<o.length;s++)if(i.indexOf(s)>-1)o[s]=Number.MAX_SAFE_INTEGER;else{const i=_q(e,n,s);let a=r[i];t&1<<i&&(a=Number.MAX_SAFE_INTEGER),o[s]=a}for(let t=0;t<o.length;t++){const e=s[t];o[t]<0&&(o[t]+=e),o[t]=ez(0,o[t],s[t])}return o}function Cq(t,e,n){let r=t[e];return(n&1<<e||null==r)&&(r=1),r}function Oq(t,e,n,r,s,o){let i=e[s];const a=n[s]||1;(t&1<<s||o&1<<s||null==i)&&(i=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const u=r[s];return i<0&&(i+=u),i=ez(0,i,u-1),i}function Iq(t,e,n,r,s,o){let i=e[s];const a=n[s]||1;(t&1<<s||o&1<<s||null==i)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const u=r[s];return i<0&&(i+=u),i=a>0?ez(0,i,u):ez(-1,i,u-1),i}function Mq(t,e,n,r,s,o){if(s[e])return n>0?o[e]:o[e+1&1];{const e=t<0?r+t:t;return e<o[0]?o[0]:e>o[1]?o[1]:e}}var Rq=Object.freeze({__proto__:null,assertParamsValid:function(t,e,n){const r=t.shape.length;rz(r===e.length,(()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`)),rz(r===n.length,(()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`));for(let s=0;s<r;++s)rz(e[s]+n[s]<=t.shape[s],(()=>`Error in slice${r}D: begin[${s}] + size[${s}] (${e[s]+n[s]}) would overflow input.shape[${s}] (${t.shape[s]})`))},maskToAxes:function(t){const e=[];let n=0;for(;t>0;)1&t&&e.push(n),t/=2,n++;return e},computeOutShape:function(t,e,n){const r=[];for(let s=0;s<t.length;s++)r[s]=Math.ceil((e[s]-t[s])/n[s]);return r},stridesWithElidedDims:Sq,getNormalizedAxes:function(t,e,n,r,s,o,i,a,u){const c=t.length;let l=new Array(c),f=new Array(c),h=new Array(c);if(e.length&&n>0){const u=e[0],c=n+1;l=kq(i,u,c,r,t),f=Aq(a,u,c,s,t),h=Sq(o,u,c,t)}else for(let e=0;e<c;e++)l[e]=Oq(i,r,o,t,e,u),f[e]=Iq(a,s,o,t,e,u),h[e]=Cq(o,e,u);return{begin:l,end:f,strides:h}},startIndicesWithElidedDims:kq,stopIndicesWithElidedDims:Aq,stridesForAxis:Cq,startForAxis:Oq,stopForAxis:Iq,isSliceContinous:function(t,e,n){let r=n.length;for(let t=0;t<n.length;t++)if(n[t]>1){r=t;break}for(let s=r+1;s<n.length;s++)if(e[s]>0||n[s]!==t[s])return!1;return!0},computeFlatOffset:function(t,e){let n=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)n+=t[r]*e[r];return n},parseSliceParams:function(t,e,n){let r;const s=t.shape.length;let o;return r="number"==typeof e?[e,...new Array(s-1).fill(0)]:e.length<s?e.concat(new Array(s-e.length).fill(0)):e.slice(),r.forEach((t=>{rz(-1!==t,(()=>"slice() does not support negative begin indexing."))})),o=null==n?new Array(s).fill(-1):"number"==typeof n?[n,...new Array(s-1).fill(-1)]:n.length<s?n.concat(new Array(s-n.length).fill(-1)):n,o=o.map(((e,n)=>e>=0?e:(rz(-1===e,(()=>`Negative size values should be exactly -1 but got ${e} for the slice() size at index ${n}.`)),t.shape[n]-r[n]))),[r,o]},sliceInfo:function(t,e,n,r,s,o,i,a,u){let c;if(null==r?(c=new Array(e.length),c.fill(1)):c=r,null!=i&&0!=(i&i-1))throw new Error("Multiple ellipses in slice is not allowed.");let l=!1;const f={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};for(let t=0;t<f.dims;t++)l&&0!=(1<<t&a)&&f.numAddAxisAfterEllipsis++,1<<t&i&&(l=!0);l||(f.ellipsisMask|=1<<f.dims,f.dims++);const h={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=null!=t.begin,e.endValid=null!=t.end,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<t.dims;r++)if(1<<r&t.ellipsisMask){const s=Math.min(e.dims-(t.dims-r)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<s;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&t.newAxisMask)e.finalShapeGatherIndices.push(-2),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);null!=t.begin&&(e.begin[n]=t.begin[r]),null!=t.end&&(e.end[n]=t.end[r]),e.strides[n]=t.strides[r],t.beginMask&1<<r&&(e.beginMask|=1<<n),t.endMask&1<<r&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(-1),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[n]=r,n++}}(f,h);let p=!0,d=!0,m=!0;const y=[],g=[];for(let e=0;e<t.length;++e){if(0===h.strides[e])throw Error(`strides[${e}] must be non-zero`);const n=!!(h.shrinkAxisMask&1<<e),r=t[e];if(-1===r){y.push(n?1:-1);continue}const s=[h.beginMask&1<<e,h.endMask&1<<e],o=[h.strides[e]>0?0:-1,h.strides[e]>0?r:r-1];if(n&&h.strides[e]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===h.strides[e];const i=!!(h.beginMask&1<<e&&h.endMask&1<<e);if(h.beginValid&&h.endValid){if(n){const t=h.begin[e]<0?r+h.begin[e]:h.begin[e];if(h.begin[e]=t,h.end[e]=h.begin[e]+1,t<0||t>=r)throw Error(`slice index ${h.begin[e]} of dimension ${e} out of bounds.`)}else h.begin[e]=Mq(h.begin[e],0,h.strides[e],r,s,o),h.end[e]=Mq(h.end[e],1,h.strides[e],r,s,o);const t=1===h.strides[e]&&0===h.begin[e]&&h.end[e]===r;p=p&&t,d=d&&(0===e&&1===h.strides[e]||t)}else p=p&&1===h.strides[e]&&i,d=d&&(0===e&&1===h.strides[e]||i);let a,u=!1;if(h.beginValid&&h.endValid?(a=h.end[e]-h.begin[e],u=!0):n?(a=1,u=!0):i&&r>=0&&(a=h.strides[e]<0?-r:r,u=!0),u){let t;t=0===a||a<0!=h.strides[e]<0?0:Math.trunc(a/h.strides[e])+(a%h.strides[e]!=0?1:0),y.push(t)}else y.push(-1)}for(let t=0;t<h.finalShapeGatherIndices.length;++t){const e=h.finalShapeGatherIndices[t];e>=0?g.push(y[e]):-2===e&&g.push(1)}const b=g.filter(((t,e)=>-2!==h.finalShapeGatherIndices[e]));return{finalShapeSparse:b,finalShape:g,isIdentity:p,sliceDim0:d,isSimpleSlice:m,begin:h.begin,end:h.end,strides:h.strides}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dq{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}class Fq{constructor(){this.classNameMap={}}static getMap(){return null==Fq.instance&&(Fq.instance=new Fq),Fq.instance}static register(t){Fq.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function Lq(t){rz(null!=t.className,(()=>"Class being registered does not have the static className property defined.")),rz("string"==typeof t.className,(()=>"className is required to be a string, but got type "+typeof t.className)),rz(t.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),Fq.register(t)}var Pq=Object.freeze({__proto__:null,Serializable:Dq,SerializationMap:Fq,registerClass:Lq});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bq(){return 32===LU.backend.floatPrecision()?.001:.1}function Vq(t,e,n){let r=!0;if((gz(t)||gz(e))&&(r=!1),gz(t)&&gz(e)&&(r=!0),r){const n=t.constructor.name,r=e.constructor.name;if(n!==r)throw new Error(`Arrays are of different type. Actual: ${n}. Expected: ${r}`)}if(Array.isArray(t)&&Array.isArray(e)){const n=Bj(t),r=Bj(e);if(!uz(n,r))throw new Error(`Arrays have different shapes. Actual: [${n}]. Expected: [${r}]`)}const s=gz(t)?t:iz(t),o=gz(e)?e:iz(e);if(s.length!==o.length)throw new Error(`Arrays have different lengths actual: ${s.length} vs expected: ${o.length}.\nActual:   ${s}.\nExpected: ${o}.`);for(let t=0;t<o.length;++t){const e=s[t],r=o[t];if(!n(e,r))throw new Error(`Arrays differ: actual[${t}] = ${e}, expected[${t}] = ${r}.\nActual:   ${s}.\nExpected: ${o}.`)}}function zq(t,e,n){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}var Wq=Object.freeze({__proto__:null,TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(t,e,n){return null==n&&(n=Bq()),Vq(t,e,((t,e)=>zq(t,e,n)))},testEpsilon:Bq,expectPromiseToFail:function(t,e){t().then((()=>e.fail()),(()=>e()))},expectArraysEqual:function(t,e){const n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return vz(t)||vz(t[0])||vz(e)||vz(e[0])?Vq(t,n,((t,e)=>t==e)):Vq(t,e,((t,e)=>zq(t,e,0)))},expectNumbersClose:function(t,e,n){if(null==n&&(n=Bq()),!zq(t,e,n))throw new Error(`Numbers differ: actual === ${t}, expected === ${e}`)},expectValuesInRange:function(t,e,n){for(let r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error(`Value out of range:${t[r]} low: ${e}, high: ${n}`)},expectArrayBuffersEqual:function(t,e){const n=new Float32Array(t),r=new Float32Array(e);if(n.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${n.length}`);for(let t=0;t<r.length;t++)if(n[t]!==r[t])throw new Error(`Expected ArrayBuffer value at ${t} to be ${r[t]} but got ${n[t]} instead`)},encodeStrings:function t(e){for(let n=0;n<e.length;n++){const r=e[n];Array.isArray(r)?t(r):e[n]=oU(r)}return e}});
/** @license See the LICENSE file. */const Uq=jj({add_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=Wj(t,"a","add"),r=Wj(e,"b","add");[n,r]=kU(n,r);const s={a:n,b:r};return LU.runKernel("Add",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jq=jj({floorDiv_:function(t,e){let n=Wj(t,"a","floorDiv"),r=Wj(e,"b","floorDiv");[n,r]=kU(n,r);const s={a:n,b:r};return LU.runKernel("FloorDiv",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gq=jj({div_:function(t,e){let n=Wj(t,"a","div"),r=Wj(e,"b","div");if([n,r]=kU(n,r),"int32"===n.dtype&&"int32"===r.dtype)return jq(n,r);const s={a:n,b:r};return LU.runKernel("RealDiv",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qq=jj({mul_:function(t,e){let n=Wj(t,"a","mul"),r=Wj(e,"b","mul");[n,r]=kU(n,r);const s={a:n,b:r};return LU.runKernel("Multiply",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hq=jj({abs_:function(t){const e=Wj(t,"x","abs");if("complex64"===e.dtype){const t={x:e};return LU.runKernel("ComplexAbs",t)}{const t={x:e};return LU.runKernel("Abs",t)}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kq=jj({acos_:function(t){const e={x:Wj(t,"x","acos")};return LU.runKernel("Acos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xq=jj({acosh_:function(t){const e={x:Wj(t,"x","acosh")};return LU.runKernel("Acosh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jq=jj({addN_:function(t){rz(Array.isArray(t),(()=>"The argument passed to tf.addN() must be a list of tensors")),rz(t.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`));const e=t.map(((t,e)=>Wj(t,`tensors${e}`,"addN"))),n=e[0];e.forEach((t=>{if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((t=>{if(!uz(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const r=e;return LU.runKernel("AddN",r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yq=jj({all_:function(t,e=null,n=!1){const r={x:Wj(t,"x","all","bool")},s={axis:e,keepDims:n};return LU.runKernel("All",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zq=jj({any_:function(t,e=null,n=!1){const r={x:Wj(t,"x","any","bool")},s={axis:e,keepDims:n};return LU.runKernel("Any",r,s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qq=jj({argMax_:function(t,e=0){const n={x:Wj(t,"x","argMax")},r={axis:e};return LU.runKernel("ArgMax",n,r)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tH=jj({argMin_:function(t,e=0){const n={x:Wj(t,"x","argMin")},r={axis:e};return LU.runKernel("ArgMin",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eH=jj({asin_:function(t){const e={x:Wj(t,"x","asin")};return LU.runKernel("Asin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nH=jj({asinh_:function(t){const e={x:Wj(t,"x","asinh")};return LU.runKernel("Asinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rH=jj({atan_:function(t){const e={x:Wj(t,"x","atan")};return LU.runKernel("Atan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sH=jj({atan2_:function(t,e){let n=Wj(t,"a","atan2"),r=Wj(e,"b","atan2");[n,r]=kU(n,r);const s={a:n,b:r};return LU.runKernel("Atan2",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oH=jj({atanh_:function(t){const e={x:Wj(t,"x","atanh")};return LU.runKernel("Atanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iH(t,e,n,r,s,o,i="channelsLast"){const[a,u]=lH(e);let c;if("channelsLast"===i)c=[a,u,t[3],t[3]];else{if("channelsFirst"!==i)throw new Error(`Unknown dataFormat ${i}`);c=[a,u,t[1],t[1]]}return aH(t,c,n,r,s,o,!1,i)}function aH(t,e,n,r,s,o,i=!1,a="channelsLast"){let[u,c,l,f]=[-1,-1,-1,-1];if("channelsLast"===a)[u,c,l,f]=t;else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);[u,f,c,l]=t}const[h,p,,d]=e,[m,y]=lH(n),[g,b]=lH(r),w=hH(h,g),v=hH(p,b),{padInfo:x,outHeight:N,outWidth:$}=function(t,e,n,r,s,o,i,a,u){let c,l,f;if("number"==typeof t){c={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};const s=function(t,e,n,r,s){null==r&&(r=cH(t,e,n));const o=t[0],i=t[1],a=pH((o-e+2*r)/n+1,s),u=pH((i-e+2*r)/n+1,s);return[a,u]}([e,n],o,r,t,a);l=s[0],f=s[1]}else if("same"===t){l=Math.ceil(e/r),f=Math.ceil(n/s);const t=Math.max(0,(l-1)*r+o-e),a=Math.max(0,(f-1)*s+i-n),u=Math.floor(t/2),h=t-u,p=Math.floor(a/2);c={top:u,bottom:h,left:p,right:a-p,type:"SAME"}}else if("valid"===t)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-o+1)/r),f=Math.ceil((n-i+1)/s);else{if("object"!=typeof t)throw Error(`Unknown padding parameter: ${t}`);{const h="channelsLast"===u?t[1][0]:t[2][0],p="channelsLast"===u?t[1][1]:t[2][1],d="channelsLast"===u?t[2][0]:t[3][0],m="channelsLast"===u?t[2][1]:t[3][1];c={top:h,bottom:p,left:d,right:m,type:0===h&&0===p&&0===d&&0===m?"VALID":"EXPLICIT"},l=pH((e-o+h+p)/r+1,a),f=pH((n-i+d+m)/s+1,a)}}return{padInfo:c,outHeight:l,outWidth:f}}(s,c,l,m,y,w,v,o,a),E=i?d*f:d;let S;return"channelsFirst"===a?S=[u,E,N,$]:"channelsLast"===a&&(S=[u,N,$,E]),{batchSize:u,dataFormat:a,inHeight:c,inWidth:l,inChannels:f,outHeight:N,outWidth:$,outChannels:E,padInfo:x,strideHeight:m,strideWidth:y,filterHeight:h,filterWidth:p,effectiveFilterHeight:w,effectiveFilterWidth:v,dilationHeight:g,dilationWidth:b,inShape:t,outShape:S,filterShape:e}}function uH(t,e,n,r,s,o=!1,i="channelsLast",a){let[u,c,l,f,h]=[-1,-1,-1,-1,-1];if("channelsLast"===i)[u,c,l,f,h]=t;else{if("channelsFirst"!==i)throw new Error(`Unknown dataFormat ${i}`);[u,h,c,l,f]=t}const[p,d,m,,y]=e,[g,b,w]=fH(n),[v,x,N]=fH(r),$=hH(p,v),E=hH(d,x),S=hH(m,N),{padInfo:_,outDepth:T,outHeight:k,outWidth:A}=function(t,e,n,r,s,o,i,a,u,c,l){let f,h,p,d;if("number"==typeof t){f={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};const o=function(t,e,n,r,s,o){null==s&&(s=cH(t,e,r));const i=t[0],a=t[1],u=t[2],c=pH((i-e+2*s)/r+1,o),l=pH((a-e+2*s)/r+1,o),f=pH((u-e+2*s)/r+1,o);return[c,l,f,n]}([e,n,r,1],a,1,s,t,l);h=o[0],p=o[1],d=o[2]}else if("same"===t){h=Math.ceil(e/s),p=Math.ceil(n/o),d=Math.ceil(r/i);const t=(h-1)*s+a-e,l=(p-1)*o+u-n,m=(d-1)*i+c-r,y=Math.floor(t/2),g=t-y,b=Math.floor(l/2),w=l-b,v=Math.floor(m/2);f={top:b,bottom:w,left:v,right:m-v,front:y,back:g,type:"SAME"}}else{if("valid"!==t)throw Error(`Unknown padding parameter: ${t}`);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((e-a+1)/s),p=Math.ceil((n-u+1)/o),d=Math.ceil((r-c+1)/i)}return{padInfo:f,outDepth:h,outHeight:p,outWidth:d}}(s,c,l,f,g,b,w,$,E,S,a),C=o?y*h:y;let O;return"channelsFirst"===i?O=[u,C,T,k,A]:"channelsLast"===i&&(O=[u,T,k,A,C]),{batchSize:u,dataFormat:i,inDepth:c,inHeight:l,inWidth:f,inChannels:h,outDepth:T,outHeight:k,outWidth:A,outChannels:C,padInfo:_,strideDepth:g,strideHeight:b,strideWidth:w,filterDepth:p,filterHeight:d,filterWidth:m,effectiveFilterDepth:$,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationDepth:v,dilationHeight:x,dilationWidth:N,inShape:t,outShape:O,filterShape:e}}function cH(t,e,n,r=1){const s=hH(e,r);return Math.floor((t[0]*(n-1)-n+s)/2)}function lH(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function fH(t){return"number"==typeof t?[t,t,t]:t}function hH(t,e){return e<=1?t:t+(t-1)*(e-1)}function pH(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function dH(t){const[e,n,r]=lH(t);return 1===e&&1===n&&1===r}function mH(t,e){return dH(t)||dH(e)}function yH(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function gH(t,e,n){if(null!=n){if("string"==typeof e)throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if("number"==typeof e)rz(cz(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`));else{if("object"!=typeof e)throw Error(`Error in ${t}: Unknown padding parameter: ${e}`);e.forEach((e=>{e.forEach((e=>{rz(cz(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`))}))}))}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bH=jj({reshape_:function(t,e){const n={x:Wj(t,"x","reshape","string_or_numeric")},r={shape:e};return LU.runKernel("Reshape",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wH=jj({avgPool_:function(t,e,n,r,s){const o=Wj(t,"x","avgPool","float32");rz(mH(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let i=o,a=!1;3===o.rank&&(a=!0,i=bH(o,[1,o.shape[0],o.shape[1],o.shape[2]])),rz(4===i.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${i.rank}.`)),gH("avgPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s};let l=LU.runKernel("AvgPool",u,c);return l=MG(l,o.dtype),a?bH(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vH=jj({avgPool3d_:function(t,e,n,r,s,o="NDHWC"){const i=Wj(t,"x","avgPool3d","float32");let a=i,u=!1;4===i.rank&&(u=!0,a=bH(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),rz(5===a.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`)),rz("NDHWC"===o,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),gH("avgPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o};let f=LU.runKernel("AvgPool3D",c,l);return f=MG(f,a.dtype),u?bH(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xH=jj({concat_:function(t,e=0){rz(t.length>=1,(()=>"Pass at least one tensor to concat"));const n=Uj(t,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((t=>{if("complex64"!==t.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${t.dtype}. `)})),1===n.length)return RG(n[0]);const r=n,s={axis:e};return LU.runKernel("Concat",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NH=jj({sigmoid_:function(t){const e={x:Wj(t,"x","sigmoid","float32")};return LU.runKernel("Sigmoid",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $H=jj({slice_:function(t,e,n){const r=Wj(t,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const s={x:r},o={begin:e,size:n};return LU.runKernel("Slice",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EH=jj({tanh_:function(t){const e={x:Wj(t,"x","tanh","float32")};return LU.runKernel("Tanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SH=jj({basicLSTMCell_:function(t,e,n,r,s,o){const i=Wj(t,"forgetBias","basicLSTMCell"),a=Wj(e,"lstmKernel","basicLSTMCell"),u=Wj(n,"lstmBias","basicLSTMCell"),c=Wj(r,"data","basicLSTMCell"),l=Wj(s,"c","basicLSTMCell"),f=Wj(o,"h","basicLSTMCell"),h=xH([c,f],1),p=ZG(h,a),d=Uq(p,u),m=d.shape[0],y=d.shape[1]/4,g=[m,y],b=$H(d,[0,0],g),w=$H(d,[0,y],g),v=$H(d,[0,2*y],g),x=$H(d,[0,3*y],g),N=Uq(qq(NH(b),EH(w)),qq(l,NH(Uq(i,v))));return[N,qq(EH(N),NH(x))]}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _H=jj({batchToSpaceND_:function(t,e,n){const r=Wj(t,"x","batchToSpaceND"),s=e.reduce(((t,e)=>t*e));rz(r.rank>=1+e.length,(()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`)),rz(n.length===e.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`)),rz(r.shape[0]%s==0,(()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${s}`));const o={x:r},i={blockShape:e,crops:n};return LU.runKernel("BatchToSpaceND",o,i)}});const TH=jj({batchNorm_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s,o){null==o&&(o=.001);const i=Wj(t,"x","batchNorm"),a=Wj(e,"mean","batchNorm"),u=Wj(n,"variance","batchNorm");let c,l;null!=s&&(c=Wj(s,"scale","batchNorm")),null!=r&&(l=Wj(r,"offset","batchNorm")),rz(a.rank===u.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),rz(null==l||a.rank===l.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),rz(null==c||a.rank===c.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const f=function(t){let e;return e=0===t.rank||1===t.rank?bH(t,[1,1,1,t.size]):2===t.rank?bH(t,[1,1,t.shape[0],t.shape[1]]):3===t.rank?bH(t,[1,t.shape[0],t.shape[1],t.shape[2]]):t,e}(i),h={x:f,scale:c,offset:l,mean:a,variance:u},p={varianceEpsilon:o},d=LU.runKernel("FusedBatchNorm",h,p);return bH(d,i.shape)}});const kH=jj({batchNorm2d_:function(t,e,n,r,s,o){const i=Wj(t,"x","batchNorm"),a=Wj(e,"mean","batchNorm"),u=Wj(n,"variance","batchNorm");let c,l;return null!=s&&(c=Wj(s,"scale","batchNorm")),null!=r&&(l=Wj(r,"offset","batchNorm")),rz(2===i.rank,(()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`)),rz(2===a.rank||1===a.rank,(()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`)),rz(2===u.rank||1===u.rank,(()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`)),null!=c&&rz(2===c.rank||1===c.rank,(()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`)),null!=l&&rz(2===l.rank||1===l.rank,(()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${l.rank}.`)),TH(i,a,u,l,c,o)}});const AH=jj({batchNorm3d_:function(t,e,n,r,s,o){const i=Wj(t,"x","batchNorm"),a=Wj(e,"mean","batchNorm"),u=Wj(n,"variance","batchNorm");let c,l;return null!=s&&(c=Wj(s,"scale","batchNorm")),null!=r&&(l=Wj(r,"offset","batchNorm")),rz(3===i.rank,(()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`)),rz(3===a.rank||1===a.rank,(()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`)),rz(3===u.rank||1===u.rank,(()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`)),null!=c&&rz(3===c.rank||1===c.rank,(()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`)),null!=l&&rz(3===l.rank||1===l.rank,(()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${l.rank}.`)),TH(i,a,u,l,c,o)}});const CH=jj({batchNorm4d_:function(t,e,n,r,s,o){const i=Wj(t,"x","batchNorm"),a=Wj(e,"mean","batchNorm"),u=Wj(n,"variance","batchNorm");let c,l;return null!=s&&(c=Wj(s,"scale","batchNorm")),null!=r&&(l=Wj(r,"offset","batchNorm")),rz(4===i.rank,(()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`)),rz(4===a.rank||1===a.rank,(()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`)),rz(4===u.rank||1===u.rank,(()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`)),null!=c&&rz(4===c.rank||1===c.rank,(()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`)),null!=l&&rz(4===l.rank||1===l.rank,(()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${l.rank}.`)),TH(i,a,u,l,c,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OH=jj({bincount_:function(t,e,n){const r=Wj(t,"x","bincount"),s=Wj(e,"weights","bincount");rz("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),rz(n>=0,(()=>`size must be non-negative, but got ${n}.`)),rz(s.size===r.size||0===s.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${s.shape}.`));const o={x:r,weights:s},i={size:n};return LU.runKernel("Bincount",o,i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IH=jj({broadcastArgs_:function(t,e){const n=Wj(t,"s0","broadcastArgs","int32"),r=Wj(e,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(1!==r.rank)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const s={s0:n,s1:r};return LU.runKernel("BroadcastArgs",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MH=jj({broadcastTo_:function(t,e){let n=Wj(t,"broadcastTo","x");const r=n.shape;if(e.some((t=>!(t>0)||t%1!=0)))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const t=n.shape.slice();for(;t.length<e.length;)t.unshift(1);n=bH(n,t)}const s=n.shape,o=Array.from(e);for(let t=e.length-1;t>=0;t--)if(s[t]===e[t])o[t]=1;else if(1!==n.shape[t])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);const i=o.map(((t,e)=>t>1?e:-1)).filter((t=>t>=0));if(0===i.length)return RG(n);const a={x:n},u={reps:o};return LU.runKernel("Tile",a,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RH=jj({ceil_:function(t){const e={x:Wj(t,"x","ceil","float32")};return LU.runKernel("Ceil",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DH=jj({clipByValue_:function(t,e,n){const r=Wj(t,"x","clipByValue");rz(e<=n,(()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`));const s={x:r},o={clipValueMin:e,clipValueMax:n};return LU.runKernel("ClipByValue",s,o)}});const FH=jj({concat1d_:function(t){return xH(t,0)}});const LH=jj({concat2d_:function(t,e){return xH(t,e)}});const PH=jj({concat3d_:function(t,e){return xH(t,e)}});const BH=jj({concat4d_:function(t,e){return xH(t,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VH=jj({conv2d_:function(t,e,n,r,s="NHWC",o=[1,1],i){const a=Wj(t,"x","conv2d","float32"),u=Wj(e,"filter","conv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=bH(a,[1,a.shape[0],a.shape[1],a.shape[2]])),rz(4===c.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`)),rz(4===u.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`)),gH("conv2d",r,i);const f="NHWC"===s?c.shape[3]:c.shape[1];rz(f===u.shape[2],(()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`)),rz(mH(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const h={x:c,filter:u},p={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},d=LU.runKernel("Conv2D",h,p);return l?bH(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});const zH=jj({conv1d_:function(t,e,n,r,s="NWC",o=1,i){const a=Wj(t,"x","conv1d"),u=Wj(e,"filter","conv1d");let c=a,l=!1;2===a.rank&&(l=!0,c=bH(a,[1,a.shape[0],a.shape[1]])),rz(3===c.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`)),rz(3===u.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`)),gH("conv1d",r,i),rz(c.shape[2]===u.shape[1],(()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`)),rz(mH(n,o),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${o}'`)),rz("NWC"===s,(()=>`Error in conv1d: got dataFormat of ${s} but only NWC is currently supported.`));const f=bH(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=bH(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=VH(h,f,[1,n],r,"NHWC",[1,o],i);return bH(p,l?[p.shape[2],p.shape[3]]:[p.shape[0],p.shape[2],p.shape[3]])}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WH=jj({conv2DBackpropInput_:function(t,e,n,r,s,o="NHWC",i){rz(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let a=t,u=e,c=!1;3===e.rank&&(c=!0,u=bH(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),rz(4===a.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`)),rz(4===u.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`)),rz(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const l="NHWC"===o?a[3]:a[1],f="NHWC"===o?u.shape[3]:u.shape[1];rz(l===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[2]}.`)),rz(f===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${n.shape[3]}.`)),gH("conv2dDerInput",s,i);const h={dy:u,filter:n},p={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,inputShape:a},d=LU.runKernel("Conv2DBackpropInput",h,p);return c?bH(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});const UH=jj({conv2dTranspose_:function(t,e,n,r,s,o){const i=Wj(t,"x","conv2dTranspose"),a=Wj(e,"filter","conv2dTranspose");return WH(n,i,a,r,s,"NHWC",o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jH=jj({conv3d_:function(t,e,n,r,s="NDHWC",o=[1,1,1]){const i=Wj(t,"x","conv3d"),a=Wj(e,"filter","conv3d");let u=i,c=!1;4===i.rank&&(c=!0,u=bH(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),rz(5===u.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`)),rz(5===a.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`)),rz(u.shape[4]===a.shape[3],(()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${a.shape[3]}.`)),rz(mH(n,o),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),rz("NDHWC"===s,(()=>`Error in conv3d: got dataFormat of ${s} but only NDHWC is currently supported.`));const l={x:u,filter:a},f={strides:n,pad:r,dataFormat:s,dilations:o},h=LU.runKernel("Conv3D",l,f);return c?bH(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GH=jj({conv3DBackpropInput_:function(t,e,n,r,s){rz(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let o=t,i=e,a=!1;4===e.rank&&(a=!0,i=bH(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,t[0],t[1],t[2],t[3]]);const u=o[4],c=i.shape[4];rz(5===o.length,(()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`)),rz(5===i.rank,(()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`)),rz(5===n.rank,(()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`)),rz(u===n.shape[3],(()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[3]}.`)),rz(c===n.shape[4],(()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`));const l={dy:i,filter:n},f={pad:s,strides:r,inputShape:o},h=LU.runKernel("Conv3DBackpropInputV2",l,f);return a?bH(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});const qH=jj({conv3dTranspose_:function(t,e,n,r,s){const o=Wj(t,"x","conv3dTranspose"),i=Wj(e,"filter","conv3dTranspose");return GH(n,o,i,r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HH=jj({cos_:function(t){const e={x:Wj(t,"x","cos","float32")};return LU.runKernel("Cos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KH=jj({cosh_:function(t){const e={x:Wj(t,"x","cosh","float32")};return LU.runKernel("Cosh",e)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XH=jj({cumprod_:function(t,e=0,n=!1,r=!1){const s={x:Wj(t,"x","cumprod")},o={axis:e,exclusive:n,reverse:r};return LU.runKernel("Cumprod",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JH=jj({cumsum_:function(t,e=0,n=!1,r=!1){const s={x:Wj(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:r};return LU.runKernel("Cumsum",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YH=jj({denseBincount_:function(t,e,n,r=!1){const s=Wj(t,"x","denseBincount"),o=Wj(e,"weights","denseBincount");rz("int32"===s.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${s.dtype}`)),rz(s.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${s.rank}.`)),rz(n>=0,(()=>`size must be non-negative, but got ${n}.`)),rz(o.size===s.size||0===o.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${s.shape}, weights shape: ${o.shape}.`));const i={x:s,weights:o},a={size:n,binaryOutput:r};return LU.runKernel("DenseBincount",i,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZH=jj({depthToSpace_:function(t,e,n="NHWC"){const r=Wj(t,"x","depthToSpace","float32"),s="NHWC"===n?r.shape[1]:r.shape[2],o="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];rz(e>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`)),rz(s*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${s} and ${e}  for depthToSpace with input shape\n    ${r.shape}`)),rz(o*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${o} and ${e} for depthToSpace with input shape\n        ${r.shape}`)),rz(i%(e*e)==0,(()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${r.shape}`));const a={x:r},u={blockSize:e,dataFormat:n};return LU.runKernel("DepthToSpace",a,u)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QH=jj({depthwiseConv2d_:function(t,e,n,r,s="NHWC",o=[1,1],i){const a=Wj(t,"x","depthwiseConv2d","float32"),u=Wj(e,"filter","depthwiseConv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=bH(a,[1,a.shape[0],a.shape[1],a.shape[2]])),rz(4===c.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`)),rz(4===u.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`)),rz(c.shape[3]===u.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`)),gH("depthwiseConv2d",r,i);const f={x:c,filter:u},h={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},p=LU.runKernel("DepthwiseConv2dNative",f,h);return l?bH(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tK=jj({diag_:function(t){const e={x:Wj(t,"x","diag")};return LU.runKernel("Diag",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eK=jj({dilation2d_:function(t,e,n,r,s=[1,1],o="NHWC"){const i=Wj(t,"x","dilation2d"),a=Wj(e,"filter","dilation2d");rz(3===i.rank||4===i.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`)),rz(3===a.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`)),rz("NHWC"===o,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`));let u=i,c=!1;3===i.rank&&(u=bH(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=!0);const l={x:u,filter:a},f={strides:n,pad:r,dilations:s},h=LU.runKernel("Dilation2D",l,f);return c?bH(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nK=jj({equal_:function(t,e){let n=Wj(t,"a","equal","string_or_numeric"),r=Wj(e,"b","equal","string_or_numeric");[n,r]=kU(n,r),fq(n.shape,r.shape);const s={a:n,b:r};return LU.runKernel("Equal",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rK=jj({where_:function(t,e,n){const r=Wj(e,"a","where"),s=Wj(n,"b","where"),o=Wj(t,"condition","where","bool"),i=fq(fq(o.shape,r.shape),s.shape),a={condition:MH(o,i),t:MH(r,i),e:MH(s,i)};return LU.runKernel("Select",a)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sK=jj({zerosLike_:function(t){const e={x:Wj(t,"x","zerosLike")};return LU.runKernel("ZerosLike",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oK=jj({divNoNan_:function(t,e){let n=Wj(t,"a","div"),r=Wj(e,"b","div");[n,r]=kU(n,r);const s=Gq(n,r),o=sK(s),i=nK(r,o);return rK(i,o,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iK=jj({dot_:function(t,e){const n=Wj(t,"t1","dot"),r=Wj(e,"t2","dot");rz(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`));const s=1===n.rank?n.size:n.shape[1],o=1===r.rank?r.size:r.shape[0];if(rz(s===o,(()=>`Error in dot: inner dimensions of inputs must match, but got ${s} and ${o}.`)),1===n.rank&&1===r.rank){const t=bH(n,[1,-1]),e=bH(r,[-1,1]),s=ZG(t,e);return bH(s,[])}if(1===n.rank&&2===r.rank){const t=bH(n,[1,-1]),e=bH(r,[r.shape[0],r.shape[1]]),s=ZG(t,e);return bH(s,[s.size])}if(2===n.rank&&1===r.rank){const t=bH(r,[-1,1]),e=ZG(n,t);return bH(e,[e.size])}{const t=bH(r,[r.shape[0],r.shape[1]]);return ZG(n,t)}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aK=jj({einsum_:function(t,...e){const n=e.map(((t,e)=>Wj(t,`tensors${e}`,"einsum"))),r={equation:t};return LU.runKernel("Einsum",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uK=jj({elu_:function(t){const e={x:Wj(t,"x","elu","float32")};return LU.runKernel("Elu",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cK=jj({erf_:function(t){let e=Wj(t,"x","erf");rz("int32"===e.dtype||"float32"===e.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===e.dtype&&(e=MG(e,"float32"));const n={x:e};return LU.runKernel("Erf",n)}});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lK(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function fK(t,e,n){const r=t.length+e.length,s=[];let o=0,i=0;for(let a=0;a<r;a++)-1===n.indexOf(a)?s.push(t[o++]):s.push(e[i++]);return s}function hK(t,e){return fK(t,e.map((t=>1)),e)}const pK=jj({max_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=null,n=!1){const r={x:Wj(t,"x","max")},s={reductionIndices:e,keepDims:n};return LU.runKernel("Max",r,s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dK=jj({min_:function(t,e=null,n=!1){const r={x:Wj(t,"x","min")},s={axis:e,keepDims:n};return LU.runKernel("Min",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mK=jj({pow_:function(t,e){let n=Wj(t,"base","pow"),r=Wj(e,"exp","pow");[n,r]=kU(n,r);const s={a:n,b:r};return LU.runKernel("Pow",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yK(t,e){if((gz(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&gz(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return qj(t,[],[],e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gK=jj({sqrt_:function(t){const e={x:Wj(t,"x","sqrt","float32")};return LU.runKernel("Sqrt",e)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bK=jj({square_:function(t){const e=Wj(t,"x","square");return LU.runKernel("Square",{x:e},{})}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wK=jj({sum_:function(t,e=null,n=!1){let r=Wj(t,"x","sum");"bool"===r.dtype&&(r=MG(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return LU.runKernel("Sum",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vK(t,e,n=null){if(0===t.rank)return Hq(t);if(1!==t.rank&&null===n)return vK(bH(t,[-1]),e,n);if(1===t.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===e)return wK(Hq(t),n);if(e===1/0)return pK(Hq(t),n);if(e===-1/0)return dK(Hq(t),n);if("euclidean"===e||2===e)return gK(wK(mK(Hq(t),yK(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&2===n.length){if(1===e)return pK(wK(Hq(t),n[0]),n[1]-1);if(e===1/0)return pK(wK(Hq(t),n[1]),n[0]);if(e===-1/0)return dK(wK(Hq(t),n[1]),n[0]);if("fro"===e||"euclidean"===e)return gK(wK(bK(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const xK=jj({norm_:function(t,e="euclidean",n=null,r=!1){const s=vK(t=Wj(t,"x","norm"),e,n);let o=s.shape;if(r){const e=fz(n,t.shape);o=hK(s.shape,e)}return bH(s,o)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NK=jj({euclideanNorm_:function(t,e=null,n=!1){return xK(t,"euclidean",e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $K=jj({exp_:function(t){const e={x:Wj(t,"x","exp")};return LU.runKernel("Exp",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EK=jj({expandDims_:function(t,e=0){const n=Wj(t,"x","expandDims","string_or_numeric");rz(e<=n.rank,(()=>"Axis must be <= rank of the tensor"));const r={input:n},s={dim:e};return LU.runKernel("ExpandDims",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SK=jj({expm1_:function(t){const e={x:Wj(t,"x","expm1")};return LU.runKernel("Expm1",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _K=jj({tile_:function(t,e){const n=Wj(t,"x","tile","string_or_numeric");rz(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`));const r={x:n},s={reps:e};return LU.runKernel("Tile",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TK=jj({eye_:function(t,e,n,r="float32"){null==e&&(e=t);const s=IG([t,e],r),o=t<=e?t:e;for(let t=0;t<o;++t)s.set(1,t,t);const i=bH(s.toTensor(),[t,e]);if(null==n)return i;if(1===n.length)return _K(EK(i,0),[n[0],1,1]);if(2===n.length)return _K(EK(EK(i,0),0),[n[0],n[1],1,1]);if(3===n.length)return _K(EK(EK(EK(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kK(t,e,n){const r={shape:t,value:e,dtype:n};return LU.runKernel("Fill",{},r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AK=jj({floor_:function(t){const e={x:Wj(t,"x","floor","float32")};return LU.runKernel("Floor",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CK=jj({gather_:function(t,e,n=0,r=0){const s={x:Wj(t,"x","gather"),indices:Wj(e,"indices","gather","int32")},o={axis:n,batchDims:r};return LU.runKernel("GatherV2",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OK=jj({greater_:function(t,e){let n=Wj(t,"a","greater","string_or_numeric"),r=Wj(e,"b","greater","string_or_numeric");[n,r]=kU(n,r),fq(n.shape,r.shape);const s={a:n,b:r};return LU.runKernel("Greater",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IK=jj({greaterEqual_:function(t,e){let n=Wj(t,"a","greaterEqual","string_or_numeric"),r=Wj(e,"b","greaterEqual","string_or_numeric");[n,r]=kU(n,r),fq(n.shape,r.shape);const s={a:n,b:r};return LU.runKernel("GreaterEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MK=jj({isFinite_:function(t){const e={x:Wj(t,"x","isFinite")};return LU.runKernel("IsFinite",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RK=jj({isInf_:function(t){const e={x:Wj(t,"x","isInf")};return LU.runKernel("IsInf",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DK=jj({isNaN_:function(t){const e={x:Wj(t,"x","isNaN")};return LU.runKernel("IsNan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FK=jj({leakyRelu_:function(t,e=.2){const n={x:Wj(t,"x","leakyRelu")},r={alpha:e};return LU.runKernel("LeakyRelu",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LK=jj({less_:function(t,e){let n=Wj(t,"a","less","string_or_numeric"),r=Wj(e,"b","less","string_or_numeric");[n,r]=kU(n,r),fq(n.shape,r.shape);const s={a:n,b:r};return LU.runKernel("Less",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PK=jj({lessEqual_:function(t,e){let n=Wj(t,"a","lessEqual","string_or_numeric"),r=Wj(e,"b","lessEqual","string_or_numeric");[n,r]=kU(n,r),fq(n.shape,r.shape);const s={a:n,b:r};return LU.runKernel("LessEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BK(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:t,stop:e,num:n};return LU.runKernel("LinSpace",{},r)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VK=jj({localResponseNormalization_:function(t,e=5,n=1,r=1,s=.5){const o=Wj(t,"x","localResponseNormalization");rz(4===o.rank||3===o.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${o.rank}.`)),rz(cz(e),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`));let i=o,a=!1;3===o.rank&&(a=!0,i=bH(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const u={x:i},c={depthRadius:e,bias:n,alpha:r,beta:s},l=LU.runKernel("LRN",u,c);return a?bH(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zK=jj({log_:function(t){const e={x:Wj(t,"x","log","float32")};return LU.runKernel("Log",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WK=jj({log1p_:function(t){const e={x:Wj(t,"x","log1p")};return LU.runKernel("Log1p",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UK(t,e){rz(Ez(t),(()=>"The f passed in variableGrads(f) must be a function")),rz(null==e||Array.isArray(e)&&e.every((t=>t instanceof vU)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=e;if(!n){e=[];for(const t in LU.registeredVariables)e.push(LU.registeredVariables[t])}const r=n?e.filter((t=>!t.trainable)):null,s=e.length;e=e.filter((t=>t.trainable)),rz(e.length>0,(()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${s} variables is trainable.`));const{value:o,grads:i}=LU.gradients(t,e,null,!0);rz(i.some((t=>null!=t)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),rz(0===o.rank,(()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`));const a={};return e.forEach(((t,e)=>{null!=i[e]&&(a[t.name]=i[e])})),null!=r&&r.forEach((t=>a[t.name]=null)),{value:o,grads:a}}function jK(t){return LU.customGrad(t)}function GK(t){const e=t.filter((t=>null==t)).length;if(e>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qK=jj({softplus_:function(t){const e={x:Wj(t,"x","softplus")};return LU.runKernel("Softplus",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HK=jj({logSigmoid_:function(t){const e=Wj(t,"x","logSigmoid"),n=jK((t=>({value:sq(qK(sq(t))),gradFunc:e=>qq(e,NH(sq(t)))})));return n(e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KK=jj({sub_:function(t,e){let n=Wj(t,"a","sub"),r=Wj(e,"b","sub");[n,r]=kU(n,r);const s={a:n,b:r};return LU.runKernel("Sub",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XK=jj({logSoftmax_:function(t,e=-1){const n=Wj(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);const r=jK(((t,n)=>{const r=pK(t,e,!0),s=KK(t,r),o=KK(MG(s,"float32"),zK(wK($K(s),e,!0)));n([o]);return{value:o,gradFunc:(t,n)=>{const[r]=n,s=$K(r);return KK(t,qq(wK(t,e,!0),s))}}}));return r(n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JK=jj({logSumExp_:function(t,e=null,n=!1){const r=Wj(t,"x","logSumExp"),s=fz(e,r.shape),o=pK(r,s,!0),i=KK(r,o),a=$K(i),u=wK(a,s),c=zK(u),l=Uq(bH(o,c.shape),c);if(n){const t=hK(l.shape,s);return bH(l,t)}return l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YK=jj({logicalAnd_:function(t,e){const n=Wj(t,"a","logicalAnd","bool"),r=Wj(e,"b","logicalAnd","bool");fq(n.shape,r.shape);const s={a:n,b:r};return LU.runKernel("LogicalAnd",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZK=jj({logicalNot_:function(t){const e={x:Wj(t,"x","logicalNot","bool")};return LU.runKernel("LogicalNot",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QK=jj({logicalOr_:function(t,e){const n=Wj(t,"a","logicalOr","bool"),r=Wj(e,"b","logicalOr","bool");fq(n.shape,r.shape);const s={a:n,b:r};return LU.runKernel("LogicalOr",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tX=jj({logicalXor_:function(t,e){const n=Wj(t,"a","logicalXor","bool"),r=Wj(e,"b","logicalXor","bool");return fq(n.shape,r.shape),YK(QK(t,e),ZK(YK(t,e)))}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eX=jj({searchSorted_:function(t,e,n="left"){const r=Wj(t,"sortedSequence","searchSorted"),s=Wj(e,"values","searchSorted"),o=r.shape[r.shape.length-1],i=s.shape[s.shape.length-1],a=bH(r,[-1,o]),u=bH(s,[-1,i]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(az(u.shape)>=2147483648)throw new Error("values tensor size must less than 2147483648");if(a.shape[1]>=2147483648)throw new Error(`trailing dim_size must less than 2147483648 for int32 output type, was ${a.shape[1]}`);const c={sortedSequence:a,values:u},l={side:n};return LU.runKernel("SearchSorted",c,l)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nX(t,e){return eX(t,e,"left")}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rX=jj({maxPool_:function(t,e,n,r,s){const o=Wj(t,"x","maxPool");let i=o,a=!1;3===o.rank&&(a=!0,i=bH(o,[1,o.shape[0],o.shape[1],o.shape[2]])),rz(4===i.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${i.rank}.`)),rz(mH(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),gH("maxPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s},l=LU.runKernel("MaxPool",u,c);return a?bH(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sX=jj({maxPool3d_:function(t,e=[1,1,1],n,r,s,o="NDHWC"){const i=Wj(t,"x","maxPool3d");let a=i,u=!1;4===i.rank&&(u=!0,a=bH(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),rz(5===a.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`)),rz("NDHWC"===o,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),gH("maxPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o},f=LU.runKernel("MaxPool3D",c,l);return u?bH(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oX=jj({maxPoolWithArgmax_:function(t,e,n,r,s=!1){const o={x:Wj(t,"x","maxPoolWithArgmax")},i={filterSize:e,strides:n,pad:r,includeBatchInIndex:s},a=LU.runKernel("MaxPoolWithArgmax",o,i);return{result:a[0],indexes:a[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iX=jj({maximum_:function(t,e){let n=Wj(t,"a","maximum"),r=Wj(e,"b","maximum");[n,r]=kU(n,r),"bool"===n.dtype&&(n=MG(n,"int32"),r=MG(r,"int32")),fq(n.shape,r.shape);const s={a:n,b:r};return LU.runKernel("Maximum",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aX=jj({mean_:function(t,e=null,n=!1){const r={x:Wj(t,"x","mean")},s={axis:e,keepDims:n};return LU.runKernel("Mean",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uX(t,e="float32"){if("complex64"===e){const e=uX(t,"float32"),n=uX(t,"float32");return Gj(e,n)}const n=Cz(az(t),e);return LU.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cX(t,e="float32"){if("complex64"===e){const e=cX(t,"float32"),n=uX(t,"float32");return Gj(e,n)}const n=Az(az(t),e);return LU.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lX=jj({minimum_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=Wj(t,"a","minimum"),r=Wj(e,"b","minimum");[n,r]=kU(n,r),"bool"===n.dtype&&(n=MG(n,"int32"),r=MG(r,"int32")),fq(n.shape,r.shape);const s={a:n,b:r};return LU.runKernel("Minimum",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fX=jj({mirrorPad_:function(t,e,n){rz("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const r=Wj(t,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");rz(e.length===r.rank,(()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`));const s="reflect"===n?1:0;for(let t=0;t<r.rank;t++)rz(2===e[t].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),rz(e[t][0]>=0&&e[t][0]<=r.shape[t]-s&&e[t][1]>=0&&e[t][1]<=r.shape[t]-s,(()=>`Padding in dimension ${t} cannot be greater than or equal to ${r.shape[t]-s} or less than 0 for input of shape ${r.shape}`));const o={paddings:e,mode:n},i={x:r};return LU.runKernel("MirrorPad",i,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hX=jj({mod_:function(t,e){let n=Wj(t,"a","mod"),r=Wj(e,"b","mod");[n,r]=kU(n,r);const s={a:n,b:r};return LU.runKernel("Mod",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pX=jj({moments_:function(t,e=null,n=!1){const r=fz(e,(t=Wj(t,"x","moments")).shape),s=aX(t,r,n);let o=s.shape;n||(o=hK(s.shape,r));const i=bK(KK(MG(t,"float32"),bH(s,o)));return{mean:s,variance:aX(i,r,n)}}});const dX=jj({multiRNNCell_:function(t,e,n,r){const s=Wj(e,"data","multiRNNCell"),o=Uj(n,"c","multiRNNCell"),i=Uj(r,"h","multiRNNCell");let a=s;const u=[];for(let e=0;e<t.length;e++){const n=t[e](a,o[e],i[e]);u.push(n[0]),u.push(n[1]),a=n[1]}const c=[],l=[];for(let t=0;t<u.length;t+=2)c.push(u[t]),l.push(u[t+1]);return[c,l]}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mX=jj({multinomial_:function(t,e,n,r=!1){const s=Wj(t,"logits","multinomial"),o=s.size,i=s.rank;if(o<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${o}.`);if(i>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${i}`);n=n||Math.random();const a={logits:1===i?bH(s,[1,-1]):s},u={numSamples:e,seed:n,normalized:r},c=LU.runKernel("Multinomial",a,u);return 1===i?bH(c,[c.size]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yX=jj({notEqual_:function(t,e){let n=Wj(t,"a","notEqual","string_or_numeric"),r=Wj(e,"b","notEqual","string_or_numeric");[n,r]=kU(n,r),fq(n.shape,r.shape);const s={a:n,b:r};return LU.runKernel("NotEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gX=jj({onesLike_:function(t){const e={x:Wj(t,"x","onesLike")};return LU.runKernel("OnesLike",e)}});const bX=jj({outerProduct_:function(t,e){const n=Wj(t,"v1","outerProduct"),r=Wj(e,"v2","outerProduct");rz(1===n.rank&&1===r.rank,(()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`));const s=bH(n,[-1,1]),o=bH(r,[1,-1]);return ZG(s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wX=jj({pad_:function(t,e,n=0){const r=Wj(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:n},o={x:r};return LU.runKernel("PadV2",o,s)}});const vX=jj({pad1d_:function(t,e,n=0){return rz(2===e.length,(()=>"Invalid number of paddings. Must be length of 2.")),wX(t,[e],n)}});const xX=jj({pad2d_:function(t,e,n=0){return rz(2===e.length&&2===e[0].length&&2===e[1].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),wX(t,e,n)}});const NX=jj({pad3d_:function(t,e,n=0){return rz(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),wX(t,e,n)}});const $X=jj({pad4d_:function(t,e,n=0){return rz(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),wX(t,e,n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EX=jj({spaceToBatchND_:function(t,e,n){const r=Wj(t,"x","spaceToBatchND");rz(r.rank>=1+e.length,(()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`)),rz(n.length===e.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`)),rz(r.shape.reduce(((t,r,s)=>s>0&&s<=e.length?t&&(r+n[s-1][0]+n[s-1][1])%e[s-1]==0:t),!0),(()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`));const s={x:r},o={blockShape:e,paddings:n};return LU.runKernel("SpaceToBatchND",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SX=jj({pool_:function(t,e,n,r,s,o,i){null==s&&(s=[1,1]),null==o&&(o=1),0===r&&(r="valid");const a=Wj(t,"x","maxPool");let u=a,c=!1;3===a.rank&&(c=!0,u=bH(a,[1,a.shape[0],a.shape[1],a.shape[2]])),rz(mH(o,s),(()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${s}'`));const l=iH(u.shape,e,o,s,r),f=[l.dilationHeight,l.dilationWidth];let h;h="same"===r?function(t,e){const n=t.map(((t,n)=>t+(t-1)*(e[n]-1))),r=n.map((t=>t-1)),s=r.map((t=>Math.floor(t/2))),o=r.map(((t,e)=>t-s[e]));return r.map(((t,e)=>[s[e],o[e]]))}([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];const p=1===f[0]&&1===f[1],[d,m]=function(t,e,n){const r=n.map((t=>t[0])),s=n.map((t=>t[1])),o=t.concat(r,s),i=e.map(((t,e)=>(t-o[e]%t)%t)),a=s.map(((t,e)=>t+i[e])),u=e.map(((t,e)=>[r[e],a[e]])),c=e.map(((t,e)=>[0,i[e]]));return[u,c]}([l.inHeight,l.inWidth],f,h),y=p?r:"valid",g=p?u:EX(u,f,d),b=("avg"===n?()=>wH(g,e,o,y,i):()=>rX(g,e,o,y,i))(),w=p?b:_H(b,f,m);return c?bH(w,[w.shape[1],w.shape[2],w.shape[3]]):w}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _X=jj({prelu_:function(t,e){const n={x:Wj(t,"x","prelu"),alpha:Wj(e,"alpha","prelu")};return LU.runKernel("Prelu",n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TX=jj({prod_:function(t,e=null,n=!1){let r=Wj(t,"x","prod");"bool"===r.dtype&&(r=MG(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return LU.runKernel("Prod",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kX=jj({rand_:function(t,e,n){const r=az(t);let s=null;if(null==n||"float32"===n)s=new Float32Array(r);else if("int32"===n)s=new Int32Array(r);else{if("bool"!==n)throw new Error(`Unknown data type ${n}`);s=new Uint8Array(r)}for(let t=0;t<r;t++)s[t]=e();return LU.makeTensor(s,t,n)}});var AX={exports:{}};!function(t,e,n){function r(t){var e=this,n=function(){var t=4022871197,e=function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)};return e}();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}function s(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var n=new r(t),o=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.alea=o}(0,AX,!1);var CX={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor128=o}(0,CX,!1);var OX={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorwow=o}(0,OX,!1);var IX={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,s=e.i;return t=r[s],n=(t^=t>>>7)^t<<24,n^=(t=r[s+1&7])^t>>>10,n^=(t=r[s+3&7])^t>>>3,n^=(t=r[s+4&7])^t<<7,t=r[s+7&7],n^=(t^=t<<13)^t<<9,r[s]=n,e.i=s+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function s(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.x&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorshift7=o}(0,IX,!1);var MX={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,s=e.X,o=e.i;return e.w=r=r+1640531527|0,n=s[o+34&127],t=s[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=s[o]=n^t,e.i=o,n+(r^r>>>16)|0},function(t,e){var n,r,s,o,i,a=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),s=0,o=-32;o<u;++o)e&&(r^=e.charCodeAt((o+32)%e.length)),0===o&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(i=i+1640531527|0,s=0==(n=a[127&o]^=r+i)?s+1:0);for(s>=128&&(a[127&(e&&e.length||0)]=-1),s=127,o=512;o>0;--o)r=a[s+34&127],n=a[s=s+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,a[s]=r^n;t.w=i,t.X=a,t.i=s}(e,t)}function s(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.X&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor4096=o}(0,MX,!1);var RX={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,s=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^s,s=s-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^s,e.a=s-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.tychei=o}(0,RX,!1);var DX={exports:{}};!function(t){!function(e,n){var r,s=this,o=256,i=n.pow(o,6),a=n.pow(2,52),u=2*a,c=255;function l(t,c,l){var y=[],g=d(p((c=1==c?{entropy:!0}:c||{}).entropy?[t,m(e)]:null==t?function(){try{var t;return r&&(t=r.randomBytes)?t=t(o):(t=new Uint8Array(o),(s.crypto||s.msCrypto).getRandomValues(t)),m(t)}catch(t){var n=s.navigator,i=n&&n.plugins;return[+new Date,s,i,s.screen,m(e)]}}():t,3),y),b=new f(y),w=function(){for(var t=b.g(6),e=i,n=0;t<a;)t=(t+n)*o,e*=o,n=b.g(1);for(;t>=u;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,d(m(b.S),e),(c.pass||l||function(t,e,r,s){return s&&(s.S&&h(s,b),t.state=function(){return h(b,{})}),r?(n.random=t,e):t})(w,g,"global"in c?c.global:this==n,c.state)}function f(t){var e,n=t.length,r=this,s=0,i=r.i=r.j=0,a=r.S=[];for(n||(t=[n++]);s<o;)a[s]=s++;for(s=0;s<o;s++)a[s]=a[i=c&i+t[s%n]+(e=a[s])],a[i]=e;(r.g=function(t){for(var e,n=0,s=r.i,i=r.j,a=r.S;t--;)e=a[s=c&s+1],n=n*o+a[c&(a[s]=a[i=c&i+e])+(a[i]=e)];return r.i=s,r.j=i,n})(o)}function h(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function p(t,e){var n,r=[],s=typeof t;if(e&&"object"==s)for(n in t)try{r.push(p(t[n],e-1))}catch(t){}return r.length?r:"string"==s?t:t+"\0"}function d(t,e){for(var n,r=t+"",s=0;s<r.length;)e[c&s]=c&(n^=19*e[c&s])+r.charCodeAt(s++);return m(e)}function m(t){return String.fromCharCode.apply(0,t)}if(n.seedrandom=l,d(n.random(),e),t.exports){t.exports=l;try{r=require("crypto")}catch(t){}}}([],Math)}(DX);var FX=AX.exports,LX=CX.exports,PX=OX.exports,BX=IX.exports,VX=MX.exports,zX=RX.exports,WX=DX.exports;WX.alea=FX,WX.xor128=LX,WX.xorwow=PX,WX.xorshift7=BX,WX.xor4096=VX,WX.tychei=zX;var UX=WX;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jX{constructor(t,e,n,r,s){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const o=s||Math.random();this.random=UX.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const t=this.nextVal;return this.nextVal=NaN,t}let t,e,n=!1;for(;!n;){let r,s,o;do{r=2*this.random()-1,s=2*this.random()-1,o=r*r+s*s}while(o>=1||0===o);const i=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*r*i,e=this.mean+this.stdDev*s*i,this.truncated&&!this.isValidTruncated(t)||(n=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class GX{constructor(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;const s=r||Math.random();this.randu=UX.alea(s.toString()),this.randn=new jX(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,e,n,r,s,o;for(;;){do{r=this.randn.nextValue(),o=1+this.c*r}while(o<=0);if(o*=o*o,t=r*r,e=1-.331*t*t,n=.5*t+this.d*(1-o+Math.log(o)),s=this.randu(),s<e||Math.log(s)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(t){return"float32"===this.dtype?t:Math.round(t)}}class qX{constructor(t=0,e=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=UX.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HX=jj({randomGamma_:function(t,e,n=1,r="float32",s){if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error(`Unsupported data type ${r}`);const o=new GX(e,n,r,s),i=IG(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KX=jj({randomNormal_:function(t,e=0,n=1,r,s){if(null!=r&&"bool"===r)throw new Error(`Unsupported data type ${r}`);const o=new jX(e,n,r,!1,s),i=IG(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XX=jj({randomUniform_:function(t,e=0,n=1,r="float32",s){const o=IG(t,r),i=new qX(e,n,null,s);for(let t=0;t<o.values.length;t++)o.values[t]=i.nextValue();return o.toTensor()}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JX(t,e,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");const s={start:t,stop:e,step:n,dtype:r};return LU.runKernel("Range",{},s)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YX=jj({reciprocal_:function(t){const e={x:Wj(t,"x","reciprocal")};return LU.runKernel("Reciprocal",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZX=jj({relu_:function(t){const e={x:Wj(t,"x","relu")};return LU.runKernel("Relu",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QX=jj({relu6_:function(t){const e={x:Wj(t,"x","relu6")};return LU.runKernel("Relu6",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tJ=jj({reverse_:function(t,e){const n={x:Wj(t,"x","reverse")},r={dims:e};return LU.runKernel("Reverse",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eJ=jj({reverse1d_:function(t){const e=Wj(t,"x","reverse");return rz(1===e.rank,(()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`)),tJ(e,0)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nJ=jj({reverse2d_:function(t,e){const n=Wj(t,"x","reverse");return rz(2===n.rank,(()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`)),tJ(n,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rJ=jj({reverse3d_:function(t,e){const n=Wj(t,"x","reverse");return rz(3===n.rank,(()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`)),tJ(n,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sJ=jj({reverse4d_:function(t,e){const n=Wj(t,"x","reverse");return rz(4===n.rank,(()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`)),tJ(n,e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oJ=jj({round_:function(t){const e={x:Wj(t,"x","round")};return LU.runKernel("Round",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iJ=jj({rsqrt_:function(t){const e={x:Wj(t,"x","rsqrt","float32")};return LU.runKernel("Rsqrt",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aJ=jj({selu_:function(t){const e={x:Wj(t,"x","selu")};return LU.runKernel("Selu",e)}});const uJ=jj({separableConv2d_:function(t,e,n,r,s,o=[1,1],i="NHWC"){const a=Wj(t,"x","separableConv2d"),u=Wj(e,"depthwiseFilter","separableConv2d"),c=Wj(n,"pointwiseFilter","separableConv2d");let l=a,f=!1;if(3===a.rank&&(f=!0,l=bH(a,[1,a.shape[0],a.shape[1],a.shape[2]])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");rz(4===l.rank,(()=>`Error in separableConv2d: input must be rank 4, but got rank ${l.rank}.`)),rz(4===u.rank,(()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`)),rz(4===c.rank,(()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`)),rz(1===c.shape[0],(()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`)),rz(1===c.shape[1],(()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`));const h=u.shape[2],p=u.shape[3];rz(c.shape[2]===h*p,(()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*p}, but got ${c.shape[2]}.`));const d=QH(l,u,r,s,i,o),m=VH(d,c,1,"valid",i);return f?bH(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cJ=async function(t,e){const n=Wj(t,"x","setdiff1d"),r=Wj(e,"y","setdiff1d");rz(n.dtype===r.dtype,(()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`)),rz(1===n.rank,(()=>`x should be 1D tensor, but got x (${n.shape}).`)),rz(1===r.rank,(()=>`y should be 1D tensor, but got y (${r.shape}).`));const s=await n.data(),o=await r.data(),i=new Set(o);let a=0;for(let t=0;t<s.length;t++)i.has(s[t])||a++;const u=new yU([a],n.dtype),c=new yU([a],"int32");for(let t=0,e=0;t<s.length;t++)i.has(s[t])||(u.values[e]=s[t],c.values[e]=t,e++);return[u.toTensor(),c.toTensor()]};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lJ=jj({sign_:function(t){const e={x:Wj(t,"x","sign")};return LU.runKernel("Sign",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fJ=jj({sin_:function(t){const e={x:Wj(t,"x","sin","float32")};return LU.runKernel("Sin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hJ=jj({sinh_:function(t){const e={x:Wj(t,"x","sinh")};return LU.runKernel("Sinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pJ=jj({slice1d_:function(t,e,n){const r=Wj(t,"x","slice1d");return rz(1===r.rank,(()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`)),$H(r,[e],[n])}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dJ=jj({slice2d_:function(t,e,n){const r=Wj(t,"x","slice2d");return rz(2===r.rank,(()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`)),$H(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mJ=jj({slice3d_:function(t,e,n){const r=Wj(t,"x","slice3d");return rz(3===r.rank,(()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`)),$H(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yJ=jj({slice4d_:function(t,e,n){const r=Wj(t,"x","slice4d");return rz(4===r.rank,(()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`)),$H(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gJ=jj({softmax_:function(t,e=-1){const n=Wj(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const r={logits:n},s={dim:e};return LU.runKernel("Softmax",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bJ=jj({fft_:function(t){rz("complex64"===t.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`));const e={input:t};return LU.runKernel("FFT",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wJ=jj({ifft_:function(t){rz("complex64"===t.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`));const e={input:t};return LU.runKernel("IFFT",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vJ=jj({irfft_:function(t){const e=t.shape[t.shape.length-1],n=t.size/e;let r;if(e<=2){const s=bH(t,[n,e]);r=wJ(s)}else{const s=[n,2*(e-1)],o=bH(oq(t),[n,e]),i=bH(rq(t),[n,e]),a=tJ($H(o,[0,1],[n,e-2]),1),u=qq(tJ($H(i,[0,1],[n,e-2]),1),yK(-1)),c=xH([o,a],1),l=xH([i,u],1),f=bH(Gj(c,l),[s[0],s[1]]);r=wJ(f)}if(r=oq(r),3===t.rank&&0!==t.shape[0]){const e=r,n=t.shape[0];r=bH(r,[n,r.shape[0]/n,r.shape[1]]),e.dispose()}return r}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xJ=jj({split_:function(t,e,n=0){const r={x:Wj(t,"x","split")},s={numOrSizeSplits:e,axis:n};return LU.runKernel("SplitV",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NJ=jj({rfft_:function(t,e){rz("float32"===t.dtype,(()=>`The dtype for rfft() must be real value but got ${t.dtype}`));let n=t.shape[t.shape.length-1];const r=t.size/n;let s;if(null!=e&&e<n){const r=t.shape.map((t=>0)),o=t.shape.map((t=>t));o[t.shape.length-1]=e,s=$H(t,r,o),n=e}else if(null!=e&&e>n){const r=t.shape.map((t=>t));r[t.shape.length-1]=e-n,s=xH([t,uX(r)],t.shape.length-1),n=e}else s=t;const o=sK(s),i=bH(Gj(s,o),[r,n]),a=bJ(i),u=Math.floor(n/2)+1,c=oq(a),l=rq(a),f=xJ(c,[u,n-u],c.shape.length-1),h=xJ(l,[u,n-u],l.shape.length-1),p=s.shape.slice();return p[s.shape.length-1]=u,bH(Gj(f[0],h[0]),p)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $J=jj({squaredDifference_:function(t,e){let n=Wj(t,"a","squaredDifference"),r=Wj(e,"b","squaredDifference");[n,r]=kU(n,r),fq(n.shape,r.shape);const s={a:n,b:r};return LU.runKernel("SquaredDifference",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EJ=jj({squeeze_:function(t,e){const n=Wj(t,"x","squeeze");return bH(n,hz(n.shape,e).newShape)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SJ=jj({stack_:function(t,e=0){const n=Uj(t,"tensors","stack","string_or_numeric");rz(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&rz(e<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const r=n,s={axis:e};return LU.runKernel("Pack",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _J=jj({step_:function(t,e=0){const n={x:Wj(t,"x","step")},r={alpha:e};return LU.runKernel("Step",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TJ=jj({stridedSlice_:function(t,e,n,r,s=0,o=0,i=0,a=0,u=0){const c={x:Wj(t,"x","stridedSlice","string_or_numeric")},l={begin:e,end:n,strides:r,beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};return LU.runKernel("StridedSlice",c,l)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kJ=jj({tan_:function(t){const e={x:Wj(t,"x","tan","float32")};return LU.runKernel("Tan",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AJ(t,e){oz(t);const n=Bj(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return qj(t,null,n,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CJ(t,e,n){if(oz(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");const r=Bj(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return qj(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OJ=jj({topk_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=1,n=!0){const r=Wj(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const s=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const o={x:r},i={k:e,sorted:n},[a,u]=LU.runKernel("TopK",o,i);return{values:a,indices:u}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IJ=jj({truncatedNormal_:function(t,e=0,n=1,r,s){if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const o=new jX(e,n,r,!0,s),i=IG(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MJ=jj({unique_:function(t,e=0){const n=Wj(t,"x","unique","string_or_numeric");rz(n.rank>0,(()=>"The input tensor must be at least 1D"));const r={x:n},s={axis:e},[o,i]=LU.runKernel("Unique",r,s);return{values:o,indices:i}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RJ=jj({unsortedSegmentSum_:function(t,e,n){const r=Wj(t,"x","unsortedSegmentSum"),s=Wj(e,"segmentIds","unsortedSegmentSum","int32");rz(cz(n),(()=>"numSegments must be of dtype int"));const o={x:r,segmentIds:s},i={numSegments:n};return LU.runKernel("UnsortedSegmentSum",o,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DJ=jj({unstack_:function(t,e=0){const n=Wj(t,"x","unstack","string_or_numeric");rz(e>=-n.shape.length&&e<n.shape.length,(()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`));const r={value:n},s={axis:e};return LU.runKernel("Unpack",r,s)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FJ(t,e){return eX(t,e,"right")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function LJ(t,e){const n=[];for(let t=0;t<e.length;t++)e[t]&&n.push(t);const r=IG(t,"int32"),s=IG([n.length,t.length],"int32");for(let e=0;e<n.length;e++){const o=r.indexToLoc(n[e]),i=e*t.length;s.values.set(o,i)}return s.toTensor()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PJ=async function(t){const e=Wj(t,"condition","whereAsync","bool"),n=await e.data(),r=LJ(e.shape,n);return t!==e&&e.dispose(),r};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BJ=async function(t,e,n){const r=Wj(t,"tensor","boolMask"),s=Wj(e,"mask","boolMask","bool"),o=null==n?0:n,i=s.rank,a=r.shape;rz(i>0,(()=>"mask cannot be scalar")),sz(a.slice(o,o+i),s.shape,"mask's shape must match the first K dimensions of tensor's shape,");let u=1;for(let t=o;t<o+i;t++)u*=a[t];const c=a.slice(0,o).concat([u],a.slice(o+i)),l=bH(r,c),f=bH(s,[-1]),h=await PJ(f),p=EJ(h,[1]),d=CK(l,p,o);return t!==r&&r.dispose(),e!==s&&s.dispose(),p.dispose(),l.dispose(),f.dispose(),h.dispose(),d};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VJ=jj({movingAverage_:function(t,e,n,r,s=!0){const o=Wj(t,"v","movingAverage"),i=Wj(e,"x","movingAverage"),a=Wj(n,"decay","movingAverage");AU(o,i),rz(uz(o.shape,i.shape),(()=>"Shape mismatch in v and x"));const u=yK(1),c=KK(u,a);let l=qq(KK(i,o),c);if(s){rz(null!=r,(()=>"When using zeroDebias: true, step is required."));const t=Wj(r,"step","movingAverage");l=Gq(l,KK(u,mK(a,t)))}return Uq(o,l)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zJ=jj({scatterND_:function(t,e,n){const r=Wj(t,"indices","scatterND","int32"),s=Wj(e,"updates","scatterND");Nq(s,r,n);const o={indices:r,updates:s},i={shape:n};return LU.runKernel("ScatterNd",o,i)}});const WJ=jj({sparseToDense_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=0){const s=Wj(t,"sparseIndices","sparseToDense","int32"),o=Wj(e,"sparseValues","sparseToDense","string_or_numeric"),i=Wj(r,"defaultValue","sparseToDense",o.dtype);!function(t,e,n,r){if("int32"!==t.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const s=t.rank>0?t.shape[0]:1,o=t.rank>1?t.shape[1]:1;if(n.length!==o)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${o}.`);const i=e.size;if(0!==e.rank&&(1!==e.rank||i!==s))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${s}]`);if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(s,o,n,i);const a={sparseIndices:s,sparseValues:o,defaultValue:i},u={outputShape:n};return LU.runKernel("SparseToDense",a,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UJ=jj({gatherND_:function(t,e){const n=Wj(e,"indices","gatherND","int32"),r={params:Wj(t,"x","gatherND","string_or_numeric"),indices:n};return LU.runKernel("GatherNd",r)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jJ=jj({dropout_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const s=Wj(t,"x","dropout");if(rz("float32"===s.dtype,(()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${s.dtype} tensor instead.`)),rz(e>=0&&e<1,(()=>`rate must be a float in the range [0, 1), but got ${e}.`)),0===e)return t instanceof wU?s.clone():s;const o=function(t,e){if(null==e)return t.shape.slice();if(uz(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let r=0;r<t.shape.length;r++)null==e[r]&&null!=t.shape[r]?n.push(t.shape[r]):n.push(e[r]);return n}return e}(s,n),i=1-e,a=Gq(AK(Uq(XX(o,0,1,"float32",r),i)),i);return qq(s,a)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GJ(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function qJ(t,e,n){const r=1-t%2,s=new Float32Array(t);for(let o=0;o<t;++o){const i=2*Math.PI*o/(t+r-1);s[o]=e-n*Math.cos(i)}return AJ(s,"float32")}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HJ=async function(t,e,n=1){const r=Wj(t,"predictions","inTopK"),s=Wj(e,"targets","inTopK");rz(r.rank>1,(()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`)),rz(r.rank-1===s.rank,(()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${s.rank}`)),sz(r.shape.slice(0,r.shape.length-1),s.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const o=r.shape[r.shape.length-1];rz(n>0&&n<=o,(()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${o}), but got ${n}`));const i=await r.data(),a=await s.data(),[u,c]=[i.length/o,o],l=pz("bool",u);for(let t=0;t<u;t++){const e=t*c,r=i.subarray(e,e+c),s=[];for(let t=0;t<r.length;t++)s.push({value:r[t],index:t});s.sort(((t,e)=>e.value-t.value)),l[t]=0;for(let e=0;e<n;e++)if(s[e].index===a[t]){l[t]=1;break}}return t!==r&&r.dispose(),e!==s&&s.dispose(),Hj(l,s.shape,"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KJ=jj({conv2DBackpropFilter_:function(t,e,n,r,s,o="NHWC",i){let a=t;3===t.rank&&(a=bH(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=bH(e,[1,e.shape[0],e.shape[1],e.shape[2]])),rz(4===a.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`)),rz(4===u.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`)),rz(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const c="NHWC"===o?a.shape[3]:a.shape[1],l="NHWC"===o?u.shape[3]:u.shape[1];rz(c===n[2],(()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`)),rz(l===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${l}) must match output depth for filter (${n[3]}).`)),gH("conv2dDerFilter",s,i);const f={x:a,dy:u},h={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,filterShape:n};return LU.runKernel("Conv2DBackpropFilter",f,h)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XJ(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return qq(t,_J(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function JJ(t,e){let n=e;const r=lq(t.shape,e.shape);return r.length>0&&(n=wK(n,r)),bH(n,t.shape)}function YJ(t,e,n,r){if("linear"===e)return t;if("relu"===e)return ZX(t);if("elu"===e)return uK(t);if("relu6"===e)return QX(t);if("prelu"===e)return _X(t,n);if("leakyrelu"===e)return FK(t,r);if("sigmoid"===e)return NH(t);throw new Error(`Unknown fused activation ${e}.`)}const ZJ=(t,e)=>!(t>0)||"linear"===e;
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QJ=jj({fusedConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(u=u||"linear",!1===ZJ(LU.state.gradientDepth,u)){rz("NHWC"===s,(()=>`Error in fused conv2d: got dataFormat of ${s} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`));let f=VH(t,e,n,r,s,o,i);return null!=a&&(f=Uq(f,a)),YJ(f,u,c,l)}const f=Wj(t,"x","conv2d","float32"),h=Wj(e,"filter","conv2d","float32");let p=f,d=!1;3===f.rank&&(d=!0,p=bH(f,[1,f.shape[0],f.shape[1],f.shape[2]])),rz(4===p.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`)),rz(4===h.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`)),gH("fused conv2d",r,i);const m="NHWC"===s?p.shape[3]:p.shape[1];rz(h.shape[2]===m,(()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${h.shape[2]}.`)),rz(mH(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const y=aH(p.shape,h.shape,n,o,r,i);let g,b;if(null!=a&&(g=Wj(a,"bias","fused conv2d"),[g]=kU(g,f),"NHWC"===s?fq(y.outShape,g.shape):(rz(g.shape.length<=1,(()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${g.shape.length}.`)),rz(0===g.shape.length||g.shape[0]===y.outChannels||1===g.shape[0],(()=>`Error in fused conv2d: bias shape (${g.shape}) is not compatible with the number of output channels (${y.outChannels})`)))),null!=c){const t=c.shape;if(rz(t.length<=1||3===t.length,(()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${t.length}.`)),1===t.length)rz(1===t[0]||t[0]===y.outChannels,(()=>`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the number of output channels (${y.outChannels}).`));else if(3===t.length)try{fq(t,y.outShape)}catch(e){const n=`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the output shape of the conv2d (${y.outShape}).`;throw Error(n)}b=Wj(c,"prelu weights","fused conv2d")}const w=(t,e)=>{rz("NHWC"===s,(()=>`Error in gradient of fused conv2D: got dataFormat of ${s} but only NHWC is currently supported.`));const[i,a,c,l]=e,f=XJ(t,c,u);rz(dH(o),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`));const h=[WH(a.shape,f,i,n,r),KJ(a,f,i.shape,n,r)];if(null!=l){const t=JJ(l,f);h.push(t)}return h},v={x:p,filter:h,bias:g,preluActivationWeights:b},x={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=jK(((t,e,n)=>{let r=LU.runKernel("FusedConv2D",v,x);return n([e,t,r]),d&&(r=bH(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:w}}));return t(p,h)}{const t=jK(((t,e,n,r)=>{let s=LU.runKernel("FusedConv2D",v,x);return r([e,t,s,n]),d&&(s=bH(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:w}}));return t(p,h,g)}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tY=jj({depthwiseConv2dNativeBackpropFilter_:function(t,e,n,r,s,o=[1,1],i){let a=t;3===t.rank&&(a=bH(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=bH(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:u},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,filterShape:n};return LU.runKernel("DepthwiseConv2dNativeBackpropFilter",c,l)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eY=jj({depthwiseConv2dNativeBackpropInput_:function(t,e,n,r,s,o=[1,1],i){let a=e,u=!1;3===e.rank&&(u=!0,a=bH(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,inputShape:t},f=LU.runKernel("DepthwiseConv2dNativeBackpropInput",c,l);return u?bH(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nY=jj({fusedDepthwiseConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(!1===ZJ(LU.state.gradientDepth,u)){let f=QH(t,e,n,r,s,o,i);return null!=a&&(f=Uq(f,a)),YJ(f,u,c,l)}const f=Wj(t,"x","depthwiseConv2d","float32"),h=Wj(e,"filter","depthwiseConv2d","float32");let p=f,d=!1;3===f.rank&&(d=!0,p=bH(f,[1,f.shape[0],f.shape[1],f.shape[2]])),rz(4===p.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`)),rz(4===h.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`)),rz(p.shape[3]===h.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${p.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`)),null==o&&(o=[1,1]),rz(mH(n,o),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),gH("fused depthwiseConv2d",r,i);const m=aH(p.shape,h.shape,n,o,r,i,!0);let y,g;null!=a&&(y=Wj(a,"bias","fused conv2d"),[y]=kU(y,f),fq(m.outShape,y.shape)),null!=c&&(g=Wj(c,"prelu weights","fused depthwiseConv2d"));const b=(t,e)=>{rz(dH(o),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`));const[s,a,c,l]=e,f=XJ(t,c,u),h=eY(a.shape,f,s,n,r,o,i),p=tY(a,f,s.shape,n,r,o,i);if(null!=l){return[h,p,JJ(y,f)]}return[h,p]},w={x:p,filter:h,bias:y,preluActivationWeights:g},v={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=jK(((t,e,n)=>{let r=LU.runKernel("FusedDepthwiseConv2D",w,v);return n([e,t,r]),d&&(r=bH(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}}));return t(p,h)}{const t=jK(((t,e,n,r)=>{let s=LU.runKernel("FusedDepthwiseConv2D",w,v);return r([e,t,s,n]),d&&(s=bH(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:b}}));return t(p,h,y)}}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rY=jj({fusedMatMul_:function({a:t,b:e,transposeA:n=!1,transposeB:r=!1,bias:s,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a}){if(!1===ZJ(LU.state.gradientDepth,o)){let u=ZG(t,e,n,r);return null!=s&&(u=Uq(u,s)),YJ(u,o,i,a)}let u=Wj(t,"a","fused matMul"),c=Wj(e,"b","fused matMul");[u,c]=kU(u,c);const l=n?u.shape[u.rank-2]:u.shape[u.rank-1],f=r?c.shape[c.rank-1]:c.shape[c.rank-2],h=n?u.shape[u.rank-1]:u.shape[u.rank-2],p=r?c.shape[c.rank-2]:c.shape[c.rank-1],d=u.shape.slice(0,-2),m=c.shape.slice(0,-2),y=az(d),g=az(m);rz(l===f,(()=>`Error in fused matMul: inner shapes (${l}) and (${f}) of Tensors with shapes ${u.shape} and ${c.shape} and transposeA=${n} and transposeB=${r} must match.`));const b=fq(u.shape.slice(0,-2),c.shape.slice(0,-2)).concat([h,p]),w=bH(u,n?[y,l,h]:[y,h,l]),v=bH(c,r?[g,p,f]:[g,f,p]);let x,N;null!=s&&(x=Wj(s,"bias","fused matMul"),[x]=kU(x,u),fq(b,x.shape)),null!=i&&(N=Wj(i,"prelu weights","fused matMul"));const $=(t,e)=>{const[i,a,u,c]=e,l=XJ(bH(t,u.shape),u,o);let f,h;if(n||r?!n&&r?(f=ZG(l,a,!1,!1),h=ZG(l,i,!0,!1)):n&&!r?(f=ZG(a,l,!1,!0),h=ZG(i,l,!1,!1)):(f=ZG(a,l,!0,!0),h=ZG(l,i,!0,!0)):(f=ZG(l,a,!1,!0),h=ZG(i,l,!0,!1)),null!=s){return[f,h,JJ(c,l)]}return[f,h]},E={a:w,b:v,bias:x,preluActivationWeights:N},S={transposeA:n,transposeB:r,activation:o,leakyreluAlpha:a};if(null==s){const t=jK(((t,e,n)=>{const r=LU.runKernel("_FusedMatMul",E,S);return n([t,e,r]),{value:bH(r,b),gradFunc:$}}));return t(w,v)}{const t=jK(((t,e,n,r)=>{const s=LU.runKernel("_FusedMatMul",E,S);return r([t,e,s,n]),{value:bH(s,b),gradFunc:$}}));return t(w,v,x)}}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var sY=Object.freeze({__proto__:null,conv2d:QJ,depthwiseConv2d:nY,matMul:rY});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oY=jj({hammingWindow_:function(t){return qJ(t,.54,.46)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iY=jj({hannWindow_:function(t){return qJ(t,.5,.5)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aY=jj({frame_:function(t,e,n,r=!1,s=0){let o=0;const i=[];for(;o+e<=t.size;)i.push($H(t,o,e)),o+=n;if(r)for(;o<t.size;){const r=o+e-t.size,a=xH([$H(t,o,e-r),kK([r],s)]);i.push(a),o+=n}return 0===i.length?CJ([],[0,e]):bH(xH(i),[i.length,e])}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uY=jj({stft_:function(t,e,n,r,s=iY){null==r&&(r=GJ(e));const o=aY(t,e,n),i=qq(o,s(e));return NJ(i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cY=jj({cropAndResize_:function(t,e,n,r,s="bilinear",o=0){const i=Wj(t,"image","cropAndResize"),a=Wj(e,"boxes","cropAndResize","float32"),u=Wj(n,"boxInd","cropAndResize","int32"),c=a.shape[0];rz(4===i.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`)),rz(2===a.rank&&4===a.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`)),rz(1===u.rank&&u.shape[0]===c,(()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`)),rz(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),rz(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),rz("bilinear"===s||"nearest"===s,(()=>`method must be bilinear or nearest, but was ${s}`));const l={image:i,boxes:a,boxInd:u},f={method:s,extrapolationValue:o,cropSize:r};return LU.runKernel("CropAndResize",l,f)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lY=jj({flipLeftRight_:function(t){const e=Wj(t,"image","flipLeftRight","float32");rz(4===e.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`));const n={image:e};return LU.runKernel("FlipLeftRight",n,{})}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fY=jj({grayscaleToRGB_:function(t){const e=Wj(t,"image","grayscaleToRGB"),n=e.rank-1,r=e.shape[n];rz(e.rank>=2,(()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`)),rz(1===r,(()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`));const s=new Array(e.rank);return s.fill(1,0,n),s[n]=3,_K(e,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hY=jj({rotateWithOffset_:function(t,e,n=0,r=.5){const s=Wj(t,"image","rotateWithOffset","float32");rz(4===s.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${s.rank}.`));const o={image:s},i={radians:e,fillValue:n,center:r};return LU.runKernel("RotateWithOffset",o,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pY(t,e,n,r,s,o){null==r&&(r=.5),null==s&&(s=Number.NEGATIVE_INFINITY),null==o&&(o=0);const i=t.shape[0];return n=Math.min(n,i),rz(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),rz(2===t.rank,(()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`)),rz(4===t.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`)),rz(1===e.rank,(()=>"scores must be a 1D tensor")),rz(e.shape[0]===i,(()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`)),rz(0<=o&&o<=1,(()=>`softNmsSigma must be in [0, 1], but was '${o}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:s,softNmsSigma:o}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dY=jj({nonMaxSuppression_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const o=Wj(t,"boxes","nonMaxSuppression","float32"),i=Wj(e,"scores","nonMaxSuppression","float32"),a=pY(o,i,n,r,s),u={maxOutputSize:n=a.maxOutputSize,iouThreshold:r=a.iouThreshold,scoreThreshold:s=a.scoreThreshold};return LU.runKernel("NonMaxSuppressionV3",{boxes:o,scores:i},u)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mY(t,e,n){const r=function(t,e,n){return function(t,e,n){let r=0,s=t.length,o=0,i=!1;for(;r<s;){o=r+(s-r>>>1);const a=n(e,t[o]);a>0?r=o+1:(s=o,i=!a)}return i?r:-r-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e,n||yY)}(t,e,n),s=r<0?-(r+1):r;t.splice(s,0,e)}function yY(t,e){return t>e?1:t<e?-1:0}function gY(t,e,n,r,s){return vY(t,e,n,r,s,0)}function bY(t,e,n,r,s,o){return vY(t,e,n,r,s,0,!1,o,!0)}function wY(t,e,n,r,s,o){return vY(t,e,n,r,s,o,!0)}function vY(t,e,n,r,s,o,i=!1,a=!1,u=!1){const c=[];for(let t=0;t<e.length;t++)e[t]>s&&c.push({score:e[t],boxIndex:t,suppressBeginIndex:0});c.sort($Y);const l=o>0?-.5/o:0,f=[],h=[];for(;f.length<n&&c.length>0;){const e=c.pop(),{score:n,boxIndex:o,suppressBeginIndex:i}=e;if(n<s)break;let a=!1;for(let n=f.length-1;n>=i;--n){const i=xY(t,o,f[n]);if(i>=r){a=!0;break}if(e.score=e.score*NY(r,l,i),e.score<=s)break}e.suppressBeginIndex=f.length,a||(e.score===n?(f.push(o),h.push(e.score)):e.score>s&&mY(c,e,$Y))}const p=f.length,d=n-p;a&&d>0&&(f.push(...new Array(d).fill(0)),h.push(...new Array(d).fill(0)));const m={selectedIndices:f};return i&&(m.selectedScores=h),u&&(m.validOutputs=p),m}function xY(t,e,n){const r=t.subarray(4*e,4*e+4),s=t.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(s[0],s[2]),l=Math.min(s[1],s[3]),f=Math.max(s[0],s[2]),h=Math.max(s[1],s[3]),p=(a-o)*(u-i),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;const m=Math.max(o,c),y=Math.max(i,l),g=Math.min(a,f),b=Math.min(u,h),w=Math.max(g-m,0)*Math.max(b-y,0);return w/(p+d-w)}function NY(t,e,n){const r=Math.exp(e*n*n);return n<=t?r:0}function $Y(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EY=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const o=Wj(t,"boxes","nonMaxSuppressionAsync"),i=Wj(e,"scores","nonMaxSuppressionAsync"),a=pY(o,i,n,r,s);n=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;const u=await Promise.all([o.data(),i.data()]),c=u[0],l=u[1],{selectedIndices:f}=gY(c,l,n,r,s);return o!==t&&o.dispose(),i!==e&&i.dispose(),AJ(f,"int32")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SY=jj({nonMaxSuppressionWithScore_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=Wj(t,"boxes","nonMaxSuppression"),a=Wj(e,"scores","nonMaxSuppression"),u=pY(i,a,n,r,s,o),c={boxes:i,scores:a},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:s=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},f=LU.runKernel("NonMaxSuppressionV5",c,l);return{selectedIndices:f[0],selectedScores:f[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Y=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=Wj(t,"boxes","nonMaxSuppressionAsync"),a=Wj(e,"scores","nonMaxSuppressionAsync"),u=pY(i,a,n,r,s,o);n=u.maxOutputSize,r=u.iouThreshold,s=u.scoreThreshold,o=u.softNmsSigma;const c=await Promise.all([i.data(),a.data()]),l=c[0],f=c[1],{selectedIndices:h,selectedScores:p}=wY(l,f,n,r,s,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:AJ(h,"int32"),selectedScores:AJ(p)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TY=jj({nonMaxSuppressionPadded_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=Wj(t,"boxes","nonMaxSuppression"),a=Wj(e,"scores","nonMaxSuppression"),u=pY(i,a,n,r,s,null),c={boxes:i,scores:a},l={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:o},f=LU.runKernel("NonMaxSuppressionV4",c,l);return{selectedIndices:f[0],validOutputs:f[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kY=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=Wj(t,"boxes","nonMaxSuppressionAsync"),a=Wj(e,"scores","nonMaxSuppressionAsync"),u=pY(i,a,n,r,s,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[h,p]=await Promise.all([i.data(),a.data()]),{selectedIndices:d,validOutputs:m}=bY(h,p,c,l,f,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:AJ(d,"int32"),validOutputs:yK(m,"int32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AY=jj({resizeBilinear_:function(t,e,n=!1,r=!1){const s=Wj(t,"images","resizeBilinear");rz(3===s.rank||4===s.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${s.rank}.`)),rz(2===e.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`)),rz(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=bH(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=LU.runKernel("ResizeBilinear",a,u);return i?bH(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CY=jj({resizeNearestNeighbor_:function(t,e,n=!1,r=!1){const s=Wj(t,"images","resizeNearestNeighbor");rz(3===s.rank||4===s.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${s.rank}.`)),rz(2===e.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`)),rz("float32"===s.dtype||"int32"===s.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),rz(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=bH(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=LU.runKernel("ResizeNearestNeighbor",a,u);return i?bH(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OY=jj({threshold_:function(t,e="binary",n=!1,r=.5){const s=Wj(t,"image","threshold"),o=s.shape[0]*s.shape[1];let i,a,u,c,l=qq(AJ([r]),255);if(rz(3===s.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${s.rank}.`)),rz(3===s.shape[2]||1===s.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${s.shape[2]}.`)),rz("int32"===s.dtype||"float32"===s.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${s.dtype}.`)),rz("otsu"===e||"binary"===e,(()=>`Method must be binary or otsu, but was ${e}`)),3===s.shape[2]){[i,a,u]=xJ(s,[1,1,1],-1);const t=qq(i,.2989),e=qq(a,.587),n=qq(u,.114);c=Uq(Uq(t,e),n)}else c=t;if("otsu"===e){l=function(t,e){let n,r,s,o,i,a,u=AJ([-1]),c=AJ([0]),l=AJ([0]);for(let f=0;f<t.size-1;f++){n=$H(t,0,f+1),r=$H(t,f+1),i=Gq(wK(n),e),a=Gq(wK(r),e);const h=wK(qq(n,JX(0,n.size)));s=Gq(h,wK(n));const p=kK(r.shape,n.size),d=Uq(JX(0,r.size),p),m=qq(r,d);o=Gq(wK(m),wK(r));const y=KK(s,o),g=KK(s,o),b=qq(i,a);l=qq(qq(b,y),g);const w=OK(l,c);c=rK(w,l,c),u=rK(w,AJ([f]),u)}return u}(OH(MG(oJ(c),"int32"),Hj([]),256),o)}const f=n?PK(c,l):OK(c,l);return MG(qq(f,255),"int32")}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IY=jj({transform_:function(t,e,n="nearest",r="constant",s=0,o){const i=Wj(t,"image","transform","float32"),a=Wj(e,"transforms","transform","float32");rz(4===i.rank,(()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`)),rz(2===a.rank&&(a.shape[0]===i.shape[0]||1===a.shape[0])&&8===a.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),rz(null==o||2===o.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`));const u={image:i,transforms:a},c={interpolation:n,fillMode:r,fillValue:s,outputShape:o};return LU.runKernel("Transform",u,c)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MY=jj({bandPart_:function(t,e,n){rz(e%1==0,(()=>`bandPart(): numLower must be an integer, got ${e}.`)),rz(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`));const r=Wj(t,"a","bandPart");rz(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));const s=r.shape,[o,i]=r.shape.slice(-2);if(!(e<=o))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`);if(!(n<=i))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${i}).`);e<0&&(e=o),n<0&&(n=i);const a=bH(JX(0,o,1,"int32"),[-1,1]),u=JX(0,i,1,"int32"),c=KK(a,u),l=YK(PK(c,yK(+e,"int32")),IK(c,yK(-n,"int32"))),f=uX([o,i],r.dtype);return bH(SJ(DJ(bH(r,[-1,o,i])).map((t=>rK(l,t,f)))),s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RY=jj({gramSchmidt_:function(t){let e;if(Array.isArray(t)){e=!1,rz(null!=t&&t.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=t[0].shape[0];for(let e=1;e<t.length;++e)rz(t[e].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[e].shape[0]} vs. ${n})`))}else e=!0,t=xJ(t,t.shape[0],0).map((t=>EJ(t,[0])));rz(t.length<=t[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`));const n=[],r=t;for(let e=0;e<t.length;++e)n.push(LU.tidy((()=>{let t=r[e];if(e>0)for(let r=0;r<e;++r){const e=qq(wK(qq(n[r],t)),n[r]);t=KK(t,e)}return Gq(t,xK(t,"euclidean"))})));return e?SJ(n,0):n}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DY(t,e=!1){return LU.tidy((()=>{rz(2===t.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`));const n=t.shape[0],r=t.shape[1];let s=TK(n),o=RG(t);const i=CJ([[1]],[1,1]);let a=RG(i);const u=n>=r?r:n;for(let t=0;t<u;++t){const e=o,u=a,c=s;[a,o,s]=LU.tidy((()=>{const e=$H(o,[t,t],[n-t,1]),u=xK(e),c=$H(o,[t,t],[1,1]),l=rK(OK(c,0),CJ([[-1]]),CJ([[1]])),f=KK(c,qq(l,u)),h=Gq(e,f);a=1===h.shape[0]?RG(i):xH([i,$H(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);const p=sq(Gq(ZG(l,f),u)),d=$H(o,[t,0],[n-t,r]),m=qq(p,a),y=iq(a);if(0===t)o=KK(d,ZG(m,ZG(y,d)));else{const e=KK(d,ZG(m,ZG(y,d)));o=xH([$H(o,[0,0],[t,r]),e],0)}const g=iq(m),b=$H(s,[0,t],[n,s.shape[1]-t]);if(0===t)s=KK(b,ZG(ZG(b,a),g));else{const e=KK(b,ZG(ZG(b,a),g));s=xH([$H(s,[0,0],[n,t]),e],1)}return[a,o,s]})),eq([e,u,c])}return!e&&n>r&&(s=$H(s,[0,0],[n,r]),o=$H(o,[0,0],[r,r])),[s,o]}))}const FY=jj({qr_:function(t,e=!1){if(rz(t.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`)),2===t.rank)return DY(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce(((t,e)=>t*e)),r=DJ(bH(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),s=[],o=[];r.forEach((t=>{const[n,r]=DY(t,e);s.push(n),o.push(r)}));return[bH(SJ(s,0),t.shape),bH(SJ(o,0),t.shape)]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var LY;!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(LY||(LY={}));const PY=jj({computeWeightedLoss_:function(t,e,n=LY.SUM_BY_NONZERO_WEIGHTS){const r=Wj(t,"losses","computeWeightedLoss");let s=null;null!=e&&(s=Wj(e,"weights","computeWeightedLoss"));const o=null==s?r:qq(r,s);if(n===LY.NONE)return o;if(n===LY.SUM)return wK(o);if(n===LY.MEAN){if(null==s)return aX(o);{const t=r.size/s.size,e=Gq(wK(o),wK(s));return t>1?Gq(e,yK(t)):e}}if(n===LY.SUM_BY_NONZERO_WEIGHTS){if(null==s)return Gq(wK(o),yK(r.size));{const t=qq(s,cX(r.shape)),e=MG(wK(yX(t,yK(0))),"float32");return Gq(wK(o),e)}}throw Error(`Unknown reduction: ${n}`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BY=jj({absoluteDifference_:function(t,e,n,r=LY.SUM_BY_NONZERO_WEIGHTS){const s=Wj(t,"labels","absoluteDifference"),o=Wj(e,"predictions","absoluteDifference");let i=null;null!=n&&(i=Wj(n,"weights","absoluteDifference")),sz(s.shape,o.shape,"Error in absoluteDifference: ");const a=Hq(KK(s,o));return PY(a,i,r)}});const VY=jj({cosineDistance_:function(t,e,n,r,s=LY.SUM_BY_NONZERO_WEIGHTS){const o=Wj(t,"labels","cosineDistance"),i=Wj(e,"predictions","cosineDistance");let a=null;null!=r&&(a=Wj(r,"weights","cosineDistance")),sz(o.shape,i.shape,"Error in cosineDistance: ");const u=yK(1),c=KK(u,wK(qq(o,i),n,!0));return PY(c,a,s)}});const zY=jj({hingeLoss_:function(t,e,n,r=LY.SUM_BY_NONZERO_WEIGHTS){let s=Wj(t,"labels","hingeLoss");const o=Wj(e,"predictions","hingeLoss");let i=null;null!=n&&(i=Wj(n,"weights","hingeLoss")),sz(s.shape,o.shape,"Error in hingeLoss: ");const a=yK(1);s=KK(qq(yK(2),s),a);const u=ZX(KK(a,qq(s,o)));return PY(u,i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WY=jj({huberLoss_:function(t,e,n,r=1,s=LY.SUM_BY_NONZERO_WEIGHTS){const o=Wj(t,"labels","huberLoss"),i=Wj(e,"predictions","huberLoss");let a=null;null!=n&&(a=Wj(n,"weights","huberLoss")),sz(o.shape,i.shape,"Error in huberLoss: ");const u=yK(r),c=Hq(KK(i,o)),l=lX(c,u),f=KK(c,l),h=Uq(qq(yK(.5),bK(l)),qq(u,f));return PY(h,a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UY=jj({logLoss_:function(t,e,n,r=1e-7,s=LY.SUM_BY_NONZERO_WEIGHTS){const o=Wj(t,"labels","logLoss"),i=Wj(e,"predictions","logLoss");let a=null;null!=n&&(a=Wj(n,"weights","logLoss")),sz(o.shape,i.shape,"Error in logLoss: ");const u=yK(1),c=yK(r),l=sq(qq(o,zK(Uq(i,c)))),f=qq(KK(u,o),zK(Uq(KK(u,i),c))),h=KK(l,f);return PY(h,a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jY=jj({meanSquaredError_:function(t,e,n,r=LY.SUM_BY_NONZERO_WEIGHTS){const s=Wj(t,"labels","meanSquaredError"),o=Wj(e,"predictions","meanSquaredError");let i=null;null!=n&&(i=Wj(n,"weights","meanSquaredError")),sz(s.shape,o.shape,"Error in meanSquaredError: ");const a=$J(s,o);return PY(a,i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GY=jj({sigmoidCrossEntropy_:function(t,e,n,r=0,s=LY.SUM_BY_NONZERO_WEIGHTS){let o=Wj(t,"multiClassLabels","sigmoidCrossEntropy");const i=Wj(e,"logits","sigmoidCrossEntropy");let a=null;if(null!=n&&(a=Wj(n,"weights","sigmoidCrossEntropy")),sz(o.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){const t=yK(r),e=yK(1),n=yK(.5);o=Uq(qq(o,KK(e,t)),qq(n,t))}const u=function(t,e){const n=Wj(t,"labels","sigmoidCrossEntropyWithLogits"),r=Wj(e,"logits","sigmoidCrossEntropyWithLogits");sz(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const s=ZX(r),o=qq(r,n),i=WK($K(sq(Hq(r))));return Uq(KK(s,o),i)}(o,i);return PY(u,a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qY=jj({softmaxCrossEntropy_:function(t,e,n,r=0,s=LY.SUM_BY_NONZERO_WEIGHTS){let o=Wj(t,"onehotLabels","softmaxCrossEntropy");const i=Wj(e,"logits","softmaxCrossEntropy");let a=null;if(null!=n&&(a=Wj(n,"weights","softmaxCrossEntropy")),sz(o.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){const t=yK(r),e=yK(1),n=yK(o.shape[1]);o=Uq(qq(o,KK(e,t)),Gq(t,n))}const u=function(t,e,n=-1){if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);const r=jK(((t,e,r)=>{const s=JK(e,[n],!0),o=KK(MG(e,"float32"),s);r([t,o]);const i=sq(qq(o,t));return{value:wK(i,[n]),gradFunc:(t,e)=>{const[r,s]=e,o=hK(t.shape,[n]);return[qq(bH(t,o),KK(MG(r,"float32"),$K(s))),qq(bH(t,o),KK($K(s),MG(r,"float32")))]}}}));return r(t,e)}(o,i);return PY(u,a,s)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HY=jj({sparseFillEmptyRows_:function(t,e,n,r){const s=Wj(t,"indices","sparseFillEmptyRows","int32"),o=Wj(e,"values","sparseFillEmptyRows"),i=Wj(n,"denseShape","sparseFillEmptyRows","int32"),a=Wj(r,"defaultValue","sparseFillEmptyRows",o.dtype);if(2!==s.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${s.shape}`);if(1!==o.rank)throw new Error(`Values should be Tensor1D but received shape ${o.shape}`);if(1!==i.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${i.shape}`);if(0!==a.rank)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const u={indices:s,values:o,denseShape:i,defaultValue:a},c=LU.runKernel("SparseFillEmptyRows",u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KY=jj({sparseReshape_:function(t,e,n){const r=Wj(t,"inputIndices","sparseReshape","int32"),s=Wj(e,"inputShape","sparseReshape","int32"),o=Wj(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==s.rank)throw new Error(`Input shape should be Tensor1D but received shape ${s.shape}`);if(1!==o.rank)throw new Error(`New shape should be Tensor1D but received shape ${o.shape}`);const i={inputIndices:r,inputShape:s,newShape:o},a=LU.runKernel("SparseReshape",i);return{outputIndices:a[0],outputShape:a[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XY=jj({sparseSegmentMean_:function(t,e,n){const r=Wj(t,"data","sparseSegmentMean"),s=Wj(e,"indices","sparseSegmentMean","int32"),o=Wj(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return LU.runKernel("SparseSegmentMean",i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JY=jj({sparseSegmentSum_:function(t,e,n){const r=Wj(t,"data","sparseSegmentSum"),s=Wj(e,"indices","sparseSegmentSum","int32"),o=Wj(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return LU.runKernel("SparseSegmentSum",i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YY=jj({stringNGrams_:function(t,e,n,r,s,o,i,a){const u=Wj(t,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error(`Data must be a vector, saw: ${u.shape}`);const c=Wj(e,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");const l={separator:n,nGramWidths:r,leftPad:s,rightPad:o,padWidth:i,preserveShortSequences:a},f={data:u,dataSplits:c},h=LU.runKernel("StringNGrams",f,l);return{nGrams:h[0],nGramsSplits:h[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZY=jj({stringSplit_:function(t,e,n=!0){const r=Wj(t,"input","stringSplit","string"),s=Wj(e,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(0!==s.rank)throw new Error(`Delimiter should be a scalar but received shape ${s.shape}`);const o={skipEmpty:n},i={input:r,delimiter:s},a=LU.runKernel("StringSplit",i,o);return{indices:a[0],values:a[1],shape:a[2]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QY=jj({stringToHashBucketFast_:function(t,e){const n=Wj(t,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const s={input:n};return LU.runKernel("StringToHashBucketFast",s,r)}}),tZ={fft:bJ,ifft:wJ,rfft:NJ,irfft:vJ},eZ={hammingWindow:oY,hannWindow:iY,frame:aY,stft:uY},nZ={flipLeftRight:lY,grayscaleToRGB:fY,resizeNearestNeighbor:CY,resizeBilinear:AY,rotateWithOffset:hY,cropAndResize:cY,nonMaxSuppression:dY,nonMaxSuppressionAsync:EY,nonMaxSuppressionWithScore:SY,nonMaxSuppressionWithScoreAsync:_Y,nonMaxSuppressionPadded:TY,nonMaxSuppressionPaddedAsync:kY,threshold:OY,transform:IY},rZ={bandPart:MY,gramSchmidt:RY,qr:FY},sZ={absoluteDifference:BY,computeWeightedLoss:PY,cosineDistance:VY,hingeLoss:zY,huberLoss:WY,logLoss:UY,meanSquaredError:jY,sigmoidCrossEntropy:GY,softmaxCrossEntropy:qY},oZ={sparseFillEmptyRows:HY,sparseReshape:KY,sparseSegmentMean:XY,sparseSegmentSum:JY},iZ={stringNGrams:YY,stringSplit:ZY,stringToHashBucketFast:QY};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class aZ extends Dq{minimize(t,e=!1,n){const{value:r,grads:s}=this.computeGradients(t,n);if(null!=n){const t=n.map((t=>({name:t.name,tensor:s[t.name]})));this.applyGradients(t)}else this.applyGradients(s);return eq(s),e?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return UK(t,e)}dispose(){null!=this.iterations_&&eq(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:yK(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(aZ,Symbol.hasInstance,{value:t=>null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class uZ extends aZ{constructor(t,e,n=null){super(),this.learningRate=t,this.rho=e,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=LU.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=LU.registeredVariables[e];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${e}/accum_grad`,variable:tq((()=>sK(r).variable(false)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${e}/accum_var`,variable:tq((()=>sK(r).variable(false)))});const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const o=this.accumulatedGrads[n].variable,i=this.accumulatedUpdates[n].variable;tq((()=>{const t=Uq(qq(o,this.rho),qq(bK(s),1-this.rho)),e=qq(Gq(gK(Uq(i,this.epsilon)),gK(Uq(o,this.epsilon))),s),n=Uq(qq(i,this.rho),qq(bK(e),1-this.rho));o.assign(t),i.assign(n);const a=Uq(qq(e,-this.learningRate),r);r.assign(a)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(eq(this.accumulatedGrads.map((t=>t.variable))),eq(this.accumulatedUpdates.map((t=>t.variable))))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){const e=(t=await this.extractIterations(t)).length/2;this.accumulatedGrads=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedUpdates=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}uZ.className="Adadelta",Lq(uZ);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class cZ extends aZ{constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=LU.registeredVariables[e];if(null==this.accumulatedGrads[n]){const t=!1;this.accumulatedGrads[n]={originalName:`${e}/accumulator`,variable:tq((()=>kK(r.shape,this.initialAccumulatorValue).variable(t)))}}const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const o=this.accumulatedGrads[n].variable;tq((()=>{const t=Uq(o,bK(s));o.assign(t);const e=Uq(qq(Gq(s,gK(Uq(t,LU.backend.epsilon()))),-this.learningRate),r);r.assign(e)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&eq(this.accumulatedGrads.map((t=>t.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulatedGrads=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}cZ.className="Adagrad",Lq(cZ);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class lZ extends aZ{constructor(t,e,n,r=null){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],tq((()=>{this.accBeta1=yK(e).variable(),this.accBeta2=yK(n).variable()})),null==r&&(this.epsilon=LU.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);tq((()=>{const n=KK(1,this.accBeta1),r=KK(1,this.accBeta2);e.forEach(((e,s)=>{const o=LU.registeredVariables[e];null==this.accumulatedFirstMoment[s]&&(this.accumulatedFirstMoment[s]={originalName:`${e}/m`,variable:tq((()=>sK(o).variable(false)))}),null==this.accumulatedSecondMoment[s]&&(this.accumulatedSecondMoment[s]={originalName:`${e}/v`,variable:tq((()=>sK(o).variable(false)))});const i=Array.isArray(t)?t[s].tensor:t[e];if(null==i)return;const a=this.accumulatedFirstMoment[s].variable,u=this.accumulatedSecondMoment[s].variable,c=Uq(qq(a,this.beta1),qq(i,1-this.beta1)),l=Uq(qq(u,this.beta2),qq(bK(i),1-this.beta2)),f=Gq(c,n),h=Gq(l,r);a.assign(c),u.assign(l);const p=Uq(qq(Gq(f,Uq(gK(h),this.epsilon)),-this.learningRate),o);o.assign(p)})),this.accBeta1.assign(qq(this.accBeta1,this.beta1)),this.accBeta2.assign(qq(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&eq(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedSecondMoment&&eq(this.accumulatedSecondMoment.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t),tq((()=>{this.accBeta1.assign(mK(this.beta1,this.iterations_+1)),this.accBeta2.assign(mK(this.beta2,this.iterations_+1))}));const e=t.length/2;this.accumulatedFirstMoment=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedSecondMoment=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}lZ.className="Adam",Lq(lZ);
/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/
class fZ extends aZ{constructor(t,e,n,r=null,s=0){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],tq((()=>{this.iteration=yK(0).variable(),this.accBeta1=yK(e).variable()})),null==r&&(this.epsilon=LU.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);tq((()=>{const n=KK(1,this.accBeta1),r=Gq(-this.learningRate,Uq(qq(this.iteration,this.decay),1));e.forEach(((e,s)=>{const o=LU.registeredVariables[e];null==this.accumulatedFirstMoment[s]&&(this.accumulatedFirstMoment[s]={originalName:`${e}/m`,variable:sK(o).variable(false)}),null==this.accumulatedWeightedInfNorm[s]&&(this.accumulatedWeightedInfNorm[s]={originalName:`${e}/v`,variable:sK(o).variable(false)});const i=Array.isArray(t)?t[s].tensor:t[e];if(null==i)return;const a=this.accumulatedFirstMoment[s].variable,u=this.accumulatedWeightedInfNorm[s].variable,c=Uq(qq(a,this.beta1),qq(i,1-this.beta1)),l=qq(u,this.beta2),f=Hq(i),h=iX(l,f);a.assign(c),u.assign(h);const p=Uq(qq(Gq(r,n),Gq(c,Uq(h,this.epsilon))),o);o.assign(p)})),this.iteration.assign(Uq(this.iteration,1)),this.accBeta1.assign(qq(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&eq(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedWeightedInfNorm&&eq(this.accumulatedWeightedInfNorm.map((t=>t.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}fZ.className="Adamax",Lq(fZ);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class hZ extends aZ{constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);e.forEach(((e,n)=>{const r=Array.isArray(t)?t[n].tensor:t[e];if(null==r)return;const s=LU.registeredVariables[e];tq((()=>{const t=Uq(qq(this.c,r),s);s.assign(t)}))})),this.incrementIterations()}setLearningRate(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=nq(yK(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(0!==(t=await this.extractIterations(t)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}hZ.className="SGD",Lq(hZ);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class pZ extends hZ{constructor(t,e,n=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=n,this.accumulations=[],this.m=yK(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=LU.registeredVariables[e];if(null==this.accumulations[n]){const t=!1;this.accumulations[n]={originalName:`${e}/momentum`,variable:tq((()=>sK(r).variable(t)))}}const s=this.accumulations[n].variable,o=Array.isArray(t)?t[n].tensor:t[e];null!=o&&tq((()=>{let t;const e=Uq(qq(this.m,s),o);t=this.useNesterov?Uq(qq(this.c,Uq(o,qq(e,this.m))),r):Uq(qq(this.c,e),r),s.assign(e),r.assign(t)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&eq(this.accumulations.map((t=>t.variable)))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulations=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}pZ.className="Momentum",Lq(pZ);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class dZ extends aZ{constructor(t,e=.9,n=0,r=null,s=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,null==r&&(this.epsilon=LU.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=LU.registeredVariables[e],s=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${e}/rms`,variable:tq((()=>sK(r).variable(s)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${e}/momentum`,variable:tq((()=>sK(r).variable(s)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${e}/mg`,variable:tq((()=>sK(r).variable(s)))});const o=Array.isArray(t)?t[n].tensor:t[e];if(null==o)return;const i=this.accumulatedMeanSquares[n].variable,a=this.accumulatedMoments[n].variable;tq((()=>{const t=Uq(qq(i,this.decay),qq(bK(o),1-this.decay));if(this.centered){const e=this.accumulatedMeanGrads[n].variable,s=Uq(qq(e,this.decay),qq(o,1-this.decay)),u=Gq(qq(o,this.learningRate),gK(KK(t,Uq(bK(s),this.epsilon)))),c=Uq(qq(a,this.momentum),u);i.assign(t),e.assign(s),a.assign(c);const l=KK(r,c);r.assign(l)}else{const t=Uq(qq(i,this.decay),qq(bK(o),1-this.decay)),e=Uq(qq(a,this.momentum),Gq(qq(o,this.learningRate),gK(Uq(t,this.epsilon))));i.assign(t),a.assign(e);const n=KK(r,e);r.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&eq(this.accumulatedMeanSquares.map((t=>t.variable))),null!=this.accumulatedMeanGrads&&this.centered&&eq(this.accumulatedMeanGrads.map((t=>t.variable))),null!=this.accumulatedMoments&&eq(this.accumulatedMoments.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,n=!1;this.accumulatedMeanSquares=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.accumulatedMoments=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}dZ.className="RMSProp",Lq(dZ);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class mZ{static sgd(t){return new hZ(t)}static momentum(t,e,n=!1){return new pZ(t,e,n)}static rmsprop(t,e=.9,n=0,r=null,s=!1){return new dZ(t,e,n,r,s)}static adam(t=.001,e=.9,n=.999,r=null){return new lZ(t,e,n,r)}static adadelta(t=.001,e=.95,n=null){return new uZ(t,e,n)}static adamax(t=.002,e=.9,n=.999,r=null,s=0){return new fZ(t,e,n,r,s)}static adagrad(t,e=.1){return new cZ(t,e)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yZ={sgd:mZ.sgd,momentum:mZ.momentum,adadelta:mZ.adadelta,adagrad:mZ.adagrad,rmsprop:mZ.rmsprop,adamax:mZ.adamax,adam:mZ.adam},gZ="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:t=>t();
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const bZ=/->/g;function wZ(t,e){const n=[];for(let r=0;r<t.length;++r)0!==t[r].length&&-1===t[r].indexOf(e)&&-1!==e||n.push(r);return n}var vZ=Object.freeze({__proto__:null,segOpComputeOptimalWindowSize:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n,r=!1;for(t<=30?(n=t,r=!0):n=Sz(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=Sz(t,n+1);return n},computeOutShape:function(t,e,n){const r=[],s=t.length;for(let o=0;o<s;o++)o!==e?r.push(t[o]):r.push(n);return r},collectGatherOpShapeInfo:function(t,e,n,r){const s=e.shape.length,o=t.shape.length;if(0!==r&&(r<-s||r>s))throw new Error(`Expect batchDims in the range of [-${s}, ${s}], but got ${r}`);if(r<0&&(r+=s),r>o)throw new Error(`batchDims (${r}) must be less than rank(x) (\n    ${o}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let n=0;n<r;++n)if(t.shape[n]!==e.shape[n])throw new Error(`x.shape[${n}]: ${t.shape[n]} should be equal to indices.shape[${n}]: ${e.shape[n]}.`);const i=t.shape[n],a=[];let u=1,c=1,l=1;for(let e=0;e<r;++e)a.push(t.shape[e]),u*=t.shape[e];for(let e=r;e<n;e++)a.push(t.shape[e]),c*=t.shape[e];for(let t=r;t<s;t++)a.push(e.shape[t]);for(let e=n+1;e<o;e++)a.push(t.shape[e]),l*=t.shape[e];return{batchSize:u,sliceSize:l,outerSize:c,dimSize:i,outputShape:a}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var xZ=Object.freeze({__proto__:null,slice_util:Rq,segment_util:vZ,fromUint8ToStringArray:function(t){try{return t.map((t=>iU(t)))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}},fromStringArrayToUint8:function(t){return t.map((t=>oU(t)))},upcastType:TU,axesAreInnerMostDims:lK,combineLocations:fK,computeOutAndReduceShapes:function(t,e){const n=[],r=t.length;for(let s=0;s<r;s++)-1===e.indexOf(s)&&n.push(t[s]);return[n,e.map((e=>t[e]))]},expandShapeToKeepDim:hK,assertAxesAreInnerMostDims:function(t,e,n){rz(lK(e,n),(()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`))},getAxesPermutation:function(t,e){if(lK(t,e))return null;const n=[];for(let r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach((t=>n.push(t))),n},getUndoAxesPermutation:function(t){return t.map(((t,e)=>[e,t])).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]))},getInnerMostAxes:function(t,e){const n=[];for(let r=e-t;r<e;++r)n.push(r);return n},getBroadcastDims:cq,getReductionAxes:lq,assertAndGetBroadcastShape:fq,assertParamsConsistent:
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=t[0].length;t.forEach(((t,e)=>{rz(t.length===n,(()=>`Error in concat${n}D: rank of tensors[${e}] must be the same as the rank of the rest (${n})`))})),rz(e>=0&&e<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));const r=t[0];t.forEach(((t,s)=>{for(let o=0;o<n;o++)rz(o===e||t[o]===r[o],(()=>`Error in concat${n}D: Shape of tensors[${s}] (${t}) does not match the shape of the rest (${r}) along the non-concatenated axis ${s}.`))}))},computeOutShape:function(t,e){const n=t[0].slice();for(let r=1;r<t.length;r++)n[e]+=t[r][e];return n}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,computeDilation2DInfo:function(t,e,n,r,s="NHWC",o){return aH(t,[...e,t[3]],n,o,r,null,null,yH(s))},computePool2DInfo:iH,computePool3DInfo:function(t,e,n,r,s,o,i="NDHWC"){const[a,u,c]=fH(e);let l,f;if("NDHWC"===i)f="channelsLast",l=[a,u,c,t[4],t[4]];else{if("NCDHW"!==i)throw new Error(`Unknown dataFormat ${i}`);f="channelsFirst",l=[a,u,c,t[1],t[1]]}return uH(t,l,n,r,s,!1,f,o)},computeConv2DInfo:aH,computeConv3DInfo:uH,computeDefaultPad:cH,tupleValuesAreOne:dH,eitherStridesOrDilationsAreOne:mH,convertConv2DDataFormat:yH,checkPadOnDimRoundingMode:gH,getFusedDyActivation:XJ,getFusedBiasGradient:JJ,applyActivation:YJ,shouldFuse:ZJ,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:function(t){return t<=30?t:Sz(t,Math.floor(Math.sqrt(t)))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getImageCenter:function(t,e,n){return[n*("number"==typeof t?t:t[0]),e*("number"==typeof t?t:t[1])]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getReshaped:function(t,e,n,r=!0){let s=[];if(r)s=s.concat(e.slice(0)),s.push(t[0]/n),s=s.concat(t.slice(1));else{s=s.concat(t[0]);const n=e.length;for(let r=0;r<n;++r)s=s.concat([t[r+1]/e[r],e[r]]);s=s.concat(t.slice(n+1))}return s},getPermuted:function(t,e,n=!0){const r=[];if(n){r.push(e);for(let n=e+1;n<t;++n)n<=2*e?(r.push(n),r.push(n-(e+1))):r.push(n)}else{const n=[],s=[];for(let r=1;r<t;++r)r>=2*e+1||r%2==1?s.push(r):n.push(r);r.push(...n),r.push(0),r.push(...s)}return r},getReshapedPermuted:function(t,e,n,r=!0){const s=[];r?s.push(t[0]/n):s.push(t[0]*n);for(let n=1;n<t.length;++n)n<=e.length?r?s.push(e[n-1]*t[n]):s.push(t[n]/e[n-1]):s.push(t[n]);return s},getSliceBeginCoords:function(t,e){const n=[0];for(let r=0;r<e;++r)n.push(t[r][0]);return n},getSliceSize:function(t,e,n){const r=t.slice(0,1);for(let s=0;s<n;++s)r.push(t[s+1]-e[s][0]-e[s][1]);return r}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,prepareAndValidate:wq,validateUpdateShape:xq,validateInput:Nq,calculateShapes:$q,SELU_SCALEALPHA:1.7580993408473768,SELU_SCALE:1.0507009873554805,ERF_P:.3275911,ERF_A1:.254829592,ERF_A2:-.284496736,ERF_A3:1.421413741,ERF_A4:-1.453152027,ERF_A5:1.061405429,warn:hW,log:function(...t){Dz().getBool("IS_TEST")||Dz().getBool("PROD")||console.log(...t)},mergeRealAndImagArrays:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(2*t.length);for(let r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n},splitRealAndImagArrays:function(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}},complexWithEvenIndex:function(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=0;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}},complexWithOddIndex:function(t){const e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=2;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}},getComplexWithIndex:function(t,e){return{real:t[2*e],imag:t[2*e+1]}},assignToTypedArray:function(t,e,n,r){t[2*r]=e,t[2*r+1]=n},exponents:function(t,e){const n=new Float32Array(t/2),r=new Float32Array(t/2);for(let s=0;s<Math.ceil(t/2);s++){const o=(e?2:-2)*Math.PI*(s/t);n[s]=Math.cos(o),r[s]=Math.sin(o)}return{real:n,imag:r}},exponent:function(t,e,n){const r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}},decodeEinsumEquation:function(t,e){const n=((t=t.replace(/\s/g,"")).length-t.replace(bZ,"").length)/"->".length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("->").');const[r,s]=t.split("->");rz(-1===r.indexOf("..."),(()=>'The ellipsis notation ("...") is not supported yet.'));const o=r.split(","),i=o.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let t=0;t<s.length;++t){const e=s[t];if(!o.some((t=>-1!==t.indexOf(e))))throw new Error(`Output subscripts contain the label ${e} not present in the input subscripts.`);-1===a.indexOf(e)&&a.push(e)}for(let t=0;t<r.length;++t){const e=r[t];-1===a.indexOf(e)&&","!==e&&a.push(e)}const u=new Array(o.length);for(let t=0;t<i;++t){if(new Set(o[t].split("")).size!==o[t].length)throw new Error(`Found duplicate axes in input component ${o[t]}. Support for duplicate axes in input is not implemented yet.`);u[t]=[];for(let e=0;e<o[t].length;++e)u[t].push(a.indexOf(o[t][e]))}const c=a.length,l=[];for(let t=s.length;t<c;++t)l.push(t);return{allDims:a,summedDims:l,idDims:u}},getEinsumPermutation:function(t,e){let n=new Array(t);n.fill(-1);for(let t=0;t<e.length;++t)n[e[t]]=t;const r=[];for(let e=0;e<t;++e)-1===n[e]&&r.push(e);return n=n.filter((t=>-1!==t)),{permutationIndices:n,expandDims:r}},checkEinsumDimSizes:function(t,e,n){const r=new Array(t);for(let t=0;t<n.length;++t){const s=n[t].shape;for(let n=0;n<e[t].length;++n)void 0===r[e[t][n]]?r[e[t][n]]=s[n]:rz(r[e[t][n]]===s[n],(()=>`Expected dimension ${r[e[t][n]]} at axis ${n} of input shaped ${JSON.stringify(s)}, but got dimension ${s[n]}`))}},getEinsumComputePath:function(t,e){const n=t,r=[];let s=0;0===t.length&&n.push(-1),s=t.length+1;for(let t=0;t<s;++t)r.push([]);const o=[];for(let t=0;t<n.length;++t){const s=wZ(e,n[t]);for(const e of s)-1===o.indexOf(e)&&(r[t].push(e),o.push(e))}return{path:n,steps:r}},isIdentityPermutation:function(t){return t.every(((t,e)=>t===e))},prepareSplitSize:function(t,e,n=0){let r=[];if("number"==typeof e)rz(t.shape[n]%e==0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(e).fill(t.shape[n]/e);else{rz(e.reduce(((t,e)=>(-1===e&&(t+=1),t)),0)<=1,(()=>"There should be only one negative value in split array."));const s=e.indexOf(-1);if(-1!==s){const r=e.reduce(((t,e)=>e>0?t+e:t));e[s]=t.shape[n]-r}rz(t.shape[n]===e.reduce(((t,e)=>t+e)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=e}return r}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getSparseFillEmptyRowsIndicesDenseShapeMismatch:function(t){return`Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ${t}`},getSparseFillEmptyRowsNegativeIndexErrorMessage:function(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`},getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:function(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:function(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`},getSparseReshapeNegativeOutputDimErrorMessage:function(t,e){return`size ${t} must be non-negative, not ${e}`},getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:function(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"},getSparseReshapeInputOutputMultipleErrorMessage:function(t,e){return`Input to reshape is a SparseTensor with ${az(t)}\n  dense values, but the requested shape requires a multiple of ${az(e)}. inputShape=${t} outputShape= ${e}`},getSparseReshapeInputOutputMismatchErrorMessage:function(t,e){return`Input to reshape is a tensor with ${az(t)} dense values, but the requested shape has ${az(e)}. inputShape=${t} outputShape=${e}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:function(){return"segment ids must be >= 0"},getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:function(){return"segment ids are not increasing"},getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:function(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`},getSparseSegmentReductionIndicesOutOfRangeErrorMessage:function(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}}),NZ=Object.freeze({__proto__:null,nonMaxSuppressionV3Impl:gY,nonMaxSuppressionV4Impl:bY,nonMaxSuppressionV5Impl:wY,whereImpl:LJ}),$Z=Object.freeze({__proto__:null,AdadeltaOptimizer:uZ,AdagradOptimizer:cZ,AdamOptimizer:lZ,AdamaxOptimizer:fZ,MomentumOptimizer:pZ,Optimizer:aZ,OptimizerConstructors:mZ,RMSPropOptimizer:dZ,SGDOptimizer:hZ,Tensor:wU,TensorBuffer:yU,Variable:vU,get Rank(){return xU},sumOutType:function(t){return TU(t,"int32")},upcastType:TU,get Reduction(){return LY},customGrad:jK,grad:function(t){return rz(Ez(t),(()=>"The f passed in grad(f) must be a function")),(e,n)=>{const r=Wj(e,"x","tf.grad","string_or_numeric"),s=null!=n?Wj(n,"dy","tf.grad"):null;return LU.tidy((()=>{const{value:e,grads:n}=LU.gradients((()=>t(r)),[r],s);return null!=s&&sz(e.shape,s.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),GK(n),n[0]}))}},grads:function(t){return rz(Ez(t),(()=>"The f passed in grads(f) must be a function")),(e,n)=>{rz(Array.isArray(e),(()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"));const r=Uj(e,"args","tf.grads","string_or_numeric"),s=null!=n?Wj(n,"dy","tf.grads"):null;return LU.tidy((()=>{const{value:e,grads:n}=LU.gradients((()=>t(...r)),r,s);return null!=s&&sz(e.shape,s.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),GK(n),n}))}},valueAndGrad:function(t){return rz(Ez(t),(()=>"The f passed in valueAndGrad(f) must be a function")),(e,n)=>{rz(e instanceof wU,(()=>"The x passed in valueAndGrad(f)(x) must be a tensor")),rz(null==n||n instanceof wU,(()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"));const{grads:r,value:s}=LU.gradients((()=>t(e)),[e],n);return GK(r),{grad:r[0],value:s}}},valueAndGrads:function(t){return rz(Ez(t),(()=>"The f passed in valueAndGrads(f) must be a function")),(e,n)=>{rz(Array.isArray(e)&&e.every((t=>t instanceof wU)),(()=>"The args passed in valueAndGrads(f)(args) must be array of tensors")),rz(null==n||n instanceof wU,(()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"));const r=LU.gradients((()=>t(...e)),e,n);return null!=n&&sz(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),GK(r.grads),r}},variableGrads:UK,Environment:Mz,env:Dz,get ENV(){return Fz},nextFrame:function(){return new Promise((t=>gZ((()=>t()))))},KernelBackend:ZV,DataStorage:class{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}},abs:Hq,acos:Kq,acosh:Xq,add:Uq,addN:Jq,all:Yq,any:Zq,argMax:Qq,argMin:tH,asin:eH,asinh:nH,atan:rH,atan2:sH,atanh:oH,avgPool:wH,avgPool3d:vH,basicLSTMCell:SH,batchToSpaceND:_H,batchNorm:TH,batchNorm2d:kH,batchNorm3d:AH,batchNorm4d:CH,bincount:OH,broadcastArgs:IH,broadcastTo:MH,buffer:IG,cast:MG,ceil:RH,clipByValue:DH,clone:RG,complex:Gj,concat:xH,concat1d:FH,concat2d:LH,concat3d:PH,concat4d:BH,conv1d:zH,conv2d:VH,conv2dTranspose:UH,conv3d:jH,conv3dTranspose:qH,cos:HH,cosh:KH,cumprod:XH,cumsum:JH,denseBincount:YH,depthToSpace:ZH,depthwiseConv2d:QH,diag:tK,dilation2d:eK,div:Gq,divNoNan:oK,dot:iK,einsum:aK,elu:uK,equal:nK,erf:cK,euclideanNorm:NK,exp:$K,expandDims:EK,expm1:SK,eye:TK,fill:kK,floor:AK,floorDiv:jq,gather:CK,greater:OK,greaterEqual:IK,imag:rq,isFinite:MK,isInf:RK,isNaN:DK,leakyRelu:FK,less:LK,lessEqual:PK,linspace:BK,localResponseNormalization:VK,log:zK,log1p:WK,logSigmoid:HK,logSoftmax:XK,logSumExp:JK,logicalAnd:YK,logicalNot:ZK,logicalOr:QK,logicalXor:tX,lowerBound:nX,matMul:ZG,max:pK,maxPool:rX,maxPool3d:sX,maxPoolWithArgmax:oX,maximum:iX,mean:aX,meshgrid:function(t,e,{indexing:n="xy"}={}){if("xy"!==n&&"ij"!==n)throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(void 0===t)return[];let r=Wj(t,"x","meshgrid",t instanceof wU?t.dtype:"float32");if(void 0===e)return[r];let s=Wj(e,"y","meshgrid",e instanceof wU?e.dtype:"float32");const o=az(r.shape),i=az(s.shape);return"xy"===n?(r=bH(r,[1,-1]),s=bH(s,[-1,1]),[ZG(cX([i,1],r.dtype),r),ZG(s,cX([1,o],s.dtype))]):(r=bH(r,[-1,1]),s=bH(s,[1,-1]),[ZG(r,cX([1,i],r.dtype)),ZG(cX([o,1],s.dtype),s)])},min:dK,minimum:lX,mirrorPad:fX,mod:hX,moments:pX,mul:qq,multiRNNCell:dX,multinomial:mX,neg:sq,notEqual:yX,oneHot:QG,ones:cX,onesLike:gX,outerProduct:bX,pad:wX,pad1d:vX,pad2d:xX,pad3d:NX,pad4d:$X,pool:SX,pow:mK,prelu:_X,print:DG,prod:TX,rand:kX,randomGamma:HX,randomNormal:KX,randomUniform:XX,range:JX,real:oq,reciprocal:YX,relu:ZX,relu6:QX,reshape:bH,reverse:tJ,reverse1d:eJ,reverse2d:nJ,reverse3d:rJ,reverse4d:sJ,round:oJ,rsqrt:iJ,scalar:yK,selu:aJ,separableConv2d:uJ,setdiff1dAsync:cJ,sigmoid:NH,sign:lJ,sin:fJ,sinh:hJ,slice:$H,slice1d:pJ,slice2d:dJ,slice3d:mJ,slice4d:yJ,softmax:gJ,softplus:qK,spaceToBatchND:EX,fft:bJ,ifft:wJ,irfft:vJ,rfft:NJ,split:xJ,sqrt:gK,square:bK,squaredDifference:$J,squeeze:EJ,stack:SJ,step:_J,stridedSlice:TJ,sub:KK,sum:wK,tan:kJ,tanh:EH,tensor:Hj,tensor1d:AJ,tensor2d:CJ,tensor3d:pq,tensor4d:function(t,e,n){if(oz(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");const r=Bj(t,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return qj(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,tensor5d:function(t,e,n){if(oz(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");const r=Bj(t,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return qj(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,tensor6d:function(t,e,n){if(oz(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");const r=Bj(t,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return qj(t,e=e||r,r,n)},tile:_K,topk:OJ,truncatedNormal:IJ,unique:MJ,unsortedSegmentSum:RJ,unstack:DJ,upperBound:FJ,variable:function(t,e=!0,n,r){return LU.makeVariable(t,e,n,r)},where:rK,whereAsync:PJ,zeros:uX,zerosLike:sK,op:jj,OP_SCOPE_SUFFIX:"__op",booleanMaskAsync:BJ,transpose:iq,norm:xK,movingAverage:VJ,scatterND:zJ,searchSorted:eX,sparseToDense:WJ,gatherND:UJ,dropout:jJ,enclosingPowerOfTwo:GJ,cosineWindow:qJ,inTopKAsync:HJ,image:nZ,linalg:rZ,losses:sZ,spectral:tZ,fused:sY,signal:eZ,sparse:oZ,string:iZ,train:yZ,enableProdMode:function(){Dz().set("PROD",!0)},enableDebugMode:function(){Dz().set("DEBUG",!0)},disableDeprecationWarnings:function(){Dz().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},deprecationWarn:function(t){Dz().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")},disposeVariables:function(){LU.disposeVariables()},engine:function(){return LU},memory:function(){return LU.memory()},profile:function(t){return LU.profile(t)},tidy:tq,dispose:eq,keep:nq,time:function(t){return LU.time(t)},setBackend:function(t){return LU.setBackend(t)},ready:function(){return LU.ready()},getBackend:function(){return LU.backendName},removeBackend:function(t){LU.removeBackend(t)},findBackend:function(t){return LU.findBackend(t)},findBackendFactory:function(t){return LU.findBackendFactory(t)},registerBackend:function(t,e,n=1){return LU.registerBackend(t,e,n)},backend:function(){return LU.backend},setPlatform:function(t,e){Dz().setPlatform(t,e)},getKernel:mW,getGradient:yW,getKernelsForBackend:gW,registerKernel:bW,registerGradient:function(t){const{kernelName:e}=t;dW.has(e)&&Dz().getBool("DEBUG")&&hW(`Overriding the gradient for '${e}'`),dW.set(e,t)},unregisterKernel:function(t,e){const n=wW(t,e);if(!pW.has(n))throw new Error(`The kernel '${t}' for backend '${e}' is not registered`);pW.delete(n)},unregisterGradient:function(t){if(!dW.has(t))throw new Error(`The gradient '${t}' for backend is not registered`);dW.delete(t)},copyRegisteredKernels:function(t,e){gW(t).forEach((t=>{bW(Object.assign({},t,{backendName:e}))}))},Abs:"Abs",Acos:"Acos",Acosh:"Acosh",Add:"Add",AddN:"AddN",All:"All",Any:"Any",ArgMax:"ArgMax",ArgMin:"ArgMin",Asin:"Asin",Asinh:"Asinh",Atan:"Atan",Atanh:"Atanh",Atan2:"Atan2",AvgPool:"AvgPool",AvgPoolGrad:"AvgPoolGrad",AvgPool3D:"AvgPool3D",AvgPool3DGrad:"AvgPool3DGrad",BatchMatMul:"BatchMatMul",BatchToSpaceND:"BatchToSpaceND",Bincount:"Bincount",BroadcastTo:"BroadcastTo",BroadcastArgs:"BroadcastArgs",Cast:"Cast",Ceil:"Ceil",ClipByValue:"ClipByValue",Complex:"Complex",ComplexAbs:"ComplexAbs",Concat:"Concat",Conv2D:"Conv2D",Conv2DBackpropFilter:"Conv2DBackpropFilter",Conv2DBackpropInput:"Conv2DBackpropInput",Conv3D:"Conv3D",Conv3DBackpropFilterV2:"Conv3DBackpropFilterV2",Conv3DBackpropInputV2:"Conv3DBackpropInputV2",Cos:"Cos",Cosh:"Cosh",Cumprod:"Cumprod",Cumsum:"Cumsum",CropAndResize:"CropAndResize",DenseBincount:"DenseBincount",DepthToSpace:"DepthToSpace",DepthwiseConv2dNative:"DepthwiseConv2dNative",DepthwiseConv2dNativeBackpropFilter:"DepthwiseConv2dNativeBackpropFilter",DepthwiseConv2dNativeBackpropInput:"DepthwiseConv2dNativeBackpropInput",Diag:"Diag",Dilation2D:"Dilation2D",Dilation2DBackpropInput:"Dilation2DBackpropInput",Dilation2DBackpropFilter:"Dilation2DBackpropFilter",RealDiv:"RealDiv",Einsum:"Einsum",Elu:"Elu",EluGrad:"EluGrad",Erf:"Erf",Equal:"Equal",Exp:"Exp",ExpandDims:"ExpandDims",Expm1:"Expm1",FFT:"FFT",Fill:"Fill",FlipLeftRight:"FlipLeftRight",Floor:"Floor",FloorDiv:"FloorDiv",FusedBatchNorm:"FusedBatchNorm",GatherV2:"GatherV2",GatherNd:"GatherNd",Greater:"Greater",GreaterEqual:"GreaterEqual",Identity:"Identity",IFFT:"IFFT",Imag:"Imag",IsFinite:"IsFinite",IsInf:"IsInf",IsNan:"IsNan",LeakyRelu:"LeakyRelu",Less:"Less",LessEqual:"LessEqual",LinSpace:"LinSpace",Log:"Log",Log1p:"Log1p",LogicalAnd:"LogicalAnd",LogicalNot:"LogicalNot",LogicalOr:"LogicalOr",LogSoftmax:"LogSoftmax",LowerBound:"LowerBound",LRN:"LRN",LRNGrad:"LRNGrad",Max:"Max",Maximum:"Maximum",MaxPool:"MaxPool",MaxPoolGrad:"MaxPoolGrad",MaxPool3D:"MaxPool3D",MaxPool3DGrad:"MaxPool3DGrad",MaxPoolWithArgmax:"MaxPoolWithArgmax",Mean:"Mean",Min:"Min",Minimum:"Minimum",MirrorPad:"MirrorPad",Mod:"Mod",Multinomial:"Multinomial",Multiply:"Multiply",Neg:"Neg",NotEqual:"NotEqual",NonMaxSuppressionV3:"NonMaxSuppressionV3",NonMaxSuppressionV4:"NonMaxSuppressionV4",NonMaxSuppressionV5:"NonMaxSuppressionV5",OnesLike:"OnesLike",OneHot:"OneHot",Pack:"Pack",PadV2:"PadV2",Pool:"Pool",Pow:"Pow",Prelu:"Prelu",Prod:"Prod",Range:"Range",Real:"Real",Reciprocal:"Reciprocal",Relu:"Relu",Reshape:"Reshape",ResizeNearestNeighbor:"ResizeNearestNeighbor",ResizeNearestNeighborGrad:"ResizeNearestNeighborGrad",ResizeBilinear:"ResizeBilinear",ResizeBilinearGrad:"ResizeBilinearGrad",Relu6:"Relu6",Reverse:"Reverse",Round:"Round",Rsqrt:"Rsqrt",ScatterNd:"ScatterNd",SearchSorted:"SearchSorted",Select:"Select",Selu:"Selu",Slice:"Slice",Sin:"Sin",Sinh:"Sinh",Sign:"Sign",Sigmoid:"Sigmoid",Softplus:"Softplus",Sqrt:"Sqrt",Sum:"Sum",SpaceToBatchND:"SpaceToBatchND",SplitV:"SplitV",Softmax:"Softmax",SparseFillEmptyRows:"SparseFillEmptyRows",SparseReshape:"SparseReshape",SparseSegmentMean:"SparseSegmentMean",SparseSegmentSum:"SparseSegmentSum",SparseToDense:"SparseToDense",SquaredDifference:"SquaredDifference",Square:"Square",StridedSlice:"StridedSlice",StringNGrams:"StringNGrams",StringSplit:"StringSplit",StringToHashBucketFast:"StringToHashBucketFast",Sub:"Sub",Tan:"Tan",Tanh:"Tanh",Tile:"Tile",TopK:"TopK",Transform:"Transform",Transpose:"Transpose",Unique:"Unique",Unpack:"Unpack",UnsortedSegmentSum:"UnsortedSegmentSum",UpperBound:"UpperBound",ZerosLike:"ZerosLike",Step:"Step",FromPixels:"FromPixels",RotateWithOffset:"RotateWithOffset",_FusedMatMul:"_FusedMatMul",FusedConv2D:"FusedConv2D",FusedDepthwiseConv2D:"FusedDepthwiseConv2D",version_core:"3.18.0",browser:bq,io:YG,math:uq,serialization:Pq,test_util:Wq,util:aU,backend_util:xZ,broadcast_util:hq,tensor_util:IU,slice_util:Rq,gather_util:vq,scatter_util:Eq,device_util:zU,kernel_impls:NZ});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
var EZ,SZ;Dz().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"}(EZ||(EZ={})),function(t){var e;(e=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(SZ||(SZ={}));
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const _Z={};function TZ(t){return _Z[t]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function kZ(t,e,n,r,s){const o=e.inputParams[t];if(o&&void 0!==o.inputIndexStart){const t=o.inputIndexStart,i=0===o.inputIndexEnd?void 0:void 0===o.inputIndexEnd?t+1:o.inputIndexEnd;if("tensor"===o.type)return AZ(e.inputNames[o.inputIndexStart],n,r,s);if("tensors"===o.type){return e.inputNames.slice(t,i).map((t=>AZ(t,n,r,s)))}const a=AZ(e.inputNames.slice(t)[0],n,r,s),u=a.dataSync();return"number"===o.type?u[0]:kz(a.shape,u)}const i=e.attrParams[t];return i&&i.value}function AZ(t,e,n,r){const[s,o]=IZ(t);if(null!=r){const t=r.getHashTableHandleByName(s);if(null!=t)return t}const i=n.currentContextIds.find((t=>!!e[OZ(s,t)]));return void 0!==i?e[OZ(s,i)][o]:void 0}function CZ(t,e){const[n,r,s]=IZ(t);return[OZ(n,e&&e.currentContextId),r,s]}function OZ(t,e){return e?`${t}-${e}`:t}function IZ(t){const e=t.split(":");if(1===e.length)return[t,0,void 0];const n=e[0],r=3===e.length?e[1]:void 0;return[n,Number(e[e.length-1]),r]}function MZ(t,e,n){let r=kZ("pad",t,e,n);if("explicit"===r){r=kZ("explicitPaddings",t,e,n);const s=[[0,0],[0,0],[0,0],[0,0]];for(let t=0;t<4;t++)s[t][0]=r[2*t],s[t][1]=r[2*t+1];return s}return r}function RZ(t){return t.kept?t:RG(t)}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var DZ=Object.freeze({__proto__:null,json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var FZ=Object.freeze({__proto__:null,json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var LZ=Object.freeze({__proto__:null,json:[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var PZ=Object.freeze({__proto__:null,json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var BZ=Object.freeze({__proto__:null,json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var VZ=Object.freeze({__proto__:null,json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var zZ=Object.freeze({__proto__:null,json:[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var WZ=Object.freeze({__proto__:null,json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var UZ=Object.freeze({__proto__:null,json:[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var jZ=Object.freeze({__proto__:null,json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var GZ=Object.freeze({__proto__:null,json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var qZ=Object.freeze({__proto__:null,json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var HZ=Object.freeze({__proto__:null,json:[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var KZ=Object.freeze({__proto__:null,json:[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var XZ=Object.freeze({__proto__:null,json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var JZ=Object.freeze({__proto__:null,json:[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var YZ=Object.freeze({__proto__:null,json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ZZ=Object.freeze({__proto__:null,json:[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var QZ=Object.freeze({__proto__:null,json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}]});class tQ{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const t=[].concat(...[DZ,FZ,LZ,PZ,BZ,VZ,zZ,WZ,UZ,jZ,GZ,qZ,HZ,KZ,XZ,JZ,YZ,ZZ,QZ].map((t=>t.json)));this.opMappers=t.reduce(((t,e)=>(t[e.tfOpName]=e,t)),{})}transformGraph(t,e={}){const n=t.node,r=[],s=[],o=[],i=n.reduce(((t,e)=>(t[e.name]=this.mapNode(e),e.op.startsWith("Placeholder")?r.push(t[e.name]):"Const"===e.op?s.push(t[e.name]):null!=e.input&&0!==e.input.length||o.push(t[e.name]),t)),{});let a=[];const u=[];let c={},l={};null!=e&&(c=this.mapSignatureEntries(e.inputs),l=this.mapSignatureEntries(e.outputs));const f=Object.keys(i);f.forEach((t=>{const e=i[t];e.inputNames.forEach(((t,n)=>{const[r,,s]=CZ(t),o=i[r];if(null!=o.outputs){const t=o.outputs.indexOf(s);if(-1!==t){const s=`${r}:${t}`;e.inputNames[n]=s}}e.inputs.push(o),o.children.push(e)}))})),0===Object.keys(l).length?f.forEach((t=>{const e=i[t];0===e.children.length&&u.push(e)})):Object.keys(l).forEach((t=>{const[e]=CZ(t),n=i[e];null!=n&&(n.signatureKey=l[t],u.push(n))})),Object.keys(c).length>0?Object.keys(c).forEach((t=>{const[e]=CZ(t),n=i[e];n&&(n.signatureKey=c[t],a.push(n))})):a=r;let h={};null!=t.library&&null!=t.library.function&&(h=t.library.function.reduce(((t,e)=>(t[e.signature.name]=this.mapFunction(e),t)),{}));const p={nodes:i,inputs:a,outputs:u,weights:s,placeholders:r,signature:e,functions:h};return o.length>0&&(p.initNodes=o),p}mapSignatureEntries(t){return Object.keys(t||{}).reduce(((e,n)=>(e[t[n].name]=n,e)),{})}mapNode(t){const e=TZ(t.op)||this.opMappers[t.op]||{};null==t.attr&&(t.attr={});const n={name:t.name,op:t.op,category:e.category,inputNames:(t.input||[]).map((t=>t.startsWith("^")?t.slice(1):t)),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr,outputs:e.outputs};return null!=e.inputs&&(n.inputParams=e.inputs.reduce(((t,e)=>(t[e.name]={type:e.type,inputIndexStart:e.start,inputIndexEnd:e.end},t)),{})),null!=e.attrs&&(n.attrParams=e.attrs.reduce(((e,n)=>{const r=n.type;let s;switch(n.type){case"string":s=nQ(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=nQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":s=hQ(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=hQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":s=sQ(t.attr,n.tfName,n.defaultValue||0),void 0===s&&n.tfDeprecatedName&&(s=sQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":s=fQ(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=fQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":s=rQ(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=rQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":s=dQ(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=dQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":s=lQ(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=lQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":s=pQ(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=pQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":s=aQ(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=aQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":s=uQ(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=uQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":s=iQ(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=iQ(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${n.type} for op: ${t.op}`)}return e[n.name]={value:s,type:r},e}),{})),n}mapFunction(t){const e=t.nodeDef,n=[];let r={};null!=e&&(r=e.reduce(((t,e)=>(t[e.name]=this.mapNode(e),"Const"===e.op&&n.push(t[e.name]),t)),{}));const s=[],o=[];t.signature.inputArg.forEach((t=>{const[e]=CZ(t.name),n={name:e,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:oQ(t.type),type:"dtype"}},children:[]};n.signatureKey=t.name,s.push(n),r[e]=n}));Object.keys(r).forEach((t=>{const e=r[t];e.inputNames.forEach(((t,n)=>{const[s,,o]=CZ(t),i=r[s];if(null!=i.outputs){const t=i.outputs.indexOf(o);if(-1!==t){const r=`${s}:${t}`;e.inputNames[n]=r}}e.inputs.push(i),i.children.push(e)}))}));const i=t.ret;t.signature.outputArg.forEach((t=>{const[e,n]=CZ(i[t.name]),s=r[e];null!=s&&(s.defaultOutput=n,o.push(s))}));const a=this.mapArgsToSignature(t);return{nodes:r,inputs:s,outputs:o,weights:n,placeholders:[],signature:a}}mapArgsToSignature(t){return{methodName:t.signature.name,inputs:t.signature.inputArg.reduce(((t,e)=>(t[e.name]=this.mapArgToTensorInfo(e),t)),{}),outputs:t.signature.outputArg.reduce(((e,n)=>(e[n.name]=this.mapArgToTensorInfo(n,t.ret),e)),{})}}mapArgToTensorInfo(t,e){let n=t.name;return null!=e&&(n=e[n]),{name:n,dtype:t.type}}}function eQ(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):function(t){const e=Dz().global;return void 0!==e.atob?e.atob(t):new nj(t,"base64").toString()}(t);return e?n:n.toLowerCase()}function nQ(t,e,n,r=!1){const s=t[e];return null!=s?eQ(s.s,r):n}function rQ(t,e,n){const r=t[e];return r?r.b:n}function sQ(t,e,n){const r=t[e]||{},s=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof s?s:parseInt(s,10)}function oQ(t){switch("string"==typeof t&&(t=EZ[t]),t){case EZ.DT_FLOAT:case EZ.DT_HALF:return"float32";case EZ.DT_INT32:case EZ.DT_INT64:case EZ.DT_INT8:case EZ.DT_UINT8:return"int32";case EZ.DT_BOOL:return"bool";case EZ.DT_DOUBLE:return"float32";case EZ.DT_STRING:return"string";default:return null}}function iQ(t,e,n){const r=t[e];return r&&r.func?r.func.name:n}function aQ(t,e,n){const r=t[e];return r&&r.type?oQ(r.type):n}function uQ(t,e,n){const r=t[e];return r&&r.list&&r.list.type?r.list.type.map((t=>oQ(t))):n}function cQ(t){if(!t.unknownRank)return null!=t.dim?t.dim.map((t=>"number"==typeof t.size?t.size:parseInt(t.size,10))):[]}function lQ(t,e,n){const r=t[e];return r&&r.shape?cQ(r.shape):n}function fQ(t,e,n){const r=t[e];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((t=>"number"==typeof t?t:parseInt(t,10))):n}function hQ(t,e,n,r=!1){const s=t[e];return s&&s.list&&s.list.s?s.list.s.map((t=>eQ(t,r))):n}function pQ(t,e,n){const r=t[e];return r&&r.list&&r.list.shape?r.list.shape.map((t=>cQ(t))):n}function dQ(t,e,n){const r=t[e];return r&&r.list&&r.list.b?r.list.b:n}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mQ{constructor(t,e,n){this.node=t,this.tensorMap=e,this.context=n,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((t=>this.getInput(t))),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce(((t,e)=>(t[e]=this.getAttr(e),t)),{}))}getInput(t){return AZ(t,this.tensorMap,this.context)}getAttr(t,e){const n=this.node.rawAttrs[t];if(null!=n.tensor)return AZ(t,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return sQ(this.node.rawAttrs,t,e);if(null!=n.s)return nQ(this.node.rawAttrs,t,e);if(null!=n.b)return rQ(this.node.rawAttrs,t,e);if(null!=n.shape)return lQ(this.node.rawAttrs,t,e);if(null!=n.type)return aQ(this.node.rawAttrs,t,e);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return fQ(this.node.rawAttrs,t,e);if(null!=n.list.s)return hQ(this.node.rawAttrs,t,e);if(null!=n.list.shape)return pQ(this.node.rawAttrs,t,e);if(null!=n.list.b)return dQ(this.node.rawAttrs,t,e);if(null!=n.list.type)return uQ(this.node.rawAttrs,t,e)}return e}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function yQ(t,e,n=""){if("number"!=typeof t&&"number"!=typeof e){rz(t.length===e.length,(()=>n+` Shapes ${t} and ${e} must match`));for(let r=0;r<t.length;r++){const s=t[r],o=e[r];rz(s<0||o<0||s===o,(()=>n+` Shapes ${t} and ${e} must match`))}}}function gQ(t){return"number"!=typeof t&&!t.some((t=>t<0))}function bQ(t,e,n){let r=wQ(t,n);const s=!gQ(r);if(s&&0===e.length)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(s&&e.forEach((t=>{r=wQ(t.shape,r)})),!gQ(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function wQ(t,e){if("number"==typeof t)return e;if("number"==typeof e)return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let r=0;r<t.length;++r){const s=t[r],o=e[r];if(s>=0&&o>=0&&s!==o)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[r]=s>=0?s:o}return n}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vQ{constructor(t,e,n,r,s,o,i){this.name=t,this.dtype=e,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=s,this.dynamicSize=o,this.clearAfterRead=i,this.tensors=[],this.closed_=!1,this.idTensor=yK(0),nq(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.tensor.id)||e.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||t>=this.size())throw new Error(`Tried to read from index ${t}, but array size is: ${this.size()}`);const e=this.tensors[t];if(e.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${t} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor}readMany(t){return t.map((t=>this.read(t)))}write(t,e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error(`Tried to write to index ${t}, but array is not resizeable and size is: ${this.maxSize}`);const n=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t},\n          because the value dtype is ${e.dtype}, but TensorArray dtype is ${this.dtype}.`);if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=e.shape),yQ(this.elementShape,e.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${t}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been written.`);n.tensor=e,nq(e),n.written=!0,this.tensors[t]=n}writeMany(t,e){if(t.length!==e.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${t.length} is not the same as tensors size: ${e.length}.`);t.forEach(((t,n)=>this.write(t,e[n])))}gather(t,e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${e}`);if(t)t=t.slice(0,this.size());else{t=[];for(let e=0;e<this.size();e++)t.push(e)}if(0===t.length)return Hj([],[0].concat(this.elementShape));const n=this.readMany(t);return yQ(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),SJ(n,0)}concat(t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${t}`);if(0===this.size())return Hj([],[0].concat(this.elementShape));const e=[];for(let t=0;t<this.size();t++)e.push(t);const n=this.readMany(e);return yQ(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),xH(n,0)}scatter(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);const n=Math.max(...t);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(t,DJ(e,0))}split(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);let n=0;const r=t.map((t=>(n+=t,n)));if(n!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${n}, and tensor's shape is: ${e.shape}`);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${t.length}), and the TensorArray is not marked as dynamically resizeable`);const s=0===n?0:e.size/n,o=[];tq((()=>{e=bH(e,[1,n,s]);for(let n=0;n<t.length;++n){const i=[0,0===n?0:r[n-1],0],a=[1,t[n],s];o[n]=bH($H(e,i,a),this.elementShape)}return o}));const i=[];for(let e=0;e<t.length;e++)i[e]=e;this.writeMany(i,o)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xQ{constructor(t,e,n,r=-1){this.tensors=t,this.elementShape=e,this.elementDtype=n,null!=t&&t.forEach((t=>{if(n!==t.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${t.dtype}`);yQ(e,t.shape,"TensorList shape mismatch: "),nq(t)})),this.idTensor=yK(0),this.maxNumElements=r,nq(this.idTensor)}get id(){return this.idTensor.id}copy(){return new xQ([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.id)||e.dispose()})),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,e,n=-1){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(-1!==n&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);yQ(t,this.elementShape,"TensorList shape mismatch: ");const r=bQ(this.elementShape,this.tensors,t);return tq((()=>{const t=this.tensors.map((t=>bH(t,r)));return SJ(t,0)}))}popBack(t,e){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=bQ(this.elementShape,this.tensors,t),r=this.tensors.pop();return yQ(r.shape,t,"TensorList shape mismatch: "),bH(r,n)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(yQ(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");nq(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);const e=new xQ([],this.elementShape,this.elementDtype,this.maxNumElements);e.tensors.length=t;for(let n=0;n<Math.min(this.tensors.length,t);++n)e.tensors[n]=this.tensors[n];return e}getItem(t,e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(null==this.tensors[t])throw new Error(`element at index ${t} is null.`);yQ(this.tensors[t].shape,e,"TensorList shape mismatch: ");const r=bQ(this.elementShape,this.tensors,e);return bH(this.tensors[t],r)}setItem(t,e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(t<0||-1!==this.maxNumElements&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);yQ(this.elementShape,e.shape,"TensorList shape mismatch: "),nq(e),this.tensors[t]=e}gather(t,e,n){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);yQ(this.elementShape,n,"TensorList shape mismatch: "),t=t.slice(0,this.size());const r=bQ(this.elementShape,this.tensors,n);return 0===t.length?Hj([],[0].concat(r)):tq((()=>{const e=t.map((t=>bH(this.tensors[t],r)));return SJ(e,0)}))}concat(t,e){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);yQ(this.elementShape,e,"TensorList shape mismatch: ");const n=bQ(this.elementShape,this.tensors,e);return 0===this.size()?Hj([],[0].concat(n)):tq((()=>{const t=this.tensors.map((t=>bH(t,n)));return xH(t,0)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const NQ=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const r=kZ("thenBranch",t,e,n),s=kZ("elseBranch",t,e,n),o=kZ("cond",t,e,n),i=kZ("args",t,e,n);return(await o.data())[0]?n.functionMap[r].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap):n.functionMap[s].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=kZ("body",t,e,n),s=kZ("cond",t,e,n),o=kZ("args",t,e,n),i=await n.functionMap[s].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap),a=o.map((t=>t.id));let u=await i[0].data();i.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||t.dispose()}));let c=o;for(;u[0];){const t=c;c=await n.functionMap[r].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);const e=c.map((t=>t.id));t.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}));const o=await n.functionMap[s].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);u=await o[0].data(),o.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}))}return c}case"LoopCond":return[RZ(kZ("pred",t,e,n))];case"Switch":{const r=kZ("pred",t,e,n);let s=kZ("data",t,e,n);return s.kept||(s=RZ(s)),(await r.data())[0]?[void 0,s]:[s,void 0]}case"Merge":{const r=t.inputNames.find((t=>void 0!==AZ(t,e,n)));if(r){return[RZ(AZ(r,e,n))]}return}case"Enter":{const r=kZ("frameName",t,e,n),s=kZ("tensor",t,e,n);return n.enterFrame(r),[RZ(s)]}case"Exit":{const r=kZ("tensor",t,e,n);return n.exitFrame(),[RZ(r)]}case"NextIteration":{const r=kZ("tensor",t,e,n);return n.nextIteration(),[RZ(r)]}case"TensorArrayV3":{const r=kZ("size",t,e,n),s=kZ("dtype",t,e,n),o=kZ("elementShape",t,e,n),i=kZ("dynamicSize",t,e,n),a=kZ("clearAfterRead",t,e,n),u=kZ("identicalElementShapes",t,e,n),c=kZ("name",t,e,n),l=new vQ(c,s,r,o,u,i,a);return n.addTensorArray(l),[l.idTensor,yK(1)]}case"TensorArrayWriteV3":{const r=kZ("tensorArrayId",t,e,n),s=kZ("index",t,e,n),o=kZ("tensor",t,e,n),i=n.getTensorArray(r.id);return i.write(s,o),[i.idTensor]}case"TensorArrayReadV3":{const r=kZ("tensorArrayId",t,e,n),s=kZ("index",t,e,n);return[n.getTensorArray(r.id).read(s)]}case"TensorArrayGatherV3":{const r=kZ("tensorArrayId",t,e,n),s=kZ("indices",t,e,n),o=kZ("dtype",t,e,n);return[n.getTensorArray(r.id).gather(s,o)]}case"TensorArrayScatterV3":{const r=kZ("tensorArrayId",t,e,n),s=kZ("indices",t,e,n),o=kZ("tensor",t,e,n),i=n.getTensorArray(r.id);return i.scatter(s,o),[i.idTensor]}case"TensorArrayConcatV3":{const r=kZ("tensorArrayId",t,e,n),s=n.getTensorArray(r.id),o=kZ("dtype",t,e,n);return[s.concat(o)]}case"TensorArraySplitV3":{const r=kZ("tensorArrayId",t,e,n),s=kZ("tensor",t,e,n),o=kZ("lengths",t,e,n),i=n.getTensorArray(r.id);return i.split(o,s),[i.idTensor]}case"TensorArraySizeV3":{const r=kZ("tensorArrayId",t,e,n);return[yK(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{const r=kZ("tensorArrayId",t,e,n),s=n.getTensorArray(r.id);return s.clearAndClose(),[s.idTensor]}case"TensorListSetItem":{const r=kZ("tensorListId",t,e,n),s=kZ("index",t,e,n),o=kZ("tensor",t,e,n),i=n.getTensorList(r.id);return i.setItem(s,o),[i.idTensor]}case"TensorListGetItem":{const r=kZ("tensorListId",t,e,n),s=kZ("index",t,e,n),o=kZ("elementShape",t,e,n),i=kZ("elementDType",t,e,n);return[n.getTensorList(r.id).getItem(s,o,i)]}case"TensorListScatterV2":case"TensorListScatter":{const r=kZ("indices",t,e,n),s=function(t,e,n,r){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const s=Math.max(...e);if(null!=r&&-1!==r&&s>=r)throw new Error(`Max index must be < array size (${s}  vs. ${r})`);const o=new xQ([],n,t.dtype,r),i=DJ(t,0);return e.forEach(((t,e)=>{o.setItem(t,i[e])})),o}(kZ("tensor",t,e,n),r,kZ("elementShape",t,e,n),kZ("numElements",t,e,n));return n.addTensorList(s),[s.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=kZ("elementShape",t,e,n),s=kZ("elementDType",t,e,n);let o;o="TensorListReserve"===t.op?"numElements":"maxNumElements";const i=function(t,e,n){return new xQ([],t,e,n)}(r,s,kZ(o,t,e,n));return n.addTensorList(i),[i.idTensor]}case"TensorListGather":{const r=kZ("tensorListId",t,e,n),s=kZ("indices",t,e,n),o=kZ("elementShape",t,e,n),i=kZ("elementDType",t,e,n);return[n.getTensorList(r.id).gather(s,i,o)]}case"TensorListStack":{const r=kZ("tensorListId",t,e,n),s=kZ("elementShape",t,e,n),o=kZ("elementDType",t,e,n),i=kZ("numElements",t,e,n);return[n.getTensorList(r.id).stack(s,o,i)]}case"TensorListFromTensor":{const r=function(t,e,n){const r=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);yQ(t.shape.slice(1),e,"TensorList shape mismatch: ");const s=DJ(t);return new xQ(s,e,r)}(kZ("tensor",t,e,n),kZ("elementShape",t,e,n),kZ("elementDType",t,e,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const r=kZ("tensorListId",t,e,n),s=n.getTensorList(r.id),o=kZ("dtype",t,e,n),i=kZ("elementShape",t,e,n);return[s.concat(o,i)]}case"TensorListPushBack":{const r=kZ("tensorListId",t,e,n),s=kZ("tensor",t,e,n),o=n.getTensorList(r.id);return o.pushBack(s),[o.idTensor]}case"TensorListPopBack":{const r=kZ("tensorListId",t,e,n),s=kZ("elementShape",t,e,n),o=kZ("elementDType",t,e,n);return[n.getTensorList(r.id).popBack(s,o)]}case"TensorListSplit":{const r=kZ("tensor",t,e,n),s=kZ("elementShape",t,e,n),o=function(t,e,n){let r=0;const s=e.map((t=>(r+=t,r)));if(r!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${r}, and tensor's shape is: ${t.shape}`);const o=wQ(t.shape.slice(1),n),i=0===r?0:t.size/r,a=tq((()=>{const n=[];t=bH(t,[1,r,i]);for(let r=0;r<e.length;++r){const a=[0,0===r?0:s[r-1],0],u=[1,e[r],i];n[r]=bH($H(t,a,u),o)}return t.dispose(),n})),u=new xQ([],n,t.dtype,e.length);for(let t=0;t<a.length;t++)u.setItem(t,a[t]);return u}(r,kZ("lengths",t,e,n),s);return n.addTensorList(o),[o.idTensor]}case"TensorListLength":{const r=kZ("tensorListId",t,e,n);return[yK(n.getTensorList(r.id).size(),"int32")]}case"TensorListResize":{const r=kZ("tensorListId",t,e,n),s=kZ("size",t,e,n),o=n.getTensorList(r.id).resize(s);return n.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Q(t,e,n){const[r,s]=kZ("fusedOps",t,e,n),o="biasadd"===r,i=!o,a="prelu"===s,u="fusedbatchnorm"===r,c=kZ("numArgs",t,e,n);if(o){if(a&&2!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&o&&1!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(u)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const l=kZ("strides",t,e,n),f=MZ(t,e,n),h=kZ("dataFormat",t,e,n).toUpperCase(),p=kZ("dilations",t,e,n);let[d,m]=kZ("args",t,e,n);i&&(m=d,d=void 0);return{stride:l,pad:f,dataFormat:h,dilations:p,biasArg:d,preluArg:m,activationFunc:s,leakyreluAlpha:kZ("leakyreluAlpha",t,e,n)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function EQ(t,e,n){return{boxes:kZ("boxes",t,e,n),scores:kZ("scores",t,e,n),maxOutputSize:kZ("maxOutputSize",t,e,n),iouThreshold:kZ("iouThreshold",t,e,n),scoreThreshold:kZ("scoreThreshold",t,e,n),softNmsSigma:kZ("softNmsSigma",t,e,n)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class SQ{constructor(t,e){this.keyDType=t,this.valueDType=e,this.handle=yK(0),this.tensorMap=new Map,nq(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return yK(this.size(),"int32")}async import(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),tq((()=>{const t=DJ(e),r=n.length,s=t.length;rz(r===s,(()=>`The number of elements doesn't match, keys has ${r} elements, the values has ${s} elements.`));for(let e=0;e<r;e++){const r=n[e],s=t[e];nq(s),this.tensorMap.set(r,s)}return this.handle}))}async find(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return tq((()=>{const t=[];for(let r=0;r<n.length;r++){const s=n[r],o=this.findWithDefault(s,e);t.push(o)}return SJ(t)}))}findWithDefault(t,e){const n=this.tensorMap.get(t);return null!=n?n:e}checkKeyAndValueTensor(t,e){if(t.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${t.dtype}`);if(e.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${e.dtype}`)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function _Q(t,e,n,r){const s=((t,e,n)=>{switch(t.category){case"arithmetic":return tq((()=>((t,e,n)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[Uq(kZ("a",t,e,n),kZ("b",t,e,n))];case"AddN":return[Jq(kZ("tensors",t,e,n))];case"FloorMod":case"Mod":return[hX(kZ("a",t,e,n),kZ("b",t,e,n))];case"Mul":return[qq(kZ("a",t,e,n),kZ("b",t,e,n))];case"RealDiv":case"Div":return[Gq(kZ("a",t,e,n),kZ("b",t,e,n))];case"DivNoNan":return[oK(kZ("a",t,e,n),kZ("b",t,e,n))];case"FloorDiv":return[jq(kZ("a",t,e,n),kZ("b",t,e,n))];case"Sub":return[KK(kZ("a",t,e,n),kZ("b",t,e,n))];case"Minimum":return[lX(kZ("a",t,e,n),kZ("b",t,e,n))];case"Maximum":return[iX(kZ("a",t,e,n),kZ("b",t,e,n))];case"Pow":return[mK(kZ("a",t,e,n),kZ("b",t,e,n))];case"SquaredDifference":return[$J(kZ("a",t,e,n),kZ("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"basic_math":return tq((()=>((t,e,n)=>{switch(t.op){case"Abs":case"ComplexAbs":return[Hq(kZ("x",t,e,n))];case"Acos":return[Kq(kZ("x",t,e,n))];case"Acosh":return[Xq(kZ("x",t,e,n))];case"Asin":return[eH(kZ("x",t,e,n))];case"Asinh":return[nH(kZ("x",t,e,n))];case"Atan":return[rH(kZ("x",t,e,n))];case"Atan2":return[sH(kZ("x",t,e,n),kZ("y",t,e,n))];case"Atanh":return[oH(kZ("x",t,e,n))];case"Ceil":return[RH(kZ("x",t,e,n))];case"Complex":return[Gj(kZ("real",t,e,n),kZ("imag",t,e,n))];case"Cos":return[HH(kZ("x",t,e,n))];case"Cosh":return[KH(kZ("x",t,e,n))];case"Elu":return[uK(kZ("x",t,e,n))];case"Erf":return[cK(kZ("x",t,e,n))];case"Exp":return[$K(kZ("x",t,e,n))];case"Expm1":return[SK(kZ("x",t,e,n))];case"Floor":return[AK(kZ("x",t,e,n))];case"Log":return[zK(kZ("x",t,e,n))];case"Log1p":return[WK(kZ("x",t,e,n))];case"Imag":return[rq(kZ("x",t,e,n))];case"Neg":return[sq(kZ("x",t,e,n))];case"Reciprocal":return[YX(kZ("x",t,e,n))];case"Real":return[oq(kZ("x",t,e,n))];case"Relu":return[ZX(kZ("x",t,e,n))];case"Round":return[oJ(kZ("x",t,e,n))];case"Selu":return[aJ(kZ("x",t,e,n))];case"Sigmoid":return[NH(kZ("x",t,e,n))];case"Sin":return[fJ(kZ("x",t,e,n))];case"Sign":return[lJ(kZ("x",t,e,n))];case"Sinh":return[hJ(kZ("x",t,e,n))];case"Softplus":return[qK(kZ("x",t,e,n))];case"Sqrt":return[gK(kZ("x",t,e,n))];case"Square":return[bK(kZ("x",t,e,n))];case"Tanh":return[EH(kZ("x",t,e,n))];case"Tan":return[kJ(kZ("x",t,e,n))];case"ClipByValue":return[DH(kZ("x",t,e,n),kZ("clipValueMin",t,e,n),kZ("clipValueMax",t,e,n))];case"Relu6":return[QX(kZ("x",t,e,n))];case"Rsqrt":return[iJ(AZ(t.inputNames[0],e,n))];case"Prod":return[TX(kZ("x",t,e,n),kZ("axes",t,e,n))];case"LeakyRelu":return[FK(kZ("x",t,e,n),kZ("alpha",t,e,n))];case"Prelu":return[_X(kZ("x",t,e,n),kZ("alpha",t,e,n))];case"IsNan":return[DK(AZ(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"control":return NQ(t,e,n);case"convolution":return tq((()=>((t,e,n)=>{switch(t.op){case"Conv1D":{const r=kZ("stride",t,e,n),s=kZ("pad",t,e,n),o=kZ("dataFormat",t,e,n).toUpperCase(),i=kZ("dilation",t,e,n);return[zH(kZ("x",t,e,n),kZ("filter",t,e,n),r,s,o,i)]}case"Conv2D":{const r=kZ("strides",t,e,n),s=MZ(t,e,n),o=kZ("dataFormat",t,e,n).toUpperCase(),i=kZ("dilations",t,e,n);return[VH(kZ("x",t,e,n),kZ("filter",t,e,n),[r[1],r[2]],s,o,[i[1],i[2]])]}case"_FusedConv2D":{const{stride:r,pad:s,dataFormat:o,dilations:i,biasArg:a,preluArg:u,activationFunc:c,leakyreluAlpha:l}=$Q(t,e,n);return[QJ({x:kZ("x",t,e,n),filter:kZ("filter",t,e,n),strides:[r[1],r[2]],pad:s,dataFormat:o,dilations:[i[1],i[2]],bias:a,activation:c,preluActivationWeights:u,leakyreluAlpha:l})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:s,dataFormat:o,dilations:i,biasArg:a,preluArg:u,activationFunc:c,leakyreluAlpha:l}=$Q(t,e,n);return[nY({x:kZ("x",t,e,n),filter:kZ("filter",t,e,n),strides:[r[1],r[2]],pad:s,dataFormat:o,dilations:[i[1],i[2]],bias:a,activation:c,preluActivationWeights:u,leakyreluAlpha:l})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=kZ("outputShape",t,e,n),s=kZ("strides",t,e,n),o=MZ(t,e,n);return[UH(kZ("x",t,e,n),kZ("filter",t,e,n),r,[s[1],s[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=kZ("strides",t,e,n),s=MZ(t,e,n),o=kZ("dilations",t,e,n),i=kZ("dataFormat",t,e,n).toUpperCase();return[QH(kZ("input",t,e,n),kZ("filter",t,e,n),[r[1],r[2]],s,i,[o[1],o[2]])]}case"Conv3D":{const r=kZ("strides",t,e,n),s=kZ("pad",t,e,n),o=kZ("dataFormat",t,e,n).toUpperCase(),i=kZ("dilations",t,e,n);return[jH(kZ("x",t,e,n),kZ("filter",t,e,n),[r[1],r[2],r[3]],s,o,[i[1],i[2],i[3]])]}case"AvgPool":{const r=kZ("strides",t,e,n),s=kZ("pad",t,e,n),o=kZ("kernelSize",t,e,n);return[wH(kZ("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s)]}case"MaxPool":{const r=kZ("strides",t,e,n),s=kZ("pad",t,e,n),o=kZ("kernelSize",t,e,n);return[rX(kZ("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s)]}case"MaxPoolWithArgmax":{const r=kZ("strides",t,e,n),s=kZ("pad",t,e,n),o=kZ("kernelSize",t,e,n),i=kZ("includeBatchInIndex",t,e,n),{result:a,indexes:u}=oX(kZ("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s,i);return[a,u]}case"AvgPool3D":{const r=kZ("strides",t,e,n),s=kZ("pad",t,e,n),o=kZ("kernelSize",t,e,n);return[vH(kZ("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],s)]}case"MaxPool3D":{const r=kZ("strides",t,e,n),s=kZ("pad",t,e,n),o=kZ("kernelSize",t,e,n);return[sX(kZ("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],s)]}case"Dilation2D":{const r=kZ("strides",t,e,n),s=kZ("pad",t,e,n),o=kZ("dilations",t,e,n),i=r[1],a=r[2],u=o[1],c=o[2];return[eK(kZ("x",t,e,n),kZ("filter",t,e,n),[i,a],s,[u,c],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"creation":return tq((()=>((t,e,n)=>{switch(t.op){case"Fill":{const r=kZ("shape",t,e,n),s=kZ("dtype",t,e,n);return[kK(r,kZ("value",t,e,n),s)]}case"LinSpace":return[BK(kZ("start",t,e,n),kZ("stop",t,e,n),kZ("num",t,e,n))];case"Multinomial":{const r=kZ("logits",t,e,n),s=kZ("numSamples",t,e,n),o=kZ("seed",t,e,n);return[mX(r,s,o)]}case"OneHot":{const r=kZ("indices",t,e,n),s=kZ("depth",t,e,n),o=kZ("onValue",t,e,n),i=kZ("offValue",t,e,n);return[QG(r,s,o,i)]}case"Ones":return[cX(kZ("shape",t,e,n),kZ("dtype",t,e,n))];case"OnesLike":return[gX(kZ("x",t,e,n))];case"RandomUniform":return[XX(kZ("shape",t,e,n),kZ("minval",t,e,n),kZ("maxval",t,e,n),kZ("dtype",t,e,n))];case"Range":return[JX(kZ("start",t,e,n),kZ("stop",t,e,n),kZ("step",t,e,n),kZ("dtype",t,e,n))];case"TruncatedNormal":{const r=kZ("shape",t,e,n),s=kZ("mean",t,e,n),o=kZ("stdDev",t,e,n),i=kZ("seed",t,e,n);return[IJ(r,s,o,kZ("dtype",t,e,n),i)]}case"Zeros":return[uX(kZ("shape",t,e,n),kZ("dtype",t,e,n))];case"ZerosLike":return[sK(kZ("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"dynamic":return(async(t,e,n)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a,softNmsSigma:u}=EQ(t,e,n),c=await nZ.nonMaxSuppressionWithScoreAsync(r,s,o,i,a,u);return[c.selectedIndices,c.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a}=EQ(t,e,n),u=kZ("padToMaxOutputSize",t,e,n),c=await nZ.nonMaxSuppressionPaddedAsync(r,s,o,i,a,u);return[c.selectedIndices,c.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a}=EQ(t,e,n);return[await nZ.nonMaxSuppressionAsync(r,s,o,i,a)]}case"Where":{const r=MG(kZ("condition",t,e,n),"bool"),s=[await PJ(r)];return r.dispose(),s}case"ListDiff":return cJ(kZ("x",t,e,n),kZ("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n);case"evaluation":return tq((()=>((t,e,n)=>{switch(t.op){case"LowerBound":return[nX(kZ("sortedSequence",t,e,n),kZ("values",t,e,n))];case"TopKV2":{const r=kZ("x",t,e,n),s=kZ("k",t,e,n),o=kZ("sorted",t,e,n),i=OJ(r,s,o);return[i.values,i.indices]}case"UpperBound":return[FJ(kZ("sortedSequence",t,e,n),kZ("values",t,e,n))];case"Unique":{const r=kZ("x",t,e,n),s=MJ(r);return[s.values,s.indices]}case"UniqueV2":{const r=kZ("x",t,e,n),s=kZ("axis",t,e,n),o=MJ(r,s);return[o.values,o.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"image":return tq((()=>((t,e,n)=>{switch(t.op){case"ResizeBilinear":{const r=kZ("images",t,e,n),s=kZ("size",t,e,n),o=kZ("alignCorners",t,e,n),i=kZ("halfPixelCenters",t,e,n);return[nZ.resizeBilinear(r,[s[0],s[1]],o,i)]}case"ResizeNearestNeighbor":{const r=kZ("images",t,e,n),s=kZ("size",t,e,n),o=kZ("alignCorners",t,e,n),i=kZ("halfPixelCenters",t,e,n);return[nZ.resizeNearestNeighbor(r,[s[0],s[1]],o,i)]}case"CropAndResize":{const r=kZ("image",t,e,n),s=kZ("boxes",t,e,n),o=kZ("boxInd",t,e,n),i=kZ("cropSize",t,e,n),a=kZ("method",t,e,n),u=kZ("extrapolationValue",t,e,n);return[nZ.cropAndResize(r,s,o,i,a,u)]}case"ImageProjectiveTransformV3":{const r=kZ("images",t,e,n),s=kZ("transforms",t,e,n),o=kZ("outputShape",t,e,n),i=kZ("fillValue",t,e,n),a=kZ("interpolation",t,e,n),u=kZ("fillMode",t,e,n);return[nZ.transform(r,s,a.toLowerCase(),u.toLowerCase(),i,o)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"graph":return tq((()=>((t,e,n)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const r=kZ("default",t,e,n);return[AZ(t.name,e,n)||r];case"Placeholder":return[AZ(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[RZ(kZ("x",t,e,n))];case"IdentityN":return kZ("x",t,e,n).map((t=>RZ(t)));case"Shape":return[AJ(kZ("x",t,e,n).shape,"int32")];case"ShapeN":return kZ("x",t,e,n).map((t=>AJ(t.shape)));case"Size":return[yK(kZ("x",t,e,n).size,"int32")];case"Rank":return[yK(kZ("x",t,e,n).rank,"int32")];case"NoOp":return[yK(1)];case"Print":const s=kZ("x",t,e,n),o=kZ("data",t,e,n),i=kZ("message",t,e,n),a=kZ("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(i);for(let t=0;t<o.length;t++)console.log(Array.prototype.slice.call(o[t].dataSync()).slice(0,a));return[s];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"logical":return tq((()=>((t,e,n)=>{switch(t.op){case"Equal":return[nK(kZ("a",t,e,n),kZ("b",t,e,n))];case"NotEqual":return[yX(kZ("a",t,e,n),kZ("b",t,e,n))];case"Greater":return[OK(kZ("a",t,e,n),kZ("b",t,e,n))];case"GreaterEqual":return[IK(kZ("a",t,e,n),kZ("b",t,e,n))];case"Less":return[LK(kZ("a",t,e,n),kZ("b",t,e,n))];case"LessEqual":return[PK(kZ("a",t,e,n),kZ("b",t,e,n))];case"LogicalAnd":return[YK(kZ("a",t,e,n),kZ("b",t,e,n))];case"LogicalNot":return[ZK(kZ("a",t,e,n))];case"LogicalOr":return[QK(kZ("a",t,e,n),kZ("b",t,e,n))];case"Select":case"SelectV2":return[rK(kZ("condition",t,e,n),kZ("a",t,e,n),kZ("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"matrices":return tq((()=>((t,e,n)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[ZG(kZ("a",t,e,n),kZ("b",t,e,n),kZ("transposeA",t,e,n),kZ("transposeB",t,e,n))];case"Einsum":return[aK(kZ("equation",t,e,n),...kZ("tensors",t,e,n))];case"Transpose":return[iq(kZ("x",t,e,n),kZ("perm",t,e,n))];case"_FusedMatMul":const[r,s]=kZ("fusedOps",t,e,n),o="biasadd"===r,i="prelu"===s,a=kZ("numArgs",t,e,n),u=kZ("leakyreluAlpha",t,e,n);if(o){if(i&&2!==a)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!i&&1!==a)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[c,l]=kZ("args",t,e,n);return[rY({a:kZ("a",t,e,n),b:kZ("b",t,e,n),transposeA:kZ("transposeA",t,e,n),transposeB:kZ("transposeB",t,e,n),bias:c,activation:s,preluActivationWeights:l,leakyreluAlpha:u})];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"normalization":return tq((()=>((t,e,n)=>{switch(t.op){case"EuclideanNorm":return[NK(kZ("x",t,e,n),kZ("axis",t,e,n),kZ("keepDims",t,e,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[TH(kZ("x",t,e,n),kZ("mean",t,e,n),kZ("variance",t,e,n),kZ("offset",t,e,n),kZ("scale",t,e,n),kZ("epsilon",t,e,n))];case"LRN":return[VK(kZ("x",t,e,n),kZ("radius",t,e,n),kZ("bias",t,e,n),kZ("alpha",t,e,n),kZ("beta",t,e,n))];case"Softmax":return[gJ(kZ("x",t,e,n))];case"LogSoftmax":return[XK(kZ("x",t,e,n))];case"SparseToDense":return[WJ(kZ("sparseIndices",t,e,n),kZ("outputShape",t,e,n),kZ("sparseValues",t,e,n),kZ("defaultValue",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"reduction":return tq((()=>((t,e,n)=>{switch(t.op){case"Max":{const r=kZ("axis",t,e,n),s=kZ("keepDims",t,e,n);return[pK(kZ("x",t,e,n),r,s)]}case"Mean":{const r=kZ("axis",t,e,n),s=kZ("keepDims",t,e,n);return[aX(kZ("x",t,e,n),r,s)]}case"Min":{const r=kZ("axis",t,e,n),s=kZ("keepDims",t,e,n);return[dK(kZ("x",t,e,n),r,s)]}case"Sum":{const r=kZ("axis",t,e,n),s=kZ("keepDims",t,e,n);return[wK(kZ("x",t,e,n),r,s)]}case"All":{const r=kZ("axis",t,e,n),s=kZ("keepDims",t,e,n);return[Yq(kZ("x",t,e,n),r,s)]}case"Any":{const r=kZ("axis",t,e,n),s=kZ("keepDims",t,e,n);return[Zq(kZ("x",t,e,n),r,s)]}case"ArgMax":{const r=kZ("axis",t,e,n);return[Qq(kZ("x",t,e,n),r)]}case"ArgMin":{const r=kZ("axis",t,e,n);return[tH(kZ("x",t,e,n),r)]}case"Prod":{const r=kZ("axis",t,e,n),s=kZ("keepDims",t,e,n);return[TX(kZ("x",t,e,n),r,s)]}case"Cumprod":{const r=kZ("axis",t,e,n),s=kZ("exclusive",t,e,n),o=kZ("reverse",t,e,n);return[XH(kZ("x",t,e,n),r,s,o)]}case"Cumsum":{const r=kZ("axis",t,e,n),s=kZ("exclusive",t,e,n),o=kZ("reverse",t,e,n);return[JH(kZ("x",t,e,n),r,s,o)]}case"Bincount":const r=kZ("x",t,e,n),s=kZ("weights",t,e,n),o=kZ("size",t,e,n);return[OH(r,s,o)];case"DenseBincount":{const r=kZ("x",t,e,n),s=kZ("weights",t,e,n),o=kZ("size",t,e,n),i=kZ("binaryOutput",t,e,n);return[YH(r,s,o,i)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"slice_join":return tq((()=>((t,e,n)=>{switch(t.op){case"ConcatV2":case"Concat":{const r=kZ("n",t,e,n),s=kZ("axis",t,e,n);let o=kZ("tensors",t,e,n);return o=o.slice(0,r),[xH(o,s)]}case"Gather":{const r=kZ("x",t,e,n),s=kZ("indices",t,e,n);return[CK(r,MG(s,"int32"),0)]}case"GatherV2":{const r=kZ("axis",t,e,n),s=kZ("batchDims",t,e,n),o=kZ("x",t,e,n),i=kZ("indices",t,e,n);return[CK(o,MG(i,"int32"),r,s)]}case"Reverse":{const r=kZ("dims",t,e,n),s=[];for(let t=0;t<r.length;t++)r[t]&&s.push(t);const o=kZ("x",t,e,n);return[tJ(o,s)]}case"ReverseV2":{const r=kZ("axis",t,e,n),s=kZ("x",t,e,n);return[tJ(s,r)]}case"Slice":{const r=kZ("begin",t,e,n),s=kZ("size",t,e,n);return[$H(kZ("x",t,e,n),r,s)]}case"StridedSlice":{const r=kZ("begin",t,e,n),s=kZ("end",t,e,n),o=kZ("strides",t,e,n),i=kZ("beginMask",t,e,n),a=kZ("endMask",t,e,n),u=kZ("ellipsisMask",t,e,n),c=kZ("newAxisMask",t,e,n),l=kZ("shrinkAxisMask",t,e,n),f=kZ("x",t,e,n);return[TJ(f,r,s,o,i,a,u,c,l)]}case"Pack":return tq((()=>{const r=kZ("axis",t,e,n),s=kZ("tensors",t,e,n),o=s[0].shape,i=EJ(s[0]).shape,a=s.map((t=>{const e=uz(t.shape,o);if(!e&&!uz(EJ(t).shape,i))throw new Error("the input tensors shape does not match");return e?t:bH(t,o)}));return[SJ(a,r)]}));case"Unpack":{const r=kZ("axis",t,e,n),s=kZ("tensor",t,e,n);return DJ(s,r)}case"Tile":{const r=kZ("reps",t,e,n);return[_K(kZ("x",t,e,n),r)]}case"Split":case"SplitV":{const r=kZ("axis",t,e,n),s=kZ("numOrSizeSplits",t,e,n),o=kZ("x",t,e,n);return xJ(o,s,r)}case"ScatterNd":{const r=kZ("indices",t,e,n),s=kZ("values",t,e,n),o=kZ("shape",t,e,n);return[zJ(r,s,o)]}case"GatherNd":{const r=kZ("x",t,e,n),s=kZ("indices",t,e,n);return[UJ(r,s)]}case"SparseToDense":{const r=kZ("sparseIndices",t,e,n),s=kZ("outputShape",t,e,n),o=kZ("sparseValues",t,e,n),i=kZ("defaultValue",t,e,n);return[WJ(r,o,s,o.dtype===i.dtype?i:MG(i,o.dtype))]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"sparse":return tq((()=>((t,e,n)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:s,emptyRowIndicator:o,reverseIndexMap:i}=oZ.sparseFillEmptyRows(kZ("indices",t,e,n),kZ("values",t,e,n),kZ("denseShape",t,e,n),kZ("defaultValue",t,e,n));return[r,s,o,i]}case"SparseReshape":{const{outputIndices:r,outputShape:s}=oZ.sparseReshape(kZ("inputIndices",t,e,n),kZ("inputShape",t,e,n),kZ("newShape",t,e,n));return[r,s]}case"SparseSegmentMean":return[oZ.sparseSegmentMean(kZ("data",t,e,n),kZ("indices",t,e,n),kZ("segmentIds",t,e,n))];case"SparseSegmentSum":return[oZ.sparseSegmentSum(kZ("data",t,e,n),kZ("indices",t,e,n),kZ("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"spectral":return tq((()=>((t,e,n)=>{switch(t.op){case"FFT":return[bJ(kZ("x",t,e,n))];case"IFFT":return[wJ(kZ("x",t,e,n))];case"RFFT":return[NJ(kZ("x",t,e,n))];case"IRFFT":return[vJ(kZ("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"string":return tq((()=>((t,e,n)=>{switch(t.op){case"StringNGrams":{const{nGrams:r,nGramsSplits:s}=iZ.stringNGrams(kZ("data",t,e,n),kZ("dataSplits",t,e,n),kZ("separator",t,e,n),kZ("nGramWidths",t,e,n),kZ("leftPad",t,e,n),kZ("rightPad",t,e,n),kZ("padWidth",t,e,n),kZ("preserveShortSequences",t,e,n));return[r,s]}case"StringSplit":{const{indices:r,values:s,shape:o}=iZ.stringSplit(kZ("input",t,e,n),kZ("delimiter",t,e,n),kZ("skipEmpty",t,e,n));return[r,s,o]}case"StringToHashBucketFast":return[iZ.stringToHashBucketFast(kZ("input",t,e,n),kZ("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"transformation":return tq((()=>((t,e,n)=>{switch(t.op){case"Cast":return[MG(kZ("x",t,e,n),kZ("dtype",t,e,n))];case"ExpandDims":{const r=kZ("axis",t,e,n);return[EK(kZ("x",t,e,n),r)]}case"Squeeze":{const r=kZ("axis",t,e,n);return[EJ(kZ("x",t,e,n),r)]}case"Reshape":return[bH(kZ("x",t,e,n),kZ("shape",t,e,n))];case"MirrorPad":return[fX(kZ("x",t,e,n),kZ("padding",t,e,n),kZ("mode",t,e,n))];case"PadV2":case"Pad":return[wX(kZ("x",t,e,n),kZ("padding",t,e,n),kZ("constantValue",t,e,n))];case"SpaceToBatchND":{const r=kZ("blockShape",t,e,n),s=kZ("paddings",t,e,n);return[EX(kZ("x",t,e,n),r,s)]}case"BatchToSpaceND":{const r=kZ("blockShape",t,e,n),s=kZ("crops",t,e,n);return[_H(kZ("x",t,e,n),r,s)]}case"DepthToSpace":{const r=kZ("blockSize",t,e,n),s=kZ("dataFormat",t,e,n).toUpperCase();return[ZH(kZ("x",t,e,n),r,s)]}case"BroadcastTo":return[MH(kZ("x",t,e,n),kZ("shape",t,e,n))];case"BroadcastArgs":return[IH(kZ("s0",t,e,n),kZ("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"hash_table":return(async(t,e,n,r)=>{switch(t.op){case"HashTable":case"HashTableV2":{const s=kZ("keyDType",t,e,n),o=kZ("valueDType",t,e,n),i=new SQ(s,o);return r.addHashTable(t.name,i),[i.handle]}case"LookupTableImport":case"LookupTableImportV2":{const s=kZ("tableHandle",t,e,n,r),o=kZ("keys",t,e,n),i=kZ("values",t,e,n),a=r.getHashTableById(s.id);return[await a.import(o,i)]}case"LookupTableFind":case"LookupTableFindV2":{const s=kZ("tableHandle",t,e,n,r),o=kZ("keys",t,e,n),i=kZ("defaultValue",t,e,n),a=r.getHashTableById(s.id);return[await a.find(o,i)]}case"LookupTableSize":case"LookupTableSizeV2":{const s=kZ("tableHandle",t,e,n,r);return[r.getHashTableById(s.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n,r);case"custom":const s=TZ(t.op);if(s&&s.customExecutor)return s.customExecutor(new mQ(t,e,n));throw TypeError(`Custom op ${t.op} is not registered.`);default:throw TypeError(`Unknown op '${t.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return Iz(s)?s.then((t=>[].concat(t))):[].concat(s)}class TQ{constructor(t={},e={},n={},r={}){this.weightMap=t,this.tensorArrayMap=e,this.tensorListMap=n,this.functionMap=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(t,e){return{id:t,frameName:e,iterationId:0}}set currentContext(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const t=[];for(let e=0;e<this.contexts.length-1;e++){const n=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(n))}t.push(""),this._currentContextIds=t}contextIdforContexts(t){return t?t.map((t=>0===t.id&&0===t.iterationId?"":`${t.frameName}-${t.iterationId}`)).join("/"):""}enterFrame(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(t){return this.weightMap[t]}addTensorArray(t){this.tensorArrayMap[t.id]=t}getTensorArray(t){return this.tensorArrayMap[t]}addTensorList(t){this.tensorListMap[t.id]=t}getTensorList(t){return this.tensorListMap[t]}dispose(t){for(const e in this.tensorArrayMap)this.tensorArrayMap[e].clearAndClose(t);for(const e in this.tensorListMap)this.tensorListMap[e].clearAndClose(t)}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kQ(t,e,n,r){const s=new Set,o=[];let i=null,a=null;const u=new Set,c=Object.keys(t).map((t=>IZ(t)[0]));let l=[];null!=r&&(l=r.map((t=>IZ(t.name)[0])));const f=[...e];for(;f.length>0;){const t=f.pop();(IQ(t)||MQ(t)||RQ(t))&&null==i&&(i=t,a=i.children.map((t=>t.name)).filter((t=>s.has(t)))),s.add(t.name),null==n[t.name]&&(-1===c.indexOf(t.name)&&-1===l.indexOf(t.name)&&(0!==t.inputs.length?t.inputs.forEach((t=>{u.has(t.name)||(u.add(t.name),f.push(t))})):o.push(t.name)))}return{inputs:t,outputs:e,usedNodes:s,missingInputs:o,dynamicNode:i,syncInputs:a}}const AQ=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],CQ=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],OQ=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function IQ(t){return AQ.indexOf(t.op)>=0}function MQ(t){return CQ.indexOf(t.op)>=0}function RQ(t){return OQ.indexOf(t.op)>=0}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DQ{constructor(t,e){this.graph=t,this.parent=e,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((e=>{this._functionExecutorMap[e]=new DQ(t.functions[e],this)}))}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){const e=Object.keys(t).map((e=>t[e].map((t=>t.id))));this._weightIds=[].concat(...e),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get outputs(){return this._outputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get inputNodes(){return this._inputs.map((t=>t.signatureKey||t.name))}get outputNodes(){return this._outputs.map((t=>{const e=t.signatureKey||t.name;return t.defaultOutput?`${e}:${t.defaultOutput}`:e}))}get functions(){return Object.keys(this._functions).reduce(((t,e)=>(t[e]=this._functions[e].signature,t)),{})}getCompilationKey(t,e){const n=t.map((t=>t.name)).sort(),r=e.map((t=>t.name)).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}compile(t,e){const n=kQ(t,e,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:s,syncInputs:o}=n;if(null!=s)throw new Error(`This execution contains the node '${s.name}', which has the dynamic op '${s.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(r.length>0){const n=e.map((t=>t.name)),s=Object.keys(t);throw new Error(`Cannot compute the outputs [${n}] from the provided inputs [${s}]. Missing the following inputs: [${r}]`)}return function(t,e,n){const{usedNodes:r,inputs:s}=n,o=[],i=Object.keys(s).map((t=>IZ(t)[0])).map((e=>t.nodes[e])),a=t.initNodes;i.forEach((t=>{r.has(t.name)&&o.push(t)})),t.weights.forEach((t=>{r.has(t.name)&&o.push(t)})),null!=a&&a.forEach((t=>{r.has(t.name)&&o.push(t)}));const u=new Set,c=[];for(;o.length>0;){const t=o.pop();u.add(t.name),e[t.name]||c.push(t),t.children.forEach((t=>{!u.has(t.name)&&r.has(t.name)&&t.inputs.every((t=>u.has(t.name)))&&o.push(t)}))}return c}(this.graph,this.weightMap,n)}execute(t,e){t=this.mapInputs(t);const n=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e);const r=n.map((t=>this.graph.nodes[IZ(t)[0]])),s=e.map((t=>IZ(t)[0]));let o=s.map((t=>this.graph.nodes[t]));this.resetIntermediateTensors(),0===o.length&&(o=this._outputs);const i=this.getCompilationKey(r,o);let a=this.compiledMap.get(i);null==a&&(a=this.compile(t,o),this.compiledMap.set(i,a));const u={},c={};return tq((()=>{const n=new TQ(this.weightMap,u,c,this.functionExecutorMap),r=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,s]=IZ(e),o=[];o[s]=t[e],r[n]=o}));const o=this.getFrozenTensorIds(r),i={};for(let t=0;t<a.length;t++){const e=a[t];if(!r[e.name]){const t=_Q(e,r,n,this._resourceManager);if(Iz(t))throw new Error(`The execution of the op '${e.op}' returned a promise. Please use model.executeAsync() instead.`);r[e.name]=t,this.checkTensorForDisposal(e.name,e,r,n,o,s,i)}}return null==this.parent&&n.dispose(o),e.map((t=>AZ(t,r,n)))}))}getFrozenTensorIds(t){const e=[].concat.apply([],Object.keys(t).map((e=>t[e])).map((t=>t.map((t=>t.id)))));return new Set(e)}checkTensorForDisposal(t,e,n,r,s,o,i){"control"!==e.category&&-1===o.indexOf(t)&&(n[t].forEach((t=>{null!=t&&(i[t.id]=(i[t.id]||0)+e.children.length)})),e.inputs.forEach((t=>{if("control"!==t.category){const o=function(t,e,n){return e[OZ(t,n.currentContextId)]}(t.name,n,r);null!=o&&o.forEach((t=>{if(t&&!t.kept&&!s.has(t.id)){const n=i[t.id];if(1===n){if(this.keepTensorForDebug){const[n,s]=CZ(e.name,r);this.intermediateTensors[n]||(this.intermediateTensors[n]=[]),this.intermediateTensors[n][s]=t}else t.dispose();delete i[t.id]}else null!=n&&i[t.id]--}}))}})))}async executeAsync(t,e){return this._executeAsync(t,e)}disposeIntermediateTensors(){this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach((t=>this.intermediateTensors[t].forEach((t=>t.dispose())))),this.disposeTensorsMap())}disposeTensorsMap(){this.tensorsMap&&Object.keys(this.tensorsMap).forEach((t=>{this.tensorsMap[t].forEach((t=>{!t||t.kept||t.isDisposed||this.keepIds.has(t.id)||t.dispose()}))}))}getIntermediateTensors(){return this.tensorsMap}resetIntermediateTensors(){for(const t in this.intermediateTensors)this.intermediateTensors[t].forEach((t=>t.dispose())),delete this.intermediateTensors[t]}async _executeAsync(t,e,n=!1,r={},s={}){n||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e));try{this.keepTensorForDebug=Dz().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(t){console.warn(t.message)}this.resetIntermediateTensors();const o=new TQ(this.weightMap,r,s,this.functionExecutorMap);this.tensorsMap=await this.executeWithControlFlow(t,o,e,n);const i=e.map((t=>AZ(t,this.tensorsMap,o))),a=i.map((t=>t.id)),u=Object.keys(t).map((e=>t[e].id));return this.keepIds=new Set([...a,...u,...this.weightIds]),this.keepTensorForDebug||this.disposeTensorsMap(),null==this.parent&&o.dispose(this.keepIds),i}async executeFunctionAsync(t,e,n){const r=t.reduce(((t,e,n)=>(t[this.inputs[n].name]=e,t)),{});return this._executeAsync(r,this.outputNodes,!0,e,n)}async executeWithControlFlow(t,e,n,r){const s=Object.keys(t),o=s.map((t=>this.graph.nodes[IZ(t)[0]])),i=n.map((t=>IZ(t)[0]));let a=i.map((t=>this.graph.nodes[t]));0===a.length&&(a=this._outputs);const{usedNodes:u,missingInputs:c,dynamicNode:l,syncInputs:f}=kQ(t,a,this.weightMap,this._initNodes),h=[...o,...this.graph.weights,...this._initNodes||[]].map((t=>({node:t,contexts:e.currentContext}))),p=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,r]=IZ(e),s=[];s[r]=t[e],p[n]=s}));const d={},m=this.getFrozenTensorIds(p),y={};for(;h.length>0;){const t=this.processStack(o,h,e,p,y,m,i,d,u);await Promise.all(t)}null!=l||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const g=a.filter((t=>!IQ(t)&&!AZ(t.name,p,e))).map((t=>t.name));if(g.length>0){let t="";throw null!=l&&(t=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${f}]`),new Error(`Cannot compute the outputs [${g}] from the provided inputs [${s}]. Consider providing the following inputs: [${c}]. ${t}`)}return p}processStack(t,e,n,r,s,o,i,a,u){const c=[];for(;e.length>0;){const t=e.pop();n.currentContext=t.contexts;let l="";if("Enter"===t.node.op&&kZ("isConstant",t.node,r,n)&&([l]=CZ(t.node.name,n)),null==r[t.node.name]){const f=_Q(t.node,r,n,this._resourceManager);l||([l]=CZ(t.node.name,n));const h=n.currentContext;Iz(f)?c.push(f.then((c=>(r[l]=c,n.currentContext=h,this.checkTensorForDisposal(l,t.node,r,n,o,i,a),this.processChildNodes(t.node,e,n,r,s,u),c)))):(r[l]=f,this.checkTensorForDisposal(l,t.node,r,n,o,i,a),this.processChildNodes(t.node,e,n,r,s,u))}else this.processChildNodes(t.node,e,n,r,s,u)}return c}processChildNodes(t,e,n,r,s,o){t.children.forEach((t=>{const[i]=CZ(t.name,n);!s[i]&&o.has(t.name)&&("Merge"===t.op?t.inputNames.some((t=>!!AZ(t,r,n)))&&(s[i]=!0,e.push({contexts:n.currentContext,node:t})):t.inputNames.every((t=>!!AZ(t,r,n)))&&(s[i]=!0,e.push({contexts:n.currentContext,node:t})))}))}dispose(){Object.keys(this.weightMap).forEach((t=>this.weightMap[t].forEach((t=>t.dispose()))))}checkInputShapeAndType(t){Object.keys(t).forEach((e=>{const n=t[e],[r]=IZ(e),s=this.graph.nodes[r];if(s.attrParams.shape&&s.attrParams.shape.value){const t=s.attrParams.shape.value,e=t.length===n.shape.length&&n.shape.every(((e,n)=>-1===t[n]||t[n]===e));rz(e,(()=>`The shape of dict['${s.name}'] provided in model.execute(dict) must be [${t}], but was [${n.shape}]`))}s.attrParams.dtype&&s.attrParams.dtype.value&&rz(n.dtype===s.attrParams.dtype.value,(()=>`The dtype of dict['${s.name}'] provided in model.execute(dict) must be ${s.attrParams.dtype.value}, but was ${n.dtype}`))}))}mapInputs(t){const e={};for(const n in t)if(null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]){e[this._signature.inputs[n].name]=t[n]}else e[n]=t[n];return e}checkInputs(t){const e=Object.keys(t).filter((t=>{const[e]=IZ(t);return null==this.graph.nodes[e]}));if(e.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${e}] that are not part of graph`)}mapOutputs(t){return t.map((t=>{if(null!=this._signature&&null!=this._signature.outputs&&null!=this._signature.outputs[t]){return this._signature.outputs[t].name}return t}),{})}checkOutputs(t){t.forEach((t=>{const[e]=IZ(t);if(!this.graph.nodes[e])throw new Error(`The output '${t}' is not found in the graph`)}))}}class FQ{constructor(t={},e={}){this.hashTableNameToHandle=t,this.hashTableMap=e}addHashTable(t,e){this.hashTableNameToHandle[t]=e.handle,this.hashTableMap[e.id]=e}getHashTableHandleByName(t){return this.hashTableNameToHandle[t]}getHashTableById(t){return this.hashTableMap[t]}dispose(){for(const t in this.hashTableMap)this.hashTableMap[t].clearAndClose(),delete this.hashTableMap[t];for(const t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LQ{constructor(t,e={}){this.modelUrl=t,this.loadOptions=e,this.version="n/a",null==e&&(this.loadOptions={}),this.resourceManager=new FQ}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}findIOHandler(){const t=this.modelUrl;if(null!=t.load)this.handler=t;else if(null!=this.loadOptions.requestInit)this.handler=qG(t,this.loadOptions);else{const e=aG(t,this.loadOptions);if(0===e.length)e.push(qG(t,this.loadOptions));else if(e.length>1)throw new Error(`Found more than one (${e.length}) load handlers for URL '${[t]}'`);this.handler=e[0]}}load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const t=this.handler.load();return Iz(t)?t.then((t=>this.loadSync(t))):this.loadSync(t)}loadSync(t){this.artifacts=t;const e=this.artifacts.modelTopology;let n;n=null!=this.artifacts.userDefinedMetadata&&null!=this.artifacts.userDefinedMetadata.signature?this.artifacts.userDefinedMetadata.signature:this.artifacts.signature,this.signature=n,this.version=`${e.versions.producer}.${e.versions.minConsumer}`;const r=Xj(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new DQ(tQ.Instance.transformGraph(e,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=t.modelInitializer&&null!=t.modelInitializer.node){const e=tQ.Instance.transformGraph(t.modelInitializer);this.initializer=new DQ(e),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(t,e){if("string"==typeof t){const e=iG(t);if(0===e.length)throw new Error(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new Error(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}if(null==t.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return t.save(this.artifacts)}predict(t,e){return this.execute(t,this.outputNodes)}normalizeInputs(t){if(!(t instanceof wU||Array.isArray(t)))return t;if((t=Array.isArray(t)?t:[t]).length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${t.length} input tensors.`);return this.inputNodes.reduce(((e,n,r)=>(e[n]=t[r],e)),{})}normalizeOutputs(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]}execute(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=this.executor.execute(t,e);return n.length>1?n:n[0]}async executeAsync(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=await this.executor.executeAsync(t,e);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(t){return Object.keys(t).reduce(((e,n)=>(e[n]=[t[n]],e)),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var PQ=Object.freeze({__proto__:null,GraphModel:LQ,loadGraphModel:async function(t,e={}){if(null==t)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==e&&(e={}),e.fromTFHub&&"string"==typeof t&&(t=function(t){t.endsWith("/")||(t+="/");return`${t}model.json?tfjs-format=file`}
/** @license See the LICENSE file. */(t));const n=new LQ(t,e);return await n.load(),n},loadGraphModelSync:function(t){if(null==t)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide a url or an IOHandler that loads the model");if(!t.load)throw new Error(`modelUrl IO Handler ${t} has no load function`);const e=new LQ(t);return e.load(),e},deregisterOp:function(t){delete _Z[t]},registerOp:function(t,e){const n={tfOpName:t,category:"custom",inputs:[],attrs:[],customExecutor:e};_Z[t]=n},version_converter:"3.18.0"});!function(t,e,n,r){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},s(t,e)};function o(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var i=function(){return i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},i.apply(this,arguments)};function a(t,e,n,r){function s(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?n(t.value):s(t.value).then(i,a)}u((r=r.apply(t,e||[])).next())}))}function u(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(t){return function(e){return u([t,e])}}function u(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((s=(s=i.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var c=["nose","left_eye","right_eye","left_ear","right_ear","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle"],l=["nose","left_eye_inner","left_eye","left_eye_outer","right_eye_inner","right_eye","right_eye_outer","left_ear","right_ear","mouth_left","mouth_right","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_pinky","right_pinky","left_index","right_index","left_thumb","right_thumb","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle","left_heel","right_heel","left_foot_index","right_foot_index"],f={left:[1,2,3,7,9,11,13,15,17,19,21,23,25,27,29,31],right:[4,5,6,8,10,12,14,16,18,20,22,24,26,28,30,32],middle:[0]},h={left:[1,3,5,7,9,11,13,15],right:[2,4,6,8,10,12,14,16],middle:[0]},p=[[0,1],[0,2],[1,3],[2,4],[5,6],[5,7],[5,11],[6,8],[6,12],[7,9],[8,10],[11,12],[11,13],[12,14],[13,15],[14,16]],d=[[0,1],[0,4],[1,2],[2,3],[3,7],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[11,23],[12,14],[14,16],[12,24],[13,15],[15,17],[16,18],[16,20],[15,17],[15,19],[15,21],[16,22],[17,19],[18,20],[23,25],[23,24],[24,26],[25,27],[26,28],[27,29],[28,30],[27,31],[28,32],[29,31],[30,32]],m={runtime:"mediapipe",enableSmoothing:!0,modelType:"full"};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function y(t){if(null==t)return i({},m);var e=i({},t);return e.runtime="mediapipe",null==e.enableSmoothing&&(e.enableSmoothing=m.enableSmoothing),null==e.modelType&&(e.modelType=m.modelType),e}var g=function(){function t(t){var e,n=this;switch(this.width=0,this.height=0,this.selfieMode=!1,this.poseSolution=new window.Pose({locateFile:function(e,n){return t.solutionPath?t.solutionPath.replace(/\/+$/,"")+"/"+e:n+"/"+e}}),t.modelType){case"lite":e=0;break;case"heavy":e=2;break;default:e=1}this.poseSolution.setOptions({modelComplexity:e,smoothLandmarks:t.enableSmoothing||!0,selfieMode:this.selfieMode}),this.poseSolution.onResults((function(t){n.height=t.image.height,n.width=t.image.width,null==t.poseLandmarks?n.poses=[]:n.poses=[n.translateOutput(t.poseLandmarks,t.poseWorldLandmarks)]}))}return t.prototype.translateOutput=function(t,e){var n=this,r={keypoints:t.map((function(t,e){return{x:t.x*n.width,y:t.y*n.height,z:t.z,score:t.visibility,name:l[e]}}))};return null!=e&&(r.keypoints3D=e.map((function(t,e){return{x:t.x,y:t.y,z:t.z,score:t.visibility,name:l[e]}}))),r},t.prototype.estimatePoses=function(t,e,n){return a(this,void 0,void 0,(function(){return u(this,(function(r){switch(r.label){case 0:return e&&e.flipHorizontal&&e.flipHorizontal!==this.selfieMode&&(this.selfieMode=e.flipHorizontal,this.poseSolution.setOptions({selfieMode:this.selfieMode})),[4,this.poseSolution.send({image:t},n)];case 1:return r.sent(),[2,this.poses]}}))}))},t.prototype.dispose=function(){this.poseSolution.close()},t.prototype.reset=function(){this.poseSolution.reset()},t.prototype.initialize=function(){return this.poseSolution.initialize()},t}();function b(t){return a(this,void 0,void 0,(function(){var e,n;return u(this,(function(r){switch(r.label){case 0:return e=y(t),[4,(n=new g(e)).initialize()];case 1:return r.sent(),[2,n]}}))}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var w=1e-6,v=1e6,x=1e3;
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function N(t){return t instanceof r.Tensor?{height:t.shape[0],width:t.shape[1]}:{height:t.height,width:t.width}}function $(t){return t-2*Math.PI*Math.floor((t+Math.PI)/(2*Math.PI))}function E(t,e,n,r){var s=e-t,o=r-n;if(0===s)throw new Error("Original min and max are both "+t+", range cannot be 0.");var i=o/s;return{scale:i,offset:n-t*i}}function S(t){return t instanceof r.Tensor?t:r.browser.fromPixels(t)}function _(t,e,n){if(void 0===n&&(n=!1),!n)return{top:0,left:0,right:0,bottom:0};var r=e.height,s=e.width;A(e,"targetSize"),A(t,"roi");var o,i,a=r/s,u=t.height/t.width,c=0,l=0;return a>u?(o=t.width,i=t.width*a,l=(1-u/a)/2):(o=t.height/a,i=t.height,c=(1-a/u)/2),t.width=o,t.height=i,{top:l,left:c,right:c,bottom:l}}function T(t,e){return e?{xCenter:e.xCenter*t.width,yCenter:e.yCenter*t.height,width:e.width*t.width,height:e.height*t.height,rotation:e.rotation}:{xCenter:.5*t.width,yCenter:.5*t.height,width:t.width,height:t.height,rotation:0}}function k(t,e,n,r){A(r,"inputResolution");var s=1/e.width,o=1/e.height,i=t.xCenter,a=t.yCenter,u=Math.cos(t.rotation),c=Math.sin(t.rotation),l=n?-1:1,f=t.width,h=t.height;return[1/r.width*f*u*l*s*e.width,1/r.height*-h*c*s*e.width,(-.5*f*u*l+.5*h*c+i)*s*e.width,1/r.width*f*c*l*o*e.height,1/r.height*h*u*o*e.height,(-.5*h*u-.5*f*c*l+a)*o*e.height,0,0]}function A(t,e){r.util.assert(0!==t.width,(function(){return e+" width cannot be 0."})),r.util.assert(0!==t.height,(function(){return e+" height cannot be 0."}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function C(t,e,n){var s=e.inputResolution,o=e.keepAspectRatio,i=N(t),a=T(i,n),u=_(a,s,o);return{imageTensor:r.tidy((function(){var e=S(t),n=r.tensor2d(k(a,i,!1,s),[1,8]);return r.image.transform(r.expandDims(r.cast(e,"float32")),n,"bilinear","nearest",0,[s.height,s.width])})),padding:u}}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function O(t){return null!=t&&null!=t.currentTime}function I(t,e){return(t.width*e.width+t.height*e.height)/2}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var M=function(){function t(t){this.alpha=t,this.initialized=!1}return t.prototype.apply=function(t,e){var n;return this.initialized?n=null==e?this.storedValue+this.alpha*(t-this.storedValue):this.storedValue+this.alpha*e*Math.asinh((t-this.storedValue)/e):(n=t,this.initialized=!0),this.rawValue=t,this.storedValue=n,n},t.prototype.applyWithAlpha=function(t,e,n){return this.alpha=e,this.apply(t,n)},t.prototype.hasLastRawValue=function(){return this.initialized},t.prototype.lastRawValue=function(){return this.rawValue},t.prototype.reset=function(){this.initialized=!1},t}(),R=function(){function t(t){this.frequency=t.frequency,this.minCutOff=t.minCutOff,this.beta=t.beta,this.thresholdCutOff=t.thresholdCutOff,this.thresholdBeta=t.thresholdBeta,this.derivateCutOff=t.derivateCutOff,this.x=new M(this.getAlpha(this.minCutOff)),this.dx=new M(this.getAlpha(this.derivateCutOff)),this.lastTimestamp=0}return t.prototype.apply=function(t,e,n){if(null==t)return t;var r=Math.trunc(e);if(this.lastTimestamp>=r)return t;0!==this.lastTimestamp&&0!==r&&(this.frequency=1/((r-this.lastTimestamp)*w)),this.lastTimestamp=r;var s=this.x.hasLastRawValue()?(t-this.x.lastRawValue())*n*this.frequency:0,o=this.dx.applyWithAlpha(s,this.getAlpha(this.derivateCutOff)),i=this.minCutOff+this.beta*Math.abs(o),a=null!=this.thresholdCutOff?this.thresholdCutOff+this.thresholdBeta*Math.abs(o):null;return this.x.applyWithAlpha(t,this.getAlpha(i),a)},t.prototype.getAlpha=function(t){return 1/(1+this.frequency/(2*Math.PI*t))},t}(),D=function(){function t(t){this.config=t}return t.prototype.apply=function(t,e,n){var r=this;if(null==t)return this.reset(),null;this.initializeFiltersIfEmpty(t);var s=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return t.slice();s=1/n}return t.map((function(t,n){var o=i({},t,{x:r.xFilters[n].apply(t.x,e,s),y:r.yFilters[n].apply(t.y,e,s)});return null!=t.z&&(o.z=r.zFilters[n].apply(t.z,e,s)),o}))},t.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},t.prototype.initializeFiltersIfEmpty=function(t){var e=this;null!=this.xFilters&&this.xFilters.length===t.length||(this.xFilters=t.map((function(t){return new R(e.config)})),this.yFilters=t.map((function(t){return new R(e.config)})),this.zFilters=t.map((function(t){return new R(e.config)})))},t}();
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function F(t,e){return t.map((function(t){var n=i({},t,{x:t.x/e.width,y:t.y/e.height});return null!=t.z&&(t.z=t.z/e.width),n}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var L=function(){function t(t){this.config=t,this.window=[],this.lowPassFilter=new M(1),this.lastValue=0,this.lastValueScale=1,this.lastTimestamp=-1}return t.prototype.apply=function(t,e,n){if(null==t)return t;var r,s=Math.trunc(e);if(this.lastTimestamp>=s)return t;if(-1===this.lastTimestamp)r=1;else{for(var o=t*n-this.lastValue*this.lastValueScale,i=s-this.lastTimestamp,a=o,u=i,c=v/30,l=(1+this.window.length)*c,f=0,h=this.window;f<h.length;f++){var p=h[f];if(u+p.duration>l)break;a+=p.distance,u+=p.duration}var d=a/(u*w);r=1-1/(1+this.config.velocityScale*Math.abs(d)),this.window.unshift({distance:o,duration:i}),this.window.length>this.config.windowSize&&this.window.pop()}return this.lastValue=t,this.lastValueScale=n,this.lastTimestamp=s,this.lowPassFilter.applyWithAlpha(t,r)},t}(),P=function(){function t(t){this.config=t}return t.prototype.apply=function(t,e,n){var r=this;if(null==t)return this.reset(),null;var s=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return t.slice();s=1/n}return this.initializeFiltersIfEmpty(t),t.map((function(t,n){var o=i({},t,{x:r.xFilters[n].apply(t.x,e,s),y:r.yFilters[n].apply(t.y,e,s)});return null!=t.z&&(o.z=r.zFilters[n].apply(t.z,e,s)),o}))},t.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},t.prototype.initializeFiltersIfEmpty=function(t){var e=this;null!=this.xFilters&&this.xFilters.length===t.length||(this.xFilters=t.map((function(t){return new L(e.config)})),this.yFilters=t.map((function(t){return new L(e.config)})),this.zFilters=t.map((function(t){return new L(e.config)})))},t}();function B(t,e){return t.map((function(t){var n=i({},t,{x:t.x*e.width,y:t.y*e.height});return null!=t.z&&(n.z=t.z*e.width),n}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var V=function(){function t(t){if(null!=t.velocityFilter)this.keypointsFilter=new P(t.velocityFilter);else{if(null==t.oneEuroFilter)throw new Error("Either configure velocityFilter or oneEuroFilter, but got "+t+".");this.keypointsFilter=new D(t.oneEuroFilter)}}return t.prototype.apply=function(t,e,n,r,s){if(void 0===r&&(r=!1),null==t)return this.keypointsFilter.reset(),null;var o=null!=s?I(s,n):1,i=r?B(t,n):t,a=this.keypointsFilter.apply(i,e,o);return r?F(a,n):a},t}();
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function z(t,e){var n=E(0,255,e[0],e[1]);return r.tidy((function(){return r.add(r.mul(t,n.scale),n.offset)}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function W(t,e,n){var r,s=t.locationData,o=n.rotationVectorStartKeypointIndex,i=n.rotationVectorEndKeypointIndex;r=n.rotationVectorTargetAngle?n.rotationVectorTargetAngle:Math.PI*n.rotationVectorTargetAngleDegree/180;var a=s.relativeKeypoints[o].x*e.width,u=s.relativeKeypoints[o].y*e.height,c=s.relativeKeypoints[i].x*e.width,l=s.relativeKeypoints[i].y*e.height;return $(r-Math.atan2(-(l-u),c-a))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function U(t,e,n){var r=n.rotationVectorStartKeypointIndex,s=n.rotationVectorEndKeypointIndex,o=t.locationData,i=o.relativeKeypoints[r].x*e.width,a=o.relativeKeypoints[r].y*e.height,u=o.relativeKeypoints[s].x*e.width,c=o.relativeKeypoints[s].y*e.height,l=2*Math.sqrt((u-i)*(u-i)+(c-a)*(c-a)),f=W(t,e,n);return{xCenter:i/e.width,yCenter:a/e.height,width:l/e.width,height:l/e.height,rotation:f}}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function j(t,e,n){void 0===n&&(n={ignoreRotation:!1});for(var r=[],s=0,o=t;s<o.length;s++){var a=o[s],u=a.x-.5,c=a.y-.5,l=n.ignoreRotation?0:e.rotation,f=Math.cos(l)*u-Math.sin(l)*c,h=Math.sin(l)*u+Math.cos(l)*c;f=f*e.width+e.xCenter,h=h*e.height+e.yCenter;var p=a.z*e.width,d=i({},a);d.x=f,d.y=h,d.z=p,r.push(d)}return r}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function G(t,e,n){void 0===n&&(n=!0);for(var r=[],s=0;s<t.length;s++){var o=i({},e[s]);n&&(o.score=t[s].score),r.push(o)}return r}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function q(t,e){for(var n=[],r=0,s=t;r<s.length;r++){var o=s[r],a=o.x,u=o.y,c=e.rotation,l=Math.cos(c)*a-Math.sin(c)*u,f=Math.sin(c)*a+Math.cos(c)*u,h=i({},o);h.x=l,h.y=f,n.push(h)}return n}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function H(t){for(var e=[],n=0;n<t.numLayers;){for(var r=[],s=[],o=[],i=[],a=n;a<t.strides.length&&t.strides[a]===t.strides[n];){var u=K(t.minScale,t.maxScale,a,t.strides.length);if(0===a&&t.reduceBoxesInLowestLayer)o.push(1),o.push(2),o.push(.5),i.push(.1),i.push(u),i.push(u);else{for(var c=0;c<t.aspectRatios.length;++c)o.push(t.aspectRatios[c]),i.push(u);if(t.interpolatedScaleAspectRatio>0){var l=a===t.strides.length-1?1:K(t.minScale,t.maxScale,a+1,t.strides.length);i.push(Math.sqrt(u*l)),o.push(t.interpolatedScaleAspectRatio)}}a++}for(var f=0;f<o.length;++f){var h=Math.sqrt(o[f]);r.push(i[f]/h),s.push(i[f]*h)}var p=0,d=0;if(t.featureMapHeight.length>0)p=t.featureMapHeight[n],d=t.featureMapWidth[n];else{var m=t.strides[n];p=Math.ceil(t.inputSizeHeight/m),d=Math.ceil(t.inputSizeWidth/m)}for(var y=0;y<p;++y)for(var g=0;g<d;++g)for(var b=0;b<r.length;++b){var w={xCenter:(g+t.anchorOffsetX)/d,yCenter:(y+t.anchorOffsetY)/p,width:0,height:0};t.fixedAnchorSize?(w.width=1,w.height=1):(w.width=s[b],w.height=r[b]),e.push(w)}n=a}return e}function K(t,e,n,r){return 1===r?.5*(t+e):t+(e-t)*n/(r-1)}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function X(t){return r.tidy((function(){var e=r.slice(t,[0,0,0],[1,-1,1]);return[r.sigmoid(e),r.slice(t,[0,0,1],[1,-1,-1])]}))}function J(t,e){return r.tidy((function(){var n=X(e.predict(t)),s=n[0],o=n[1];return{boxes:r.squeeze(o),scores:r.squeeze(s)}}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Y(t){for(var e={locationData:{relativeKeypoints:[]}},n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,i=0;i<t.length;++i){var a=t[i];n=Math.min(n,a.x),r=Math.max(r,a.x),s=Math.min(s,a.y),o=Math.max(o,a.y),e.locationData.relativeKeypoints.push({x:a.x,y:a.y})}return e.locationData.relativeBoundingBox={xMin:n,yMin:s,xMax:r,yMax:o,width:r-n,height:o-s},e}function Z(t,e,n,s){return a(this,void 0,void 0,(function(){var o,i,a,c,l;return u(this,(function(u){switch(u.label){case 0:return o=r.tensor2d(t.map((function(t){return[t.locationData.relativeBoundingBox.yMin,t.locationData.relativeBoundingBox.xMin,t.locationData.relativeBoundingBox.yMax,t.locationData.relativeBoundingBox.xMax]}))),i=r.tensor1d(t.map((function(t){return t.score[0]}))),[4,r.image.nonMaxSuppressionAsync(o,i,e,n,s)];case 1:return[4,(a=u.sent()).array()];case 2:return c=u.sent(),l=t.filter((function(t,e){return c.indexOf(e)>-1})),r.dispose([o,i,a]),[2,l]}}))}))}function Q(t,e,n){return a(this,void 0,void 0,(function(){var s,o,a,c,l,f,h,p,d,m,y,g,b,w,v,x,N,$,E,S,_,T,k,A;return u(this,(function(u){switch(u.label){case 0:if(s=r.squeeze(e,[0]),o=s.shape,a=o[0],c=o[1],l=o[2],t.length!==l)throw new Error("Expected heatmap to have same number of channels as the number of landmarks. But got landmarks length: "+t.length+", heatmap length: "+l);return f=[],[4,s.buffer()];case 1:for(h=u.sent(),p=0;p<t.length;p++)if(d=t[p],m=i({},d),f.push(m),y=Math.trunc(m.x*c),g=Math.trunc(m.y*a),!(y<0||y>=c||g<0||y>=a)){for(b=Math.trunc((n.kernelSize-1)/2),w=Math.max(0,y-b),v=Math.min(c,y+b+1),x=Math.max(0,g-b),N=Math.min(a,g+b+1),$=0,E=0,S=0,_=0,T=x;T<N;++T)for(k=w;k<v;++k)A=h.get(T,k,p),$+=A,_=Math.max(_,A),E+=k*A,S+=T*A;_>=n.minConfidenceToRefine&&$>0&&(m.x=E/c/$,m.y=S/a/$)}return s.dispose(),[2,f]}}))}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function tt(t,e){void 0===t&&(t=[]);for(var n=e.left,r=e.top,s=e.left+e.right,o=e.top+e.bottom,i=0;i<t.length;i++){var a=t[i],u=a.locationData.relativeBoundingBox,c=(u.xMin-n)/(1-s),l=(u.yMin-r)/(1-o),f=u.width/(1-s),h=u.height/(1-o);u.xMin=c,u.yMin=l,u.width=f,u.height=h;for(var p=0;p<a.locationData.relativeKeypoints.length;++p){var d=a.locationData.relativeKeypoints[p],m=(d.x-n)/(1-s),y=(d.y-r)/(1-o);d.x=m,d.y=y}}return t}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function et(t,e){var n=e.left,r=e.top,s=e.left+e.right,o=e.top+e.bottom;return t.map((function(t){return i({},t,{x:(t.x-n)/(1-s),y:(t.y-r)/(1-o),z:t.z/(1-s)})}))}function nt(t,e,n){return a(this,void 0,void 0,(function(){var s,o,i,a,c;return u(this,(function(u){switch(u.label){case 0:return s=t[0],o=t[1],i=ot(o,e,n),a=r.tidy((function(){var t=s;return n.sigmoidScore?(null!=n.scoreClippingThresh&&(t=r.clipByValue(s,-n.scoreClippingThresh,n.scoreClippingThresh)),t=r.sigmoid(t)):t})),[4,rt(i,a,n)];case 1:return c=u.sent(),r.dispose([i,a]),[2,c]}}))}))}function rt(t,e,n){return a(this,void 0,void 0,(function(){var r,s,o,i,a,c,l,f,h,p,d,m;return u(this,(function(u){switch(u.label){case 0:return r=[],[4,t.data()];case 1:return s=u.sent(),[4,e.data()];case 2:for(o=u.sent(),i=0;i<n.numBoxes;++i)if(!(null!=n.minScoreThresh&&o[i]<n.minScoreThresh||(a=i*n.numCoords,c=st(s[a+0],s[a+1],s[a+2],s[a+3],o[i],n.flipVertically,i),(l=c.locationData.relativeBoundingBox).width<0||l.height<0))){if(n.numKeypoints>0)for((f=c.locationData).relativeKeypoints=[],h=n.numKeypoints*n.numValuesPerKeypoint,p=0;p<h;p+=n.numValuesPerKeypoint)d=a+n.keypointCoordOffset+p,m={x:s[d+0],y:n.flipVertically?1-s[d+1]:s[d+1]},f.relativeKeypoints.push(m);r.push(c)}return[2,r]}}))}))}function st(t,e,n,r,s,o,i){return{score:[s],ind:i,locationData:{relativeBoundingBox:{xMin:e,yMin:o?1-n:t,xMax:r,yMax:o?1-t:n,width:r-e,height:n-t}}}}function ot(t,e,n){return r.tidy((function(){var s,o,i,a;n.reverseOutputOrder?(o=r.squeeze(r.slice(t,[0,n.boxCoordOffset+0],[-1,1])),s=r.squeeze(r.slice(t,[0,n.boxCoordOffset+1],[-1,1])),a=r.squeeze(r.slice(t,[0,n.boxCoordOffset+2],[-1,1])),i=r.squeeze(r.slice(t,[0,n.boxCoordOffset+3],[-1,1]))):(s=r.squeeze(r.slice(t,[0,n.boxCoordOffset+0],[-1,1])),o=r.squeeze(r.slice(t,[0,n.boxCoordOffset+1],[-1,1])),i=r.squeeze(r.slice(t,[0,n.boxCoordOffset+2],[-1,1])),a=r.squeeze(r.slice(t,[0,n.boxCoordOffset+3],[-1,1]))),o=r.add(r.mul(r.div(o,n.xScale),e.w),e.x),s=r.add(r.mul(r.div(s,n.yScale),e.h),e.y),n.applyExponentialOnBoxSize?(i=r.mul(r.exp(r.div(i,n.hScale)),e.h),a=r.mul(r.exp(r.div(a,n.wScale)),e.w)):(i=r.mul(r.div(i,n.hScale),e.h),a=r.mul(r.div(a,n.wScale),e.h));var u=r.sub(s,r.div(i,2)),c=r.sub(o,r.div(a,2)),l=r.add(s,r.div(i,2)),f=r.add(o,r.div(a,2)),h=r.concat([r.reshape(u,[n.numBoxes,1]),r.reshape(c,[n.numBoxes,1]),r.reshape(l,[n.numBoxes,1]),r.reshape(f,[n.numBoxes,1])],1);if(n.numKeypoints)for(var p=0;p<n.numKeypoints;++p){var d=n.keypointCoordOffset+p*n.numValuesPerKeypoint,m=void 0,y=void 0;n.reverseOutputOrder?(m=r.squeeze(r.slice(t,[0,d],[-1,1])),y=r.squeeze(r.slice(t,[0,d+1],[-1,1]))):(y=r.squeeze(r.slice(t,[0,d],[-1,1])),m=r.squeeze(r.slice(t,[0,d+1],[-1,1])));var g=r.add(r.mul(r.div(m,n.xScale),e.w),e.x),b=r.add(r.mul(r.div(y,n.yScale),e.h),e.y);h=r.concat([h,r.reshape(g,[n.numBoxes,1]),r.reshape(b,[n.numBoxes,1])],1)}return h}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function it(t){return 1/(1+Math.exp(-t))}function at(t,e,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!1),a(this,void 0,void 0,(function(){var s,o,i,a,c,l,f,h;return u(this,(function(u){switch(u.label){case 0:return s=t.size,o=s/e.numLandmarks,[4,t.data()];case 1:for(i=u.sent(),a=[],c=0;c<e.numLandmarks;++c)l=c*o,(h={x:0,y:0}).x=n?e.inputImageWidth-i[l]:i[l],o>1&&(h.y=r?e.inputImageHeight-i[l+1]:i[l+1]),o>2&&(h.z=i[l+2]),o>3&&(h.score=it(i[l+3])),a.push(h);for(f=0;f<a.length;++f)(h=a[f]).x=h.x/e.inputImageWidth,h.y=h.y/e.inputImageHeight,h.z=h.z/e.inputImageWidth/(e.normalizeZ||1);return[2,a]}}))}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function ut(t,e,n){var r=t.width,s=t.height,o=t.rotation;if(null==n.rotation&&null==n.rotationDegree||(o=ct(o,n)),0===o)t.xCenter=t.xCenter+r*n.shiftX,t.yCenter=t.yCenter+s*n.shiftY;else{var i=(e.width*r*n.shiftX*Math.cos(o)-e.height*s*n.shiftY*Math.sin(o))/e.width,a=(e.width*r*n.shiftX*Math.sin(o)+e.height*s*n.shiftY*Math.cos(o))/e.height;t.xCenter=t.xCenter+i,t.yCenter=t.yCenter+a}if(n.squareLong){var u=Math.max(r*e.width,s*e.height);r=u/e.width,s=u/e.height}else if(n.squareShort){var c=Math.min(r*e.width,s*e.height);r=c/e.width,s=c/e.height}return t.width=r*n.scaleX,t.height=s*n.scaleY,t}function ct(t,e){return null!=e.rotation?t+=e.rotation:null!=e.rotationDegree&&(t+=Math.PI*e.rotationDegree/180),$(t)}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var lt=function(){function t(t){this.alpha=t.alpha}return t.prototype.apply=function(t){var e=this;if(null==t)return this.visibilityFilters=null,null;null!=this.visibilityFilters&&this.visibilityFilters.length===t.length||(this.visibilityFilters=t.map((function(t){return new M(e.alpha)})));for(var n=[],r=0;r<t.length;++r){var s=t[r],o=i({},s);o.score=this.visibilityFilters[r].apply(s.score),n.push(o)}return n},t}(),ft="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/1",ht="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/lite/1",pt="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/heavy/1",dt={reduceBoxesInLowestlayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:5,minScale:.1484375,maxScale:.75,inputSizeHeight:224,inputSizeWidth:224,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,32,32,32],aspectRatios:[1],fixedAnchorSize:!0},mt={runtime:"tfjs",modelType:"full",enableSmoothing:!0,detectorModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/detector/1",landmarkModelUrl:ft},yt={maxPoses:1,flipHorizontal:!1},gt={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2254,numCoords:12,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:4,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:224,yScale:224,hScale:224,wScale:224,minScoreThresh:.5},bt={minScoreThreshold:-1,minSuppressionThreshold:.3},wt={shiftX:0,shiftY:0,scaleX:1.25,scaleY:1.25,squareLong:!0},vt={inputResolution:{width:224,height:224},keepAspectRatio:!0},xt={inputResolution:{width:256,height:256},keepAspectRatio:!0},Nt=.5,$t={numLandmarks:39,inputImageWidth:256,inputImageHeight:256},Et={numLandmarks:39,inputImageWidth:1,inputImageHeight:1},St={kernelSize:7,minConfidenceToRefine:.5},_t=33,Tt=35,kt={alpha:.1},At={oneEuroFilter:{frequency:30,minCutOff:.05,beta:80,derivateCutOff:1,minAllowedObjectScale:1e-6}},Ct={oneEuroFilter:{frequency:30,minCutOff:.01,beta:10,derivateCutOff:1,minAllowedObjectScale:1e-6}},Ot={oneEuroFilter:{frequency:30,minCutOff:.1,beta:40,derivateCutOff:1,minAllowedObjectScale:1e-6,disableValueScaling:!0}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function It(t){var e=i({},null==t?mt:t);if(null==e.enableSmoothing&&(e.enableSmoothing=mt.enableSmoothing),null==e.modelType&&(e.modelType=mt.modelType),null==e.detectorModelUrl&&(e.detectorModelUrl=mt.detectorModelUrl),null==e.landmarkModelUrl)switch(e.modelType){case"lite":e.landmarkModelUrl=ht;break;case"heavy":e.landmarkModelUrl=pt;break;default:e.landmarkModelUrl=ft}return e}function Mt(t){var e;if(null==(e=null==t?yt:i({},t)).maxPoses&&(e.maxPoses=1),e.maxPoses<=0)throw new Error("Invalid maxPoses "+e.maxPoses+". Should be > 0.");if(e.maxPoses>1)throw new Error("Multi-pose detection is not implemented yet. Please set maxPoses to 1.");return e}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var Rt=function(){function t(t,e,n,s){this.detectorModel=t,this.landmarkModel=e,this.enableSmoothing=n,this.modelType=s,this.regionOfInterest=null,this.anchors=H(dt);var o=r.tensor1d(this.anchors.map((function(t){return t.width}))),i=r.tensor1d(this.anchors.map((function(t){return t.height}))),a=r.tensor1d(this.anchors.map((function(t){return t.xCenter}))),u=r.tensor1d(this.anchors.map((function(t){return t.yCenter})));this.anchorTensor={x:a,y:u,w:o,h:i}}return t.prototype.estimatePoses=function(t,e,n){return a(this,void 0,void 0,(function(){var s,o,i,a,c,f,h,p,d,m,y,g,b,w,$,E,_,T;return u(this,(function(u){switch(u.label){case 0:return s=Mt(e),null==t?(this.reset(),[2,[]]):(this.maxPoses=s.maxPoses,this.timestamp=null!=n?n*x:O(t)?t.currentTime*v:null,o=N(t),i=r.tidy((function(){return r.cast(S(t),"float32")})),null!=(a=this.regionOfInterest)?[3,2]:[4,this.detectPose(i)]);case 1:if(0===(c=u.sent()).length)return this.reset(),i.dispose(),[2,[]];f=c[0],a=this.poseDetectionToRoi(f,o),u.label=2;case 2:return[4,this.poseLandmarksByRoi(a,i)];case 3:return h=u.sent(),i.dispose(),null==h?(this.reset(),[2,[]]):(p=h.actualLandmarks,d=h.auxiliaryLandmarks,m=h.poseScore,y=h.actualWorldLandmarks,g=this.poseLandmarkFiltering(p,d,y,o),b=g.actualLandmarksFiltered,w=g.auxiliaryLandmarksFiltered,$=g.actualWorldLandmarksFiltered,E=this.poseLandmarksToRoi(w,o),this.regionOfInterest=E,null!=(_=null!=b?B(b,o):null)&&_.forEach((function(t,e){t.name=l[e]})),null!=(T=$)&&T.forEach((function(t,e){t.name=l[e]})),[2,[{score:m,keypoints:_,keypoints3D:T}]])}}))}))},t.prototype.dispose=function(){this.detectorModel.dispose(),this.landmarkModel.dispose(),r.dispose([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h])},t.prototype.reset=function(){this.regionOfInterest=null,this.visibilitySmoothingFilterActual=null,this.visibilitySmoothingFilterAuxiliary=null,this.landmarksSmoothingFilterActual=null,this.landmarksSmoothingFilterAuxiliary=null},t.prototype.detectPose=function(t){return a(this,void 0,void 0,(function(){var e,n,s,o,i,a,c,l,f;return u(this,(function(u){switch(u.label){case 0:return e=C(t,vt),n=e.imageTensor,s=e.padding,o=z(n,[-1,1]),i=J(o,this.detectorModel),a=i.boxes,[4,nt([c=i.scores,a],this.anchorTensor,gt)];case 1:return[4,Z(u.sent(),this.maxPoses,bt.minSuppressionThreshold,bt.minScoreThreshold)];case 2:return l=u.sent(),f=tt(l,s),r.dispose([n,o,c,a]),[2,f]}}))}))},t.prototype.poseDetectionToRoi=function(t,e){return ut(U(t,e,{rotationVectorEndKeypointIndex:1,rotationVectorStartKeypointIndex:0,rotationVectorTargetAngleDegree:90}),e,wt)},t.prototype.poseLandmarksByRoi=function(t,e){return a(this,void 0,void 0,(function(){var n,s,o,i,a,c,l,f,h,p,d,m,y,g,b,w,v,x,N,$;return u(this,(function(u){switch(u.label){case 0:if(n=C(e,xt,t),s=n.imageTensor,o=n.padding,i=z(s,[0,1]),"lite"!==this.modelType&&"full"!==this.modelType&&"heavy"!==this.modelType)throw new Error("Model type must be one of lite, full or heavy,but got "+this.modelType);return a=this.landmarkModel.execute(i,["ld_3d","output_poseflag","activation_heatmap","world_3d"]),c=a[0],l=a[1],f=a[2],h=a[3],[4,l.data()];case 1:return(p=u.sent()[0])<Nt?(r.dispose(a),r.dispose([s,i]),[2,null]):[4,at(c,$t)];case 2:return[4,Q(d=u.sent(),f,St)];case 3:return m=u.sent(),y=et(m,o),g=j(y,t),b=g.slice(0,_t),w=g.slice(_t,Tt),[4,at(h,Et)];case 4:return v=u.sent(),x=G(d,v,!0),N=q(x,t),$=N.slice(0,_t),r.dispose(a),r.dispose([s,i]),[2,{actualLandmarks:b,auxiliaryLandmarks:w,poseScore:p,actualWorldLandmarks:$}]}}))}))},t.prototype.poseLandmarksToRoi=function(t,e){return ut(U(Y(t),e,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:1,rotationVectorTargetAngleDegree:90}),e,wt)},t.prototype.poseLandmarkFiltering=function(t,e,n,r){var s,o,i;if(null!=this.timestamp&&this.enableSmoothing){var a=U(Y(e),r,{rotationVectorEndKeypointIndex:0,rotationVectorStartKeypointIndex:1,rotationVectorTargetAngleDegree:90});null==this.visibilitySmoothingFilterActual&&(this.visibilitySmoothingFilterActual=new lt(kt)),s=this.visibilitySmoothingFilterActual.apply(t),null==this.visibilitySmoothingFilterAuxiliary&&(this.visibilitySmoothingFilterAuxiliary=new lt(kt)),o=this.visibilitySmoothingFilterAuxiliary.apply(e),i=this.visibilitySmoothingFilterActual.apply(n),null==this.landmarksSmoothingFilterActual&&(this.landmarksSmoothingFilterActual=new V(At)),s=this.landmarksSmoothingFilterActual.apply(s,this.timestamp,r,!0,a),null==this.landmarksSmoothingFilterAuxiliary&&(this.landmarksSmoothingFilterAuxiliary=new V(Ct)),o=this.landmarksSmoothingFilterAuxiliary.apply(o,this.timestamp,r,!0,a),null==this.worldLandmarksSmoothingFilterActual&&(this.worldLandmarksSmoothingFilterActual=new V(Ot)),i=this.worldLandmarksSmoothingFilterActual.apply(n,this.timestamp)}else s=t,o=e,i=n;return{actualLandmarksFiltered:s,auxiliaryLandmarksFiltered:o,actualWorldLandmarksFiltered:i}},t}();function Dt(t){return a(this,void 0,void 0,(function(){var e,r,s,o,i,a;return u(this,(function(u){switch(u.label){case 0:return e=It(t),r=e.detectorModelUrl.indexOf("https://tfhub.dev")>-1,s=e.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,Promise.all([n.loadGraphModel(e.detectorModelUrl,{fromTFHub:r}),n.loadGraphModel(e.landmarkModelUrl,{fromTFHub:s})])];case 1:return o=u.sent(),i=o[0],a=o[1],[2,new Rt(i,a,e.enableSmoothing,e.modelType)]}}))}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function Ft(t){if(t.maxTracks<1)throw new Error("Must specify 'maxTracks' to be at least 1, but encountered "+t.maxTracks);if(t.maxAge<=0)throw new Error("Must specify 'maxAge' to be positive, but encountered "+t.maxAge);if(void 0!==t.keypointTrackerParams){if(t.keypointTrackerParams.keypointConfidenceThreshold<0||t.keypointTrackerParams.keypointConfidenceThreshold>1)throw new Error("Must specify 'keypointConfidenceThreshold' to be in the range [0, 1], but encountered "+t.keypointTrackerParams.keypointConfidenceThreshold);if(t.keypointTrackerParams.minNumberOfKeypoints<1)throw new Error("Must specify 'minNumberOfKeypoints' to be at least 1, but encountered "+t.keypointTrackerParams.minNumberOfKeypoints);for(var e=0,n=t.keypointTrackerParams.keypointFalloff;e<n.length;e++){var r=n[e];if(r<=0)throw new Error("Must specify each keypoint falloff parameterto be positive but encountered "+r)}}}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var Lt,Pt,Bt=function(){function t(t){Ft(t),this.tracks=[],this.maxTracks=t.maxTracks,this.maxAge=1e3*t.maxAge,this.minSimilarity=t.minSimilarity,this.nextID=1}return t.prototype.apply=function(t,e){this.filterOldTracks(e);var n=this.computeSimilarity(t);return this.assignTracks(t,n,e),this.updateTracks(e),t},t.prototype.getTracks=function(){return this.tracks.slice()},t.prototype.getTrackIDs=function(){return new Set(this.tracks.map((function(t){return t.id})))},t.prototype.filterOldTracks=function(t){var e=this;this.tracks=this.tracks.filter((function(n){return t-n.lastTimestamp<=e.maxAge}))},t.prototype.assignTracks=function(t,e,n){for(var r=Array.from(Array(e[0].length).keys()),s=[],o=0,i=Array.from(Array(t.length).keys());o<i.length;o++){var a=i[o];if(0!==r.length){for(var u=-1,c=-1,l=0,f=r;l<f.length;l++){var h=f[l],p=e[a][h];p>=this.minSimilarity&&p>c&&(u=h,c=p)}if(u>=0){var d=this.tracks[u];d=Object.assign(d,this.createTrack(t[a],n,d.id)),t[a].id=d.id;var m=r.indexOf(u);r.splice(m,1)}else s.push(a)}else s.push(a)}for(var y=0,g=s;y<g.length;y++){a=g[y];var b=this.createTrack(t[a],n);this.tracks.push(b),t[a].id=b.id}},t.prototype.updateTracks=function(t){this.tracks.sort((function(t,e){return e.lastTimestamp-t.lastTimestamp})),this.tracks=this.tracks.slice(0,this.maxTracks)},t.prototype.createTrack=function(t,e,n){var r={id:n||this.nextTrackID(),lastTimestamp:e,keypoints:t.keypoints.slice().map((function(t){return i({},t)}))};return void 0!==t.box&&(r.box=i({},t.box)),r},t.prototype.nextTrackID=function(){var t=this.nextID;return this.nextID+=1,t},t.prototype.remove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.tracks=this.tracks.filter((function(e){return!t.includes(e.id)}))},t.prototype.reset=function(){this.tracks=[]},t}(),Vt=function(t){function e(e){return t.call(this,e)||this}return o(e,t),e.prototype.computeSimilarity=function(t){var e=this;if(0===t.length||0===this.tracks.length)return[[]];var n=t.map((function(t){return e.tracks.map((function(n){return e.iou(t,n)}))}));return n},e.prototype.iou=function(t,e){var n=Math.max(t.box.xMin,e.box.xMin),r=Math.max(t.box.yMin,e.box.yMin),s=Math.min(t.box.xMax,e.box.xMax),o=Math.min(t.box.yMax,e.box.yMax);if(n>=s||r>=o)return 0;var i=(s-n)*(o-r);return i/(t.box.width*t.box.height+e.box.width*e.box.height-i)},e}(Bt),zt=function(t){function e(e){var n=t.call(this,e)||this;return n.keypointThreshold=e.keypointTrackerParams.keypointConfidenceThreshold,n.keypointFalloff=e.keypointTrackerParams.keypointFalloff,n.minNumKeyoints=e.keypointTrackerParams.minNumberOfKeypoints,n}return o(e,t),e.prototype.computeSimilarity=function(t){if(0===t.length||0===this.tracks.length)return[[]];for(var e=[],n=0,r=t;n<r.length;n++){for(var s=r[n],o=[],i=0,a=this.tracks;i<a.length;i++){var u=a[i];o.push(this.oks(s,u))}e.push(o)}return e},e.prototype.oks=function(t,e){for(var n=this.area(e.keypoints)+1e-6,r=0,s=0,o=0;o<t.keypoints.length;++o){var i=t.keypoints[o],a=e.keypoints[o];if(!(i.score<this.keypointThreshold||a.score<this.keypointThreshold)){s+=1;var u=Math.pow(i.x-a.x,2)+Math.pow(i.y-a.y,2),c=2*this.keypointFalloff[o];r+=Math.exp(-1*u/(2*n*Math.pow(c,2)))}}return s<this.minNumKeyoints?0:r/s},e.prototype.area=function(t){var e=this,n=t.filter((function(t){return t.score>e.keypointThreshold})),r=Math.min.apply(Math,[1].concat(n.map((function(t){return t.x})))),s=Math.max.apply(Math,[0].concat(n.map((function(t){return t.x})))),o=Math.min.apply(Math,[1].concat(n.map((function(t){return t.y}))));return(s-r)*(Math.max.apply(Math,[0].concat(n.map((function(t){return t.y}))))-o)},e}(Bt);
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function Wt(e){switch(e){case t.SupportedModels.BlazePose:return f;case t.SupportedModels.PoseNet:case t.SupportedModels.MoveNet:return h;default:throw new Error("Model "+e+" is not supported.")}}function Ut(e){switch(e){case t.SupportedModels.BlazePose:return d;case t.SupportedModels.PoseNet:case t.SupportedModels.MoveNet:return p;default:throw new Error("Model "+e+" is not supported.")}}function jt(e){switch(e){case t.SupportedModels.BlazePose:return l.reduce((function(t,e,n){return t[e]=n,t}),{});case t.SupportedModels.PoseNet:case t.SupportedModels.MoveNet:return c.reduce((function(t,e,n){return t[e]=n,t}),{});default:throw new Error("Model "+e+" is not supported.")}}(
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
Pt=t.TrackerType||(t.TrackerType={})).Keypoint="keypoint",Pt.BoundingBox="boundingBox",(Lt=t.SupportedModels||(t.SupportedModels={})).MoveNet="MoveNet",Lt.BlazePose="BlazePose",Lt.PoseNet="PoseNet";var Gt=Object.freeze({__proto__:null,getKeypointIndexBySide:Wt,getAdjacentPairs:Ut,getKeypointIndexByName:jt}),qt="SinglePose.Lightning",Ht="SinglePose.Thunder",Kt="MultiPose.Lightning",Xt=[qt,Ht,Kt],Jt="https://tfhub.dev/google/tfjs-model/movenet/singlepose/lightning/4",Yt="https://tfhub.dev/google/tfjs-model/movenet/singlepose/thunder/4",Zt="https://tfhub.dev/google/tfjs-model/movenet/multipose/lightning/1",Qt=192,te=256,ee=256,ne={modelType:qt,enableSmoothing:!0},re={},se={frequency:30,minCutOff:2.5,beta:300,derivateCutOff:2.5,thresholdCutOff:.5,thresholdBeta:5,disableValueScaling:!0},oe=.9,ie=.2,ae=.25,ue=17,ce=3,le=ue*ce,fe=le+4,he=ue*ce+5,pe={maxTracks:18,maxAge:1e3,minSimilarity:.2,keypointTrackerParams:{keypointConfidenceThreshold:.3,keypointFalloff:[.026,.025,.025,.035,.035,.079,.079,.072,.072,.062,.062,.107,.107,.087,.087,.089,.089],minNumberOfKeypoints:4}},de={maxTracks:18,maxAge:1e3,minSimilarity:.15,trackerParams:{}};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function me(t,e){return(t[e.left_hip].score>ie||t[e.right_hip].score>ie)&&(t[e.left_shoulder].score>ie||t[e.right_shoulder].score>ie)}function ye(t,e,n,r,s){for(var o=["left_shoulder","right_shoulder","left_hip","right_hip"],i=0,a=0,u=0;u<o.length;u++)(p=Math.abs(r-n[o[u]][0]))>i&&(i=p),(d=Math.abs(s-n[o[u]][1]))>a&&(a=d);for(var c=0,l=0,f=0,h=Object.keys(n);f<h.length;f++){var p,d,m=h[f];t[e[m]].score<ie||((p=Math.abs(r-n[m][0]))>c&&(c=p),(d=Math.abs(s-n[m][1]))>l&&(l=d))}return[i,a,c,l]}function ge(t,e,n,r){for(var s={},o=0,i=c;o<i.length;o++){var a=i[o];s[a]=[e[n[a]].y*r.height,e[n[a]].x*r.width]}if(me(e,n)){var u=(s.left_hip[0]+s.right_hip[0])/2,l=(s.left_hip[1]+s.right_hip[1])/2,f=ye(e,n,s,u,l),h=f[0],p=f[1],d=f[2],m=f[3],y=Math.max(1.9*p,1.9*h,1.2*d,1.2*m),g=[u-(y=Math.min(y,Math.max(l,r.width-l,u,r.height-u))),l-y];if(y>Math.max(r.width,r.height)/2)return be(null==t,r);var b=2*y;return{yMin:g[0]/r.height,xMin:g[1]/r.width,yMax:(g[0]+b)/r.height,xMax:(g[1]+b)/r.width,height:(g[0]+b)/r.height-g[0]/r.height,width:(g[1]+b)/r.width-g[1]/r.width}}return be(null==t,r)}function be(t,e){var n,r,s,o;return t?e.width>e.height?(n=1,r=e.height/e.width,s=0,o=(e.width/2-e.height/2)/e.width):(n=e.width/e.height,r=1,s=(e.height/2-e.width/2)/e.height,o=0):e.width>e.height?(n=e.width/e.height,r=1,s=(e.height/2-e.width/2)/e.height,o=0):(n=1,r=e.height/e.width,s=0,o=(e.width/2-e.height/2)/e.width),{yMin:s,xMin:o,yMax:s+n,xMax:o+r,height:n,width:r}}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function we(e){var n=null==e?ne:i({},e);if(null==n.modelType)n.modelType="SinglePose.Lightning";else if(Xt.indexOf(n.modelType)<0)throw new Error("Invalid architecture "+n.modelType+". Should be one of "+Xt);if(null==n.enableSmoothing&&(n.enableSmoothing=!0),null!=n.minPoseScore&&(n.minPoseScore<0||n.minPoseScore>1))throw new Error("minPoseScore should be between 0.0 and 1.0");if(null!=n.multiPoseMaxDimension&&(n.multiPoseMaxDimension%32!=0||n.multiPoseMaxDimension<128||n.multiPoseMaxDimension>512))throw new Error("multiPoseResolution must be a multiple of 32 and between 128 and 512");if(n.modelType===Kt&&null==n.enableTracking&&(n.enableTracking=!0),n.modelType===Kt&&!0===n.enableTracking)if(null==n.trackerType&&(n.trackerType=t.TrackerType.BoundingBox),n.trackerType===t.TrackerType.Keypoint)null!=n.trackerConfig?n.trackerConfig=Ne(n.trackerConfig):n.trackerConfig=pe;else{if(n.trackerType!==t.TrackerType.BoundingBox)throw new Error("Tracker type not supported by MoveNet");null!=n.trackerConfig?n.trackerConfig=$e(n.trackerConfig):n.trackerConfig=de}return n}function ve(t){return null==t?re:i({},t)}function xe(t,e){var n={maxTracks:t.maxTracks,maxAge:t.maxAge,minSimilarity:t.minSimilarity};return null!=e.maxTracks&&(n.maxTracks=e.maxTracks),null!=e.maxAge&&(n.maxAge=e.maxAge),null!=e.minSimilarity&&(n.minSimilarity=e.minSimilarity),n}function Ne(t){var e=xe(pe,t);return e.keypointTrackerParams=i({},pe.keypointTrackerParams),null!=t.keypointTrackerParams&&(null!=t.keypointTrackerParams.keypointConfidenceThreshold&&(e.keypointTrackerParams.keypointConfidenceThreshold=t.keypointTrackerParams.keypointConfidenceThreshold),null!=t.keypointTrackerParams.keypointFalloff&&(e.keypointTrackerParams.keypointFalloff=t.keypointTrackerParams.keypointFalloff),null!=t.keypointTrackerParams.minNumberOfKeypoints&&(e.keypointTrackerParams.minNumberOfKeypoints=t.keypointTrackerParams.minNumberOfKeypoints)),e}function $e(t){return xe(de,t)}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var Ee=function(){function e(e,n){this.moveNetModel=e,this.modelInputResolution={height:0,width:0},this.keypointIndexByName=jt(t.SupportedModels.MoveNet),n.modelType===qt?(this.modelInputResolution.width=Qt,this.modelInputResolution.height=Qt):n.modelType===Ht&&(this.modelInputResolution.width=te,this.modelInputResolution.height=te),this.multiPoseModel=n.modelType===Kt,this.multiPoseModel||(this.keypointFilter=new D(se),this.cropRegionFilterYMin=new M(oe),this.cropRegionFilterXMin=new M(oe),this.cropRegionFilterYMax=new M(oe),this.cropRegionFilterXMax=new M(oe)),this.enableSmoothing=n.enableSmoothing,n.minPoseScore?this.minPoseScore=n.minPoseScore:this.minPoseScore=ae,n.multiPoseMaxDimension?this.multiPoseMaxDimension=n.multiPoseMaxDimension:this.multiPoseMaxDimension=ee,this.enableTracking=n.enableTracking,this.multiPoseModel&&this.enableTracking&&(n.trackerType===t.TrackerType.Keypoint?this.tracker=new zt(n.trackerConfig):n.trackerType===t.TrackerType.BoundingBox&&(this.tracker=new Vt(n.trackerConfig)),this.enableSmoothing&&(this.keypointFilterMap=new Map))}return e.prototype.runSinglePersonPoseModel=function(t){return a(this,void 0,void 0,(function(){var e,n,s,o,i;return u(this,(function(a){switch(a.label){case 0:if(4!==(e=this.moveNetModel.execute(t)).shape.length||1!==e.shape[0]||1!==e.shape[1]||e.shape[2]!==ue||e.shape[3]!==ce)throw e.dispose(),new Error("Unexpected output shape from model: ["+e.shape+"]");return"webgpu"===r.getBackend()?[3,1]:(n=e.dataSync(),[3,3]);case 1:return[4,e.data()];case 2:n=a.sent(),a.label=3;case 3:for(e.dispose(),s={keypoints:[],score:0},o=0,i=0;i<ue;++i)s.keypoints[i]={y:n[i*ce],x:n[i*ce+1],score:n[i*ce+2]},s.keypoints[i].score>ie&&(++o,s.score+=s.keypoints[i].score);return o>0&&(s.score/=o),[2,s]}}))}))},e.prototype.runMultiPersonPoseModel=function(t){return a(this,void 0,void 0,(function(){var e,n,s,o,i,a,c,l;return u(this,(function(u){switch(u.label){case 0:if(3!==(e=this.moveNetModel.execute(t)).shape.length||1!==e.shape[0]||e.shape[2]!==he)throw e.dispose(),new Error("Unexpected output shape from model: ["+e.shape+"]");return"webgpu"===r.getBackend()?[3,1]:(n=e.dataSync(),[3,3]);case 1:return[4,e.data()];case 2:n=u.sent(),u.label=3;case 3:for(e.dispose(),s=[],o=n.length/he,i=0;i<o;++i)for(s[i]={keypoints:[]},a=i*he+le,s[i].box={yMin:n[a],xMin:n[a+1],yMax:n[a+2],xMax:n[a+3],width:n[a+3]-n[a+1],height:n[a+2]-n[a]},c=i*he+fe,s[i].score=n[c],s[i].keypoints=[],l=0;l<ue;++l)s[i].keypoints[l]={y:n[i*he+l*ce],x:n[i*he+l*ce+1],score:n[i*he+l*ce+2]};return[2,s]}}))}))},e.prototype.estimatePoses=function(t,e,n){return void 0===e&&(e=re),a(this,void 0,void 0,(function(){var s,o,i,a,l,f;return u(this,(function(u){switch(u.label){case 0:return e=ve(e),null==t?(this.reset(),[2,[]]):(null==n?O(t)&&(n=t.currentTime*v):n*=x,s=S(t),o=N(s),i=r.expandDims(s,0),t instanceof r.Tensor||s.dispose(),a=[],this.multiPoseModel?[3,2]:[4,this.estimateSinglePose(i,o,n)]);case 1:return a=u.sent(),[3,4];case 2:return[4,this.estimateMultiplePoses(i,o,n)];case 3:a=u.sent(),u.label=4;case 4:for(l=0;l<a.length;++l)for(f=0;f<a[l].keypoints.length;++f)a[l].keypoints[f].name=c[f],a[l].keypoints[f].y*=o.height,a[l].keypoints[f].x*=o.width;return[2,a]}}))}))},e.prototype.estimateSinglePose=function(t,e,n){return a(this,void 0,void 0,(function(){var s,o,i,a,c=this;return u(this,(function(u){switch(u.label){case 0:return this.cropRegion||(this.cropRegion=be(null==this.cropRegion,e)),s=r.tidy((function(){var e=r.tensor2d([[c.cropRegion.yMin,c.cropRegion.xMin,c.cropRegion.yMax,c.cropRegion.xMax]]),n=r.zeros([1],"int32"),s=[c.modelInputResolution.height,c.modelInputResolution.width];return r.cast(r.image.cropAndResize(t,e,n,s,"bilinear",0),"int32")})),t.dispose(),[4,this.runSinglePersonPoseModel(s)];case 1:if(o=u.sent(),s.dispose(),o.score<this.minPoseScore)return this.reset(),[2,[]];for(i=0;i<o.keypoints.length;++i)o.keypoints[i].y=this.cropRegion.yMin+o.keypoints[i].y*this.cropRegion.height,o.keypoints[i].x=this.cropRegion.xMin+o.keypoints[i].x*this.cropRegion.width;return null!=n&&this.enableSmoothing&&(o.keypoints=this.keypointFilter.apply(o.keypoints,n,1)),a=ge(this.cropRegion,o.keypoints,this.keypointIndexByName,e),this.cropRegion=this.filterCropRegion(a),[2,[o]]}}))}))},e.prototype.estimateMultiplePoses=function(t,e,n){return a(this,void 0,void 0,(function(){var s,o,i,a,c,l,f,h,p,d,m,y,g=this;return u(this,(function(u){switch(u.label){case 0:return f=32,e.width>e.height?(o=this.multiPoseMaxDimension,i=Math.round(this.multiPoseMaxDimension*e.height/e.width),s=r.image.resizeBilinear(t,[i,o]),c=o,l=Math.ceil(i/f)*f,a=r.pad(s,[[0,0],[0,l-i],[0,0],[0,0]])):(o=Math.round(this.multiPoseMaxDimension*e.width/e.height),i=this.multiPoseMaxDimension,s=r.image.resizeBilinear(t,[i,o]),c=Math.ceil(o/f)*f,l=i,a=r.pad(s,[[0,0],[0,0],[0,c-o],[0,0]])),s.dispose(),t.dispose(),h=r.cast(a,"int32"),a.dispose(),[4,this.runMultiPersonPoseModel(h)];case 1:for(p=u.sent(),h.dispose(),p=p.filter((function(t){return t.score>=g.minPoseScore})),m=0;m<p.length;++m)for(d=0;d<p[m].keypoints.length;++d)p[m].keypoints[d].y*=l/i,p[m].keypoints[d].x*=c/o;if(this.enableTracking&&(this.tracker.apply(p,n),this.enableSmoothing)){for(m=0;m<p.length;++m)this.keypointFilterMap.has(p[m].id)||this.keypointFilterMap.set(p[m].id,new D(se)),p[m].keypoints=this.keypointFilterMap.get(p[m].id).apply(p[m].keypoints,n,1);y=this.tracker.getTrackIDs(),this.keypointFilterMap.forEach((function(t,e){y.has(e)||g.keypointFilterMap.delete(e)}))}return[2,p]}}))}))},e.prototype.filterCropRegion=function(t){if(t){var e=this.cropRegionFilterYMin.apply(t.yMin),n=this.cropRegionFilterXMin.apply(t.xMin),r=this.cropRegionFilterYMax.apply(t.yMax),s=this.cropRegionFilterXMax.apply(t.xMax);return{yMin:e,xMin:n,yMax:r,xMax:s,height:r-e,width:s-n}}return this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset(),null},e.prototype.dispose=function(){this.moveNetModel.dispose()},e.prototype.reset=function(){this.cropRegion=null,this.resetFilters()},e.prototype.resetFilters=function(){this.keypointFilter.reset(),this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset()},e}();function Se(t){return void 0===t&&(t=ne),a(this,void 0,void 0,(function(){var e,s,o,i;return u(this,(function(a){switch(a.label){case 0:return e=we(t),o=!0,e.modelUrl?(o=e.modelUrl.indexOf("https://tfhub.dev")>-1,[4,n.loadGraphModel(e.modelUrl,{fromTFHub:o})]):[3,2];case 1:return s=a.sent(),[3,4];case 2:return i=void 0,e.modelType===qt?i=Jt:e.modelType===Ht?i=Yt:e.modelType===Kt&&(i=Zt),[4,n.loadGraphModel(i,{fromTFHub:o})];case 3:s=a.sent(),a.label=4;case 4:return"webgl"===r.getBackend()&&r.env().set("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",0),[2,new Ee(s,e)]}}))}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var _e={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:{height:257,width:257}},Te=["MobileNetV1","ResNet50"],ke={MobileNetV1:[8,16],ResNet50:[16]},Ae=[8,16,32],Ce={MobileNetV1:[.5,.75,1],ResNet50:[1]},Oe=[1,2,4],Ie={maxPoses:1,flipHorizontal:!1},Me={maxPoses:5,flipHorizontal:!1,scoreThreshold:.5,nmsRadius:20},Re=[-123.15,-115.9,-103.06],De=1,Fe=17,Le=[["nose","left_eye"],["left_eye","left_ear"],["nose","right_eye"],["right_eye","right_ear"],["nose","left_shoulder"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["left_shoulder","left_hip"],["left_hip","left_knee"],["left_knee","left_ankle"],["nose","right_shoulder"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["right_shoulder","right_hip"],["right_hip","right_knee"],["right_knee","right_ankle"]];
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function Pe(t){return Math.floor(t/2)}var Be=function(){function t(t,e){this.priorityQueue=new Array(t),this.numberOfElements=-1,this.getElementValue=e}return t.prototype.enqueue=function(t){this.priorityQueue[++this.numberOfElements]=t,this.swim(this.numberOfElements)},t.prototype.dequeue=function(){var t=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,t},t.prototype.empty=function(){return-1===this.numberOfElements},t.prototype.size=function(){return this.numberOfElements+1},t.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},t.prototype.max=function(){return this.priorityQueue[0]},t.prototype.swim=function(t){for(;t>0&&this.less(Pe(t),t);)this.exchange(t,Pe(t)),t=Pe(t)},t.prototype.sink=function(t){for(;2*t<=this.numberOfElements;){var e=2*t;if(e<this.numberOfElements&&this.less(e,e+1)&&e++,!this.less(t,e))break;this.exchange(t,e),t=e}},t.prototype.getValueAt=function(t){return this.getElementValue(this.priorityQueue[t])},t.prototype.less=function(t,e){return this.getValueAt(t)<this.getValueAt(e)},t.prototype.exchange=function(t,e){var n=this.priorityQueue[t];this.priorityQueue[t]=this.priorityQueue[e],this.priorityQueue[e]=n},t}();function Ve(t,e,n,r,s,o){for(var i=o.shape,a=i[0],u=i[1],c=!0,l=Math.max(n-s,0),f=Math.min(n+s+1,a),h=l;h<f;++h){for(var p=Math.max(r-s,0),d=Math.min(r+s+1,u),m=p;m<d;++m)if(o.get(h,m,t)>e){c=!1;break}if(!c)break}return c}function ze(t,e,n){for(var r=n.shape,s=r[0],o=r[1],i=r[2],a=new Be(s*o*i,(function(t){return t.score})),u=0;u<s;++u)for(var c=0;c<o;++c)for(var l=0;l<i;++l){var f=n.get(u,c,l);f<t||Ve(l,f,u,c,e,n)&&a.enqueue({score:f,part:{heatmapY:u,heatmapX:c,id:l}})}return a}function We(t){return a(this,void 0,void 0,(function(){return u(this,(function(e){return[2,Promise.all(t.map((function(t){return t.buffer()})))]}))}))}function Ue(t,e,n,r){return{y:r.get(t,e,n),x:r.get(t,e,n+Fe)}}function je(t,e,n){var r=Ue(t.heatmapY,t.heatmapX,t.id,n),s=r.y,o=r.x;return{x:t.heatmapX*e+o,y:t.heatmapY*e+s}}function Ge(t,e,n,r){var s=n-t,o=r-e;return s*s+o*o}function qe(t,e,n,r){var s=n.x,o=n.y;return t.some((function(t){var n=t.keypoints;return Ge(o,s,n[r].y,n[r].x)<=e}))}var He=c.reduce((function(t,e,n){return t[e]=n,t}),{}),Ke=Le.map((function(t){var e=t[0],n=t[1];return[He[e],He[n]]})),Xe=Ke.map((function(t){return t[1]})),Je=Ke.map((function(t){return t[0]}));function Ye(t,e,n){return t<e?e:t>n?n:t}function Ze(t,e,n,r){return{y:Ye(Math.round(t.y/e),0,n-1),x:Ye(Math.round(t.x/e),0,r-1)}}function Qe(t,e,n){var r=n.shape[2]/2;return{y:n.get(e.y,e.x,t),x:n.get(e.y,e.x,r+t)}}function tn(t,e){return{x:t.x+e.x,y:t.y+e.y}}function en(t,e,n,r,s,o,i,a){void 0===a&&(a=2);for(var u=r.shape,l=u[0],f=u[1],h={y:e.y,x:e.x},p=tn(h,Qe(t,Ze(h,o,l,f),i)),d=0;d<a;d++){var m=Ze(p,o,l,f),y=Ue(m.y,m.x,n,s);p=tn({x:m.x*o,y:m.y*o},{x:y.x,y:y.y})}var g=Ze(p,o,l,f),b=r.get(g.y,g.x,n);return{y:p.y,x:p.x,name:c[n],score:b}}function nn(t,e,n,r,s,o){var i=e.shape[2],a=Xe.length,u=new Array(i),l=t.part,f=t.score,h=je(l,r,n);u[l.id]={score:f,name:c[l.id],y:h.y,x:h.x};for(var p=a-1;p>=0;--p){var d=Xe[p],m=Je[p];u[d]&&!u[m]&&(u[m]=en(p,u[d],m,e,n,r,o))}for(p=0;p<a;++p)d=Je[p],m=Xe[p],u[d]&&!u[m]&&(u[m]=en(p,u[d],m,e,n,r,s));return u}function rn(t,e,n){var r=n.reduce((function(n,r,s){var o=r.y,i=r.x,a=r.score;return qe(t,e,{y:o,x:i},s)||(n+=a),n}),0);return r/n.length}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sn(t,e,n,r,s,o,i,c){return void 0===i&&(i=.5),void 0===c&&(c=20),a(this,void 0,void 0,(function(){var a,l,f,h,p,d,m,y,g,b,w,v;return u(this,(function(u){switch(u.label){case 0:return[4,We([t,e,n,r])];case 1:for(a=u.sent(),l=a[0],f=a[1],h=a[2],p=a[3],d=[],m=ze(i,De,l),y=c*c;d.length<o&&!m.empty();)g=m.dequeue(),b=je(g.part,s,f),qe(d,y,b,g.part.id)||(w=nn(g,l,f,s,h,p),v=rn(d,y,w),d.push({keypoints:w,score:v}));return[2,d]}}))}))}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function on(t,e){return r.tidy((function(){var n=r.div(t,r.scalar(e,"int32"));return r.sub(t,r.mul(n,r.scalar(e,"int32")))}))}function an(t){var e=t.shape,n=e[0],s=e[1],o=e[2];return r.tidy((function(){var e=r.reshape(t,[n*s,o]),i=r.argMax(e,0),a=r.expandDims(r.div(i,r.scalar(s,"int32")),1),u=r.expandDims(on(i,s),1);return r.concat([a,u],1)}))}function un(t,e){for(var n=e.shape[0],r=new Float32Array(n),s=0;s<n;s++){var o=e.get(s,0),i=e.get(s,1);r[s]=t.get(o,i,s)}return r}function cn(t,e,n){return r.tidy((function(){var s=ln(t,n);return r.add(r.cast(r.mul(t.toTensor(),r.scalar(e,"int32")),"float32"),s)}))}function ln(t,e){for(var n=[],s=0;s<c.length;s++){var o=fn(t.get(s,0).valueOf(),t.get(s,1).valueOf(),s,e),i=o.x,a=o.y;n.push(a),n.push(i)}return r.tensor2d(n,[c.length,2])}function fn(t,e,n,r){return{y:r.get(t,e,n),x:r.get(t,e,n+c.length)}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function hn(t,e,n){return a(this,void 0,void 0,(function(){var r,s,o,i,a,l,f,h,p,d;return u(this,(function(u){switch(u.label){case 0:return r=0,s=an(t),[4,Promise.all([t.buffer(),e.buffer(),s.buffer()])];case 1:return o=u.sent(),i=o[0],a=o[1],l=o[2],[4,(f=cn(l,n,a)).buffer()];case 2:return h=u.sent(),p=Array.from(un(i,l)),d=p.map((function(t,e){return r+=t,{y:h.get(e,0),x:h.get(e,1),score:t,name:c[e]}})),s.dispose(),f.dispose(),[2,{keypoints:d,score:r/d.length}]}}))}))}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function pn(t,e){for(var n=0,r=t;n<r.length;n++)for(var s=0,o=r[n].keypoints;s<o.length;s++){var i=o[s];i.x=e.width-1-i.x}return t}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function dn(t,e,n,r){var s=e.height,o=e.width,i=s/(n.height*(1-r.top-r.bottom)),a=o/(n.width*(1-r.left-r.right)),u=-r.top*n.height,c=-r.left*n.width;if(1===a&&1===i&&0===u&&0===c)return t;for(var l=0,f=t;l<f.length;l++)for(var h=0,p=f[l].keypoints;h<p.length;h++){var d=p[h];d.x=(d.x+c)*a,d.y=(d.y+u)*i}return t}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function mn(t){var e=t||_e;if(null==e.architecture&&(e.architecture="MobileNetV1"),Te.indexOf(e.architecture)<0)throw new Error("Invalid architecture "+e.architecture+". Should be one of "+Te);if(null==e.inputResolution&&(e.inputResolution={height:257,width:257}),null==e.outputStride&&(e.outputStride=16),ke[e.architecture].indexOf(e.outputStride)<0)throw new Error("Invalid outputStride "+e.outputStride+". Should be one of "+ke[e.architecture]+" for architecture "+e.architecture+".");if(null==e.multiplier&&(e.multiplier=1),Ce[e.architecture].indexOf(e.multiplier)<0)throw new Error("Invalid multiplier "+e.multiplier+". Should be one of "+Ce[e.architecture]+" for architecture "+e.architecture+".");if(null==e.quantBytes&&(e.quantBytes=4),Oe.indexOf(e.quantBytes)<0)throw new Error("Invalid quantBytes "+e.quantBytes+". Should be one of "+Oe+" for architecture "+e.architecture+".");if("MobileNetV1"===e.architecture&&32===e.outputStride&&1!==e.multiplier)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return e}function yn(t){r.util.assert(Ae.indexOf(t)>=0,(function(){return"outputStride of "+t+" is invalid. It must be either 8 or 16."}))}function gn(t,e){return(t-1)%e==0}function bn(t,e){r.util.assert(gn(t.height,e),(function(){return"height of "+t.height+" is invalid for output stride "+e+"."})),r.util.assert(gn(t.width,e),(function(){return"width of "+t.width+" is invalid for output stride "+e+"."}))}function wn(t){var e=t;if(null==e.maxPoses&&(e.maxPoses=1),e.maxPoses<=0)throw new Error("Invalid maxPoses "+e.maxPoses+". Should be > 0.");if(e.maxPoses>1){if((e=i({},Me,e)).scoreThreshold<0||e.scoreThreshold>1)throw new Error("Invalid scoreThreshold "+e.scoreThreshold+". Should be in range [0.0, 1.0]");if(e.nmsRadius<=0)throw new Error("Invalid nmsRadius "+e.nmsRadius+".")}return e}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var vn="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",xn="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/";function Nn(t,e){var n="model-stride"+t+".json";return 4===e?xn+"float/"+n:xn+"quant"+e+"/"+n}function $n(t,e,n){var r={1:"100",.75:"075",.5:"050"},s="model-stride"+t+".json";return 4===n?vn+"float/"+r[e]+"/"+s:vn+"quant"+n+"/"+r[e]+"/"+s}function En(t,e){return{height:Sn(t.height,e),width:Sn(t.width,e)}}function Sn(t,e){return _n(t,e)?t:Math.floor(t/e)*e+1}function _n(t,e){return(t-1)%e==0}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var Tn=function(){function t(t,e){this.posenetModel=t;var n=this.posenetModel.inputs[0].shape;r.util.assert(-1===n[1]&&-1===n[2],(function(){return"Input shape ["+n[1]+", "+n[2]+"] must both be equal to or -1"}));var s=En(e.inputResolution,e.outputStride);yn(e.outputStride),bn(s,e.outputStride),this.inputResolution=s,this.outputStride=e.outputStride,this.architecture=e.architecture}return t.prototype.estimatePoses=function(t,e){return void 0===e&&(e=Ie),a(this,void 0,void 0,(function(){var n,s,o,i,a,c,l,f,h,p,d,m,y,g,b;return u(this,(function(u){switch(u.label){case 0:return n=wn(e),null==t?[2,[]]:(this.maxPoses=n.maxPoses,s=C(t,{inputResolution:this.inputResolution,keepAspectRatio:!0}),o=s.imageTensor,i=s.padding,a="ResNet50"===this.architecture?r.add(o,Re):z(o,[-1,1]),c=this.posenetModel.predict(a),"ResNet50"===this.architecture?(l=r.squeeze(c[2],[0]),f=r.squeeze(c[3],[0]),h=r.squeeze(c[0],[0]),p=r.squeeze(c[1],[0])):(l=r.squeeze(c[0],[0]),f=r.squeeze(c[1],[0]),h=r.squeeze(c[2],[0]),p=r.squeeze(c[3],[0])),d=r.sigmoid(f),1!==this.maxPoses?[3,2]:[4,hn(d,l,this.outputStride)]);case 1:return y=u.sent(),m=[y],[3,4];case 2:return[4,sn(d,l,h,p,this.outputStride,this.maxPoses,n.scoreThreshold,n.nmsRadius)];case 3:m=u.sent(),u.label=4;case 4:return g=N(t),b=dn(m,g,this.inputResolution,i),n.flipHorizontal&&(b=pn(b,g)),o.dispose(),a.dispose(),r.dispose(c),l.dispose(),f.dispose(),h.dispose(),p.dispose(),d.dispose(),[2,b]}}))}))},t.prototype.dispose=function(){this.posenetModel.dispose()},t.prototype.reset=function(){},t}();function kn(t){return void 0===t&&(t=_e),a(this,void 0,void 0,(function(){var e,r,s,o,i;return u(this,(function(a){switch(a.label){case 0:return"ResNet50"!==(e=mn(t)).architecture?[3,2]:(r=Nn(e.outputStride,e.quantBytes),[4,n.loadGraphModel(e.modelUrl||r)]);case 1:return s=a.sent(),[2,new Tn(s,e)];case 2:return o=$n(e.outputStride,e.multiplier,e.quantBytes),[4,n.loadGraphModel(e.modelUrl||o)];case 3:return i=a.sent(),[2,new Tn(i,e)]}}))}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function An(e,n){return a(this,void 0,void 0,(function(){var r,s;return u(this,(function(o){switch(e){case t.SupportedModels.PoseNet:return[2,kn(n)];case t.SupportedModels.BlazePose:if(s=void 0,null!=(r=n)){if("tfjs"===r.runtime)return[2,Dt(n)];if("mediapipe"===r.runtime)return[2,b(n)];s=r.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+s);case t.SupportedModels.MoveNet:return[2,Se(n)];default:throw new Error(e+" is not a supported model name.")}}))}))}var Cn={keypointsToNormalizedKeypoints:F},On={modelType:{SINGLEPOSE_LIGHTNING:qt,SINGLEPOSE_THUNDER:Ht,MULTIPOSE_LIGHTNING:Kt}};t.calculators=Cn,t.createDetector=An,t.movenet=On,t.util=Gt,Object.defineProperty(t,"q",{value:!0})}(JV.exports,0,XV(PQ),XV($Z));var BQ=HV({__proto__:null,default:KV(JV.exports)},[JV.exports]);let VQ;class zQ extends o{get poseType(){return"posedetection"}get parts(){return["nose","left_eye_inner","left_eye","left_eye_outer","right_eye_inner","right_eye","right_eye_outer","left_ear","right_ear","mouth_left","mouth_right","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_pinky","right_pinky","left_index","right_index","left_thumb","right_thumb","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle","left_heel","right_heel","left_foot_index","right_foot_index"]}async onMetadata(){super.onMetadata(),await async function(){const t=BQ.SupportedModels.BlazePose;VQ=await BQ.createDetector(t,{runtime:"mediapipe",modelType:"BlazePose",solutionPath:"https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.4.1630009814"})}(),this.poseDetectionFrame()}async poseDetectionFrame(){if((this.isPlaying||this.forceOneTimePoseProcess)&&this.videoEl.readyState>1){const t=await(async(t,e=0,n=0)=>{const r=[];if(VQ){const s=await VQ.estimatePoses(t.videoElement);s&&s.forEach(((s,o)=>{var i;const a={time:Date.now()-e,score:s.score,pose:o,points:[],aspectRatio:t.aspectRatio};null===(i=s.keypoints)||void 0===i||i.forEach((e=>{e.score&&e.score>=n&&a.points.push({name:e.name,score:e.score,position:[e.x/t.naturalSize.width,e.y/t.naturalSize.height,e.z]})})),a.points.length>0&&r.push(a)}))}return r})(this,this.recordingStartTime,this.minConfidence/100);this.onPoseFrame(t),this.forceOneTimePoseProcess=!1}requestAnimationFrame((()=>this.poseDetectionFrame()))}}function WQ(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(n){if("default"!==n&&!(n in t)){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}))})),Object.freeze(t)}customElements.define("posedetection-video",zQ);var UQ="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function jQ(t){return t&&t.q&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function GQ(t){if(t.q)return t;var e=Object.defineProperty({},"q",{value:!0});return Object.keys(t).forEach((function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})})),e}var qQ={},HQ={},KQ={},XQ="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};(function(){var t;function e(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}var n="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t};var r=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof XQ&&XQ];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function s(t,e){if(e)t:{var s=r;t=t.split(".");for(var o=0;o<t.length-1;o++){var i=t[o];if(!(i in s))break t;s=s[i]}(e=e(o=s[t=t[t.length-1]]))!=o&&null!=e&&n(s,t,{configurable:!0,writable:!0,value:e})}}function o(t){return(t={next:t})[Symbol.iterator]=function(){return this},t}function i(t){var n="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return n?n.call(t):{next:e(t)}}function a(t){if(!(t instanceof Array)){t=i(t);for(var e,n=[];!(e=t.next()).done;)n.push(e.value);t=n}return t}s("Symbol",(function(t){function e(t,e){this.g=t,n(this,"description",{configurable:!0,writable:!0,value:e})}if(t)return t;e.prototype.toString=function(){return this.g};var r="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",s=0;return function t(n){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new e(r+(n||"")+"_"+s++,n)}})),s("Symbol.iterator",(function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var s="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),i=0;i<s.length;i++){var a=r[s[i]];"function"==typeof a&&"function"!=typeof a.prototype[t]&&n(a.prototype,t,{configurable:!0,writable:!0,value:function(){return o(e(this))}})}return t}));var u,c="function"==typeof Object.create?Object.create:function(t){function e(){}return e.prototype=t,new e};if("function"==typeof Object.setPrototypeOf)u=Object.setPrototypeOf;else{var l;t:{var f={};try{f.__proto__={a:!0},l=f.a;break t}catch(t){}l=!1}u=l?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var h=u;function p(t,e){if(t.prototype=c(e.prototype),t.prototype.constructor=t,h)h(t,e);else for(var n in e)if("prototype"!=n)if(Object.defineProperties){var r=Object.getOwnPropertyDescriptor(e,n);r&&Object.defineProperty(t,n,r)}else t[n]=e[n];t.ra=e.prototype}function d(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.u=this.o=0,this.j=null}function m(t){if(t.l)throw new TypeError("Generator is already running");t.l=!0}function y(t,e){t.j={fa:e,ga:!0},t.g=t.o||t.u}function g(t,e,n){return t.g=n,{value:e}}function b(t){this.g=new d,this.h=t}function w(t,e,n,r){try{var s=e.call(t.g.i,n);if(!(s instanceof Object))throw new TypeError("Iterator result "+s+" is not an object");if(!s.done)return t.g.l=!1,s;var o=s.value}catch(e){return t.g.i=null,y(t.g,e),v(t)}return t.g.i=null,r.call(t.g,o),v(t)}function v(t){for(;t.g.g;)try{var e=t.h(t.g);if(e)return t.g.l=!1,{value:e.value,done:!1}}catch(e){t.g.h=void 0,y(t.g,e)}if(t.g.l=!1,t.g.j){if(e=t.g.j,t.g.j=null,e.ga)throw e.fa;return{value:e.return,done:!0}}return{value:void 0,done:!0}}function x(t){this.next=function(e){return m(t.g),t.g.i?e=w(t,t.g.i.next,e,t.g.s):(t.g.s(e),e=v(t)),e},this.throw=function(e){return m(t.g),t.g.i?e=w(t,t.g.i.throw,e,t.g.s):(y(t.g,e),e=v(t)),e},this.return=function(e){return function(t,e){m(t.g);var n=t.g.i;return n?w(t,"return"in n?n.return:function(t){return{value:t,done:!0}},e,t.g.return):(t.g.return(e),v(t))}(t,e)},this[Symbol.iterator]=function(){return this}}function N(t){return function(t){function e(e){return t.next(e)}function n(e){return t.throw(e)}return new Promise((function(r,s){!function t(o){o.done?r(o.value):Promise.resolve(o.value).then(e,n).then(t,s)}(t.next())}))}(new x(new b(t)))}d.prototype.s=function(t){this.h=t},d.prototype.return=function(t){this.j={return:t},this.g=this.u},s("Promise",(function(t){function e(t){this.h=0,this.i=void 0,this.g=[],this.s=!1;var e=this.j();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function n(){this.g=null}function s(t){return t instanceof e?t:new e((function(e){e(t)}))}if(t)return t;n.prototype.h=function(t){if(null==this.g){this.g=[];var e=this;this.i((function(){e.l()}))}this.g.push(t)};var o=r.setTimeout;n.prototype.i=function(t){o(t,0)},n.prototype.l=function(){for(;this.g&&this.g.length;){var t=this.g;this.g=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.j(t)}}}this.g=null},n.prototype.j=function(t){this.i((function(){throw t}))},e.prototype.j=function(){function t(t){return function(r){n||(n=!0,t.call(e,r))}}var e=this,n=!1;return{resolve:t(this.D),reject:t(this.l)}},e.prototype.D=function(t){if(t===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.H(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.A(t):this.o(t)}},e.prototype.A=function(t){var e=void 0;try{e=t.then}catch(t){return void this.l(t)}"function"==typeof e?this.I(e,t):this.o(t)},e.prototype.l=function(t){this.u(2,t)},e.prototype.o=function(t){this.u(1,t)},e.prototype.u=function(t,e){if(0!=this.h)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.h);this.h=t,this.i=e,2===this.h&&this.G(),this.B()},e.prototype.G=function(){var t=this;o((function(){if(t.C()){var e=r.console;void 0!==e&&e.error(t.i)}}),1)},e.prototype.C=function(){if(this.s)return!1;var t=r.CustomEvent,e=r.Event,n=r.dispatchEvent;return void 0===n||("function"==typeof t?t=new t("unhandledrejection",{cancelable:!0}):"function"==typeof e?t=new e("unhandledrejection",{cancelable:!0}):(t=r.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,t),t.promise=this,t.reason=this.i,n(t))},e.prototype.B=function(){if(null!=this.g){for(var t=0;t<this.g.length;++t)a.h(this.g[t]);this.g=null}};var a=new n;return e.prototype.H=function(t){var e=this.j();t.M(e.resolve,e.reject)},e.prototype.I=function(t,e){var n=this.j();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},e.prototype.then=function(t,n){function r(t,e){return"function"==typeof t?function(e){try{s(t(e))}catch(t){o(t)}}:e}var s,o,i=new e((function(t,e){s=t,o=e}));return this.M(r(t,s),r(n,o)),i},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.M=function(t,e){function n(){switch(r.h){case 1:t(r.i);break;case 2:e(r.i);break;default:throw Error("Unexpected state: "+r.h)}}var r=this;null==this.g?a.h(n):this.g.push(n),this.s=!0},e.resolve=s,e.reject=function(t){return new e((function(e,n){n(t)}))},e.race=function(t){return new e((function(e,n){for(var r=i(t),o=r.next();!o.done;o=r.next())s(o.value).M(e,n)}))},e.all=function(t){var n=i(t),r=n.next();return r.done?s([]):new e((function(t,e){function o(e){return function(n){i[e]=n,0==--a&&t(i)}}var i=[],a=0;do{i.push(void 0),a++,s(r.value).M(o(i.length-1),e),r=n.next()}while(!r.done)}))},e}));var $="function"==typeof Object.assign?Object.assign:function(t,e){for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r)for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t};s("Object.assign",(function(t){return t||$})),s("Object.is",(function(t){return t||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}})),s("Array.prototype.includes",(function(t){return t||function(t,e){var n=this;n instanceof String&&(n=String(n));var r=n.length;for(0>(e=e||0)&&(e=Math.max(e+r,0));e<r;e++){var s=n[e];if(s===t||Object.is(s,t))return!0}return!1}})),s("String.prototype.includes",(function(t){return t||function(t,e){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==this.indexOf(t,e||0)}})),s("Array.prototype.keys",(function(t){return t||function(){return function(t,e){t instanceof String&&(t+="");var n=0,r=!1,s={next:function(){if(!r&&n<t.length){var s=n++;return{value:e(s,t[s]),done:!1}}return r=!0,{done:!0,value:void 0}}};return s[Symbol.iterator]=function(){return s},s}(this,(function(t){return t}))}}));var E=this||self;function S(t,e){t=t.split(".");var n,r=E;t[0]in r||void 0===r.execScript||r.execScript("var "+t[0]);for(;t.length&&(n=t.shift());)t.length||void 0===e?r=r[n]&&r[n]!==Object.prototype[n]?r[n]:r[n]={}:r[n]=e}function _(){throw Error("Invalid UTF8")}function T(t,e){return e=String.fromCharCode.apply(null,e),null==t?e:t+e}var k,A,C="undefined"!=typeof TextDecoder,O="undefined"!=typeof TextEncoder,I={},M=null;function R(t){var e;void 0===e&&(e=0),F(),e=I[e];for(var n=Array(Math.floor(t.length/3)),r=e[64]||"",s=0,o=0;s<t.length-2;s+=3){var i=t[s],a=t[s+1],u=t[s+2],c=e[i>>2];i=e[(3&i)<<4|a>>4],a=e[(15&a)<<2|u>>6],u=e[63&u],n[o++]=c+i+a+u}switch(c=0,u=r,t.length-s){case 2:u=e[(15&(c=t[s+1]))<<2]||r;case 1:t=t[s],n[o]=e[t>>2]+e[(3&t)<<4|c>>4]+u+r}return n.join("")}function D(t){var e=t.length,n=3*e/4;n%3?n=Math.floor(n):-1!="=.".indexOf(t[e-1])&&(n=-1!="=.".indexOf(t[e-2])?n-2:n-1);var r=new Uint8Array(n),s=0;return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),s=M[n];if(null!=s)return s;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}F();for(var r=0;;){var s=n(-1),o=n(0),i=n(64),a=n(64);if(64===a&&-1===s)break;e(s<<2|o>>4),64!=i&&(e(o<<4&240|i>>2),64!=a&&e(i<<6&192|a))}}(t,(function(t){r[s++]=t})),s!==n?r.subarray(0,s):r}function F(){if(!M){M={};for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++){var r=t.concat(e[n].split(""));I[n]=r;for(var s=0;s<r.length;s++){var o=r[s];void 0===M[o]&&(M[o]=s)}}}}var L,P="function"==typeof Uint8Array;function B(t){return P&&null!=t&&t instanceof Uint8Array}function V(t){if(this.L=t,null!==t&&0===t.length)throw Error("ByteString should be constructed with non-empty values")}var z="function"==typeof Uint8Array.prototype.slice,W=0;function U(t,e){return Error("Invalid wire type: "+t+" (at position "+e+")")}function j(){return Error("Failed to read varint, encoding is invalid.")}function G(t,e){e=void 0!==(e=void 0===e?{}:e).v&&e.v,this.h=null,this.g=this.i=this.j=0,this.v=e,t&&q(this,t)}function q(t,e){t.h=function(t,e){if(t.constructor===Uint8Array)return t;if(t.constructor===ArrayBuffer)return new Uint8Array(t);if(t.constructor===Array)return new Uint8Array(t);if(t.constructor===String)return D(t);if(t.constructor===V)return!e&&(e=t.L)&&e.constructor===Uint8Array?e:(e=null==(e=t.L)||B(e)?e:"string"==typeof e?D(e):null,(t=t.L=e)?new Uint8Array(t):L||(L=new Uint8Array(0)));if(t instanceof Uint8Array)return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, or Array of numbers")}(e,t.v),t.j=0,t.i=t.h.length,t.g=t.j}function H(t){if(t.g>t.i)throw Error("Tried to read past the end of the data "+t.g+" > "+t.i)}function K(t){var e=t.h,n=e[t.g],r=127&n;if(128>n)return t.g+=1,H(t),r;if(r|=(127&(n=e[t.g+1]))<<7,128>n)return t.g+=2,H(t),r;if(r|=(127&(n=e[t.g+2]))<<14,128>n)return t.g+=3,H(t),r;if(r|=(127&(n=e[t.g+3]))<<21,128>n)return t.g+=4,H(t),r;if(n=e[t.g+4],t.g+=5,r|=(15&n)<<28,128>n)return H(t),r;if(128<=e[t.g++]&&128<=e[t.g++]&&128<=e[t.g++]&&128<=e[t.g++]&&128<=e[t.g++])throw j();return H(t),r}G.prototype.reset=function(){this.g=this.j};var X=[];function J(){this.g=[]}function Y(t,e){for(;127<e;)t.g.push(127&e|128),e>>>=7;t.g.push(e)}function Z(t){var e={},n=void 0!==e.W&&e.W;this.l={v:void 0!==e.v&&e.v},this.W=n,e=this.l,X.length?(n=X.pop(),e&&(n.v=e.v),t&&q(n,t),t=n):t=new G(t,e),this.g=t,this.j=this.g.g,this.h=this.i=-1}function Q(t){var e=t.g;if(e.g==e.i)return!1;t.j=t.g.g;var n=K(t.g)>>>0;if(e=n>>>3,!(0<=(n&=7)&&5>=n))throw U(n,t.j);if(1>e)throw Error("Invalid field number: "+e+" (at position "+t.j+")");return t.i=e,t.h=n,!0}function tt(t){switch(t.h){case 0:if(0!=t.h)tt(t);else t:{for(var e=(t=t.g).g,n=e+10;e<n;)if(0==(128&t.h[e++])){t.g=e,H(t);break t}throw j()}break;case 1:(t=t.g).g+=8,H(t);break;case 2:2!=t.h?tt(t):(e=K(t.g)>>>0,(t=t.g).g+=e,H(t));break;case 5:(t=t.g).g+=4,H(t);break;case 3:for(e=t.i;;){if(!Q(t))throw Error("Unmatched start-group tag: stream EOF");if(4==t.h){if(t.i!=e)throw Error("Unmatched end-group tag");break}tt(t)}break;default:throw U(t.h,t.j)}}J.prototype.length=function(){return this.g.length},J.prototype.end=function(){var t=this.g;return this.g=[],t},Z.prototype.reset=function(){this.g.reset(),this.j=this.g.g,this.h=this.i=-1};var et=[];function nt(){this.i=[],this.h=0,this.g=new J}function rt(t,e){0!==e.length&&(t.i.push(e),t.h+=e.length)}var st="function"==typeof Symbol&&"symbol"==typeof Symbol()?Symbol(void 0):void 0;function ot(t,e){Object.isFrozen(t)||(st?t[st]|=e:void 0!==t.N?t.N|=e:Object.defineProperties(t,{N:{value:e,configurable:!0,writable:!0,enumerable:!1}}))}function it(t){var e;return null==(e=st?t[st]:t.N)?0:e}function at(t){return ot(t,1),t}function ut(t){return!!Array.isArray(t)&&!!(2&it(t))}function ct(t){if(!Array.isArray(t))throw Error("cannot mark non-array as immutable");ot(t,2)}function lt(t){return null!==t&&"object"==typeof t&&!Array.isArray(t)&&t.constructor===Object}var ft=Object.freeze(at([]));function ht(t){if(ut(t.m))throw Error("Cannot mutate an immutable Message")}var pt,dt="undefined"!=typeof Symbol&&void 0!==Symbol.hasInstance;function mt(t){return{value:t,configurable:!1,writable:!1,enumerable:!1}}function yt(t,e,n){return-1===e?null:e>=t.i?t.g?t.g[e]:void 0:void 0!==n&&n&&t.g&&null!=(n=t.g[e])?n:t.m[e+t.h]}function gt(t,e,n,r){r=void 0!==r&&r,ht(t),e<t.i&&!r?t.m[e+t.h]=n:(t.g||(t.g=t.m[t.i+t.h]={}))[e]=n}function bt(t,e,n,r){n=void 0===n||n;var s=yt(t,e,r=void 0!==r&&r);return null==s&&(s=ft),ut(t.m)?n&&(ct(s),Object.freeze(s)):(s===ft||ut(s))&&gt(t,e,s=at(s.slice()),r),s}function wt(t,e,n){return null==(t=null==(t=yt(t,e))?t:+t)?void 0===n?0:n:t}function vt(t,e,n,r){t.j||(t.j={});var s=ut(t.m),o=t.j[n];if(!o){r=bt(t,n,!0,void 0!==r&&r),o=[],s=s||ut(r);for(var i=0;i<r.length;i++)o[i]=new e(r[i]),s&&ct(o[i].m);s&&(ct(o),Object.freeze(o)),t.j[n]=o}return o}function xt(t,e,n,r,s){var o=void 0!==o&&o;return ht(t),o=vt(t,n,e,o),n=r||new n,t=bt(t,e),null!=s?(o.splice(s,0,n),t.splice(s,0,n.m)):(o.push(n),t.push(n.m)),n}function Nt(t,e){return null==(t=yt(t,e))?0:t}function $t(t,e){return null==(t=yt(t,e))?"":t}function Et(t){var e=Tt;return _t(t,e=void 0===e?kt:e)}function St(t,e){if(null!=t){if(Array.isArray(t))t=_t(t,e);else if(lt(t)){var n,r={};for(n in t)r[n]=St(t[n],e);t=r}else t=e(t);return t}}function _t(t,e){for(var n=t.slice(),r=0;r<n.length;r++)n[r]=St(n[r],e);return Array.isArray(t)&&1&it(t)&&at(n),n}function Tt(t){return t&&"object"==typeof t&&t.toJSON?t.toJSON():(t=function(t){switch(typeof t){case"number":return isFinite(t)?t:String(t);case"object":if(t&&!Array.isArray(t)){if(B(t))return R(t);if(t instanceof V){var e=t.L;return e=null==e||"string"==typeof e?e:P&&e instanceof Uint8Array?R(e):null,(t.L=e)||""}}}return t}(t),Array.isArray(t)?Et(t):t)}function kt(t){return B(t)?new Uint8Array(t):t}function At(t,e,n){t||(t=pt),pt=null;var r=this.constructor.h;if(t||(t=r?[r]:[]),this.h=(r?0:-1)-(this.constructor.g||0),this.j=void 0,this.m=t,t=(r=this.m.length)-1,r&&lt(r=this.m[t])?(this.i=t-this.h,this.g=r):void 0!==e&&-1<e?(this.i=Math.max(e,t+1-this.h),this.g=void 0):this.i=Number.MAX_VALUE,n)for(e=0;e<n.length;e++)if((t=n[e])<this.i)t+=this.h,(r=this.m[t])?Array.isArray(r)&&at(r):this.m[t]=ft;else{var s=(r=this.g||(this.g=this.m[this.i+this.h]={}))[t];s?Array.isArray(s)&&at(s):r[t]=ft}}function Ct(){At.apply(this,arguments)}if(At.prototype.toJSON=function(){return Et(this.m)},At.prototype.toString=function(){return this.m.toString()},p(Ct,At),dt){var Ot={};Object.defineProperties(Ct,(Ot[Symbol.hasInstance]=mt((function(){throw Error("Cannot perform instanceof checks for MutableMessage")})),Ot))}function It(t,e,n){if(n){var r,s={};for(r in n){var o=n[r],i=o.ja;i||(s.F=o.pa||o.ha.P,o.ba?(s.U=Bt(o.ba),i=function(t){return function(e,n,r){return t.F(e,n,r,t.U)}}(s)):o.da?(s.T=Vt(o.X.g,o.da),i=function(t){return function(e,n,r){return t.F(e,n,r,t.T)}}(s)):i=s.F,o.ja=i),i(e,t,o.X),s={F:s.F,U:s.U,T:s.T}}}!function(t,e){if(e=e.ca){rt(t,t.g.end());for(var n=0;n<e.length;n++)rt(t,e[n])}}(e,t)}var Mt=Symbol();function Rt(t,e,n){return t[Mt]||(t[Mt]=function(t,r){return e(t,r,n)})}function Dt(t){var e=t[Mt];if(!e){var n=Zt(t);e=function(t,e){return Qt(t,e,n)},t[Mt]=e}return e}function Ft(t){var e=function(t){var e=t.ba;return e?Dt(e):(e=t.oa)?Rt(t.X.g,e,t.da):void 0}(t),n=t.X,r=t.ha.O;return e?function(t,s){return r(t,s,n,e)}:function(t,e){return r(t,e,n)}}function Lt(t,e,n,r,s,o){var i=0;for((t=t()).length&&"number"!=typeof t[0]&&(n(e,t[0]),i++);i<t.length;){n=t[i++];for(var a=i+1;a<t.length&&"number"!=typeof t[a];)a++;var u=t[i++];switch(a-=i){case 0:r(e,n,u);break;case 1:r(e,n,u,t[i++]);break;case 2:s(e,n,u,t[i++],t[i++]);break;case 3:a=t[i++];var c=t[i++],l=t[i++];Array.isArray(l)?s(e,n,u,a,c,l):o(e,n,u,a,c,l);break;case 4:o(e,n,u,t[i++],t[i++],t[i++],t[i++]);break;default:throw Error("unexpected number of binary field arguments: "+a)}}return e}var Pt=Symbol();function Bt(t){var e=t[Pt];if(!e){var n=qt(t);e=function(t,e){return ee(t,e,n)},t[Pt]=e}return e}function Vt(t,e){var n=t[Pt];return n||(n=function(t,n){return It(t,n,e)},t[Pt]=n),n}var zt=Symbol();function Wt(t,e){t.push(e)}function Ut(t,e,n){t.push(e,n.P)}function jt(t,e,n,r,s){var o=Bt(s),i=n.P;t.push(e,(function(t,e,n){return i(t,e,n,r,o)}))}function Gt(t,e,n,r,s,o){var i=Vt(r,o),a=n.P;t.push(e,(function(t,e,n){return a(t,e,n,r,i)}))}function qt(t){var e=t[zt];return e||Lt(t,t[zt]=[],Wt,Ut,jt,Gt)}var Ht=Symbol();function Kt(t,e){t[0]=e}function Xt(t,e,n,r){var s=n.O;t[e]=r?function(t,e,n){return s(t,e,n,r)}:s}function Jt(t,e,n,r,s,o){var i=n.O,a=Dt(s);t[e]=function(t,e,n){return i(t,e,n,r,a,o)}}function Yt(t,e,n,r,s,o,i){var a=n.O,u=Rt(r,s,o);t[e]=function(t,e,n){return a(t,e,n,r,u,i)}}function Zt(t){var e=t[Ht];return e||Lt(t,t[Ht]={},Kt,Xt,Jt,Yt)}function Qt(t,e,n){for(;Q(e)&&4!=e.h;){var r=e.i,s=n[r];if(!s){var o=n[0];o&&(o=o[r])&&(s=n[r]=Ft(o))}if(!(s&&s(e,t,r)||(s=e,r=t,o=s.j,tt(s),s.W))){var i=s.g.h;s=o===(s=s.g.g)?L||(L=new Uint8Array(0)):z?i.slice(o,s):new Uint8Array(i.subarray(o,s)),(o=r.ca)?o.push(s):r.ca=[s]}}return t}function te(t,e,n){if(et.length){var r=et.pop();t&&(q(r.g,t),r.i=-1,r.h=-1),t=r}else t=new Z(t);try{return Qt(new e,t,Zt(n))}finally{(e=t.g).h=null,e.j=0,e.i=0,e.g=0,e.v=!1,t.i=-1,t.h=-1,100>et.length&&et.push(t)}}function ee(t,e,n){for(var r=n.length,s=1==r%2,o=s?1:0;o<r;o+=2)(0,n[o+1])(e,t,n[o]);It(t,e,s?n[0]:void 0)}function ne(t,e){var n=new nt;ee(t,n,qt(e)),rt(n,n.g.end()),t=new Uint8Array(n.h);for(var r=(e=n.i).length,s=0,o=0;o<r;o++){var i=e[o];t.set(i,s),s+=i.length}return n.i=[t],t}function re(t,e){return{O:t,P:e}}var se=re((function(t,e,n){if(5!==t.h)return!1;var r=(t=t.g).h[t.g],s=t.h[t.g+1],o=t.h[t.g+2],i=t.h[t.g+3];return t.g+=4,H(t),t=2*((s=(r<<0|s<<8|o<<16|i<<24)>>>0)>>31)+1,r=s>>>23&255,s&=8388607,gt(e,n,255==r?s?NaN:1/0*t:0==r?t*Math.pow(2,-149)*s:t*Math.pow(2,r-150)*(s+Math.pow(2,23))),!0}),(function(t,e,n){if(null!=(e=yt(e,n))){Y(t.g,8*n+5),t=t.g;var r=e;0===(r=(n=0>r?1:0)?-r:r)?0<1/r?W=0:(0,W=2147483648):isNaN(r)?(0,W=2147483647):34028234663852886e22<r?(0,W=(n<<31|2139095040)>>>0):11754943508222875e-54>r?(r=Math.round(r/Math.pow(2,-149)),0,W=(n<<31|r)>>>0):(e=Math.floor(Math.log(r)/Math.LN2),r*=Math.pow(2,-e),16777216<=(r=Math.round(8388608*r))&&++e,0,W=(n<<31|e+127<<23|8388607&r)>>>0),n=W,t.g.push(n>>>0&255),t.g.push(n>>>8&255),t.g.push(n>>>16&255),t.g.push(n>>>24&255)}})),oe=re((function(t,e,n){if(0!==t.h)return!1;for(var r=t.g,s=128,o=0,i=t=0;4>i&&128<=s;i++)s=r.h[r.g++],H(r),o|=(127&s)<<7*i;if(128<=s&&(s=r.h[r.g++],H(r),o|=(127&s)<<28,t|=(127&s)>>4),128<=s)for(i=0;5>i&&128<=s;i++)s=r.h[r.g++],H(r),t|=(127&s)<<7*i+3;if(!(128>s))throw j();return r=o>>>0,(t=2147483648&(s=t>>>0))&&(s=~s>>>0,0==(r=1+~r>>>0)&&(s=s+1>>>0)),r=4294967296*s+(r>>>0),gt(e,n,t?-r:r),!0}),(function(t,e,n){if(null!=(e=yt(e,n))&&null!=e){Y(t.g,8*n),t=t.g;var r=e;for(n=0>r,e=(r=Math.abs(r))>>>0,r=Math.floor((r-e)/4294967296),r>>>=0,n&&(r=~r>>>0,4294967295<(e=1+(~e>>>0))&&(e=0,4294967295<++r&&(r=0))),n=W=e,e=r;0<e||127<n;)t.g.push(127&n|128),n=(n>>>7|e<<25)>>>0,e>>>=7;t.g.push(n)}})),ie=re((function(t,e,n){return 0===t.h&&(gt(e,n,K(t.g)),!0)}),(function(t,e,n){if(null!=(e=yt(e,n))&&null!=e)if(Y(t.g,8*n),t=t.g,0<=(n=e))Y(t,n);else{for(e=0;9>e;e++)t.g.push(127&n|128),n>>=7;t.g.push(1)}})),ae=re((function(t,e,n){if(2!==t.h)return!1;var r,s=K(t.g)>>>0,o=(t=t.g).g;if(t.g+=s,H(t),t=t.h,C)(r=k)||(r=k=new TextDecoder("utf-8",{fatal:!0})),r=r.decode(t.subarray(o,o+s));else{s=o+s;for(var i,a,u,c=[],l=null;o<s;)128>(i=t[o++])?c.push(i):224>i?o>=s?_():(a=t[o++],194>i||128!=(192&a)?(o--,_()):c.push((31&i)<<6|63&a)):240>i?o>=s-1?_():128!=(192&(a=t[o++]))||224===i&&160>a||237===i&&160<=a||128!=(192&(r=t[o++]))?(o--,_()):c.push((15&i)<<12|(63&a)<<6|63&r):244>=i?o>=s-2?_():128!=(192&(a=t[o++]))||0!=a-144+(i<<28)>>30||128!=(192&(r=t[o++]))||128!=(192&(u=t[o++]))?(o--,_()):(i=(7&i)<<18|(63&a)<<12|(63&r)<<6|63&u,i-=65536,c.push(55296+(i>>10&1023),56320+(1023&i))):_(),8192<=c.length&&(l=T(l,c),c.length=0);r=T(l,c)}return gt(e,n,r),!0}),(function(t,e,n){if(null!=(e=yt(e,n))){var r=!1;if(r=void 0!==r&&r,O){if(r&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(e))throw Error("Found an unpaired surrogate");e=(A||(A=new TextEncoder)).encode(e)}else{for(var s=0,o=new Uint8Array(3*e.length),i=0;i<e.length;i++){var a=e.charCodeAt(i);if(128>a)o[s++]=a;else{if(2048>a)o[s++]=a>>6|192;else{if(55296<=a&&57343>=a){if(56319>=a&&i<e.length){var u=e.charCodeAt(++i);if(56320<=u&&57343>=u){a=1024*(a-55296)+u-56320+65536,o[s++]=a>>18|240,o[s++]=a>>12&63|128,o[s++]=a>>6&63|128,o[s++]=63&a|128;continue}i--}if(r)throw Error("Found an unpaired surrogate");a=65533}o[s++]=a>>12|224,o[s++]=a>>6&63|128}o[s++]=63&a|128}}e=o.subarray(0,s)}Y(t.g,8*n+2),Y(t.g,e.length),rt(t,t.g.end()),rt(t,e)}})),ue=re((function(t,e,n,r,s){if(2!==t.h)return!1;e=xt(e,n,r),n=t.g.i,r=K(t.g)>>>0;var o=t.g.g+r,i=o-n;if(0>=i&&(t.g.i=o,s(e,t),i=o-t.g.g),i)throw Error("Message parsing ended unexpectedly. Expected to read "+r+" bytes, instead read "+(r-i)+" bytes, either the data ended unexpectedly or the message misreported its own length");return t.g.g=o,t.g.i=n,!0}),(function(t,e,n,r,s){if(null!=(e=vt(e,r,n)))for(r=0;r<e.length;r++){var o=t;Y(o.g,8*n+2);var i=o.g.end();rt(o,i),i.push(o.h),o=i,s(e[r],t),i=t;var a=o.pop();for(a=i.h+i.g.length()-a;127<a;)o.push(127&a|128),a>>>=7,i.h++;o.push(a),i.h++}}));function ce(){Ct.apply(this,arguments)}if(p(ce,Ct),dt){var le={};Object.defineProperties(ce,(le[Symbol.hasInstance]=mt(Object[Symbol.hasInstance]),le))}function fe(t){ce.call(this,t)}function he(){return[1,ie,2,se,3,ae,4,ae]}function pe(t){ce.call(this,t,-1,me)}function de(){return[1,ue,fe,he]}p(fe,ce),p(pe,ce),pe.prototype.addClassification=function(t,e){return xt(this,1,fe,t,e),this};var me=[1];function ye(t){ce.call(this,t)}function ge(){return[1,se,2,se,3,se,4,se,5,se]}function be(t){ce.call(this,t,-1,ve)}function we(){return[1,ue,ye,ge]}p(ye,ce),p(be,ce);var ve=[1];function xe(t){ce.call(this,t)}function Ne(){return[1,se,2,se,3,se,4,se,5,se,6,oe]}function $e(t,e,n){if(n=t.createShader(0===n?t.VERTEX_SHADER:t.FRAGMENT_SHADER),t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw Error("Could not compile WebGL shader.\n\n"+t.getShaderInfoLog(n));return n}function Ee(t){return vt(t,fe,1).map((function(t){return{index:Nt(t,1),score:wt(t,2),label:null!=yt(t,3)?$t(t,3):void 0,displayName:null!=yt(t,4)?$t(t,4):void 0}}))}function Se(t){return{x:wt(t,1),y:wt(t,2),z:wt(t,3),visibility:null!=yt(t,4)?wt(t,4):void 0}}function _e(t){return t.map((function(t){return vt(te(t,be,we),ye,1).map(Se)}))}function Te(t,e){this.h=t,this.g=e,this.l=0}function ke(t,e,n){return function(t,e){var n=t.g;if(void 0===t.o){var r=$e(n,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",0),s=$e(n,"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D sampler0;\n  void main(){\n    gl_FragColor = texture2D(sampler0, vTex);\n  }",1),o=n.createProgram();if(n.attachShader(o,r),n.attachShader(o,s),n.linkProgram(o),!n.getProgramParameter(o,n.LINK_STATUS))throw Error("Could not compile WebGL program.\n\n"+n.getProgramInfoLog(o));r=t.o=o,n.useProgram(r),s=n.getUniformLocation(r,"sampler0"),t.j={K:n.getAttribLocation(r,"aVertex"),J:n.getAttribLocation(r,"aTex"),qa:s},t.u=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,t.u),n.enableVertexAttribArray(t.j.K),n.vertexAttribPointer(t.j.K,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),t.s=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,t.s),n.enableVertexAttribArray(t.j.J),n.vertexAttribPointer(t.j.J,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.uniform1i(s,0)}r=t.j,n.useProgram(t.o),n.canvas.width=e.width,n.canvas.height=e.height,n.viewport(0,0,e.width,e.height),n.activeTexture(n.TEXTURE0),t.h.bindTexture2d(e.glName),n.enableVertexAttribArray(r.K),n.bindBuffer(n.ARRAY_BUFFER,t.u),n.vertexAttribPointer(r.K,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.J),n.bindBuffer(n.ARRAY_BUFFER,t.s),n.vertexAttribPointer(r.J,2,n.FLOAT,!1,0,0),n.bindFramebuffer(n.DRAW_FRAMEBUFFER?n.DRAW_FRAMEBUFFER:n.FRAMEBUFFER,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.colorMask(!0,!0,!0,!0),n.drawArrays(n.TRIANGLE_FAN,0,4),n.disableVertexAttribArray(r.K),n.disableVertexAttribArray(r.J),n.bindBuffer(n.ARRAY_BUFFER,null),t.h.bindTexture2d(0)}(t,e),"function"==typeof t.g.canvas.transferToImageBitmap?Promise.resolve(t.g.canvas.transferToImageBitmap()):n?Promise.resolve(t.g.canvas):"function"==typeof createImageBitmap?createImageBitmap(t.g.canvas):(void 0===t.i&&(t.i=document.createElement("canvas")),new Promise((function(e){t.i.height=t.g.canvas.height,t.i.width=t.g.canvas.width,t.i.getContext("2d",{}).drawImage(t.g.canvas,0,0,t.g.canvas.width,t.g.canvas.height),e(t.i)})))}function Ae(t){this.g=t}p(xe,ce);var Ce=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Oe(t,e){return e+t}function Ie(t,e){window[t]=e}function Me(t){if(this.g=t,this.listeners={},this.j={},this.H={},this.o={},this.u={},this.I=this.s=this.$=!0,this.D=Promise.resolve(),this.Z="",this.C={},this.locateFile=t&&t.locateFile||Oe,"object"==typeof window)var e=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else{if("undefined"==typeof location)throw Error("solutions can only be loaded on a web page or in a web worker");e=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"}if(this.aa=e,t.options)for(var n=(e=i(Object.keys(t.options))).next();!n.done;n=e.next()){n=n.value;var r=t.options[n].default;void 0!==r&&(this.j[n]="function"==typeof r?r():r)}}function Re(t){var e,n,r,s,o,i,u,c,l,f,h;return N((function(p){switch(p.g){case 1:return t.$?(e=void 0===t.g.files?[]:"function"==typeof t.g.files?t.g.files(t.j):t.g.files,g(p,N((function(t){switch(t.g){case 1:return t.o=2,g(t,WebAssembly.instantiate(Ce),4);case 4:t.g=3,t.o=0;break;case 2:return t.o=0,t.j=null,t.return(!1);case 3:return t.return(!0)}})),2)):p.return();case 2:if(n=p.h,"object"==typeof window)return Ie("createMediapipeSolutionsWasm",{locateFile:t.locateFile}),Ie("createMediapipeSolutionsPackedAssets",{locateFile:t.locateFile}),i=e.filter((function(t){return void 0!==t.data})),u=e.filter((function(t){return void 0===t.data})),c=Promise.all(i.map((function(e){var n=De(t,e.url);if(void 0!==e.path){var r=e.path;n=n.then((function(e){return t.overrideFile(r,e),Promise.resolve(e)}))}return n}))),l=Promise.all(u.map((function(e){return void 0===e.simd||e.simd&&n||!e.simd&&!n?function(t){var e=document.createElement("script");return e.setAttribute("src",t),e.setAttribute("crossorigin","anonymous"),new Promise((function(t){e.addEventListener("load",(function(){t()}),!1),e.addEventListener("error",(function(){t()}),!1),document.body.appendChild(e)}))}(t.locateFile(e.url,t.aa)):Promise.resolve()}))).then((function(){var e,n,r;return N((function(s){if(1==s.g)return e=window.createMediapipeSolutionsWasm,n=window.createMediapipeSolutionsPackedAssets,r=t,g(s,e(n),2);r.h=s.h,s.g=0}))})),f=N((function(e){return t.g.graph&&t.g.graph.url?e=g(e,De(t,t.g.graph.url),0):(e.g=0,e=void 0),e})),g(p,Promise.all([l,c,f]),7);if("function"!=typeof importScripts)throw Error("solutions can only be loaded on a web page or in a web worker");return r=e.filter((function(t){return void 0===t.simd||t.simd&&n||!t.simd&&!n})).map((function(e){return t.locateFile(e.url,t.aa)})),importScripts.apply(null,a(r)),s=t,g(p,createMediapipeSolutionsWasm(Module),6);case 6:s.h=p.h,t.l=new OffscreenCanvas(1,1),t.h.canvas=t.l,o=t.h.GL.createContext(t.l,{antialias:!1,alpha:!1,na:"undefined"!=typeof WebGL2RenderingContext?2:1}),t.h.GL.makeContextCurrent(o),p.g=4;break;case 7:if(t.l=document.createElement("canvas"),!(h=t.l.getContext("webgl2",{}))&&!(h=t.l.getContext("webgl",{})))return alert("Failed to create WebGL canvas context when passing video frame."),p.return();t.G=h,t.h.canvas=t.l,t.h.createContext(t.l,!0,!0,{});case 4:t.i=new t.h.SolutionWasm,t.$=!1,p.g=0}}))}function De(t,e){var n,r;return N((function(s){return e in t.H?s.return(t.H[e]):(n=t.locateFile(e,""),r=fetch(n).then((function(t){return t.arrayBuffer()})),t.H[e]=r,s.return(r))}))}function Fe(t,e,n){var r,s,o,a,u,c,l,f,h,p,d,m,y,b;return N((function(w){switch(w.g){case 1:if(!n)return w.return(e);for(r={},s=0,o=i(Object.keys(n)),a=o.next();!a.done;a=o.next())u=a.value,"string"!=typeof(c=n[u])&&"texture"===c.type&&void 0!==e[c.stream]&&++s;1<s&&(t.I=!1),l=i(Object.keys(n)),a=l.next();case 2:if(a.done){w.g=4;break}if(f=a.value,"string"==typeof(h=n[f]))return y=r,b=f,g(w,function(t,e,n){var r;return N((function(s){return"number"==typeof n||n instanceof Uint8Array||n instanceof t.h.Uint8BlobList?s.return(n):n instanceof t.h.Texture2dDataOut?((r=t.u[e])||(r=new Te(t.h,t.G),t.u[e]=r),s.return(ke(r,n,t.I))):s.return(void 0)}))}(t,f,e[h]),14);if(p=e[h.stream],"detection_list"===h.type){if(p){for(var v=p.getRectList(),x=p.getLandmarksList(),$=p.getClassificationsList(),E=[],S=0;S<v.size();++S){var _=te(v.get(S),xe,Ne);_={ea:{ka:wt(_,1),la:wt(_,2),height:wt(_,3),width:wt(_,4),rotation:wt(_,5,0),ia:Nt(_,6)},Y:vt(te(x.get(S),be,we),ye,1).map(Se),V:Ee(te($.get(S),pe,de))},E.push(_)}v=E}else v=[];r[f]=v,w.g=7;break}if("proto_list"===h.type){if(p){for(v=Array(p.size()),x=0;x<p.size();x++)v[x]=p.get(x);p.delete()}else v=[];r[f]=v,w.g=7;break}if(void 0===p){w.g=3;break}if("float_list"===h.type){r[f]=p,w.g=7;break}if("proto"===h.type){r[f]=p,w.g=7;break}if("texture"!==h.type)throw Error("Unknown output config type: '"+h.type+"'");return(d=t.u[f])||(d=new Te(t.h,t.G),t.u[f]=d),g(w,ke(d,p,t.I),13);case 13:m=w.h,r[f]=m;case 7:h.transform&&r[f]&&(r[f]=h.transform(r[f])),w.g=3;break;case 14:y[b]=w.h;case 3:a=l.next(),w.g=2;break;case 4:return w.return(r)}}))}function Le(t,e){for(var n=e.name||"$",r=[].concat(a(e.wants)),s=new t.h.StringList,o=i(e.wants),u=o.next();!u.done;u=o.next())s.push_back(u.value);o=t.h.PacketListener.implement({onResults:function(s){for(var o={},i=0;i<e.wants.length;++i)o[r[i]]=s.get(i);var a=t.listeners[n];a&&(t.D=Fe(t,o,e.outs).then((function(n){n=a(n);for(var s=0;s<e.wants.length;++s){var i=o[r[s]];"object"==typeof i&&i.hasOwnProperty&&i.hasOwnProperty("delete")&&i.delete()}n&&(t.D=n)})))}}),t.i.attachMultiListener(s,o),s.delete()}function Pe(t){return void 0===t&&(t=0),1===t?"hand_landmark_full.tflite":"hand_landmark_lite.tflite"}function Be(t){var e=this;t=t||{},this.g=new Me({locateFile:t.locateFile,files:function(t){return[{url:"hands_solution_packed_assets_loader.js"},{simd:!1,url:"hands_solution_wasm_bin.js"},{simd:!0,url:"hands_solution_simd_wasm_bin.js"},{data:!0,url:Pe(t.modelComplexity)}]},graph:{url:"hands.binarypb"},inputs:{image:{type:"video",stream:"input_frames_gpu"}},listeners:[{wants:["multi_hand_landmarks","multi_hand_world_landmarks","image_transformed","multi_handedness"],outs:{image:"image_transformed",multiHandLandmarks:{type:"proto_list",stream:"multi_hand_landmarks",transform:_e},multiHandWorldLandmarks:{type:"proto_list",stream:"multi_hand_world_landmarks",transform:_e},multiHandedness:{type:"proto_list",stream:"multi_handedness",transform:function(t){return t.map((function(t){return Ee(te(t,pe,de))[0]}))}}}}],options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"object"==typeof window&&void 0!==window.navigator&&("iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document)},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},maxNumHands:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculator",fieldName:"int_value"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(t){var n,r,s;return N((function(o){return 1==o.g?(n=Pe(t),r="third_party/mediapipe/modules/hand_landmark/"+n,g(o,De(e.g,n),2)):(s=o.h,e.g.overrideFile(r,s),o.return(!0))}))}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"handlandmarktrackinggpu__palmdetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"handlandmarktrackinggpu__handlandmarkgpu__ThresholdingCalculator",fieldName:"threshold"}}}})}(t=Me.prototype).close=function(){return this.i&&this.i.delete(),Promise.resolve()},t.reset=function(){var t=this;return N((function(e){t.i&&(t.i.reset(),t.o={},t.u={}),e.g=0}))},t.setOptions=function(t,e){var n=this;if(e=e||this.g.options){for(var r=[],s=[],o={},a=i(Object.keys(t)),u=a.next();!u.done;o={R:o.R,S:o.S},u=a.next()){var c=u.value;c in this.j&&this.j[c]===t[c]||(this.j[c]=t[c],void 0!==(u=e[c])&&(u.onChange&&(o.R=u.onChange,o.S=t[c],r.push(function(t){return function(){return N((function(e){if(1==e.g)return g(e,t.R(t.S),2);!0===e.h&&(n.s=!0),e.g=0}))}}(o))),u.graphOptionXref&&(c={valueNumber:1===u.type?t[c]:0,valueBoolean:0===u.type&&t[c],valueString:2===u.type?t[c]:""},u=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),u.graphOptionXref),c),s.push(u))))}0===r.length&&0===s.length||(this.s=!0,this.B=(void 0===this.B?[]:this.B).concat(s),this.A=(void 0===this.A?[]:this.A).concat(r))}},t.initialize=function(){var t=this;return N((function(e){return 1==e.g?g(e,Re(t),2):3!=e.g?g(e,function(t){var e,n,r,s,o,a,u,c;return N((function(l){if(1==l.g)return t.g.graph&&t.g.graph.url&&t.Z===t.g.graph.url?l.return():(t.s=!0,t.g.graph&&t.g.graph.url?(t.Z=t.g.graph.url,g(l,De(t,t.g.graph.url),3)):void(l.g=2));for(2!=l.g&&(e=l.h,t.i.loadGraph(e)),n=i(Object.keys(t.C)),r=n.next();!r.done;r=n.next())s=r.value,t.i.overrideFile(s,t.C[s]);if(t.C={},t.g.listeners)for(o=i(t.g.listeners),a=o.next();!a.done;a=o.next())u=a.value,Le(t,u);c=t.j,t.j={},t.setOptions(c),l.g=0}))}(t),3):g(e,function(t){var e,n,r,s,o,a;return N((function(u){switch(u.g){case 1:if(!t.s)return u.return();if(!t.A){u.g=2;break}e=i(t.A),n=e.next();case 3:if(n.done){u.g=5;break}return g(u,(0,n.value)(),4);case 4:n=e.next(),u.g=3;break;case 5:t.A=void 0;case 2:if(t.B){for(r=new t.h.GraphOptionChangeRequestList,s=i(t.B),o=s.next();!o.done;o=s.next())a=o.value,r.push_back(a);t.i.changeOptions(r),r.delete(),t.B=void 0}t.s=!1,u.g=0}}))}(t),0)}))},t.overrideFile=function(t,e){this.i?this.i.overrideFile(t,e):this.C[t]=e},t.clearOverriddenFiles=function(){this.C={},this.i&&this.i.clearOverriddenFiles()},t.send=function(t,e){var n,r,s,o,a,u,c,l,f,h=this;return N((function(p){switch(p.g){case 1:return h.g.inputs?(n=1e3*(null==e?performance.now():e),g(p,h.D,2)):p.return();case 2:return g(p,h.initialize(),3);case 3:for(r=new h.h.PacketDataList,s=i(Object.keys(t)),o=s.next();!o.done;o=s.next())if(a=o.value,u=h.g.inputs[a]){t:{var d=t[a];switch(u.type){case"video":var m=h.o[u.stream];if(m||(m=new Te(h.h,h.G),h.o[u.stream]=m),0===m.l&&(m.l=m.h.createTexture()),"undefined"!=typeof HTMLVideoElement&&d instanceof HTMLVideoElement)var y=d.videoWidth,b=d.videoHeight;else"undefined"!=typeof HTMLImageElement&&d instanceof HTMLImageElement?(y=d.naturalWidth,b=d.naturalHeight):(y=d.width,b=d.height);b={glName:m.l,width:y,height:b},(y=m.g).canvas.width=b.width,y.canvas.height=b.height,y.activeTexture(y.TEXTURE0),m.h.bindTexture2d(m.l),y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,d),m.h.bindTexture2d(0),m=b;break t;case"detections":for((m=h.o[u.stream])||(m=new Ae(h.h),h.o[u.stream]=m),m.data||(m.data=new m.g.DetectionListData),m.data.reset(d.length),b=0;b<d.length;++b){y=d[b];var w=m.data,v=w.setBoundingBox,x=b,N=y.ea,$=new xe;if(gt($,1,N.ka),gt($,2,N.la),gt($,3,N.height),gt($,4,N.width),gt($,5,N.rotation),gt($,6,N.ia),N=ne($,Ne),v.call(w,x,N),y.Y)for(w=0;w<y.Y.length;++w){var E=!!($=y.Y[w]).visibility;x=(v=m.data).addNormalizedLandmark,N=b,$=Object.assign(Object.assign({},$),{visibility:E?$.visibility:0}),gt(E=new ye,1,$.x),gt(E,2,$.y),gt(E,3,$.z),$.visibility&&gt(E,4,$.visibility),$=ne(E,ge),x.call(v,N,$)}if(y.V)for(w=0;w<y.V.length;++w)x=(v=m.data).addClassification,N=b,$=y.V[w],gt(E=new fe,2,$.score),$.index&&gt(E,1,$.index),$.label&&gt(E,3,$.label),$.displayName&&gt(E,4,$.displayName),$=ne(E,he),x.call(v,N,$)}m=m.data;break t;default:m={}}}switch(c=m,l=u.stream,u.type){case"video":r.pushTexture2d(Object.assign(Object.assign({},c),{stream:l,timestamp:n}));break;case"detections":(f=c).stream=l,f.timestamp=n,r.pushDetectionList(f);break;default:throw Error("Unknown input config type: '"+u.type+"'")}}return h.i.send(r),g(p,h.D,4);case 4:r.delete(),p.g=0}}))},t.onResults=function(t,e){this.listeners[e||"$"]=t},S("Solution",Me),S("OptionType",{BOOL:0,NUMBER:1,ma:2,0:"BOOL",1:"NUMBER",2:"STRING"}),(t=Be.prototype).close=function(){return this.g.close(),Promise.resolve()},t.onResults=function(t){this.g.onResults(t)},t.initialize=function(){var t=this;return N((function(e){return g(e,t.g.initialize(),0)}))},t.reset=function(){this.g.reset()},t.send=function(t){var e=this;return N((function(n){return g(n,e.g.send(t),0)}))},t.setOptions=function(t){this.g.setOptions(t)},S("Hands",Be),S("HAND_CONNECTIONS",[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]]),S("VERSION","0.4.1646424915")}).call(void 0);var JQ=GQ(Object.freeze({__proto__:null})),YQ={};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Object.defineProperty(YQ,"q",{value:!0});var ZQ=WQ({__proto__:null,MEDIAPIPE_KEYPOINTS:YQ.MEDIAPIPE_KEYPOINTS=["wrist","thumb_cmc","thumb_mcp","thumb_ip","thumb_tip","index_finger_mcp","index_finger_pip","index_finger_dip","index_finger_tip","middle_finger_mcp","middle_finger_pip","middle_finger_dip","middle_finger_tip","ring_finger_mcp","ring_finger_pip","ring_finger_dip","ring_finger_tip","pinky_finger_mcp","pinky_finger_pip","pinky_finger_dip","pinky_finger_tip"],default:YQ},[YQ]),QQ={},t0={};Object.defineProperty(t0,"q",{value:!0}),t0.DEFAULT_MPHANDS_MODEL_CONFIG={runtime:"mediapipe",maxHands:2,modelType:"full"},t0.DEFAULT_MPHANDS_ESTIMATION_CONFIG={flipHorizontal:!1,staticImageMode:!1};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var e0=UQ&&UQ.tt||function(){return e0=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},e0.apply(this,arguments)};Object.defineProperty(QQ,"q",{value:!0});var n0=t0;QQ.validateModelConfig=function(t){if(null==t)return e0({},n0.DEFAULT_MPHANDS_MODEL_CONFIG);var e=e0({},t);return e.runtime="mediapipe",null==e.maxHands&&(e.maxHands=n0.DEFAULT_MPHANDS_MODEL_CONFIG.maxHands),null==e.modelType&&(e.modelType=n0.DEFAULT_MPHANDS_MODEL_CONFIG.modelType),e},QQ.validateEstimationConfig=function(t){if(null==t)return e0({},n0.DEFAULT_MPHANDS_ESTIMATION_CONFIG);var e=e0({},t);return null==e.flipHorizontal&&(e.flipHorizontal=n0.DEFAULT_MPHANDS_ESTIMATION_CONFIG.flipHorizontal),null==e.staticImageMode&&(e.staticImageMode=n0.DEFAULT_MPHANDS_ESTIMATION_CONFIG.staticImageMode),e};var r0=UQ&&UQ.tt||function(){return r0=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},r0.apply(this,arguments)},s0=UQ&&UQ.et||function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?s(t.value):new n((function(e){e(t.value)})).then(i,a)}u((r=r.apply(t,e||[])).next())}))},o0=UQ&&UQ.nt||function(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=i.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(KQ,"q",{value:!0});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var i0=JQ,a0=YQ,u0=QQ,c0=function(){function t(t){var e,n=this;if(this.width=0,this.height=0,this.selfieMode=!1,this.handsSolution=new i0.Hands({locateFile:function(e,n){return t.solutionPath?t.solutionPath.replace(/\/+$/,"")+"/"+e:n+"/"+e}}),"lite"===t.modelType)e=0;else e=1;this.handsSolution.setOptions({modelComplexity:e,selfieMode:this.selfieMode,maxNumHands:t.maxHands}),this.handsSolution.onResults((function(t){if(n.height=t.image.height,n.width=t.image.width,n.hands=[],null!==t.multiHandLandmarks)for(var e=t.multiHandedness,r=t.multiHandLandmarks,s=t.multiHandWorldLandmarks,o=0;o<e.length;o++)n.hands.push(r0({},n.translateOutput(r[o],s[o]),{score:e[o].score,handedness:e[o].label}))}))}return t.prototype.translateOutput=function(t,e){var n=this,r=t.map((function(t,e){return{x:t.x*n.width,y:t.y*n.height,score:t.visibility,name:a0.MEDIAPIPE_KEYPOINTS[e]}})),s=e.map((function(t,e){return{x:t.x,y:t.y,z:t.z,score:t.visibility,name:a0.MEDIAPIPE_KEYPOINTS[e]}}));return{keypoints:r,keypoints3D:s}},t.prototype.estimateHands=function(t,e){return s0(this,void 0,void 0,(function(){return o0(this,(function(n){switch(n.label){case 0:return e&&e.flipHorizontal&&e.flipHorizontal!==this.selfieMode&&(this.selfieMode=e.flipHorizontal,this.handsSolution.setOptions({selfieMode:this.selfieMode})),[4,this.handsSolution.send({image:t})];case 1:return n.sent(),[2,this.hands]}}))}))},t.prototype.dispose=function(){this.handsSolution.close()},t.prototype.reset=function(){this.handsSolution.reset(),this.width=0,this.height=0,this.hands=null,this.selfieMode=!1},t.prototype.initialize=function(){return this.handsSolution.initialize()},t}();KQ.load=function(t){return s0(this,void 0,void 0,(function(){var e,n;return o0(this,(function(r){switch(r.label){case 0:return e=u0.validateModelConfig(t),[4,(n=new c0(e)).initialize()];case 1:return r.sent(),[2,n]}}))}))};var l0={};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f0{refCount(t){return h0("refCount")}incRef(t){return h0("incRef")}timerAvailable(){return!0}time(t){return h0("time")}read(t){return h0("read")}readSync(t){return h0("readSync")}readToGPU(t,e){return h0("readToGPU")}numDataIds(){return h0("numDataIds")}disposeData(t,e){return h0("disposeData")}write(t,e,n){return h0("write")}move(t,e,n,r,s){return h0("move")}memory(){return h0("memory")}floatPrecision(){return h0("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return h0("dispose")}}function h0(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p0(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,m0(t,e,n)}function d0(t,e,n){return Math.max(t,Math.min(e,n))}function m0(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function y0(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function g0(t,e,n=""){y0(x0(t,e),(()=>n+` Shapes ${t} and ${e} must match`))}function b0(t){y0(null!=t,(()=>"The input to the tensor constructor must be a non-null value."))}function w0(t,e=[],n=!1){if(null==e&&(e=[]),Array.isArray(t)||C0(t)&&!n)for(let r=0;r<t.length;++r)w0(t[r],e,n);else e.push(t);return e}function v0(t){if(0===t.length)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function x0(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function N0(t){return t%1==0}function $0(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function E0(t,e){const n=e.length;return t=null==t?e.map(((t,e)=>e)):[].concat(t),y0(t.every((t=>t>=-n&&t<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`)),y0(t.every((t=>N0(t))),(()=>`All values in axis param must be integers but got axis ${t}`)),t.map((t=>t<0?n+t:t))}function S0(t,e){const n=[],r=[],s=null!=e&&Array.isArray(e)&&0===e.length,o=null==e||s?null:E0(e,t).sort();let i=0;for(let e=0;e<t.length;++e){if(null!=o){if(o[i]===e&&1!==t[e])throw new Error(`Can't squeeze axis ${e} since its dim '${t[e]}' is not 1`);(null==o[i]||o[i]>e)&&1===t[e]&&(n.push(t[e]),r.push(e)),o[i]<=e&&i++}1!==t[e]&&(n.push(t[e]),r.push(e))}return{newShape:n,keptDims:r}}function _0(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error(`Unknown data type ${t}`);n=new Uint8Array(e)}return n}function T0(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error(`Unknown data type ${t}`);n=new Array(e)}return n}function k0(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function A0(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function C0(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function O0(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error(`Unknown dtype ${t}`)}function I0(t){if(null==t)return 0;let e=0;return t.forEach((t=>e+=t.length)),e}function M0(t){return"string"==typeof t||t instanceof String}function R0(t){return"boolean"==typeof t}function D0(t){return"number"==typeof t}function F0(t){return Array.isArray(t)?F0(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":D0(t)?"float32":M0(t)?"string":R0(t)?"bool":"float32"}function L0(t){return!!(t&&t.constructor&&t.call&&t.apply)}function P0(t,e){for(let n=e;n<t;++n)if(t%n==0)return n;return t}function B0(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function V0(t,e,n,r=!1){const s=new Array;if(1===e.length){const o=e[0]*(r?2:1);for(let e=0;e<o;e++)s[e]=n[t+e]}else{const o=e[0],i=e.slice(1),a=i.reduce(((t,e)=>t*e))*(r?2:1);for(let e=0;e<o;e++)s[e]=V0(t+e*a,i,n,r)}return s}function z0(t,e,n=!1){if(0===t.length)return e[0];const r=t.reduce(((t,e)=>t*e))*(n?2:1);if(0===r)return[];if(r!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return V0(0,t,e,n)}function W0(t,e){const n=U0(t,e);for(let t=0;t<n.length;t++)n[t]=1;return n}function U0(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function j0(t){t.forEach((e=>{y0(Number.isInteger(e)&&e>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`))}))}function G0(t){return t&&t.then&&"function"==typeof t.then}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class q0{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=H0,this.populateURLFlags()}setPlatform(t,e){null!=this.platform&&(K0().getBool("IS_TEST")||K0().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=e}registerFlag(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){const e=this.urlFlags[t];K0().getBool("IS_TEST")||K0().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${e}.`),this.set(t,e)}}async getAsync(t){return t in this.flags||(this.flags[t]=await this.evaluateFlag(t)),this.flags[t]}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(G0(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(null==this.flagRegistry[t])throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(null==this.flagRegistry[t])throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const t=this.getQueryParams(this.global.location.search);if("tfjsflags"in t){t.tfjsflags.split(",").forEach((t=>{const[e,n]=t.split(":");this.urlFlags[e]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}(e,n)}))}}}function H0(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((t,...n)=>(function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")))),e}function K0(){return X0}let X0=null;function J0(){throw new Error("setTimeout has not been defined")}function Y0(){throw new Error("clearTimeout has not been defined")}var Z0=J0,Q0=Y0;function t1(t){if(Z0===setTimeout)return setTimeout(t,0);if((Z0===J0||!Z0)&&setTimeout)return Z0=setTimeout,setTimeout(t,0);try{return Z0(t,0)}catch(e){try{return Z0.call(null,t,0)}catch(e){return Z0.call(this,t,0)}}}"function"==typeof XQ.setTimeout&&(Z0=setTimeout),"function"==typeof XQ.clearTimeout&&(Q0=clearTimeout);var e1,n1=[],r1=!1,s1=-1;function o1(){r1&&e1&&(r1=!1,e1.length?n1=e1.concat(n1):s1=-1,n1.length&&i1())}function i1(){if(!r1){var t=t1(o1);r1=!0;for(var e=n1.length;e;){for(e1=n1,n1=[];++s1<e;)e1&&e1[s1].run();s1=-1,e=n1.length}e1=null,r1=!1,function(t){if(Q0===clearTimeout)return clearTimeout(t);if((Q0===Y0||!Q0)&&clearTimeout)return Q0=clearTimeout,clearTimeout(t);try{Q0(t)}catch(e){try{return Q0.call(null,t)}catch(e){return Q0.call(this,t)}}}(t)}}function a1(t,e){this.fun=t,this.array=e}a1.prototype.run=function(){this.fun.apply(null,this.array)};function u1(){}var c1=u1,l1=u1,f1=u1,h1=u1,p1=u1,d1=u1,m1=u1;var y1=XQ.performance||{},g1=y1.now||y1.mozNow||y1.msNow||y1.oNow||y1.webkitNow||function(){return(new Date).getTime()};var b1=new Date;var w1={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];n1.push(new a1(t,e)),1!==n1.length||r1||t1(i1)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:c1,addListener:l1,once:f1,off:h1,removeListener:p1,removeAllListeners:d1,emit:m1,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*g1.call(y1),n=Math.floor(e),r=Math.floor(e%1*1e9);return t&&(n-=t[0],(r-=t[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-b1)/1e3}},v1=w1;
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
let x1;function N1(){if(null==x1){let t;if("undefined"!=typeof window)t=window;else if(void 0!==XQ)t=XQ;else if(void 0!==v1)t=v1;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}x1=t}return x1}function $1(t,e){const n=function(){const t=N1();return null==t._tfGlobals&&(t._tfGlobals=new Map),t._tfGlobals}();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function E1(...t){K0().getBool("IS_TEST")||K0().getBool("PROD")||console.warn(...t)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const S1=$1("kernelRegistry",(()=>new Map)),_1=$1("gradRegistry",(()=>new Map));function T1(t,e){const n=O1(t,e);return S1.get(n)}function k1(t){return _1.get(t)}function A1(t){const e=S1.entries(),n=[];for(;;){const{done:r,value:s}=e.next();if(r)break;const[o,i]=s,[a]=o.split("_");a===t&&n.push(i)}return n}function C1(t){const{kernelName:e,backendName:n}=t,r=O1(e,n);S1.has(r)&&E1(`The kernel '${e}' for backend '${n}' is already registered`),S1.set(r,t)}function O1(t,e){return`${e}_${t}`}var I1=R1,M1=null;try{M1=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(Wot){}function R1(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function D1(t){return!0===(t&&t._)}R1.prototype._,Object.defineProperty(R1.prototype,"_",{value:!0}),R1.isLong=D1;var F1={},L1={};function P1(t,e){var n,r,s;return e?(s=0<=(t>>>=0)&&t<256)&&(r=L1[t])?r:(n=V1(t,(0|t)<0?-1:0,!0),s&&(L1[t]=n),n):(s=-128<=(t|=0)&&t<128)&&(r=F1[t])?r:(n=V1(t,t<0?-1:0,!1),s&&(F1[t]=n),n)}function B1(t,e){if(isNaN(t))return e?X1:K1;if(e){if(t<0)return X1;if(t>=G1)return t2}else{if(t<=-q1)return e2;if(t+1>=q1)return Q1}return t<0?B1(-t,e).neg():V1(t%j1|0,t/j1|0,e)}function V1(t,e,n){return new R1(t,e,n)}R1.fromInt=P1,R1.fromNumber=B1,R1.fromBits=V1;var z1=Math.pow;function W1(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return K1;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return W1(t.substring(1),e,n).neg();for(var s=B1(z1(n,8)),o=K1,i=0;i<t.length;i+=8){var a=Math.min(8,t.length-i),u=parseInt(t.substring(i,i+a),n);if(a<8){var c=B1(z1(n,a));o=o.mul(c).add(B1(u))}else o=(o=o.mul(s)).add(B1(u))}return o.unsigned=e,o}function U1(t,e){return"number"==typeof t?B1(t,e):"string"==typeof t?W1(t,e):V1(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}R1.fromString=W1,R1.fromValue=U1;var j1=4294967296,G1=j1*j1,q1=G1/2,H1=P1(1<<24),K1=P1(0);R1.ZERO=K1;var X1=P1(0,!0);R1.UZERO=X1;var J1=P1(1);R1.ONE=J1;var Y1=P1(1,!0);R1.UONE=Y1;var Z1=P1(-1);R1.NEG_ONE=Z1;var Q1=V1(-1,2147483647,!1);R1.MAX_VALUE=Q1;var t2=V1(-1,-1,!0);R1.MAX_UNSIGNED_VALUE=t2;var e2=V1(0,-2147483648,!1);R1.MIN_VALUE=e2;var n2=R1.prototype;n2.toInt=function(){return this.unsigned?this.low>>>0:this.low},n2.toNumber=function(){return this.unsigned?(this.high>>>0)*j1+(this.low>>>0):this.high*j1+(this.low>>>0)},n2.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(e2)){var e=B1(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var s=B1(z1(t,6),this.unsigned),o=this,i="";;){var a=o.div(s),u=(o.sub(a.mul(s)).toInt()>>>0).toString(t);if((o=a).isZero())return u+i;for(;u.length<6;)u="0"+u;i=""+u+i}},n2.getHighBits=function(){return this.high},n2.getHighBitsUnsigned=function(){return this.high>>>0},n2.getLowBits=function(){return this.low},n2.getLowBitsUnsigned=function(){return this.low>>>0},n2.getNumBitsAbs=function(){if(this.isNegative())return this.eq(e2)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},n2.isZero=function(){return 0===this.high&&0===this.low},n2.eqz=n2.isZero,n2.isNegative=function(){return!this.unsigned&&this.high<0},n2.isPositive=function(){return this.unsigned||this.high>=0},n2.isOdd=function(){return 1==(1&this.low)},n2.isEven=function(){return 0==(1&this.low)},n2.equals=function(t){return D1(t)||(t=U1(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},n2.eq=n2.equals,n2.notEquals=function(t){return!this.eq(t)},n2.neq=n2.notEquals,n2.ne=n2.notEquals,n2.lessThan=function(t){return this.comp(t)<0},n2.lt=n2.lessThan,n2.lessThanOrEqual=function(t){return this.comp(t)<=0},n2.lte=n2.lessThanOrEqual,n2.le=n2.lessThanOrEqual,n2.greaterThan=function(t){return this.comp(t)>0},n2.gt=n2.greaterThan,n2.greaterThanOrEqual=function(t){return this.comp(t)>=0},n2.gte=n2.greaterThanOrEqual,n2.ge=n2.greaterThanOrEqual,n2.compare=function(t){if(D1(t)||(t=U1(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},n2.comp=n2.compare,n2.negate=function(){return!this.unsigned&&this.eq(e2)?e2:this.not().add(J1)},n2.neg=n2.negate,n2.add=function(t){D1(t)||(t=U1(t));var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,o=t.high>>>16,i=65535&t.high,a=t.low>>>16,u=0,c=0,l=0,f=0;return l+=(f+=s+(65535&t.low))>>>16,c+=(l+=r+a)>>>16,u+=(c+=n+i)>>>16,u+=e+o,V1((l&=65535)<<16|(f&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},n2.subtract=function(t){return D1(t)||(t=U1(t)),this.add(t.neg())},n2.sub=n2.subtract,n2.multiply=function(t){if(this.isZero())return K1;if(D1(t)||(t=U1(t)),M1)return V1(M1.mul(this.low,this.high,t.low,t.high),M1.get_high(),this.unsigned);if(t.isZero())return K1;if(this.eq(e2))return t.isOdd()?e2:K1;if(t.eq(e2))return this.isOdd()?e2:K1;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(H1)&&t.lt(H1))return B1(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,o=t.high>>>16,i=65535&t.high,a=t.low>>>16,u=65535&t.low,c=0,l=0,f=0,h=0;return f+=(h+=s*u)>>>16,l+=(f+=r*u)>>>16,f&=65535,l+=(f+=s*a)>>>16,c+=(l+=n*u)>>>16,l&=65535,c+=(l+=r*a)>>>16,l&=65535,c+=(l+=s*i)>>>16,c+=e*u+n*a+r*i+s*o,V1((f&=65535)<<16|(h&=65535),(c&=65535)<<16|(l&=65535),this.unsigned)},n2.mul=n2.multiply,n2.divide=function(t){if(D1(t)||(t=U1(t)),t.isZero())throw Error("division by zero");var e,n,r;if(M1)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?V1((this.unsigned?M1.div_u:M1.div_s)(this.low,this.high,t.low,t.high),M1.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?X1:K1;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return X1;if(t.gt(this.shru(1)))return Y1;r=X1}else{if(this.eq(e2))return t.eq(J1)||t.eq(Z1)?e2:t.eq(e2)?J1:(e=this.shr(1).div(t).shl(1)).eq(K1)?t.isNegative()?J1:Z1:(n=this.sub(t.mul(e)),r=e.add(n.div(t)));if(t.eq(e2))return this.unsigned?X1:K1;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=K1}for(n=this;n.gte(t);){e=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(e)/Math.LN2),o=s<=48?1:z1(2,s-48),i=B1(e),a=i.mul(t);a.isNegative()||a.gt(n);)a=(i=B1(e-=o,this.unsigned)).mul(t);i.isZero()&&(i=J1),r=r.add(i),n=n.sub(a)}return r},n2.div=n2.divide,n2.modulo=function(t){return D1(t)||(t=U1(t)),M1?V1((this.unsigned?M1.rem_u:M1.rem_s)(this.low,this.high,t.low,t.high),M1.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},n2.mod=n2.modulo,n2.rem=n2.modulo,n2.not=function(){return V1(~this.low,~this.high,this.unsigned)},n2.and=function(t){return D1(t)||(t=U1(t)),V1(this.low&t.low,this.high&t.high,this.unsigned)},n2.or=function(t){return D1(t)||(t=U1(t)),V1(this.low|t.low,this.high|t.high,this.unsigned)},n2.xor=function(t){return D1(t)||(t=U1(t)),V1(this.low^t.low,this.high^t.high,this.unsigned)},n2.shiftLeft=function(t){return D1(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?V1(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):V1(0,this.low<<t-32,this.unsigned)},n2.shl=n2.shiftLeft,n2.shiftRight=function(t){return D1(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?V1(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):V1(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},n2.shr=n2.shiftRight,n2.shiftRightUnsigned=function(t){if(D1(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?V1(this.low>>>t|e<<32-t,e>>>t,this.unsigned):V1(32===t?e:e>>>t-32,0,this.unsigned)},n2.shru=n2.shiftRightUnsigned,n2.shr_u=n2.shiftRightUnsigned,n2.toSigned=function(){return this.unsigned?V1(this.low,this.high,!1):this},n2.toUnsigned=function(){return this.unsigned?this:V1(this.low,this.high,!0)},n2.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},n2.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},n2.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},R1.fromBytes=function(t,e,n){return n?R1.fromBytesLE(t,e):R1.fromBytesBE(t,e)},R1.fromBytesLE=function(t,e){return new R1(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},R1.fromBytesBE=function(t,e){return new R1(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const r2=I1||WQ({__proto__:null,default:I1},[I1]);function s2(t){return r2.fromString(t,!0,16)}const o2=s2("c3a5c85c97cb3127"),i2=s2("b492b66fbe98f273"),a2=s2("9ae16a3b2f90404f");function u2(t){return t.xor(t.shru(47))}function c2(t,e,n){const r=t.slice(e,e+n);return r2.fromBytes(Array.from(r),!0,!0)}function l2(t,e){return c2(t,e,8)}function f2(t,e){return c2(t,e,4)}function h2(t,e){return 0===e?t:t.shru(e).or(t.shl(64-e))}function p2(t,e,n=s2("9ddfea08eb382d69")){let r=t.xor(e).mul(n);r=r.xor(r.shru(47));let s=e.xor(r).mul(n);return s=s.xor(s.shru(47)),s=s.mul(n),s}function d2(t,e,n,r){return function(t,e,n,r,s,o){s=s.add(t),o=h2(o.add(s).add(r),21);const i=s;return s=(s=s.add(e)).add(n),o=o.add(h2(s,44)),[s.add(r),o.add(i)]}(l2(t,e),l2(t,e+8),l2(t,e+16),l2(t,e+24),n,r)}function m2(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=w0(t)),K0().getBool("DEBUG")&&k0(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){const e=new Uint8Array(t.length);for(let n=0;n<e.length;++n)0!==Math.round(t[n])&&(e[n]=1);return e}throw new Error(`Unknown data type ${e}`)}function y2(){return K0().platform.now()}function g2(t,e="utf-8"){return e=e||"utf-8",K0().platform.encode(t,e)}function b2(t,e="utf-8"){return e=e||"utf-8",K0().platform.decode(t,e)}var w2=Object.freeze({__proto__:null,createScalarValue:
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){return"string"===e?g2(t):m2([t],e)},toTypedArray:m2,now:y2,fetch:function(t,e){return K0().platform.fetch(t,e)},encodeString:g2,decodeString:b2,shuffle:p0,shuffleCombo:function(t,e){if(t.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${e.length}`);let n=t.length,r=0;for(;n>0;)r=Math.random()*n|0,n--,m0(t,n,r),m0(e,n,r)},clamp:d0,nearestLargerEven:function(t){return t%2==0?t:t+1},swap:m0,sum:function(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e},randUniform:function(t,e){const n=Math.random();return e*n+(1-n)*t},distSquared:function(t,e){let n=0;for(let r=0;r<t.length;r++){const s=Number(t[r])-Number(e[r]);n+=s*s}return n},assert:y0,assertShapesMatch:g0,assertNonNull:b0,flatten:w0,sizeFromShape:v0,isScalarShape:function(t){return 0===t.length},arraysEqual:x0,isInt:N0,tanh:function(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{const e=Math.exp(2*t);return(e-1)/(e+1)}},sizeToSquarishShape:function(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]},createShuffledIndices:function(t){const e=new Uint32Array(t);for(let n=0;n<t;++n)e[n]=n;return p0(e),e},rightPad:$0,repeatedTry:function(t,e=(t=>0),n){return new Promise(((r,s)=>{let o=0;const i=()=>{if(t())return void r();o++;const a=e(o);null!=n&&o>=n?s():setTimeout(i,a)};i()}))},inferFromImplicitShape:function(t,e){let n=1,r=-1;for(let e=0;e<t.length;++e)if(t[e]>=0)n*=t[e];else if(-1===t[e]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${e}`);r=e}else if(t[e]<0)throw Error(`Shapes can not be < 0. Found ${t[e]} at dim ${e}`);if(-1===r){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(0===n)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const s=t.slice();return s[r]=e/n,s},parseAxisParam:E0,squeezeShape:S0,getTypedArrayFromDType:_0,getArrayFromDType:T0,checkConversionForErrors:k0,isValidDtype:A0,hasEncodingLoss:function(t,e){return"complex64"!==e&&(("float32"!==e||"complex64"===t)&&(("int32"!==e||"float32"===t||"complex64"===t)&&("bool"!==e||"bool"!==t)))},isTypedArray:C0,bytesPerElement:O0,bytesFromStringArray:I0,isString:M0,isBoolean:R0,isNumber:D0,inferDtype:F0,isFunction:L0,nearestDivisor:P0,computeStrides:B0,toNestedArray:z0,makeOnesTypedArray:W0,makeZerosTypedArray:U0,makeZerosNestedTypedArray:function(t,e){const n=t.reduce(((t,e)=>t*e),1);if(null==e||"float32"===e)return z0(t,new Float32Array(n));if("int32"===e)return z0(t,new Int32Array(n));if("bool"===e)return z0(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)},assertNonNegativeIntegerDimensions:j0,locToIndex:function(t,e,n){if(0===e)return 0;if(1===e)return t[0];let r=t[t.length-1];for(let e=0;e<t.length-1;++e)r+=n[e]*t[e];return r},indexToLoc:function(t,e,n){if(0===e)return[];if(1===e)return[t];const r=new Array(e);for(let e=0;e<r.length-1;++e)r[e]=Math.floor(t/n[e]),t-=r[e]*n[e];return r[r.length-1]=t,r},isPromise:G0,hexToLong:s2,fingerPrint64:function(t,e=t.length){const n=r2.fromNumber(81,!0);if(e<=32)return e<=16?function(t,e=t.length){if(e>=8){const n=a2.add(2*e),r=l2(t,0).add(a2),s=l2(t,e-8);return p2(h2(s,37).mul(n).add(r),h2(r,25).add(s).mul(n),n)}if(e>=4){const n=a2.add(2*e);return p2(f2(t,0).shl(3).add(e),f2(t,e-4),n)}if(e>0){const n=t[0]+(t[e>>1]<<8),r=e+(t[e-1]<<2);return u2(a2.mul(n).xor(o2.mul(r))).mul(a2)}return a2}(t,e):function(t,e=t.length){const n=a2.add(2*e),r=l2(t,0).mul(i2),s=l2(t,8),o=l2(t,e-8).mul(n),i=l2(t,e-16).mul(a2);return p2(h2(r.add(s),43).add(h2(o,30)).add(i),r.add(h2(s.add(a2),18)).add(o),n)}(t,e);if(e<=64)return function(t,e=t.length){const n=a2.add(2*e),r=l2(t,0).mul(a2),s=l2(t,8),o=l2(t,e-8).mul(n),i=l2(t,e-16).mul(a2),a=h2(r.add(s),43).add(h2(o,30)).add(i),u=p2(a,r.add(h2(s.add(a2),18)).add(o),n),c=l2(t,16).mul(n),l=l2(t,24),f=a.add(l2(t,e-32)).mul(n),h=u.add(l2(t,e-24)).mul(n);return p2(h2(c.add(l),43).add(h2(f,30)).add(h),c.add(h2(l.add(r),18)).add(f),n)}(t,e);let r=n,s=n.mul(i2).add(113),o=u2(s.mul(a2).add(113)).mul(a2),i=[r2.UZERO,r2.UZERO],a=[r2.UZERO,r2.UZERO];r=r.mul(a2).add(l2(t,0));let u=0;const c=64*(e-1>>6),l=c+(e-1&63)-63;do{r=h2(r.add(s).add(i[0]).add(l2(t,u+8)),37).mul(i2),s=h2(s.add(i[1]).add(l2(t,u+48)),42).mul(i2),r=r.xor(a[1]),s=s.add(i[0]).add(l2(t,u+40)),o=h2(o.add(a[0]),33).mul(i2),i=d2(t,u,i[1].mul(i2),r.add(a[0])),a=d2(t,u+32,o.add(a[1]),s.add(l2(t,u+16))),[o,r]=[r,o],u+=64}while(u!==c);const f=i2.add(o.and(255).shl(1));return u=l,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),r=h2(r.add(s).add(i[0]).add(l2(t,u+8)),37).mul(f),s=h2(s.add(i[1]).add(l2(t,u+48)),42).mul(f),r=r.xor(a[1].mul(9)),s=s.add(i[0].mul(9).add(l2(t,u+40))),o=h2(o.add(a[0]),33).mul(f),i=d2(t,u,i[1].mul(f),r.add(a[0])),a=d2(t,u+32,o.add(a[1]),s.add(l2(t,u+16))),[o,r]=[r,o],p2(p2(i[0],a[0],f).add(u2(s).mul(o2)).add(o),p2(i[1],a[1],f).add(r),f)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class v2{constructor(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new N2)}profileKernel(t,e,n){let r;const s=()=>{r=n()};let o;const i=y2();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(s);else{s();for(const t of r)t.dataSync();o=Promise.resolve({kernelMs:y2()-i})}if(K0().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let e=0;e<r.length;e++){const n=r[e];n.data().then((e=>{x2(e,n.dtype,t)}))}return{kernelName:t,outputs:r,inputs:e,timeMs:o.then((t=>t.kernelMs)),extraInfo:o.then((t=>null!=t.getExtraProfileInfo?t.getExtraProfileInfo():""))}}logKernelProfile(t){const{kernelName:e,outputs:n,timeMs:r,inputs:s,extraInfo:o}=t;n.forEach((t=>{Promise.all([t.data(),r,o]).then((n=>{this.logger.logKernelProfile(e,t,n[0],n[1],s,n[2])}))}))}}function x2(t,e,n){if("float32"!==e)return!1;for(let e=0;e<t.length;e++){const r=t[e];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class N2{logKernelProfile(t,e,n,r,s,o){const i="number"==typeof r?$0(`${r}ms`,9):r.error,a=$0(t,25),u=e.rank,c=e.size,l=$0(e.shape.toString(),14);let f="";for(const t in s){const n=s[t];if(null!=n){const r=n.shape||e.shape,s=r.length;f+=`${t}: ${s}D ${s>0?r:""} `}}console.log(`%c${a}\t%c${i}\t%c${u}D ${l}\t%c${c}\t%c${f}\t%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $2(t,e,n,r){const s=B0(e),o=function(t,e,n,r){const s=v0(e),o=r[r.length-1],i=new Array(o).fill(0),a=e.length,u="complex64"===n?T2(t):t;if(a>1)for(let t=0;t<s/o;t++){const e=t*o;for(let t=0;t<o;t++)i[t]=Math.max(i[t],E2(u[e+t],0,n).length)}return i}(t,e,n,s),i=e.length,a=_2(t,e,n,s,o),u=["Tensor"];return r&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${i}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(a.map((t=>"    "+t)).join("\n")),u.join("\n")}function E2(t,e,n){let r;return r=Array.isArray(t)?`${parseFloat(t[0].toFixed(7))} + ${parseFloat(t[1].toFixed(7))}j`:M0(t)?`'${t}'`:"bool"===n?S2(t):parseFloat(t.toFixed(7)).toString(),$0(r,e)}function S2(t){return 0===t?"false":"true"}function _2(t,e,n,r,s,o=!0){const i="complex64"===n?2:1,a=e[0],u=e.length;if(0===u){if("complex64"===n){return[E2(T2(t)[0],0,n)]}return"bool"===n?[S2(t[0])]:[t[0].toString()]}if(1===u){if(a>20){const e=3*i;let r=Array.from(t.slice(0,e)),o=Array.from(t.slice((a-3)*i,a*i));return"complex64"===n&&(r=T2(r),o=T2(o)),["["+r.map(((t,e)=>E2(t,s[e],n))).join(", ")+", ..., "+o.map(((t,e)=>E2(t,s[a-3+e],n))).join(", ")+"]"]}return["["+("complex64"===n?T2(t):Array.from(t)).map(((t,e)=>E2(t,s[e],n))).join(", ")+"]"]}const c=e.slice(1),l=r.slice(1),f=r[0]*i,h=[];if(a>20){for(let e=0;e<3;e++){const r=e*f,o=r+f;h.push(..._2(t.slice(r,o),c,n,l,s,!1))}h.push("...");for(let e=a-3;e<a;e++){const r=e*f,o=r+f;h.push(..._2(t.slice(r,o),c,n,l,s,e===a-1))}}else for(let e=0;e<a;e++){const r=e*f,o=r+f;h.push(..._2(t.slice(r,o),c,n,l,s,e===a-1))}const p=2===u?",":"";h[0]="["+h[0]+p;for(let t=1;t<h.length-1;t++)h[t]=" "+h[t]+p;let d=",\n";for(let t=2;t<u;t++)d+="\n";return h[h.length-1]=" "+h[h.length-1]+"]"+(o?"":d),h}function T2(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class k2{constructor(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=v0(t),null!=n){const t=n.length;y0(t===this.size,(()=>`Length of values '${t}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||T0(e,this.size),this.strides=B0(t)}set(t,...e){0===e.length&&(e=[0]),y0(e.length===this.rank,(()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`));const n=this.locToIndex(e);this.values[n]=t}get(...t){0===t.length&&(t=[0]);let e=0;for(const n of t){if(n<0||n>=this.shape[e]){const e=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(e)}e++}let n=t[t.length-1];for(let e=0;e<t.length-1;++e)n+=this.strides[e]*t[e];return this.values[n]}locToIndex(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];let e=t[t.length-1];for(let n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e}indexToLoc(t){if(0===this.rank)return[];if(1===this.rank)return[t];const e=new Array(this.shape.length);for(let n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return A2().makeTensor(this.values,this.shape,this.dtype)}}let A2=null,C2=null;class O2{constructor(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=v0(t),this.strides=B0(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return C2.buffer(this.shape,this.dtype,t)}bufferSync(){return C2.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return z0(this.shape,t,"complex64"===this.dtype)}arraySync(){return z0(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const t=A2().read(this.dataId);if("string"===this.dtype){const e=await t;try{return e.map((t=>b2(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),A2().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=A2().readSync(this.dataId);if("string"===this.dtype)try{return t.map((t=>b2(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await A2().read(this.dataId);return"string"===this.dtype?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(A2().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return C2.print(this,t)}clone(){return this.throwIfDisposed(),C2.clone(this)}toString(t=!1){return $2(this.dataSync(),this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),C2.cast(this,t)}variable(t=!0,e,n){return this.throwIfDisposed(),A2().makeVariable(this,t,e,n)}}Object.defineProperty(O2,Symbol.hasInstance,{value:t=>!!t&&null!=t.data&&null!=t.dataSync&&null!=t.throwIfDisposed}),$1("Tensor",(()=>O2));class I2 extends O2{constructor(t,e,n,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=e,this.name=n}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!x0(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);A2().disposeTensor(this),this.dataId=t.dataId,A2().incRef(this,null)}dispose(){A2().disposeVariable(this),this.isDisposedInternal=!0}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var M2,R2,D2,F2,L2;Object.defineProperty(I2,Symbol.hasInstance,{value:t=>t instanceof O2&&null!=t.assign&&t.assign instanceof Function}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(M2||(M2={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(R2||(R2={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(D2||(D2={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(F2||(F2={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(L2||(L2={}));const P2={float32:F2,int32:R2,bool:D2,complex64:L2};function B2(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return P2[t][e]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function V2(t,e){if(t.dtype===e.dtype)return[t,e];const n=B2(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function z2(t,e){y0(t.dtype===e.dtype,(()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`))}function W2(t){const e=[];return U2(t,e,new Set),e}function U2(t,e,n){if(null==t)return;if(t instanceof O2)return void e.push(t);if(r=t,!Array.isArray(r)&&"object"!=typeof r)return;var r;const s=t;for(const t in s){const r=s[t];n.has(r)||(n.add(r),U2(r,e,n))}}var j2=Object.freeze({__proto__:null,makeTypesMatch:V2,assertTypesMatch:z2,isTensorInList:function(t,e){return e.some((e=>e.id===t.id))},getTensorsInContainer:W2});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G2(t){return null!=t.kernelName}class q2{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((t=>t.name))))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class H2{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new q2}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;{const{asyncInit:e}=this.initializeBackend(t);if(e)return null}}return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,n=1){return t in this.registryFactory?(E1(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:n},!0)}async setBackend(t){if(null==this.registryFactory[t])throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,null==this.registry[t]){this.backendInstance=null;const{success:e,asyncInit:n}=this.initializeBackend(t);if(!(n?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new v2(this.backendInstance),!0}setupRegisteredKernels(){A1(this.backendName).forEach((t=>{null!=t.setupFunc&&t.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(t){A1(t).forEach((e=>{null!=e.disposeFunc&&e.disposeFunc(this.registry[t])}))}initializeBackend(t){const e=this.registryFactory[t];if(null==e)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const n=e.factory();if(!n||n instanceof f0||"function"!=typeof n.then)return this.registry[t]=n,{success:!0,asyncInit:!1};{const e=++this.pendingBackendInitId,r=n.then((n=>!(e<this.pendingBackendInitId)&&(this.registry[t]=n,this.pendingBackendInit=null,!0))).catch((n=>(e<this.pendingBackendInitId||(this.pendingBackendInit=null,E1(`Initialization of backend ${t} failed`),E1(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(e){return E1(`Initialization of backend ${t} failed`),E1(e.stack||e.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority))}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e],{success:r,asyncInit:s}=this.initializeBackend(n);if(s||r)return{name:n,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const n=this.state.tensorInfo.get(e),r=n.backend,s=this.readSync(e),o=r.refCount(e);r.disposeData(e,!0),n.backend=t,t.move(e,s,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let n,r=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=e(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(t,e,n){t();try{const t=n();return e(),t}catch(t){throw e(),t}}nextTensorId(){return H2.nextTensorId++}nextVariableId(){return H2.nextVariableId++}clone(t){const e=X2.runKernel("Identity",{x:t}),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(t=>({x:()=>{const e={x:t},n={dtype:"float32"};return X2.runKernel("Cast",e,n)}})),[],{}),e}runKernel(t,e,n){null==this.backendName&&this.backend;if(!(null!=T1(t,this.backendName)))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,n){const r=this.backend.numDataIds();let s=0;n.forEach((t=>{s+="complex64"===t.dtype?3:1}));const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=r-e-s-o;if(i>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${i} data ids) after running '${t}'`)}runKernelFunc(t){let e,n=[];const r=this.isTapeOn(),s=this.state.numBytes,o=this.state.numTensors;let i,a;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const u=G2(t)?t.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(G2(t)){const{kernelName:e,inputs:s,attrs:o}=t;null==this.backendName&&this.backend;const u=T1(e,this.backendName);y0(null!=u,(()=>`Cannot find registered kernel '${e}' for backend '${this.backendName}'`)),i=()=>{const t=this.backend.numDataIds();a=u.kernelFunc({inputs:s,attrs:o,backend:this.backend});const i=Array.isArray(a)?a:[a];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(e,t,i);const c=i.map((t=>null!=t.rank?t:this.makeTensorFromTensorInfo(t)));if(r){const t=this.getTensorsForGradient(e,s,c);n=this.saveTensorsForBackwardMode(t)}return c}}else{const{forwardFunc:e}=t,s=t=>{r&&(n=t.map((t=>this.keep(this.clone(t)))))};i=()=>{const t=this.backend.numDataIds();a=this.tidy((()=>e(this.backend,s)));const n=Array.isArray(a)?a:[a];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,t,n),n}}const{inputs:c,attrs:l}=t,f=G2(t)?null:t.backwardsFunc;let h;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(h=this.profiler.profileKernel(u,c,(()=>i())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(h),e=h.outputs):e=i()})),r&&this.addTapeNode(u,c,e,f,n,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map((t=>null!=c[t]?c[t].shape:null)),outputShapes:e.map((t=>t.shape)),kernelTimeMs:h.timeMs,extraInfo:h.extraInfo}),Array.isArray(a)?e:e[0]}saveTensorsForBackwardMode(t){const e=t.map((t=>this.keep(this.clone(t))));return e}getTensorsForGradient(t,e,n){const r=k1(t);if(null!=r){const t=r.inputsToSave||[],s=r.outputsToSave||[];let o;r.saveAllInputs?(y0(Array.isArray(e),(()=>"saveAllInputs is true, expected inputs to be an array.")),o=Object.keys(e).map((t=>e[t]))):o=t.map((t=>e[t]));const i=n.filter(((t,e)=>s[e]));return o.concat(i)}return[]}makeTensor(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let s=t;"string"===n&&M0(t[0])&&(s=t.map((t=>g2(t))));const o=r.write(s,e,n),i=new O2(e,n,o,this.nextTensorId());if(this.trackTensor(i,r),"string"===n){const t=this.state.tensorInfo.get(o),e=I0(s);this.state.numBytes+=e-t.bytes,t.bytes=e}return i}makeTensorFromDataId(t,e,n,r){const s={dataId:t,shape:e,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(s,r)}makeTensorFromTensorInfo(t,e){const{dataId:n,shape:r,dtype:s}=t,o=new O2(r,s,n,this.nextTensorId());return this.trackTensor(o,e),o}makeVariable(t,e=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.cast(r));const s=new I2(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[s.name])throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(t,e){this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*O0(t.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n})),t instanceof I2||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,"string"===t.dtype&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),"complex64"!==t.dtype&&"string"!==t.dtype){const e=t.size*O0(t.dtype);this.state.numBytes-=e}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((t=>t.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const t of this.state.activeProfile.kernels)t.kernelTimeMs=await t.kernelTimeMs,t.extraInfo=await t.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(t,e,n,r,s,o){const i={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:s},a=k1(t);null!=a&&(r=a.gradFunc),null!=r&&(i.gradient=t=>(t=t.map(((t,e)=>{if(null==t){const t=n[e],r=U0(t.size,t.dtype);return this.makeTensor(r,t.shape,t.dtype)}return t})),r(t.length>1?t:t[0],s,o))),this.state.activeTape.push(i)}keep(t){return t.kept=!0,t}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=W2(t),n=new Set(e.map((t=>t.id)));for(let t=0;t<this.state.activeScope.track.length;t++){const e=this.state.activeScope.track[t];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach((t=>{t.kept||t.scopeId!==r.id||this.track(t)}))}gradients(t,e,n,r=!1){if(y0(e.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const s=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",t)));y0(s instanceof O2,(()=>"The result y returned by f() must be a tensor."));const o=function(t,e,n){const r={},s={};for(let t=0;t<e.length;t++)r[e[t].id]=!0;for(let n=0;n<t.length;n++){const o=t[n],i=o.inputs;for(const t in i){const n=i[t];let a=!1;for(let t=0;t<e.length;t++)if(r[n.id]){o.outputs.forEach((t=>r[t.id]=!0)),a=!0,s[o.id]=!0;break}if(a)break}}const o={};o[n.id]=!0;const i={};for(let e=t.length-1;e>=0;e--){const n=t[e],r=n.inputs;for(let t=0;t<n.outputs.length;t++)if(o[n.outputs[t].id]){for(const t in r)o[r[t].id]=!0,i[n.id]=!0;break}}const a=[];for(let e=0;e<t.length;e++){const n=t[e];if(s[n.id]&&i[n.id]){const t={};for(const e in n.inputs){const s=n.inputs[e];r[s.id]&&(t[e]=s)}const e=Object.assign({},n);e.inputs=t,e.outputs=n.outputs,a.push(e)}}return a}(this.state.activeTape,e,s);if(!r&&0===o.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const t={};t[s.id]=null==n?function(t){const e=W0(v0(t),"float32");return X2.makeTensor(e,t,"float32")}(s.shape):n,function(t,e,n,r){for(let s=e.length-1;s>=0;s--){const o=e[s],i=[];if(o.outputs.forEach((e=>{const n=t[e.id];null!=n?i.push(n):i.push(null)})),null==o.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const e in o.inputs){if(!(e in a))throw new Error(`Cannot backprop through input ${e}. Available gradients found: ${Object.keys(a)}.`);const s=n((()=>a[e]()));if("float32"!==s.dtype)throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${e} must have 'float32' dtype, but has '${s.dtype}'`);const i=o.inputs[e];if(!x0(s.shape,i.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${e}' has shape '${s.shape}', which does not match the shape of the input '${i.shape}'`);if(null==t[i.id])t[i.id]=s;else{const e=t[i.id];t[i.id]=r(e,s),e.dispose()}}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,o,(t=>this.tidy(t)),J2);const r=e.map((e=>t[e.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((t=>{for(const e of t.saved)e.dispose()})),this.state.activeTape=null),{value:s,grads:r}}))}customGrad(t){return y0(L0(t),(()=>"The f passed in customGrad(f) must be a function.")),(...e)=>{let n;y0(e.every((t=>t instanceof O2)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};e.forEach(((t,e)=>{r[e]=t}));return this.runKernelFunc({forwardFunc:(r,s)=>(n=t(...e,s),y0(n.value instanceof O2,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),y0(L0(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(t,r)=>{const s=n.gradFunc(t,r),o=Array.isArray(s)?s:[s];y0(o.length===e.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),y0(o.every((t=>t instanceof O2)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const i={};return o.forEach(((t,e)=>{i[e]=()=>t})),i},inputs:r})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)}async time(t){const e=y2(),n=await this.backend.time(t);return n.wallMs=y2()-e,n}track(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new q2;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function K2(){const t=N1();if(null==t._tfengine){const e=new q0(t);t._tfengine=new H2(e)}var e;return e=t._tfengine.ENV,X0=e,A2=()=>t._tfengine,t._tfengine}H2.nextTensorId=0,H2.nextVariableId=0;const X2=K2();function J2(t,e){const n={a:t,b:e};return X2.runKernel("Add",n)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Y2;function Z2(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Q2=Object.freeze({__proto__:null,mockIsMobile:function(t){Y2=t},isMobile:function(t){if(void 0!==Y2)return Y2;if(t||"undefined"!=typeof navigator&&null!=navigator){if(t||(t=navigator),"ReactNative"===t.product)return!0;const e=t.userAgent||t.vendor||("undefined"!=typeof window?window.opera:"");if(!e){const e=t;return e.userAgentData&&e.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1},isBrowser:Z2});const t3=K0();t3.registerFlag("DEBUG",(()=>!1),(t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),t3.registerFlag("IS_BROWSER",(()=>Z2())),t3.registerFlag("IS_NODE",(()=>void 0!==v1&&void 0!==v1.versions&&void 0!==v1.versions.node)),t3.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),t3.registerFlag("PROD",(()=>!1)),t3.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>t3.getBool("DEBUG"))),t3.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),t3.registerFlag("IS_TEST",(()=>!1)),t3.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>!0)),t3.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),t3.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));var e3=[],n3=[],r3="undefined"!=typeof Uint8Array?Uint8Array:Array,s3=!1;function o3(){s3=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,n=t.length;e<n;++e)e3[e]=t[e],n3[t.charCodeAt(e)]=e;n3["-".charCodeAt(0)]=62,n3["_".charCodeAt(0)]=63}function i3(t,e,n){for(var r,s,o=[],i=e;i<n;i+=3)r=(t[i]<<16)+(t[i+1]<<8)+t[i+2],o.push(e3[(s=r)>>18&63]+e3[s>>12&63]+e3[s>>6&63]+e3[63&s]);return o.join("")}function a3(t){var e;s3||o3();for(var n=t.length,r=n%3,s="",o=[],i=16383,a=0,u=n-r;a<u;a+=i)o.push(i3(t,a,a+i>u?u:a+i));return 1===r?(e=t[n-1],s+=e3[e>>2],s+=e3[e<<4&63],s+="=="):2===r&&(e=(t[n-2]<<8)+t[n-1],s+=e3[e>>10],s+=e3[e>>4&63],s+=e3[e<<2&63],s+="="),o.push(s),o.join("")}function u3(t,e,n,r,s){var o,i,a=8*s-r-1,u=(1<<a)-1,c=u>>1,l=-7,f=n?s-1:0,h=n?-1:1,p=t[e+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+t[e+f],f+=h,l-=8);for(i=o&(1<<-l)-1,o>>=-l,l+=r;l>0;i=256*i+t[e+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return i?NaN:1/0*(p?-1:1);i+=Math.pow(2,r),o-=c}return(p?-1:1)*i*Math.pow(2,o-r)}function c3(t,e,n,r,s,o){var i,a,u,c=8*o-s-1,l=(1<<c)-1,f=l>>1,h=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,i=l):(i=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-i))<1&&(i--,u*=2),(e+=i+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(i++,u/=2),i+f>=l?(a=0,i=l):i+f>=1?(a=(e*u-1)*Math.pow(2,s),i+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,s),i=0));s>=8;t[n+p]=255&a,p+=d,a/=256,s-=8);for(i=i<<s|a,c+=s;c>0;t[n+p]=255&i,p+=d,i/=256,c-=8);t[n+p-d]|=128*m}var l3={}.toString,f3=Array.isArray||function(t){return"[object Array]"==l3.call(t)};function h3(){return d3.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function p3(t,e){if(h3()<e)throw new RangeError("Invalid typed array length");return d3.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=d3.prototype:(null===t&&(t=new d3(e)),t.length=e),t}function d3(t,e,n){if(!(d3.TYPED_ARRAY_SUPPORT||this instanceof d3))return new d3(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return g3(this,t)}return m3(this,t,e,n)}function m3(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);d3.TYPED_ARRAY_SUPPORT?(t=e).__proto__=d3.prototype:t=b3(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!d3.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|x3(e,n),s=(t=p3(t,r)).write(e,n);s!==r&&(t=t.slice(0,s));return t}(t,e,n):function(t,e){if(v3(e)){var n=0|w3(e.length);return 0===(t=p3(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?p3(t,0):b3(t,e);if("Buffer"===e.type&&f3(e.data))return b3(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function y3(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function g3(t,e){if(y3(e),t=p3(t,e<0?0:0|w3(e)),!d3.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function b3(t,e){var n=e.length<0?0:0|w3(e.length);t=p3(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function w3(t){if(t>=h3())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+h3().toString(16)+" bytes");return 0|t}function v3(t){return!(null==t||!t._isBuffer)}function x3(t,e){if(v3(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return H3(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return K3(t).length;default:if(r)return H3(t).length;e=(""+e).toLowerCase(),r=!0}}function N3(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return F3(this,e,n);case"utf8":case"utf-8":return M3(this,e,n);case"ascii":return R3(this,e,n);case"latin1":case"binary":return D3(this,e,n);case"base64":return I3(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L3(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function $3(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function E3(t,e,n,r,s){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=s?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(s)return-1;n=t.length-1}else if(n<0){if(!s)return-1;n=0}if("string"==typeof e&&(e=d3.from(e,r)),v3(e))return 0===e.length?-1:S3(t,e,n,r,s);if("number"==typeof e)return e&=255,d3.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):S3(t,[e],n,r,s);throw new TypeError("val must be string, number or Buffer")}function S3(t,e,n,r,s){var o,i=1,a=t.length,u=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;i=2,a/=2,u/=2,n/=2}function c(t,e){return 1===i?t[e]:t.readUInt16BE(e*i)}if(s){var l=-1;for(o=n;o<a;o++)if(c(t,o)===c(e,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*i}else-1!==l&&(o-=o-l),l=-1}else for(n+u>a&&(n=a-u),o=n;o>=0;o--){for(var f=!0,h=0;h<u;h++)if(c(t,o+h)!==c(e,h)){f=!1;break}if(f)return o}return-1}function _3(t,e,n,r){n=Number(n)||0;var s=t.length-n;r?(r=Number(r))>s&&(r=s):r=s;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var i=0;i<r;++i){var a=parseInt(e.substr(2*i,2),16);if(isNaN(a))return i;t[n+i]=a}return i}function T3(t,e,n,r){return X3(H3(e,t.length-n),t,n,r)}function k3(t,e,n,r){return X3(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function A3(t,e,n,r){return k3(t,e,n,r)}function C3(t,e,n,r){return X3(K3(e),t,n,r)}function O3(t,e,n,r){return X3(function(t,e){for(var n,r,s,o=[],i=0;i<t.length&&!((e-=2)<0);++i)r=(n=t.charCodeAt(i))>>8,s=n%256,o.push(s),o.push(r);return o}(e,t.length-n),t,n,r)}function I3(t,e,n){return 0===e&&n===t.length?a3(t):a3(t.slice(e,n))}function M3(t,e,n){n=Math.min(t.length,n);for(var r=[],s=e;s<n;){var o,i,a,u,c=t[s],l=null,f=c>239?4:c>223?3:c>191?2:1;if(s+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=t[s+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=t[s+1],i=t[s+2],128==(192&o)&&128==(192&i)&&(u=(15&c)<<12|(63&o)<<6|63&i)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=t[s+1],i=t[s+2],a=t[s+3],128==(192&o)&&128==(192&i)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&i)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),s+=f}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=4096));return n}(r)}d3.TYPED_ARRAY_SUPPORT=void 0===XQ.TYPED_ARRAY_SUPPORT||XQ.TYPED_ARRAY_SUPPORT,h3(),d3.poolSize=8192,d3._augment=function(t){return t.__proto__=d3.prototype,t},d3.from=function(t,e,n){return m3(null,t,e,n)},d3.TYPED_ARRAY_SUPPORT&&(d3.prototype.__proto__=Uint8Array.prototype,d3.__proto__=Uint8Array),d3.alloc=function(t,e,n){return function(t,e,n,r){return y3(e),e<=0?p3(t,e):void 0!==n?"string"==typeof r?p3(t,e).fill(n,r):p3(t,e).fill(n):p3(t,e)}(null,t,e,n)},d3.allocUnsafe=function(t){return g3(null,t)},d3.allocUnsafeSlow=function(t){return g3(null,t)},d3.isBuffer=function(t){return null!=t&&(!!t._isBuffer||J3(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&J3(t.slice(0,0))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t))},d3.compare=function(t,e){if(!v3(t)||!v3(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,s=0,o=Math.min(n,r);s<o;++s)if(t[s]!==e[s]){n=t[s],r=e[s];break}return n<r?-1:r<n?1:0},d3.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d3.concat=function(t,e){if(!f3(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return d3.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=d3.allocUnsafe(e),s=0;for(n=0;n<t.length;++n){var o=t[n];if(!v3(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,s),s+=o.length}return r},d3.byteLength=x3,d3.prototype._isBuffer=!0,d3.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)$3(this,e,e+1);return this},d3.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)$3(this,e,e+3),$3(this,e+1,e+2);return this},d3.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)$3(this,e,e+7),$3(this,e+1,e+6),$3(this,e+2,e+5),$3(this,e+3,e+4);return this},d3.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?M3(this,0,t):N3.apply(this,arguments)},d3.prototype.equals=function(t){if(!v3(t))throw new TypeError("Argument must be a Buffer");return this===t||0===d3.compare(this,t)},d3.prototype.inspect=function(){var t="";return this.length>0&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(t+=" ... ")),"<Buffer "+t+">"},d3.prototype.compare=function(t,e,n,r,s){if(!v3(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===s&&(s=this.length),e<0||n>t.length||r<0||s>this.length)throw new RangeError("out of range index");if(r>=s&&e>=n)return 0;if(r>=s)return-1;if(e>=n)return 1;if(this===t)return 0;for(var o=(s>>>=0)-(r>>>=0),i=(n>>>=0)-(e>>>=0),a=Math.min(o,i),u=this.slice(r,s),c=t.slice(e,n),l=0;l<a;++l)if(u[l]!==c[l]){o=u[l],i=c[l];break}return o<i?-1:i<o?1:0},d3.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},d3.prototype.indexOf=function(t,e,n){return E3(this,t,e,n,!0)},d3.prototype.lastIndexOf=function(t,e,n){return E3(this,t,e,n,!1)},d3.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var s=this.length-e;if((void 0===n||n>s)&&(n=s),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return _3(this,t,e,n);case"utf8":case"utf-8":return T3(this,t,e,n);case"ascii":return k3(this,t,e,n);case"latin1":case"binary":return A3(this,t,e,n);case"base64":return C3(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O3(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},d3.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function R3(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(127&t[s]);return r}function D3(t,e,n){var r="";n=Math.min(t.length,n);for(var s=e;s<n;++s)r+=String.fromCharCode(t[s]);return r}function F3(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var s="",o=e;o<n;++o)s+=q3(t[o]);return s}function L3(t,e,n){for(var r=t.slice(e,n),s="",o=0;o<r.length;o+=2)s+=String.fromCharCode(r[o]+256*r[o+1]);return s}function P3(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function B3(t,e,n,r,s,o){if(!v3(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function V3(t,e,n,r){e<0&&(e=65535+e+1);for(var s=0,o=Math.min(t.length-n,2);s<o;++s)t[n+s]=(e&255<<8*(r?s:1-s))>>>8*(r?s:1-s)}function z3(t,e,n,r){e<0&&(e=4294967295+e+1);for(var s=0,o=Math.min(t.length-n,4);s<o;++s)t[n+s]=e>>>8*(r?s:3-s)&255}function W3(t,e,n,r,s,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function U3(t,e,n,r,s){return s||W3(t,0,n,4),c3(t,e,n,r,23,4),n+4}function j3(t,e,n,r,s){return s||W3(t,0,n,8),c3(t,e,n,r,52,8),n+8}d3.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),d3.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=d3.prototype;else{var s=e-t;n=new d3(s,void 0);for(var o=0;o<s;++o)n[o]=this[o+t]}return n},d3.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||P3(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r},d3.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||P3(t,e,this.length);for(var r=this[t+--e],s=1;e>0&&(s*=256);)r+=this[t+--e]*s;return r},d3.prototype.readUInt8=function(t,e){return e||P3(t,1,this.length),this[t]},d3.prototype.readUInt16LE=function(t,e){return e||P3(t,2,this.length),this[t]|this[t+1]<<8},d3.prototype.readUInt16BE=function(t,e){return e||P3(t,2,this.length),this[t]<<8|this[t+1]},d3.prototype.readUInt32LE=function(t,e){return e||P3(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},d3.prototype.readUInt32BE=function(t,e){return e||P3(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},d3.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||P3(t,e,this.length);for(var r=this[t],s=1,o=0;++o<e&&(s*=256);)r+=this[t+o]*s;return r>=(s*=128)&&(r-=Math.pow(2,8*e)),r},d3.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||P3(t,e,this.length);for(var r=e,s=1,o=this[t+--r];r>0&&(s*=256);)o+=this[t+--r]*s;return o>=(s*=128)&&(o-=Math.pow(2,8*e)),o},d3.prototype.readInt8=function(t,e){return e||P3(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},d3.prototype.readInt16LE=function(t,e){e||P3(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},d3.prototype.readInt16BE=function(t,e){e||P3(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},d3.prototype.readInt32LE=function(t,e){return e||P3(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},d3.prototype.readInt32BE=function(t,e){return e||P3(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},d3.prototype.readFloatLE=function(t,e){return e||P3(t,4,this.length),u3(this,t,!0,23,4)},d3.prototype.readFloatBE=function(t,e){return e||P3(t,4,this.length),u3(this,t,!1,23,4)},d3.prototype.readDoubleLE=function(t,e){return e||P3(t,8,this.length),u3(this,t,!0,52,8)},d3.prototype.readDoubleBE=function(t,e){return e||P3(t,8,this.length),u3(this,t,!1,52,8)},d3.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||B3(this,t,e,n,Math.pow(2,8*n)-1,0);var s=1,o=0;for(this[e]=255&t;++o<n&&(s*=256);)this[e+o]=t/s&255;return e+n},d3.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||B3(this,t,e,n,Math.pow(2,8*n)-1,0);var s=n-1,o=1;for(this[e+s]=255&t;--s>=0&&(o*=256);)this[e+s]=t/o&255;return e+n},d3.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||B3(this,t,e,1,255,0),d3.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},d3.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||B3(this,t,e,2,65535,0),d3.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):V3(this,t,e,!0),e+2},d3.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||B3(this,t,e,2,65535,0),d3.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):V3(this,t,e,!1),e+2},d3.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||B3(this,t,e,4,4294967295,0),d3.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):z3(this,t,e,!0),e+4},d3.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||B3(this,t,e,4,4294967295,0),d3.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):z3(this,t,e,!1),e+4},d3.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);B3(this,t,e,n,s-1,-s)}var o=0,i=1,a=0;for(this[e]=255&t;++o<n&&(i*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},d3.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var s=Math.pow(2,8*n-1);B3(this,t,e,n,s-1,-s)}var o=n-1,i=1,a=0;for(this[e+o]=255&t;--o>=0&&(i*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},d3.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||B3(this,t,e,1,127,-128),d3.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},d3.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||B3(this,t,e,2,32767,-32768),d3.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):V3(this,t,e,!0),e+2},d3.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||B3(this,t,e,2,32767,-32768),d3.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):V3(this,t,e,!1),e+2},d3.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||B3(this,t,e,4,2147483647,-2147483648),d3.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):z3(this,t,e,!0),e+4},d3.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||B3(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),d3.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):z3(this,t,e,!1),e+4},d3.prototype.writeFloatLE=function(t,e,n){return U3(this,t,e,!0,n)},d3.prototype.writeFloatBE=function(t,e,n){return U3(this,t,e,!1,n)},d3.prototype.writeDoubleLE=function(t,e,n){return j3(this,t,e,!0,n)},d3.prototype.writeDoubleBE=function(t,e,n){return j3(this,t,e,!1,n)},d3.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var s,o=r-n;if(this===t&&n<e&&e<r)for(s=o-1;s>=0;--s)t[s+e]=this[s+n];else if(o<1e3||!d3.TYPED_ARRAY_SUPPORT)for(s=0;s<o;++s)t[s+e]=this[s+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},d3.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var s=t.charCodeAt(0);s<256&&(t=s)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!d3.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var i=v3(t)?t:H3(new d3(t,r).toString()),a=i.length;for(o=0;o<n-e;++o)this[o+e]=i[o%a]}return this};var G3=/[^+\/0-9A-Za-z-_]/g;function q3(t){return t<16?"0"+t.toString(16):t.toString(16)}function H3(t,e){var n;e=e||1/0;for(var r=t.length,s=null,o=[],i=0;i<r;++i){if((n=t.charCodeAt(i))>55295&&n<57344){if(!s){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(i+1===r){(e-=3)>-1&&o.push(239,191,189);continue}s=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),s=n;continue}n=65536+(s-55296<<10|n-56320)}else s&&(e-=3)>-1&&o.push(239,191,189);if(s=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function K3(t){return function(t){var e,n,r,s,o,i;s3||o3();var a=t.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===t[a-2]?2:"="===t[a-1]?1:0,i=new r3(3*a/4-o),r=o>0?a-4:a;var u=0;for(e=0,n=0;e<r;e+=4,n+=3)s=n3[t.charCodeAt(e)]<<18|n3[t.charCodeAt(e+1)]<<12|n3[t.charCodeAt(e+2)]<<6|n3[t.charCodeAt(e+3)],i[u++]=s>>16&255,i[u++]=s>>8&255,i[u++]=255&s;return 2===o?(s=n3[t.charCodeAt(e)]<<2|n3[t.charCodeAt(e+1)]>>4,i[u++]=255&s):1===o&&(s=n3[t.charCodeAt(e)]<<10|n3[t.charCodeAt(e+1)]<<4|n3[t.charCodeAt(e+2)]>>2,i[u++]=s>>8&255,i[u++]=255&s),i}(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(G3,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function X3(t,e,n,r){for(var s=0;s<r&&!(s+n>=e.length||s>=t.length);++s)e[s+n]=t[s];return s}function J3(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function Y3(t,e){let n=t;if(C0(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||C0(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&K0().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Z3(t,r,[]),r}function Z3(t,e,n){if(n=n||[],!Array.isArray(t)&&!C0(t))return void y0(0===e.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`));y0(e.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`)),y0(t.length===e[0],(()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`));const r=e.slice(1);for(let e=0;e<t.length;++e)Z3(t[e],r,n.concat(e))}function Q3(t,e,n,r){if("string_or_numeric"!==t){if(null==t)throw new Error("Expected dtype cannot be null.");if("numeric"!==t&&t!==e||"numeric"===t&&"string"===e)throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}}function t4(t,e,n,r="numeric"){if(t instanceof O2)return Q3(r,t.dtype,e,n),t;let s=F0(t);if("string"!==s&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),Q3(r,s,e,n),null==t||!C0(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){const r=null==t?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const o=Y3(t,s);C0(t)||Array.isArray(t)||(t=[t]);const i="string"!==s?m2(t,s):w0(t,[],!0);return X2.makeTensor(i,o,s)}function e4(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map(((t,s)=>t4(t,`${e}[${s}]`,n,r)))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n4(t){const e=Object.keys(t);if(1!==e.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const s=(...t)=>{X2.startScope(n);try{const e=r(...t);return G0(e)&&console.error("Cannot return a Promise inside of tidy."),X2.endScope(e),e}catch(t){throw X2.endScope(null),t}};return Object.defineProperty(s,"name",{value:n,configurable:!0}),s}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r4=n4({complex_:function(t,e){const n=t4(t,"real","complex"),r=t4(e,"imag","complex");g0(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const s={real:n,imag:r};return X2.runKernel("Complex",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s4(t,e,n,r){if(null==r&&(r=F0(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!C0(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){j0(e);const t=v0(e),r=v0(n);y0(t===r,(()=>`Based on the provided shape, [${e}], the tensor should have ${t} values but has ${r}`));for(let t=0;t<n.length;++t){const r=n[t],s=t!==n.length-1||r!==v0(e.slice(t));y0(n[t]===e[t]||!s,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `))}}return C0(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?m2(t,r):w0(t,[],!0),X2.makeTensor(t,e,r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o4(t,e,n){return s4(t,e,Y3(t,n),n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i4={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};function a4(t,e){const n={};let r,s=0;for(const o of e){const e=o.name,i=o.dtype,a=o.shape,u=v0(a);let c;if("quantization"in o){const n=o.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error(`Weight ${o.name} with quantization ${n.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==n.dtype)throw new Error(`Weight ${o.name} has unknown quantization dtype ${n.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==i)throw new Error(`Weight ${o.name} is quantized with ${n.dtype} which only supports weights of type float32 not ${i}.`)}const a=i4[n.dtype],l=t.slice(s,s+u*a),f="uint8"===n.dtype?new Uint8Array(l):new Uint16Array(l);if("float32"===i)if("uint8"===n.dtype||"uint16"===n.dtype){c=new Float32Array(f.length);for(let t=0;t<f.length;t++){const e=f[t];c[t]=e*n.scale+n.min}}else{if("float16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type float32.`);void 0===r&&(r=y4()),c=r(f)}else{if("int32"!==i)throw new Error(`Unsupported dtype in weight '${e}': ${i}`);if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type int32.`);c=new Int32Array(f.length);for(let t=0;t<f.length;t++){const e=f[t];c[t]=Math.round(e*n.scale+n.min)}}s+=u*a}else if("string"===i){const e=v0(o.shape);c=[];for(let n=0;n<e;n++){const e=new Uint32Array(t.slice(s,s+4))[0];s+=4;const n=new Uint8Array(t.slice(s,s+e));c.push(n),s+=e}}else{const r=i4[i],o=t.slice(s,s+u*r);if("float32"===i)c=new Float32Array(o);else if("int32"===i)c=new Int32Array(o);else if("bool"===i)c=new Uint8Array(o);else{if("complex64"!==i)throw new Error(`Unsupported dtype in weight '${e}': ${i}`);{c=new Float32Array(o);const t=new Float32Array(c.length/2),r=new Float32Array(c.length/2);for(let e=0;e<t.length;e++)t[e]=c[2*e],r[e]=c[2*e+1];const s=o4(t,a,"float32"),i=o4(r,a,"float32");n[e]=r4(s,i),s.dispose(),i.dispose()}}s+=u*r}"complex64"!==i&&(n[e]=o4(c,a,i))}return n}function u4(t){if(null===t)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach((t=>{if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${t.constructor.name}`)}));const r=new Uint8Array(e);let s=0;return n.forEach((t=>{r.set(new Uint8Array(t.buffer),s),s+=t.byteLength})),r.buffer}const c4="undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa;function l4(t){return c4?d3.byteLength(t):new Blob([t]).size}function f4(t){if(1===t.length)return t[0];let e=0;t.forEach((t=>{e+=t.byteLength}));const n=new Uint8Array(e);let r=0;return t.forEach((t=>{n.set(new Uint8Array(t),r),r+=t.byteLength})),n.buffer}function h4(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);const e=t.split("/");return e[e.length-1]}function p4(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),n}async function d4(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),null!=t.weightsManifest){const[r,s]=await e(t.weightsManifest);n.weightSpecs=r,n.weightData=s}return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),n}function m4(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:l4(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:l4(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}function y4(){const t=function(){const t=t=>{let e=t<<13,n=0;for(;0==(8388608&e);)n-=8388608,e<<=1;return e&=-8388609,n+=947912704,e|n},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}(),e=function(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}(),n=function(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}();return r=>{const s=new ArrayBuffer(4*r.length),o=new Uint32Array(s);for(let s=0;s<r.length;s++){const i=r[s],a=t[n[i>>10]+(1023&i)]+e[i>>10];o[s]=a}return new Float32Array(s)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g4{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==g4.instance&&(g4.instance=new g4),g4.instance}static registerSaveRouter(t){g4.getInstance().saveRouters.push(t)}static registerLoadRouter(t){g4.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return g4.getHandlers(t,"save")}static getLoadHandlers(t,e){return g4.getHandlers(t,"load",e)}static getHandlers(t,e,n){const r=[];return("load"===e?g4.getInstance().loadRouters:g4.getInstance().saveRouters).forEach((e=>{const s=e(t,n);null!==s&&r.push(s)})),r}}const b4=t=>g4.getSaveHandlers(t),w4=(t,e)=>g4.getLoadHandlers(t,e)
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */;function v4(){if(!K0().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t="undefined"==typeof window?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function x4(t){const e=t.result;e.createObjectStore("models_store",{keyPath:"modelPath"}),e.createObjectStore("model_info_store",{keyPath:"modelPath"})}class N4{constructor(t){if(this.indexedDB=v4(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise(((t,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>x4(r),r.onsuccess=()=>{const s=r.result;if(null==e){const e=s.transaction("models_store","readonly"),r=e.objectStore("models_store").get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return s.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));t(r.result.modelArtifacts)},r.onerror=t=>(s.close(),n(r.error)),e.oncomplete=()=>s.close()}else{const r=m4(e),o=s.transaction("model_info_store","readwrite");let i=o.objectStore("model_info_store");const a=i.put({modelPath:this.modelPath,modelArtifactsInfo:r});let u;a.onsuccess=()=>{u=s.transaction("models_store","readwrite");const a=u.objectStore("models_store").put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:r});a.onsuccess=()=>t({modelArtifactsInfo:r}),a.onerror=t=>{i=o.objectStore("model_info_store");const e=i.delete(this.modelPath);e.onsuccess=()=>(s.close(),n(a.error)),e.onerror=t=>(s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}}},r.onerror=t=>n(r.error)}))}}N4.URL_SCHEME="indexeddb://";const $4=t=>{return K0().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(N4.URL_SCHEME)?(e=t.slice(N4.URL_SCHEME.length),new N4(e)):null;var e};g4.registerSaveRouter($4),g4.registerLoadRouter($4);class E4{constructor(){this.indexedDB=v4()}async listModels(){return new Promise(((t,e)=>{const n=this.indexedDB.open("tensorflowjs",1);n.onupgradeneeded=()=>x4(n),n.onsuccess=()=>{const r=n.result,s=r.transaction("model_info_store","readonly"),o=s.objectStore("model_info_store").getAll();o.onsuccess=()=>{const e={};for(const t of o.result)e[t.modelPath]=t.modelArtifactsInfo;t(e)},o.onerror=t=>(r.close(),e(o.error)),s.oncomplete=()=>r.close()},n.onerror=t=>e(n.error)}))}async removeModel(t){var e;return t=(e=t).startsWith(N4.URL_SCHEME)?e.slice(N4.URL_SCHEME.length):e,new Promise(((e,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>x4(r),r.onsuccess=()=>{const s=r.result,o=s.transaction("model_info_store","readwrite"),i=o.objectStore("model_info_store"),a=i.get(t);let u;a.onsuccess=()=>{if(null==a.result)return s.close(),n(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const r=i.delete(t),o=()=>{u=s.transaction("models_store","readwrite");const r=u.objectStore("models_store").delete(t);r.onsuccess=()=>e(a.result.modelArtifactsInfo),r.onerror=t=>n(a.error)};r.onsuccess=o,r.onerror=t=>(o(),s.close(),n(a.error))}},a.onerror=t=>(s.close(),n(a.error)),o.oncomplete=()=>{null==u?s.close():u.oncomplete=()=>s.close()}},r.onerror=t=>n(r.error)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S4="tensorflowjs_models",_4="info",T4="model_topology",k4="weight_specs",A4="weight_data",C4="model_metadata";function O4(t){return{info:[S4,t,_4].join("/"),topology:[S4,t,T4].join("/"),weightSpecs:[S4,t,k4].join("/"),weightData:[S4,t,A4].join("/"),modelMetadata:[S4,t,C4].join("/")}}function I4(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function M4(t){const e=t.split("/");if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join("/")}class R4{constructor(t){if(!K0().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=O4(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=m4(t);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(c4)return d3.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let t=0,r=e.length;t<r;t++)n+=String.fromCharCode(e[t]);return btoa(n)}(t.weightData));const s={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:r}}catch(t){throw I4(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(null==t)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=r;const s=this.LS.getItem(this.keys.modelMetadata);if(null!=s){const t=JSON.parse(s);e.format=t.format,e.generatedBy=t.generatedBy,e.convertedBy=t.convertedBy,null!=t.signature&&(e.signature=t.signature),null!=t.userDefinedMetadata&&(e.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(e.modelInitializer=t.modelInitializer),null!=t.trainingConfig&&(e.trainingConfig=t.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(null==o)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=function(t){if(c4){const e=d3.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;++t)n.set([e.charCodeAt(t)],t);return n.buffer}(o),e}}R4.URL_SCHEME="localstorage://";const D4=t=>{return K0().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(R4.URL_SCHEME)?(e=t.slice(R4.URL_SCHEME.length),new R4(e)):null;var e};g4.registerSaveRouter(D4),g4.registerLoadRouter(D4);class F4{constructor(){y0(K0().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),y0("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const t={},e=S4+"/",n="/"+_4;for(let r=0;r<this.LS.length;++r){const s=this.LS.key(r);if(s.startsWith(e)&&s.endsWith(n)){t[M4(s)]=JSON.parse(this.LS.getItem(s))}}return t}async removeModel(t){var e;const n=O4(t=(e=t).startsWith(R4.URL_SCHEME)?e.slice(R4.URL_SCHEME.length):e);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(n.info));return I4(n),r}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L4{constructor(){this.managers={}}static getInstance(){return null==L4.instance&&(L4.instance=new L4),L4.instance}static registerManager(t,e){y0(null!=t,(()=>"scheme must not be undefined or null.")),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),y0(t.length>0,(()=>"scheme must not be an empty string."));const n=L4.getInstance();y0(null==n.managers[t],(()=>`A model store manager is already registered for scheme '${t}'.`)),n.managers[t]=e}static getManager(t){const e=this.getInstance().managers[t];if(null==e)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}}function P4(t){if(-1===t.indexOf("://"))throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${L4.getSchemes().join(",")}`);return{scheme:t.split("://")[0],path:t.split("://")[1]}}async function B4(t,e,n=!1){y0(t!==e,(()=>`Old path and new path are the same: '${t}'`));const r=g4.getLoadHandlers(t);y0(r.length>0,(()=>`Copying failed because no load handler is found for source URL ${t}.`)),y0(r.length<2,(()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${t}.`));const s=r[0],o=g4.getSaveHandlers(e);y0(o.length>0,(()=>`Copying failed because no save handler is found for destination URL ${e}.`)),y0(o.length<2,(()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${e}.`));const i=o[0],a=P4(t).scheme,u=P4(t).path,c=a===P4(t).scheme,l=await s.load();n&&c&&await L4.getManager(a).removeModel(u);const f=await i.save(l);return n&&!c&&await L4.getManager(a).removeModel(u),f.modelArtifactsInfo}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class V4{fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}}if(K0().get("IS_BROWSER")){K0().setPlatform("browser",new V4);try{L4.registerManager(R4.URL_SCHEME,new F4)}catch(t){}try{L4.registerManager(N4.URL_SCHEME,new E4)}catch(t){}}const z4=()=>require("node-fetch");let W4;class U4{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return null!=K0().global.fetch?K0().global.fetch(t,e):(null==W4&&(W4=z4()),W4(t,e))}now(){const t=v1.hrtime();return 1e3*t[0]+t[1]/1e6}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)}}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function j4(t,e="float32",n){return e=e||"float32",j0(t),new k2(t,e,n)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */K0().get("IS_NODE")&&!K0().get("IS_BROWSER")&&K0().setPlatform("node",new U4);const G4=n4({cast_:function(t,e){const n=t4(t,"x","cast");if(!A0(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},s={dtype:e};return X2.runKernel("Cast",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q4=n4({clone_:function(t){const e={x:t4(t,"x","clone","string_or_numeric")};return X2.runKernel("Identity",e)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H4(t,e=!1){console.log(t.toString(e))}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */K2();!function(t){C2=t}({buffer:j4,cast:G4,clone:q4,print:H4});function K4(t){return new Promise((t=>setTimeout(t))).then(t)}class X4{constructor(t){if(!K0().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(X4.URL_SCHEME)&&(t=t.slice(X4.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}async save(t){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n=p4(t,[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]),r=window.URL.createObjectURL(new Blob([JSON.stringify(n)],{type:"application/json"})),s=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(s.download=this.modelJsonFileName,s.href=r,await K4((()=>s.dispatchEvent(new MouseEvent("click")))),null!=t.weightData){const t=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;t.download=this.weightDataFileName,t.href=e,await K4((()=>t.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:m4(t)}}}}X4.URL_SCHEME="downloads://";class J4{constructor(t){if(null==t||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.jsonFile=t[0],this.weightsFiles=t.slice(1)}async load(){return new Promise(((t,e)=>{const n=new FileReader;n.onload=n=>{const r=JSON.parse(n.target.result),s=r.modelTopology;if(null==s)return void e(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));if(null==r.weightsManifest)return void e(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));if(0===this.weightsFiles.length)return void t({modelTopology:s});const o=d4(r,(t=>this.loadWeights(t)));t(o)},n.onerror=t=>e(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),n.readAsText(this.jsonFile)}))}loadWeights(t){const e=[],n=[];for(const r of t)e.push(...r.weights),n.push(...r.paths);const r=this.checkManifestAndWeightFiles(t),s=n.map((t=>this.loadWeightsFile(t,r[t])));return Promise.all(s).then((t=>[e,f4(t)]))}loadWeightsFile(t,e){return new Promise(((n,r)=>{const s=new FileReader;s.onload=t=>{const e=t.target.result;n(e)},s.onerror=e=>r(`Failed to weights data from file of path '${t}'.`),s.readAsArrayBuffer(e)}))}checkManifestAndWeightFiles(t){const e=[],n=this.weightsFiles.map((t=>h4(t.name))),r={};for(const s of t)s.paths.forEach((t=>{const s=h4(t);if(-1!==e.indexOf(s))throw new Error(`Duplicate file basename found in weights manifest: '${s}'`);if(e.push(s),-1===n.indexOf(s))throw new Error(`Weight file with basename '${s}' is not provided.`);r[t]=this.weightsFiles[n.indexOf(s)]}));if(e.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${e.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Y4(t,e,n,r){!function(t){y0(null!=t&&Array.isArray(t)&&t.length>0,(()=>"promises must be a none empty array"))}(t),function(t,e){y0(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${t}`)),y0(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${e}`)),y0(e>=t,(()=>`startFraction must be no more than endFraction, but got startFraction ${t} and endFraction ${e}`))}(n=null==n?0:n,r=null==r?1:r);let s=0;return Promise.all(t.map((o=>(o.then((o=>{const i=n+ ++s/t.length*(r-n);return e(i),o})),o))))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Z4(t,e){null==e&&(e={});const n=null==e.fetchFunc?K0().platform.fetch:e.fetchFunc,r=t.map((t=>n(t,e.requestInit,{isBinary:!0}))),s=(null==e.onProgress?await Promise.all(r):await Y4(r,e.onProgress,0,.5)).map((t=>t.arrayBuffer()));return null==e.onProgress?await Promise.all(s):await Y4(s,e.onProgress,.5,1)}function Q4(t){return async(e,n="",r)=>{const s=e.map((()=>!1)),o={},i=null!=r?r.map((()=>!1)):[],a=[];if(e.forEach(((t,e)=>{let n=0;t.weights.forEach((t=>{const u="quantization"in t?t.quantization.dtype:t.dtype,c=i4[u]*v0(t.shape),l=()=>{s[e]=!0,null==o[e]&&(o[e]=[]),o[e].push({manifestEntry:t,groupOffset:n,sizeBytes:c})};null!=r?r.forEach(((e,n)=>{e===t.name&&(l(),i[n]=!0)})):l(),a.push(t.name),n+=c}))})),!i.every((t=>t))){const t=r.filter(((t,e)=>!i[e]));throw new Error(`Could not find weights in manifest with names: ${t.join(", ")}. \nManifest JSON has weights with names: ${a.join(", ")}.`)}const u=s.reduce(((t,e,n)=>(e&&t.push(n),t)),[]),c=[];u.forEach((t=>{e[t].paths.forEach((t=>{const e=n+(n.endsWith("/")?"":"/")+t;c.push(e)}))}));const l=await t(c),f={};let h=0;return u.forEach((t=>{const n=e[t].paths.length;let r=0;for(let t=0;t<n;t++)r+=l[h+t].byteLength;const s=new ArrayBuffer(r),i=new Uint8Array(s);let a=0;for(let t=0;t<n;t++){const e=new Uint8Array(l[h+t]);i.set(e,a),a+=e.byteLength}o[t].forEach((t=>{const e=a4(s.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(const t in e)f[t]=e[t]})),h+=n})),f}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */g4.registerSaveRouter((t=>K0().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(X4.URL_SCHEME)?function(t="model"){return new X4(t)}(t.slice(X4.URL_SCHEME.length)):null));class t6{constructor(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,this.weightUrlConverter=e.weightUrlConverter,null!=e.fetchFunc?(y0("function"==typeof e.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=e.fetchFunc):this.fetch=K0().platform.fetch,y0(null!=t&&t.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(t)&&y0(2===t.length,(()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`)),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData;const n=p4(t,[{paths:["./model.weights.bin"],weights:t.weightSpecs}]);e.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin");const r=await this.fetch(this.path,e);if(r.ok)return{modelArtifactsInfo:m4(t),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let e;try{e=await t.json()}catch(t){let e=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=e.modelTopology,r=e.weightsManifest;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return d4(e,(t=>this.loadWeights(t)))}async loadWeights(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),r=t.substring(0,e),s=n>e?t.substring(n):"";return[r+"/",s]}(e),s=this.weightPathPrefix||n,o=[];for(const e of t)o.push(...e.weights);const i=[],a=[];for(const e of t)for(const t of e.paths)null!=this.weightUrlConverter?a.push(this.weightUrlConverter(t)):i.push(s+t+r);this.weightUrlConverter&&i.push(...await Promise.all(a));return[o,f4(await Z4(i,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress}))]}}function e6(t){return null!=t.match(t6.URL_SCHEME_REGEX)}t6.URL_SCHEME_REGEX=/^https?:\/\//;const n6=(t,e)=>{if("undefined"==typeof fetch&&(null==e||null==e.fetchFunc))return null;{let n=!0;if(n=Array.isArray(t)?t.every((t=>e6(t))):e6(t),n)return r6(t,e)}return null};function r6(t,e){return new t6(t,e)}function s6(t,e){return r6(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */g4.registerSaveRouter(n6),g4.registerLoadRouter(n6);class o6{constructor(t){this.modelArtifacts=t}load(){return this.modelArtifacts}}class i6{constructor(t){this.saveHandler=t}save(t){return this.saveHandler(t)}}class a6{constructor(t){t.load&&(this.load=()=>Promise.resolve(t.load())),t.save&&(this.save=e=>Promise.resolve(t.save(e)))}}function u6(t,e,n,r){if(1===arguments.length){return null!=t.modelTopology||null!=t.weightSpecs?new o6(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new o6({modelTopology:t}))}return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new o6({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r})}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var c6=Object.freeze({__proto__:null,browserFiles:function(t){return new J4(t)},browserHTTPRequest:s6,concatenateArrayBuffers:f4,decodeWeights:a4,encodeWeights:async function(t,e){const n=[],r=[],s=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);for(let o=0;o<s.length;++o){const i=s[o],a=Array.isArray(t)?t[o].tensor:t[i];if("float32"!==a.dtype&&"int32"!==a.dtype&&"bool"!==a.dtype&&"string"!==a.dtype&&"complex64"!==a.dtype)throw new Error(`Unsupported dtype in weight '${i}': ${a.dtype}`);const u={name:i,shape:a.shape,dtype:a.dtype};if("string"===a.dtype){const t=new Promise((async t=>{const e=await a.bytes(),n=e.reduce(((t,e)=>t+e.length),0)+4*e.length,r=new Uint8Array(n);let s=0;for(let t=0;t<e.length;t++){const n=e[t],o=new Uint8Array(new Uint32Array([n.length]).buffer);r.set(o,s),s+=4,r.set(n,s),s+=n.length}t(r)}));r.push(t)}else r.push(a.data());null!=e&&(u.group=e),n.push(u)}return{data:u4(await Promise.all(r)),specs:n}},fromMemory:function(t,e,n,r){const s=arguments;return new a6(u6(...s))},fromMemorySync:u6,getLoadHandlers:w4,getModelArtifactsForJSON:d4,getModelArtifactsInfoForJSON:m4,getSaveHandlers:b4,http:r6,isHTTPScheme:e6,loadWeights:async function(t,e="",n,r){return Q4((t=>Z4(t,{requestInit:r})))(t,e,n)},registerLoadRouter:t=>g4.registerLoadRouter(t),registerSaveRouter:t=>g4.registerSaveRouter(t),weightsLoaderFactory:Q4,withSaveHandler:function(t){return new i6(t)},withSaveHandlerSync:function(t){return new i6(t)},copyModel:async function(t,e){return B4(t,e,!1)},listModels:async function(){const t=L4.getSchemes(),e={};for(const n of t){const t=await L4.getManager(n).listModels();for(const r in t){e[n+"://"+r]=t[r]}}return e},moveModel:async function(t,e){return B4(t,e,!0)},removeModel:async function(t){const e=P4(t);return L4.getManager(e.scheme).removeModel(e.path)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l6=n4({matMul_:function(t,e,n=!1,r=!1){let s=t4(t,"a","matMul"),o=t4(e,"b","matMul");[s,o]=V2(s,o);const i={a:s,b:o},a={transposeA:n,transposeB:r};return X2.runKernel("BatchMatMul",i,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f6=n4({oneHot_:function(t,e,n=1,r=0){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const s={indices:t4(t,"indices","oneHot","int32")},o={depth:e,onValue:n,offValue:r};return X2.runKernel("OneHot",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h6(t,e){return X2.tidy(t,e)}function p6(t){W2(t).forEach((t=>t.dispose()))}function d6(t){return X2.keep(t)}const m6=n4({imag_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){const e={input:t4(t,"input","imag")};return X2.runKernel("Imag",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y6=n4({neg_:function(t){const e={x:t4(t,"x","neg")};return X2.runKernel("Neg",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g6=n4({real_:function(t){const e={input:t4(t,"input","real")};return X2.runKernel("Real",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b6=n4({transpose_:function(t,e,n){const r=t4(t,"x","transpose");if(null==e&&(e=r.shape.map(((t,e)=>e)).reverse()),y0(r.rank===e.length,(()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`)),e.forEach((t=>{y0(t>=0&&t<r.rank,(()=>"All entries in 'perm' must be between 0 and "+(r.rank-1)+` but got ${e}`))})),r.rank<=1)return r.clone();const s={x:r},o={perm:e};return"complex64"===r.dtype?h6((()=>{let t=g6(r),e=m6(r);return t=X2.runKernel("Transpose",{x:t},o),e=X2.runKernel("Transpose",{x:e},o),n&&(e=y6(e)),r4(t,e)})):X2.runKernel("Transpose",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w6=n4({confusionMatrix_:function(t,e,n){const r=t4(t,"labels","confusionMatrix"),s=t4(e,"predictions","confusionMatrix");y0(null==n||n>0&&Number.isInteger(n),(()=>`If provided, numClasses must be a positive integer, but got ${n}`)),y0(1===r.rank,(()=>`Expected the rank of labels to be 1, but got ${r.rank}`)),y0(1===s.rank,(()=>`Expected the rank of predictions to be 1, but got ${s.rank}`)),y0(r.shape[0]===s.shape[0],(()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${s.shape[0]}. Labels and predictions should have the same number of elements.`)),y0(n>0&&Number.isInteger(n),(()=>`numClasses is required to be a positive integer, but got ${n}`));const o=f6(G4(r,"int32"),n),i=f6(G4(s,"int32"),n),a=b6(o),u=l6(a,i);return G4(u,"int32")}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var v6=Object.freeze({__proto__:null,confusionMatrix:w6});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x6(t,e){const n=t.length,r=[];for(let s=0;s<n;s++){const o=n-1-s,i=t[o]||1;(e[e.length-1-s]||1)>1&&1===i&&r.unshift(o)}return r}function N6(t,e){const n=[];for(let r=0;r<e.length;r++){const s=t[t.length-r-1],o=e.length-r-1,i=e[o];(null==s||1===s&&i>1)&&n.unshift(o)}return n}function $6(t,e){const n=[],r=Math.max(t.length,e.length);for(let s=0;s<r;s++){let r=t[t.length-s-1];null==r&&(r=1);let o=e[e.length-s-1];if(null==o&&(o=1),1===r)n.unshift(o);else if(1===o)n.unshift(r);else{if(r!==o){throw Error(`Operands could not be broadcast together with shapes ${t} and ${e}.`)}n.unshift(r)}}return n}var E6=Object.freeze({__proto__:null,getBroadcastDims:x6,getReductionAxes:N6,assertAndGetBroadcastShape:$6});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S6(t,e,n){if(b0(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");const r=Y3(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return s4(t,e,r,n)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let _6;function T6(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,s=!1,o=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)s=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)o=!0;else if(null!=t.getContext)i=!0;else{if(!("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);a=!0}if(s){const e=2;if(s&&t.readyState<e)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=T1("FromPixels",X2.backendName)){const n={pixels:t},r={numChannels:e};return X2.runKernel("FromPixels",n,r)}const[u,c]=s?[t.videoWidth,t.videoHeight]:[t.width,t.height];let l,f;if(i)l=t.getContext("2d").getImageData(0,0,u,c).data;else if(r||n)l=t.data;else if(o||s||a){if(null==_6)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");_6=new OffscreenCanvas(1,1).getContext("2d")}else _6=document.createElement("canvas").getContext("2d");_6.canvas.width=u,_6.canvas.height=c,_6.drawImage(t,0,0,u,c),l=_6.getImageData(0,0,u,c).data}if(4===e)f=new Int32Array(l);else{const t=u*c;f=new Int32Array(t*e);for(let n=0;n<t;n++)for(let t=0;t<e;++t)f[n*e+t]=l[4*n+t]}return S6(f,[c,u,e],"int32")}function k6(t){return"undefined"!=typeof window&&"undefined"!=typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(t instanceof ImageBitmap)&&function(t){return null!=t&&0!==t.width&&0!==t.height}(t)&&!function(t){return null!=t&&t.data instanceof Uint8Array}(t)}const A6=n4({fromPixels_:T6});var C6=Object.freeze({__proto__:null,fromPixelsAsync:async function(t,e=3){let n=null;if(K0().getBool("WRAP_TO_IMAGEBITMAP")&&k6(t)){let e;try{e=await createImageBitmap(t,{premultiplyAlpha:"none"})}catch(t){e=null}n=null!=e&&e.width===t.width&&e.height===t.height?e:t}else n=t;return T6(n,e)},toPixels:async function(t,e){let n=t4(t,"img","toPixels");if(!(t instanceof O2)){const t=n;n=G4(t,"int32"),t.dispose()}if(2!==n.rank&&3!==n.rank)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const[r,s]=n.shape.slice(0,2),o=2===n.rank?1:n.shape[2];if(o>4||2===o)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${o}`);if("float32"!==n.dtype&&"int32"!==n.dtype)throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`);const i=await n.data(),a="float32"===n.dtype?255:1,u=new Uint8ClampedArray(s*r*4);for(let t=0;t<r*s;++t){const e=[0,0,0,255];for(let r=0;r<o;r++){const s=i[t*o+r];if("float32"===n.dtype){if(s<0||s>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${s}.`)}else if("int32"===n.dtype&&(s<0||s>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${s}.`);1===o?(e[0]=s*a,e[1]=s*a,e[2]=s*a):e[r]=s*a}const r=4*t;u[r+0]=Math.round(e[0]),u[r+1]=Math.round(e[1]),u[r+2]=Math.round(e[2]),u[r+3]=Math.round(e[3])}if(null!=e){e.width=s,e.height=r;const t=e.getContext("2d"),n=new ImageData(u,s,r);t.putImageData(n,0,0)}return n!==t&&n.dispose(),u},fromPixels:A6});function O6(t,e){const n=t.shape.length,r=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==e.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${n}`);if(0===v0(t.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const s=e.shape,o=s[s.length-1];let i=1;for(let t=0;t<s.length-1;++t)i*=s[t];const a=t.shape,u=s.slice();u.pop();let c=1;for(let t=o;t<n;++t)c*=a[t],u.push(a[t]);const l=[...B0(t.shape).map((t=>t/c)),1].slice(0,o);return[u,i,c,l]}var I6=Object.freeze({__proto__:null,prepareAndValidate:O6});function M6(t,e,n){const r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${s}.`;if(n.rank<s)throw new Error(o+` update.rank < ${s}. `);if(t.length<r+(n.rank-s))throw new Error(o+` Output shape length < ${r+(n.rank-s)}`);if(n.rank!==s+t.length-r)throw new Error(o+" update.rank != "+(s+t.length-r));for(let t=0;t<s;++t)if(n.shape[t]!==e.shape[t])throw new Error(o+` updates.shape[${t}] (${n.shape[t]}) != indices.shape[${t}] (${e.shape[t]}).`);for(let e=0;e<n.rank-s;++e)if(n.shape[e+s]!==t[e+r])throw new Error(o+` updates.shape[${e+s}] (${n.shape[e+s]}) != shape[${e+s}] (${t[e+s]})`)}function R6(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if("int32"!==e.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===e.size)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(0===t.size)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}M6(n,e,t)}function D6(t,e,n){const r=e.shape.length,s=r>1?e.shape[r-1]:1,o=n.length;let i=1;for(let t=s;t<o;++t)i*=n[t];const a=s<1?1:s;return{sliceRank:s,numUpdates:v0(e.shape)/a,sliceSize:i,strides:[...B0(n.slice(0,s)),1],outputSize:v0(n)}}var F6=Object.freeze({__proto__:null,validateUpdateShape:M6,validateInput:R6,calculateShapes:D6});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L6(t,e,n,r){const s=[...t];for(let t=s.length;t<r.length;t++)s.push(1);for(let t=0;t<n;t++)0===t?s[e]=1:(s.splice(e,0,1),s.pop());return s}function P6(t,e,n){return n<=t?n:n-(e-1)}function B6(t,e){const n=[];for(let r=0;r<t;r++)n.push(e+r);return n}function V6(t,e,n,r,s){const o=[...s],i=B6(n,e);for(let s=0;s<o.length;s++)if(i.indexOf(s)>-1)o[s]=0;else{const i=P6(e,n,s);let a=r[i];t&1<<i&&(a=0),o[s]=a}return o}function z6(t,e,n,r,s){const o=[...s],i=B6(n,e);for(let s=0;s<o.length;s++)if(i.indexOf(s)>-1)o[s]=Number.MAX_SAFE_INTEGER;else{const i=P6(e,n,s);let a=r[i];t&1<<i&&(a=Number.MAX_SAFE_INTEGER),o[s]=a}for(let t=0;t<o.length;t++){const e=s[t];o[t]<0&&(o[t]+=e),o[t]=d0(0,o[t],s[t])}return o}function W6(t,e,n){let r=t[e];return(n&1<<e||null==r)&&(r=1),r}function U6(t,e,n,r,s,o){let i=e[s];const a=n[s]||1;(t&1<<s||o&1<<s||null==i)&&(i=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const u=r[s];return i<0&&(i+=u),i=d0(0,i,u-1),i}function j6(t,e,n,r,s,o){let i=e[s];const a=n[s]||1;(t&1<<s||o&1<<s||null==i)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const u=r[s];return i<0&&(i+=u),i=a>0?d0(0,i,u):d0(-1,i,u-1),i}function G6(t,e,n,r,s,o){if(s[e])return n>0?o[e]:o[e+1&1];{const e=t<0?r+t:t;return e<o[0]?o[0]:e>o[1]?o[1]:e}}var q6=Object.freeze({__proto__:null,assertParamsValid:function(t,e,n){const r=t.shape.length;y0(r===e.length,(()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`)),y0(r===n.length,(()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`));for(let s=0;s<r;++s)y0(e[s]+n[s]<=t.shape[s],(()=>`Error in slice${r}D: begin[${s}] + size[${s}] (${e[s]+n[s]}) would overflow input.shape[${s}] (${t.shape[s]})`))},maskToAxes:function(t){const e=[];let n=0;for(;t>0;)1&t&&e.push(n),t/=2,n++;return e},computeOutShape:function(t,e,n){const r=[];for(let s=0;s<t.length;s++)r[s]=Math.ceil((e[s]-t[s])/n[s]);return r},stridesWithElidedDims:L6,getNormalizedAxes:function(t,e,n,r,s,o,i,a,u){const c=t.length;let l=new Array(c),f=new Array(c),h=new Array(c);if(e.length&&n>0){const u=e[0],c=n+1;l=V6(i,u,c,r,t),f=z6(a,u,c,s,t),h=L6(o,u,c,t)}else for(let e=0;e<c;e++)l[e]=U6(i,r,o,t,e,u),f[e]=j6(a,s,o,t,e,u),h[e]=W6(o,e,u);return{begin:l,end:f,strides:h}},startIndicesWithElidedDims:V6,stopIndicesWithElidedDims:z6,stridesForAxis:W6,startForAxis:U6,stopForAxis:j6,isSliceContinous:function(t,e,n){let r=n.length;for(let t=0;t<n.length;t++)if(n[t]>1){r=t;break}for(let s=r+1;s<n.length;s++)if(e[s]>0||n[s]!==t[s])return!1;return!0},computeFlatOffset:function(t,e){let n=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)n+=t[r]*e[r];return n},parseSliceParams:function(t,e,n){let r;const s=t.shape.length;let o;return r="number"==typeof e?[e,...new Array(s-1).fill(0)]:e.length<s?e.concat(new Array(s-e.length).fill(0)):e.slice(),r.forEach((t=>{y0(-1!==t,(()=>"slice() does not support negative begin indexing."))})),o=null==n?new Array(s).fill(-1):"number"==typeof n?[n,...new Array(s-1).fill(-1)]:n.length<s?n.concat(new Array(s-n.length).fill(-1)):n,o=o.map(((e,n)=>e>=0?e:(y0(-1===e,(()=>`Negative size values should be exactly -1 but got ${e} for the slice() size at index ${n}.`)),t.shape[n]-r[n]))),[r,o]},sliceInfo:function(t,e,n,r,s,o,i,a,u){let c;if(null==r?(c=new Array(e.length),c.fill(1)):c=r,null!=i&&0!=(i&i-1))throw new Error("Multiple ellipses in slice is not allowed.");let l=!1;const f={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};for(let t=0;t<f.dims;t++)l&&0!=(1<<t&a)&&f.numAddAxisAfterEllipsis++,1<<t&i&&(l=!0);l||(f.ellipsisMask|=1<<f.dims,f.dims++);const h={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=null!=t.begin,e.endValid=null!=t.end,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<t.dims;r++)if(1<<r&t.ellipsisMask){const s=Math.min(e.dims-(t.dims-r)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<s;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&t.newAxisMask)e.finalShapeGatherIndices.push(-2),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);null!=t.begin&&(e.begin[n]=t.begin[r]),null!=t.end&&(e.end[n]=t.end[r]),e.strides[n]=t.strides[r],t.beginMask&1<<r&&(e.beginMask|=1<<n),t.endMask&1<<r&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(-1),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[n]=r,n++}}(f,h);let p=!0,d=!0,m=!0;const y=[],g=[];for(let e=0;e<t.length;++e){if(0===h.strides[e])throw Error(`strides[${e}] must be non-zero`);const n=!!(h.shrinkAxisMask&1<<e),r=t[e];if(-1===r){y.push(n?1:-1);continue}const s=[h.beginMask&1<<e,h.endMask&1<<e],o=[h.strides[e]>0?0:-1,h.strides[e]>0?r:r-1];if(n&&h.strides[e]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===h.strides[e];const i=!!(h.beginMask&1<<e&&h.endMask&1<<e);if(h.beginValid&&h.endValid){if(n){const t=h.begin[e]<0?r+h.begin[e]:h.begin[e];if(h.begin[e]=t,h.end[e]=h.begin[e]+1,t<0||t>=r)throw Error(`slice index ${h.begin[e]} of dimension ${e} out of bounds.`)}else h.begin[e]=G6(h.begin[e],0,h.strides[e],r,s,o),h.end[e]=G6(h.end[e],1,h.strides[e],r,s,o);const t=1===h.strides[e]&&0===h.begin[e]&&h.end[e]===r;p=p&&t,d=d&&(0===e&&1===h.strides[e]||t)}else p=p&&1===h.strides[e]&&i,d=d&&(0===e&&1===h.strides[e]||i);let a,u=!1;if(h.beginValid&&h.endValid?(a=h.end[e]-h.begin[e],u=!0):n?(a=1,u=!0):i&&r>=0&&(a=h.strides[e]<0?-r:r,u=!0),u){let t;t=0===a||a<0!=h.strides[e]<0?0:Math.trunc(a/h.strides[e])+(a%h.strides[e]!=0?1:0),y.push(t)}else y.push(-1)}for(let t=0;t<h.finalShapeGatherIndices.length;++t){const e=h.finalShapeGatherIndices[t];e>=0?g.push(y[e]):-2===e&&g.push(1)}const b=g.filter(((t,e)=>-2!==h.finalShapeGatherIndices[e]));return{finalShapeSparse:b,finalShape:g,isIdentity:p,sliceDim0:d,isSimpleSlice:m,begin:h.begin,end:h.end,strides:h.strides}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class H6{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}class K6{constructor(){this.classNameMap={}}static getMap(){return null==K6.instance&&(K6.instance=new K6),K6.instance}static register(t){K6.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function X6(t){y0(null!=t.className,(()=>"Class being registered does not have the static className property defined.")),y0("string"==typeof t.className,(()=>"className is required to be a string, but got type "+typeof t.className)),y0(t.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),K6.register(t)}var J6=Object.freeze({__proto__:null,Serializable:H6,SerializationMap:K6,registerClass:X6});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y6(){return 32===X2.backend.floatPrecision()?.001:.1}function Z6(t,e,n){let r=!0;if((C0(t)||C0(e))&&(r=!1),C0(t)&&C0(e)&&(r=!0),r){const n=t.constructor.name,r=e.constructor.name;if(n!==r)throw new Error(`Arrays are of different type. Actual: ${n}. Expected: ${r}`)}if(Array.isArray(t)&&Array.isArray(e)){const n=Y3(t),r=Y3(e);if(!x0(n,r))throw new Error(`Arrays have different shapes. Actual: [${n}]. Expected: [${r}]`)}const s=C0(t)?t:w0(t),o=C0(e)?e:w0(e);if(s.length!==o.length)throw new Error(`Arrays have different lengths actual: ${s.length} vs expected: ${o.length}.\nActual:   ${s}.\nExpected: ${o}.`);for(let t=0;t<o.length;++t){const e=s[t],r=o[t];if(!n(e,r))throw new Error(`Arrays differ: actual[${t}] = ${e}, expected[${t}] = ${r}.\nActual:   ${s}.\nExpected: ${o}.`)}}function Q6(t,e,n){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}var t5=Object.freeze({__proto__:null,TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(t,e,n){return null==n&&(n=Y6()),Z6(t,e,((t,e)=>Q6(t,e,n)))},testEpsilon:Y6,expectPromiseToFail:function(t,e){t().then((()=>e.fail()),(()=>e()))},expectArraysEqual:function(t,e){const n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return M0(t)||M0(t[0])||M0(e)||M0(e[0])?Z6(t,n,((t,e)=>t==e)):Z6(t,e,((t,e)=>Q6(t,e,0)))},expectNumbersClose:function(t,e,n){if(null==n&&(n=Y6()),!Q6(t,e,n))throw new Error(`Numbers differ: actual === ${t}, expected === ${e}`)},expectValuesInRange:function(t,e,n){for(let r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error(`Value out of range:${t[r]} low: ${e}, high: ${n}`)},expectArrayBuffersEqual:function(t,e){const n=new Float32Array(t),r=new Float32Array(e);if(n.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${n.length}`);for(let t=0;t<r.length;t++)if(n[t]!==r[t])throw new Error(`Expected ArrayBuffer value at ${t} to be ${r[t]} but got ${n[t]} instead`)},encodeStrings:function t(e){for(let n=0;n<e.length;n++){const r=e[n];Array.isArray(r)?t(r):e[n]=g2(r)}return e}});
/** @license See the LICENSE file. */const e5=n4({add_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=t4(t,"a","add"),r=t4(e,"b","add");[n,r]=V2(n,r);const s={a:n,b:r};return X2.runKernel("Add",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n5=n4({floorDiv_:function(t,e){let n=t4(t,"a","floorDiv"),r=t4(e,"b","floorDiv");[n,r]=V2(n,r);const s={a:n,b:r};return X2.runKernel("FloorDiv",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r5=n4({div_:function(t,e){let n=t4(t,"a","div"),r=t4(e,"b","div");if([n,r]=V2(n,r),"int32"===n.dtype&&"int32"===r.dtype)return n5(n,r);const s={a:n,b:r};return X2.runKernel("RealDiv",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s5=n4({mul_:function(t,e){let n=t4(t,"a","mul"),r=t4(e,"b","mul");[n,r]=V2(n,r);const s={a:n,b:r};return X2.runKernel("Multiply",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o5=n4({abs_:function(t){const e=t4(t,"x","abs");if("complex64"===e.dtype){const t={x:e};return X2.runKernel("ComplexAbs",t)}{const t={x:e};return X2.runKernel("Abs",t)}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i5=n4({acos_:function(t){const e={x:t4(t,"x","acos")};return X2.runKernel("Acos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a5=n4({acosh_:function(t){const e={x:t4(t,"x","acosh")};return X2.runKernel("Acosh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u5=n4({addN_:function(t){y0(Array.isArray(t),(()=>"The argument passed to tf.addN() must be a list of tensors")),y0(t.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`));const e=t.map(((t,e)=>t4(t,`tensors${e}`,"addN"))),n=e[0];e.forEach((t=>{if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((t=>{if(!x0(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const r=e;return X2.runKernel("AddN",r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c5=n4({all_:function(t,e=null,n=!1){const r={x:t4(t,"x","all","bool")},s={axis:e,keepDims:n};return X2.runKernel("All",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l5=n4({any_:function(t,e=null,n=!1){const r={x:t4(t,"x","any","bool")},s={axis:e,keepDims:n};return X2.runKernel("Any",r,s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f5=n4({argMax_:function(t,e=0){const n={x:t4(t,"x","argMax")},r={axis:e};return X2.runKernel("ArgMax",n,r)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h5=n4({argMin_:function(t,e=0){const n={x:t4(t,"x","argMin")},r={axis:e};return X2.runKernel("ArgMin",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p5=n4({asin_:function(t){const e={x:t4(t,"x","asin")};return X2.runKernel("Asin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d5=n4({asinh_:function(t){const e={x:t4(t,"x","asinh")};return X2.runKernel("Asinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m5=n4({atan_:function(t){const e={x:t4(t,"x","atan")};return X2.runKernel("Atan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y5=n4({atan2_:function(t,e){let n=t4(t,"a","atan2"),r=t4(e,"b","atan2");[n,r]=V2(n,r);const s={a:n,b:r};return X2.runKernel("Atan2",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g5=n4({atanh_:function(t){const e={x:t4(t,"x","atanh")};return X2.runKernel("Atanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b5(t,e,n,r,s,o,i="channelsLast"){const[a,u]=N5(e);let c;if("channelsLast"===i)c=[a,u,t[3],t[3]];else{if("channelsFirst"!==i)throw new Error(`Unknown dataFormat ${i}`);c=[a,u,t[1],t[1]]}return w5(t,c,n,r,s,o,!1,i)}function w5(t,e,n,r,s,o,i=!1,a="channelsLast"){let[u,c,l,f]=[-1,-1,-1,-1];if("channelsLast"===a)[u,c,l,f]=t;else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);[u,f,c,l]=t}const[h,p,,d]=e,[m,y]=N5(n),[g,b]=N5(r),w=E5(h,g),v=E5(p,b),{padInfo:x,outHeight:N,outWidth:$}=function(t,e,n,r,s,o,i,a,u){let c,l,f;if("number"==typeof t){c={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};const s=function(t,e,n,r,s){null==r&&(r=x5(t,e,n));const o=t[0],i=t[1],a=S5((o-e+2*r)/n+1,s),u=S5((i-e+2*r)/n+1,s);return[a,u]}([e,n],o,r,t,a);l=s[0],f=s[1]}else if("same"===t){l=Math.ceil(e/r),f=Math.ceil(n/s);const t=Math.max(0,(l-1)*r+o-e),a=Math.max(0,(f-1)*s+i-n),u=Math.floor(t/2),h=t-u,p=Math.floor(a/2);c={top:u,bottom:h,left:p,right:a-p,type:"SAME"}}else if("valid"===t)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-o+1)/r),f=Math.ceil((n-i+1)/s);else{if("object"!=typeof t)throw Error(`Unknown padding parameter: ${t}`);{const h="channelsLast"===u?t[1][0]:t[2][0],p="channelsLast"===u?t[1][1]:t[2][1],d="channelsLast"===u?t[2][0]:t[3][0],m="channelsLast"===u?t[2][1]:t[3][1];c={top:h,bottom:p,left:d,right:m,type:0===h&&0===p&&0===d&&0===m?"VALID":"EXPLICIT"},l=S5((e-o+h+p)/r+1,a),f=S5((n-i+d+m)/s+1,a)}}return{padInfo:c,outHeight:l,outWidth:f}}(s,c,l,m,y,w,v,o,a),E=i?d*f:d;let S;return"channelsFirst"===a?S=[u,E,N,$]:"channelsLast"===a&&(S=[u,N,$,E]),{batchSize:u,dataFormat:a,inHeight:c,inWidth:l,inChannels:f,outHeight:N,outWidth:$,outChannels:E,padInfo:x,strideHeight:m,strideWidth:y,filterHeight:h,filterWidth:p,effectiveFilterHeight:w,effectiveFilterWidth:v,dilationHeight:g,dilationWidth:b,inShape:t,outShape:S,filterShape:e}}function v5(t,e,n,r,s,o=!1,i="channelsLast",a){let[u,c,l,f,h]=[-1,-1,-1,-1,-1];if("channelsLast"===i)[u,c,l,f,h]=t;else{if("channelsFirst"!==i)throw new Error(`Unknown dataFormat ${i}`);[u,h,c,l,f]=t}const[p,d,m,,y]=e,[g,b,w]=$5(n),[v,x,N]=$5(r),$=E5(p,v),E=E5(d,x),S=E5(m,N),{padInfo:_,outDepth:T,outHeight:k,outWidth:A}=function(t,e,n,r,s,o,i,a,u,c,l){let f,h,p,d;if("number"==typeof t){f={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};const o=function(t,e,n,r,s,o){null==s&&(s=x5(t,e,r));const i=t[0],a=t[1],u=t[2],c=S5((i-e+2*s)/r+1,o),l=S5((a-e+2*s)/r+1,o),f=S5((u-e+2*s)/r+1,o);return[c,l,f,n]}([e,n,r,1],a,1,s,t,l);h=o[0],p=o[1],d=o[2]}else if("same"===t){h=Math.ceil(e/s),p=Math.ceil(n/o),d=Math.ceil(r/i);const t=(h-1)*s+a-e,l=(p-1)*o+u-n,m=(d-1)*i+c-r,y=Math.floor(t/2),g=t-y,b=Math.floor(l/2),w=l-b,v=Math.floor(m/2);f={top:b,bottom:w,left:v,right:m-v,front:y,back:g,type:"SAME"}}else{if("valid"!==t)throw Error(`Unknown padding parameter: ${t}`);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((e-a+1)/s),p=Math.ceil((n-u+1)/o),d=Math.ceil((r-c+1)/i)}return{padInfo:f,outDepth:h,outHeight:p,outWidth:d}}(s,c,l,f,g,b,w,$,E,S,a),C=o?y*h:y;let O;return"channelsFirst"===i?O=[u,C,T,k,A]:"channelsLast"===i&&(O=[u,T,k,A,C]),{batchSize:u,dataFormat:i,inDepth:c,inHeight:l,inWidth:f,inChannels:h,outDepth:T,outHeight:k,outWidth:A,outChannels:C,padInfo:_,strideDepth:g,strideHeight:b,strideWidth:w,filterDepth:p,filterHeight:d,filterWidth:m,effectiveFilterDepth:$,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationDepth:v,dilationHeight:x,dilationWidth:N,inShape:t,outShape:O,filterShape:e}}function x5(t,e,n,r=1){const s=E5(e,r);return Math.floor((t[0]*(n-1)-n+s)/2)}function N5(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function $5(t){return"number"==typeof t?[t,t,t]:t}function E5(t,e){return e<=1?t:t+(t-1)*(e-1)}function S5(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function _5(t){const[e,n,r]=N5(t);return 1===e&&1===n&&1===r}function T5(t,e){return _5(t)||_5(e)}function k5(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function A5(t,e,n){if(null!=n){if("string"==typeof e)throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if("number"==typeof e)y0(N0(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`));else{if("object"!=typeof e)throw Error(`Error in ${t}: Unknown padding parameter: ${e}`);e.forEach((e=>{e.forEach((e=>{y0(N0(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`))}))}))}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C5=n4({reshape_:function(t,e){const n={x:t4(t,"x","reshape","string_or_numeric")},r={shape:e};return X2.runKernel("Reshape",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O5=n4({avgPool_:function(t,e,n,r,s){const o=t4(t,"x","avgPool","float32");y0(T5(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let i=o,a=!1;3===o.rank&&(a=!0,i=C5(o,[1,o.shape[0],o.shape[1],o.shape[2]])),y0(4===i.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${i.rank}.`)),A5("avgPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s};let l=X2.runKernel("AvgPool",u,c);return l=G4(l,o.dtype),a?C5(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I5=n4({avgPool3d_:function(t,e,n,r,s,o="NDHWC"){const i=t4(t,"x","avgPool3d","float32");let a=i,u=!1;4===i.rank&&(u=!0,a=C5(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),y0(5===a.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`)),y0("NDHWC"===o,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),A5("avgPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o};let f=X2.runKernel("AvgPool3D",c,l);return f=G4(f,a.dtype),u?C5(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M5=n4({concat_:function(t,e=0){y0(t.length>=1,(()=>"Pass at least one tensor to concat"));const n=e4(t,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((t=>{if("complex64"!==t.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${t.dtype}. `)})),1===n.length)return q4(n[0]);const r=n,s={axis:e};return X2.runKernel("Concat",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R5=n4({sigmoid_:function(t){const e={x:t4(t,"x","sigmoid","float32")};return X2.runKernel("Sigmoid",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D5=n4({slice_:function(t,e,n){const r=t4(t,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const s={x:r},o={begin:e,size:n};return X2.runKernel("Slice",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F5=n4({tanh_:function(t){const e={x:t4(t,"x","tanh","float32")};return X2.runKernel("Tanh",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L5=n4({basicLSTMCell_:function(t,e,n,r,s,o){const i=t4(t,"forgetBias","basicLSTMCell"),a=t4(e,"lstmKernel","basicLSTMCell"),u=t4(n,"lstmBias","basicLSTMCell"),c=t4(r,"data","basicLSTMCell"),l=t4(s,"c","basicLSTMCell"),f=t4(o,"h","basicLSTMCell"),h=M5([c,f],1),p=l6(h,a),d=e5(p,u),m=d.shape[0],y=d.shape[1]/4,g=[m,y],b=D5(d,[0,0],g),w=D5(d,[0,y],g),v=D5(d,[0,2*y],g),x=D5(d,[0,3*y],g),N=e5(s5(R5(b),F5(w)),s5(l,R5(e5(i,v))));return[N,s5(F5(N),R5(x))]}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P5=n4({batchToSpaceND_:function(t,e,n){const r=t4(t,"x","batchToSpaceND"),s=e.reduce(((t,e)=>t*e));y0(r.rank>=1+e.length,(()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`)),y0(n.length===e.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`)),y0(r.shape[0]%s==0,(()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${s}`));const o={x:r},i={blockShape:e,crops:n};return X2.runKernel("BatchToSpaceND",o,i)}});const B5=n4({batchNorm_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r,s,o){null==o&&(o=.001);const i=t4(t,"x","batchNorm"),a=t4(e,"mean","batchNorm"),u=t4(n,"variance","batchNorm");let c,l;null!=s&&(c=t4(s,"scale","batchNorm")),null!=r&&(l=t4(r,"offset","batchNorm")),y0(a.rank===u.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),y0(null==l||a.rank===l.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),y0(null==c||a.rank===c.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const f=function(t){let e;return e=0===t.rank||1===t.rank?C5(t,[1,1,1,t.size]):2===t.rank?C5(t,[1,1,t.shape[0],t.shape[1]]):3===t.rank?C5(t,[1,t.shape[0],t.shape[1],t.shape[2]]):t,e}(i),h={x:f,scale:c,offset:l,mean:a,variance:u},p={varianceEpsilon:o},d=X2.runKernel("FusedBatchNorm",h,p);return C5(d,i.shape)}});const V5=n4({batchNorm2d_:function(t,e,n,r,s,o){const i=t4(t,"x","batchNorm"),a=t4(e,"mean","batchNorm"),u=t4(n,"variance","batchNorm");let c,l;return null!=s&&(c=t4(s,"scale","batchNorm")),null!=r&&(l=t4(r,"offset","batchNorm")),y0(2===i.rank,(()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`)),y0(2===a.rank||1===a.rank,(()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`)),y0(2===u.rank||1===u.rank,(()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`)),null!=c&&y0(2===c.rank||1===c.rank,(()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`)),null!=l&&y0(2===l.rank||1===l.rank,(()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${l.rank}.`)),B5(i,a,u,l,c,o)}});const z5=n4({batchNorm3d_:function(t,e,n,r,s,o){const i=t4(t,"x","batchNorm"),a=t4(e,"mean","batchNorm"),u=t4(n,"variance","batchNorm");let c,l;return null!=s&&(c=t4(s,"scale","batchNorm")),null!=r&&(l=t4(r,"offset","batchNorm")),y0(3===i.rank,(()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`)),y0(3===a.rank||1===a.rank,(()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`)),y0(3===u.rank||1===u.rank,(()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`)),null!=c&&y0(3===c.rank||1===c.rank,(()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`)),null!=l&&y0(3===l.rank||1===l.rank,(()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${l.rank}.`)),B5(i,a,u,l,c,o)}});const W5=n4({batchNorm4d_:function(t,e,n,r,s,o){const i=t4(t,"x","batchNorm"),a=t4(e,"mean","batchNorm"),u=t4(n,"variance","batchNorm");let c,l;return null!=s&&(c=t4(s,"scale","batchNorm")),null!=r&&(l=t4(r,"offset","batchNorm")),y0(4===i.rank,(()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`)),y0(4===a.rank||1===a.rank,(()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`)),y0(4===u.rank||1===u.rank,(()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`)),null!=c&&y0(4===c.rank||1===c.rank,(()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`)),null!=l&&y0(4===l.rank||1===l.rank,(()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${l.rank}.`)),B5(i,a,u,l,c,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U5=n4({bincount_:function(t,e,n){const r=t4(t,"x","bincount"),s=t4(e,"weights","bincount");y0("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),y0(n>=0,(()=>`size must be non-negative, but got ${n}.`)),y0(s.size===r.size||0===s.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${s.shape}.`));const o={x:r,weights:s},i={size:n};return X2.runKernel("Bincount",o,i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j5=n4({broadcastArgs_:function(t,e){const n=t4(t,"s0","broadcastArgs","int32"),r=t4(e,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(1!==r.rank)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const s={s0:n,s1:r};return X2.runKernel("BroadcastArgs",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G5=n4({broadcastTo_:function(t,e){let n=t4(t,"broadcastTo","x");const r=n.shape;if(e.some((t=>!(t>0)||t%1!=0)))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const t=n.shape.slice();for(;t.length<e.length;)t.unshift(1);n=C5(n,t)}const s=n.shape,o=Array.from(e);for(let t=e.length-1;t>=0;t--)if(s[t]===e[t])o[t]=1;else if(1!==n.shape[t])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);const i=o.map(((t,e)=>t>1?e:-1)).filter((t=>t>=0));if(0===i.length)return q4(n);const a={x:n},u={reps:o};return X2.runKernel("Tile",a,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q5=n4({ceil_:function(t){const e={x:t4(t,"x","ceil","float32")};return X2.runKernel("Ceil",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H5=n4({clipByValue_:function(t,e,n){const r=t4(t,"x","clipByValue");y0(e<=n,(()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`));const s={x:r},o={clipValueMin:e,clipValueMax:n};return X2.runKernel("ClipByValue",s,o)}});const K5=n4({concat1d_:function(t){return M5(t,0)}});const X5=n4({concat2d_:function(t,e){return M5(t,e)}});const J5=n4({concat3d_:function(t,e){return M5(t,e)}});const Y5=n4({concat4d_:function(t,e){return M5(t,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z5=n4({conv2d_:function(t,e,n,r,s="NHWC",o=[1,1],i){const a=t4(t,"x","conv2d","float32"),u=t4(e,"filter","conv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=C5(a,[1,a.shape[0],a.shape[1],a.shape[2]])),y0(4===c.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`)),y0(4===u.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`)),A5("conv2d",r,i);const f="NHWC"===s?c.shape[3]:c.shape[1];y0(f===u.shape[2],(()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`)),y0(T5(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const h={x:c,filter:u},p={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},d=X2.runKernel("Conv2D",h,p);return l?C5(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});const Q5=n4({conv1d_:function(t,e,n,r,s="NWC",o=1,i){const a=t4(t,"x","conv1d"),u=t4(e,"filter","conv1d");let c=a,l=!1;2===a.rank&&(l=!0,c=C5(a,[1,a.shape[0],a.shape[1]])),y0(3===c.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`)),y0(3===u.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`)),A5("conv1d",r,i),y0(c.shape[2]===u.shape[1],(()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`)),y0(T5(n,o),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${o}'`)),y0("NWC"===s,(()=>`Error in conv1d: got dataFormat of ${s} but only NWC is currently supported.`));const f=C5(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=C5(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=Z5(h,f,[1,n],r,"NHWC",[1,o],i);return C5(p,l?[p.shape[2],p.shape[3]]:[p.shape[0],p.shape[2],p.shape[3]])}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t8=n4({conv2DBackpropInput_:function(t,e,n,r,s,o="NHWC",i){y0(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let a=t,u=e,c=!1;3===e.rank&&(c=!0,u=C5(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),y0(4===a.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`)),y0(4===u.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`)),y0(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const l="NHWC"===o?a[3]:a[1],f="NHWC"===o?u.shape[3]:u.shape[1];y0(l===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[2]}.`)),y0(f===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${n.shape[3]}.`)),A5("conv2dDerInput",s,i);const h={dy:u,filter:n},p={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,inputShape:a},d=X2.runKernel("Conv2DBackpropInput",h,p);return c?C5(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});const e8=n4({conv2dTranspose_:function(t,e,n,r,s,o){const i=t4(t,"x","conv2dTranspose"),a=t4(e,"filter","conv2dTranspose");return t8(n,i,a,r,s,"NHWC",o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n8=n4({conv3d_:function(t,e,n,r,s="NDHWC",o=[1,1,1]){const i=t4(t,"x","conv3d"),a=t4(e,"filter","conv3d");let u=i,c=!1;4===i.rank&&(c=!0,u=C5(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),y0(5===u.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`)),y0(5===a.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`)),y0(u.shape[4]===a.shape[3],(()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${a.shape[3]}.`)),y0(T5(n,o),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),y0("NDHWC"===s,(()=>`Error in conv3d: got dataFormat of ${s} but only NDHWC is currently supported.`));const l={x:u,filter:a},f={strides:n,pad:r,dataFormat:s,dilations:o},h=X2.runKernel("Conv3D",l,f);return c?C5(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r8=n4({conv3DBackpropInput_:function(t,e,n,r,s){y0(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let o=t,i=e,a=!1;4===e.rank&&(a=!0,i=C5(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,t[0],t[1],t[2],t[3]]);const u=o[4],c=i.shape[4];y0(5===o.length,(()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`)),y0(5===i.rank,(()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`)),y0(5===n.rank,(()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`)),y0(u===n.shape[3],(()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[3]}.`)),y0(c===n.shape[4],(()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`));const l={dy:i,filter:n},f={pad:s,strides:r,inputShape:o},h=X2.runKernel("Conv3DBackpropInputV2",l,f);return a?C5(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});const s8=n4({conv3dTranspose_:function(t,e,n,r,s){const o=t4(t,"x","conv3dTranspose"),i=t4(e,"filter","conv3dTranspose");return r8(n,o,i,r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o8=n4({cos_:function(t){const e={x:t4(t,"x","cos","float32")};return X2.runKernel("Cos",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i8=n4({cosh_:function(t){const e={x:t4(t,"x","cosh","float32")};return X2.runKernel("Cosh",e)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a8=n4({cumprod_:function(t,e=0,n=!1,r=!1){const s={x:t4(t,"x","cumprod")},o={axis:e,exclusive:n,reverse:r};return X2.runKernel("Cumprod",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u8=n4({cumsum_:function(t,e=0,n=!1,r=!1){const s={x:t4(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:r};return X2.runKernel("Cumsum",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c8=n4({denseBincount_:function(t,e,n,r=!1){const s=t4(t,"x","denseBincount"),o=t4(e,"weights","denseBincount");y0("int32"===s.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${s.dtype}`)),y0(s.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${s.rank}.`)),y0(n>=0,(()=>`size must be non-negative, but got ${n}.`)),y0(o.size===s.size||0===o.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${s.shape}, weights shape: ${o.shape}.`));const i={x:s,weights:o},a={size:n,binaryOutput:r};return X2.runKernel("DenseBincount",i,a)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l8=n4({depthToSpace_:function(t,e,n="NHWC"){const r=t4(t,"x","depthToSpace","float32"),s="NHWC"===n?r.shape[1]:r.shape[2],o="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];y0(e>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`)),y0(s*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${s} and ${e}  for depthToSpace with input shape\n    ${r.shape}`)),y0(o*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${o} and ${e} for depthToSpace with input shape\n        ${r.shape}`)),y0(i%(e*e)==0,(()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${r.shape}`));const a={x:r},u={blockSize:e,dataFormat:n};return X2.runKernel("DepthToSpace",a,u)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f8=n4({depthwiseConv2d_:function(t,e,n,r,s="NHWC",o=[1,1],i){const a=t4(t,"x","depthwiseConv2d","float32"),u=t4(e,"filter","depthwiseConv2d","float32");let c=a,l=!1;3===a.rank&&(l=!0,c=C5(a,[1,a.shape[0],a.shape[1],a.shape[2]])),y0(4===c.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`)),y0(4===u.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`)),y0(c.shape[3]===u.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`)),A5("depthwiseConv2d",r,i);const f={x:c,filter:u},h={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},p=X2.runKernel("DepthwiseConv2dNative",f,h);return l?C5(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h8=n4({diag_:function(t){const e={x:t4(t,"x","diag")};return X2.runKernel("Diag",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p8=n4({dilation2d_:function(t,e,n,r,s=[1,1],o="NHWC"){const i=t4(t,"x","dilation2d"),a=t4(e,"filter","dilation2d");y0(3===i.rank||4===i.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`)),y0(3===a.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`)),y0("NHWC"===o,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`));let u=i,c=!1;3===i.rank&&(u=C5(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=!0);const l={x:u,filter:a},f={strides:n,pad:r,dilations:s},h=X2.runKernel("Dilation2D",l,f);return c?C5(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d8=n4({equal_:function(t,e){let n=t4(t,"a","equal","string_or_numeric"),r=t4(e,"b","equal","string_or_numeric");[n,r]=V2(n,r),$6(n.shape,r.shape);const s={a:n,b:r};return X2.runKernel("Equal",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m8=n4({where_:function(t,e,n){const r=t4(e,"a","where"),s=t4(n,"b","where"),o=t4(t,"condition","where","bool"),i=$6($6(o.shape,r.shape),s.shape),a={condition:G5(o,i),t:G5(r,i),e:G5(s,i)};return X2.runKernel("Select",a)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y8=n4({zerosLike_:function(t){const e={x:t4(t,"x","zerosLike")};return X2.runKernel("ZerosLike",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g8=n4({divNoNan_:function(t,e){let n=t4(t,"a","div"),r=t4(e,"b","div");[n,r]=V2(n,r);const s=r5(n,r),o=y8(s),i=d8(r,o);return m8(i,o,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b8=n4({dot_:function(t,e){const n=t4(t,"t1","dot"),r=t4(e,"t2","dot");y0(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`));const s=1===n.rank?n.size:n.shape[1],o=1===r.rank?r.size:r.shape[0];if(y0(s===o,(()=>`Error in dot: inner dimensions of inputs must match, but got ${s} and ${o}.`)),1===n.rank&&1===r.rank){const t=C5(n,[1,-1]),e=C5(r,[-1,1]),s=l6(t,e);return C5(s,[])}if(1===n.rank&&2===r.rank){const t=C5(n,[1,-1]),e=C5(r,[r.shape[0],r.shape[1]]),s=l6(t,e);return C5(s,[s.size])}if(2===n.rank&&1===r.rank){const t=C5(r,[-1,1]),e=l6(n,t);return C5(e,[e.size])}{const t=C5(r,[r.shape[0],r.shape[1]]);return l6(n,t)}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w8=n4({einsum_:function(t,...e){const n=e.map(((t,e)=>t4(t,`tensors${e}`,"einsum"))),r={equation:t};return X2.runKernel("Einsum",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v8=n4({elu_:function(t){const e={x:t4(t,"x","elu","float32")};return X2.runKernel("Elu",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x8=n4({erf_:function(t){let e=t4(t,"x","erf");y0("int32"===e.dtype||"float32"===e.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===e.dtype&&(e=G4(e,"float32"));const n={x:e};return X2.runKernel("Erf",n)}});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N8(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function $8(t,e,n){const r=t.length+e.length,s=[];let o=0,i=0;for(let a=0;a<r;a++)-1===n.indexOf(a)?s.push(t[o++]):s.push(e[i++]);return s}function E8(t,e){return $8(t,e.map((t=>1)),e)}const S8=n4({max_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=null,n=!1){const r={x:t4(t,"x","max")},s={reductionIndices:e,keepDims:n};return X2.runKernel("Max",r,s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _8=n4({min_:function(t,e=null,n=!1){const r={x:t4(t,"x","min")},s={axis:e,keepDims:n};return X2.runKernel("Min",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T8=n4({pow_:function(t,e){let n=t4(t,"base","pow"),r=t4(e,"exp","pow");[n,r]=V2(n,r);const s={a:n,b:r};return X2.runKernel("Pow",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k8(t,e){if((C0(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&C0(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return s4(t,[],[],e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A8=n4({sqrt_:function(t){const e={x:t4(t,"x","sqrt","float32")};return X2.runKernel("Sqrt",e)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C8=n4({square_:function(t){const e=t4(t,"x","square");return X2.runKernel("Square",{x:e},{})}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O8=n4({sum_:function(t,e=null,n=!1){let r=t4(t,"x","sum");"bool"===r.dtype&&(r=G4(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return X2.runKernel("Sum",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I8(t,e,n=null){if(0===t.rank)return o5(t);if(1!==t.rank&&null===n)return I8(C5(t,[-1]),e,n);if(1===t.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===e)return O8(o5(t),n);if(e===1/0)return S8(o5(t),n);if(e===-1/0)return _8(o5(t),n);if("euclidean"===e||2===e)return A8(O8(T8(o5(t),k8(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&2===n.length){if(1===e)return S8(O8(o5(t),n[0]),n[1]-1);if(e===1/0)return S8(O8(o5(t),n[1]),n[0]);if(e===-1/0)return _8(O8(o5(t),n[1]),n[0]);if("fro"===e||"euclidean"===e)return A8(O8(C8(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const M8=n4({norm_:function(t,e="euclidean",n=null,r=!1){const s=I8(t=t4(t,"x","norm"),e,n);let o=s.shape;if(r){const e=E0(n,t.shape);o=E8(s.shape,e)}return C5(s,o)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R8=n4({euclideanNorm_:function(t,e=null,n=!1){return M8(t,"euclidean",e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D8=n4({exp_:function(t){const e={x:t4(t,"x","exp")};return X2.runKernel("Exp",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F8=n4({expandDims_:function(t,e=0){const n=t4(t,"x","expandDims","string_or_numeric");y0(e<=n.rank,(()=>"Axis must be <= rank of the tensor"));const r={input:n},s={dim:e};return X2.runKernel("ExpandDims",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L8=n4({expm1_:function(t){const e={x:t4(t,"x","expm1")};return X2.runKernel("Expm1",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P8=n4({tile_:function(t,e){const n=t4(t,"x","tile","string_or_numeric");y0(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`));const r={x:n},s={reps:e};return X2.runKernel("Tile",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B8=n4({eye_:function(t,e,n,r="float32"){null==e&&(e=t);const s=j4([t,e],r),o=t<=e?t:e;for(let t=0;t<o;++t)s.set(1,t,t);const i=C5(s.toTensor(),[t,e]);if(null==n)return i;if(1===n.length)return P8(F8(i,0),[n[0],1,1]);if(2===n.length)return P8(F8(F8(i,0),0),[n[0],n[1],1,1]);if(3===n.length)return P8(F8(F8(F8(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V8(t,e,n){const r={shape:t,value:e,dtype:n};return X2.runKernel("Fill",{},r)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z8=n4({floor_:function(t){const e={x:t4(t,"x","floor","float32")};return X2.runKernel("Floor",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W8=n4({gather_:function(t,e,n=0,r=0){const s={x:t4(t,"x","gather"),indices:t4(e,"indices","gather","int32")},o={axis:n,batchDims:r};return X2.runKernel("GatherV2",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U8=n4({greater_:function(t,e){let n=t4(t,"a","greater","string_or_numeric"),r=t4(e,"b","greater","string_or_numeric");[n,r]=V2(n,r),$6(n.shape,r.shape);const s={a:n,b:r};return X2.runKernel("Greater",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j8=n4({greaterEqual_:function(t,e){let n=t4(t,"a","greaterEqual","string_or_numeric"),r=t4(e,"b","greaterEqual","string_or_numeric");[n,r]=V2(n,r),$6(n.shape,r.shape);const s={a:n,b:r};return X2.runKernel("GreaterEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G8=n4({isFinite_:function(t){const e={x:t4(t,"x","isFinite")};return X2.runKernel("IsFinite",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q8=n4({isInf_:function(t){const e={x:t4(t,"x","isInf")};return X2.runKernel("IsInf",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H8=n4({isNaN_:function(t){const e={x:t4(t,"x","isNaN")};return X2.runKernel("IsNan",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K8=n4({leakyRelu_:function(t,e=.2){const n={x:t4(t,"x","leakyRelu")},r={alpha:e};return X2.runKernel("LeakyRelu",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X8=n4({less_:function(t,e){let n=t4(t,"a","less","string_or_numeric"),r=t4(e,"b","less","string_or_numeric");[n,r]=V2(n,r),$6(n.shape,r.shape);const s={a:n,b:r};return X2.runKernel("Less",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J8=n4({lessEqual_:function(t,e){let n=t4(t,"a","lessEqual","string_or_numeric"),r=t4(e,"b","lessEqual","string_or_numeric");[n,r]=V2(n,r),$6(n.shape,r.shape);const s={a:n,b:r};return X2.runKernel("LessEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y8(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:t,stop:e,num:n};return X2.runKernel("LinSpace",{},r)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z8=n4({localResponseNormalization_:function(t,e=5,n=1,r=1,s=.5){const o=t4(t,"x","localResponseNormalization");y0(4===o.rank||3===o.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${o.rank}.`)),y0(N0(e),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`));let i=o,a=!1;3===o.rank&&(a=!0,i=C5(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const u={x:i},c={depthRadius:e,bias:n,alpha:r,beta:s},l=X2.runKernel("LRN",u,c);return a?C5(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q8=n4({log_:function(t){const e={x:t4(t,"x","log","float32")};return X2.runKernel("Log",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t9=n4({log1p_:function(t){const e={x:t4(t,"x","log1p")};return X2.runKernel("Log1p",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e9(t,e){y0(L0(t),(()=>"The f passed in variableGrads(f) must be a function")),y0(null==e||Array.isArray(e)&&e.every((t=>t instanceof I2)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=e;if(!n){e=[];for(const t in X2.registeredVariables)e.push(X2.registeredVariables[t])}const r=n?e.filter((t=>!t.trainable)):null,s=e.length;e=e.filter((t=>t.trainable)),y0(e.length>0,(()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${s} variables is trainable.`));const{value:o,grads:i}=X2.gradients(t,e,null,!0);y0(i.some((t=>null!=t)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),y0(0===o.rank,(()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`));const a={};return e.forEach(((t,e)=>{null!=i[e]&&(a[t.name]=i[e])})),null!=r&&r.forEach((t=>a[t.name]=null)),{value:o,grads:a}}function n9(t){return X2.customGrad(t)}function r9(t){const e=t.filter((t=>null==t)).length;if(e>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s9=n4({softplus_:function(t){const e={x:t4(t,"x","softplus")};return X2.runKernel("Softplus",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o9=n4({logSigmoid_:function(t){const e=t4(t,"x","logSigmoid"),n=n9((t=>({value:y6(s9(y6(t))),gradFunc:e=>s5(e,R5(y6(t)))})));return n(e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i9=n4({sub_:function(t,e){let n=t4(t,"a","sub"),r=t4(e,"b","sub");[n,r]=V2(n,r);const s={a:n,b:r};return X2.runKernel("Sub",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a9=n4({logSoftmax_:function(t,e=-1){const n=t4(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);const r=n9(((t,n)=>{const r=S8(t,e,!0),s=i9(t,r),o=i9(G4(s,"float32"),Q8(O8(D8(s),e,!0)));n([o]);return{value:o,gradFunc:(t,n)=>{const[r]=n,s=D8(r);return i9(t,s5(O8(t,e,!0),s))}}}));return r(n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u9=n4({logSumExp_:function(t,e=null,n=!1){const r=t4(t,"x","logSumExp"),s=E0(e,r.shape),o=S8(r,s,!0),i=i9(r,o),a=D8(i),u=O8(a,s),c=Q8(u),l=e5(C5(o,c.shape),c);if(n){const t=E8(l.shape,s);return C5(l,t)}return l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c9=n4({logicalAnd_:function(t,e){const n=t4(t,"a","logicalAnd","bool"),r=t4(e,"b","logicalAnd","bool");$6(n.shape,r.shape);const s={a:n,b:r};return X2.runKernel("LogicalAnd",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l9=n4({logicalNot_:function(t){const e={x:t4(t,"x","logicalNot","bool")};return X2.runKernel("LogicalNot",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f9=n4({logicalOr_:function(t,e){const n=t4(t,"a","logicalOr","bool"),r=t4(e,"b","logicalOr","bool");$6(n.shape,r.shape);const s={a:n,b:r};return X2.runKernel("LogicalOr",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h9=n4({logicalXor_:function(t,e){const n=t4(t,"a","logicalXor","bool"),r=t4(e,"b","logicalXor","bool");return $6(n.shape,r.shape),c9(f9(t,e),l9(c9(t,e)))}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p9=n4({searchSorted_:function(t,e,n="left"){const r=t4(t,"sortedSequence","searchSorted"),s=t4(e,"values","searchSorted"),o=r.shape[r.shape.length-1],i=s.shape[s.shape.length-1],a=C5(r,[-1,o]),u=C5(s,[-1,i]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(v0(u.shape)>=2147483648)throw new Error("values tensor size must less than 2147483648");if(a.shape[1]>=2147483648)throw new Error(`trailing dim_size must less than 2147483648 for int32 output type, was ${a.shape[1]}`);const c={sortedSequence:a,values:u},l={side:n};return X2.runKernel("SearchSorted",c,l)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d9(t,e){return p9(t,e,"left")}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m9=n4({maxPool_:function(t,e,n,r,s){const o=t4(t,"x","maxPool");let i=o,a=!1;3===o.rank&&(a=!0,i=C5(o,[1,o.shape[0],o.shape[1],o.shape[2]])),y0(4===i.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${i.rank}.`)),y0(T5(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),A5("maxPool",r,s);const u={x:i},c={filterSize:e,strides:n,pad:r,dimRoundingMode:s},l=X2.runKernel("MaxPool",u,c);return a?C5(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y9=n4({maxPool3d_:function(t,e=[1,1,1],n,r,s,o="NDHWC"){const i=t4(t,"x","maxPool3d");let a=i,u=!1;4===i.rank&&(u=!0,a=C5(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),y0(5===a.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`)),y0("NDHWC"===o,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),A5("maxPool3d",r,s);const c={x:a},l={filterSize:e,strides:n,pad:r,dimRoundingMode:s,dataFormat:o},f=X2.runKernel("MaxPool3D",c,l);return u?C5(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g9=n4({maxPoolWithArgmax_:function(t,e,n,r,s=!1){const o={x:t4(t,"x","maxPoolWithArgmax")},i={filterSize:e,strides:n,pad:r,includeBatchInIndex:s},a=X2.runKernel("MaxPoolWithArgmax",o,i);return{result:a[0],indexes:a[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b9=n4({maximum_:function(t,e){let n=t4(t,"a","maximum"),r=t4(e,"b","maximum");[n,r]=V2(n,r),"bool"===n.dtype&&(n=G4(n,"int32"),r=G4(r,"int32")),$6(n.shape,r.shape);const s={a:n,b:r};return X2.runKernel("Maximum",s)}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w9=n4({mean_:function(t,e=null,n=!1){const r={x:t4(t,"x","mean")},s={axis:e,keepDims:n};return X2.runKernel("Mean",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v9(t,e="float32"){if("complex64"===e){const e=v9(t,"float32"),n=v9(t,"float32");return r4(e,n)}const n=U0(v0(t),e);return X2.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x9(t,e="float32"){if("complex64"===e){const e=x9(t,"float32"),n=v9(t,"float32");return r4(e,n)}const n=W0(v0(t),e);return X2.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N9=n4({minimum_:
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n=t4(t,"a","minimum"),r=t4(e,"b","minimum");[n,r]=V2(n,r),"bool"===n.dtype&&(n=G4(n,"int32"),r=G4(r,"int32")),$6(n.shape,r.shape);const s={a:n,b:r};return X2.runKernel("Minimum",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $9=n4({mirrorPad_:function(t,e,n){y0("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const r=t4(t,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");y0(e.length===r.rank,(()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`));const s="reflect"===n?1:0;for(let t=0;t<r.rank;t++)y0(2===e[t].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),y0(e[t][0]>=0&&e[t][0]<=r.shape[t]-s&&e[t][1]>=0&&e[t][1]<=r.shape[t]-s,(()=>`Padding in dimension ${t} cannot be greater than or equal to ${r.shape[t]-s} or less than 0 for input of shape ${r.shape}`));const o={paddings:e,mode:n},i={x:r};return X2.runKernel("MirrorPad",i,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E9=n4({mod_:function(t,e){let n=t4(t,"a","mod"),r=t4(e,"b","mod");[n,r]=V2(n,r);const s={a:n,b:r};return X2.runKernel("Mod",s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S9=n4({moments_:function(t,e=null,n=!1){const r=E0(e,(t=t4(t,"x","moments")).shape),s=w9(t,r,n);let o=s.shape;n||(o=E8(s.shape,r));const i=C8(i9(G4(t,"float32"),C5(s,o)));return{mean:s,variance:w9(i,r,n)}}});const _9=n4({multiRNNCell_:function(t,e,n,r){const s=t4(e,"data","multiRNNCell"),o=e4(n,"c","multiRNNCell"),i=e4(r,"h","multiRNNCell");let a=s;const u=[];for(let e=0;e<t.length;e++){const n=t[e](a,o[e],i[e]);u.push(n[0]),u.push(n[1]),a=n[1]}const c=[],l=[];for(let t=0;t<u.length;t+=2)c.push(u[t]),l.push(u[t+1]);return[c,l]}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T9=n4({multinomial_:function(t,e,n,r=!1){const s=t4(t,"logits","multinomial"),o=s.size,i=s.rank;if(o<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${o}.`);if(i>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${i}`);n=n||Math.random();const a={logits:1===i?C5(s,[1,-1]):s},u={numSamples:e,seed:n,normalized:r},c=X2.runKernel("Multinomial",a,u);return 1===i?C5(c,[c.size]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k9=n4({notEqual_:function(t,e){let n=t4(t,"a","notEqual","string_or_numeric"),r=t4(e,"b","notEqual","string_or_numeric");[n,r]=V2(n,r),$6(n.shape,r.shape);const s={a:n,b:r};return X2.runKernel("NotEqual",s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A9=n4({onesLike_:function(t){const e={x:t4(t,"x","onesLike")};return X2.runKernel("OnesLike",e)}});const C9=n4({outerProduct_:function(t,e){const n=t4(t,"v1","outerProduct"),r=t4(e,"v2","outerProduct");y0(1===n.rank&&1===r.rank,(()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`));const s=C5(n,[-1,1]),o=C5(r,[1,-1]);return l6(s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O9=n4({pad_:function(t,e,n=0){const r=t4(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:n},o={x:r};return X2.runKernel("PadV2",o,s)}});const I9=n4({pad1d_:function(t,e,n=0){return y0(2===e.length,(()=>"Invalid number of paddings. Must be length of 2.")),O9(t,[e],n)}});const M9=n4({pad2d_:function(t,e,n=0){return y0(2===e.length&&2===e[0].length&&2===e[1].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),O9(t,e,n)}});const R9=n4({pad3d_:function(t,e,n=0){return y0(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),O9(t,e,n)}});const D9=n4({pad4d_:function(t,e,n=0){return y0(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),O9(t,e,n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F9=n4({spaceToBatchND_:function(t,e,n){const r=t4(t,"x","spaceToBatchND");y0(r.rank>=1+e.length,(()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`)),y0(n.length===e.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`)),y0(r.shape.reduce(((t,r,s)=>s>0&&s<=e.length?t&&(r+n[s-1][0]+n[s-1][1])%e[s-1]==0:t),!0),(()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`));const s={x:r},o={blockShape:e,paddings:n};return X2.runKernel("SpaceToBatchND",s,o)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L9=n4({pool_:function(t,e,n,r,s,o,i){null==s&&(s=[1,1]),null==o&&(o=1),0===r&&(r="valid");const a=t4(t,"x","maxPool");let u=a,c=!1;3===a.rank&&(c=!0,u=C5(a,[1,a.shape[0],a.shape[1],a.shape[2]])),y0(T5(o,s),(()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${s}'`));const l=b5(u.shape,e,o,s,r),f=[l.dilationHeight,l.dilationWidth];let h;h="same"===r?function(t,e){const n=t.map(((t,n)=>t+(t-1)*(e[n]-1))),r=n.map((t=>t-1)),s=r.map((t=>Math.floor(t/2))),o=r.map(((t,e)=>t-s[e]));return r.map(((t,e)=>[s[e],o[e]]))}([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];const p=1===f[0]&&1===f[1],[d,m]=function(t,e,n){const r=n.map((t=>t[0])),s=n.map((t=>t[1])),o=t.concat(r,s),i=e.map(((t,e)=>(t-o[e]%t)%t)),a=s.map(((t,e)=>t+i[e])),u=e.map(((t,e)=>[r[e],a[e]])),c=e.map(((t,e)=>[0,i[e]]));return[u,c]}([l.inHeight,l.inWidth],f,h),y=p?r:"valid",g=p?u:F9(u,f,d),b=("avg"===n?()=>O5(g,e,o,y,i):()=>m9(g,e,o,y,i))(),w=p?b:P5(b,f,m);return c?C5(w,[w.shape[1],w.shape[2],w.shape[3]]):w}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P9=n4({prelu_:function(t,e){const n={x:t4(t,"x","prelu"),alpha:t4(e,"alpha","prelu")};return X2.runKernel("Prelu",n)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B9=n4({prod_:function(t,e=null,n=!1){let r=t4(t,"x","prod");"bool"===r.dtype&&(r=G4(r,"int32"));const s={x:r},o={axis:e,keepDims:n};return X2.runKernel("Prod",s,o)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V9=n4({rand_:function(t,e,n){const r=v0(t);let s=null;if(null==n||"float32"===n)s=new Float32Array(r);else if("int32"===n)s=new Int32Array(r);else{if("bool"!==n)throw new Error(`Unknown data type ${n}`);s=new Uint8Array(r)}for(let t=0;t<r;t++)s[t]=e();return X2.makeTensor(s,t,n)}});var z9={exports:{}};!function(t,e,n){function r(t){var e=this,n=function(){var t=4022871197,e=function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)};return e}();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}function s(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var n=new r(t),o=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.alea=o}(0,z9,!1);var W9={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor128=o}(0,W9,!1);var U9={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorwow=o}(0,U9,!1);var j9={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,s=e.i;return t=r[s],n=(t^=t>>>7)^t<<24,n^=(t=r[s+1&7])^t>>>10,n^=(t=r[s+3&7])^t>>>3,n^=(t=r[s+4&7])^t<<7,t=r[s+7&7],n^=(t^=t<<13)^t<<9,r[s]=n,e.i=s+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function s(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.x&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorshift7=o}(0,j9,!1);var G9={exports:{}};!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,s=e.X,o=e.i;return e.w=r=r+1640531527|0,n=s[o+34&127],t=s[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=s[o]=n^t,e.i=o,n+(r^r>>>16)|0},function(t,e){var n,r,s,o,i,a=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),s=0,o=-32;o<u;++o)e&&(r^=e.charCodeAt((o+32)%e.length)),0===o&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(i=i+1640531527|0,s=0==(n=a[127&o]^=r+i)?s+1:0);for(s>=128&&(a[127&(e&&e.length||0)]=-1),s=127,o=512;o>0;--o)r=a[s+34&127],n=a[s=s+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,a[s]=r^n;t.w=i,t.X=a,t.i=s}(e,t)}function s(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.X&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor4096=o}(0,G9,!1);var q9={exports:{}};!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,s=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^s,s=s-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^s,e.a=s-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&s(o,n),i.state=function(){return s(n,{})}),i}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.tychei=o}(0,q9,!1);var H9={exports:{}};!function(t){!function(e,n){var r,s=this,o=256,i=n.pow(o,6),a=n.pow(2,52),u=2*a,c=255;function l(t,c,l){var y=[],g=d(p((c=1==c?{entropy:!0}:c||{}).entropy?[t,m(e)]:null==t?function(){try{var t;return r&&(t=r.randomBytes)?t=t(o):(t=new Uint8Array(o),(s.crypto||s.msCrypto).getRandomValues(t)),m(t)}catch(t){var n=s.navigator,i=n&&n.plugins;return[+new Date,s,i,s.screen,m(e)]}}():t,3),y),b=new f(y),w=function(){for(var t=b.g(6),e=i,n=0;t<a;)t=(t+n)*o,e*=o,n=b.g(1);for(;t>=u;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,d(m(b.S),e),(c.pass||l||function(t,e,r,s){return s&&(s.S&&h(s,b),t.state=function(){return h(b,{})}),r?(n.random=t,e):t})(w,g,"global"in c?c.global:this==n,c.state)}function f(t){var e,n=t.length,r=this,s=0,i=r.i=r.j=0,a=r.S=[];for(n||(t=[n++]);s<o;)a[s]=s++;for(s=0;s<o;s++)a[s]=a[i=c&i+t[s%n]+(e=a[s])],a[i]=e;(r.g=function(t){for(var e,n=0,s=r.i,i=r.j,a=r.S;t--;)e=a[s=c&s+1],n=n*o+a[c&(a[s]=a[i=c&i+e])+(a[i]=e)];return r.i=s,r.j=i,n})(o)}function h(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function p(t,e){var n,r=[],s=typeof t;if(e&&"object"==s)for(n in t)try{r.push(p(t[n],e-1))}catch(t){}return r.length?r:"string"==s?t:t+"\0"}function d(t,e){for(var n,r=t+"",s=0;s<r.length;)e[c&s]=c&(n^=19*e[c&s])+r.charCodeAt(s++);return m(e)}function m(t){return String.fromCharCode.apply(0,t)}if(n.seedrandom=l,d(n.random(),e),t.exports){t.exports=l;try{r=require("crypto")}catch(t){}}}([],Math)}(H9);var K9=z9.exports,X9=W9.exports,J9=U9.exports,Y9=j9.exports,Z9=G9.exports,Q9=q9.exports,t7=H9.exports;t7.alea=K9,t7.xor128=X9,t7.xorwow=J9,t7.xorshift7=Y9,t7.xor4096=Z9,t7.tychei=Q9;var e7=t7;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n7{constructor(t,e,n,r,s){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const o=s||Math.random();this.random=e7.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const t=this.nextVal;return this.nextVal=NaN,t}let t,e,n=!1;for(;!n;){let r,s,o;do{r=2*this.random()-1,s=2*this.random()-1,o=r*r+s*s}while(o>=1||0===o);const i=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*r*i,e=this.mean+this.stdDev*s*i,this.truncated&&!this.isValidTruncated(t)||(n=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class r7{constructor(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;const s=r||Math.random();this.randu=e7.alea(s.toString()),this.randn=new n7(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,e,n,r,s,o;for(;;){do{r=this.randn.nextValue(),o=1+this.c*r}while(o<=0);if(o*=o*o,t=r*r,e=1-.331*t*t,n=.5*t+this.d*(1-o+Math.log(o)),s=this.randu(),s<e||Math.log(s)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(t){return"float32"===this.dtype?t:Math.round(t)}}class s7{constructor(t=0,e=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=e7.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o7=n4({randomGamma_:function(t,e,n=1,r="float32",s){if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error(`Unsupported data type ${r}`);const o=new r7(e,n,r,s),i=j4(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i7=n4({randomNormal_:function(t,e=0,n=1,r,s){if(null!=r&&"bool"===r)throw new Error(`Unsupported data type ${r}`);const o=new n7(e,n,r,!1,s),i=j4(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a7=n4({randomUniform_:function(t,e=0,n=1,r="float32",s){const o=j4(t,r),i=new s7(e,n,null,s);for(let t=0;t<o.values.length;t++)o.values[t]=i.nextValue();return o.toTensor()}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u7(t,e,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");const s={start:t,stop:e,step:n,dtype:r};return X2.runKernel("Range",{},s)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c7=n4({reciprocal_:function(t){const e={x:t4(t,"x","reciprocal")};return X2.runKernel("Reciprocal",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l7=n4({relu_:function(t){const e={x:t4(t,"x","relu")};return X2.runKernel("Relu",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f7=n4({relu6_:function(t){const e={x:t4(t,"x","relu6")};return X2.runKernel("Relu6",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h7=n4({reverse_:function(t,e){const n={x:t4(t,"x","reverse")},r={dims:e};return X2.runKernel("Reverse",n,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p7=n4({reverse1d_:function(t){const e=t4(t,"x","reverse");return y0(1===e.rank,(()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`)),h7(e,0)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d7=n4({reverse2d_:function(t,e){const n=t4(t,"x","reverse");return y0(2===n.rank,(()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`)),h7(n,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m7=n4({reverse3d_:function(t,e){const n=t4(t,"x","reverse");return y0(3===n.rank,(()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`)),h7(n,e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y7=n4({reverse4d_:function(t,e){const n=t4(t,"x","reverse");return y0(4===n.rank,(()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`)),h7(n,e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g7=n4({round_:function(t){const e={x:t4(t,"x","round")};return X2.runKernel("Round",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b7=n4({rsqrt_:function(t){const e={x:t4(t,"x","rsqrt","float32")};return X2.runKernel("Rsqrt",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w7=n4({selu_:function(t){const e={x:t4(t,"x","selu")};return X2.runKernel("Selu",e)}});const v7=n4({separableConv2d_:function(t,e,n,r,s,o=[1,1],i="NHWC"){const a=t4(t,"x","separableConv2d"),u=t4(e,"depthwiseFilter","separableConv2d"),c=t4(n,"pointwiseFilter","separableConv2d");let l=a,f=!1;if(3===a.rank&&(f=!0,l=C5(a,[1,a.shape[0],a.shape[1],a.shape[2]])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");y0(4===l.rank,(()=>`Error in separableConv2d: input must be rank 4, but got rank ${l.rank}.`)),y0(4===u.rank,(()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`)),y0(4===c.rank,(()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`)),y0(1===c.shape[0],(()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`)),y0(1===c.shape[1],(()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`));const h=u.shape[2],p=u.shape[3];y0(c.shape[2]===h*p,(()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*p}, but got ${c.shape[2]}.`));const d=f8(l,u,r,s,i,o),m=Z5(d,c,1,"valid",i);return f?C5(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x7=async function(t,e){const n=t4(t,"x","setdiff1d"),r=t4(e,"y","setdiff1d");y0(n.dtype===r.dtype,(()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`)),y0(1===n.rank,(()=>`x should be 1D tensor, but got x (${n.shape}).`)),y0(1===r.rank,(()=>`y should be 1D tensor, but got y (${r.shape}).`));const s=await n.data(),o=await r.data(),i=new Set(o);let a=0;for(let t=0;t<s.length;t++)i.has(s[t])||a++;const u=new k2([a],n.dtype),c=new k2([a],"int32");for(let t=0,e=0;t<s.length;t++)i.has(s[t])||(u.values[e]=s[t],c.values[e]=t,e++);return[u.toTensor(),c.toTensor()]};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N7=n4({sign_:function(t){const e={x:t4(t,"x","sign")};return X2.runKernel("Sign",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $7=n4({sin_:function(t){const e={x:t4(t,"x","sin","float32")};return X2.runKernel("Sin",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E7=n4({sinh_:function(t){const e={x:t4(t,"x","sinh")};return X2.runKernel("Sinh",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S7=n4({slice1d_:function(t,e,n){const r=t4(t,"x","slice1d");return y0(1===r.rank,(()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`)),D5(r,[e],[n])}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _7=n4({slice2d_:function(t,e,n){const r=t4(t,"x","slice2d");return y0(2===r.rank,(()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`)),D5(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T7=n4({slice3d_:function(t,e,n){const r=t4(t,"x","slice3d");return y0(3===r.rank,(()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`)),D5(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k7=n4({slice4d_:function(t,e,n){const r=t4(t,"x","slice4d");return y0(4===r.rank,(()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`)),D5(r,e,n)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A7=n4({softmax_:function(t,e=-1){const n=t4(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const r={logits:n},s={dim:e};return X2.runKernel("Softmax",r,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C7=n4({fft_:function(t){y0("complex64"===t.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`));const e={input:t};return X2.runKernel("FFT",e)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O7=n4({ifft_:function(t){y0("complex64"===t.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`));const e={input:t};return X2.runKernel("IFFT",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I7=n4({irfft_:function(t){const e=t.shape[t.shape.length-1],n=t.size/e;let r;if(e<=2){const s=C5(t,[n,e]);r=O7(s)}else{const s=[n,2*(e-1)],o=C5(g6(t),[n,e]),i=C5(m6(t),[n,e]),a=h7(D5(o,[0,1],[n,e-2]),1),u=s5(h7(D5(i,[0,1],[n,e-2]),1),k8(-1)),c=M5([o,a],1),l=M5([i,u],1),f=C5(r4(c,l),[s[0],s[1]]);r=O7(f)}if(r=g6(r),3===t.rank&&0!==t.shape[0]){const e=r,n=t.shape[0];r=C5(r,[n,r.shape[0]/n,r.shape[1]]),e.dispose()}return r}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M7=n4({split_:function(t,e,n=0){const r={x:t4(t,"x","split")},s={numOrSizeSplits:e,axis:n};return X2.runKernel("SplitV",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R7=n4({rfft_:function(t,e){y0("float32"===t.dtype,(()=>`The dtype for rfft() must be real value but got ${t.dtype}`));let n=t.shape[t.shape.length-1];const r=t.size/n;let s;if(null!=e&&e<n){const r=t.shape.map((t=>0)),o=t.shape.map((t=>t));o[t.shape.length-1]=e,s=D5(t,r,o),n=e}else if(null!=e&&e>n){const r=t.shape.map((t=>t));r[t.shape.length-1]=e-n,s=M5([t,v9(r)],t.shape.length-1),n=e}else s=t;const o=y8(s),i=C5(r4(s,o),[r,n]),a=C7(i),u=Math.floor(n/2)+1,c=g6(a),l=m6(a),f=M7(c,[u,n-u],c.shape.length-1),h=M7(l,[u,n-u],l.shape.length-1),p=s.shape.slice();return p[s.shape.length-1]=u,C5(r4(f[0],h[0]),p)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D7=n4({squaredDifference_:function(t,e){let n=t4(t,"a","squaredDifference"),r=t4(e,"b","squaredDifference");[n,r]=V2(n,r),$6(n.shape,r.shape);const s={a:n,b:r};return X2.runKernel("SquaredDifference",s,{})}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F7=n4({squeeze_:function(t,e){const n=t4(t,"x","squeeze");return C5(n,S0(n.shape,e).newShape)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L7=n4({stack_:function(t,e=0){const n=e4(t,"tensors","stack","string_or_numeric");y0(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&y0(e<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const r=n,s={axis:e};return X2.runKernel("Pack",r,s)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P7=n4({step_:function(t,e=0){const n={x:t4(t,"x","step")},r={alpha:e};return X2.runKernel("Step",n,r)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B7=n4({stridedSlice_:function(t,e,n,r,s=0,o=0,i=0,a=0,u=0){const c={x:t4(t,"x","stridedSlice","string_or_numeric")},l={begin:e,end:n,strides:r,beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:u};return X2.runKernel("StridedSlice",c,l)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V7=n4({tan_:function(t){const e={x:t4(t,"x","tan","float32")};return X2.runKernel("Tan",e)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z7(t,e){b0(t);const n=Y3(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return s4(t,null,n,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W7(t,e,n){if(b0(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");const r=Y3(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return s4(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U7=n4({topk_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e=1,n=!0){const r=t4(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const s=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const o={x:r},i={k:e,sorted:n},[a,u]=X2.runKernel("TopK",o,i);return{values:a,indices:u}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j7=n4({truncatedNormal_:function(t,e=0,n=1,r,s){if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const o=new n7(e,n,r,!0,s),i=j4(t,r);for(let t=0;t<i.values.length;t++)i.values[t]=o.nextValue();return i.toTensor()}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G7=n4({unique_:function(t,e=0){const n=t4(t,"x","unique","string_or_numeric");y0(n.rank>0,(()=>"The input tensor must be at least 1D"));const r={x:n},s={axis:e},[o,i]=X2.runKernel("Unique",r,s);return{values:o,indices:i}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q7=n4({unsortedSegmentSum_:function(t,e,n){const r=t4(t,"x","unsortedSegmentSum"),s=t4(e,"segmentIds","unsortedSegmentSum","int32");y0(N0(n),(()=>"numSegments must be of dtype int"));const o={x:r,segmentIds:s},i={numSegments:n};return X2.runKernel("UnsortedSegmentSum",o,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H7=n4({unstack_:function(t,e=0){const n=t4(t,"x","unstack","string_or_numeric");y0(e>=-n.shape.length&&e<n.shape.length,(()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`));const r={value:n},s={axis:e};return X2.runKernel("Unpack",r,s)}});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K7(t,e){return p9(t,e,"right")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function X7(t,e){const n=[];for(let t=0;t<e.length;t++)e[t]&&n.push(t);const r=j4(t,"int32"),s=j4([n.length,t.length],"int32");for(let e=0;e<n.length;e++){const o=r.indexToLoc(n[e]),i=e*t.length;s.values.set(o,i)}return s.toTensor()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J7=async function(t){const e=t4(t,"condition","whereAsync","bool"),n=await e.data(),r=X7(e.shape,n);return t!==e&&e.dispose(),r};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y7=async function(t,e,n){const r=t4(t,"tensor","boolMask"),s=t4(e,"mask","boolMask","bool"),o=null==n?0:n,i=s.rank,a=r.shape;y0(i>0,(()=>"mask cannot be scalar")),g0(a.slice(o,o+i),s.shape,"mask's shape must match the first K dimensions of tensor's shape,");let u=1;for(let t=o;t<o+i;t++)u*=a[t];const c=a.slice(0,o).concat([u],a.slice(o+i)),l=C5(r,c),f=C5(s,[-1]),h=await J7(f),p=F7(h,[1]),d=W8(l,p,o);return t!==r&&r.dispose(),e!==s&&s.dispose(),p.dispose(),l.dispose(),f.dispose(),h.dispose(),d};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z7=n4({movingAverage_:function(t,e,n,r,s=!0){const o=t4(t,"v","movingAverage"),i=t4(e,"x","movingAverage"),a=t4(n,"decay","movingAverage");z2(o,i),y0(x0(o.shape,i.shape),(()=>"Shape mismatch in v and x"));const u=k8(1),c=i9(u,a);let l=s5(i9(i,o),c);if(s){y0(null!=r,(()=>"When using zeroDebias: true, step is required."));const t=t4(r,"step","movingAverage");l=r5(l,i9(u,T8(a,t)))}return e5(o,l)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q7=n4({scatterND_:function(t,e,n){const r=t4(t,"indices","scatterND","int32"),s=t4(e,"updates","scatterND");R6(s,r,n);const o={indices:r,updates:s},i={shape:n};return X2.runKernel("ScatterNd",o,i)}});const ttt=n4({sparseToDense_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r=0){const s=t4(t,"sparseIndices","sparseToDense","int32"),o=t4(e,"sparseValues","sparseToDense","string_or_numeric"),i=t4(r,"defaultValue","sparseToDense",o.dtype);!function(t,e,n,r){if("int32"!==t.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const s=t.rank>0?t.shape[0]:1,o=t.rank>1?t.shape[1]:1;if(n.length!==o)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${o}.`);const i=e.size;if(0!==e.rank&&(1!==e.rank||i!==s))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${s}]`);if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(s,o,n,i);const a={sparseIndices:s,sparseValues:o,defaultValue:i},u={outputShape:n};return X2.runKernel("SparseToDense",a,u)}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ett=n4({gatherND_:function(t,e){const n=t4(e,"indices","gatherND","int32"),r={params:t4(t,"x","gatherND","string_or_numeric"),indices:n};return X2.runKernel("GatherNd",r)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ntt=n4({dropout_:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e,n,r){const s=t4(t,"x","dropout");if(y0("float32"===s.dtype,(()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${s.dtype} tensor instead.`)),y0(e>=0&&e<1,(()=>`rate must be a float in the range [0, 1), but got ${e}.`)),0===e)return t instanceof O2?s.clone():s;const o=function(t,e){if(null==e)return t.shape.slice();if(x0(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let r=0;r<t.shape.length;r++)null==e[r]&&null!=t.shape[r]?n.push(t.shape[r]):n.push(e[r]);return n}return e}(s,n),i=1-e,a=r5(z8(e5(a7(o,0,1,"float32",r),i)),i);return s5(s,a)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rtt(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function stt(t,e,n){const r=1-t%2,s=new Float32Array(t);for(let o=0;o<t;++o){const i=2*Math.PI*o/(t+r-1);s[o]=e-n*Math.cos(i)}return z7(s,"float32")}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ott=async function(t,e,n=1){const r=t4(t,"predictions","inTopK"),s=t4(e,"targets","inTopK");y0(r.rank>1,(()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`)),y0(r.rank-1===s.rank,(()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${s.rank}`)),g0(r.shape.slice(0,r.shape.length-1),s.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const o=r.shape[r.shape.length-1];y0(n>0&&n<=o,(()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${o}), but got ${n}`));const i=await r.data(),a=await s.data(),[u,c]=[i.length/o,o],l=_0("bool",u);for(let t=0;t<u;t++){const e=t*c,r=i.subarray(e,e+c),s=[];for(let t=0;t<r.length;t++)s.push({value:r[t],index:t});s.sort(((t,e)=>e.value-t.value)),l[t]=0;for(let e=0;e<n;e++)if(s[e].index===a[t]){l[t]=1;break}}return t!==r&&r.dispose(),e!==s&&s.dispose(),o4(l,s.shape,"bool")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const itt=n4({conv2DBackpropFilter_:function(t,e,n,r,s,o="NHWC",i){let a=t;3===t.rank&&(a=C5(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=C5(e,[1,e.shape[0],e.shape[1],e.shape[2]])),y0(4===a.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`)),y0(4===u.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`)),y0(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const c="NHWC"===o?a.shape[3]:a.shape[1],l="NHWC"===o?u.shape[3]:u.shape[1];y0(c===n[2],(()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`)),y0(l===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${l}) must match output depth for filter (${n[3]}).`)),A5("conv2dDerFilter",s,i);const f={x:a,dy:u},h={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,filterShape:n};return X2.runKernel("Conv2DBackpropFilter",f,h)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function att(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return s5(t,P7(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function utt(t,e){let n=e;const r=N6(t.shape,e.shape);return r.length>0&&(n=O8(n,r)),C5(n,t.shape)}function ctt(t,e,n,r){if("linear"===e)return t;if("relu"===e)return l7(t);if("elu"===e)return v8(t);if("relu6"===e)return f7(t);if("prelu"===e)return P9(t,n);if("leakyrelu"===e)return K8(t,r);if("sigmoid"===e)return R5(t);throw new Error(`Unknown fused activation ${e}.`)}const ltt=(t,e)=>!(t>0)||"linear"===e;
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ftt=n4({fusedConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(u=u||"linear",!1===ltt(X2.state.gradientDepth,u)){y0("NHWC"===s,(()=>`Error in fused conv2d: got dataFormat of ${s} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`));let f=Z5(t,e,n,r,s,o,i);return null!=a&&(f=e5(f,a)),ctt(f,u,c,l)}const f=t4(t,"x","conv2d","float32"),h=t4(e,"filter","conv2d","float32");let p=f,d=!1;3===f.rank&&(d=!0,p=C5(f,[1,f.shape[0],f.shape[1],f.shape[2]])),y0(4===p.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`)),y0(4===h.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`)),A5("fused conv2d",r,i);const m="NHWC"===s?p.shape[3]:p.shape[1];y0(h.shape[2]===m,(()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${h.shape[2]}.`)),y0(T5(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));const y=w5(p.shape,h.shape,n,o,r,i);let g,b;if(null!=a&&(g=t4(a,"bias","fused conv2d"),[g]=V2(g,f),"NHWC"===s?$6(y.outShape,g.shape):(y0(g.shape.length<=1,(()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${g.shape.length}.`)),y0(0===g.shape.length||g.shape[0]===y.outChannels||1===g.shape[0],(()=>`Error in fused conv2d: bias shape (${g.shape}) is not compatible with the number of output channels (${y.outChannels})`)))),null!=c){const t=c.shape;if(y0(t.length<=1||3===t.length,(()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${t.length}.`)),1===t.length)y0(1===t[0]||t[0]===y.outChannels,(()=>`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the number of output channels (${y.outChannels}).`));else if(3===t.length)try{$6(t,y.outShape)}catch(e){const n=`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the output shape of the conv2d (${y.outShape}).`;throw Error(n)}b=t4(c,"prelu weights","fused conv2d")}const w=(t,e)=>{y0("NHWC"===s,(()=>`Error in gradient of fused conv2D: got dataFormat of ${s} but only NHWC is currently supported.`));const[i,a,c,l]=e,f=att(t,c,u);y0(_5(o),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`));const h=[t8(a.shape,f,i,n,r),itt(a,f,i.shape,n,r)];if(null!=l){const t=utt(l,f);h.push(t)}return h},v={x:p,filter:h,bias:g,preluActivationWeights:b},x={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=n9(((t,e,n)=>{let r=X2.runKernel("FusedConv2D",v,x);return n([e,t,r]),d&&(r=C5(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:w}}));return t(p,h)}{const t=n9(((t,e,n,r)=>{let s=X2.runKernel("FusedConv2D",v,x);return r([e,t,s,n]),d&&(s=C5(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:w}}));return t(p,h,g)}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const htt=n4({depthwiseConv2dNativeBackpropFilter_:function(t,e,n,r,s,o=[1,1],i){let a=t;3===t.rank&&(a=C5(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=C5(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:u},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,filterShape:n};return X2.runKernel("DepthwiseConv2dNativeBackpropFilter",c,l)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ptt=n4({depthwiseConv2dNativeBackpropInput_:function(t,e,n,r,s,o=[1,1],i){let a=e,u=!1;3===e.rank&&(u=!0,a=C5(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},l={strides:r,pad:s,dimRoundingMode:i,dilations:o,inputShape:t},f=X2.runKernel("DepthwiseConv2dNativeBackpropInput",c,l);return u?C5(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dtt=n4({fusedDepthwiseConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(!1===ltt(X2.state.gradientDepth,u)){let f=f8(t,e,n,r,s,o,i);return null!=a&&(f=e5(f,a)),ctt(f,u,c,l)}const f=t4(t,"x","depthwiseConv2d","float32"),h=t4(e,"filter","depthwiseConv2d","float32");let p=f,d=!1;3===f.rank&&(d=!0,p=C5(f,[1,f.shape[0],f.shape[1],f.shape[2]])),y0(4===p.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`)),y0(4===h.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`)),y0(p.shape[3]===h.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${p.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`)),null==o&&(o=[1,1]),y0(T5(n,o),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),A5("fused depthwiseConv2d",r,i);const m=w5(p.shape,h.shape,n,o,r,i,!0);let y,g;null!=a&&(y=t4(a,"bias","fused conv2d"),[y]=V2(y,f),$6(m.outShape,y.shape)),null!=c&&(g=t4(c,"prelu weights","fused depthwiseConv2d"));const b=(t,e)=>{y0(_5(o),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`));const[s,a,c,l]=e,f=att(t,c,u),h=ptt(a.shape,f,s,n,r,o,i),p=htt(a,f,s.shape,n,r,o,i);if(null!=l){return[h,p,utt(y,f)]}return[h,p]},w={x:p,filter:h,bias:y,preluActivationWeights:g},v={strides:n,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:u,leakyreluAlpha:l};if(null==a){const t=n9(((t,e,n)=>{let r=X2.runKernel("FusedDepthwiseConv2D",w,v);return n([e,t,r]),d&&(r=C5(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}}));return t(p,h)}{const t=n9(((t,e,n,r)=>{let s=X2.runKernel("FusedDepthwiseConv2D",w,v);return r([e,t,s,n]),d&&(s=C5(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:b}}));return t(p,h,y)}}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mtt=n4({fusedMatMul_:function({a:t,b:e,transposeA:n=!1,transposeB:r=!1,bias:s,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a}){if(!1===ltt(X2.state.gradientDepth,o)){let u=l6(t,e,n,r);return null!=s&&(u=e5(u,s)),ctt(u,o,i,a)}let u=t4(t,"a","fused matMul"),c=t4(e,"b","fused matMul");[u,c]=V2(u,c);const l=n?u.shape[u.rank-2]:u.shape[u.rank-1],f=r?c.shape[c.rank-1]:c.shape[c.rank-2],h=n?u.shape[u.rank-1]:u.shape[u.rank-2],p=r?c.shape[c.rank-2]:c.shape[c.rank-1],d=u.shape.slice(0,-2),m=c.shape.slice(0,-2),y=v0(d),g=v0(m);y0(l===f,(()=>`Error in fused matMul: inner shapes (${l}) and (${f}) of Tensors with shapes ${u.shape} and ${c.shape} and transposeA=${n} and transposeB=${r} must match.`));const b=$6(u.shape.slice(0,-2),c.shape.slice(0,-2)).concat([h,p]),w=C5(u,n?[y,l,h]:[y,h,l]),v=C5(c,r?[g,p,f]:[g,f,p]);let x,N;null!=s&&(x=t4(s,"bias","fused matMul"),[x]=V2(x,u),$6(b,x.shape)),null!=i&&(N=t4(i,"prelu weights","fused matMul"));const $=(t,e)=>{const[i,a,u,c]=e,l=att(C5(t,u.shape),u,o);let f,h;if(n||r?!n&&r?(f=l6(l,a,!1,!1),h=l6(l,i,!0,!1)):n&&!r?(f=l6(a,l,!1,!0),h=l6(i,l,!1,!1)):(f=l6(a,l,!0,!0),h=l6(l,i,!0,!0)):(f=l6(l,a,!1,!0),h=l6(i,l,!0,!1)),null!=s){return[f,h,utt(c,l)]}return[f,h]},E={a:w,b:v,bias:x,preluActivationWeights:N},S={transposeA:n,transposeB:r,activation:o,leakyreluAlpha:a};if(null==s){const t=n9(((t,e,n)=>{const r=X2.runKernel("_FusedMatMul",E,S);return n([t,e,r]),{value:C5(r,b),gradFunc:$}}));return t(w,v)}{const t=n9(((t,e,n,r)=>{const s=X2.runKernel("_FusedMatMul",E,S);return r([t,e,s,n]),{value:C5(s,b),gradFunc:$}}));return t(w,v,x)}}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ytt=Object.freeze({__proto__:null,conv2d:ftt,depthwiseConv2d:dtt,matMul:mtt});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gtt=n4({hammingWindow_:function(t){return stt(t,.54,.46)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const btt=n4({hannWindow_:function(t){return stt(t,.5,.5)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wtt=n4({frame_:function(t,e,n,r=!1,s=0){let o=0;const i=[];for(;o+e<=t.size;)i.push(D5(t,o,e)),o+=n;if(r)for(;o<t.size;){const r=o+e-t.size,a=M5([D5(t,o,e-r),V8([r],s)]);i.push(a),o+=n}return 0===i.length?W7([],[0,e]):C5(M5(i),[i.length,e])}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vtt=n4({stft_:function(t,e,n,r,s=btt){null==r&&(r=rtt(e));const o=wtt(t,e,n),i=s5(o,s(e));return R7(i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xtt=n4({cropAndResize_:function(t,e,n,r,s="bilinear",o=0){const i=t4(t,"image","cropAndResize"),a=t4(e,"boxes","cropAndResize","float32"),u=t4(n,"boxInd","cropAndResize","int32"),c=a.shape[0];y0(4===i.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`)),y0(2===a.rank&&4===a.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`)),y0(1===u.rank&&u.shape[0]===c,(()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`)),y0(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),y0(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),y0("bilinear"===s||"nearest"===s,(()=>`method must be bilinear or nearest, but was ${s}`));const l={image:i,boxes:a,boxInd:u},f={method:s,extrapolationValue:o,cropSize:r};return X2.runKernel("CropAndResize",l,f)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ntt=n4({flipLeftRight_:function(t){const e=t4(t,"image","flipLeftRight","float32");y0(4===e.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`));const n={image:e};return X2.runKernel("FlipLeftRight",n,{})}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $tt=n4({grayscaleToRGB_:function(t){const e=t4(t,"image","grayscaleToRGB"),n=e.rank-1,r=e.shape[n];y0(e.rank>=2,(()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`)),y0(1===r,(()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`));const s=new Array(e.rank);return s.fill(1,0,n),s[n]=3,P8(e,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ett=n4({rotateWithOffset_:function(t,e,n=0,r=.5){const s=t4(t,"image","rotateWithOffset","float32");y0(4===s.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${s.rank}.`));const o={image:s},i={radians:e,fillValue:n,center:r};return X2.runKernel("RotateWithOffset",o,i)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Stt(t,e,n,r,s,o){null==r&&(r=.5),null==s&&(s=Number.NEGATIVE_INFINITY),null==o&&(o=0);const i=t.shape[0];return n=Math.min(n,i),y0(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),y0(2===t.rank,(()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`)),y0(4===t.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`)),y0(1===e.rank,(()=>"scores must be a 1D tensor")),y0(e.shape[0]===i,(()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`)),y0(0<=o&&o<=1,(()=>`softNmsSigma must be in [0, 1], but was '${o}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:s,softNmsSigma:o}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _tt=n4({nonMaxSuppression_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const o=t4(t,"boxes","nonMaxSuppression","float32"),i=t4(e,"scores","nonMaxSuppression","float32"),a=Stt(o,i,n,r,s),u={maxOutputSize:n=a.maxOutputSize,iouThreshold:r=a.iouThreshold,scoreThreshold:s=a.scoreThreshold};return X2.runKernel("NonMaxSuppressionV3",{boxes:o,scores:i},u)}});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ttt(t,e,n){const r=function(t,e,n){return function(t,e,n){let r=0,s=t.length,o=0,i=!1;for(;r<s;){o=r+(s-r>>>1);const a=n(e,t[o]);a>0?r=o+1:(s=o,i=!a)}return i?r:-r-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(t,e,n||ktt)}(t,e,n),s=r<0?-(r+1):r;t.splice(s,0,e)}function ktt(t,e){return t>e?1:t<e?-1:0}function Att(t,e,n,r,s){return Itt(t,e,n,r,s,0)}function Ctt(t,e,n,r,s,o){return Itt(t,e,n,r,s,0,!1,o,!0)}function Ott(t,e,n,r,s,o){return Itt(t,e,n,r,s,o,!0)}function Itt(t,e,n,r,s,o,i=!1,a=!1,u=!1){const c=[];for(let t=0;t<e.length;t++)e[t]>s&&c.push({score:e[t],boxIndex:t,suppressBeginIndex:0});c.sort(Dtt);const l=o>0?-.5/o:0,f=[],h=[];for(;f.length<n&&c.length>0;){const e=c.pop(),{score:n,boxIndex:o,suppressBeginIndex:i}=e;if(n<s)break;let a=!1;for(let n=f.length-1;n>=i;--n){const i=Mtt(t,o,f[n]);if(i>=r){a=!0;break}if(e.score=e.score*Rtt(r,l,i),e.score<=s)break}e.suppressBeginIndex=f.length,a||(e.score===n?(f.push(o),h.push(e.score)):e.score>s&&Ttt(c,e,Dtt))}const p=f.length,d=n-p;a&&d>0&&(f.push(...new Array(d).fill(0)),h.push(...new Array(d).fill(0)));const m={selectedIndices:f};return i&&(m.selectedScores=h),u&&(m.validOutputs=p),m}function Mtt(t,e,n){const r=t.subarray(4*e,4*e+4),s=t.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(s[0],s[2]),l=Math.min(s[1],s[3]),f=Math.max(s[0],s[2]),h=Math.max(s[1],s[3]),p=(a-o)*(u-i),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;const m=Math.max(o,c),y=Math.max(i,l),g=Math.min(a,f),b=Math.min(u,h),w=Math.max(g-m,0)*Math.max(b-y,0);return w/(p+d-w)}function Rtt(t,e,n){const r=Math.exp(e*n*n);return n<=t?r:0}function Dtt(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ftt=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY){const o=t4(t,"boxes","nonMaxSuppressionAsync"),i=t4(e,"scores","nonMaxSuppressionAsync"),a=Stt(o,i,n,r,s);n=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;const u=await Promise.all([o.data(),i.data()]),c=u[0],l=u[1],{selectedIndices:f}=Att(c,l,n,r,s);return o!==t&&o.dispose(),i!==e&&i.dispose(),z7(f,"int32")};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ltt=n4({nonMaxSuppressionWithScore_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=t4(t,"boxes","nonMaxSuppression"),a=t4(e,"scores","nonMaxSuppression"),u=Stt(i,a,n,r,s,o),c={boxes:i,scores:a},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:s=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},f=X2.runKernel("NonMaxSuppressionV5",c,l);return{selectedIndices:f[0],selectedScores:f[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ptt=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=t4(t,"boxes","nonMaxSuppressionAsync"),a=t4(e,"scores","nonMaxSuppressionAsync"),u=Stt(i,a,n,r,s,o);n=u.maxOutputSize,r=u.iouThreshold,s=u.scoreThreshold,o=u.softNmsSigma;const c=await Promise.all([i.data(),a.data()]),l=c[0],f=c[1],{selectedIndices:h,selectedScores:p}=Ott(l,f,n,r,s,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:z7(h,"int32"),selectedScores:z7(p)}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Btt=n4({nonMaxSuppressionPadded_:function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=t4(t,"boxes","nonMaxSuppression"),a=t4(e,"scores","nonMaxSuppression"),u=Stt(i,a,n,r,s,null),c={boxes:i,scores:a},l={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:o},f=X2.runKernel("NonMaxSuppressionV4",c,l);return{selectedIndices:f[0],validOutputs:f[1]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vtt=async function(t,e,n,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=t4(t,"boxes","nonMaxSuppressionAsync"),a=t4(e,"scores","nonMaxSuppressionAsync"),u=Stt(i,a,n,r,s,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[h,p]=await Promise.all([i.data(),a.data()]),{selectedIndices:d,validOutputs:m}=Ctt(h,p,c,l,f,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:z7(d,"int32"),validOutputs:k8(m,"int32")}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ztt=n4({resizeBilinear_:function(t,e,n=!1,r=!1){const s=t4(t,"images","resizeBilinear");y0(3===s.rank||4===s.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${s.rank}.`)),y0(2===e.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`)),y0(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=C5(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=X2.runKernel("ResizeBilinear",a,u);return i?C5(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wtt=n4({resizeNearestNeighbor_:function(t,e,n=!1,r=!1){const s=t4(t,"images","resizeNearestNeighbor");y0(3===s.rank||4===s.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${s.rank}.`)),y0(2===e.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`)),y0("float32"===s.dtype||"int32"===s.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),y0(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let o=s,i=!1;3===s.rank&&(i=!0,o=C5(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},u={alignCorners:n,halfPixelCenters:r,size:e},c=X2.runKernel("ResizeNearestNeighbor",a,u);return i?C5(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Utt=n4({threshold_:function(t,e="binary",n=!1,r=.5){const s=t4(t,"image","threshold"),o=s.shape[0]*s.shape[1];let i,a,u,c,l=s5(z7([r]),255);if(y0(3===s.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${s.rank}.`)),y0(3===s.shape[2]||1===s.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${s.shape[2]}.`)),y0("int32"===s.dtype||"float32"===s.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${s.dtype}.`)),y0("otsu"===e||"binary"===e,(()=>`Method must be binary or otsu, but was ${e}`)),3===s.shape[2]){[i,a,u]=M7(s,[1,1,1],-1);const t=s5(i,.2989),e=s5(a,.587),n=s5(u,.114);c=e5(e5(t,e),n)}else c=t;if("otsu"===e){l=function(t,e){let n,r,s,o,i,a,u=z7([-1]),c=z7([0]),l=z7([0]);for(let f=0;f<t.size-1;f++){n=D5(t,0,f+1),r=D5(t,f+1),i=r5(O8(n),e),a=r5(O8(r),e);const h=O8(s5(n,u7(0,n.size)));s=r5(h,O8(n));const p=V8(r.shape,n.size),d=e5(u7(0,r.size),p),m=s5(r,d);o=r5(O8(m),O8(r));const y=i9(s,o),g=i9(s,o),b=s5(i,a);l=s5(s5(b,y),g);const w=U8(l,c);c=m8(w,l,c),u=m8(w,z7([f]),u)}return u}(U5(G4(g7(c),"int32"),o4([]),256),o)}const f=n?J8(c,l):U8(c,l);return G4(s5(f,255),"int32")}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jtt=n4({transform_:function(t,e,n="nearest",r="constant",s=0,o){const i=t4(t,"image","transform","float32"),a=t4(e,"transforms","transform","float32");y0(4===i.rank,(()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`)),y0(2===a.rank&&(a.shape[0]===i.shape[0]||1===a.shape[0])&&8===a.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),y0(null==o||2===o.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`));const u={image:i,transforms:a},c={interpolation:n,fillMode:r,fillValue:s,outputShape:o};return X2.runKernel("Transform",u,c)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gtt=n4({bandPart_:function(t,e,n){y0(e%1==0,(()=>`bandPart(): numLower must be an integer, got ${e}.`)),y0(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`));const r=t4(t,"a","bandPart");y0(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));const s=r.shape,[o,i]=r.shape.slice(-2);if(!(e<=o))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`);if(!(n<=i))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${i}).`);e<0&&(e=o),n<0&&(n=i);const a=C5(u7(0,o,1,"int32"),[-1,1]),u=u7(0,i,1,"int32"),c=i9(a,u),l=c9(J8(c,k8(+e,"int32")),j8(c,k8(-n,"int32"))),f=v9([o,i],r.dtype);return C5(L7(H7(C5(r,[-1,o,i])).map((t=>m8(l,t,f)))),s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qtt=n4({gramSchmidt_:function(t){let e;if(Array.isArray(t)){e=!1,y0(null!=t&&t.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=t[0].shape[0];for(let e=1;e<t.length;++e)y0(t[e].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[e].shape[0]} vs. ${n})`))}else e=!0,t=M7(t,t.shape[0],0).map((t=>F7(t,[0])));y0(t.length<=t[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`));const n=[],r=t;for(let e=0;e<t.length;++e)n.push(X2.tidy((()=>{let t=r[e];if(e>0)for(let r=0;r<e;++r){const e=s5(O8(s5(n[r],t)),n[r]);t=i9(t,e)}return r5(t,M8(t,"euclidean"))})));return e?L7(n,0):n}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Htt(t,e=!1){return X2.tidy((()=>{y0(2===t.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`));const n=t.shape[0],r=t.shape[1];let s=B8(n),o=q4(t);const i=W7([[1]],[1,1]);let a=q4(i);const u=n>=r?r:n;for(let t=0;t<u;++t){const e=o,u=a,c=s;[a,o,s]=X2.tidy((()=>{const e=D5(o,[t,t],[n-t,1]),u=M8(e),c=D5(o,[t,t],[1,1]),l=m8(U8(c,0),W7([[-1]]),W7([[1]])),f=i9(c,s5(l,u)),h=r5(e,f);a=1===h.shape[0]?q4(i):M5([i,D5(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);const p=y6(r5(l6(l,f),u)),d=D5(o,[t,0],[n-t,r]),m=s5(p,a),y=b6(a);if(0===t)o=i9(d,l6(m,l6(y,d)));else{const e=i9(d,l6(m,l6(y,d)));o=M5([D5(o,[0,0],[t,r]),e],0)}const g=b6(m),b=D5(s,[0,t],[n,s.shape[1]-t]);if(0===t)s=i9(b,l6(l6(b,a),g));else{const e=i9(b,l6(l6(b,a),g));s=M5([D5(s,[0,0],[n,t]),e],1)}return[a,o,s]})),p6([e,u,c])}return!e&&n>r&&(s=D5(s,[0,0],[n,r]),o=D5(o,[0,0],[r,r])),[s,o]}))}const Ktt=n4({qr_:function(t,e=!1){if(y0(t.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`)),2===t.rank)return Htt(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce(((t,e)=>t*e)),r=H7(C5(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),s=[],o=[];r.forEach((t=>{const[n,r]=Htt(t,e);s.push(n),o.push(r)}));return[C5(L7(s,0),t.shape),C5(L7(o,0),t.shape)]}}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Xtt;!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Xtt||(Xtt={}));const Jtt=n4({computeWeightedLoss_:function(t,e,n=Xtt.SUM_BY_NONZERO_WEIGHTS){const r=t4(t,"losses","computeWeightedLoss");let s=null;null!=e&&(s=t4(e,"weights","computeWeightedLoss"));const o=null==s?r:s5(r,s);if(n===Xtt.NONE)return o;if(n===Xtt.SUM)return O8(o);if(n===Xtt.MEAN){if(null==s)return w9(o);{const t=r.size/s.size,e=r5(O8(o),O8(s));return t>1?r5(e,k8(t)):e}}if(n===Xtt.SUM_BY_NONZERO_WEIGHTS){if(null==s)return r5(O8(o),k8(r.size));{const t=s5(s,x9(r.shape)),e=G4(O8(k9(t,k8(0))),"float32");return r5(O8(o),e)}}throw Error(`Unknown reduction: ${n}`)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ytt=n4({absoluteDifference_:function(t,e,n,r=Xtt.SUM_BY_NONZERO_WEIGHTS){const s=t4(t,"labels","absoluteDifference"),o=t4(e,"predictions","absoluteDifference");let i=null;null!=n&&(i=t4(n,"weights","absoluteDifference")),g0(s.shape,o.shape,"Error in absoluteDifference: ");const a=o5(i9(s,o));return Jtt(a,i,r)}});const Ztt=n4({cosineDistance_:function(t,e,n,r,s=Xtt.SUM_BY_NONZERO_WEIGHTS){const o=t4(t,"labels","cosineDistance"),i=t4(e,"predictions","cosineDistance");let a=null;null!=r&&(a=t4(r,"weights","cosineDistance")),g0(o.shape,i.shape,"Error in cosineDistance: ");const u=k8(1),c=i9(u,O8(s5(o,i),n,!0));return Jtt(c,a,s)}});const Qtt=n4({hingeLoss_:function(t,e,n,r=Xtt.SUM_BY_NONZERO_WEIGHTS){let s=t4(t,"labels","hingeLoss");const o=t4(e,"predictions","hingeLoss");let i=null;null!=n&&(i=t4(n,"weights","hingeLoss")),g0(s.shape,o.shape,"Error in hingeLoss: ");const a=k8(1);s=i9(s5(k8(2),s),a);const u=l7(i9(a,s5(s,o)));return Jtt(u,i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tet=n4({huberLoss_:function(t,e,n,r=1,s=Xtt.SUM_BY_NONZERO_WEIGHTS){const o=t4(t,"labels","huberLoss"),i=t4(e,"predictions","huberLoss");let a=null;null!=n&&(a=t4(n,"weights","huberLoss")),g0(o.shape,i.shape,"Error in huberLoss: ");const u=k8(r),c=o5(i9(i,o)),l=N9(c,u),f=i9(c,l),h=e5(s5(k8(.5),C8(l)),s5(u,f));return Jtt(h,a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eet=n4({logLoss_:function(t,e,n,r=1e-7,s=Xtt.SUM_BY_NONZERO_WEIGHTS){const o=t4(t,"labels","logLoss"),i=t4(e,"predictions","logLoss");let a=null;null!=n&&(a=t4(n,"weights","logLoss")),g0(o.shape,i.shape,"Error in logLoss: ");const u=k8(1),c=k8(r),l=y6(s5(o,Q8(e5(i,c)))),f=s5(i9(u,o),Q8(e5(i9(u,i),c))),h=i9(l,f);return Jtt(h,a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const net=n4({meanSquaredError_:function(t,e,n,r=Xtt.SUM_BY_NONZERO_WEIGHTS){const s=t4(t,"labels","meanSquaredError"),o=t4(e,"predictions","meanSquaredError");let i=null;null!=n&&(i=t4(n,"weights","meanSquaredError")),g0(s.shape,o.shape,"Error in meanSquaredError: ");const a=D7(s,o);return Jtt(a,i,r)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ret=n4({sigmoidCrossEntropy_:function(t,e,n,r=0,s=Xtt.SUM_BY_NONZERO_WEIGHTS){let o=t4(t,"multiClassLabels","sigmoidCrossEntropy");const i=t4(e,"logits","sigmoidCrossEntropy");let a=null;if(null!=n&&(a=t4(n,"weights","sigmoidCrossEntropy")),g0(o.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){const t=k8(r),e=k8(1),n=k8(.5);o=e5(s5(o,i9(e,t)),s5(n,t))}const u=function(t,e){const n=t4(t,"labels","sigmoidCrossEntropyWithLogits"),r=t4(e,"logits","sigmoidCrossEntropyWithLogits");g0(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const s=l7(r),o=s5(r,n),i=t9(D8(y6(o5(r))));return e5(i9(s,o),i)}(o,i);return Jtt(u,a,s)}});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const set=n4({softmaxCrossEntropy_:function(t,e,n,r=0,s=Xtt.SUM_BY_NONZERO_WEIGHTS){let o=t4(t,"onehotLabels","softmaxCrossEntropy");const i=t4(e,"logits","softmaxCrossEntropy");let a=null;if(null!=n&&(a=t4(n,"weights","softmaxCrossEntropy")),g0(o.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){const t=k8(r),e=k8(1),n=k8(o.shape[1]);o=e5(s5(o,i9(e,t)),r5(t,n))}const u=function(t,e,n=-1){if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);const r=n9(((t,e,r)=>{const s=u9(e,[n],!0),o=i9(G4(e,"float32"),s);r([t,o]);const i=y6(s5(o,t));return{value:O8(i,[n]),gradFunc:(t,e)=>{const[r,s]=e,o=E8(t.shape,[n]);return[s5(C5(t,o),i9(G4(r,"float32"),D8(s))),s5(C5(t,o),i9(D8(s),G4(r,"float32")))]}}}));return r(t,e)}(o,i);return Jtt(u,a,s)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oet=n4({sparseFillEmptyRows_:function(t,e,n,r){const s=t4(t,"indices","sparseFillEmptyRows","int32"),o=t4(e,"values","sparseFillEmptyRows"),i=t4(n,"denseShape","sparseFillEmptyRows","int32"),a=t4(r,"defaultValue","sparseFillEmptyRows",o.dtype);if(2!==s.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${s.shape}`);if(1!==o.rank)throw new Error(`Values should be Tensor1D but received shape ${o.shape}`);if(1!==i.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${i.shape}`);if(0!==a.rank)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const u={indices:s,values:o,denseShape:i,defaultValue:a},c=X2.runKernel("SparseFillEmptyRows",u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iet=n4({sparseReshape_:function(t,e,n){const r=t4(t,"inputIndices","sparseReshape","int32"),s=t4(e,"inputShape","sparseReshape","int32"),o=t4(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==s.rank)throw new Error(`Input shape should be Tensor1D but received shape ${s.shape}`);if(1!==o.rank)throw new Error(`New shape should be Tensor1D but received shape ${o.shape}`);const i={inputIndices:r,inputShape:s,newShape:o},a=X2.runKernel("SparseReshape",i);return{outputIndices:a[0],outputShape:a[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aet=n4({sparseSegmentMean_:function(t,e,n){const r=t4(t,"data","sparseSegmentMean"),s=t4(e,"indices","sparseSegmentMean","int32"),o=t4(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return X2.runKernel("SparseSegmentMean",i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uet=n4({sparseSegmentSum_:function(t,e,n){const r=t4(t,"data","sparseSegmentSum"),s=t4(e,"indices","sparseSegmentSum","int32"),o=t4(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==s.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${s.shape}`);if(1!==o.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${o.shape}`);const i={data:r,indices:s,segmentIds:o};return X2.runKernel("SparseSegmentSum",i)}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cet=n4({stringNGrams_:function(t,e,n,r,s,o,i,a){const u=t4(t,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error(`Data must be a vector, saw: ${u.shape}`);const c=t4(e,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");const l={separator:n,nGramWidths:r,leftPad:s,rightPad:o,padWidth:i,preserveShortSequences:a},f={data:u,dataSplits:c},h=X2.runKernel("StringNGrams",f,l);return{nGrams:h[0],nGramsSplits:h[1]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fet=n4({stringSplit_:function(t,e,n=!0){const r=t4(t,"input","stringSplit","string"),s=t4(e,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(0!==s.rank)throw new Error(`Delimiter should be a scalar but received shape ${s.shape}`);const o={skipEmpty:n},i={input:r,delimiter:s},a=X2.runKernel("StringSplit",i,o);return{indices:a[0],values:a[1],shape:a[2]}}});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const het=n4({stringToHashBucketFast_:function(t,e){const n=t4(t,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const s={input:n};return X2.runKernel("StringToHashBucketFast",s,r)}}),pet={fft:C7,ifft:O7,rfft:R7,irfft:I7},det={hammingWindow:gtt,hannWindow:btt,frame:wtt,stft:vtt},met={flipLeftRight:Ntt,grayscaleToRGB:$tt,resizeNearestNeighbor:Wtt,resizeBilinear:ztt,rotateWithOffset:Ett,cropAndResize:xtt,nonMaxSuppression:_tt,nonMaxSuppressionAsync:Ftt,nonMaxSuppressionWithScore:Ltt,nonMaxSuppressionWithScoreAsync:Ptt,nonMaxSuppressionPadded:Btt,nonMaxSuppressionPaddedAsync:Vtt,threshold:Utt,transform:jtt},yet={bandPart:Gtt,gramSchmidt:qtt,qr:Ktt},get={absoluteDifference:Ytt,computeWeightedLoss:Jtt,cosineDistance:Ztt,hingeLoss:Qtt,huberLoss:tet,logLoss:eet,meanSquaredError:net,sigmoidCrossEntropy:ret,softmaxCrossEntropy:set},bet={sparseFillEmptyRows:oet,sparseReshape:iet,sparseSegmentMean:aet,sparseSegmentSum:uet},wet={stringNGrams:cet,stringSplit:fet,stringToHashBucketFast:het};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class vet extends H6{minimize(t,e=!1,n){const{value:r,grads:s}=this.computeGradients(t,n);if(null!=n){const t=n.map((t=>({name:t.name,tensor:s[t.name]})));this.applyGradients(t)}else this.applyGradients(s);return p6(s),e?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return e9(t,e)}dispose(){null!=this.iterations_&&p6(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:k8(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(vet,Symbol.hasInstance,{value:t=>null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class xet extends vet{constructor(t,e,n=null){super(),this.learningRate=t,this.rho=e,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=X2.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=X2.registeredVariables[e];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${e}/accum_grad`,variable:h6((()=>y8(r).variable(false)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${e}/accum_var`,variable:h6((()=>y8(r).variable(false)))});const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const o=this.accumulatedGrads[n].variable,i=this.accumulatedUpdates[n].variable;h6((()=>{const t=e5(s5(o,this.rho),s5(C8(s),1-this.rho)),e=s5(r5(A8(e5(i,this.epsilon)),A8(e5(o,this.epsilon))),s),n=e5(s5(i,this.rho),s5(C8(e),1-this.rho));o.assign(t),i.assign(n);const a=e5(s5(e,-this.learningRate),r);r.assign(a)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(p6(this.accumulatedGrads.map((t=>t.variable))),p6(this.accumulatedUpdates.map((t=>t.variable))))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){const e=(t=await this.extractIterations(t)).length/2;this.accumulatedGrads=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedUpdates=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}xet.className="Adadelta",X6(xet);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Net extends vet{constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=X2.registeredVariables[e];if(null==this.accumulatedGrads[n]){const t=!1;this.accumulatedGrads[n]={originalName:`${e}/accumulator`,variable:h6((()=>V8(r.shape,this.initialAccumulatorValue).variable(t)))}}const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const o=this.accumulatedGrads[n].variable;h6((()=>{const t=e5(o,C8(s));o.assign(t);const e=e5(s5(r5(s,A8(e5(t,X2.backend.epsilon()))),-this.learningRate),r);r.assign(e)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&p6(this.accumulatedGrads.map((t=>t.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulatedGrads=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}Net.className="Adagrad",X6(Net);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class $et extends vet{constructor(t,e,n,r=null){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],h6((()=>{this.accBeta1=k8(e).variable(),this.accBeta2=k8(n).variable()})),null==r&&(this.epsilon=X2.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);h6((()=>{const n=i9(1,this.accBeta1),r=i9(1,this.accBeta2);e.forEach(((e,s)=>{const o=X2.registeredVariables[e];null==this.accumulatedFirstMoment[s]&&(this.accumulatedFirstMoment[s]={originalName:`${e}/m`,variable:h6((()=>y8(o).variable(false)))}),null==this.accumulatedSecondMoment[s]&&(this.accumulatedSecondMoment[s]={originalName:`${e}/v`,variable:h6((()=>y8(o).variable(false)))});const i=Array.isArray(t)?t[s].tensor:t[e];if(null==i)return;const a=this.accumulatedFirstMoment[s].variable,u=this.accumulatedSecondMoment[s].variable,c=e5(s5(a,this.beta1),s5(i,1-this.beta1)),l=e5(s5(u,this.beta2),s5(C8(i),1-this.beta2)),f=r5(c,n),h=r5(l,r);a.assign(c),u.assign(l);const p=e5(s5(r5(f,e5(A8(h),this.epsilon)),-this.learningRate),o);o.assign(p)})),this.accBeta1.assign(s5(this.accBeta1,this.beta1)),this.accBeta2.assign(s5(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&p6(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedSecondMoment&&p6(this.accumulatedSecondMoment.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t),h6((()=>{this.accBeta1.assign(T8(this.beta1,this.iterations_+1)),this.accBeta2.assign(T8(this.beta2,this.iterations_+1))}));const e=t.length/2;this.accumulatedFirstMoment=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedSecondMoment=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}$et.className="Adam",X6($et);
/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/
class Eet extends vet{constructor(t,e,n,r=null,s=0){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],h6((()=>{this.iteration=k8(0).variable(),this.accBeta1=k8(e).variable()})),null==r&&(this.epsilon=X2.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);h6((()=>{const n=i9(1,this.accBeta1),r=r5(-this.learningRate,e5(s5(this.iteration,this.decay),1));e.forEach(((e,s)=>{const o=X2.registeredVariables[e];null==this.accumulatedFirstMoment[s]&&(this.accumulatedFirstMoment[s]={originalName:`${e}/m`,variable:y8(o).variable(false)}),null==this.accumulatedWeightedInfNorm[s]&&(this.accumulatedWeightedInfNorm[s]={originalName:`${e}/v`,variable:y8(o).variable(false)});const i=Array.isArray(t)?t[s].tensor:t[e];if(null==i)return;const a=this.accumulatedFirstMoment[s].variable,u=this.accumulatedWeightedInfNorm[s].variable,c=e5(s5(a,this.beta1),s5(i,1-this.beta1)),l=s5(u,this.beta2),f=o5(i),h=b9(l,f);a.assign(c),u.assign(h);const p=e5(s5(r5(r,n),r5(c,e5(h,this.epsilon))),o);o.assign(p)})),this.iteration.assign(e5(this.iteration,1)),this.accBeta1.assign(s5(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&p6(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedWeightedInfNorm&&p6(this.accumulatedWeightedInfNorm.map((t=>t.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}Eet.className="Adamax",X6(Eet);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class _et extends vet{constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);e.forEach(((e,n)=>{const r=Array.isArray(t)?t[n].tensor:t[e];if(null==r)return;const s=X2.registeredVariables[e];h6((()=>{const t=e5(s5(this.c,r),s);s.assign(t)}))})),this.incrementIterations()}setLearningRate(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=d6(k8(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(0!==(t=await this.extractIterations(t)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}_et.className="SGD",X6(_et);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Tet extends _et{constructor(t,e,n=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=n,this.accumulations=[],this.m=k8(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=X2.registeredVariables[e];if(null==this.accumulations[n]){const t=!1;this.accumulations[n]={originalName:`${e}/momentum`,variable:h6((()=>y8(r).variable(t)))}}const s=this.accumulations[n].variable,o=Array.isArray(t)?t[n].tensor:t[e];null!=o&&h6((()=>{let t;const e=e5(s5(this.m,s),o);t=this.useNesterov?e5(s5(this.c,e5(o,s5(e,this.m))),r):e5(s5(this.c,e),r),s.assign(e),r.assign(t)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&p6(this.accumulations.map((t=>t.variable)))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulations=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}Tet.className="Momentum",X6(Tet);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class ket extends vet{constructor(t,e=.9,n=0,r=null,s=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,null==r&&(this.epsilon=X2.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=X2.registeredVariables[e],s=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${e}/rms`,variable:h6((()=>y8(r).variable(s)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${e}/momentum`,variable:h6((()=>y8(r).variable(s)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${e}/mg`,variable:h6((()=>y8(r).variable(s)))});const o=Array.isArray(t)?t[n].tensor:t[e];if(null==o)return;const i=this.accumulatedMeanSquares[n].variable,a=this.accumulatedMoments[n].variable;h6((()=>{const t=e5(s5(i,this.decay),s5(C8(o),1-this.decay));if(this.centered){const e=this.accumulatedMeanGrads[n].variable,s=e5(s5(e,this.decay),s5(o,1-this.decay)),u=r5(s5(o,this.learningRate),A8(i9(t,e5(C8(s),this.epsilon)))),c=e5(s5(a,this.momentum),u);i.assign(t),e.assign(s),a.assign(c);const l=i9(r,c);r.assign(l)}else{const t=e5(s5(i,this.decay),s5(C8(o),1-this.decay)),e=e5(s5(a,this.momentum),r5(s5(o,this.learningRate),A8(e5(t,this.epsilon))));i.assign(t),a.assign(e);const n=i9(r,e);r.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&p6(this.accumulatedMeanSquares.map((t=>t.variable))),null!=this.accumulatedMeanGrads&&this.centered&&p6(this.accumulatedMeanGrads.map((t=>t.variable))),null!=this.accumulatedMoments&&p6(this.accumulatedMoments.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,n=!1;this.accumulatedMeanSquares=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.accumulatedMoments=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}ket.className="RMSProp",X6(ket);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Aet{static sgd(t){return new _et(t)}static momentum(t,e,n=!1){return new Tet(t,e,n)}static rmsprop(t,e=.9,n=0,r=null,s=!1){return new ket(t,e,n,r,s)}static adam(t=.001,e=.9,n=.999,r=null){return new $et(t,e,n,r)}static adadelta(t=.001,e=.95,n=null){return new xet(t,e,n)}static adamax(t=.002,e=.9,n=.999,r=null,s=0){return new Eet(t,e,n,r,s)}static adagrad(t,e=.1){return new Net(t,e)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cet={sgd:Aet.sgd,momentum:Aet.momentum,adadelta:Aet.adadelta,adagrad:Aet.adagrad,rmsprop:Aet.rmsprop,adamax:Aet.adamax,adam:Aet.adam},Oet="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:t=>t();
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Iet=/->/g;function Met(t,e){const n=[];for(let r=0;r<t.length;++r)0!==t[r].length&&-1===t[r].indexOf(e)&&-1!==e||n.push(r);return n}var Ret=Object.freeze({__proto__:null,segOpComputeOptimalWindowSize:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){let n,r=!1;for(t<=30?(n=t,r=!0):n=P0(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=P0(t,n+1);return n},computeOutShape:function(t,e,n){const r=[],s=t.length;for(let o=0;o<s;o++)o!==e?r.push(t[o]):r.push(n);return r},collectGatherOpShapeInfo:function(t,e,n,r){const s=e.shape.length,o=t.shape.length;if(0!==r&&(r<-s||r>s))throw new Error(`Expect batchDims in the range of [-${s}, ${s}], but got ${r}`);if(r<0&&(r+=s),r>o)throw new Error(`batchDims (${r}) must be less than rank(x) (\n    ${o}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let n=0;n<r;++n)if(t.shape[n]!==e.shape[n])throw new Error(`x.shape[${n}]: ${t.shape[n]} should be equal to indices.shape[${n}]: ${e.shape[n]}.`);const i=t.shape[n],a=[];let u=1,c=1,l=1;for(let e=0;e<r;++e)a.push(t.shape[e]),u*=t.shape[e];for(let e=r;e<n;e++)a.push(t.shape[e]),c*=t.shape[e];for(let t=r;t<s;t++)a.push(e.shape[t]);for(let e=n+1;e<o;e++)a.push(t.shape[e]),l*=t.shape[e];return{batchSize:u,sliceSize:l,outerSize:c,dimSize:i,outputShape:a}}});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Det=Object.freeze({__proto__:null,slice_util:q6,segment_util:Ret,fromUint8ToStringArray:function(t){try{return t.map((t=>b2(t)))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}},fromStringArrayToUint8:function(t){return t.map((t=>g2(t)))},upcastType:B2,axesAreInnerMostDims:N8,combineLocations:$8,computeOutAndReduceShapes:function(t,e){const n=[],r=t.length;for(let s=0;s<r;s++)-1===e.indexOf(s)&&n.push(t[s]);return[n,e.map((e=>t[e]))]},expandShapeToKeepDim:E8,assertAxesAreInnerMostDims:function(t,e,n){y0(N8(e,n),(()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`))},getAxesPermutation:function(t,e){if(N8(t,e))return null;const n=[];for(let r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach((t=>n.push(t))),n},getUndoAxesPermutation:function(t){return t.map(((t,e)=>[e,t])).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]))},getInnerMostAxes:function(t,e){const n=[];for(let r=e-t;r<e;++r)n.push(r);return n},getBroadcastDims:x6,getReductionAxes:N6,assertAndGetBroadcastShape:$6,assertParamsConsistent:
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){const n=t[0].length;t.forEach(((t,e)=>{y0(t.length===n,(()=>`Error in concat${n}D: rank of tensors[${e}] must be the same as the rank of the rest (${n})`))})),y0(e>=0&&e<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));const r=t[0];t.forEach(((t,s)=>{for(let o=0;o<n;o++)y0(o===e||t[o]===r[o],(()=>`Error in concat${n}D: Shape of tensors[${s}] (${t}) does not match the shape of the rest (${r}) along the non-concatenated axis ${s}.`))}))},computeOutShape:function(t,e){const n=t[0].slice();for(let r=1;r<t.length;r++)n[e]+=t[r][e];return n}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,computeDilation2DInfo:function(t,e,n,r,s="NHWC",o){return w5(t,[...e,t[3]],n,o,r,null,null,k5(s))},computePool2DInfo:b5,computePool3DInfo:function(t,e,n,r,s,o,i="NDHWC"){const[a,u,c]=$5(e);let l,f;if("NDHWC"===i)f="channelsLast",l=[a,u,c,t[4],t[4]];else{if("NCDHW"!==i)throw new Error(`Unknown dataFormat ${i}`);f="channelsFirst",l=[a,u,c,t[1],t[1]]}return v5(t,l,n,r,s,!1,f,o)},computeConv2DInfo:w5,computeConv3DInfo:v5,computeDefaultPad:x5,tupleValuesAreOne:_5,eitherStridesOrDilationsAreOne:T5,convertConv2DDataFormat:k5,checkPadOnDimRoundingMode:A5,getFusedDyActivation:att,getFusedBiasGradient:utt,applyActivation:ctt,shouldFuse:ltt,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:function(t){return t<=30?t:P0(t,Math.floor(Math.sqrt(t)))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getImageCenter:function(t,e,n){return[n*("number"==typeof t?t:t[0]),e*("number"==typeof t?t:t[1])]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getReshaped:function(t,e,n,r=!0){let s=[];if(r)s=s.concat(e.slice(0)),s.push(t[0]/n),s=s.concat(t.slice(1));else{s=s.concat(t[0]);const n=e.length;for(let r=0;r<n;++r)s=s.concat([t[r+1]/e[r],e[r]]);s=s.concat(t.slice(n+1))}return s},getPermuted:function(t,e,n=!0){const r=[];if(n){r.push(e);for(let n=e+1;n<t;++n)n<=2*e?(r.push(n),r.push(n-(e+1))):r.push(n)}else{const n=[],s=[];for(let r=1;r<t;++r)r>=2*e+1||r%2==1?s.push(r):n.push(r);r.push(...n),r.push(0),r.push(...s)}return r},getReshapedPermuted:function(t,e,n,r=!0){const s=[];r?s.push(t[0]/n):s.push(t[0]*n);for(let n=1;n<t.length;++n)n<=e.length?r?s.push(e[n-1]*t[n]):s.push(t[n]/e[n-1]):s.push(t[n]);return s},getSliceBeginCoords:function(t,e){const n=[0];for(let r=0;r<e;++r)n.push(t[r][0]);return n},getSliceSize:function(t,e,n){const r=t.slice(0,1);for(let s=0;s<n;++s)r.push(t[s+1]-e[s][0]-e[s][1]);return r}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,prepareAndValidate:O6,validateUpdateShape:M6,validateInput:R6,calculateShapes:D6,SELU_SCALEALPHA:1.7580993408473768,SELU_SCALE:1.0507009873554805,ERF_P:.3275911,ERF_A1:.254829592,ERF_A2:-.284496736,ERF_A3:1.421413741,ERF_A4:-1.453152027,ERF_A5:1.061405429,warn:E1,log:function(...t){K0().getBool("IS_TEST")||K0().getBool("PROD")||console.log(...t)},mergeRealAndImagArrays:
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(2*t.length);for(let r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n},splitRealAndImagArrays:function(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}},complexWithEvenIndex:function(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=0;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}},complexWithOddIndex:function(t){const e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=2;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}},getComplexWithIndex:function(t,e){return{real:t[2*e],imag:t[2*e+1]}},assignToTypedArray:function(t,e,n,r){t[2*r]=e,t[2*r+1]=n},exponents:function(t,e){const n=new Float32Array(t/2),r=new Float32Array(t/2);for(let s=0;s<Math.ceil(t/2);s++){const o=(e?2:-2)*Math.PI*(s/t);n[s]=Math.cos(o),r[s]=Math.sin(o)}return{real:n,imag:r}},exponent:function(t,e,n){const r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}},decodeEinsumEquation:function(t,e){const n=((t=t.replace(/\s/g,"")).length-t.replace(Iet,"").length)/"->".length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("->").');const[r,s]=t.split("->");y0(-1===r.indexOf("..."),(()=>'The ellipsis notation ("...") is not supported yet.'));const o=r.split(","),i=o.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let t=0;t<s.length;++t){const e=s[t];if(!o.some((t=>-1!==t.indexOf(e))))throw new Error(`Output subscripts contain the label ${e} not present in the input subscripts.`);-1===a.indexOf(e)&&a.push(e)}for(let t=0;t<r.length;++t){const e=r[t];-1===a.indexOf(e)&&","!==e&&a.push(e)}const u=new Array(o.length);for(let t=0;t<i;++t){if(new Set(o[t].split("")).size!==o[t].length)throw new Error(`Found duplicate axes in input component ${o[t]}. Support for duplicate axes in input is not implemented yet.`);u[t]=[];for(let e=0;e<o[t].length;++e)u[t].push(a.indexOf(o[t][e]))}const c=a.length,l=[];for(let t=s.length;t<c;++t)l.push(t);return{allDims:a,summedDims:l,idDims:u}},getEinsumPermutation:function(t,e){let n=new Array(t);n.fill(-1);for(let t=0;t<e.length;++t)n[e[t]]=t;const r=[];for(let e=0;e<t;++e)-1===n[e]&&r.push(e);return n=n.filter((t=>-1!==t)),{permutationIndices:n,expandDims:r}},checkEinsumDimSizes:function(t,e,n){const r=new Array(t);for(let t=0;t<n.length;++t){const s=n[t].shape;for(let n=0;n<e[t].length;++n)void 0===r[e[t][n]]?r[e[t][n]]=s[n]:y0(r[e[t][n]]===s[n],(()=>`Expected dimension ${r[e[t][n]]} at axis ${n} of input shaped ${JSON.stringify(s)}, but got dimension ${s[n]}`))}},getEinsumComputePath:function(t,e){const n=t,r=[];let s=0;0===t.length&&n.push(-1),s=t.length+1;for(let t=0;t<s;++t)r.push([]);const o=[];for(let t=0;t<n.length;++t){const s=Met(e,n[t]);for(const e of s)-1===o.indexOf(e)&&(r[t].push(e),o.push(e))}return{path:n,steps:r}},isIdentityPermutation:function(t){return t.every(((t,e)=>t===e))},prepareSplitSize:function(t,e,n=0){let r=[];if("number"==typeof e)y0(t.shape[n]%e==0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(e).fill(t.shape[n]/e);else{y0(e.reduce(((t,e)=>(-1===e&&(t+=1),t)),0)<=1,(()=>"There should be only one negative value in split array."));const s=e.indexOf(-1);if(-1!==s){const r=e.reduce(((t,e)=>e>0?t+e:t));e[s]=t.shape[n]-r}y0(t.shape[n]===e.reduce(((t,e)=>t+e)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=e}return r}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getSparseFillEmptyRowsIndicesDenseShapeMismatch:function(t){return`Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ${t}`},getSparseFillEmptyRowsNegativeIndexErrorMessage:function(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`},getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:function(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:function(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`},getSparseReshapeNegativeOutputDimErrorMessage:function(t,e){return`size ${t} must be non-negative, not ${e}`},getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:function(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"},getSparseReshapeInputOutputMultipleErrorMessage:function(t,e){return`Input to reshape is a SparseTensor with ${v0(t)}\n  dense values, but the requested shape requires a multiple of ${v0(e)}. inputShape=${t} outputShape= ${e}`},getSparseReshapeInputOutputMismatchErrorMessage:function(t,e){return`Input to reshape is a tensor with ${v0(t)} dense values, but the requested shape has ${v0(e)}. inputShape=${t} outputShape=${e}`}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:function(){return"segment ids must be >= 0"},getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:function(){return"segment ids are not increasing"},getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:function(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`},getSparseSegmentReductionIndicesOutOfRangeErrorMessage:function(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}}),Fet=Object.freeze({__proto__:null,nonMaxSuppressionV3Impl:Att,nonMaxSuppressionV4Impl:Ctt,nonMaxSuppressionV5Impl:Ott,whereImpl:X7}),Let=Object.freeze({__proto__:null,AdadeltaOptimizer:xet,AdagradOptimizer:Net,AdamOptimizer:$et,AdamaxOptimizer:Eet,MomentumOptimizer:Tet,Optimizer:vet,OptimizerConstructors:Aet,RMSPropOptimizer:ket,SGDOptimizer:_et,Tensor:O2,TensorBuffer:k2,Variable:I2,get Rank(){return M2},sumOutType:function(t){return B2(t,"int32")},upcastType:B2,get Reduction(){return Xtt},customGrad:n9,grad:function(t){return y0(L0(t),(()=>"The f passed in grad(f) must be a function")),(e,n)=>{const r=t4(e,"x","tf.grad","string_or_numeric"),s=null!=n?t4(n,"dy","tf.grad"):null;return X2.tidy((()=>{const{value:e,grads:n}=X2.gradients((()=>t(r)),[r],s);return null!=s&&g0(e.shape,s.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),r9(n),n[0]}))}},grads:function(t){return y0(L0(t),(()=>"The f passed in grads(f) must be a function")),(e,n)=>{y0(Array.isArray(e),(()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"));const r=e4(e,"args","tf.grads","string_or_numeric"),s=null!=n?t4(n,"dy","tf.grads"):null;return X2.tidy((()=>{const{value:e,grads:n}=X2.gradients((()=>t(...r)),r,s);return null!=s&&g0(e.shape,s.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),r9(n),n}))}},valueAndGrad:function(t){return y0(L0(t),(()=>"The f passed in valueAndGrad(f) must be a function")),(e,n)=>{y0(e instanceof O2,(()=>"The x passed in valueAndGrad(f)(x) must be a tensor")),y0(null==n||n instanceof O2,(()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"));const{grads:r,value:s}=X2.gradients((()=>t(e)),[e],n);return r9(r),{grad:r[0],value:s}}},valueAndGrads:function(t){return y0(L0(t),(()=>"The f passed in valueAndGrads(f) must be a function")),(e,n)=>{y0(Array.isArray(e)&&e.every((t=>t instanceof O2)),(()=>"The args passed in valueAndGrads(f)(args) must be array of tensors")),y0(null==n||n instanceof O2,(()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"));const r=X2.gradients((()=>t(...e)),e,n);return null!=n&&g0(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),r9(r.grads),r}},variableGrads:e9,Environment:q0,env:K0,get ENV(){return X0},nextFrame:function(){return new Promise((t=>Oet((()=>t()))))},KernelBackend:f0,DataStorage:class{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}},abs:o5,acos:i5,acosh:a5,add:e5,addN:u5,all:c5,any:l5,argMax:f5,argMin:h5,asin:p5,asinh:d5,atan:m5,atan2:y5,atanh:g5,avgPool:O5,avgPool3d:I5,basicLSTMCell:L5,batchToSpaceND:P5,batchNorm:B5,batchNorm2d:V5,batchNorm3d:z5,batchNorm4d:W5,bincount:U5,broadcastArgs:j5,broadcastTo:G5,buffer:j4,cast:G4,ceil:q5,clipByValue:H5,clone:q4,complex:r4,concat:M5,concat1d:K5,concat2d:X5,concat3d:J5,concat4d:Y5,conv1d:Q5,conv2d:Z5,conv2dTranspose:e8,conv3d:n8,conv3dTranspose:s8,cos:o8,cosh:i8,cumprod:a8,cumsum:u8,denseBincount:c8,depthToSpace:l8,depthwiseConv2d:f8,diag:h8,dilation2d:p8,div:r5,divNoNan:g8,dot:b8,einsum:w8,elu:v8,equal:d8,erf:x8,euclideanNorm:R8,exp:D8,expandDims:F8,expm1:L8,eye:B8,fill:V8,floor:z8,floorDiv:n5,gather:W8,greater:U8,greaterEqual:j8,imag:m6,isFinite:G8,isInf:q8,isNaN:H8,leakyRelu:K8,less:X8,lessEqual:J8,linspace:Y8,localResponseNormalization:Z8,log:Q8,log1p:t9,logSigmoid:o9,logSoftmax:a9,logSumExp:u9,logicalAnd:c9,logicalNot:l9,logicalOr:f9,logicalXor:h9,lowerBound:d9,matMul:l6,max:S8,maxPool:m9,maxPool3d:y9,maxPoolWithArgmax:g9,maximum:b9,mean:w9,meshgrid:function(t,e,{indexing:n="xy"}={}){if("xy"!==n&&"ij"!==n)throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(void 0===t)return[];let r=t4(t,"x","meshgrid",t instanceof O2?t.dtype:"float32");if(void 0===e)return[r];let s=t4(e,"y","meshgrid",e instanceof O2?e.dtype:"float32");const o=v0(r.shape),i=v0(s.shape);return"xy"===n?(r=C5(r,[1,-1]),s=C5(s,[-1,1]),[l6(x9([i,1],r.dtype),r),l6(s,x9([1,o],s.dtype))]):(r=C5(r,[-1,1]),s=C5(s,[1,-1]),[l6(r,x9([1,i],r.dtype)),l6(x9([o,1],s.dtype),s)])},min:_8,minimum:N9,mirrorPad:$9,mod:E9,moments:S9,mul:s5,multiRNNCell:_9,multinomial:T9,neg:y6,notEqual:k9,oneHot:f6,ones:x9,onesLike:A9,outerProduct:C9,pad:O9,pad1d:I9,pad2d:M9,pad3d:R9,pad4d:D9,pool:L9,pow:T8,prelu:P9,print:H4,prod:B9,rand:V9,randomGamma:o7,randomNormal:i7,randomUniform:a7,range:u7,real:g6,reciprocal:c7,relu:l7,relu6:f7,reshape:C5,reverse:h7,reverse1d:p7,reverse2d:d7,reverse3d:m7,reverse4d:y7,round:g7,rsqrt:b7,scalar:k8,selu:w7,separableConv2d:v7,setdiff1dAsync:x7,sigmoid:R5,sign:N7,sin:$7,sinh:E7,slice:D5,slice1d:S7,slice2d:_7,slice3d:T7,slice4d:k7,softmax:A7,softplus:s9,spaceToBatchND:F9,fft:C7,ifft:O7,irfft:I7,rfft:R7,split:M7,sqrt:A8,square:C8,squaredDifference:D7,squeeze:F7,stack:L7,step:P7,stridedSlice:B7,sub:i9,sum:O8,tan:V7,tanh:F5,tensor:o4,tensor1d:z7,tensor2d:W7,tensor3d:S6,tensor4d:function(t,e,n){if(b0(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");const r=Y3(t,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return s4(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,tensor5d:function(t,e,n){if(b0(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");const r=Y3(t,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return s4(t,e,r,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */,tensor6d:function(t,e,n){if(b0(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");const r=Y3(t,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return s4(t,e=e||r,r,n)},tile:P8,topk:U7,truncatedNormal:j7,unique:G7,unsortedSegmentSum:q7,unstack:H7,upperBound:K7,variable:function(t,e=!0,n,r){return X2.makeVariable(t,e,n,r)},where:m8,whereAsync:J7,zeros:v9,zerosLike:y8,op:n4,OP_SCOPE_SUFFIX:"__op",booleanMaskAsync:Y7,transpose:b6,norm:M8,movingAverage:Z7,scatterND:Q7,searchSorted:p9,sparseToDense:ttt,gatherND:ett,dropout:ntt,enclosingPowerOfTwo:rtt,cosineWindow:stt,inTopKAsync:ott,image:met,linalg:yet,losses:get,spectral:pet,fused:ytt,signal:det,sparse:bet,string:wet,train:Cet,enableProdMode:function(){K0().set("PROD",!0)},enableDebugMode:function(){K0().set("DEBUG",!0)},disableDeprecationWarnings:function(){K0().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},deprecationWarn:function(t){K0().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")},disposeVariables:function(){X2.disposeVariables()},engine:function(){return X2},memory:function(){return X2.memory()},profile:function(t){return X2.profile(t)},tidy:h6,dispose:p6,keep:d6,time:function(t){return X2.time(t)},setBackend:function(t){return X2.setBackend(t)},ready:function(){return X2.ready()},getBackend:function(){return X2.backendName},removeBackend:function(t){X2.removeBackend(t)},findBackend:function(t){return X2.findBackend(t)},findBackendFactory:function(t){return X2.findBackendFactory(t)},registerBackend:function(t,e,n=1){return X2.registerBackend(t,e,n)},backend:function(){return X2.backend},setPlatform:function(t,e){K0().setPlatform(t,e)},getKernel:T1,getGradient:k1,getKernelsForBackend:A1,registerKernel:C1,registerGradient:function(t){const{kernelName:e}=t;_1.has(e)&&K0().getBool("DEBUG")&&E1(`Overriding the gradient for '${e}'`),_1.set(e,t)},unregisterKernel:function(t,e){const n=O1(t,e);if(!S1.has(n))throw new Error(`The kernel '${t}' for backend '${e}' is not registered`);S1.delete(n)},unregisterGradient:function(t){if(!_1.has(t))throw new Error(`The gradient '${t}' for backend is not registered`);_1.delete(t)},copyRegisteredKernels:function(t,e){A1(t).forEach((t=>{C1(Object.assign({},t,{backendName:e}))}))},Abs:"Abs",Acos:"Acos",Acosh:"Acosh",Add:"Add",AddN:"AddN",All:"All",Any:"Any",ArgMax:"ArgMax",ArgMin:"ArgMin",Asin:"Asin",Asinh:"Asinh",Atan:"Atan",Atanh:"Atanh",Atan2:"Atan2",AvgPool:"AvgPool",AvgPoolGrad:"AvgPoolGrad",AvgPool3D:"AvgPool3D",AvgPool3DGrad:"AvgPool3DGrad",BatchMatMul:"BatchMatMul",BatchToSpaceND:"BatchToSpaceND",Bincount:"Bincount",BroadcastTo:"BroadcastTo",BroadcastArgs:"BroadcastArgs",Cast:"Cast",Ceil:"Ceil",ClipByValue:"ClipByValue",Complex:"Complex",ComplexAbs:"ComplexAbs",Concat:"Concat",Conv2D:"Conv2D",Conv2DBackpropFilter:"Conv2DBackpropFilter",Conv2DBackpropInput:"Conv2DBackpropInput",Conv3D:"Conv3D",Conv3DBackpropFilterV2:"Conv3DBackpropFilterV2",Conv3DBackpropInputV2:"Conv3DBackpropInputV2",Cos:"Cos",Cosh:"Cosh",Cumprod:"Cumprod",Cumsum:"Cumsum",CropAndResize:"CropAndResize",DenseBincount:"DenseBincount",DepthToSpace:"DepthToSpace",DepthwiseConv2dNative:"DepthwiseConv2dNative",DepthwiseConv2dNativeBackpropFilter:"DepthwiseConv2dNativeBackpropFilter",DepthwiseConv2dNativeBackpropInput:"DepthwiseConv2dNativeBackpropInput",Diag:"Diag",Dilation2D:"Dilation2D",Dilation2DBackpropInput:"Dilation2DBackpropInput",Dilation2DBackpropFilter:"Dilation2DBackpropFilter",RealDiv:"RealDiv",Einsum:"Einsum",Elu:"Elu",EluGrad:"EluGrad",Erf:"Erf",Equal:"Equal",Exp:"Exp",ExpandDims:"ExpandDims",Expm1:"Expm1",FFT:"FFT",Fill:"Fill",FlipLeftRight:"FlipLeftRight",Floor:"Floor",FloorDiv:"FloorDiv",FusedBatchNorm:"FusedBatchNorm",GatherV2:"GatherV2",GatherNd:"GatherNd",Greater:"Greater",GreaterEqual:"GreaterEqual",Identity:"Identity",IFFT:"IFFT",Imag:"Imag",IsFinite:"IsFinite",IsInf:"IsInf",IsNan:"IsNan",LeakyRelu:"LeakyRelu",Less:"Less",LessEqual:"LessEqual",LinSpace:"LinSpace",Log:"Log",Log1p:"Log1p",LogicalAnd:"LogicalAnd",LogicalNot:"LogicalNot",LogicalOr:"LogicalOr",LogSoftmax:"LogSoftmax",LowerBound:"LowerBound",LRN:"LRN",LRNGrad:"LRNGrad",Max:"Max",Maximum:"Maximum",MaxPool:"MaxPool",MaxPoolGrad:"MaxPoolGrad",MaxPool3D:"MaxPool3D",MaxPool3DGrad:"MaxPool3DGrad",MaxPoolWithArgmax:"MaxPoolWithArgmax",Mean:"Mean",Min:"Min",Minimum:"Minimum",MirrorPad:"MirrorPad",Mod:"Mod",Multinomial:"Multinomial",Multiply:"Multiply",Neg:"Neg",NotEqual:"NotEqual",NonMaxSuppressionV3:"NonMaxSuppressionV3",NonMaxSuppressionV4:"NonMaxSuppressionV4",NonMaxSuppressionV5:"NonMaxSuppressionV5",OnesLike:"OnesLike",OneHot:"OneHot",Pack:"Pack",PadV2:"PadV2",Pool:"Pool",Pow:"Pow",Prelu:"Prelu",Prod:"Prod",Range:"Range",Real:"Real",Reciprocal:"Reciprocal",Relu:"Relu",Reshape:"Reshape",ResizeNearestNeighbor:"ResizeNearestNeighbor",ResizeNearestNeighborGrad:"ResizeNearestNeighborGrad",ResizeBilinear:"ResizeBilinear",ResizeBilinearGrad:"ResizeBilinearGrad",Relu6:"Relu6",Reverse:"Reverse",Round:"Round",Rsqrt:"Rsqrt",ScatterNd:"ScatterNd",SearchSorted:"SearchSorted",Select:"Select",Selu:"Selu",Slice:"Slice",Sin:"Sin",Sinh:"Sinh",Sign:"Sign",Sigmoid:"Sigmoid",Softplus:"Softplus",Sqrt:"Sqrt",Sum:"Sum",SpaceToBatchND:"SpaceToBatchND",SplitV:"SplitV",Softmax:"Softmax",SparseFillEmptyRows:"SparseFillEmptyRows",SparseReshape:"SparseReshape",SparseSegmentMean:"SparseSegmentMean",SparseSegmentSum:"SparseSegmentSum",SparseToDense:"SparseToDense",SquaredDifference:"SquaredDifference",Square:"Square",StridedSlice:"StridedSlice",StringNGrams:"StringNGrams",StringSplit:"StringSplit",StringToHashBucketFast:"StringToHashBucketFast",Sub:"Sub",Tan:"Tan",Tanh:"Tanh",Tile:"Tile",TopK:"TopK",Transform:"Transform",Transpose:"Transpose",Unique:"Unique",Unpack:"Unpack",UnsortedSegmentSum:"UnsortedSegmentSum",UpperBound:"UpperBound",ZerosLike:"ZerosLike",Step:"Step",FromPixels:"FromPixels",RotateWithOffset:"RotateWithOffset",_FusedMatMul:"_FusedMatMul",FusedConv2D:"FusedConv2D",FusedDepthwiseConv2D:"FusedDepthwiseConv2D",version_core:"3.18.0",browser:C6,io:c6,math:v6,serialization:J6,test_util:t5,util:w2,backend_util:Det,broadcast_util:E6,tensor_util:j2,slice_util:q6,gather_util:I6,scatter_util:F6,device_util:Q2,kernel_impls:Fet});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
var Pet,Bet;K0().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"}(Pet||(Pet={})),function(t){var e;(e=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(Bet||(Bet={}));
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Vet={};function zet(t){return Vet[t]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Wet(t,e,n,r,s){const o=e.inputParams[t];if(o&&void 0!==o.inputIndexStart){const t=o.inputIndexStart,i=0===o.inputIndexEnd?void 0:void 0===o.inputIndexEnd?t+1:o.inputIndexEnd;if("tensor"===o.type)return Uet(e.inputNames[o.inputIndexStart],n,r,s);if("tensors"===o.type){return e.inputNames.slice(t,i).map((t=>Uet(t,n,r,s)))}const a=Uet(e.inputNames.slice(t)[0],n,r,s),u=a.dataSync();return"number"===o.type?u[0]:z0(a.shape,u)}const i=e.attrParams[t];return i&&i.value}function Uet(t,e,n,r){const[s,o]=qet(t);if(null!=r){const t=r.getHashTableHandleByName(s);if(null!=t)return t}const i=n.currentContextIds.find((t=>!!e[Get(s,t)]));return void 0!==i?e[Get(s,i)][o]:void 0}function jet(t,e){const[n,r,s]=qet(t);return[Get(n,e&&e.currentContextId),r,s]}function Get(t,e){return e?`${t}-${e}`:t}function qet(t){const e=t.split(":");if(1===e.length)return[t,0,void 0];const n=e[0],r=3===e.length?e[1]:void 0;return[n,Number(e[e.length-1]),r]}function Het(t,e,n){let r=Wet("pad",t,e,n);if("explicit"===r){r=Wet("explicitPaddings",t,e,n);const s=[[0,0],[0,0],[0,0],[0,0]];for(let t=0;t<4;t++)s[t][0]=r[2*t],s[t][1]=r[2*t+1];return s}return r}function Ket(t){return t.kept?t:q4(t)}
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Xet=Object.freeze({__proto__:null,json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Jet=Object.freeze({__proto__:null,json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Yet=Object.freeze({__proto__:null,json:[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Zet=Object.freeze({__proto__:null,json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Qet=Object.freeze({__proto__:null,json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var tnt=Object.freeze({__proto__:null,json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ent=Object.freeze({__proto__:null,json:[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var nnt=Object.freeze({__proto__:null,json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var rnt=Object.freeze({__proto__:null,json:[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var snt=Object.freeze({__proto__:null,json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ont=Object.freeze({__proto__:null,json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var int=Object.freeze({__proto__:null,json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ant=Object.freeze({__proto__:null,json:[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var unt=Object.freeze({__proto__:null,json:[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var cnt=Object.freeze({__proto__:null,json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var lnt=Object.freeze({__proto__:null,json:[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var fnt=Object.freeze({__proto__:null,json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var hnt=Object.freeze({__proto__:null,json:[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}]});
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var pnt=Object.freeze({__proto__:null,json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}]});class dnt{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const t=[].concat(...[Xet,Jet,Yet,Zet,Qet,tnt,ent,nnt,rnt,snt,ont,int,ant,unt,cnt,lnt,fnt,hnt,pnt].map((t=>t.json)));this.opMappers=t.reduce(((t,e)=>(t[e.tfOpName]=e,t)),{})}transformGraph(t,e={}){const n=t.node,r=[],s=[],o=[],i=n.reduce(((t,e)=>(t[e.name]=this.mapNode(e),e.op.startsWith("Placeholder")?r.push(t[e.name]):"Const"===e.op?s.push(t[e.name]):null!=e.input&&0!==e.input.length||o.push(t[e.name]),t)),{});let a=[];const u=[];let c={},l={};null!=e&&(c=this.mapSignatureEntries(e.inputs),l=this.mapSignatureEntries(e.outputs));const f=Object.keys(i);f.forEach((t=>{const e=i[t];e.inputNames.forEach(((t,n)=>{const[r,,s]=jet(t),o=i[r];if(null!=o.outputs){const t=o.outputs.indexOf(s);if(-1!==t){const s=`${r}:${t}`;e.inputNames[n]=s}}e.inputs.push(o),o.children.push(e)}))})),0===Object.keys(l).length?f.forEach((t=>{const e=i[t];0===e.children.length&&u.push(e)})):Object.keys(l).forEach((t=>{const[e]=jet(t),n=i[e];null!=n&&(n.signatureKey=l[t],u.push(n))})),Object.keys(c).length>0?Object.keys(c).forEach((t=>{const[e]=jet(t),n=i[e];n&&(n.signatureKey=c[t],a.push(n))})):a=r;let h={};null!=t.library&&null!=t.library.function&&(h=t.library.function.reduce(((t,e)=>(t[e.signature.name]=this.mapFunction(e),t)),{}));const p={nodes:i,inputs:a,outputs:u,weights:s,placeholders:r,signature:e,functions:h};return o.length>0&&(p.initNodes=o),p}mapSignatureEntries(t){return Object.keys(t||{}).reduce(((e,n)=>(e[t[n].name]=n,e)),{})}mapNode(t){const e=zet(t.op)||this.opMappers[t.op]||{};null==t.attr&&(t.attr={});const n={name:t.name,op:t.op,category:e.category,inputNames:(t.input||[]).map((t=>t.startsWith("^")?t.slice(1):t)),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr,outputs:e.outputs};return null!=e.inputs&&(n.inputParams=e.inputs.reduce(((t,e)=>(t[e.name]={type:e.type,inputIndexStart:e.start,inputIndexEnd:e.end},t)),{})),null!=e.attrs&&(n.attrParams=e.attrs.reduce(((e,n)=>{const r=n.type;let s;switch(n.type){case"string":s=ynt(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=ynt(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":s=_nt(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=_nt(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":s=bnt(t.attr,n.tfName,n.defaultValue||0),void 0===s&&n.tfDeprecatedName&&(s=bnt(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":s=Snt(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Snt(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":s=gnt(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=gnt(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":s=knt(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=knt(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":s=Ent(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Ent(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":s=Tnt(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Tnt(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":s=xnt(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=xnt(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":s=Nnt(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=Nnt(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":s=vnt(t.attr,n.tfName,n.defaultValue),void 0===s&&n.tfDeprecatedName&&(s=vnt(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${n.type} for op: ${t.op}`)}return e[n.name]={value:s,type:r},e}),{})),n}mapFunction(t){const e=t.nodeDef,n=[];let r={};null!=e&&(r=e.reduce(((t,e)=>(t[e.name]=this.mapNode(e),"Const"===e.op&&n.push(t[e.name]),t)),{}));const s=[],o=[];t.signature.inputArg.forEach((t=>{const[e]=jet(t.name),n={name:e,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:wnt(t.type),type:"dtype"}},children:[]};n.signatureKey=t.name,s.push(n),r[e]=n}));Object.keys(r).forEach((t=>{const e=r[t];e.inputNames.forEach(((t,n)=>{const[s,,o]=jet(t),i=r[s];if(null!=i.outputs){const t=i.outputs.indexOf(o);if(-1!==t){const r=`${s}:${t}`;e.inputNames[n]=r}}e.inputs.push(i),i.children.push(e)}))}));const i=t.ret;t.signature.outputArg.forEach((t=>{const[e,n]=jet(i[t.name]),s=r[e];null!=s&&(s.defaultOutput=n,o.push(s))}));const a=this.mapArgsToSignature(t);return{nodes:r,inputs:s,outputs:o,weights:n,placeholders:[],signature:a}}mapArgsToSignature(t){return{methodName:t.signature.name,inputs:t.signature.inputArg.reduce(((t,e)=>(t[e.name]=this.mapArgToTensorInfo(e),t)),{}),outputs:t.signature.outputArg.reduce(((e,n)=>(e[n.name]=this.mapArgToTensorInfo(n,t.ret),e)),{})}}mapArgToTensorInfo(t,e){let n=t.name;return null!=e&&(n=e[n]),{name:n,dtype:t.type}}}function mnt(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):function(t){const e=K0().global;return void 0!==e.atob?e.atob(t):new d3(t,"base64").toString()}(t);return e?n:n.toLowerCase()}function ynt(t,e,n,r=!1){const s=t[e];return null!=s?mnt(s.s,r):n}function gnt(t,e,n){const r=t[e];return r?r.b:n}function bnt(t,e,n){const r=t[e]||{},s=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof s?s:parseInt(s,10)}function wnt(t){switch("string"==typeof t&&(t=Pet[t]),t){case Pet.DT_FLOAT:case Pet.DT_HALF:return"float32";case Pet.DT_INT32:case Pet.DT_INT64:case Pet.DT_INT8:case Pet.DT_UINT8:return"int32";case Pet.DT_BOOL:return"bool";case Pet.DT_DOUBLE:return"float32";case Pet.DT_STRING:return"string";default:return null}}function vnt(t,e,n){const r=t[e];return r&&r.func?r.func.name:n}function xnt(t,e,n){const r=t[e];return r&&r.type?wnt(r.type):n}function Nnt(t,e,n){const r=t[e];return r&&r.list&&r.list.type?r.list.type.map((t=>wnt(t))):n}function $nt(t){if(!t.unknownRank)return null!=t.dim?t.dim.map((t=>"number"==typeof t.size?t.size:parseInt(t.size,10))):[]}function Ent(t,e,n){const r=t[e];return r&&r.shape?$nt(r.shape):n}function Snt(t,e,n){const r=t[e];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((t=>"number"==typeof t?t:parseInt(t,10))):n}function _nt(t,e,n,r=!1){const s=t[e];return s&&s.list&&s.list.s?s.list.s.map((t=>mnt(t,r))):n}function Tnt(t,e,n){const r=t[e];return r&&r.list&&r.list.shape?r.list.shape.map((t=>$nt(t))):n}function knt(t,e,n){const r=t[e];return r&&r.list&&r.list.b?r.list.b:n}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ant{constructor(t,e,n){this.node=t,this.tensorMap=e,this.context=n,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((t=>this.getInput(t))),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce(((t,e)=>(t[e]=this.getAttr(e),t)),{}))}getInput(t){return Uet(t,this.tensorMap,this.context)}getAttr(t,e){const n=this.node.rawAttrs[t];if(null!=n.tensor)return Uet(t,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return bnt(this.node.rawAttrs,t,e);if(null!=n.s)return ynt(this.node.rawAttrs,t,e);if(null!=n.b)return gnt(this.node.rawAttrs,t,e);if(null!=n.shape)return Ent(this.node.rawAttrs,t,e);if(null!=n.type)return xnt(this.node.rawAttrs,t,e);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return Snt(this.node.rawAttrs,t,e);if(null!=n.list.s)return _nt(this.node.rawAttrs,t,e);if(null!=n.list.shape)return Tnt(this.node.rawAttrs,t,e);if(null!=n.list.b)return knt(this.node.rawAttrs,t,e);if(null!=n.list.type)return Nnt(this.node.rawAttrs,t,e)}return e}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Cnt(t,e,n=""){if("number"!=typeof t&&"number"!=typeof e){y0(t.length===e.length,(()=>n+` Shapes ${t} and ${e} must match`));for(let r=0;r<t.length;r++){const s=t[r],o=e[r];y0(s<0||o<0||s===o,(()=>n+` Shapes ${t} and ${e} must match`))}}}function Ont(t){return"number"!=typeof t&&!t.some((t=>t<0))}function Int(t,e,n){let r=Mnt(t,n);const s=!Ont(r);if(s&&0===e.length)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(s&&e.forEach((t=>{r=Mnt(t.shape,r)})),!Ont(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function Mnt(t,e){if("number"==typeof t)return e;if("number"==typeof e)return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let r=0;r<t.length;++r){const s=t[r],o=e[r];if(s>=0&&o>=0&&s!==o)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[r]=s>=0?s:o}return n}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rnt{constructor(t,e,n,r,s,o,i){this.name=t,this.dtype=e,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=s,this.dynamicSize=o,this.clearAfterRead=i,this.tensors=[],this.closed_=!1,this.idTensor=k8(0),d6(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.tensor.id)||e.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||t>=this.size())throw new Error(`Tried to read from index ${t}, but array size is: ${this.size()}`);const e=this.tensors[t];if(e.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${t} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor}readMany(t){return t.map((t=>this.read(t)))}write(t,e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error(`Tried to write to index ${t}, but array is not resizeable and size is: ${this.maxSize}`);const n=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t},\n          because the value dtype is ${e.dtype}, but TensorArray dtype is ${this.dtype}.`);if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=e.shape),Cnt(this.elementShape,e.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${t}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been written.`);n.tensor=e,d6(e),n.written=!0,this.tensors[t]=n}writeMany(t,e){if(t.length!==e.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${t.length} is not the same as tensors size: ${e.length}.`);t.forEach(((t,n)=>this.write(t,e[n])))}gather(t,e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${e}`);if(t)t=t.slice(0,this.size());else{t=[];for(let e=0;e<this.size();e++)t.push(e)}if(0===t.length)return o4([],[0].concat(this.elementShape));const n=this.readMany(t);return Cnt(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),L7(n,0)}concat(t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${t}`);if(0===this.size())return o4([],[0].concat(this.elementShape));const e=[];for(let t=0;t<this.size();t++)e.push(t);const n=this.readMany(e);return Cnt(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),M5(n,0)}scatter(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);const n=Math.max(...t);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(t,H7(e,0))}split(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);let n=0;const r=t.map((t=>(n+=t,n)));if(n!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${n}, and tensor's shape is: ${e.shape}`);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${t.length}), and the TensorArray is not marked as dynamically resizeable`);const s=0===n?0:e.size/n,o=[];h6((()=>{e=C5(e,[1,n,s]);for(let n=0;n<t.length;++n){const i=[0,0===n?0:r[n-1],0],a=[1,t[n],s];o[n]=C5(D5(e,i,a),this.elementShape)}return o}));const i=[];for(let e=0;e<t.length;e++)i[e]=e;this.writeMany(i,o)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dnt{constructor(t,e,n,r=-1){this.tensors=t,this.elementShape=e,this.elementDtype=n,null!=t&&t.forEach((t=>{if(n!==t.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${t.dtype}`);Cnt(e,t.shape,"TensorList shape mismatch: "),d6(t)})),this.idTensor=k8(0),this.maxNumElements=r,d6(this.idTensor)}get id(){return this.idTensor.id}copy(){return new Dnt([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.id)||e.dispose()})),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,e,n=-1){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(-1!==n&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);Cnt(t,this.elementShape,"TensorList shape mismatch: ");const r=Int(this.elementShape,this.tensors,t);return h6((()=>{const t=this.tensors.map((t=>C5(t,r)));return L7(t,0)}))}popBack(t,e){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=Int(this.elementShape,this.tensors,t),r=this.tensors.pop();return Cnt(r.shape,t,"TensorList shape mismatch: "),C5(r,n)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(Cnt(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");d6(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);const e=new Dnt([],this.elementShape,this.elementDtype,this.maxNumElements);e.tensors.length=t;for(let n=0;n<Math.min(this.tensors.length,t);++n)e.tensors[n]=this.tensors[n];return e}getItem(t,e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(null==this.tensors[t])throw new Error(`element at index ${t} is null.`);Cnt(this.tensors[t].shape,e,"TensorList shape mismatch: ");const r=Int(this.elementShape,this.tensors,e);return C5(this.tensors[t],r)}setItem(t,e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(t<0||-1!==this.maxNumElements&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);Cnt(this.elementShape,e.shape,"TensorList shape mismatch: "),d6(e),this.tensors[t]=e}gather(t,e,n){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);Cnt(this.elementShape,n,"TensorList shape mismatch: "),t=t.slice(0,this.size());const r=Int(this.elementShape,this.tensors,n);return 0===t.length?o4([],[0].concat(r)):h6((()=>{const e=t.map((t=>C5(this.tensors[t],r)));return L7(e,0)}))}concat(t,e){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);Cnt(this.elementShape,e,"TensorList shape mismatch: ");const n=Int(this.elementShape,this.tensors,e);return 0===this.size()?o4([],[0].concat(n)):h6((()=>{const t=this.tensors.map((t=>C5(t,n)));return M5(t,0)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Fnt=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const r=Wet("thenBranch",t,e,n),s=Wet("elseBranch",t,e,n),o=Wet("cond",t,e,n),i=Wet("args",t,e,n);return(await o.data())[0]?n.functionMap[r].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap):n.functionMap[s].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=Wet("body",t,e,n),s=Wet("cond",t,e,n),o=Wet("args",t,e,n),i=await n.functionMap[s].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap),a=o.map((t=>t.id));let u=await i[0].data();i.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||t.dispose()}));let c=o;for(;u[0];){const t=c;c=await n.functionMap[r].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);const e=c.map((t=>t.id));t.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}));const o=await n.functionMap[s].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);u=await o[0].data(),o.forEach((t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}))}return c}case"LoopCond":return[Ket(Wet("pred",t,e,n))];case"Switch":{const r=Wet("pred",t,e,n);let s=Wet("data",t,e,n);return s.kept||(s=Ket(s)),(await r.data())[0]?[void 0,s]:[s,void 0]}case"Merge":{const r=t.inputNames.find((t=>void 0!==Uet(t,e,n)));if(r){return[Ket(Uet(r,e,n))]}return}case"Enter":{const r=Wet("frameName",t,e,n),s=Wet("tensor",t,e,n);return n.enterFrame(r),[Ket(s)]}case"Exit":{const r=Wet("tensor",t,e,n);return n.exitFrame(),[Ket(r)]}case"NextIteration":{const r=Wet("tensor",t,e,n);return n.nextIteration(),[Ket(r)]}case"TensorArrayV3":{const r=Wet("size",t,e,n),s=Wet("dtype",t,e,n),o=Wet("elementShape",t,e,n),i=Wet("dynamicSize",t,e,n),a=Wet("clearAfterRead",t,e,n),u=Wet("identicalElementShapes",t,e,n),c=Wet("name",t,e,n),l=new Rnt(c,s,r,o,u,i,a);return n.addTensorArray(l),[l.idTensor,k8(1)]}case"TensorArrayWriteV3":{const r=Wet("tensorArrayId",t,e,n),s=Wet("index",t,e,n),o=Wet("tensor",t,e,n),i=n.getTensorArray(r.id);return i.write(s,o),[i.idTensor]}case"TensorArrayReadV3":{const r=Wet("tensorArrayId",t,e,n),s=Wet("index",t,e,n);return[n.getTensorArray(r.id).read(s)]}case"TensorArrayGatherV3":{const r=Wet("tensorArrayId",t,e,n),s=Wet("indices",t,e,n),o=Wet("dtype",t,e,n);return[n.getTensorArray(r.id).gather(s,o)]}case"TensorArrayScatterV3":{const r=Wet("tensorArrayId",t,e,n),s=Wet("indices",t,e,n),o=Wet("tensor",t,e,n),i=n.getTensorArray(r.id);return i.scatter(s,o),[i.idTensor]}case"TensorArrayConcatV3":{const r=Wet("tensorArrayId",t,e,n),s=n.getTensorArray(r.id),o=Wet("dtype",t,e,n);return[s.concat(o)]}case"TensorArraySplitV3":{const r=Wet("tensorArrayId",t,e,n),s=Wet("tensor",t,e,n),o=Wet("lengths",t,e,n),i=n.getTensorArray(r.id);return i.split(o,s),[i.idTensor]}case"TensorArraySizeV3":{const r=Wet("tensorArrayId",t,e,n);return[k8(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{const r=Wet("tensorArrayId",t,e,n),s=n.getTensorArray(r.id);return s.clearAndClose(),[s.idTensor]}case"TensorListSetItem":{const r=Wet("tensorListId",t,e,n),s=Wet("index",t,e,n),o=Wet("tensor",t,e,n),i=n.getTensorList(r.id);return i.setItem(s,o),[i.idTensor]}case"TensorListGetItem":{const r=Wet("tensorListId",t,e,n),s=Wet("index",t,e,n),o=Wet("elementShape",t,e,n),i=Wet("elementDType",t,e,n);return[n.getTensorList(r.id).getItem(s,o,i)]}case"TensorListScatterV2":case"TensorListScatter":{const r=Wet("indices",t,e,n),s=function(t,e,n,r){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const s=Math.max(...e);if(null!=r&&-1!==r&&s>=r)throw new Error(`Max index must be < array size (${s}  vs. ${r})`);const o=new Dnt([],n,t.dtype,r),i=H7(t,0);return e.forEach(((t,e)=>{o.setItem(t,i[e])})),o}(Wet("tensor",t,e,n),r,Wet("elementShape",t,e,n),Wet("numElements",t,e,n));return n.addTensorList(s),[s.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=Wet("elementShape",t,e,n),s=Wet("elementDType",t,e,n);let o;o="TensorListReserve"===t.op?"numElements":"maxNumElements";const i=function(t,e,n){return new Dnt([],t,e,n)}(r,s,Wet(o,t,e,n));return n.addTensorList(i),[i.idTensor]}case"TensorListGather":{const r=Wet("tensorListId",t,e,n),s=Wet("indices",t,e,n),o=Wet("elementShape",t,e,n),i=Wet("elementDType",t,e,n);return[n.getTensorList(r.id).gather(s,i,o)]}case"TensorListStack":{const r=Wet("tensorListId",t,e,n),s=Wet("elementShape",t,e,n),o=Wet("elementDType",t,e,n),i=Wet("numElements",t,e,n);return[n.getTensorList(r.id).stack(s,o,i)]}case"TensorListFromTensor":{const r=function(t,e,n){const r=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);Cnt(t.shape.slice(1),e,"TensorList shape mismatch: ");const s=H7(t);return new Dnt(s,e,r)}(Wet("tensor",t,e,n),Wet("elementShape",t,e,n),Wet("elementDType",t,e,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const r=Wet("tensorListId",t,e,n),s=n.getTensorList(r.id),o=Wet("dtype",t,e,n),i=Wet("elementShape",t,e,n);return[s.concat(o,i)]}case"TensorListPushBack":{const r=Wet("tensorListId",t,e,n),s=Wet("tensor",t,e,n),o=n.getTensorList(r.id);return o.pushBack(s),[o.idTensor]}case"TensorListPopBack":{const r=Wet("tensorListId",t,e,n),s=Wet("elementShape",t,e,n),o=Wet("elementDType",t,e,n);return[n.getTensorList(r.id).popBack(s,o)]}case"TensorListSplit":{const r=Wet("tensor",t,e,n),s=Wet("elementShape",t,e,n),o=function(t,e,n){let r=0;const s=e.map((t=>(r+=t,r)));if(r!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${r}, and tensor's shape is: ${t.shape}`);const o=Mnt(t.shape.slice(1),n),i=0===r?0:t.size/r,a=h6((()=>{const n=[];t=C5(t,[1,r,i]);for(let r=0;r<e.length;++r){const a=[0,0===r?0:s[r-1],0],u=[1,e[r],i];n[r]=C5(D5(t,a,u),o)}return t.dispose(),n})),u=new Dnt([],n,t.dtype,e.length);for(let t=0;t<a.length;t++)u.setItem(t,a[t]);return u}(r,Wet("lengths",t,e,n),s);return n.addTensorList(o),[o.idTensor]}case"TensorListLength":{const r=Wet("tensorListId",t,e,n);return[k8(n.getTensorList(r.id).size(),"int32")]}case"TensorListResize":{const r=Wet("tensorListId",t,e,n),s=Wet("size",t,e,n),o=n.getTensorList(r.id).resize(s);return n.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lnt(t,e,n){const[r,s]=Wet("fusedOps",t,e,n),o="biasadd"===r,i=!o,a="prelu"===s,u="fusedbatchnorm"===r,c=Wet("numArgs",t,e,n);if(o){if(a&&2!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&o&&1!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(u)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const l=Wet("strides",t,e,n),f=Het(t,e,n),h=Wet("dataFormat",t,e,n).toUpperCase(),p=Wet("dilations",t,e,n);let[d,m]=Wet("args",t,e,n);i&&(m=d,d=void 0);return{stride:l,pad:f,dataFormat:h,dilations:p,biasArg:d,preluArg:m,activationFunc:s,leakyreluAlpha:Wet("leakyreluAlpha",t,e,n)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Pnt(t,e,n){return{boxes:Wet("boxes",t,e,n),scores:Wet("scores",t,e,n),maxOutputSize:Wet("maxOutputSize",t,e,n),iouThreshold:Wet("iouThreshold",t,e,n),scoreThreshold:Wet("scoreThreshold",t,e,n),softNmsSigma:Wet("softNmsSigma",t,e,n)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Bnt{constructor(t,e){this.keyDType=t,this.valueDType=e,this.handle=k8(0),this.tensorMap=new Map,d6(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return k8(this.size(),"int32")}async import(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),h6((()=>{const t=H7(e),r=n.length,s=t.length;y0(r===s,(()=>`The number of elements doesn't match, keys has ${r} elements, the values has ${s} elements.`));for(let e=0;e<r;e++){const r=n[e],s=t[e];d6(s),this.tensorMap.set(r,s)}return this.handle}))}async find(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return h6((()=>{const t=[];for(let r=0;r<n.length;r++){const s=n[r],o=this.findWithDefault(s,e);t.push(o)}return L7(t)}))}findWithDefault(t,e){const n=this.tensorMap.get(t);return null!=n?n:e}checkKeyAndValueTensor(t,e){if(t.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${t.dtype}`);if(e.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${e.dtype}`)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Vnt(t,e,n,r){const s=((t,e,n)=>{switch(t.category){case"arithmetic":return h6((()=>((t,e,n)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[e5(Wet("a",t,e,n),Wet("b",t,e,n))];case"AddN":return[u5(Wet("tensors",t,e,n))];case"FloorMod":case"Mod":return[E9(Wet("a",t,e,n),Wet("b",t,e,n))];case"Mul":return[s5(Wet("a",t,e,n),Wet("b",t,e,n))];case"RealDiv":case"Div":return[r5(Wet("a",t,e,n),Wet("b",t,e,n))];case"DivNoNan":return[g8(Wet("a",t,e,n),Wet("b",t,e,n))];case"FloorDiv":return[n5(Wet("a",t,e,n),Wet("b",t,e,n))];case"Sub":return[i9(Wet("a",t,e,n),Wet("b",t,e,n))];case"Minimum":return[N9(Wet("a",t,e,n),Wet("b",t,e,n))];case"Maximum":return[b9(Wet("a",t,e,n),Wet("b",t,e,n))];case"Pow":return[T8(Wet("a",t,e,n),Wet("b",t,e,n))];case"SquaredDifference":return[D7(Wet("a",t,e,n),Wet("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"basic_math":return h6((()=>((t,e,n)=>{switch(t.op){case"Abs":case"ComplexAbs":return[o5(Wet("x",t,e,n))];case"Acos":return[i5(Wet("x",t,e,n))];case"Acosh":return[a5(Wet("x",t,e,n))];case"Asin":return[p5(Wet("x",t,e,n))];case"Asinh":return[d5(Wet("x",t,e,n))];case"Atan":return[m5(Wet("x",t,e,n))];case"Atan2":return[y5(Wet("x",t,e,n),Wet("y",t,e,n))];case"Atanh":return[g5(Wet("x",t,e,n))];case"Ceil":return[q5(Wet("x",t,e,n))];case"Complex":return[r4(Wet("real",t,e,n),Wet("imag",t,e,n))];case"Cos":return[o8(Wet("x",t,e,n))];case"Cosh":return[i8(Wet("x",t,e,n))];case"Elu":return[v8(Wet("x",t,e,n))];case"Erf":return[x8(Wet("x",t,e,n))];case"Exp":return[D8(Wet("x",t,e,n))];case"Expm1":return[L8(Wet("x",t,e,n))];case"Floor":return[z8(Wet("x",t,e,n))];case"Log":return[Q8(Wet("x",t,e,n))];case"Log1p":return[t9(Wet("x",t,e,n))];case"Imag":return[m6(Wet("x",t,e,n))];case"Neg":return[y6(Wet("x",t,e,n))];case"Reciprocal":return[c7(Wet("x",t,e,n))];case"Real":return[g6(Wet("x",t,e,n))];case"Relu":return[l7(Wet("x",t,e,n))];case"Round":return[g7(Wet("x",t,e,n))];case"Selu":return[w7(Wet("x",t,e,n))];case"Sigmoid":return[R5(Wet("x",t,e,n))];case"Sin":return[$7(Wet("x",t,e,n))];case"Sign":return[N7(Wet("x",t,e,n))];case"Sinh":return[E7(Wet("x",t,e,n))];case"Softplus":return[s9(Wet("x",t,e,n))];case"Sqrt":return[A8(Wet("x",t,e,n))];case"Square":return[C8(Wet("x",t,e,n))];case"Tanh":return[F5(Wet("x",t,e,n))];case"Tan":return[V7(Wet("x",t,e,n))];case"ClipByValue":return[H5(Wet("x",t,e,n),Wet("clipValueMin",t,e,n),Wet("clipValueMax",t,e,n))];case"Relu6":return[f7(Wet("x",t,e,n))];case"Rsqrt":return[b7(Uet(t.inputNames[0],e,n))];case"Prod":return[B9(Wet("x",t,e,n),Wet("axes",t,e,n))];case"LeakyRelu":return[K8(Wet("x",t,e,n),Wet("alpha",t,e,n))];case"Prelu":return[P9(Wet("x",t,e,n),Wet("alpha",t,e,n))];case"IsNan":return[H8(Uet(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"control":return Fnt(t,e,n);case"convolution":return h6((()=>((t,e,n)=>{switch(t.op){case"Conv1D":{const r=Wet("stride",t,e,n),s=Wet("pad",t,e,n),o=Wet("dataFormat",t,e,n).toUpperCase(),i=Wet("dilation",t,e,n);return[Q5(Wet("x",t,e,n),Wet("filter",t,e,n),r,s,o,i)]}case"Conv2D":{const r=Wet("strides",t,e,n),s=Het(t,e,n),o=Wet("dataFormat",t,e,n).toUpperCase(),i=Wet("dilations",t,e,n);return[Z5(Wet("x",t,e,n),Wet("filter",t,e,n),[r[1],r[2]],s,o,[i[1],i[2]])]}case"_FusedConv2D":{const{stride:r,pad:s,dataFormat:o,dilations:i,biasArg:a,preluArg:u,activationFunc:c,leakyreluAlpha:l}=Lnt(t,e,n);return[ftt({x:Wet("x",t,e,n),filter:Wet("filter",t,e,n),strides:[r[1],r[2]],pad:s,dataFormat:o,dilations:[i[1],i[2]],bias:a,activation:c,preluActivationWeights:u,leakyreluAlpha:l})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:s,dataFormat:o,dilations:i,biasArg:a,preluArg:u,activationFunc:c,leakyreluAlpha:l}=Lnt(t,e,n);return[dtt({x:Wet("x",t,e,n),filter:Wet("filter",t,e,n),strides:[r[1],r[2]],pad:s,dataFormat:o,dilations:[i[1],i[2]],bias:a,activation:c,preluActivationWeights:u,leakyreluAlpha:l})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=Wet("outputShape",t,e,n),s=Wet("strides",t,e,n),o=Het(t,e,n);return[e8(Wet("x",t,e,n),Wet("filter",t,e,n),r,[s[1],s[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=Wet("strides",t,e,n),s=Het(t,e,n),o=Wet("dilations",t,e,n),i=Wet("dataFormat",t,e,n).toUpperCase();return[f8(Wet("input",t,e,n),Wet("filter",t,e,n),[r[1],r[2]],s,i,[o[1],o[2]])]}case"Conv3D":{const r=Wet("strides",t,e,n),s=Wet("pad",t,e,n),o=Wet("dataFormat",t,e,n).toUpperCase(),i=Wet("dilations",t,e,n);return[n8(Wet("x",t,e,n),Wet("filter",t,e,n),[r[1],r[2],r[3]],s,o,[i[1],i[2],i[3]])]}case"AvgPool":{const r=Wet("strides",t,e,n),s=Wet("pad",t,e,n),o=Wet("kernelSize",t,e,n);return[O5(Wet("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s)]}case"MaxPool":{const r=Wet("strides",t,e,n),s=Wet("pad",t,e,n),o=Wet("kernelSize",t,e,n);return[m9(Wet("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s)]}case"MaxPoolWithArgmax":{const r=Wet("strides",t,e,n),s=Wet("pad",t,e,n),o=Wet("kernelSize",t,e,n),i=Wet("includeBatchInIndex",t,e,n),{result:a,indexes:u}=g9(Wet("x",t,e,n),[o[1],o[2]],[r[1],r[2]],s,i);return[a,u]}case"AvgPool3D":{const r=Wet("strides",t,e,n),s=Wet("pad",t,e,n),o=Wet("kernelSize",t,e,n);return[I5(Wet("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],s)]}case"MaxPool3D":{const r=Wet("strides",t,e,n),s=Wet("pad",t,e,n),o=Wet("kernelSize",t,e,n);return[y9(Wet("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],s)]}case"Dilation2D":{const r=Wet("strides",t,e,n),s=Wet("pad",t,e,n),o=Wet("dilations",t,e,n),i=r[1],a=r[2],u=o[1],c=o[2];return[p8(Wet("x",t,e,n),Wet("filter",t,e,n),[i,a],s,[u,c],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"creation":return h6((()=>((t,e,n)=>{switch(t.op){case"Fill":{const r=Wet("shape",t,e,n),s=Wet("dtype",t,e,n);return[V8(r,Wet("value",t,e,n),s)]}case"LinSpace":return[Y8(Wet("start",t,e,n),Wet("stop",t,e,n),Wet("num",t,e,n))];case"Multinomial":{const r=Wet("logits",t,e,n),s=Wet("numSamples",t,e,n),o=Wet("seed",t,e,n);return[T9(r,s,o)]}case"OneHot":{const r=Wet("indices",t,e,n),s=Wet("depth",t,e,n),o=Wet("onValue",t,e,n),i=Wet("offValue",t,e,n);return[f6(r,s,o,i)]}case"Ones":return[x9(Wet("shape",t,e,n),Wet("dtype",t,e,n))];case"OnesLike":return[A9(Wet("x",t,e,n))];case"RandomUniform":return[a7(Wet("shape",t,e,n),Wet("minval",t,e,n),Wet("maxval",t,e,n),Wet("dtype",t,e,n))];case"Range":return[u7(Wet("start",t,e,n),Wet("stop",t,e,n),Wet("step",t,e,n),Wet("dtype",t,e,n))];case"TruncatedNormal":{const r=Wet("shape",t,e,n),s=Wet("mean",t,e,n),o=Wet("stdDev",t,e,n),i=Wet("seed",t,e,n);return[j7(r,s,o,Wet("dtype",t,e,n),i)]}case"Zeros":return[v9(Wet("shape",t,e,n),Wet("dtype",t,e,n))];case"ZerosLike":return[y8(Wet("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"dynamic":return(async(t,e,n)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a,softNmsSigma:u}=Pnt(t,e,n),c=await met.nonMaxSuppressionWithScoreAsync(r,s,o,i,a,u);return[c.selectedIndices,c.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a}=Pnt(t,e,n),u=Wet("padToMaxOutputSize",t,e,n),c=await met.nonMaxSuppressionPaddedAsync(r,s,o,i,a,u);return[c.selectedIndices,c.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:s,maxOutputSize:o,iouThreshold:i,scoreThreshold:a}=Pnt(t,e,n);return[await met.nonMaxSuppressionAsync(r,s,o,i,a)]}case"Where":{const r=G4(Wet("condition",t,e,n),"bool"),s=[await J7(r)];return r.dispose(),s}case"ListDiff":return x7(Wet("x",t,e,n),Wet("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n);case"evaluation":return h6((()=>((t,e,n)=>{switch(t.op){case"LowerBound":return[d9(Wet("sortedSequence",t,e,n),Wet("values",t,e,n))];case"TopKV2":{const r=Wet("x",t,e,n),s=Wet("k",t,e,n),o=Wet("sorted",t,e,n),i=U7(r,s,o);return[i.values,i.indices]}case"UpperBound":return[K7(Wet("sortedSequence",t,e,n),Wet("values",t,e,n))];case"Unique":{const r=Wet("x",t,e,n),s=G7(r);return[s.values,s.indices]}case"UniqueV2":{const r=Wet("x",t,e,n),s=Wet("axis",t,e,n),o=G7(r,s);return[o.values,o.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"image":return h6((()=>((t,e,n)=>{switch(t.op){case"ResizeBilinear":{const r=Wet("images",t,e,n),s=Wet("size",t,e,n),o=Wet("alignCorners",t,e,n),i=Wet("halfPixelCenters",t,e,n);return[met.resizeBilinear(r,[s[0],s[1]],o,i)]}case"ResizeNearestNeighbor":{const r=Wet("images",t,e,n),s=Wet("size",t,e,n),o=Wet("alignCorners",t,e,n),i=Wet("halfPixelCenters",t,e,n);return[met.resizeNearestNeighbor(r,[s[0],s[1]],o,i)]}case"CropAndResize":{const r=Wet("image",t,e,n),s=Wet("boxes",t,e,n),o=Wet("boxInd",t,e,n),i=Wet("cropSize",t,e,n),a=Wet("method",t,e,n),u=Wet("extrapolationValue",t,e,n);return[met.cropAndResize(r,s,o,i,a,u)]}case"ImageProjectiveTransformV3":{const r=Wet("images",t,e,n),s=Wet("transforms",t,e,n),o=Wet("outputShape",t,e,n),i=Wet("fillValue",t,e,n),a=Wet("interpolation",t,e,n),u=Wet("fillMode",t,e,n);return[met.transform(r,s,a.toLowerCase(),u.toLowerCase(),i,o)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"graph":return h6((()=>((t,e,n)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const r=Wet("default",t,e,n);return[Uet(t.name,e,n)||r];case"Placeholder":return[Uet(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[Ket(Wet("x",t,e,n))];case"IdentityN":return Wet("x",t,e,n).map((t=>Ket(t)));case"Shape":return[z7(Wet("x",t,e,n).shape,"int32")];case"ShapeN":return Wet("x",t,e,n).map((t=>z7(t.shape)));case"Size":return[k8(Wet("x",t,e,n).size,"int32")];case"Rank":return[k8(Wet("x",t,e,n).rank,"int32")];case"NoOp":return[k8(1)];case"Print":const s=Wet("x",t,e,n),o=Wet("data",t,e,n),i=Wet("message",t,e,n),a=Wet("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(i);for(let t=0;t<o.length;t++)console.log(Array.prototype.slice.call(o[t].dataSync()).slice(0,a));return[s];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"logical":return h6((()=>((t,e,n)=>{switch(t.op){case"Equal":return[d8(Wet("a",t,e,n),Wet("b",t,e,n))];case"NotEqual":return[k9(Wet("a",t,e,n),Wet("b",t,e,n))];case"Greater":return[U8(Wet("a",t,e,n),Wet("b",t,e,n))];case"GreaterEqual":return[j8(Wet("a",t,e,n),Wet("b",t,e,n))];case"Less":return[X8(Wet("a",t,e,n),Wet("b",t,e,n))];case"LessEqual":return[J8(Wet("a",t,e,n),Wet("b",t,e,n))];case"LogicalAnd":return[c9(Wet("a",t,e,n),Wet("b",t,e,n))];case"LogicalNot":return[l9(Wet("a",t,e,n))];case"LogicalOr":return[f9(Wet("a",t,e,n),Wet("b",t,e,n))];case"Select":case"SelectV2":return[m8(Wet("condition",t,e,n),Wet("a",t,e,n),Wet("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"matrices":return h6((()=>((t,e,n)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[l6(Wet("a",t,e,n),Wet("b",t,e,n),Wet("transposeA",t,e,n),Wet("transposeB",t,e,n))];case"Einsum":return[w8(Wet("equation",t,e,n),...Wet("tensors",t,e,n))];case"Transpose":return[b6(Wet("x",t,e,n),Wet("perm",t,e,n))];case"_FusedMatMul":const[r,s]=Wet("fusedOps",t,e,n),o="biasadd"===r,i="prelu"===s,a=Wet("numArgs",t,e,n),u=Wet("leakyreluAlpha",t,e,n);if(o){if(i&&2!==a)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!i&&1!==a)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[c,l]=Wet("args",t,e,n);return[mtt({a:Wet("a",t,e,n),b:Wet("b",t,e,n),transposeA:Wet("transposeA",t,e,n),transposeB:Wet("transposeB",t,e,n),bias:c,activation:s,preluActivationWeights:l,leakyreluAlpha:u})];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"normalization":return h6((()=>((t,e,n)=>{switch(t.op){case"EuclideanNorm":return[R8(Wet("x",t,e,n),Wet("axis",t,e,n),Wet("keepDims",t,e,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[B5(Wet("x",t,e,n),Wet("mean",t,e,n),Wet("variance",t,e,n),Wet("offset",t,e,n),Wet("scale",t,e,n),Wet("epsilon",t,e,n))];case"LRN":return[Z8(Wet("x",t,e,n),Wet("radius",t,e,n),Wet("bias",t,e,n),Wet("alpha",t,e,n),Wet("beta",t,e,n))];case"Softmax":return[A7(Wet("x",t,e,n))];case"LogSoftmax":return[a9(Wet("x",t,e,n))];case"SparseToDense":return[ttt(Wet("sparseIndices",t,e,n),Wet("outputShape",t,e,n),Wet("sparseValues",t,e,n),Wet("defaultValue",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"reduction":return h6((()=>((t,e,n)=>{switch(t.op){case"Max":{const r=Wet("axis",t,e,n),s=Wet("keepDims",t,e,n);return[S8(Wet("x",t,e,n),r,s)]}case"Mean":{const r=Wet("axis",t,e,n),s=Wet("keepDims",t,e,n);return[w9(Wet("x",t,e,n),r,s)]}case"Min":{const r=Wet("axis",t,e,n),s=Wet("keepDims",t,e,n);return[_8(Wet("x",t,e,n),r,s)]}case"Sum":{const r=Wet("axis",t,e,n),s=Wet("keepDims",t,e,n);return[O8(Wet("x",t,e,n),r,s)]}case"All":{const r=Wet("axis",t,e,n),s=Wet("keepDims",t,e,n);return[c5(Wet("x",t,e,n),r,s)]}case"Any":{const r=Wet("axis",t,e,n),s=Wet("keepDims",t,e,n);return[l5(Wet("x",t,e,n),r,s)]}case"ArgMax":{const r=Wet("axis",t,e,n);return[f5(Wet("x",t,e,n),r)]}case"ArgMin":{const r=Wet("axis",t,e,n);return[h5(Wet("x",t,e,n),r)]}case"Prod":{const r=Wet("axis",t,e,n),s=Wet("keepDims",t,e,n);return[B9(Wet("x",t,e,n),r,s)]}case"Cumprod":{const r=Wet("axis",t,e,n),s=Wet("exclusive",t,e,n),o=Wet("reverse",t,e,n);return[a8(Wet("x",t,e,n),r,s,o)]}case"Cumsum":{const r=Wet("axis",t,e,n),s=Wet("exclusive",t,e,n),o=Wet("reverse",t,e,n);return[u8(Wet("x",t,e,n),r,s,o)]}case"Bincount":const r=Wet("x",t,e,n),s=Wet("weights",t,e,n),o=Wet("size",t,e,n);return[U5(r,s,o)];case"DenseBincount":{const r=Wet("x",t,e,n),s=Wet("weights",t,e,n),o=Wet("size",t,e,n),i=Wet("binaryOutput",t,e,n);return[c8(r,s,o,i)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"slice_join":return h6((()=>((t,e,n)=>{switch(t.op){case"ConcatV2":case"Concat":{const r=Wet("n",t,e,n),s=Wet("axis",t,e,n);let o=Wet("tensors",t,e,n);return o=o.slice(0,r),[M5(o,s)]}case"Gather":{const r=Wet("x",t,e,n),s=Wet("indices",t,e,n);return[W8(r,G4(s,"int32"),0)]}case"GatherV2":{const r=Wet("axis",t,e,n),s=Wet("batchDims",t,e,n),o=Wet("x",t,e,n),i=Wet("indices",t,e,n);return[W8(o,G4(i,"int32"),r,s)]}case"Reverse":{const r=Wet("dims",t,e,n),s=[];for(let t=0;t<r.length;t++)r[t]&&s.push(t);const o=Wet("x",t,e,n);return[h7(o,s)]}case"ReverseV2":{const r=Wet("axis",t,e,n),s=Wet("x",t,e,n);return[h7(s,r)]}case"Slice":{const r=Wet("begin",t,e,n),s=Wet("size",t,e,n);return[D5(Wet("x",t,e,n),r,s)]}case"StridedSlice":{const r=Wet("begin",t,e,n),s=Wet("end",t,e,n),o=Wet("strides",t,e,n),i=Wet("beginMask",t,e,n),a=Wet("endMask",t,e,n),u=Wet("ellipsisMask",t,e,n),c=Wet("newAxisMask",t,e,n),l=Wet("shrinkAxisMask",t,e,n),f=Wet("x",t,e,n);return[B7(f,r,s,o,i,a,u,c,l)]}case"Pack":return h6((()=>{const r=Wet("axis",t,e,n),s=Wet("tensors",t,e,n),o=s[0].shape,i=F7(s[0]).shape,a=s.map((t=>{const e=x0(t.shape,o);if(!e&&!x0(F7(t).shape,i))throw new Error("the input tensors shape does not match");return e?t:C5(t,o)}));return[L7(a,r)]}));case"Unpack":{const r=Wet("axis",t,e,n),s=Wet("tensor",t,e,n);return H7(s,r)}case"Tile":{const r=Wet("reps",t,e,n);return[P8(Wet("x",t,e,n),r)]}case"Split":case"SplitV":{const r=Wet("axis",t,e,n),s=Wet("numOrSizeSplits",t,e,n),o=Wet("x",t,e,n);return M7(o,s,r)}case"ScatterNd":{const r=Wet("indices",t,e,n),s=Wet("values",t,e,n),o=Wet("shape",t,e,n);return[Q7(r,s,o)]}case"GatherNd":{const r=Wet("x",t,e,n),s=Wet("indices",t,e,n);return[ett(r,s)]}case"SparseToDense":{const r=Wet("sparseIndices",t,e,n),s=Wet("outputShape",t,e,n),o=Wet("sparseValues",t,e,n),i=Wet("defaultValue",t,e,n);return[ttt(r,o,s,o.dtype===i.dtype?i:G4(i,o.dtype))]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"sparse":return h6((()=>((t,e,n)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:s,emptyRowIndicator:o,reverseIndexMap:i}=bet.sparseFillEmptyRows(Wet("indices",t,e,n),Wet("values",t,e,n),Wet("denseShape",t,e,n),Wet("defaultValue",t,e,n));return[r,s,o,i]}case"SparseReshape":{const{outputIndices:r,outputShape:s}=bet.sparseReshape(Wet("inputIndices",t,e,n),Wet("inputShape",t,e,n),Wet("newShape",t,e,n));return[r,s]}case"SparseSegmentMean":return[bet.sparseSegmentMean(Wet("data",t,e,n),Wet("indices",t,e,n),Wet("segmentIds",t,e,n))];case"SparseSegmentSum":return[bet.sparseSegmentSum(Wet("data",t,e,n),Wet("indices",t,e,n),Wet("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"spectral":return h6((()=>((t,e,n)=>{switch(t.op){case"FFT":return[C7(Wet("x",t,e,n))];case"IFFT":return[O7(Wet("x",t,e,n))];case"RFFT":return[R7(Wet("x",t,e,n))];case"IRFFT":return[I7(Wet("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"string":return h6((()=>((t,e,n)=>{switch(t.op){case"StringNGrams":{const{nGrams:r,nGramsSplits:s}=wet.stringNGrams(Wet("data",t,e,n),Wet("dataSplits",t,e,n),Wet("separator",t,e,n),Wet("nGramWidths",t,e,n),Wet("leftPad",t,e,n),Wet("rightPad",t,e,n),Wet("padWidth",t,e,n),Wet("preserveShortSequences",t,e,n));return[r,s]}case"StringSplit":{const{indices:r,values:s,shape:o}=wet.stringSplit(Wet("input",t,e,n),Wet("delimiter",t,e,n),Wet("skipEmpty",t,e,n));return[r,s,o]}case"StringToHashBucketFast":return[wet.stringToHashBucketFast(Wet("input",t,e,n),Wet("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"transformation":return h6((()=>((t,e,n)=>{switch(t.op){case"Cast":return[G4(Wet("x",t,e,n),Wet("dtype",t,e,n))];case"ExpandDims":{const r=Wet("axis",t,e,n);return[F8(Wet("x",t,e,n),r)]}case"Squeeze":{const r=Wet("axis",t,e,n);return[F7(Wet("x",t,e,n),r)]}case"Reshape":return[C5(Wet("x",t,e,n),Wet("shape",t,e,n))];case"MirrorPad":return[$9(Wet("x",t,e,n),Wet("padding",t,e,n),Wet("mode",t,e,n))];case"PadV2":case"Pad":return[O9(Wet("x",t,e,n),Wet("padding",t,e,n),Wet("constantValue",t,e,n))];case"SpaceToBatchND":{const r=Wet("blockShape",t,e,n),s=Wet("paddings",t,e,n);return[F9(Wet("x",t,e,n),r,s)]}case"BatchToSpaceND":{const r=Wet("blockShape",t,e,n),s=Wet("crops",t,e,n);return[P5(Wet("x",t,e,n),r,s)]}case"DepthToSpace":{const r=Wet("blockSize",t,e,n),s=Wet("dataFormat",t,e,n).toUpperCase();return[l8(Wet("x",t,e,n),r,s)]}case"BroadcastTo":return[G5(Wet("x",t,e,n),Wet("shape",t,e,n))];case"BroadcastArgs":return[j5(Wet("s0",t,e,n),Wet("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"hash_table":return(async(t,e,n,r)=>{switch(t.op){case"HashTable":case"HashTableV2":{const s=Wet("keyDType",t,e,n),o=Wet("valueDType",t,e,n),i=new Bnt(s,o);return r.addHashTable(t.name,i),[i.handle]}case"LookupTableImport":case"LookupTableImportV2":{const s=Wet("tableHandle",t,e,n,r),o=Wet("keys",t,e,n),i=Wet("values",t,e,n),a=r.getHashTableById(s.id);return[await a.import(o,i)]}case"LookupTableFind":case"LookupTableFindV2":{const s=Wet("tableHandle",t,e,n,r),o=Wet("keys",t,e,n),i=Wet("defaultValue",t,e,n),a=r.getHashTableById(s.id);return[await a.find(o,i)]}case"LookupTableSize":case"LookupTableSizeV2":{const s=Wet("tableHandle",t,e,n,r);return[r.getHashTableById(s.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n,r);case"custom":const s=zet(t.op);if(s&&s.customExecutor)return s.customExecutor(new Ant(t,e,n));throw TypeError(`Custom op ${t.op} is not registered.`);default:throw TypeError(`Unknown op '${t.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return G0(s)?s.then((t=>[].concat(t))):[].concat(s)}class znt{constructor(t={},e={},n={},r={}){this.weightMap=t,this.tensorArrayMap=e,this.tensorListMap=n,this.functionMap=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(t,e){return{id:t,frameName:e,iterationId:0}}set currentContext(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const t=[];for(let e=0;e<this.contexts.length-1;e++){const n=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(n))}t.push(""),this._currentContextIds=t}contextIdforContexts(t){return t?t.map((t=>0===t.id&&0===t.iterationId?"":`${t.frameName}-${t.iterationId}`)).join("/"):""}enterFrame(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(t){return this.weightMap[t]}addTensorArray(t){this.tensorArrayMap[t.id]=t}getTensorArray(t){return this.tensorArrayMap[t]}addTensorList(t){this.tensorListMap[t.id]=t}getTensorList(t){return this.tensorListMap[t]}dispose(t){for(const e in this.tensorArrayMap)this.tensorArrayMap[e].clearAndClose(t);for(const e in this.tensorListMap)this.tensorListMap[e].clearAndClose(t)}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wnt(t,e,n,r){const s=new Set,o=[];let i=null,a=null;const u=new Set,c=Object.keys(t).map((t=>qet(t)[0]));let l=[];null!=r&&(l=r.map((t=>qet(t.name)[0])));const f=[...e];for(;f.length>0;){const t=f.pop();(qnt(t)||Hnt(t)||Knt(t))&&null==i&&(i=t,a=i.children.map((t=>t.name)).filter((t=>s.has(t)))),s.add(t.name),null==n[t.name]&&(-1===c.indexOf(t.name)&&-1===l.indexOf(t.name)&&(0!==t.inputs.length?t.inputs.forEach((t=>{u.has(t.name)||(u.add(t.name),f.push(t))})):o.push(t.name)))}return{inputs:t,outputs:e,usedNodes:s,missingInputs:o,dynamicNode:i,syncInputs:a}}const Unt=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],jnt=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],Gnt=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function qnt(t){return Unt.indexOf(t.op)>=0}function Hnt(t){return jnt.indexOf(t.op)>=0}function Knt(t){return Gnt.indexOf(t.op)>=0}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xnt{constructor(t,e){this.graph=t,this.parent=e,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((e=>{this._functionExecutorMap[e]=new Xnt(t.functions[e],this)}))}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){const e=Object.keys(t).map((e=>t[e].map((t=>t.id))));this._weightIds=[].concat(...e),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get outputs(){return this._outputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get inputNodes(){return this._inputs.map((t=>t.signatureKey||t.name))}get outputNodes(){return this._outputs.map((t=>{const e=t.signatureKey||t.name;return t.defaultOutput?`${e}:${t.defaultOutput}`:e}))}get functions(){return Object.keys(this._functions).reduce(((t,e)=>(t[e]=this._functions[e].signature,t)),{})}getCompilationKey(t,e){const n=t.map((t=>t.name)).sort(),r=e.map((t=>t.name)).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}compile(t,e){const n=Wnt(t,e,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:s,syncInputs:o}=n;if(null!=s)throw new Error(`This execution contains the node '${s.name}', which has the dynamic op '${s.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(r.length>0){const n=e.map((t=>t.name)),s=Object.keys(t);throw new Error(`Cannot compute the outputs [${n}] from the provided inputs [${s}]. Missing the following inputs: [${r}]`)}return function(t,e,n){const{usedNodes:r,inputs:s}=n,o=[],i=Object.keys(s).map((t=>qet(t)[0])).map((e=>t.nodes[e])),a=t.initNodes;i.forEach((t=>{r.has(t.name)&&o.push(t)})),t.weights.forEach((t=>{r.has(t.name)&&o.push(t)})),null!=a&&a.forEach((t=>{r.has(t.name)&&o.push(t)}));const u=new Set,c=[];for(;o.length>0;){const t=o.pop();u.add(t.name),e[t.name]||c.push(t),t.children.forEach((t=>{!u.has(t.name)&&r.has(t.name)&&t.inputs.every((t=>u.has(t.name)))&&o.push(t)}))}return c}(this.graph,this.weightMap,n)}execute(t,e){t=this.mapInputs(t);const n=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e);const r=n.map((t=>this.graph.nodes[qet(t)[0]])),s=e.map((t=>qet(t)[0]));let o=s.map((t=>this.graph.nodes[t]));this.resetIntermediateTensors(),0===o.length&&(o=this._outputs);const i=this.getCompilationKey(r,o);let a=this.compiledMap.get(i);null==a&&(a=this.compile(t,o),this.compiledMap.set(i,a));const u={},c={};return h6((()=>{const n=new znt(this.weightMap,u,c,this.functionExecutorMap),r=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,s]=qet(e),o=[];o[s]=t[e],r[n]=o}));const o=this.getFrozenTensorIds(r),i={};for(let t=0;t<a.length;t++){const e=a[t];if(!r[e.name]){const t=Vnt(e,r,n,this._resourceManager);if(G0(t))throw new Error(`The execution of the op '${e.op}' returned a promise. Please use model.executeAsync() instead.`);r[e.name]=t,this.checkTensorForDisposal(e.name,e,r,n,o,s,i)}}return null==this.parent&&n.dispose(o),e.map((t=>Uet(t,r,n)))}))}getFrozenTensorIds(t){const e=[].concat.apply([],Object.keys(t).map((e=>t[e])).map((t=>t.map((t=>t.id)))));return new Set(e)}checkTensorForDisposal(t,e,n,r,s,o,i){"control"!==e.category&&-1===o.indexOf(t)&&(n[t].forEach((t=>{null!=t&&(i[t.id]=(i[t.id]||0)+e.children.length)})),e.inputs.forEach((t=>{if("control"!==t.category){const o=function(t,e,n){return e[Get(t,n.currentContextId)]}(t.name,n,r);null!=o&&o.forEach((t=>{if(t&&!t.kept&&!s.has(t.id)){const n=i[t.id];if(1===n){if(this.keepTensorForDebug){const[n,s]=jet(e.name,r);this.intermediateTensors[n]||(this.intermediateTensors[n]=[]),this.intermediateTensors[n][s]=t}else t.dispose();delete i[t.id]}else null!=n&&i[t.id]--}}))}})))}async executeAsync(t,e){return this._executeAsync(t,e)}disposeIntermediateTensors(){this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach((t=>this.intermediateTensors[t].forEach((t=>t.dispose())))),this.disposeTensorsMap())}disposeTensorsMap(){this.tensorsMap&&Object.keys(this.tensorsMap).forEach((t=>{this.tensorsMap[t].forEach((t=>{!t||t.kept||t.isDisposed||this.keepIds.has(t.id)||t.dispose()}))}))}getIntermediateTensors(){return this.tensorsMap}resetIntermediateTensors(){for(const t in this.intermediateTensors)this.intermediateTensors[t].forEach((t=>t.dispose())),delete this.intermediateTensors[t]}async _executeAsync(t,e,n=!1,r={},s={}){n||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e));try{this.keepTensorForDebug=K0().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(t){console.warn(t.message)}this.resetIntermediateTensors();const o=new znt(this.weightMap,r,s,this.functionExecutorMap);this.tensorsMap=await this.executeWithControlFlow(t,o,e,n);const i=e.map((t=>Uet(t,this.tensorsMap,o))),a=i.map((t=>t.id)),u=Object.keys(t).map((e=>t[e].id));return this.keepIds=new Set([...a,...u,...this.weightIds]),this.keepTensorForDebug||this.disposeTensorsMap(),null==this.parent&&o.dispose(this.keepIds),i}async executeFunctionAsync(t,e,n){const r=t.reduce(((t,e,n)=>(t[this.inputs[n].name]=e,t)),{});return this._executeAsync(r,this.outputNodes,!0,e,n)}async executeWithControlFlow(t,e,n,r){const s=Object.keys(t),o=s.map((t=>this.graph.nodes[qet(t)[0]])),i=n.map((t=>qet(t)[0]));let a=i.map((t=>this.graph.nodes[t]));0===a.length&&(a=this._outputs);const{usedNodes:u,missingInputs:c,dynamicNode:l,syncInputs:f}=Wnt(t,a,this.weightMap,this._initNodes),h=[...o,...this.graph.weights,...this._initNodes||[]].map((t=>({node:t,contexts:e.currentContext}))),p=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,r]=qet(e),s=[];s[r]=t[e],p[n]=s}));const d={},m=this.getFrozenTensorIds(p),y={};for(;h.length>0;){const t=this.processStack(o,h,e,p,y,m,i,d,u);await Promise.all(t)}null!=l||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const g=a.filter((t=>!qnt(t)&&!Uet(t.name,p,e))).map((t=>t.name));if(g.length>0){let t="";throw null!=l&&(t=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${f}]`),new Error(`Cannot compute the outputs [${g}] from the provided inputs [${s}]. Consider providing the following inputs: [${c}]. ${t}`)}return p}processStack(t,e,n,r,s,o,i,a,u){const c=[];for(;e.length>0;){const t=e.pop();n.currentContext=t.contexts;let l="";if("Enter"===t.node.op&&Wet("isConstant",t.node,r,n)&&([l]=jet(t.node.name,n)),null==r[t.node.name]){const f=Vnt(t.node,r,n,this._resourceManager);l||([l]=jet(t.node.name,n));const h=n.currentContext;G0(f)?c.push(f.then((c=>(r[l]=c,n.currentContext=h,this.checkTensorForDisposal(l,t.node,r,n,o,i,a),this.processChildNodes(t.node,e,n,r,s,u),c)))):(r[l]=f,this.checkTensorForDisposal(l,t.node,r,n,o,i,a),this.processChildNodes(t.node,e,n,r,s,u))}else this.processChildNodes(t.node,e,n,r,s,u)}return c}processChildNodes(t,e,n,r,s,o){t.children.forEach((t=>{const[i]=jet(t.name,n);!s[i]&&o.has(t.name)&&("Merge"===t.op?t.inputNames.some((t=>!!Uet(t,r,n)))&&(s[i]=!0,e.push({contexts:n.currentContext,node:t})):t.inputNames.every((t=>!!Uet(t,r,n)))&&(s[i]=!0,e.push({contexts:n.currentContext,node:t})))}))}dispose(){Object.keys(this.weightMap).forEach((t=>this.weightMap[t].forEach((t=>t.dispose()))))}checkInputShapeAndType(t){Object.keys(t).forEach((e=>{const n=t[e],[r]=qet(e),s=this.graph.nodes[r];if(s.attrParams.shape&&s.attrParams.shape.value){const t=s.attrParams.shape.value,e=t.length===n.shape.length&&n.shape.every(((e,n)=>-1===t[n]||t[n]===e));y0(e,(()=>`The shape of dict['${s.name}'] provided in model.execute(dict) must be [${t}], but was [${n.shape}]`))}s.attrParams.dtype&&s.attrParams.dtype.value&&y0(n.dtype===s.attrParams.dtype.value,(()=>`The dtype of dict['${s.name}'] provided in model.execute(dict) must be ${s.attrParams.dtype.value}, but was ${n.dtype}`))}))}mapInputs(t){const e={};for(const n in t)if(null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]){e[this._signature.inputs[n].name]=t[n]}else e[n]=t[n];return e}checkInputs(t){const e=Object.keys(t).filter((t=>{const[e]=qet(t);return null==this.graph.nodes[e]}));if(e.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${e}] that are not part of graph`)}mapOutputs(t){return t.map((t=>{if(null!=this._signature&&null!=this._signature.outputs&&null!=this._signature.outputs[t]){return this._signature.outputs[t].name}return t}),{})}checkOutputs(t){t.forEach((t=>{const[e]=qet(t);if(!this.graph.nodes[e])throw new Error(`The output '${t}' is not found in the graph`)}))}}class Jnt{constructor(t={},e={}){this.hashTableNameToHandle=t,this.hashTableMap=e}addHashTable(t,e){this.hashTableNameToHandle[t]=e.handle,this.hashTableMap[e.id]=e}getHashTableHandleByName(t){return this.hashTableNameToHandle[t]}getHashTableById(t){return this.hashTableMap[t]}dispose(){for(const t in this.hashTableMap)this.hashTableMap[t].clearAndClose(),delete this.hashTableMap[t];for(const t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ynt{constructor(t,e={}){this.modelUrl=t,this.loadOptions=e,this.version="n/a",null==e&&(this.loadOptions={}),this.resourceManager=new Jnt}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}findIOHandler(){const t=this.modelUrl;if(null!=t.load)this.handler=t;else if(null!=this.loadOptions.requestInit)this.handler=s6(t,this.loadOptions);else{const e=w4(t,this.loadOptions);if(0===e.length)e.push(s6(t,this.loadOptions));else if(e.length>1)throw new Error(`Found more than one (${e.length}) load handlers for URL '${[t]}'`);this.handler=e[0]}}load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const t=this.handler.load();return G0(t)?t.then((t=>this.loadSync(t))):this.loadSync(t)}loadSync(t){this.artifacts=t;const e=this.artifacts.modelTopology;let n;n=null!=this.artifacts.userDefinedMetadata&&null!=this.artifacts.userDefinedMetadata.signature?this.artifacts.userDefinedMetadata.signature:this.artifacts.signature,this.signature=n,this.version=`${e.versions.producer}.${e.versions.minConsumer}`;const r=a4(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new Xnt(dnt.Instance.transformGraph(e,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=t.modelInitializer&&null!=t.modelInitializer.node){const e=dnt.Instance.transformGraph(t.modelInitializer);this.initializer=new Xnt(e),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(t,e){if("string"==typeof t){const e=b4(t);if(0===e.length)throw new Error(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new Error(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}if(null==t.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return t.save(this.artifacts)}predict(t,e){return this.execute(t,this.outputNodes)}normalizeInputs(t){if(!(t instanceof O2||Array.isArray(t)))return t;if((t=Array.isArray(t)?t:[t]).length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${t.length} input tensors.`);return this.inputNodes.reduce(((e,n,r)=>(e[n]=t[r],e)),{})}normalizeOutputs(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]}execute(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=this.executor.execute(t,e);return n.length>1?n:n[0]}async executeAsync(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=await this.executor.executeAsync(t,e);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(t){return Object.keys(t).reduce(((e,n)=>(e[n]=[t[n]],e)),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var Znt=Object.freeze({__proto__:null,GraphModel:Ynt,loadGraphModel:async function(t,e={}){if(null==t)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==e&&(e={}),e.fromTFHub&&"string"==typeof t&&(t=function(t){t.endsWith("/")||(t+="/");return`${t}model.json?tfjs-format=file`}
/** @license See the LICENSE file. */(t));const n=new Ynt(t,e);return await n.load(),n},loadGraphModelSync:function(t){if(null==t)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide a url or an IOHandler that loads the model");if(!t.load)throw new Error(`modelUrl IO Handler ${t} has no load function`);const e=new Ynt(t);return e.load(),e},deregisterOp:function(t){delete Vet[t]},registerOp:function(t,e){const n={tfOpName:t,category:"custom",inputs:[],attrs:[],customExecutor:e};Vet[t]=n},version_converter:"3.18.0"}),Qnt=GQ(Znt),trt=GQ(Let),ert={};function nrt(t){return t.width*t.height}function rrt(t){var e=t.xCenter-t.width/2,n=e+t.width,r=t.yCenter-t.height/2;return{xMin:e,xMax:n,yMin:r,yMax:r+t.height,width:t.width,height:t.height}}function srt(t,e){var n=rrt(t),r=rrt(e);if(!function(t,e){return!(t.xMax<e.xMin||e.xMax<t.xMin||t.yMax<e.yMin||e.yMax<t.yMin)}(n,r))return 0;var s=nrt(function(t,e){var n=Math.max(t.xMin,e.xMin),r=Math.min(t.xMax,e.xMax),s=Math.max(t.yMin,e.yMin),o=Math.min(t.yMax,e.yMax);return{xMin:n,xMax:r,yMin:s,yMax:o,width:Math.max(r-n,0),height:Math.max(o-s,0)}}(n,r)),o=nrt(n)+nrt(r)-s;return o>0?s/o:0}
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Object.defineProperty(ert,"q",{value:!0}),ert.calculateAssociationNormRect=function(t,e){var n=[];return t.forEach((function(t){return t.forEach((function(t){(n=n.filter((function(n){return srt(t,n)<=e}))).push(t)}))})),n};var ort={},irt=UQ&&UQ.tt||function(){return irt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},irt.apply(this,arguments)};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(ort,"q",{value:!0}),ort.calculateLandmarkProjection=function(t,e,n){void 0===n&&(n={ignoreRotation:!1});for(var r=[],s=0,o=t;s<o.length;s++){var i=o[s],a=i.x-.5,u=i.y-.5,c=n.ignoreRotation?0:e.rotation,l=Math.cos(c)*a-Math.sin(c)*u,f=Math.sin(c)*a+Math.cos(c)*u;l=l*e.width+e.xCenter,f=f*e.height+e.yCenter;var h=i.z*e.width,p=irt({},i);p.x=l,p.y=f,p.z=h,r.push(p)}return r};var art={},urt=UQ&&UQ.tt||function(){return urt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},urt.apply(this,arguments)};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(art,"q",{value:!0}),art.calculateWorldLandmarkProjection=function(t,e){for(var n=[],r=0,s=t;r<s.length;r++){var o=s[r],i=o.x,a=o.y,u=e.rotation,c=Math.cos(u)*i-Math.sin(u)*a,l=Math.sin(u)*i+Math.cos(u)*a,f=urt({},o);f.x=c,f.y=l,n.push(f)}return n};var crt={},lrt={};Object.defineProperty(lrt,"q",{value:!0});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var frt=trt;function hrt(t,e){frt.util.assert(0!==t.width,(function(){return e+" width cannot be 0."})),frt.util.assert(0!==t.height,(function(){return e+" height cannot be 0."}))}lrt.getImageSize=function(t){return t instanceof frt.Tensor?{height:t.shape[0],width:t.shape[1]}:{height:t.height,width:t.width}},lrt.normalizeRadians=function(t){return t-2*Math.PI*Math.floor((t+Math.PI)/(2*Math.PI))},lrt.transformValueRange=function(t,e,n,r){var s=e-t,o=r-n;if(0===s)throw new Error("Original min and max are both "+t+", range cannot be 0.");var i=o/s;return{scale:i,offset:n-t*i}},lrt.toImageTensor=function(t){return t instanceof frt.Tensor?t:frt.browser.fromPixels(t)},lrt.padRoi=function(t,e,n){if(void 0===n&&(n=!1),!n)return{top:0,left:0,right:0,bottom:0};var r=e.height,s=e.width;hrt(e,"targetSize"),hrt(t,"roi");var o,i,a=r/s,u=t.height/t.width,c=0,l=0;return a>u?(o=t.width,i=t.width*a,l=(1-u/a)/2):(o=t.height/a,i=t.height,c=(1-a/u)/2),t.width=o,t.height=i,{top:l,left:c,right:c,bottom:l}},lrt.getRoi=function(t,e){return e?{xCenter:e.xCenter*t.width,yCenter:e.yCenter*t.height,width:e.width*t.width,height:e.height*t.height,rotation:e.rotation}:{xCenter:.5*t.width,yCenter:.5*t.height,width:t.width,height:t.height,rotation:0}},lrt.getProjectiveTransformMatrix=function(t,e,n,r){hrt(r,"inputResolution");var s=1/e.width,o=1/e.height,i=t.xCenter,a=t.yCenter,u=Math.cos(t.rotation),c=Math.sin(t.rotation),l=n?-1:1,f=t.width,h=t.height;return[1/r.width*f*u*l*s*e.width,1/r.height*-h*c*s*e.width,(-.5*f*u*l+.5*h*c+i)*s*e.width,1/r.width*f*c*l*o*e.height,1/r.height*h*u*o*e.height,(-.5*h*u-.5*f*c*l+a)*o*e.height,0,0]},Object.defineProperty(crt,"q",{value:!0});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var prt=trt,drt=lrt;crt.convertImageToTensor=function(t,e,n){var r=e.inputResolution,s=e.keepAspectRatio,o=drt.getImageSize(t),i=drt.getRoi(o,n),a=drt.padRoi(i,r,s);return{imageTensor:prt.tidy((function(){var e=drt.toImageTensor(t),n=prt.tensor2d(drt.getProjectiveTransformMatrix(i,o,!1,r),[1,8]);return prt.image.transform(prt.expandDims(prt.cast(e,"float32")),n,"bilinear","nearest",0,[r.height,r.width])})),padding:a}};var mrt={};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yrt(t,e,n,r){return 1===r?.5*(t+e):t+(e-t)*n/(r-1)}Object.defineProperty(mrt,"q",{value:!0}),mrt.createSsdAnchors=function(t){for(var e=[],n=0;n<t.numLayers;){for(var r=[],s=[],o=[],i=[],a=n;a<t.strides.length&&t.strides[a]===t.strides[n];){var u=yrt(t.minScale,t.maxScale,a,t.strides.length);if(0===a&&t.reduceBoxesInLowestLayer)o.push(1),o.push(2),o.push(.5),i.push(.1),i.push(u),i.push(u);else{for(var c=0;c<t.aspectRatios.length;++c)o.push(t.aspectRatios[c]),i.push(u);if(t.interpolatedScaleAspectRatio>0){var l=a===t.strides.length-1?1:yrt(t.minScale,t.maxScale,a+1,t.strides.length);i.push(Math.sqrt(u*l)),o.push(t.interpolatedScaleAspectRatio)}}a++}for(var f=0;f<o.length;++f){var h=Math.sqrt(o[f]);r.push(i[f]/h),s.push(i[f]*h)}var p=0,d=0;if(t.featureMapHeight.length>0)p=t.featureMapHeight[n],d=t.featureMapWidth[n];else{var m=t.strides[n];p=Math.ceil(t.inputSizeHeight/m),d=Math.ceil(t.inputSizeWidth/m)}for(var y=0;y<p;++y)for(var g=0;g<d;++g)for(var b=0;b<r.length;++b){var w={xCenter:(g+t.anchorOffsetX)/d,yCenter:(y+t.anchorOffsetY)/p,width:0,height:0};t.fixedAnchorSize?(w.width=1,w.height=1):(w.width=s[b],w.height=r[b]),e.push(w)}n=a}return e};var grt={};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(grt,"q",{value:!0});var brt=lrt;function wrt(t,e,n){var r,s=t.locationData,o=n.rotationVectorStartKeypointIndex,i=n.rotationVectorEndKeypointIndex;r=n.rotationVectorTargetAngle?n.rotationVectorTargetAngle:Math.PI*n.rotationVectorTargetAngleDegree/180;var a=s.relativeKeypoints[o].x*e.width,u=s.relativeKeypoints[o].y*e.height,c=s.relativeKeypoints[i].x*e.width,l=s.relativeKeypoints[i].y*e.height;return brt.normalizeRadians(r-Math.atan2(-(l-u),c-a))}grt.computeRotation=wrt,grt.calculateDetectionsToRects=function(t,e,n){var r=t.locationData.relativeBoundingBox,s=wrt(t,e,n);return{xCenter:r.xMin+r.width/2,yCenter:r.yMin+r.height/2,width:r.width,height:r.height,rotation:s}};var vrt={},xrt={};Object.defineProperty(xrt,"q",{value:!0});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var Nrt=trt;xrt.splitDetectionResult=function(t){return Nrt.tidy((function(){return[Nrt.slice(t,[0,0,0],[1,-1,1]),Nrt.slice(t,[0,0,1],[1,-1,-1])]}))},Object.defineProperty(vrt,"q",{value:!0});var $rt=trt,Ert=xrt;vrt.detectorInference=function(t,e){return $rt.tidy((function(){var n=e.predict(t),r=Ert.splitDetectionResult(n),s=r[0],o=r[1];return{boxes:$rt.squeeze(o),logits:$rt.squeeze(s)}}))};var Srt={},_rt=UQ&&UQ.et||function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?s(t.value):new n((function(e){e(t.value)})).then(i,a)}u((r=r.apply(t,e||[])).next())}))},Trt=UQ&&UQ.nt||function(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=i.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(Srt,"q",{value:!0});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var krt=trt;Srt.nonMaxSuppression=function(t,e,n,r){return _rt(this,void 0,void 0,(function(){var s,o,i,a,u;return Trt(this,(function(c){switch(c.label){case 0:return t.sort((function(t,e){return Math.max.apply(Math,e.score)-Math.max.apply(Math,t.score)})),s=krt.tensor2d(t.map((function(t){return[t.locationData.relativeBoundingBox.yMin,t.locationData.relativeBoundingBox.xMin,t.locationData.relativeBoundingBox.yMax,t.locationData.relativeBoundingBox.xMax]}))),o=krt.tensor1d(t.map((function(t){return t.score[0]}))),[4,krt.image.nonMaxSuppressionAsync(s,o,e,n,r)];case 1:return[4,(i=c.sent()).array()];case 2:return a=c.sent(),u=t.filter((function(t,e){return a.indexOf(e)>-1})),krt.dispose([s,o,i]),[2,u]}}))}))};var Art={},Crt=UQ&&UQ.tt||function(){return Crt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},Crt.apply(this,arguments)};Object.defineProperty(Art,"q",{value:!0}),Art.normalizedKeypointsToKeypoints=function(t,e){return t.map((function(t){var n=Crt({},t,{x:t.x*e.width,y:t.y*e.height});return null!=t.z&&(n.z=t.z*e.width),n}))};var Ort={};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(Ort,"q",{value:!0}),Ort.removeDetectionLetterbox=function(t,e){void 0===t&&(t=[]);for(var n=e.left,r=e.top,s=e.left+e.right,o=e.top+e.bottom,i=0;i<t.length;i++){var a=t[i],u=a.locationData.relativeBoundingBox,c=(u.xMin-n)/(1-s),l=(u.yMin-r)/(1-o),f=u.width/(1-s),h=u.height/(1-o);u.xMin=c,u.yMin=l,u.width=f,u.height=h;for(var p=0;p<a.locationData.relativeKeypoints.length;++p){var d=a.locationData.relativeKeypoints[p],m=(d.x-n)/(1-s),y=(d.y-r)/(1-o);d.x=m,d.y=y}}return t};var Irt={},Mrt=UQ&&UQ.tt||function(){return Mrt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},Mrt.apply(this,arguments)};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(Irt,"q",{value:!0}),Irt.removeLandmarkLetterbox=function(t,e){var n=e.left,r=e.top,s=e.left+e.right,o=e.top+e.bottom;return t.map((function(t){return Mrt({},t,{x:(t.x-n)/(1-s),y:(t.y-r)/(1-o),z:t.z/(1-s)})}))};var Rrt={};Object.defineProperty(Rrt,"q",{value:!0});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var Drt=trt,Frt=lrt;Rrt.shiftImageValue=function(t,e){var n=Frt.transformValueRange(0,255,e[0],e[1]);return Drt.tidy((function(){return Drt.add(Drt.mul(t,n.scale),n.offset)}))};var Lrt={},Prt=UQ&&UQ.et||function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?s(t.value):new n((function(e){e(t.value)})).then(i,a)}u((r=r.apply(t,e||[])).next())}))},Brt=UQ&&UQ.nt||function(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=i.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(Lrt,"q",{value:!0});
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var Vrt=trt;function zrt(t,e,n){return Prt(this,void 0,void 0,(function(){var r,s,o,i,a,u,c,l,f,h,p,d;return Brt(this,(function(m){switch(m.label){case 0:return r=[],[4,t.data()];case 1:return s=m.sent(),[4,e.data()];case 2:for(o=m.sent(),i=0;i<n.numBoxes;++i)if(!(null!=n.minScoreThresh&&o[i]<n.minScoreThresh||(a=i*n.numCoords,u=Wrt(s[a+0],s[a+1],s[a+2],s[a+3],o[i],n.flipVertically,i),(c=u.locationData.relativeBoundingBox).width<0||c.height<0))){if(n.numKeypoints>0)for((l=u.locationData).relativeKeypoints=[],f=n.numKeypoints*n.numValuesPerKeypoint,h=0;h<f;h+=n.numValuesPerKeypoint)p=a+n.keypointCoordOffset+h,d={x:s[p+0],y:n.flipVertically?1-s[p+1]:s[p+1]},l.relativeKeypoints.push(d);r.push(u)}return[2,r]}}))}))}function Wrt(t,e,n,r,s,o,i){return{score:[s],ind:i,locationData:{relativeBoundingBox:{xMin:e,yMin:o?1-n:t,xMax:r,yMax:o?1-t:n,width:r-e,height:n-t}}}}Lrt.tensorsToDetections=function(t,e,n){return Prt(this,void 0,void 0,(function(){var r,s,o,i,a;return Brt(this,(function(u){switch(u.label){case 0:return r=t[0],s=t[1],o=function(t,e,n){return Vrt.tidy((function(){var r,s,o,i;n.reverseOutputOrder?(s=Vrt.squeeze(Vrt.slice(t,[0,n.boxCoordOffset+0],[-1,1])),r=Vrt.squeeze(Vrt.slice(t,[0,n.boxCoordOffset+1],[-1,1])),i=Vrt.squeeze(Vrt.slice(t,[0,n.boxCoordOffset+2],[-1,1])),o=Vrt.squeeze(Vrt.slice(t,[0,n.boxCoordOffset+3],[-1,1]))):(r=Vrt.squeeze(Vrt.slice(t,[0,n.boxCoordOffset+0],[-1,1])),s=Vrt.squeeze(Vrt.slice(t,[0,n.boxCoordOffset+1],[-1,1])),o=Vrt.squeeze(Vrt.slice(t,[0,n.boxCoordOffset+2],[-1,1])),i=Vrt.squeeze(Vrt.slice(t,[0,n.boxCoordOffset+3],[-1,1]))),s=Vrt.add(Vrt.mul(Vrt.div(s,n.xScale),e.w),e.x),r=Vrt.add(Vrt.mul(Vrt.div(r,n.yScale),e.h),e.y),n.applyExponentialOnBoxSize?(o=Vrt.mul(Vrt.exp(Vrt.div(o,n.hScale)),e.h),i=Vrt.mul(Vrt.exp(Vrt.div(i,n.wScale)),e.w)):(o=Vrt.mul(Vrt.div(o,n.hScale),e.h),i=Vrt.mul(Vrt.div(i,n.wScale),e.h));var a=Vrt.sub(r,Vrt.div(o,2)),u=Vrt.sub(s,Vrt.div(i,2)),c=Vrt.add(r,Vrt.div(o,2)),l=Vrt.add(s,Vrt.div(i,2)),f=Vrt.concat([Vrt.reshape(a,[n.numBoxes,1]),Vrt.reshape(u,[n.numBoxes,1]),Vrt.reshape(c,[n.numBoxes,1]),Vrt.reshape(l,[n.numBoxes,1])],1);if(n.numKeypoints)for(var h=0;h<n.numKeypoints;++h){var p=n.keypointCoordOffset+h*n.numValuesPerKeypoint,d=void 0,m=void 0;n.reverseOutputOrder?(d=Vrt.squeeze(Vrt.slice(t,[0,p],[-1,1])),m=Vrt.squeeze(Vrt.slice(t,[0,p+1],[-1,1]))):(m=Vrt.squeeze(Vrt.slice(t,[0,p],[-1,1])),d=Vrt.squeeze(Vrt.slice(t,[0,p+1],[-1,1])));var y=Vrt.add(Vrt.mul(Vrt.div(d,n.xScale),e.w),e.x),g=Vrt.add(Vrt.mul(Vrt.div(m,n.yScale),e.h),e.y);f=Vrt.concat([f,Vrt.reshape(y,[n.numBoxes,1]),Vrt.reshape(g,[n.numBoxes,1])],1)}return f}))}(s,e,n),i=Vrt.tidy((function(){var t=r;return n.sigmoidScore?(null!=n.scoreClippingThresh&&(t=Vrt.clipByValue(r,-n.scoreClippingThresh,n.scoreClippingThresh)),t=Vrt.sigmoid(t)):t})),[4,zrt(o,i,n)];case 1:return a=u.sent(),Vrt.dispose([o,i]),[2,a]}}))}))},Lrt.convertToDetections=zrt;var Urt={},jrt={};Object.defineProperty(jrt,"q",{value:!0}),jrt.sigmoid=
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(t){return 1/(1+Math.exp(-t))};var Grt=UQ&&UQ.et||function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?s(t.value):new n((function(e){e(t.value)})).then(i,a)}u((r=r.apply(t,e||[])).next())}))},qrt=UQ&&UQ.nt||function(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=i.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(Urt,"q",{value:!0});var Hrt=jrt;Urt.tensorsToLandmarks=function(t,e,n,r){return Grt(this,void 0,void 0,(function(){var s,o,i,a,u,c,l,f;return qrt(this,(function(h){switch(h.label){case 0:return n=n||e.flipHorizontally||!1,r=r||e.flipVertically||!1,s=t.size,o=s/e.numLandmarks,[4,t.data()];case 1:for(i=h.sent(),a=[],u=0;u<e.numLandmarks;++u)c=u*o,(f={x:0,y:0}).x=n?e.inputImageWidth-i[c]:i[c],o>1&&(f.y=r?e.inputImageHeight-i[c+1]:i[c+1]),o>2&&(f.z=i[c+2]),o>3&&(f.score=(p=e.visibilityActivation,d=i[c+3],"none"===p?d:Hrt.sigmoid(d))),a.push(f);for(l=0;l<a.length;++l)(f=a[l]).x=f.x/e.inputImageWidth,f.y=f.y/e.inputImageHeight,f.z=f.z/e.inputImageWidth/(e.normalizeZ||1);return[2,a]}var p,d}))}))};var Krt={};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(Krt,"q",{value:!0});var Xrt=lrt;function Jrt(t,e){return null!=e.rotation?t+=e.rotation:null!=e.rotationDegree&&(t+=Math.PI*e.rotationDegree/180),Xrt.normalizeRadians(t)}Krt.transformNormalizedRect=function(t,e,n){var r=t.width,s=t.height,o=t.rotation;if(null==n.rotation&&null==n.rotationDegree||(o=Jrt(o,n)),0===o)t.xCenter=t.xCenter+r*n.shiftX,t.yCenter=t.yCenter+s*n.shiftY;else{var i=(e.width*r*n.shiftX*Math.cos(o)-e.height*s*n.shiftY*Math.sin(o))/e.width,a=(e.width*r*n.shiftX*Math.sin(o)+e.height*s*n.shiftY*Math.cos(o))/e.height;t.xCenter=t.xCenter+i,t.yCenter=t.yCenter+a}if(n.squareLong){var u=Math.max(r*e.width,s*e.height);r=u/e.width,s=u/e.height}else if(n.squareShort){var c=Math.min(r*e.width,s*e.height);r=c/e.width,s=c/e.height}return t.width=r*n.scaleX,t.height=s*n.scaleY,t},Krt.computeNewRotation=Jrt;var Yrt={};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(Yrt,"q",{value:!0});var Zrt=lrt;Yrt.handLandmarksToRect=function(t,e){for(var n=function(t,e){var n=t[0].x*e.width,r=t[0].y*e.height,s=(t[4].x+t[8].x)/2,o=(t[4].y+t[8].y)/2;return s=(s+t[6].x)/2*e.width,o=(o+t[6].y)/2*e.height,Zrt.normalizeRadians(Math.PI/2-Math.atan2(-(o-r),s-n))}(t,e),r=Zrt.normalizeRadians(-n),s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,u=0,c=t;u<c.length;u++){var l=(y=c[u]).x,f=y.y;s=Math.min(s,l),o=Math.max(o,l),i=Math.min(i,f),a=Math.max(a,f)}var h=(o+s)/2,p=(a+i)/2;s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(var d=0,m=t;d<m.length;d++){var y,g=((y=m[d]).x-h)*e.width,b=(y.y-p)*e.height,w=g*Math.cos(r)-b*Math.sin(r),v=g*Math.sin(r)+b*Math.cos(r);s=Math.min(s,w),o=Math.max(o,w),i=Math.min(i,v),a=Math.max(a,v)}var x=(o+s)/2,N=(a+i)/2,$=x*Math.cos(n)-N*Math.sin(n)+e.width*h,E=x*Math.sin(n)+N*Math.cos(n)+e.height*p,S=(o-s)/e.width,_=(a-i)/e.height;return{xCenter:$/e.width,yCenter:E/e.height,width:S,height:_,rotation:n}};var Qrt,tst={};Qrt=tst,
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
Object.defineProperty(Qrt,"q",{value:!0}),Qrt.DEFAULT_MPHANDS_DETECTOR_MODEL_URL_LITE="https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/detector/lite/1",Qrt.DEFAULT_MPHANDS_DETECTOR_MODEL_URL_FULL="https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/detector/full/1",Qrt.DEFAULT_MPHANDS_LANDMARK_MODEL_URL_LITE="https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/landmark/lite/1",Qrt.DEFAULT_MPHANDS_LANDMARK_MODEL_URL_FULL="https://tfhub.dev/mediapipe/tfjs-model/handpose_3d/landmark/full/1",Qrt.MPHANDS_DETECTOR_ANCHOR_CONFIGURATION={reduceBoxesInLowestLayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:4,minScale:.1484375,maxScale:.75,inputSizeHeight:192,inputSizeWidth:192,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,16,16],aspectRatios:[1],fixedAnchorSize:!0},Qrt.DEFAULT_MPHANDS_MODEL_CONFIG={runtime:"tfjs",modelType:"full",maxHands:2,detectorModelUrl:Qrt.DEFAULT_MPHANDS_DETECTOR_MODEL_URL_FULL,landmarkModelUrl:Qrt.DEFAULT_MPHANDS_LANDMARK_MODEL_URL_FULL},Qrt.DEFAULT_MPHANDS_ESTIMATION_CONFIG={flipHorizontal:!1,staticImageMode:!1},Qrt.MPHANDS_TENSORS_TO_DETECTION_CONFIGURATION={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2016,numCoords:18,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:7,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:192,yScale:192,hScale:192,wScale:192,minScoreThresh:.5},Qrt.MPHANDS_DETECTOR_NON_MAX_SUPPRESSION_CONFIGURATION={minScoreThreshold:-1,minSuppressionThreshold:.3},Qrt.MPHANDS_DETECTOR_RECT_TRANSFORMATION_CONFIG={shiftX:0,shiftY:-.5,scaleX:2.6,scaleY:2.6,squareLong:!0},Qrt.MPHANDS_LANDMARK_RECT_TRANSFORMATION_CONFIG={shiftX:0,shiftY:-.1,scaleX:2,scaleY:2,squareLong:!0},Qrt.MPHANDS_DETECTOR_IMAGE_TO_TENSOR_CONFIG={inputResolution:{width:192,height:192},keepAspectRatio:!0},Qrt.MPHANDS_LANDMARK_IMAGE_TO_TENSOR_CONFIG={inputResolution:{width:224,height:224},keepAspectRatio:!0},Qrt.MPHANDS_HAND_PRESENCE_SCORE=.5,Qrt.MPHANDS_MIN_SIMILARITY_THRESHOLD=.5,Qrt.MPHANDS_TENSORS_TO_LANDMARKS_CONFIG={numLandmarks:21,inputImageWidth:224,inputImageHeight:224,normalizeZ:.4,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1},Qrt.MPHANDS_TENSORS_TO_WORLD_LANDMARKS_CONFIG={numLandmarks:21,inputImageWidth:1,inputImageHeight:1,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1};var est={},nst=UQ&&UQ.tt||function(){return nst=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},nst.apply(this,arguments)};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(est,"q",{value:!0});var rst=tst;est.validateModelConfig=function(t){if(null==t)return nst({},rst.DEFAULT_MPHANDS_MODEL_CONFIG);var e=nst({},t);if(e.runtime="tfjs",null==e.maxHands&&(e.maxHands=rst.DEFAULT_MPHANDS_MODEL_CONFIG.maxHands),null==e.modelType&&(e.modelType=rst.DEFAULT_MPHANDS_MODEL_CONFIG.modelType),"lite"!==e.modelType&&"full"!==e.modelType)throw new Error("Model type must be one of lite or full, but got "+e.modelType);if(null==e.detectorModelUrl)if("lite"===e.modelType)e.detectorModelUrl=rst.DEFAULT_MPHANDS_DETECTOR_MODEL_URL_LITE;else e.detectorModelUrl=rst.DEFAULT_MPHANDS_DETECTOR_MODEL_URL_FULL;if(null==e.landmarkModelUrl)if("lite"===e.modelType)e.landmarkModelUrl=rst.DEFAULT_MPHANDS_LANDMARK_MODEL_URL_LITE;else e.landmarkModelUrl=rst.DEFAULT_MPHANDS_LANDMARK_MODEL_URL_FULL;return e},est.validateEstimationConfig=function(t){if(null==t)return nst({},rst.DEFAULT_MPHANDS_ESTIMATION_CONFIG);var e=nst({},t);return null==e.flipHorizontal&&(e.flipHorizontal=rst.DEFAULT_MPHANDS_ESTIMATION_CONFIG.flipHorizontal),null==e.staticImageMode&&(e.staticImageMode=rst.DEFAULT_MPHANDS_ESTIMATION_CONFIG.staticImageMode),e};
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var sst=UQ&&UQ.et||function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?s(t.value):new n((function(e){e(t.value)})).then(i,a)}u((r=r.apply(t,e||[])).next())}))},ost=UQ&&UQ.nt||function(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=i.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(l0,"q",{value:!0});var ist=Qnt,ast=trt,ust=YQ,cst=ert,lst=ort,fst=art,hst=crt,pst=mrt,dst=grt,mst=vrt,yst=lrt,gst=Srt,bst=Art,wst=Ort,vst=Irt,xst=Rrt,Nst=Lrt,$st=Urt,Est=Krt,Sst=Yrt,_st=tst,Tst=est,kst=function(){function t(t,e,n){this.detectorModel=t,this.landmarkModel=e,this.maxHands=n,this.prevHandRectsFromLandmarks=null,this.anchors=pst.createSsdAnchors(_st.MPHANDS_DETECTOR_ANCHOR_CONFIGURATION);var r=ast.tensor1d(this.anchors.map((function(t){return t.width}))),s=ast.tensor1d(this.anchors.map((function(t){return t.height}))),o=ast.tensor1d(this.anchors.map((function(t){return t.xCenter}))),i=ast.tensor1d(this.anchors.map((function(t){return t.yCenter})));this.anchorTensor={x:o,y:i,w:r,h:s}}return t.prototype.estimateHands=function(t,e){return sst(this,void 0,void 0,(function(){var n,r,s,o,i,a,u,c,l,f,h,p,d,m,y,g,b,w,v=this;return ost(this,(function(x){switch(x.label){case 0:return n=Tst.validateEstimationConfig(e),null==t?(this.reset(),[2,[]]):(r=yst.getImageSize(t),s=ast.tidy((function(){var e=ast.cast(yst.toImageTensor(t),"float32");if(n.flipHorizontal){e=ast.squeeze(ast.image.flipLeftRight(ast.expandDims(e,0)),[0])}return e})),o=this.prevHandRectsFromLandmarks,n.staticImageMode||null==o||o.length<this.maxHands?[4,this.detectPalm(s)]:[3,2]);case 1:return 0===(a=x.sent()).length?(this.reset(),s.dispose(),[2,[]]):(u=a.map((function(t){return v.palmDetectionToRoi(t,r)})),i=u,[3,3]);case 2:i=o,x.label=3;case 3:return i=cst.calculateAssociationNormRect([i],_st.MPHANDS_MIN_SIMILARITY_THRESHOLD),[4,Promise.all(i.map((function(t){return v.handLandmarks(t,s)})))];case 4:for(c=x.sent(),l=[],this.prevHandRectsFromLandmarks=[],f=0,h=c;f<h.length;f++)null!=(p=h[f])&&(d=p.landmarks,m=p.worldLandmarks,y=p.handScore,g=p.handedness,this.prevHandRectsFromLandmarks.push(this.handLandmarksToRoi(d,r)),null!=(b=bst.normalizedKeypointsToKeypoints(d,r))&&b.forEach((function(t,e){delete t.z,t.name=ust.MEDIAPIPE_KEYPOINTS[e]})),null!=(w=m)&&w.forEach((function(t,e){t.name=ust.MEDIAPIPE_KEYPOINTS[e]})),l.push({keypoints:b,keypoints3D:w,handedness:g,score:y}));return s.dispose(),[2,l]}}))}))},t.prototype.dispose=function(){this.detectorModel.dispose(),this.landmarkModel.dispose(),ast.dispose([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h])},t.prototype.reset=function(){this.prevHandRectsFromLandmarks=null},t.prototype.detectPalm=function(t){return sst(this,void 0,void 0,(function(){var e,n,r,s,o,i,a,u,c,l;return ost(this,(function(f){switch(f.label){case 0:return e=hst.convertImageToTensor(t,_st.MPHANDS_DETECTOR_IMAGE_TO_TENSOR_CONFIG),n=e.imageTensor,r=e.padding,s=xst.shiftImageValue(n,[0,1]),o=mst.detectorInference(s,this.detectorModel),i=o.boxes,a=o.logits,[4,Nst.tensorsToDetections([a,i],this.anchorTensor,_st.MPHANDS_TENSORS_TO_DETECTION_CONFIGURATION)];case 1:return 0===(u=f.sent()).length?(ast.dispose([n,s,a,i]),[2,u]):[4,gst.nonMaxSuppression(u,this.maxHands,_st.MPHANDS_DETECTOR_NON_MAX_SUPPRESSION_CONFIGURATION.minSuppressionThreshold,_st.MPHANDS_DETECTOR_NON_MAX_SUPPRESSION_CONFIGURATION.minScoreThreshold)];case 2:return c=f.sent(),l=wst.removeDetectionLetterbox(c,r),ast.dispose([n,s,a,i]),[2,l]}}))}))},t.prototype.palmDetectionToRoi=function(t,e){var n=dst.calculateDetectionsToRects(t,e,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:2,rotationVectorTargetAngleDegree:90});return Est.transformNormalizedRect(n,e,_st.MPHANDS_DETECTOR_RECT_TRANSFORMATION_CONFIG)},t.prototype.handLandmarks=function(t,e){return sst(this,void 0,void 0,(function(){var n,r,s,o,i,a,u,c,l,f,h,p,d,m,y,g,b;return ost(this,(function(w){switch(w.label){case 0:return n=hst.convertImageToTensor(e,_st.MPHANDS_LANDMARK_IMAGE_TO_TENSOR_CONFIG,t),r=n.imageTensor,s=n.padding,o=xst.shiftImageValue(r,[0,1]),i=this.landmarkModel.execute(o,["Identity_2:0","Identity_1:0","Identity:0","Identity_3:0"]),a=i[0],u=i[1],c=i[2],l=i[3],[4,u.data()];case 1:return(f=w.sent()[0])<_st.MPHANDS_HAND_PRESENCE_SCORE?(ast.dispose(i),ast.dispose([r,o]),[2,null]):[4,c.data()];case 2:return h=w.sent()[0],p=h>=.5?"Left":"Right",[4,$st.tensorsToLandmarks(a,_st.MPHANDS_TENSORS_TO_LANDMARKS_CONFIG)];case 3:return d=w.sent(),[4,$st.tensorsToLandmarks(l,_st.MPHANDS_TENSORS_TO_WORLD_LANDMARKS_CONFIG)];case 4:return m=w.sent(),y=vst.removeLandmarkLetterbox(d,s),g=lst.calculateLandmarkProjection(y,t),b=fst.calculateWorldLandmarkProjection(m,t),ast.dispose(i),ast.dispose([r,o]),[2,{landmarks:g,worldLandmarks:b,handScore:f,handedness:p}]}}))}))},t.prototype.handLandmarksToRoi=function(t,e){var n=[].concat(t.slice(0,4),t.slice(5,7),t.slice(9,11),t.slice(13,15),t.slice(17,19)),r=Sst.handLandmarksToRect(n,e);return Est.transformNormalizedRect(r,e,_st.MPHANDS_LANDMARK_RECT_TRANSFORMATION_CONFIG)},t}();l0.load=function(t){return sst(this,void 0,void 0,(function(){var e,n,r,s,o,i;return ost(this,(function(a){switch(a.label){case 0:return e=Tst.validateModelConfig(t),n=e.detectorModelUrl.indexOf("https://tfhub.dev")>-1,r=e.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,Promise.all([ist.loadGraphModel(e.detectorModelUrl,{fromTFHub:n}),ist.loadGraphModel(e.landmarkModelUrl,{fromTFHub:r})])];case 1:return s=a.sent(),o=s[0],i=s[1],[2,new kst(o,i,e.maxHands)]}}))}))};var Ast={};!function(t){Object.defineProperty(t,"q",{value:!0}),(t.SupportedModels||(t.SupportedModels={})).MediaPipeHands="MediaPipeHands"}(Ast);
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var Cst=UQ&&UQ.et||function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?s(t.value):new n((function(e){e(t.value)})).then(i,a)}u((r=r.apply(t,e||[])).next())}))},Ost=UQ&&UQ.nt||function(t,e){var n,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=i.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(HQ,"q",{value:!0});var Ist=KQ,Mst=l0,Rst=Ast;HQ.createDetector=function(t,e){return Cst(this,void 0,void 0,(function(){var n,r;return Ost(this,(function(s){if(t===Rst.SupportedModels.MediaPipeHands){if(r=void 0,null!=(n=e)){if("tfjs"===n.runtime)return[2,Mst.load(n)];if("mediapipe"===n.runtime)return[2,Ist.load(n)];r=n.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+r)}throw new Error(t+" is not a supported model name.")}))}))},function(t){Object.defineProperty(t,"q",{value:!0});var e=HQ;t.createDetector=e.createDetector,
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(Ast)}(qQ);const Dst=WQ({__proto__:null,default:jQ(qQ)},[qQ]),Fst=ZQ.MEDIAPIPE_KEYPOINTS;let Lst;class Pst extends o{get poseType(){return"handpose"}get parts(){return Fst}async onMetadata(){super.onMetadata(),await async function(){const t=Dst.SupportedModels.MediaPipeHands;Lst=await Dst.createDetector(t,{runtime:"tfjs",modelType:"full"})}(),this.poseDetectionFrame()}async poseDetectionFrame(){if((this.isPlaying||this.forceOneTimePoseProcess)&&this.videoEl.readyState>1){const t=await(async(t,e,n=0)=>{const r=[];Lst&&(await Lst.estimateHands(t.videoElement)).forEach(((s,o)=>{var i;if(s.score>n){const n={time:Date.now()-e?e:0,score:s.score,pose:o,points:[],aspectRatio:t.aspectRatio};null===(i=s.keypoints)||void 0===i||i.forEach((e=>{n.points.push({name:e.name,position:[e.x/t.videoElement.width,e.y/t.videoElement.height]})})),r.push(n)}}));return r})(this,this.recordingStartTime,this.minConfidence/100);this.onPoseFrame(t)}requestAnimationFrame((()=>this.poseDetectionFrame())),this.forceOneTimePoseProcess=!1}}customElements.define("handpose-video",Pst);class Bst extends n{constructor(){super(),this.playStartTime=0,this.currentKeyframe=0,this.keyframes=[],this._currentTime=0,this.attachShadow({mode:"open"}),this.shadowRoot&&(this.shadowRoot.innerHTML="\n            <style>\n                :host {\n                    display: inline-block;\n                    overflow: hidden;\n                    position: relative;\n                    background-color: black;\n                }\n                \n                ::slotted(*) {\n                    position: absolute;\n                    width: 100%;\n                }\n            </style>\n            <slot></slot>")}static get observedAttributes(){return["islooping","src"]}set recording(t){this.currentKeyframe=0,this._currentTime=0,this.playStartTime=Date.now(),this._isPlaying=!1,this.keyframes=t.keyframes;const e=t.keyframes[0].time;this.keyframes.forEach((t=>{t.time-=e})),this.audio&&(this.audio.pause(),this.audio=void 0),t.audio&&(this.audio=new Audio(t.audio)),this._duration=this.keyframes[this.keyframes.length-1].time,this.updateControls(),this.hasAttribute("autoplay")?this.play():this.renderPose()}loadPoseData(t){fetch(t).then((t=>t.json())).then((t=>{this.recording=t})).catch((function(){console.warn(`Error, ${t} cannot be found`)}))}connectedCallback(){super.connectedCallback(),this.hasAttribute("posedata")&&this.loadPoseData(this.getAttribute("posedata"))}togglePlayback(){this.isPlaying?this.pause():this.play()}step(t){this.currentKeyframe+=t,this.currentKeyframe<0&&(this.currentKeyframe=0),this.currentKeyframe>this.keyframes.length-1&&(this.currentKeyframe=this.keyframes.length-1),this.renderPose()}pause(){var t;null===(t=this.audio)||void 0===t||t.pause(),this._isPlaying=!1}play(){var t;this._isPlaying=!0,this.playStartTime=Date.now(),null===(t=this.audio)||void 0===t||t.play(),this.audio&&(this.audio.loop=this.isLooping),this.renderFrame()}renderFrame(){if(0===this.keyframes.length)return;if(this.currentKeyframe>=this.keyframes.length-1){if(!this.isLooping)return void(this._isPlaying=!1);this.currentKeyframe=0,this.playStartTime=Date.now(),this.renderPose()}this._currentTime=(Date.now()-this.playStartTime)*this._playbackRate;const t=this.keyframes[this.currentKeyframe+1];this.currentTime>t.time&&(this.currentKeyframe++,this.renderPose()),this.updateControls(),this.isPlaying&&requestAnimationFrame((()=>{this.renderFrame()}))}renderPose(){var t;const e=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector("slot");e&&e.assignedElements().forEach((t=>{if(t.draw){const e=this.getBoundingClientRect();t.draw([this.keyframes[this.currentKeyframe]],{width:e.width,height:e.height,x:0,y:0})}}))}get currentTime(){return this._currentTime}set currentTime(t){this.playStartTime=Date.now()-t,this._currentTime=t,this.audio&&(this.audio.currentTime=t/1e3),this.keyframes.length>0&&(this.currentKeyframe=this.findNearestKeyframe(this._currentTime,this.keyframes),this.renderPose())}findNearestKeyframe(t,e,n){if(1===e.length)return 0;const r=n?[n[0],n[1]]:[0,e.length-1];if(r[1]-r[0]<=1)return e[r[1]].time-t<t-e[r[0]].time?r[1]:r[0];const s=r[0],o=r[0]+Math.floor((r[1]-r[0])/2),i=r[1];return t>e[s].time&&t<e[o].time?this.findNearestKeyframe(t,e,[s,o]):this.findNearestKeyframe(t,e,[o,i])}onEnded(){clearInterval(this.timer),this.dispatchEvent(new Event(t.VIDEO_END,{bubbles:!0,composed:!0}))}attributeChangedCallback(t,e,n){switch(t){case"islooping":this._isLooping=this.hasAttribute("islooping"),this.audio&&(this.audio.loop=this.isLooping);break;case"src":this.loadPoseData(n)}}disconnectedCallback(){var t;null===(t=this.audio)||void 0===t||t.pause(),this.audio=void 0,clearInterval(this.timer)}}customElements.define("pose-player",Bst);
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const Vst=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,zst=Symbol(),Wst=new Map;class Ust{constructor(t,e){if(this._$cssResult$=!0,e!==zst)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t}get styleSheet(){let t=Wst.get(this.cssText);return Vst&&void 0===t&&(Wst.set(this.cssText,t=new CSSStyleSheet),t.replaceSync(this.cssText)),t}toString(){return this.cssText}}const jst=(t,...e)=>{const n=1===t.length?t[0]:e.reduce(((e,n,r)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if("number"==typeof t)return t;throw Error("Value passed to 'css' function must be a 'css' function result: "+t+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+t[r+1]),t[0]);return new Ust(n,zst)},Gst=Vst?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const n of t.cssRules)e+=n.cssText;return(t=>new Ust("string"==typeof t?t:t+"",zst))(e)})(t):t
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;var qst;const Hst=window.trustedTypes,Kst=Hst?Hst.emptyScript:"",Xst=window.reactiveElementPolyfillSupport,Jst={toAttribute(t,e){switch(e){case Boolean:t=t?Kst:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let n=t;switch(e){case Boolean:n=null!==t;break;case Number:n=null===t?null:Number(t);break;case Object:case Array:try{n=JSON.parse(t)}catch(t){n=null}}return n}},Yst=(t,e)=>e!==t&&(e==e||t==t),Zst={attribute:!0,type:String,converter:Jst,reflect:!1,hasChanged:Yst};class Qst extends HTMLElement{constructor(){super(),this._$Et=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Ei=null,this.o()}static addInitializer(t){var e;null!==(e=this.l)&&void 0!==e||(this.l=[]),this.l.push(t)}static get observedAttributes(){this.finalize();const t=[];return this.elementProperties.forEach(((e,n)=>{const r=this._$Eh(n,e);void 0!==r&&(this._$Eu.set(r,n),t.push(r))})),t}static createProperty(t,e=Zst){if(e.state&&(e.attribute=!1),this.finalize(),this.elementProperties.set(t,e),!e.noAccessor&&!this.prototype.hasOwnProperty(t)){const n="symbol"==typeof t?Symbol():"__"+t,r=this.getPropertyDescriptor(t,n,e);void 0!==r&&Object.defineProperty(this.prototype,t,r)}}static getPropertyDescriptor(t,e,n){return{get(){return this[e]},set(r){const s=this[t];this[e]=r,this.requestUpdate(t,s,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)||Zst}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const t=Object.getPrototypeOf(this);if(t.finalize(),this.elementProperties=new Map(t.elementProperties),this._$Eu=new Map,this.hasOwnProperty("properties")){const t=this.properties,e=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(const n of e)this.createProperty(n,t[n])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const n=new Set(t.flat(1/0).reverse());for(const t of n)e.unshift(Gst(t))}else void 0!==t&&e.push(Gst(t));return e}static _$Eh(t,e){const n=e.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof t?t.toLowerCase():void 0}o(){var t;this._$Ep=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$Em(),this.requestUpdate(),null===(t=this.constructor.l)||void 0===t||t.forEach((t=>t(this)))}addController(t){var e,n;(null!==(e=this._$Eg)&&void 0!==e?e:this._$Eg=[]).push(t),void 0!==this.renderRoot&&this.isConnected&&(null===(n=t.hostConnected)||void 0===n||n.call(t))}removeController(t){var e;null===(e=this._$Eg)||void 0===e||e.splice(this._$Eg.indexOf(t)>>>0,1)}_$Em(){this.constructor.elementProperties.forEach(((t,e)=>{this.hasOwnProperty(e)&&(this._$Et.set(e,this[e]),delete this[e])}))}createRenderRoot(){var t;const e=null!==(t=this.shadowRoot)&&void 0!==t?t:this.attachShadow(this.constructor.shadowRootOptions);return((t,e)=>{Vst?t.adoptedStyleSheets=e.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet)):e.forEach((e=>{const n=document.createElement("style"),r=window.litNonce;void 0!==r&&n.setAttribute("nonce",r),n.textContent=e.cssText,t.appendChild(n)}))})(e,this.constructor.elementStyles),e}connectedCallback(){var t;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(t=this._$Eg)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostConnected)||void 0===e?void 0:e.call(t)}))}enableUpdating(t){}disconnectedCallback(){var t;null===(t=this._$Eg)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostDisconnected)||void 0===e?void 0:e.call(t)}))}attributeChangedCallback(t,e,n){this._$AK(t,n)}_$ES(t,e,n=Zst){var r,s;const o=this.constructor._$Eh(t,n);if(void 0!==o&&!0===n.reflect){const i=(null!==(s=null===(r=n.converter)||void 0===r?void 0:r.toAttribute)&&void 0!==s?s:Jst.toAttribute)(e,n.type);this._$Ei=t,null==i?this.removeAttribute(o):this.setAttribute(o,i),this._$Ei=null}}_$AK(t,e){var n,r,s;const o=this.constructor,i=o._$Eu.get(t);if(void 0!==i&&this._$Ei!==i){const t=o.getPropertyOptions(i),a=t.converter,u=null!==(s=null!==(r=null===(n=a)||void 0===n?void 0:n.fromAttribute)&&void 0!==r?r:"function"==typeof a?a:null)&&void 0!==s?s:Jst.fromAttribute;this._$Ei=i,this[i]=u(e,t.type),this._$Ei=null}}requestUpdate(t,e,n){let r=!0;void 0!==t&&(((n=n||this.constructor.getPropertyOptions(t)).hasChanged||Yst)(this[t],e)?(this._$AL.has(t)||this._$AL.set(t,e),!0===n.reflect&&this._$Ei!==t&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(t,n))):r=!1),!this.isUpdatePending&&r&&(this._$Ep=this._$E_())}async _$E_(){this.isUpdatePending=!0;try{await this._$Ep}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;this.hasUpdated,this._$Et&&(this._$Et.forEach(((t,e)=>this[e]=t)),this._$Et=void 0);let e=!1;const n=this._$AL;try{e=this.shouldUpdate(n),e?(this.willUpdate(n),null===(t=this._$Eg)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostUpdate)||void 0===e?void 0:e.call(t)})),this.update(n)):this._$EU()}catch(t){throw e=!1,this._$EU(),t}e&&this._$AE(n)}willUpdate(t){}_$AE(t){var e;null===(e=this._$Eg)||void 0===e||e.forEach((t=>{var e;return null===(e=t.hostUpdated)||void 0===e?void 0:e.call(t)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Ep}shouldUpdate(t){return!0}update(t){void 0!==this._$EC&&(this._$EC.forEach(((t,e)=>this._$ES(e,this[e],t))),this._$EC=void 0),this._$EU()}updated(t){}firstUpdated(t){}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var tot;Qst.finalized=!0,Qst.elementProperties=new Map,Qst.elementStyles=[],Qst.shadowRootOptions={mode:"open"},null==Xst||Xst({ReactiveElement:Qst}),(null!==(qst=globalThis.reactiveElementVersions)&&void 0!==qst?qst:globalThis.reactiveElementVersions=[]).push("1.3.2");const eot=globalThis.trustedTypes,not=eot?eot.createPolicy("lit-html",{createHTML:t=>t}):void 0,rot=`lit$${(Math.random()+"").slice(9)}$`,sot="?"+rot,oot=`<${sot}>`,iot=document,aot=(t="")=>iot.createComment(t),uot=t=>null===t||"object"!=typeof t&&"function"!=typeof t,cot=Array.isArray,lot=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,fot=/-->/g,hot=/>/g,pot=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,dot=/'/g,mot=/"/g,yot=/^(?:script|style|textarea|title)$/i,got=t=>(e,...n)=>({_$litType$:t,strings:e,values:n}),bot=got(1),wot=got(2),vot=Symbol.for("lit-noChange"),xot=Symbol.for("lit-nothing"),Not=new WeakMap,$ot=iot.createTreeWalker(iot,129,null,!1),Eot=(t,e)=>{const n=t.length-1,r=[];let s,o=2===e?"<svg>":"",i=lot;for(let e=0;e<n;e++){const n=t[e];let a,u,c=-1,l=0;for(;l<n.length&&(i.lastIndex=l,u=i.exec(n),null!==u);)l=i.lastIndex,i===lot?"!--"===u[1]?i=fot:void 0!==u[1]?i=hot:void 0!==u[2]?(yot.test(u[2])&&(s=RegExp("</"+u[2],"g")),i=pot):void 0!==u[3]&&(i=pot):i===pot?">"===u[0]?(i=null!=s?s:lot,c=-1):void 0===u[1]?c=-2:(c=i.lastIndex-u[2].length,a=u[1],i=void 0===u[3]?pot:'"'===u[3]?mot:dot):i===mot||i===dot?i=pot:i===fot||i===hot?i=lot:(i=pot,s=void 0);const f=i===pot&&t[e+1].startsWith("/>")?" ":"";o+=i===lot?n+oot:c>=0?(r.push(a),n.slice(0,c)+"$lit$"+n.slice(c)+rot+f):n+rot+(-2===c?(r.push(void 0),e):f)}const a=o+(t[n]||"<?>")+(2===e?"</svg>":"");if(!Array.isArray(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return[void 0!==not?not.createHTML(a):a,r]};class Sot{constructor({strings:t,_$litType$:e},n){let r;this.parts=[];let s=0,o=0;const i=t.length-1,a=this.parts,[u,c]=Eot(t,e);if(this.el=Sot.createElement(u,n),$ot.currentNode=this.el.content,2===e){const t=this.el.content,e=t.firstChild;e.remove(),t.append(...e.childNodes)}for(;null!==(r=$ot.nextNode())&&a.length<i;){if(1===r.nodeType){if(r.hasAttributes()){const t=[];for(const e of r.getAttributeNames())if(e.endsWith("$lit$")||e.startsWith(rot)){const n=c[o++];if(t.push(e),void 0!==n){const t=r.getAttribute(n.toLowerCase()+"$lit$").split(rot),e=/([.?@])?(.*)/.exec(n);a.push({type:1,index:s,name:e[2],strings:t,ctor:"."===e[1]?Cot:"?"===e[1]?Iot:"@"===e[1]?Mot:Aot})}else a.push({type:6,index:s})}for(const e of t)r.removeAttribute(e)}if(yot.test(r.tagName)){const t=r.textContent.split(rot),e=t.length-1;if(e>0){r.textContent=eot?eot.emptyScript:"";for(let n=0;n<e;n++)r.append(t[n],aot()),$ot.nextNode(),a.push({type:2,index:++s});r.append(t[e],aot())}}}else if(8===r.nodeType)if(r.data===sot)a.push({type:2,index:s});else{let t=-1;for(;-1!==(t=r.data.indexOf(rot,t+1));)a.push({type:7,index:s}),t+=rot.length-1}s++}}static createElement(t,e){const n=iot.createElement("template");return n.innerHTML=t,n}}function _ot(t,e,n=t,r){var s,o,i,a;if(e===vot)return e;let u=void 0!==r?null===(s=n._$Cl)||void 0===s?void 0:s[r]:n._$Cu;const c=uot(e)?void 0:e._$litDirective$;return(null==u?void 0:u.constructor)!==c&&(null===(o=null==u?void 0:u._$AO)||void 0===o||o.call(u,!1),void 0===c?u=void 0:(u=new c(t),u._$AT(t,n,r)),void 0!==r?(null!==(i=(a=n)._$Cl)&&void 0!==i?i:a._$Cl=[])[r]=u:n._$Cu=u),void 0!==u&&(e=_ot(t,u._$AS(t,e.values),u,r)),e}class Tot{constructor(t,e){this.v=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}p(t){var e;const{el:{content:n},parts:r}=this._$AD,s=(null!==(e=null==t?void 0:t.creationScope)&&void 0!==e?e:iot).importNode(n,!0);$ot.currentNode=s;let o=$ot.nextNode(),i=0,a=0,u=r[0];for(;void 0!==u;){if(i===u.index){let e;2===u.type?e=new kot(o,o.nextSibling,this,t):1===u.type?e=new u.ctor(o,u.name,u.strings,this,t):6===u.type&&(e=new Rot(o,this,t)),this.v.push(e),u=r[++a]}i!==(null==u?void 0:u.index)&&(o=$ot.nextNode(),i++)}return s}m(t){let e=0;for(const n of this.v)void 0!==n&&(void 0!==n.strings?(n._$AI(t,n,e),e+=n.strings.length-2):n._$AI(t[e])),e++}}class kot{constructor(t,e,n,r){var s;this.type=2,this._$AH=xot,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=n,this.options=r,this._$Cg=null===(s=null==r?void 0:r.isConnected)||void 0===s||s}get _$AU(){var t,e;return null!==(e=null===(t=this._$AM)||void 0===t?void 0:t._$AU)&&void 0!==e?e:this._$Cg}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===t.nodeType&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=_ot(this,t,e),uot(t)?t===xot||null==t||""===t?(this._$AH!==xot&&this._$AR(),this._$AH=xot):t!==this._$AH&&t!==vot&&this.$(t):void 0!==t._$litType$?this.T(t):void 0!==t.nodeType?this.k(t):(t=>{var e;return cot(t)||"function"==typeof(null===(e=t)||void 0===e?void 0:e[Symbol.iterator])})(t)?this.S(t):this.$(t)}M(t,e=this._$AB){return this._$AA.parentNode.insertBefore(t,e)}k(t){this._$AH!==t&&(this._$AR(),this._$AH=this.M(t))}$(t){this._$AH!==xot&&uot(this._$AH)?this._$AA.nextSibling.data=t:this.k(iot.createTextNode(t)),this._$AH=t}T(t){var e;const{values:n,_$litType$:r}=t,s="number"==typeof r?this._$AC(t):(void 0===r.el&&(r.el=Sot.createElement(r.h,this.options)),r);if((null===(e=this._$AH)||void 0===e?void 0:e._$AD)===s)this._$AH.m(n);else{const t=new Tot(s,this),e=t.p(this.options);t.m(n),this.k(e),this._$AH=t}}_$AC(t){let e=Not.get(t.strings);return void 0===e&&Not.set(t.strings,e=new Sot(t)),e}S(t){cot(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let n,r=0;for(const s of t)r===e.length?e.push(n=new kot(this.M(aot()),this.M(aot()),this,this.options)):n=e[r],n._$AI(s),r++;r<e.length&&(this._$AR(n&&n._$AB.nextSibling,r),e.length=r)}_$AR(t=this._$AA.nextSibling,e){var n;for(null===(n=this._$AP)||void 0===n||n.call(this,!1,!0,e);t&&t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){var e;void 0===this._$AM&&(this._$Cg=t,null===(e=this._$AP)||void 0===e||e.call(this,t))}}class Aot{constructor(t,e,n,r,s){this.type=1,this._$AH=xot,this._$AN=void 0,this.element=t,this.name=e,this._$AM=r,this.options=s,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=xot}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,e=this,n,r){const s=this.strings;let o=!1;if(void 0===s)t=_ot(this,t,e,0),o=!uot(t)||t!==this._$AH&&t!==vot,o&&(this._$AH=t);else{const r=t;let i,a;for(t=s[0],i=0;i<s.length-1;i++)a=_ot(this,r[n+i],e,i),a===vot&&(a=this._$AH[i]),o||(o=!uot(a)||a!==this._$AH[i]),a===xot?t=xot:t!==xot&&(t+=(null!=a?a:"")+s[i+1]),this._$AH[i]=a}o&&!r&&this.C(t)}C(t){t===xot?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=t?t:"")}}class Cot extends Aot{constructor(){super(...arguments),this.type=3}C(t){this.element[this.name]=t===xot?void 0:t}}const Oot=eot?eot.emptyScript:"";class Iot extends Aot{constructor(){super(...arguments),this.type=4}C(t){t&&t!==xot?this.element.setAttribute(this.name,Oot):this.element.removeAttribute(this.name)}}class Mot extends Aot{constructor(t,e,n,r,s){super(t,e,n,r,s),this.type=5}_$AI(t,e=this){var n;if((t=null!==(n=_ot(this,t,e,0))&&void 0!==n?n:xot)===vot)return;const r=this._$AH,s=t===xot&&r!==xot||t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive,o=t!==xot&&(r===xot||s);s&&this.element.removeEventListener(this.name,this,r),o&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,n;"function"==typeof this._$AH?this._$AH.call(null!==(n=null===(e=this.options)||void 0===e?void 0:e.host)&&void 0!==n?n:this.element,t):this._$AH.handleEvent(t)}}class Rot{constructor(t,e,n){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(t){_ot(this,t)}}const Dot=window.litHtmlPolyfillSupport;
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var Fot,Lot;null==Dot||Dot(Sot,kot),(null!==(tot=globalThis.litHtmlVersions)&&void 0!==tot?tot:globalThis.litHtmlVersions=[]).push("2.2.6");class Pot extends Qst{constructor(){super(...arguments),this.renderOptions={host:this},this._$Dt=void 0}createRenderRoot(){var t,e;const n=super.createRenderRoot();return null!==(t=(e=this.renderOptions).renderBefore)&&void 0!==t||(e.renderBefore=n.firstChild),n}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Dt=((t,e,n)=>{var r,s;const o=null!==(r=null==n?void 0:n.renderBefore)&&void 0!==r?r:e;let i=o._$litPart$;if(void 0===i){const t=null!==(s=null==n?void 0:n.renderBefore)&&void 0!==s?s:null;o._$litPart$=i=new kot(e.insertBefore(aot(),t),t,void 0,null!=n?n:{})}return i._$AI(t),i})(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),null===(t=this._$Dt)||void 0===t||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),null===(t=this._$Dt)||void 0===t||t.setConnected(!1)}render(){return vot}}Pot.finalized=!0,Pot._$litElement$=!0,null===(Fot=globalThis.litElementHydrateSupport)||void 0===Fot||Fot.call(globalThis,{LitElement:Pot});const Bot=globalThis.litElementPolyfillSupport;null==Bot||Bot({LitElement:Pot}),(null!==(Lot=globalThis.litElementVersions)&&void 0!==Lot?Lot:globalThis.litElementVersions=[]).push("3.2.0");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const Vot=t=>e=>"function"==typeof e?((t,e)=>(window.customElements.define(t,e),e))(t,e):((t,e)=>{const{kind:n,elements:r}=e;return{kind:n,elements:r,finisher(e){window.customElements.define(t,e)}}})(t,e)
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */,zot=(t,e)=>"method"===e.kind&&e.descriptor&&!("value"in e.descriptor)?{...e,finisher(n){n.createProperty(e.key,t)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:e.key,initializer(){"function"==typeof e.initializer&&(this[e.key]=e.initializer.call(this))},finisher(n){n.createProperty(e.key,t)}};function Wot(t){return(e,n)=>void 0!==n?((t,e,n)=>{e.constructor.createProperty(n,t)})(t,e,n):zot(t,e)
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */}var Uot;null===(Uot=window.HTMLSlotElement)||void 0===Uot||Uot.prototype.assignedElements;const jot=wot`<svg width="700pt" height="700pt" version="1.1" viewBox="0 0 700 700" xmlns="http://www.w3.org/2000/svg">
<path d="m541.52 244.16-334.88-222.88c-28.559-19.039-67.199 1.6797-67.199 35.84v445.2c0 34.719 38.641 54.879 67.199 35.84l334.88-222.88c25.199-16.242 25.199-54.32 0-71.121z"/>
</svg>`,Got=wot`<svg width="700pt" height="700pt" version="1.1" viewBox="0 0 700 700" xmlns="http://www.w3.org/2000/svg">
  <path d="m210 0c-18.566 0-36.367 7.375-49.496 20.504s-20.504 30.93-20.504 49.496v420c0 25.008 13.344 48.117 35 60.621s48.344 12.504 70 0 35-35.613 35-60.621v-420c0-18.566-7.375-36.367-20.504-49.496s-30.93-20.504-49.496-20.504z"/>
  <path d="m490 0c-18.566 0-36.367 7.375-49.496 20.504s-20.504 30.93-20.504 49.496v420c0 25.008 13.344 48.117 35 60.621s48.344 12.504 70 0 35-35.613 35-60.621v-420c0-18.566-7.375-36.367-20.504-49.496s-30.93-20.504-49.496-20.504z"/>
</svg>`,qot=wot`<svg width="700pt" height="700pt" version="1.1" viewBox="0 0 700 700" xmlns="http://www.w3.org/2000/svg">
  <path d="m163.52 297.92c17.359 0 31.359-14 31.359-31.359v-99.121h264.88l-36.398 36.398c-12.32 12.32-12.32 32.48 0 44.801 6.1602 6.1602 14 9.5195 22.398 9.5195 7.8398 0 16.238-3.3594 22.398-9.5195l90.16-90.16c6.1602-6.1602 9.5195-14 9.5195-22.398 0-8.3984-3.3594-16.238-9.5195-22.398l-90.156-90.164c-12.32-12.32-32.48-12.32-44.801 0-12.32 12.32-12.32 32.48 0 44.801l36.398 36.398h-296.24c-17.359 0-31.359 14-31.359 31.359v130.48c0 17.363 14 31.363 31.359 31.363z"/>
  <path d="m536.48 262.08c-17.359 0-31.359 14-31.359 31.359v99.121h-265.44l36.398-36.398c12.32-12.32 12.32-32.48 0-44.801s-32.48-12.32-44.801 0l-89.598 90.719c-6.1602 6.1602-9.5195 14-9.5195 22.398 0 8.3984 3.3594 16.238 8.9609 22.398l90.16 90.16c6.1602 6.1602 14 9.5195 22.398 9.5195 7.8398 0 16.238-3.3594 22.398-9.5195 12.32-12.32 12.32-32.48 0-44.801l-36.398-36.398h296.24c17.359 0 31.359-14 31.359-31.359l0.003906-131.04c0.55859-17.363-13.441-31.363-30.801-31.363z"/>
</svg>`,Hot=wot`<svg width="700pt" height="700pt" version="1.1" viewBox="0 0 700 700" xmlns="http://www.w3.org/2000/svg">
  <path transform="matrix(5.6566 0 0 5.6566 95.455 28.283)" d="m75 45c0 16.569-13.431 30-30 30s-30-13.431-30-30 13.431-30 30-30 30 13.431 30 30"/>
</svg>`,Kot=wot`<svg width="700pt" height="700pt" version="1.1" viewBox="0 0 700 700" xmlns="http://www.w3.org/2000/svg">
    <path d="m350 70c-19.695 0.36328-36.191 7.1992-49.488 20.512-13.301 13.309-20.137 29.809-20.512 49.488v140c0.36328 19.695 7.1992 36.191 20.512 49.488 13.309 13.301 29.809 20.137 49.488 20.512 19.695-0.36328 36.191-7.1992 49.488-20.512 13.301-13.309 20.137-29.809 20.512-49.488v-140c-0.36328-19.695-7.1992-36.191-20.512-49.488-13.309-13.301-29.809-20.137-49.488-20.512zm0-35c29.902 0.73438 54.695 10.945 74.375 30.625s29.891 44.473 30.625 74.375v140c-0.73438 29.902-10.945 54.695-30.625 74.375s-44.473 29.891-74.375 30.625c-29.902-0.73438-54.695-10.945-74.375-30.625s-29.891-44.473-30.625-74.375v-140c0.73438-29.902 10.945-54.695 30.625-74.375s44.473-29.891 74.375-30.625zm-17.5 455v-35c-44.484-1.0938-81.578-16.504-111.28-46.219s-45.109-66.809-46.219-111.28v-17.5c0-5.1094 1.6406-9.3047 4.918-12.582 3.2773-3.2773 7.4727-4.918 12.582-4.918s9.3047 1.6406 12.582 4.918c3.2773 3.2773 4.918 7.4727 4.918 12.582v17.5c0.73438 34.637 12.676 63.531 35.824 86.676 23.145 23.148 52.039 35.09 86.676 35.824h35c34.637-0.73438 63.531-12.676 86.676-35.824 23.148-23.145 35.09-52.039 35.824-86.676v-17.5c0-5.1094 1.6367-9.3047 4.918-12.582 3.2773-3.2773 7.4727-4.918 12.582-4.918s9.3047 1.6406 12.582 4.918c3.2812 3.2773 4.918 7.4727 4.918 12.582v17.5c-1.0938 44.484-16.504 81.578-46.219 111.28-29.715 29.707-66.809 45.109-111.28 46.219v35h35c5.1094 0 9.3047 1.6367 12.582 4.918 3.2773 3.2773 4.918 7.4727 4.918 12.582s-1.6406 9.3047-4.918 12.582c-3.2773 3.2812-7.4727 4.918-12.582 4.918h-105c-5.1094 0-9.3047-1.6367-12.582-4.918-3.2773-3.2773-4.918-7.4727-4.918-12.582s1.6406-9.3047 4.918-12.582c3.2773-3.2812 7.4727-4.918 12.582-4.918z"/>
</svg>`,Xot=wot`<svg transform="translate(0, 2)" width="700pt" height="700pt" version="1.1" viewBox="0 0 700 700" xmlns="http://www.w3.org/2000/svg">
    <path d="m227.05 87.426v385.03c-0.011719 13.48 14.574 21.914 26.25 15.176l333.41-192.51c11.672-6.7344 11.672-23.582 0-30.32l-333.41-192.51c-10.891-6.2891-26.246 0.94141-26.246 15.141z"/>
    <path d="m122.05 70h35c9.6953 0 17.5 7.8047 17.5 17.5v385c0 9.6953-7.8047 17.5-17.5 17.5h-35c-9.6953 0-17.5-7.8047-17.5-17.5v-385c0-9.6953 7.8047-17.5 17.5-17.5z"/>
 </svg>`,Jot=wot`<svg transform="scale(-1, 1) translate(0, 2)" width="700pt" height="700pt" version="1.1" viewBox="0 0 700 700" xmlns="http://www.w3.org/2000/svg">
    <path d="m227.05 87.426v385.03c-0.011719 13.48 14.574 21.914 26.25 15.176l333.41-192.51c11.672-6.7344 11.672-23.582 0-30.32l-333.41-192.51c-10.891-6.2891-26.246 0.94141-26.246 15.141z"/>
    <path d="m122.05 70h35c9.6953 0 17.5 7.8047 17.5 17.5v385c0 9.6953-7.8047 17.5-17.5 17.5h-35c-9.6953 0-17.5-7.8047-17.5-17.5v-385c0-9.6953 7.8047-17.5 17.5-17.5z"/>
 </svg>`;var Yot=function(t,e,n,r){for(var s,o=arguments.length,i=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r,a=t.length-1;a>=0;a--)(s=t[a])&&(i=(o<3?s(i):o>3?s(e,n,i):s(e,n))||i);return o>3&&i&&Object.defineProperty(e,n,i),i};let Zot=class extends Pot{constructor(){super(...arguments),this.disabled=!1}render(){return bot`<button><slot></slot></button>`}};Zot.styles=[jst`
      :host {
        display: inline-block;
        padding-left: 3px;
        padding-right: 3px;
      }
      
      :host([disabled]) {
        pointer-events: none;
      }

      :host([disabled]) button {
        opacity: .25;
      }

      button {
        display: inline-block;
        background-color: transparent;
        border: none;
        color: white;
        padding: 5px;
        height: 100%;
      }

      button:hover {
        background-color: rgba(0, 0, 0, 0.1);
      }

      button svg,
      button ::slotted(svg) {
        width: 18px;
        height: 18px;
        fill: white;
        vertical-align: middle;
        filter: drop-shadow(1px 3px .5px rgb(50, 55, 58));
      }

      button:hover svg,
      button:hover ::slotted(svg) {
        margin-top: 1px;
        filter: drop-shadow(1px 1px .5px rgb(44, 39, 39));
      }
    `],Yot([Wot({type:Boolean,reflect:!0})],Zot.prototype,"disabled",void 0),Zot=Yot([Vot("pose-button")],Zot);var Qot=function(t,e,n,r){for(var s,o=arguments.length,i=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r,a=t.length-1;a>=0;a--)(s=t[a])&&(i=(o<3?s(i):o>3?s(e,n,i):s(e,n))||i);return o>3&&i&&Object.defineProperty(e,n,i),i};let tit=class extends Zot{constructor(){super(...arguments),this.playing=!1}render(){return bot`<button>${this.playing?Got:jot}</button>`}};tit.styles=[...Zot.styles],Qot([Wot({type:Boolean,reflect:!0})],tit.prototype,"playing",void 0),tit=Qot([Vot("pose-play-button")],tit);var eit=function(t,e,n,r){for(var s,o=arguments.length,i=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r,a=t.length-1;a>=0;a--)(s=t[a])&&(i=(o<3?s(i):o>3?s(e,n,i):s(e,n))||i);return o>3&&i&&Object.defineProperty(e,n,i),i};let nit=class extends Zot{constructor(){super(...arguments),this.active=!1}render(){return bot`<button><slot></slot></button>`}};nit.styles=[...Zot.styles,jst`
      :host([active]) button {
        background-color: rgba(0, 0, 0, 0.25);
      }
      
      :host([active]) button ::slotted(svg) {
        margin-top: 1px;
        filter: drop-shadow(1px 1px 1px rgb(50, 55, 58));
      }
    `],eit([Wot({type:Boolean,reflect:!0})],nit.prototype,"active",void 0),nit=eit([Vot("pose-toggle-button")],nit);var rit=function(t,e,n,r){for(var s,o=arguments.length,i=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r,a=t.length-1;a>=0;a--)(s=t[a])&&(i=(o<3?s(i):o>3?s(e,n,i):s(e,n))||i);return o>3&&i&&Object.defineProperty(e,n,i),i};let sit=class extends Pot{constructor(){super(...arguments),this.progress=0,this.scrubProgress=-1,this.handlePointerMove=t=>{this.calculateScrubPos(t.clientX),this.requestUpdate()},this.handlePointerUp=()=>{document.removeEventListener("pointermove",this.handlePointerMove),document.removeEventListener("pointerup",this.handlePointerUp),this.scrubProgress=-1,this.requestUpdate()}}handlePointerDown(t){document.addEventListener("pointermove",this.handlePointerMove),document.addEventListener("pointerup",this.handlePointerUp),this.calculateScrubPos(t.clientX),this.requestUpdate()}calculateScrubPos(t){const e=t-this.getBoundingClientRect().x;this.scrubProgress=Math.min(Math.max(e/this.getBoundingClientRect().width*100,0),100);const n=new Event("scrub",{bubbles:!0});this.dispatchEvent(n)}render(){return bot`<div id="container" @pointerdown=${this.handlePointerDown}>
            <div id="progress" style="width: ${this.scrubProgress>=0?this.scrubProgress:this.progress}%">
            </div>
        </div>`}};sit.styles=jst`
      :host {
        position: relative;
        display: inline-block;
      }

      #container {
        background-color: #5f6773;
        width: 100%;
        height: 100%;
        position: absolute;
      }

      #progress {
        position: absolute;
        height: 100%;
        background-color: #66b2ea;
      }
    `,rit([Wot({type:Number,reflect:!0})],sit.prototype,"progress",void 0),rit([Wot({type:Number,reflect:!0})],sit.prototype,"scrubProgress",void 0),sit=rit([Vot("pose-timeline")],sit);var oit=function(t,e,n,r){for(var s,o=arguments.length,i=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r,a=t.length-1;a>=0;a--)(s=t[a])&&(i=(o<3?s(i):o>3?s(e,n,i):s(e,n))||i);return o>3&&i&&Object.defineProperty(e,n,i),i};let iit=class extends Pot{constructor(){super(...arguments),this.currentTime=0,this.duration=0,this.isPlaying=!1,this.isLooping=!1,this.isRecording=!1,this.isAudioRecording=!1,this.recordingDuration=-1,this.playbackRate=1,this.canRecord=!1}doAction(t){const n=new e(t,this,{bubbles:!0,composed:!0});this.dispatchEvent(n)}render(){return this.duration===1/0||0===this.duration?this.renderLiveMode():this.renderNonLiveMode()}renderNonLiveMode(){return bot`<pose-play-button 
                        class="control" 
                        ?disabled=${this.isRecording}
                        ?playing=${this.isPlaying}
                        @click=${()=>this.doAction(e.TOGGLE_PLAYBACK)}>
                    </pose-play-button>
                    <div class="divider"></div>
                    <pose-button ?disabled=${this.isRecording} @click=${()=>this.doAction(e.STEP_FORWARD)}>${Xot}</pose-button>
                    <div class="divider"></div>
                    <pose-button ?disabled=${this.isRecording} @click=${()=>this.doAction(e.STEP_BACKWARD)}>${Jot}</pose-button>
                    <div class="divider"></div>
                    ${this.renderRecordingControls()}
                    
                    ${this.isRecording?void 0:bot`
                    <pose-timeline 
                        class="control"
                        @scrub=${t=>{this.currentTime=t.target.scrubProgress/100*this.duration,this.doAction(e.TIMELINE_SCRUB)}}
                        progress=${this.currentTime/this.duration*100}>
                    </pose-timeline>
                    <div class="divider"></div>
                    <span class="time">${n.formatTime(this.currentTime)} / ${n.formatTime(this.duration)}</span>
                    <div class="divider"></div>
                    <pose-toggle-button 
                        class="control"
                        @click=${()=>this.doAction(e.LOOP)}
                        ?active=${this.isLooping}>
                        ${qot}
                    </pose-toggle-button>
                    <div class="divider"></div>
                    <pose-toggle-button
                            class="control"
                            @click=${()=>{1===this.playbackRate?this.playbackRate=.1:this.playbackRate=1,this.doAction(e.PLAYBACK_RATE_UPDATE)}}
                            ?active=${.1===this.playbackRate}>
                        .1x
                    </pose-toggle-button>`}`}renderLiveMode(){return this.renderRecordingControls()}renderRecordingControls(){if(this.canRecord)return bot`<pose-toggle-button
                class="control record"
                ?disabled=${this.isAudioRecording}
                @click=${()=>this.doAction(e.TOGGLE_RECORD_POSE)}
                ?active=${this.isRecording&&!this.isAudioRecording}>
            ${Hot}
        </pose-toggle-button>
        <div class="divider"></div>
        <pose-toggle-button
                class="control record"
                ?disabled=${this.isRecording&&!this.isAudioRecording}
                @click=${()=>this.doAction(e.TOGGLE_RECORD_POSE_AND_AUDIO)}
                ?active=${this.isAudioRecording}>
            ${Hot}<span>+</span>${Kot}
        </pose-toggle-button>
        <div class="divider"></div>
        
        ${this.isRecording&&this.recordingDuration>-1?bot`
        <span class="recording-time">${n.formatTime(this.recordingDuration)}</span>
        <div class="divider"></div>`:void 0}`}};iit.styles=jst`
      :host {
        background-color: #5f6773;
        height: 25px;
        display: flex;
        align-items: center;
        font-family: 'Open Sans', arial, sans-serif;
        color: white;
        font-size: small;
        bottom: 0;
      }

      span.time,
      span.recording-time {
        filter: drop-shadow(1px 3px .5px rgb(50, 55, 58));
        padding-left: 10px;
        padding-right: 10px;
      }

      .divider {
        height: 66%;
        width: 1px;
        background-color: #8292a2;
      }

      .control {
        height: 100%;
      }

      :host([isRecording]) span.recording-time {
        color: #ffc3c7;
      }

      .control.record[active] span,
      .control.record[active] svg {
        fill: #dd3344;
        color: #dd3344;
      }

      pose-timeline {
        flex: 1;
        height: 100%;
      }
    `,oit([Wot({type:Number,reflect:!0})],iit.prototype,"currentTime",void 0),oit([Wot({type:Number,reflect:!0})],iit.prototype,"duration",void 0),oit([Wot({type:Boolean,reflect:!0})],iit.prototype,"isPlaying",void 0),oit([Wot({type:Boolean,reflect:!0})],iit.prototype,"isLooping",void 0),oit([Wot({type:Boolean,reflect:!0})],iit.prototype,"isRecording",void 0),oit([Wot({type:Boolean,reflect:!0})],iit.prototype,"isAudioRecording",void 0),oit([Wot({type:Number,reflect:!0})],iit.prototype,"recordingDuration",void 0),oit([Wot({type:Number,reflect:!0})],iit.prototype,"playbackRate",void 0),oit([Wot({type:Boolean,reflect:!0})],iit.prototype,"canRecord",void 0),iit=oit([Vot("pose-playback-controls")],iit);class ait extends HTMLElement{constructor(){super(),this.dotSize=2,this.dotColor="#ff0000",this.offsetX=0,this.offsetY=0,this.offsetX=0,this.offsetY=0,this.attachShadow({mode:"open"}),this.shadowRoot&&(this.shadowRoot.innerHTML="\n            <style>\n                :host {\n                    display: inline-block;\n                }\n\n                canvas {\n                    position: relative;\n                }\n            </style>\n            <canvas></canvas>")}static get observedAttributes(){return["dotsize","dotcolor","dotbackcolor"]}clear(){this.canvas&&this.canvasContext&&this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height)}resize(){this.clear(),this.canvasContext=null}draw(t,e){var n;this.canvas&&this.canvasContext&&this.canvas.width===e.width&&this.canvas.height===e.height||(this.canvas=null===(n=this.shadowRoot)||void 0===n?void 0:n.querySelector("canvas"),this.canvas&&(this.canvas.style.left=`${e.x}px`,this.canvas.style.top=`${e.y}px`,this.canvas.width=e.width,this.canvas.height=e.height,this.offsetX=e.x,this.offsetY=e.y,this.canvasContext=this.canvas.getContext("2d"))),this.canvasContext&&this.canvas&&(this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvasContext.fillStyle=this.dotColor,t.forEach((t=>{t.points.forEach((t=>{t.position&&this.drawPoints(t.position),t.positions&&t.positions.forEach((t=>this.drawPoints(t)))}))})))}drawPoints(t){var e,n,r,s,o;const i=t[0]*((null===(e=this.canvas)||void 0===e?void 0:e.width)||0),a=t[1]*((null===(n=this.canvas)||void 0===n?void 0:n.height)||0);if(this.dotBackColor){const e=1,n=t[2]/e,r=ait.InterpolateColor(this.dotColor,this.dotBackColor,n);this.canvasContext&&(this.canvasContext.fillStyle=r)}null===(r=this.canvasContext)||void 0===r||r.beginPath(),null===(s=this.canvasContext)||void 0===s||s.arc(i,a,this.dotSize,0,2*Math.PI,!1),null===(o=this.canvasContext)||void 0===o||o.fill()}drawGrid(){if(this.canvasContext&&this.canvas){this.canvasContext.strokeStyle="#ffff00";for(let t=0;t<this.canvas.width;t+=10)this.canvasContext.beginPath(),this.canvasContext.moveTo(t,0),this.canvasContext.lineTo(t,this.canvas.height),this.canvasContext.stroke();for(let t=0;t<this.canvas.height;t+=10)this.canvasContext.beginPath(),this.canvasContext.moveTo(0,t),this.canvasContext.lineTo(this.canvas.width,t),this.canvasContext.stroke()}}async attributeChangedCallback(t,e,n){switch(t){case"dotsize":this.dotSize=n;break;case"dotcolor":this.dotColor=n;break;case"dotbackcolor":this.dotBackColor=n}}static AdjustColorBrightness(t,e){const n=parseInt(t,16);return((255&n)+e|(n>>8&255)+e<<8|(n>>16)+e<<16).toString(16)}static InterpolateColor(t,e,n){var r,s;const o=null===(r=t.substr(1,t.length).match(/.{1,2}/g))||void 0===r?void 0:r.map((t=>parseInt(t,16)*(1-n))),i=null===(s=e.substr(1,e.length).match(/.{1,2}/g))||void 0===s?void 0:s.map((t=>parseInt(t,16)*n));if(o&&i){const t=[0,1,2].map((t=>Math.min(Math.round(o[t]+i[t]),255)));return`#${t.reduce(((t,e)=>(t<<8)+e),0).toString(16).padStart(6,"0")}`}return"#000000"}}customElements.define("visualization-canvas",ait);export{n as BasePlayer,rO as BodyPixVideo,t as Events,qV as FaceLandmarkVideo,Pst as HandPoseVideo,s as KeyframeEvent,iit as PlaybackControls,zQ as PoseDetectionVideo,Bst as PosePlayer,ait as VisualizationCanvas};
